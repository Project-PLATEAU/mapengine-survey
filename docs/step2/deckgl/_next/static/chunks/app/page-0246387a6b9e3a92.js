(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9125:function(){},5469:function(e,t,i){Promise.resolve().then(i.bind(i,8743))},8743:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return P}});var r=i(9268),a=i(6006),s=i(7775),l=i(201),n=i(2975),o=i.n(n);i(2127);var d=i(9930);function u(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.filter(Boolean).join(" ")}var c=e=>{let{backgroundNames:t,selectedBackground:i,setSelectedBackground:a,layerEntries:s,toggleLayerVisibility:l}=e;return(0,r.jsx)("div",{id:"menu",className:"absolute left-10 top-10 z-10 bg-white p-4 rounded shadow-2xl",children:(0,r.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,r.jsx)("h1",{className:"text-xl font-bold",children:"deck.gl"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"background",className:"block text-sm font-semibold leading-6 text-gray-900",children:"背景 （MapLibre GL JS）"}),(0,r.jsx)("select",{id:"background",name:"background",value:i,onChange:e=>{a(e.target.value)},className:"mt-2 block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6",children:t.map(e=>(0,r.jsx)("option",{children:e},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"block text-sm font-semibold leading-6 text-gray-900 mb-3",children:"レイヤー （deck.gl）"}),(0,r.jsx)("div",{className:"flex flex-col gap-y-3 text-sm",children:s.map(e=>(0,r.jsxs)("div",{className:"flex justify-between gap-x-3",children:[(0,r.jsx)("div",{children:e.name}),(0,r.jsx)(d.r,{checked:e.visible,onChange:()=>{l(e.id)},className:u(e.visible?"bg-indigo-600":"bg-gray-200","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2"),children:(0,r.jsx)("span",{"aria-hidden":"true",className:u(e.visible?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out")})})]},e.id))})]})]})})},p=e=>{var t,i,a,s,l,n,o,d,u,c;let{clickInfo:p}=e;return(0,r.jsx)(r.Fragment,{children:(null==p?void 0:p.object)&&(0,r.jsxs)("div",{style:{position:"absolute",zIndex:1,pointerEvents:"none",left:p.x,top:p.y,background:"white",padding:"0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",maxWidth:"20rem",maxHeight:"20rem",overflow:"auto"},children:[(0,r.jsx)("div",{style:{fontSize:"1.2em",textAlign:"center"},children:(0,r.jsx)("b",{children:null===(t=p.layer)||void 0===t?void 0:t.id})}),(0,r.jsxs)("div",{children:[(null===(i=p.layer)||void 0===i?void 0:i.id.includes("mvtlayer"))&&Object.entries(p.object.properties).map(e=>{let[t,i]=e;return(0,r.jsxs)("div",{children:[(0,r.jsx)("b",{children:t}),": ",i]},t)}),(null===(a=p.layer)||void 0===a?void 0:a.id.includes("tile3dlayer"))&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("b",{children:"sourceLayer.id"}),": ",null===(s=p.sourceLayer)||void 0===s?void 0:s.id,(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsx)("b",{children:"名称"}),":",(0,r.jsx)("br",{}),null===(l=null===(n=p.object.content)||void 0===n?void 0:n.batchTableJson["名称"])||void 0===l?void 0:l.map((e,t)=>(0,r.jsxs)(r.Fragment,{children:[t+1,". ",e,(0,r.jsx)("br",{})]})),(0,r.jsx)("br",{}),(0,r.jsx)("b",{children:"住所"}),":",(0,r.jsx)("br",{}),null===(o=null===(d=p.object.content)||void 0===d?void 0:d.batchTableJson["住所"])||void 0===o?void 0:o.map((e,t)=>(0,r.jsxs)(r.Fragment,{children:[t+1,". ",e,(0,r.jsx)("br",{})]})),(0,r.jsx)("br",{}),(0,r.jsx)("b",{children:"gml_id"}),":",(0,r.jsx)("br",{}),null===(u=null===(c=p.object.content)||void 0===c?void 0:c.batchTableJson.gml_id)||void 0===u?void 0:u.map((e,t)=>(0,r.jsxs)(r.Fragment,{children:[t+1,". ",e,(0,r.jsx)("br",{})]}))]})]})]})})};let g={longitude:139.76,latitude:35.68,zoom:15,pitch:60,bearing:0};var h=i(7321),m=i(183),b=i(8341),x=i(2826),f=i(8153),y=i(8325),v=i(1193),j=i(7455),_=i(7689),k=i(7431);async function S(e,t,i){t.image=t.image||{},t.image.type="data";let r=await i.parse(e,t,t.baseUri);return function(e,t){if(null===e)return null;let{meshMaxError:i,bounds:r,elevationDecoder:a}=t,s=e.data,l=e.width,n=l+1,o=function(e,t,i){let{scaler:r,offset:a}=i,s=t+1,l=new Float32Array(s*s);for(let i=0,s=0;s<t;s++)for(let n=0;n<t;n++,i++){let t=4*i,n=e[t+0],o=e[t+1],d=e[t+2],u=0;128===n&&0===o&&0===d?n=0:n>=128&&(u=-16777216),l[i+s]=(65536*n+256*o+1*d+u)*r+a}for(let e=s*(s-1),t=0;t<s-1;t++,e++)l[e]=l[e-s];for(let e=s-1,t=0;t<s;t++,e+=s)l[e]=l[e-1];return l}(s,l,a),d=new _.Z(n),u=d.createTile(o),{vertices:c,triangles:p}=u.getMesh(i),g=function(e,t,i,r){let a=i+1,s=e.length/2,l=new Float32Array(3*s),n=new Float32Array(2*s),[o,d,u,c]=r||[0,0,i,i],p=(u-o)/i,g=(c-d)/i;for(let r=0;r<s;r++){let s=e[2*r],d=e[2*r+1],u=d*a+s;l[3*r+0]=s*p+o,l[3*r+1]=-d*g+c,l[3*r+2]=t[u],n[2*r+0]=s/i,n[2*r+1]=d/i}return{POSITION:{value:l,size:3},TEXCOORD_0:{value:n,size:2}}}(c,o,l,r);return{loaderData:{header:{}},header:{vertexCount:p.length,boundingBox:(0,k.v)(g)},mode:4,indices:{value:p,size:1},attributes:g}}(r,t.terrain)}let z="undefined"!=typeof __VERSION__?__VERSION__:"latest";var w=i(3254);let T={type:"object",value:null,validate:(e,t)=>t.optional&&null===e||"string"==typeof e||Array.isArray(e)&&e.every(e=>"string"==typeof e),equal:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;let i=e.length;if(i!==t.length)return!1;for(let r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}};function D(e,t){if(!e||!e.length)return null;let{index:i,id:r}=t;if(Array.isArray(e)){let t=Math.abs(r.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))%e.length;e=e[t]}let a=e;for(let e of Object.keys(i)){let t=RegExp("{".concat(e,"}"),"g");a=a.replace(t,String(i[e]))}return Number.isInteger(i.y)&&Number.isInteger(i.z)&&(a=a.replace(/\{-y\}/g,String(Math.pow(2,i.z)-i.y-1))),a}let L=[1],N={...w.Z.defaultProps,elevationData:T,texture:{...T,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{scaler:.01,offset:0}},workerUrl:{type:"string",value:null},wireframe:!1,material:!0,loaders:[{id:"terrain",name:"Terrain",version:z,extensions:["png","pngraw"],mimeTypes:["image/png"],options:{terrain:{bounds:null,meshMaxError:10,elevationDecoder:{scaler:.01,offset:0}}},parse:S}]};function A(e){return Array.isArray(e)?e.join(";"):e}class Z extends f.Z{updateState(e){let{props:t,oldProps:i}=e,r=t.elevationData!==i.elevationData;if(r){let{elevationData:e}=t,i=e&&(Array.isArray(e)||e.includes("{x}")&&e.includes("{y}"));this.setState({isTiled:i})}let a=r||t.meshMaxError!==i.meshMaxError||t.elevationDecoder!==i.elevationDecoder||t.bounds!==i.bounds;if(!this.state.isTiled&&a){let e=this.loadTerrain(t);this.setState({terrain:e})}t.workerUrl&&y.Z.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain(e){let{elevationData:t,bounds:i,elevationDecoder:r,meshMaxError:a,signal:s}=e;if(!t)return null;let l=this.getLoadOptions();l={...l,terrain:{skirtHeight:this.state.isTiled?2*a:0,...null==l?void 0:l.terrain,bounds:i,meshMaxError:a,elevationDecoder:r}};let{fetch:n}=this.props;return n(t,{propName:"elevationData",layer:this,loadOptions:l,signal:s})}getTiledTerrainData(e){let{elevationData:t,fetch:i,texture:r,elevationDecoder:a,meshMaxError:s}=this.props,{viewport:l}=this.context,n=D(t,e),o=D(r,e),{bbox:d,signal:u}=e,c=l.isGeospatial?l.projectFlat([d.west,d.south]):[d.left,d.bottom],p=l.isGeospatial?l.projectFlat([d.east,d.north]):[d.right,d.top],g=[c[0],c[1],p[0],p[1]],h=this.loadTerrain({elevationData:n,bounds:g,elevationDecoder:a,meshMaxError:s,signal:u}),m=o?i(o,{propName:"texture",layer:this,loaders:[],signal:u}).catch(e=>null):Promise.resolve(null);return Promise.all([h,m])}renderSubLayers(e){let t=this.getSubLayerClass("mesh",v.Z),{data:i,color:r}=e;if(!i)return null;let[a,s]=i;return new t(e,{data:L,mesh:a,texture:s,_instanced:!1,coordinateSystem:j.Df.CARTESIAN,getPosition:e=>[0,0,0],getColor:r})}onViewportLoad(e){if(!e)return;let{zRange:t}=this.state,i=e.map(e=>e.content).filter(Boolean).map(e=>{let t=e[0].header.boundingBox;return t.map(e=>e[2])});if(0===i.length)return;let r=Math.min(...i.map(e=>e[0])),a=Math.max(...i.map(e=>e[1]));(!t||r<t[0]||a>t[1])&&this.setState({zRange:[r,a]})}renderLayers(){let{color:e,material:t,elevationData:i,texture:r,wireframe:a,meshMaxError:s,elevationDecoder:l,tileSize:n,maxZoom:o,minZoom:d,extent:u,maxRequests:c,onTileLoad:p,onTileUnload:g,onTileError:h,maxCacheSize:m,maxCacheByteSize:b,refinementStrategy:x}=this.props;if(this.state.isTiled)return new w.Z(this.getSubLayerProps({id:"tiles"}),{wireframe:a,color:e,material:t,getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:A(i),texture:A(r),meshMaxError:s,elevationDecoder:l}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:n,maxZoom:o,minZoom:d,extent:u,maxRequests:c,onTileLoad:p,onTileUnload:g,onTileError:h,maxCacheSize:m,maxCacheByteSize:b,refinementStrategy:x});let f=this.getSubLayerClass("mesh",v.Z);return new f(this.getSubLayerProps({id:"mesh"}),{data:L,mesh:this.state.terrain,texture:r,_instanced:!1,getPosition:e=>[0,0,0],getColor:e,material:t,wireframe:a})}}Z.layerName="GsiTerrainLayer",Z.defaultProps=N;var C=i(3241);let O=[{id:"gsiTerrain",name:"地形（地理院DEM）",visible:!1,class:Z,props:{minZoom:1,maxZoom:14,elevationDecoder:{scaler:.01,offset:0},elevationData:"https://cyberjapandata.gsi.go.jp/xyz/dem_png/{z}/{x}/{y}.png",texture:"https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg"}},{id:"tile3dlayer-2022-lod1",name:"3D Tiles (2022, LOD1)",visible:!1,class:m.Z,props:{pointSize:1,data:"https://assets.cms.plateau.reearth.io/assets/4c/e3f483-4764-4484-820c-3cf5aca8861e/13100_tokyo23-ku_2022_3dtiles_1_1_op_bldg_13104_shinjuku-ku_lod1/tileset.json",loader:b.u,pickable:!0}},{id:"tile3dlayer-2022-lod2-notexture",name:"3D Tiles (2022, LOD2, テクスチャ無)",visible:!1,class:m.Z,props:{pointSize:1,data:"https://assets.cms.plateau.reearth.io/assets/4a/878097-66f2-4a39-b9fc-85ffee93dbdc/13100_tokyo23-ku_2022_3dtiles_1_1_op_bldg_13104_shinjuku-ku_lod2_no_texture/tileset.json",loader:b.u,pickable:!0}},{id:"tile3dlayer-2022-lod2-texture",name:"3D Tiles (2022, LOD2, テクスチャ有)",visible:!1,class:m.Z,props:{pointSize:1,data:"https://assets.cms.plateau.reearth.io/assets/57/e338bc-4e38-447c-a82e-0f4a7b075ed0/13100_tokyo23-ku_2022_3dtiles_1_1_op_bldg_13104_shinjuku-ku_lod2/tileset.json",loader:b.u,pickable:!0}},{id:"mvtlayer-indigo-2020-lod0",name:"MVT（2020, LOD0ベース）",visible:!1,class:h.Z,props:{data:"https://indigo-lab.github.io/plateau-tokyo23ku-building-mvt-2020/{z}/{x}/{y}.pbf",minZoom:0,maxZoom:23,getFillColor:[39,174,96,255],lineWidthMinPixels:1,pickable:!0,extruded:!0,autoHighlight:!0,highlightColor:[255,0,0],getElevation:e=>e.properties.measuredHeight,wireframe:!0,getLineColor:[0,0,0],material:{ambient:.1,diffuse:.9,shininess:32,specularColor:[0,87,115]}}},{id:"mvtlayer-indigo-2020-lod2",name:"MVT（2020, LOD2ベース）",visible:!1,class:h.Z,props:{data:"https://indigo-lab.github.io/plateau-lod2-mvt/{z}/{x}/{y}.pbf",minZoom:0,maxZoom:23,getFillColor:[41,128,185,255],lineWidthMinPixels:1,pickable:!0,extruded:!0,autoHighlight:!0,highlightColor:[255,0,0],getElevation:e=>e.properties.z,wireframe:!0,getLineColor:[0,0,0],material:{ambient:.1,diffuse:.9,shininess:32,specularColor:[0,87,115]}}},{id:"gltf-scenegraph",name:"glTF （2020）",visible:!1,class:C.Z,props:{data:[{coordinates:[139.74375,35.6625]}],scenegraph:"./deckgl/glb/tokyo_53393599.glb",getPosition:e=>e.coordinates,getOrientation:[0,0,90],sizeScale:1,_lighting:"pbr"}},{id:"i3sloader",name:"I3S, ArcGIS Online",visible:!1,class:m.Z,props:{pointSize:1,data:"https://tiles.arcgis.com/tiles/temc2YuHxLLsAi22/arcgis/rest/services/13101_chiyoda_ku/SceneServer/layers/0",loader:x.N,pickable:!0}}],E={gsipale:{type:"raster",tiles:["https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png"],minzoom:0,maxzoom:19,tileSize:256,attribution:"地理院タイル"},gsistd:{type:"raster",tiles:["https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png"],minzoom:0,maxzoom:19,tileSize:256,attribution:"地理院タイル"},gsiseamlessphoto:{type:"raster",tiles:["https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg"],minzoom:0,maxzoom:19,tileSize:256,attribution:"地理院タイル"}},M=Object.keys(E);function F(){let[e,t]=(0,a.useState)(),[i,n]=(0,a.useState)(M[0]),[d,u]=(0,a.useState)({});(0,a.useEffect)(()=>{u({version:8,sources:{...E},layers:[{id:"background",type:"raster",source:i}]})},[i]);let[h,m]=(0,a.useState)(O),[b,x]=(0,a.useState)([]);return(0,a.useEffect)(()=>{let e=h.map(e=>new e.class({...e.props,id:e.id,visible:e.visible}));x(e)},[h]),(0,r.jsxs)(s.Z,{initialViewState:g,controller:!0,layers:b,onClick:e=>{t(e)},children:[(0,r.jsx)(p,{clickInfo:e}),(0,r.jsx)(l.ZP,{mapLib:o(),style:{width:"100vw",height:"100vh"},mapStyle:d}),(0,r.jsx)(c,{backgroundNames:M,selectedBackground:i,setSelectedBackground:n,layerEntries:h,toggleLayerVisibility:e=>{let t=h.map(t=>t.id===e?{...t,visible:!t.visible}:t);m(t)}})]})}function P(){return(0,r.jsx)(F,{})}}},function(e){e.O(0,[369,18,253,488,744],function(){return e(e.s=5469)}),_N_E=e.O()}]);