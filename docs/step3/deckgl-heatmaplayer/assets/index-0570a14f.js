function IS(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var cz=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Hv={exports:{}},Ol={},jv={exports:{}},Q={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ia=Symbol.for("react.element"),MS=Symbol.for("react.portal"),RS=Symbol.for("react.fragment"),PS=Symbol.for("react.strict_mode"),LS=Symbol.for("react.profiler"),OS=Symbol.for("react.provider"),DS=Symbol.for("react.context"),FS=Symbol.for("react.forward_ref"),NS=Symbol.for("react.suspense"),US=Symbol.for("react.memo"),kS=Symbol.for("react.lazy"),rm=Symbol.iterator;function GS(t){return t===null||typeof t!="object"?null:(t=rm&&t[rm]||t["@@iterator"],typeof t=="function"?t:null)}var Wv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Jv=Object.assign,Xv={};function Bs(t,e,n){this.props=t,this.context=e,this.refs=Xv,this.updater=n||Wv}Bs.prototype.isReactComponent={};Bs.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Bs.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Kv(){}Kv.prototype=Bs.prototype;function Md(t,e,n){this.props=t,this.context=e,this.refs=Xv,this.updater=n||Wv}var Rd=Md.prototype=new Kv;Rd.constructor=Md;Jv(Rd,Bs.prototype);Rd.isPureReactComponent=!0;var im=Array.isArray,Yv=Object.prototype.hasOwnProperty,Pd={current:null},Qv={key:!0,ref:!0,__self:!0,__source:!0};function qv(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Yv.call(e,r)&&!Qv.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:ia,type:t,key:s,ref:o,props:i,_owner:Pd.current}}function VS(t,e){return{$$typeof:ia,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Ld(t){return typeof t=="object"&&t!==null&&t.$$typeof===ia}function zS(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var sm=/\/+/g;function Au(t,e){return typeof t=="object"&&t!==null&&t.key!=null?zS(""+t.key):e.toString(36)}function Tc(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case ia:case MS:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Au(o,0):r,im(i)?(n="",t!=null&&(n=t.replace(sm,"$&/")+"/"),Tc(i,e,n,"",function(l){return l})):i!=null&&(Ld(i)&&(i=VS(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(sm,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",im(t))for(var a=0;a<t.length;a++){s=t[a];var c=r+Au(s,a);o+=Tc(s,e,n,c,i)}else if(c=GS(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=r+Au(s,a++),o+=Tc(s,e,n,c,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function La(t,e,n){if(t==null)return t;var r=[],i=0;return Tc(t,r,"","",function(s){return e.call(n,s,i++)}),r}function HS(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var st={current:null},bc={transition:null},jS={ReactCurrentDispatcher:st,ReactCurrentBatchConfig:bc,ReactCurrentOwner:Pd};Q.Children={map:La,forEach:function(t,e,n){La(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return La(t,function(){e++}),e},toArray:function(t){return La(t,function(e){return e})||[]},only:function(t){if(!Ld(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Q.Component=Bs;Q.Fragment=RS;Q.Profiler=LS;Q.PureComponent=Md;Q.StrictMode=PS;Q.Suspense=NS;Q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jS;Q.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Jv({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Pd.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)Yv.call(e,c)&&!Qv.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:ia,type:t.type,key:i,ref:s,props:r,_owner:o}};Q.createContext=function(t){return t={$$typeof:DS,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:OS,_context:t},t.Consumer=t};Q.createElement=qv;Q.createFactory=function(t){var e=qv.bind(null,t);return e.type=t,e};Q.createRef=function(){return{current:null}};Q.forwardRef=function(t){return{$$typeof:FS,render:t}};Q.isValidElement=Ld;Q.lazy=function(t){return{$$typeof:kS,_payload:{_status:-1,_result:t},_init:HS}};Q.memo=function(t,e){return{$$typeof:US,type:t,compare:e===void 0?null:e}};Q.startTransition=function(t){var e=bc.transition;bc.transition={};try{t()}finally{bc.transition=e}};Q.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Q.useCallback=function(t,e){return st.current.useCallback(t,e)};Q.useContext=function(t){return st.current.useContext(t)};Q.useDebugValue=function(){};Q.useDeferredValue=function(t){return st.current.useDeferredValue(t)};Q.useEffect=function(t,e){return st.current.useEffect(t,e)};Q.useId=function(){return st.current.useId()};Q.useImperativeHandle=function(t,e,n){return st.current.useImperativeHandle(t,e,n)};Q.useInsertionEffect=function(t,e){return st.current.useInsertionEffect(t,e)};Q.useLayoutEffect=function(t,e){return st.current.useLayoutEffect(t,e)};Q.useMemo=function(t,e){return st.current.useMemo(t,e)};Q.useReducer=function(t,e,n){return st.current.useReducer(t,e,n)};Q.useRef=function(t){return st.current.useRef(t)};Q.useState=function(t){return st.current.useState(t)};Q.useSyncExternalStore=function(t,e,n){return st.current.useSyncExternalStore(t,e,n)};Q.useTransition=function(){return st.current.useTransition()};Q.version="18.2.0";jv.exports=Q;var F=jv.exports;const WS=zv(F);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JS=F,XS=Symbol.for("react.element"),KS=Symbol.for("react.fragment"),YS=Object.prototype.hasOwnProperty,QS=JS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qS={key:!0,ref:!0,__self:!0,__source:!0};function Zv(t,e,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)YS.call(e,r)&&!qS.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:XS,type:t,key:s,ref:o,props:i,_owner:QS.current}}Ol.Fragment=KS;Ol.jsx=Zv;Ol.jsxs=Zv;Hv.exports=Ol;var Fe=Hv.exports,Xh={},$v={exports:{}},It={},eA={exports:{}},tA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(U,H){var j=U.length;U.push(H);e:for(;0<j;){var he=j-1>>>1,fe=U[he];if(0<i(fe,H))U[he]=H,U[j]=fe,j=he;else break e}}function n(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var H=U[0],j=U.pop();if(j!==H){U[0]=j;e:for(var he=0,fe=U.length,ar=fe>>>1;he<ar;){var Yt=2*(he+1)-1,Ls=U[Yt],Ln=Yt+1,Ce=U[Ln];if(0>i(Ls,j))Ln<fe&&0>i(Ce,Ls)?(U[he]=Ce,U[Ln]=j,he=Ln):(U[he]=Ls,U[Yt]=j,he=Yt);else if(Ln<fe&&0>i(Ce,j))U[he]=Ce,U[Ln]=j,he=Ln;else break e}}return H}function i(U,H){var j=U.sortIndex-H.sortIndex;return j!==0?j:U.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,h=null,f=3,g=!1,p=!1,A=!1,b=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(U){for(var H=n(l);H!==null;){if(H.callback===null)r(l);else if(H.startTime<=U)r(l),H.sortIndex=H.expirationTime,e(c,H);else break;H=n(l)}}function T(U){if(A=!1,v(U),!p)if(n(c)!==null)p=!0,Pn(w);else{var H=n(l);H!==null&&dn(T,H.startTime-U)}}function w(U,H){p=!1,A&&(A=!1,_(M),M=-1),g=!0;var j=f;try{for(v(H),h=n(c);h!==null&&(!(h.expirationTime>H)||U&&!z());){var he=h.callback;if(typeof he=="function"){h.callback=null,f=h.priorityLevel;var fe=he(h.expirationTime<=H);H=t.unstable_now(),typeof fe=="function"?h.callback=fe:h===n(c)&&r(c),v(H)}else r(c);h=n(c)}if(h!==null)var ar=!0;else{var Yt=n(l);Yt!==null&&dn(T,Yt.startTime-H),ar=!1}return ar}finally{h=null,f=j,g=!1}}var x=!1,I=null,M=-1,L=5,R=-1;function z(){return!(t.unstable_now()-R<L)}function te(){if(I!==null){var U=t.unstable_now();R=U;var H=!0;try{H=I(!0,U)}finally{H?ne():(x=!1,I=null)}}else x=!1}var ne;if(typeof m=="function")ne=function(){m(te)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,Rt=X.port2;X.port1.onmessage=te,ne=function(){Rt.postMessage(null)}}else ne=function(){b(te,0)};function Pn(U){I=U,x||(x=!0,ne())}function dn(U,H){M=b(function(){U(t.unstable_now())},H)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_continueExecution=function(){p||g||(p=!0,Pn(w))},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(U){switch(f){case 1:case 2:case 3:var H=3;break;default:H=f}var j=f;f=H;try{return U()}finally{f=j}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(U,H){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var j=f;f=U;try{return H()}finally{f=j}},t.unstable_scheduleCallback=function(U,H,j){var he=t.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?he+j:he):j=he,U){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=j+fe,U={id:u++,callback:H,priorityLevel:U,startTime:j,expirationTime:fe,sortIndex:-1},j>he?(U.sortIndex=j,e(l,U),n(c)===null&&U===n(l)&&(A?(_(M),M=-1):A=!0,dn(T,j-he))):(U.sortIndex=fe,e(c,U),p||g||(p=!0,Pn(w))),U},t.unstable_shouldYield=z,t.unstable_wrapCallback=function(U){var H=f;return function(){var j=f;f=H;try{return U.apply(this,arguments)}finally{f=j}}}})(tA);eA.exports=tA;var ZS=eA.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nA=F,Bt=ZS;function O(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var rA=new Set,Ro={};function mi(t,e){hs(t,e),hs(t+"Capture",e)}function hs(t,e){for(Ro[t]=e,t=0;t<e.length;t++)rA.add(e[t])}var qn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Kh=Object.prototype.hasOwnProperty,$S=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,om={},am={};function ew(t){return Kh.call(am,t)?!0:Kh.call(om,t)?!1:$S.test(t)?am[t]=!0:(om[t]=!0,!1)}function tw(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function nw(t,e,n,r){if(e===null||typeof e>"u"||tw(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ot(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var je={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){je[t]=new ot(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];je[e]=new ot(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){je[t]=new ot(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){je[t]=new ot(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){je[t]=new ot(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){je[t]=new ot(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){je[t]=new ot(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){je[t]=new ot(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){je[t]=new ot(t,5,!1,t.toLowerCase(),null,!1,!1)});var Od=/[\-:]([a-z])/g;function Dd(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Od,Dd);je[e]=new ot(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Od,Dd);je[e]=new ot(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Od,Dd);je[e]=new ot(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){je[t]=new ot(t,1,!1,t.toLowerCase(),null,!1,!1)});je.xlinkHref=new ot("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){je[t]=new ot(t,1,!1,t.toLowerCase(),null,!0,!0)});function Fd(t,e,n,r){var i=je.hasOwnProperty(e)?je[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(nw(e,n,i,r)&&(n=null),r||i===null?ew(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var ir=nA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Oa=Symbol.for("react.element"),Ui=Symbol.for("react.portal"),ki=Symbol.for("react.fragment"),Nd=Symbol.for("react.strict_mode"),Yh=Symbol.for("react.profiler"),iA=Symbol.for("react.provider"),sA=Symbol.for("react.context"),Ud=Symbol.for("react.forward_ref"),Qh=Symbol.for("react.suspense"),qh=Symbol.for("react.suspense_list"),kd=Symbol.for("react.memo"),_r=Symbol.for("react.lazy"),oA=Symbol.for("react.offscreen"),cm=Symbol.iterator;function Vs(t){return t===null||typeof t!="object"?null:(t=cm&&t[cm]||t["@@iterator"],typeof t=="function"?t:null)}var Ae=Object.assign,Eu;function co(t){if(Eu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Eu=e&&e[1]||""}return`
`+Eu+t}var Tu=!1;function bu(t,e){if(!t||Tu)return"";Tu=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){r=l}t.call(e.prototype)}else{try{throw Error()}catch(l){r=l}t()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var c=`
`+i[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{Tu=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?co(t):""}function rw(t){switch(t.tag){case 5:return co(t.type);case 16:return co("Lazy");case 13:return co("Suspense");case 19:return co("SuspenseList");case 0:case 2:case 15:return t=bu(t.type,!1),t;case 11:return t=bu(t.type.render,!1),t;case 1:return t=bu(t.type,!0),t;default:return""}}function Zh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ki:return"Fragment";case Ui:return"Portal";case Yh:return"Profiler";case Nd:return"StrictMode";case Qh:return"Suspense";case qh:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case sA:return(t.displayName||"Context")+".Consumer";case iA:return(t._context.displayName||"Context")+".Provider";case Ud:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case kd:return e=t.displayName||null,e!==null?e:Zh(t.type)||"Memo";case _r:e=t._payload,t=t._init;try{return Zh(t(e))}catch{}}return null}function iw(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Zh(e);case 8:return e===Nd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Or(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function aA(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function sw(t){var e=aA(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Da(t){t._valueTracker||(t._valueTracker=sw(t))}function cA(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=aA(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function jc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function $h(t,e){var n=e.checked;return Ae({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function lm(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Or(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function lA(t,e){e=e.checked,e!=null&&Fd(t,"checked",e,!1)}function ef(t,e){lA(t,e);var n=Or(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?tf(t,e.type,n):e.hasOwnProperty("defaultValue")&&tf(t,e.type,Or(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function um(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function tf(t,e,n){(e!=="number"||jc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var lo=Array.isArray;function es(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Or(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function nf(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(O(91));return Ae({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function hm(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(O(92));if(lo(n)){if(1<n.length)throw Error(O(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Or(n)}}function uA(t,e){var n=Or(e.value),r=Or(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function fm(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function hA(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rf(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?hA(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Fa,fA=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Fa=Fa||document.createElement("div"),Fa.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Fa.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Po(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var mo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ow=["Webkit","ms","Moz","O"];Object.keys(mo).forEach(function(t){ow.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),mo[e]=mo[t]})});function dA(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||mo.hasOwnProperty(t)&&mo[t]?(""+e).trim():e+"px"}function gA(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=dA(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var aw=Ae({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sf(t,e){if(e){if(aw[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(O(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(O(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(O(61))}if(e.style!=null&&typeof e.style!="object")throw Error(O(62))}}function of(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var af=null;function Gd(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var cf=null,ts=null,ns=null;function dm(t){if(t=aa(t)){if(typeof cf!="function")throw Error(O(280));var e=t.stateNode;e&&(e=kl(e),cf(t.stateNode,t.type,e))}}function pA(t){ts?ns?ns.push(t):ns=[t]:ts=t}function mA(){if(ts){var t=ts,e=ns;if(ns=ts=null,dm(t),e)for(t=0;t<e.length;t++)dm(e[t])}}function _A(t,e){return t(e)}function yA(){}var Su=!1;function vA(t,e,n){if(Su)return t(e,n);Su=!0;try{return _A(t,e,n)}finally{Su=!1,(ts!==null||ns!==null)&&(yA(),mA())}}function Lo(t,e){var n=t.stateNode;if(n===null)return null;var r=kl(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(O(231,e,typeof n));return n}var lf=!1;if(qn)try{var zs={};Object.defineProperty(zs,"passive",{get:function(){lf=!0}}),window.addEventListener("test",zs,zs),window.removeEventListener("test",zs,zs)}catch{lf=!1}function cw(t,e,n,r,i,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var _o=!1,Wc=null,Jc=!1,uf=null,lw={onError:function(t){_o=!0,Wc=t}};function uw(t,e,n,r,i,s,o,a,c){_o=!1,Wc=null,cw.apply(lw,arguments)}function hw(t,e,n,r,i,s,o,a,c){if(uw.apply(this,arguments),_o){if(_o){var l=Wc;_o=!1,Wc=null}else throw Error(O(198));Jc||(Jc=!0,uf=l)}}function _i(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function AA(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function gm(t){if(_i(t)!==t)throw Error(O(188))}function fw(t){var e=t.alternate;if(!e){if(e=_i(t),e===null)throw Error(O(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return gm(i),t;if(s===r)return gm(i),e;s=s.sibling}throw Error(O(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(O(189))}}if(n.alternate!==r)throw Error(O(190))}if(n.tag!==3)throw Error(O(188));return n.stateNode.current===n?t:e}function EA(t){return t=fw(t),t!==null?TA(t):null}function TA(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=TA(t);if(e!==null)return e;t=t.sibling}return null}var bA=Bt.unstable_scheduleCallback,pm=Bt.unstable_cancelCallback,dw=Bt.unstable_shouldYield,gw=Bt.unstable_requestPaint,we=Bt.unstable_now,pw=Bt.unstable_getCurrentPriorityLevel,Vd=Bt.unstable_ImmediatePriority,SA=Bt.unstable_UserBlockingPriority,Xc=Bt.unstable_NormalPriority,mw=Bt.unstable_LowPriority,wA=Bt.unstable_IdlePriority,Dl=null,In=null;function _w(t){if(In&&typeof In.onCommitFiberRoot=="function")try{In.onCommitFiberRoot(Dl,t,void 0,(t.current.flags&128)===128)}catch{}}var an=Math.clz32?Math.clz32:Aw,yw=Math.log,vw=Math.LN2;function Aw(t){return t>>>=0,t===0?32:31-(yw(t)/vw|0)|0}var Na=64,Ua=4194304;function uo(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Kc(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=uo(a):(s&=o,s!==0&&(r=uo(s)))}else o=n&~i,o!==0?r=uo(o):s!==0&&(r=uo(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-an(e),i=1<<n,r|=t[n],e&=~i;return r}function Ew(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Tw(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-an(s),a=1<<o,c=i[o];c===-1?(!(a&n)||a&r)&&(i[o]=Ew(a,e)):c<=e&&(t.expiredLanes|=a),s&=~a}}function hf(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function CA(){var t=Na;return Na<<=1,!(Na&4194240)&&(Na=64),t}function wu(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function sa(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-an(e),t[e]=n}function bw(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-an(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function zd(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-an(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var oe=0;function xA(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var BA,Hd,IA,MA,RA,ff=!1,ka=[],Sr=null,wr=null,Cr=null,Oo=new Map,Do=new Map,vr=[],Sw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function mm(t,e){switch(t){case"focusin":case"focusout":Sr=null;break;case"dragenter":case"dragleave":wr=null;break;case"mouseover":case"mouseout":Cr=null;break;case"pointerover":case"pointerout":Oo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Do.delete(e.pointerId)}}function Hs(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=aa(e),e!==null&&Hd(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function ww(t,e,n,r,i){switch(e){case"focusin":return Sr=Hs(Sr,t,e,n,r,i),!0;case"dragenter":return wr=Hs(wr,t,e,n,r,i),!0;case"mouseover":return Cr=Hs(Cr,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return Oo.set(s,Hs(Oo.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Do.set(s,Hs(Do.get(s)||null,t,e,n,r,i)),!0}return!1}function PA(t){var e=Zr(t.target);if(e!==null){var n=_i(e);if(n!==null){if(e=n.tag,e===13){if(e=AA(n),e!==null){t.blockedOn=e,RA(t.priority,function(){IA(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Sc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=df(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);af=r,n.target.dispatchEvent(r),af=null}else return e=aa(n),e!==null&&Hd(e),t.blockedOn=n,!1;e.shift()}return!0}function _m(t,e,n){Sc(t)&&n.delete(e)}function Cw(){ff=!1,Sr!==null&&Sc(Sr)&&(Sr=null),wr!==null&&Sc(wr)&&(wr=null),Cr!==null&&Sc(Cr)&&(Cr=null),Oo.forEach(_m),Do.forEach(_m)}function js(t,e){t.blockedOn===e&&(t.blockedOn=null,ff||(ff=!0,Bt.unstable_scheduleCallback(Bt.unstable_NormalPriority,Cw)))}function Fo(t){function e(i){return js(i,t)}if(0<ka.length){js(ka[0],t);for(var n=1;n<ka.length;n++){var r=ka[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Sr!==null&&js(Sr,t),wr!==null&&js(wr,t),Cr!==null&&js(Cr,t),Oo.forEach(e),Do.forEach(e),n=0;n<vr.length;n++)r=vr[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<vr.length&&(n=vr[0],n.blockedOn===null);)PA(n),n.blockedOn===null&&vr.shift()}var rs=ir.ReactCurrentBatchConfig,Yc=!0;function xw(t,e,n,r){var i=oe,s=rs.transition;rs.transition=null;try{oe=1,jd(t,e,n,r)}finally{oe=i,rs.transition=s}}function Bw(t,e,n,r){var i=oe,s=rs.transition;rs.transition=null;try{oe=4,jd(t,e,n,r)}finally{oe=i,rs.transition=s}}function jd(t,e,n,r){if(Yc){var i=df(t,e,n,r);if(i===null)Du(t,e,r,Qc,n),mm(t,r);else if(ww(i,t,e,n,r))r.stopPropagation();else if(mm(t,r),e&4&&-1<Sw.indexOf(t)){for(;i!==null;){var s=aa(i);if(s!==null&&BA(s),s=df(t,e,n,r),s===null&&Du(t,e,r,Qc,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else Du(t,e,r,null,n)}}var Qc=null;function df(t,e,n,r){if(Qc=null,t=Gd(r),t=Zr(t),t!==null)if(e=_i(t),e===null)t=null;else if(n=e.tag,n===13){if(t=AA(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Qc=t,null}function LA(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(pw()){case Vd:return 1;case SA:return 4;case Xc:case mw:return 16;case wA:return 536870912;default:return 16}default:return 16}}var Er=null,Wd=null,wc=null;function OA(){if(wc)return wc;var t,e=Wd,n=e.length,r,i="value"in Er?Er.value:Er.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return wc=i.slice(t,1<r?1-r:void 0)}function Cc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ga(){return!0}function ym(){return!1}function Mt(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Ga:ym,this.isPropagationStopped=ym,this}return Ae(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ga)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ga)},persist:function(){},isPersistent:Ga}),e}var Is={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jd=Mt(Is),oa=Ae({},Is,{view:0,detail:0}),Iw=Mt(oa),Cu,xu,Ws,Fl=Ae({},oa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Xd,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ws&&(Ws&&t.type==="mousemove"?(Cu=t.screenX-Ws.screenX,xu=t.screenY-Ws.screenY):xu=Cu=0,Ws=t),Cu)},movementY:function(t){return"movementY"in t?t.movementY:xu}}),vm=Mt(Fl),Mw=Ae({},Fl,{dataTransfer:0}),Rw=Mt(Mw),Pw=Ae({},oa,{relatedTarget:0}),Bu=Mt(Pw),Lw=Ae({},Is,{animationName:0,elapsedTime:0,pseudoElement:0}),Ow=Mt(Lw),Dw=Ae({},Is,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Fw=Mt(Dw),Nw=Ae({},Is,{data:0}),Am=Mt(Nw),Uw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vw(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Gw[t])?!!e[t]:!1}function Xd(){return Vw}var zw=Ae({},oa,{key:function(t){if(t.key){var e=Uw[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Cc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?kw[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Xd,charCode:function(t){return t.type==="keypress"?Cc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Cc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Hw=Mt(zw),jw=Ae({},Fl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Em=Mt(jw),Ww=Ae({},oa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Xd}),Jw=Mt(Ww),Xw=Ae({},Is,{propertyName:0,elapsedTime:0,pseudoElement:0}),Kw=Mt(Xw),Yw=Ae({},Fl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Qw=Mt(Yw),qw=[9,13,27,32],Kd=qn&&"CompositionEvent"in window,yo=null;qn&&"documentMode"in document&&(yo=document.documentMode);var Zw=qn&&"TextEvent"in window&&!yo,DA=qn&&(!Kd||yo&&8<yo&&11>=yo),Tm=String.fromCharCode(32),bm=!1;function FA(t,e){switch(t){case"keyup":return qw.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function NA(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Gi=!1;function $w(t,e){switch(t){case"compositionend":return NA(e);case"keypress":return e.which!==32?null:(bm=!0,Tm);case"textInput":return t=e.data,t===Tm&&bm?null:t;default:return null}}function eC(t,e){if(Gi)return t==="compositionend"||!Kd&&FA(t,e)?(t=OA(),wc=Wd=Er=null,Gi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return DA&&e.locale!=="ko"?null:e.data;default:return null}}var tC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Sm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!tC[t.type]:e==="textarea"}function UA(t,e,n,r){pA(r),e=qc(e,"onChange"),0<e.length&&(n=new Jd("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var vo=null,No=null;function nC(t){YA(t,0)}function Nl(t){var e=Hi(t);if(cA(e))return t}function rC(t,e){if(t==="change")return e}var kA=!1;if(qn){var Iu;if(qn){var Mu="oninput"in document;if(!Mu){var wm=document.createElement("div");wm.setAttribute("oninput","return;"),Mu=typeof wm.oninput=="function"}Iu=Mu}else Iu=!1;kA=Iu&&(!document.documentMode||9<document.documentMode)}function Cm(){vo&&(vo.detachEvent("onpropertychange",GA),No=vo=null)}function GA(t){if(t.propertyName==="value"&&Nl(No)){var e=[];UA(e,No,t,Gd(t)),vA(nC,e)}}function iC(t,e,n){t==="focusin"?(Cm(),vo=e,No=n,vo.attachEvent("onpropertychange",GA)):t==="focusout"&&Cm()}function sC(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Nl(No)}function oC(t,e){if(t==="click")return Nl(e)}function aC(t,e){if(t==="input"||t==="change")return Nl(e)}function cC(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var un=typeof Object.is=="function"?Object.is:cC;function Uo(t,e){if(un(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Kh.call(e,i)||!un(t[i],e[i]))return!1}return!0}function xm(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Bm(t,e){var n=xm(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=xm(n)}}function VA(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?VA(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function zA(){for(var t=window,e=jc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=jc(t.document)}return e}function Yd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function lC(t){var e=zA(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&VA(n.ownerDocument.documentElement,n)){if(r!==null&&Yd(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=Bm(n,s);var o=Bm(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var uC=qn&&"documentMode"in document&&11>=document.documentMode,Vi=null,gf=null,Ao=null,pf=!1;function Im(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;pf||Vi==null||Vi!==jc(r)||(r=Vi,"selectionStart"in r&&Yd(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ao&&Uo(Ao,r)||(Ao=r,r=qc(gf,"onSelect"),0<r.length&&(e=new Jd("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Vi)))}function Va(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var zi={animationend:Va("Animation","AnimationEnd"),animationiteration:Va("Animation","AnimationIteration"),animationstart:Va("Animation","AnimationStart"),transitionend:Va("Transition","TransitionEnd")},Ru={},HA={};qn&&(HA=document.createElement("div").style,"AnimationEvent"in window||(delete zi.animationend.animation,delete zi.animationiteration.animation,delete zi.animationstart.animation),"TransitionEvent"in window||delete zi.transitionend.transition);function Ul(t){if(Ru[t])return Ru[t];if(!zi[t])return t;var e=zi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in HA)return Ru[t]=e[n];return t}var jA=Ul("animationend"),WA=Ul("animationiteration"),JA=Ul("animationstart"),XA=Ul("transitionend"),KA=new Map,Mm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ur(t,e){KA.set(t,e),mi(e,[t])}for(var Pu=0;Pu<Mm.length;Pu++){var Lu=Mm[Pu],hC=Lu.toLowerCase(),fC=Lu[0].toUpperCase()+Lu.slice(1);Ur(hC,"on"+fC)}Ur(jA,"onAnimationEnd");Ur(WA,"onAnimationIteration");Ur(JA,"onAnimationStart");Ur("dblclick","onDoubleClick");Ur("focusin","onFocus");Ur("focusout","onBlur");Ur(XA,"onTransitionEnd");hs("onMouseEnter",["mouseout","mouseover"]);hs("onMouseLeave",["mouseout","mouseover"]);hs("onPointerEnter",["pointerout","pointerover"]);hs("onPointerLeave",["pointerout","pointerover"]);mi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));mi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));mi("onBeforeInput",["compositionend","keypress","textInput","paste"]);mi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));mi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));mi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ho="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),dC=new Set("cancel close invalid load scroll toggle".split(" ").concat(ho));function Rm(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,hw(r,e,void 0,t),t.currentTarget=null}function YA(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&i.isPropagationStopped())break e;Rm(i,a,l),s=c}else for(o=0;o<r.length;o++){if(a=r[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&i.isPropagationStopped())break e;Rm(i,a,l),s=c}}}if(Jc)throw t=uf,Jc=!1,uf=null,t}function ge(t,e){var n=e[Af];n===void 0&&(n=e[Af]=new Set);var r=t+"__bubble";n.has(r)||(QA(e,t,2,!1),n.add(r))}function Ou(t,e,n){var r=0;e&&(r|=4),QA(n,t,r,e)}var za="_reactListening"+Math.random().toString(36).slice(2);function ko(t){if(!t[za]){t[za]=!0,rA.forEach(function(n){n!=="selectionchange"&&(dC.has(n)||Ou(n,!1,t),Ou(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[za]||(e[za]=!0,Ou("selectionchange",!1,e))}}function QA(t,e,n,r){switch(LA(e)){case 1:var i=xw;break;case 4:i=Bw;break;default:i=jd}n=i.bind(null,e,n,t),i=void 0,!lf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Du(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Zr(a),o===null)return;if(c=o.tag,c===5||c===6){r=s=o;continue e}a=a.parentNode}}r=r.return}vA(function(){var l=s,u=Gd(n),h=[];e:{var f=KA.get(t);if(f!==void 0){var g=Jd,p=t;switch(t){case"keypress":if(Cc(n)===0)break e;case"keydown":case"keyup":g=Hw;break;case"focusin":p="focus",g=Bu;break;case"focusout":p="blur",g=Bu;break;case"beforeblur":case"afterblur":g=Bu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=vm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=Rw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=Jw;break;case jA:case WA:case JA:g=Ow;break;case XA:g=Kw;break;case"scroll":g=Iw;break;case"wheel":g=Qw;break;case"copy":case"cut":case"paste":g=Fw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=Em}var A=(e&4)!==0,b=!A&&t==="scroll",_=A?f!==null?f+"Capture":null:f;A=[];for(var m=l,v;m!==null;){v=m;var T=v.stateNode;if(v.tag===5&&T!==null&&(v=T,_!==null&&(T=Lo(m,_),T!=null&&A.push(Go(m,T,v)))),b)break;m=m.return}0<A.length&&(f=new g(f,p,null,n,u),h.push({event:f,listeners:A}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",g=t==="mouseout"||t==="pointerout",f&&n!==af&&(p=n.relatedTarget||n.fromElement)&&(Zr(p)||p[Zn]))break e;if((g||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,g?(p=n.relatedTarget||n.toElement,g=l,p=p?Zr(p):null,p!==null&&(b=_i(p),p!==b||p.tag!==5&&p.tag!==6)&&(p=null)):(g=null,p=l),g!==p)){if(A=vm,T="onMouseLeave",_="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(A=Em,T="onPointerLeave",_="onPointerEnter",m="pointer"),b=g==null?f:Hi(g),v=p==null?f:Hi(p),f=new A(T,m+"leave",g,n,u),f.target=b,f.relatedTarget=v,T=null,Zr(u)===l&&(A=new A(_,m+"enter",p,n,u),A.target=v,A.relatedTarget=b,T=A),b=T,g&&p)t:{for(A=g,_=p,m=0,v=A;v;v=Si(v))m++;for(v=0,T=_;T;T=Si(T))v++;for(;0<m-v;)A=Si(A),m--;for(;0<v-m;)_=Si(_),v--;for(;m--;){if(A===_||_!==null&&A===_.alternate)break t;A=Si(A),_=Si(_)}A=null}else A=null;g!==null&&Pm(h,f,g,A,!1),p!==null&&b!==null&&Pm(h,b,p,A,!0)}}e:{if(f=l?Hi(l):window,g=f.nodeName&&f.nodeName.toLowerCase(),g==="select"||g==="input"&&f.type==="file")var w=rC;else if(Sm(f))if(kA)w=aC;else{w=sC;var x=iC}else(g=f.nodeName)&&g.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(w=oC);if(w&&(w=w(t,l))){UA(h,w,n,u);break e}x&&x(t,f,l),t==="focusout"&&(x=f._wrapperState)&&x.controlled&&f.type==="number"&&tf(f,"number",f.value)}switch(x=l?Hi(l):window,t){case"focusin":(Sm(x)||x.contentEditable==="true")&&(Vi=x,gf=l,Ao=null);break;case"focusout":Ao=gf=Vi=null;break;case"mousedown":pf=!0;break;case"contextmenu":case"mouseup":case"dragend":pf=!1,Im(h,n,u);break;case"selectionchange":if(uC)break;case"keydown":case"keyup":Im(h,n,u)}var I;if(Kd)e:{switch(t){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else Gi?FA(t,n)&&(M="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(M="onCompositionStart");M&&(DA&&n.locale!=="ko"&&(Gi||M!=="onCompositionStart"?M==="onCompositionEnd"&&Gi&&(I=OA()):(Er=u,Wd="value"in Er?Er.value:Er.textContent,Gi=!0)),x=qc(l,M),0<x.length&&(M=new Am(M,t,null,n,u),h.push({event:M,listeners:x}),I?M.data=I:(I=NA(n),I!==null&&(M.data=I)))),(I=Zw?$w(t,n):eC(t,n))&&(l=qc(l,"onBeforeInput"),0<l.length&&(u=new Am("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:l}),u.data=I))}YA(h,e)})}function Go(t,e,n){return{instance:t,listener:e,currentTarget:n}}function qc(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Lo(t,n),s!=null&&r.unshift(Go(t,s,i)),s=Lo(t,e),s!=null&&r.push(Go(t,s,i))),t=t.return}return r}function Si(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Pm(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&l!==null&&(a=l,i?(c=Lo(n,s),c!=null&&o.unshift(Go(n,c,a))):i||(c=Lo(n,s),c!=null&&o.push(Go(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var gC=/\r\n?/g,pC=/\u0000|\uFFFD/g;function Lm(t){return(typeof t=="string"?t:""+t).replace(gC,`
`).replace(pC,"")}function Ha(t,e,n){if(e=Lm(e),Lm(t)!==e&&n)throw Error(O(425))}function Zc(){}var mf=null,_f=null;function yf(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var vf=typeof setTimeout=="function"?setTimeout:void 0,mC=typeof clearTimeout=="function"?clearTimeout:void 0,Om=typeof Promise=="function"?Promise:void 0,_C=typeof queueMicrotask=="function"?queueMicrotask:typeof Om<"u"?function(t){return Om.resolve(null).then(t).catch(yC)}:vf;function yC(t){setTimeout(function(){throw t})}function Fu(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Fo(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Fo(e)}function xr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Dm(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ms=Math.random().toString(36).slice(2),bn="__reactFiber$"+Ms,Vo="__reactProps$"+Ms,Zn="__reactContainer$"+Ms,Af="__reactEvents$"+Ms,vC="__reactListeners$"+Ms,AC="__reactHandles$"+Ms;function Zr(t){var e=t[bn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Zn]||n[bn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Dm(t);t!==null;){if(n=t[bn])return n;t=Dm(t)}return e}t=n,n=t.parentNode}return null}function aa(t){return t=t[bn]||t[Zn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Hi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(O(33))}function kl(t){return t[Vo]||null}var Ef=[],ji=-1;function kr(t){return{current:t}}function pe(t){0>ji||(t.current=Ef[ji],Ef[ji]=null,ji--)}function ue(t,e){ji++,Ef[ji]=t.current,t.current=e}var Dr={},Ze=kr(Dr),dt=kr(!1),ai=Dr;function fs(t,e){var n=t.type.contextTypes;if(!n)return Dr;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function gt(t){return t=t.childContextTypes,t!=null}function $c(){pe(dt),pe(Ze)}function Fm(t,e,n){if(Ze.current!==Dr)throw Error(O(168));ue(Ze,e),ue(dt,n)}function qA(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(O(108,iw(t)||"Unknown",i));return Ae({},n,r)}function el(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Dr,ai=Ze.current,ue(Ze,t),ue(dt,dt.current),!0}function Nm(t,e,n){var r=t.stateNode;if(!r)throw Error(O(169));n?(t=qA(t,e,ai),r.__reactInternalMemoizedMergedChildContext=t,pe(dt),pe(Ze),ue(Ze,t)):pe(dt),ue(dt,n)}var Gn=null,Gl=!1,Nu=!1;function ZA(t){Gn===null?Gn=[t]:Gn.push(t)}function EC(t){Gl=!0,ZA(t)}function Gr(){if(!Nu&&Gn!==null){Nu=!0;var t=0,e=oe;try{var n=Gn;for(oe=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Gn=null,Gl=!1}catch(i){throw Gn!==null&&(Gn=Gn.slice(t+1)),bA(Vd,Gr),i}finally{oe=e,Nu=!1}}return null}var Wi=[],Ji=0,tl=null,nl=0,Ut=[],kt=0,ci=null,Hn=1,jn="";function Yr(t,e){Wi[Ji++]=nl,Wi[Ji++]=tl,tl=t,nl=e}function $A(t,e,n){Ut[kt++]=Hn,Ut[kt++]=jn,Ut[kt++]=ci,ci=t;var r=Hn;t=jn;var i=32-an(r)-1;r&=~(1<<i),n+=1;var s=32-an(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Hn=1<<32-an(e)+i|n<<i|r,jn=s+t}else Hn=1<<s|n<<i|r,jn=t}function Qd(t){t.return!==null&&(Yr(t,1),$A(t,1,0))}function qd(t){for(;t===tl;)tl=Wi[--Ji],Wi[Ji]=null,nl=Wi[--Ji],Wi[Ji]=null;for(;t===ci;)ci=Ut[--kt],Ut[kt]=null,jn=Ut[--kt],Ut[kt]=null,Hn=Ut[--kt],Ut[kt]=null}var Ct=null,St=null,me=!1,tn=null;function eE(t,e){var n=Gt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Um(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Ct=t,St=xr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Ct=t,St=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ci!==null?{id:Hn,overflow:jn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Gt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Ct=t,St=null,!0):!1;default:return!1}}function Tf(t){return(t.mode&1)!==0&&(t.flags&128)===0}function bf(t){if(me){var e=St;if(e){var n=e;if(!Um(t,e)){if(Tf(t))throw Error(O(418));e=xr(n.nextSibling);var r=Ct;e&&Um(t,e)?eE(r,n):(t.flags=t.flags&-4097|2,me=!1,Ct=t)}}else{if(Tf(t))throw Error(O(418));t.flags=t.flags&-4097|2,me=!1,Ct=t}}}function km(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Ct=t}function ja(t){if(t!==Ct)return!1;if(!me)return km(t),me=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!yf(t.type,t.memoizedProps)),e&&(e=St)){if(Tf(t))throw tE(),Error(O(418));for(;e;)eE(t,e),e=xr(e.nextSibling)}if(km(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(O(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){St=xr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}St=null}}else St=Ct?xr(t.stateNode.nextSibling):null;return!0}function tE(){for(var t=St;t;)t=xr(t.nextSibling)}function ds(){St=Ct=null,me=!1}function Zd(t){tn===null?tn=[t]:tn.push(t)}var TC=ir.ReactCurrentBatchConfig;function $t(t,e){if(t&&t.defaultProps){e=Ae({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var rl=kr(null),il=null,Xi=null,$d=null;function eg(){$d=Xi=il=null}function tg(t){var e=rl.current;pe(rl),t._currentValue=e}function Sf(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function is(t,e){il=t,$d=Xi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(ht=!0),t.firstContext=null)}function Xt(t){var e=t._currentValue;if($d!==t)if(t={context:t,memoizedValue:e,next:null},Xi===null){if(il===null)throw Error(O(308));Xi=t,il.dependencies={lanes:0,firstContext:t}}else Xi=Xi.next=t;return e}var $r=null;function ng(t){$r===null?$r=[t]:$r.push(t)}function nE(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,ng(e)):(n.next=i.next,i.next=n),e.interleaved=n,$n(t,r)}function $n(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var yr=!1;function rg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function rE(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Kn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Br(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,$&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,$n(t,n)}return i=r.interleaved,i===null?(e.next=e,ng(r)):(e.next=i.next,i.next=e),r.interleaved=e,$n(t,n)}function xc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,zd(t,n)}}function Gm(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function sl(t,e,n,r){var i=t.updateQueue;yr=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(s!==null){var h=i.baseState;o=0,u=l=c=null,a=s;do{var f=a.lane,g=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:g,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,A=a;switch(f=e,g=n,A.tag){case 1:if(p=A.payload,typeof p=="function"){h=p.call(g,h,f);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=A.payload,f=typeof p=="function"?p.call(g,h,f):p,f==null)break e;h=Ae({},h,f);break e;case 2:yr=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else g={eventTime:g,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=g,c=h):u=u.next=g,o|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(1);if(u===null&&(c=h),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);ui|=o,t.lanes=o,t.memoizedState=h}}function Vm(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(O(191,i));i.call(r)}}}var iE=new nA.Component().refs;function wf(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ae({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Vl={isMounted:function(t){return(t=t._reactInternals)?_i(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=it(),i=Mr(t),s=Kn(r,i);s.payload=e,n!=null&&(s.callback=n),e=Br(t,s,i),e!==null&&(cn(e,t,i,r),xc(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=it(),i=Mr(t),s=Kn(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Br(t,s,i),e!==null&&(cn(e,t,i,r),xc(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=it(),r=Mr(t),i=Kn(n,r);i.tag=2,e!=null&&(i.callback=e),e=Br(t,i,r),e!==null&&(cn(e,t,r,n),xc(e,t,r))}};function zm(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Uo(n,r)||!Uo(i,s):!0}function sE(t,e,n){var r=!1,i=Dr,s=e.contextType;return typeof s=="object"&&s!==null?s=Xt(s):(i=gt(e)?ai:Ze.current,r=e.contextTypes,s=(r=r!=null)?fs(t,i):Dr),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Vl,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function Hm(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Vl.enqueueReplaceState(e,e.state,null)}function Cf(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs=iE,rg(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Xt(s):(s=gt(e)?ai:Ze.current,i.context=fs(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(wf(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Vl.enqueueReplaceState(i,i.state,null),sl(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Js(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(O(309));var r=n.stateNode}if(!r)throw Error(O(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;a===iE&&(a=i.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(O(284));if(!n._owner)throw Error(O(290,t))}return t}function Wa(t,e){throw t=Object.prototype.toString.call(e),Error(O(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function jm(t){var e=t._init;return e(t._payload)}function oE(t){function e(_,m){if(t){var v=_.deletions;v===null?(_.deletions=[m],_.flags|=16):v.push(m)}}function n(_,m){if(!t)return null;for(;m!==null;)e(_,m),m=m.sibling;return null}function r(_,m){for(_=new Map;m!==null;)m.key!==null?_.set(m.key,m):_.set(m.index,m),m=m.sibling;return _}function i(_,m){return _=Rr(_,m),_.index=0,_.sibling=null,_}function s(_,m,v){return _.index=v,t?(v=_.alternate,v!==null?(v=v.index,v<m?(_.flags|=2,m):v):(_.flags|=2,m)):(_.flags|=1048576,m)}function o(_){return t&&_.alternate===null&&(_.flags|=2),_}function a(_,m,v,T){return m===null||m.tag!==6?(m=ju(v,_.mode,T),m.return=_,m):(m=i(m,v),m.return=_,m)}function c(_,m,v,T){var w=v.type;return w===ki?u(_,m,v.props.children,T,v.key):m!==null&&(m.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===_r&&jm(w)===m.type)?(T=i(m,v.props),T.ref=Js(_,m,v),T.return=_,T):(T=Lc(v.type,v.key,v.props,null,_.mode,T),T.ref=Js(_,m,v),T.return=_,T)}function l(_,m,v,T){return m===null||m.tag!==4||m.stateNode.containerInfo!==v.containerInfo||m.stateNode.implementation!==v.implementation?(m=Wu(v,_.mode,T),m.return=_,m):(m=i(m,v.children||[]),m.return=_,m)}function u(_,m,v,T,w){return m===null||m.tag!==7?(m=ii(v,_.mode,T,w),m.return=_,m):(m=i(m,v),m.return=_,m)}function h(_,m,v){if(typeof m=="string"&&m!==""||typeof m=="number")return m=ju(""+m,_.mode,v),m.return=_,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case Oa:return v=Lc(m.type,m.key,m.props,null,_.mode,v),v.ref=Js(_,null,m),v.return=_,v;case Ui:return m=Wu(m,_.mode,v),m.return=_,m;case _r:var T=m._init;return h(_,T(m._payload),v)}if(lo(m)||Vs(m))return m=ii(m,_.mode,v,null),m.return=_,m;Wa(_,m)}return null}function f(_,m,v,T){var w=m!==null?m.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return w!==null?null:a(_,m,""+v,T);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Oa:return v.key===w?c(_,m,v,T):null;case Ui:return v.key===w?l(_,m,v,T):null;case _r:return w=v._init,f(_,m,w(v._payload),T)}if(lo(v)||Vs(v))return w!==null?null:u(_,m,v,T,null);Wa(_,v)}return null}function g(_,m,v,T,w){if(typeof T=="string"&&T!==""||typeof T=="number")return _=_.get(v)||null,a(m,_,""+T,w);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Oa:return _=_.get(T.key===null?v:T.key)||null,c(m,_,T,w);case Ui:return _=_.get(T.key===null?v:T.key)||null,l(m,_,T,w);case _r:var x=T._init;return g(_,m,v,x(T._payload),w)}if(lo(T)||Vs(T))return _=_.get(v)||null,u(m,_,T,w,null);Wa(m,T)}return null}function p(_,m,v,T){for(var w=null,x=null,I=m,M=m=0,L=null;I!==null&&M<v.length;M++){I.index>M?(L=I,I=null):L=I.sibling;var R=f(_,I,v[M],T);if(R===null){I===null&&(I=L);break}t&&I&&R.alternate===null&&e(_,I),m=s(R,m,M),x===null?w=R:x.sibling=R,x=R,I=L}if(M===v.length)return n(_,I),me&&Yr(_,M),w;if(I===null){for(;M<v.length;M++)I=h(_,v[M],T),I!==null&&(m=s(I,m,M),x===null?w=I:x.sibling=I,x=I);return me&&Yr(_,M),w}for(I=r(_,I);M<v.length;M++)L=g(I,_,M,v[M],T),L!==null&&(t&&L.alternate!==null&&I.delete(L.key===null?M:L.key),m=s(L,m,M),x===null?w=L:x.sibling=L,x=L);return t&&I.forEach(function(z){return e(_,z)}),me&&Yr(_,M),w}function A(_,m,v,T){var w=Vs(v);if(typeof w!="function")throw Error(O(150));if(v=w.call(v),v==null)throw Error(O(151));for(var x=w=null,I=m,M=m=0,L=null,R=v.next();I!==null&&!R.done;M++,R=v.next()){I.index>M?(L=I,I=null):L=I.sibling;var z=f(_,I,R.value,T);if(z===null){I===null&&(I=L);break}t&&I&&z.alternate===null&&e(_,I),m=s(z,m,M),x===null?w=z:x.sibling=z,x=z,I=L}if(R.done)return n(_,I),me&&Yr(_,M),w;if(I===null){for(;!R.done;M++,R=v.next())R=h(_,R.value,T),R!==null&&(m=s(R,m,M),x===null?w=R:x.sibling=R,x=R);return me&&Yr(_,M),w}for(I=r(_,I);!R.done;M++,R=v.next())R=g(I,_,M,R.value,T),R!==null&&(t&&R.alternate!==null&&I.delete(R.key===null?M:R.key),m=s(R,m,M),x===null?w=R:x.sibling=R,x=R);return t&&I.forEach(function(te){return e(_,te)}),me&&Yr(_,M),w}function b(_,m,v,T){if(typeof v=="object"&&v!==null&&v.type===ki&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Oa:e:{for(var w=v.key,x=m;x!==null;){if(x.key===w){if(w=v.type,w===ki){if(x.tag===7){n(_,x.sibling),m=i(x,v.props.children),m.return=_,_=m;break e}}else if(x.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===_r&&jm(w)===x.type){n(_,x.sibling),m=i(x,v.props),m.ref=Js(_,x,v),m.return=_,_=m;break e}n(_,x);break}else e(_,x);x=x.sibling}v.type===ki?(m=ii(v.props.children,_.mode,T,v.key),m.return=_,_=m):(T=Lc(v.type,v.key,v.props,null,_.mode,T),T.ref=Js(_,m,v),T.return=_,_=T)}return o(_);case Ui:e:{for(x=v.key;m!==null;){if(m.key===x)if(m.tag===4&&m.stateNode.containerInfo===v.containerInfo&&m.stateNode.implementation===v.implementation){n(_,m.sibling),m=i(m,v.children||[]),m.return=_,_=m;break e}else{n(_,m);break}else e(_,m);m=m.sibling}m=Wu(v,_.mode,T),m.return=_,_=m}return o(_);case _r:return x=v._init,b(_,m,x(v._payload),T)}if(lo(v))return p(_,m,v,T);if(Vs(v))return A(_,m,v,T);Wa(_,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,m!==null&&m.tag===6?(n(_,m.sibling),m=i(m,v),m.return=_,_=m):(n(_,m),m=ju(v,_.mode,T),m.return=_,_=m),o(_)):n(_,m)}return b}var gs=oE(!0),aE=oE(!1),ca={},Mn=kr(ca),zo=kr(ca),Ho=kr(ca);function ei(t){if(t===ca)throw Error(O(174));return t}function ig(t,e){switch(ue(Ho,e),ue(zo,t),ue(Mn,ca),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:rf(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=rf(e,t)}pe(Mn),ue(Mn,e)}function ps(){pe(Mn),pe(zo),pe(Ho)}function cE(t){ei(Ho.current);var e=ei(Mn.current),n=rf(e,t.type);e!==n&&(ue(zo,t),ue(Mn,n))}function sg(t){zo.current===t&&(pe(Mn),pe(zo))}var _e=kr(0);function ol(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Uu=[];function og(){for(var t=0;t<Uu.length;t++)Uu[t]._workInProgressVersionPrimary=null;Uu.length=0}var Bc=ir.ReactCurrentDispatcher,ku=ir.ReactCurrentBatchConfig,li=0,ve=null,Re=null,Ne=null,al=!1,Eo=!1,jo=0,bC=0;function We(){throw Error(O(321))}function ag(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!un(t[n],e[n]))return!1;return!0}function cg(t,e,n,r,i,s){if(li=s,ve=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Bc.current=t===null||t.memoizedState===null?xC:BC,t=n(r,i),Eo){s=0;do{if(Eo=!1,jo=0,25<=s)throw Error(O(301));s+=1,Ne=Re=null,e.updateQueue=null,Bc.current=IC,t=n(r,i)}while(Eo)}if(Bc.current=cl,e=Re!==null&&Re.next!==null,li=0,Ne=Re=ve=null,al=!1,e)throw Error(O(300));return t}function lg(){var t=jo!==0;return jo=0,t}function Tn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ne===null?ve.memoizedState=Ne=t:Ne=Ne.next=t,Ne}function Kt(){if(Re===null){var t=ve.alternate;t=t!==null?t.memoizedState:null}else t=Re.next;var e=Ne===null?ve.memoizedState:Ne.next;if(e!==null)Ne=e,Re=t;else{if(t===null)throw Error(O(310));Re=t,t={memoizedState:Re.memoizedState,baseState:Re.baseState,baseQueue:Re.baseQueue,queue:Re.queue,next:null},Ne===null?ve.memoizedState=Ne=t:Ne=Ne.next=t}return Ne}function Wo(t,e){return typeof e=="function"?e(t):e}function Gu(t){var e=Kt(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var r=Re,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,c=null,l=s;do{var u=l.lane;if((li&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:t(r,l.action);else{var h={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=h,o=r):c=c.next=h,ve.lanes|=u,ui|=u}l=l.next}while(l!==null&&l!==s);c===null?o=r:c.next=a,un(r,e.memoizedState)||(ht=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,ve.lanes|=s,ui|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Vu(t){var e=Kt(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);un(s,e.memoizedState)||(ht=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function lE(){}function uE(t,e){var n=ve,r=Kt(),i=e(),s=!un(r.memoizedState,i);if(s&&(r.memoizedState=i,ht=!0),r=r.queue,ug(dE.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Ne!==null&&Ne.memoizedState.tag&1){if(n.flags|=2048,Jo(9,fE.bind(null,n,r,i,e),void 0,null),Ue===null)throw Error(O(349));li&30||hE(n,e,i)}return i}function hE(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ve.updateQueue,e===null?(e={lastEffect:null,stores:null},ve.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function fE(t,e,n,r){e.value=n,e.getSnapshot=r,gE(e)&&pE(t)}function dE(t,e,n){return n(function(){gE(e)&&pE(t)})}function gE(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!un(t,n)}catch{return!0}}function pE(t){var e=$n(t,1);e!==null&&cn(e,t,1,-1)}function Wm(t){var e=Tn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Wo,lastRenderedState:t},e.queue=t,t=t.dispatch=CC.bind(null,ve,t),[e.memoizedState,t]}function Jo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=ve.updateQueue,e===null?(e={lastEffect:null,stores:null},ve.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function mE(){return Kt().memoizedState}function Ic(t,e,n,r){var i=Tn();ve.flags|=t,i.memoizedState=Jo(1|e,n,void 0,r===void 0?null:r)}function zl(t,e,n,r){var i=Kt();r=r===void 0?null:r;var s=void 0;if(Re!==null){var o=Re.memoizedState;if(s=o.destroy,r!==null&&ag(r,o.deps)){i.memoizedState=Jo(e,n,s,r);return}}ve.flags|=t,i.memoizedState=Jo(1|e,n,s,r)}function Jm(t,e){return Ic(8390656,8,t,e)}function ug(t,e){return zl(2048,8,t,e)}function _E(t,e){return zl(4,2,t,e)}function yE(t,e){return zl(4,4,t,e)}function vE(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function AE(t,e,n){return n=n!=null?n.concat([t]):null,zl(4,4,vE.bind(null,e,t),n)}function hg(){}function EE(t,e){var n=Kt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ag(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function TE(t,e){var n=Kt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ag(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function bE(t,e,n){return li&21?(un(n,e)||(n=CA(),ve.lanes|=n,ui|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,ht=!0),t.memoizedState=n)}function SC(t,e){var n=oe;oe=n!==0&&4>n?n:4,t(!0);var r=ku.transition;ku.transition={};try{t(!1),e()}finally{oe=n,ku.transition=r}}function SE(){return Kt().memoizedState}function wC(t,e,n){var r=Mr(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},wE(t))CE(e,n);else if(n=nE(t,e,n,r),n!==null){var i=it();cn(n,t,r,i),xE(n,e,r)}}function CC(t,e,n){var r=Mr(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(wE(t))CE(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,un(a,o)){var c=e.interleaved;c===null?(i.next=i,ng(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}n=nE(t,e,i,r),n!==null&&(i=it(),cn(n,t,r,i),xE(n,e,r))}}function wE(t){var e=t.alternate;return t===ve||e!==null&&e===ve}function CE(t,e){Eo=al=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function xE(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,zd(t,n)}}var cl={readContext:Xt,useCallback:We,useContext:We,useEffect:We,useImperativeHandle:We,useInsertionEffect:We,useLayoutEffect:We,useMemo:We,useReducer:We,useRef:We,useState:We,useDebugValue:We,useDeferredValue:We,useTransition:We,useMutableSource:We,useSyncExternalStore:We,useId:We,unstable_isNewReconciler:!1},xC={readContext:Xt,useCallback:function(t,e){return Tn().memoizedState=[t,e===void 0?null:e],t},useContext:Xt,useEffect:Jm,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Ic(4194308,4,vE.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Ic(4194308,4,t,e)},useInsertionEffect:function(t,e){return Ic(4,2,t,e)},useMemo:function(t,e){var n=Tn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Tn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=wC.bind(null,ve,t),[r.memoizedState,t]},useRef:function(t){var e=Tn();return t={current:t},e.memoizedState=t},useState:Wm,useDebugValue:hg,useDeferredValue:function(t){return Tn().memoizedState=t},useTransition:function(){var t=Wm(!1),e=t[0];return t=SC.bind(null,t[1]),Tn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=ve,i=Tn();if(me){if(n===void 0)throw Error(O(407));n=n()}else{if(n=e(),Ue===null)throw Error(O(349));li&30||hE(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,Jm(dE.bind(null,r,s,t),[t]),r.flags|=2048,Jo(9,fE.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=Tn(),e=Ue.identifierPrefix;if(me){var n=jn,r=Hn;n=(r&~(1<<32-an(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=jo++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=bC++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},BC={readContext:Xt,useCallback:EE,useContext:Xt,useEffect:ug,useImperativeHandle:AE,useInsertionEffect:_E,useLayoutEffect:yE,useMemo:TE,useReducer:Gu,useRef:mE,useState:function(){return Gu(Wo)},useDebugValue:hg,useDeferredValue:function(t){var e=Kt();return bE(e,Re.memoizedState,t)},useTransition:function(){var t=Gu(Wo)[0],e=Kt().memoizedState;return[t,e]},useMutableSource:lE,useSyncExternalStore:uE,useId:SE,unstable_isNewReconciler:!1},IC={readContext:Xt,useCallback:EE,useContext:Xt,useEffect:ug,useImperativeHandle:AE,useInsertionEffect:_E,useLayoutEffect:yE,useMemo:TE,useReducer:Vu,useRef:mE,useState:function(){return Vu(Wo)},useDebugValue:hg,useDeferredValue:function(t){var e=Kt();return Re===null?e.memoizedState=t:bE(e,Re.memoizedState,t)},useTransition:function(){var t=Vu(Wo)[0],e=Kt().memoizedState;return[t,e]},useMutableSource:lE,useSyncExternalStore:uE,useId:SE,unstable_isNewReconciler:!1};function ms(t,e){try{var n="",r=e;do n+=rw(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function zu(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function xf(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var MC=typeof WeakMap=="function"?WeakMap:Map;function BE(t,e,n){n=Kn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){ul||(ul=!0,Nf=r),xf(t,e)},n}function IE(t,e,n){n=Kn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){xf(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){xf(t,e),typeof r!="function"&&(Ir===null?Ir=new Set([this]):Ir.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Xm(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new MC;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=jC.bind(null,t,e,n),e.then(t,t))}function Km(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Ym(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Kn(-1,1),e.tag=2,Br(n,e,1))),n.lanes|=1),t)}var RC=ir.ReactCurrentOwner,ht=!1;function tt(t,e,n,r){e.child=t===null?aE(e,null,n,r):gs(e,t.child,n,r)}function Qm(t,e,n,r,i){n=n.render;var s=e.ref;return is(e,i),r=cg(t,e,n,r,s,i),n=lg(),t!==null&&!ht?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,er(t,e,i)):(me&&n&&Qd(e),e.flags|=1,tt(t,e,r,i),e.child)}function qm(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!vg(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,ME(t,e,s,r,i)):(t=Lc(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Uo,n(o,r)&&t.ref===e.ref)return er(t,e,i)}return e.flags|=1,t=Rr(s,r),t.ref=e.ref,t.return=e,e.child=t}function ME(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Uo(s,r)&&t.ref===e.ref)if(ht=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(ht=!0);else return e.lanes=t.lanes,er(t,e,i)}return Bf(t,e,n,r,i)}function RE(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ue(Yi,Tt),Tt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ue(Yi,Tt),Tt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,ue(Yi,Tt),Tt|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,ue(Yi,Tt),Tt|=r;return tt(t,e,i,n),e.child}function PE(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Bf(t,e,n,r,i){var s=gt(n)?ai:Ze.current;return s=fs(e,s),is(e,i),n=cg(t,e,n,r,s,i),r=lg(),t!==null&&!ht?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,er(t,e,i)):(me&&r&&Qd(e),e.flags|=1,tt(t,e,n,i),e.child)}function Zm(t,e,n,r,i){if(gt(n)){var s=!0;el(e)}else s=!1;if(is(e,i),e.stateNode===null)Mc(t,e),sE(e,n,r),Cf(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=Xt(l):(l=gt(n)?ai:Ze.current,l=fs(e,l));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||c!==l)&&Hm(e,o,r,l),yr=!1;var f=e.memoizedState;o.state=f,sl(e,r,o,i),c=e.memoizedState,a!==r||f!==c||dt.current||yr?(typeof u=="function"&&(wf(e,n,u,r),c=e.memoizedState),(a=yr||zm(e,n,a,r,f,c,l))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=l,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,rE(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:$t(e.type,a),o.props=l,h=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Xt(c):(c=gt(n)?ai:Ze.current,c=fs(e,c));var g=n.getDerivedStateFromProps;(u=typeof g=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==c)&&Hm(e,o,r,c),yr=!1,f=e.memoizedState,o.state=f,sl(e,r,o,i);var p=e.memoizedState;a!==h||f!==p||dt.current||yr?(typeof g=="function"&&(wf(e,n,g,r),p=e.memoizedState),(l=yr||zm(e,n,l,r,f,p,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,p,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,p,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),o.props=r,o.state=p,o.context=c,r=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return If(t,e,n,r,s,i)}function If(t,e,n,r,i,s){PE(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&Nm(e,n,!1),er(t,e,s);r=e.stateNode,RC.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=gs(e,t.child,null,s),e.child=gs(e,null,a,s)):tt(t,e,a,s),e.memoizedState=r.state,i&&Nm(e,n,!0),e.child}function LE(t){var e=t.stateNode;e.pendingContext?Fm(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Fm(t,e.context,!1),ig(t,e.containerInfo)}function $m(t,e,n,r,i){return ds(),Zd(i),e.flags|=256,tt(t,e,n,r),e.child}var Mf={dehydrated:null,treeContext:null,retryLane:0};function Rf(t){return{baseLanes:t,cachePool:null,transitions:null}}function OE(t,e,n){var r=e.pendingProps,i=_e.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),ue(_e,i&1),t===null)return bf(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Wl(o,r,0,null),t=ii(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Rf(n),e.memoizedState=Mf,t):fg(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return PC(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Rr(i,c),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Rr(a,s):(s=ii(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?Rf(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Mf,r}return s=t.child,t=s.sibling,r=Rr(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function fg(t,e){return e=Wl({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ja(t,e,n,r){return r!==null&&Zd(r),gs(e,t.child,null,n),t=fg(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function PC(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=zu(Error(O(422))),Ja(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Wl({mode:"visible",children:r.children},i,0,null),s=ii(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&gs(e,t.child,null,o),e.child.memoizedState=Rf(o),e.memoizedState=Mf,s);if(!(e.mode&1))return Ja(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(O(419)),r=zu(s,r,void 0),Ja(t,e,o,r)}if(a=(o&t.childLanes)!==0,ht||a){if(r=Ue,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,$n(t,i),cn(r,t,i,-1))}return yg(),r=zu(Error(O(421))),Ja(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=WC.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,St=xr(i.nextSibling),Ct=e,me=!0,tn=null,t!==null&&(Ut[kt++]=Hn,Ut[kt++]=jn,Ut[kt++]=ci,Hn=t.id,jn=t.overflow,ci=e),e=fg(e,r.children),e.flags|=4096,e)}function e0(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Sf(t.return,e,n)}function Hu(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function DE(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(tt(t,e,r.children,n),r=_e.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&e0(t,n,e);else if(t.tag===19)e0(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ue(_e,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&ol(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Hu(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&ol(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Hu(e,!0,n,null,s);break;case"together":Hu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Mc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function er(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ui|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(O(153));if(e.child!==null){for(t=e.child,n=Rr(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Rr(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function LC(t,e,n){switch(e.tag){case 3:LE(e),ds();break;case 5:cE(e);break;case 1:gt(e.type)&&el(e);break;case 4:ig(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ue(rl,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ue(_e,_e.current&1),e.flags|=128,null):n&e.child.childLanes?OE(t,e,n):(ue(_e,_e.current&1),t=er(t,e,n),t!==null?t.sibling:null);ue(_e,_e.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return DE(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ue(_e,_e.current),r)break;return null;case 22:case 23:return e.lanes=0,RE(t,e,n)}return er(t,e,n)}var FE,Pf,NE,UE;FE=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Pf=function(){};NE=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,ei(Mn.current);var s=null;switch(n){case"input":i=$h(t,i),r=$h(t,r),s=[];break;case"select":i=Ae({},i,{value:void 0}),r=Ae({},r,{value:void 0}),s=[];break;case"textarea":i=nf(t,i),r=nf(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Zc)}sf(n,r);var o;n=null;for(l in i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var a=i[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Ro.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in r){var c=r[l];if(a=i!=null?i[l]:void 0,r.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Ro.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&ge("scroll",t),s||a===c||(s=[])):(s=s||[]).push(l,c))}n&&(s=s||[]).push("style",n);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};UE=function(t,e,n,r){n!==r&&(e.flags|=4)};function Xs(t,e){if(!me)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Je(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function OC(t,e,n){var r=e.pendingProps;switch(qd(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Je(e),null;case 1:return gt(e.type)&&$c(),Je(e),null;case 3:return r=e.stateNode,ps(),pe(dt),pe(Ze),og(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ja(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,tn!==null&&(Gf(tn),tn=null))),Pf(t,e),Je(e),null;case 5:sg(e);var i=ei(Ho.current);if(n=e.type,t!==null&&e.stateNode!=null)NE(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(O(166));return Je(e),null}if(t=ei(Mn.current),ja(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[bn]=e,r[Vo]=s,t=(e.mode&1)!==0,n){case"dialog":ge("cancel",r),ge("close",r);break;case"iframe":case"object":case"embed":ge("load",r);break;case"video":case"audio":for(i=0;i<ho.length;i++)ge(ho[i],r);break;case"source":ge("error",r);break;case"img":case"image":case"link":ge("error",r),ge("load",r);break;case"details":ge("toggle",r);break;case"input":lm(r,s),ge("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},ge("invalid",r);break;case"textarea":hm(r,s),ge("invalid",r)}sf(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Ha(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Ha(r.textContent,a,t),i=["children",""+a]):Ro.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ge("scroll",r)}switch(n){case"input":Da(r),um(r,s,!0);break;case"textarea":Da(r),fm(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Zc)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=hA(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[bn]=e,t[Vo]=r,FE(t,e,!1,!1),e.stateNode=t;e:{switch(o=of(n,r),n){case"dialog":ge("cancel",t),ge("close",t),i=r;break;case"iframe":case"object":case"embed":ge("load",t),i=r;break;case"video":case"audio":for(i=0;i<ho.length;i++)ge(ho[i],t);i=r;break;case"source":ge("error",t),i=r;break;case"img":case"image":case"link":ge("error",t),ge("load",t),i=r;break;case"details":ge("toggle",t),i=r;break;case"input":lm(t,r),i=$h(t,r),ge("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Ae({},r,{value:void 0}),ge("invalid",t);break;case"textarea":hm(t,r),i=nf(t,r),ge("invalid",t);break;default:i=r}sf(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?gA(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&fA(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Po(t,c):typeof c=="number"&&Po(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ro.hasOwnProperty(s)?c!=null&&s==="onScroll"&&ge("scroll",t):c!=null&&Fd(t,s,c,o))}switch(n){case"input":Da(t),um(t,r,!1);break;case"textarea":Da(t),fm(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Or(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?es(t,!!r.multiple,s,!1):r.defaultValue!=null&&es(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Zc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Je(e),null;case 6:if(t&&e.stateNode!=null)UE(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(O(166));if(n=ei(Ho.current),ei(Mn.current),ja(e)){if(r=e.stateNode,n=e.memoizedProps,r[bn]=e,(s=r.nodeValue!==n)&&(t=Ct,t!==null))switch(t.tag){case 3:Ha(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Ha(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[bn]=e,e.stateNode=r}return Je(e),null;case 13:if(pe(_e),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(me&&St!==null&&e.mode&1&&!(e.flags&128))tE(),ds(),e.flags|=98560,s=!1;else if(s=ja(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(O(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(O(317));s[bn]=e}else ds(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Je(e),s=!1}else tn!==null&&(Gf(tn),tn=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||_e.current&1?Pe===0&&(Pe=3):yg())),e.updateQueue!==null&&(e.flags|=4),Je(e),null);case 4:return ps(),Pf(t,e),t===null&&ko(e.stateNode.containerInfo),Je(e),null;case 10:return tg(e.type._context),Je(e),null;case 17:return gt(e.type)&&$c(),Je(e),null;case 19:if(pe(_e),s=e.memoizedState,s===null)return Je(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)Xs(s,!1);else{if(Pe!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=ol(t),o!==null){for(e.flags|=128,Xs(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ue(_e,_e.current&1|2),e.child}t=t.sibling}s.tail!==null&&we()>_s&&(e.flags|=128,r=!0,Xs(s,!1),e.lanes=4194304)}else{if(!r)if(t=ol(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Xs(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!me)return Je(e),null}else 2*we()-s.renderingStartTime>_s&&n!==1073741824&&(e.flags|=128,r=!0,Xs(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=we(),e.sibling=null,n=_e.current,ue(_e,r?n&1|2:n&1),e):(Je(e),null);case 22:case 23:return _g(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Tt&1073741824&&(Je(e),e.subtreeFlags&6&&(e.flags|=8192)):Je(e),null;case 24:return null;case 25:return null}throw Error(O(156,e.tag))}function DC(t,e){switch(qd(e),e.tag){case 1:return gt(e.type)&&$c(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ps(),pe(dt),pe(Ze),og(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return sg(e),null;case 13:if(pe(_e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(O(340));ds()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return pe(_e),null;case 4:return ps(),null;case 10:return tg(e.type._context),null;case 22:case 23:return _g(),null;case 24:return null;default:return null}}var Xa=!1,Qe=!1,FC=typeof WeakSet=="function"?WeakSet:Set,G=null;function Ki(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){be(t,e,r)}else n.current=null}function Lf(t,e,n){try{n()}catch(r){be(t,e,r)}}var t0=!1;function NC(t,e){if(mf=Yc,t=zA(),Yd(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,u=0,h=t,f=null;t:for(;;){for(var g;h!==n||i!==0&&h.nodeType!==3||(a=o+i),h!==s||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(g=h.firstChild)!==null;)f=h,h=g;for(;;){if(h===t)break t;if(f===n&&++l===i&&(a=o),f===s&&++u===r&&(c=o),(g=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=g}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(_f={focusedElem:t,selectionRange:n},Yc=!1,G=e;G!==null;)if(e=G,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,G=t;else for(;G!==null;){e=G;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var A=p.memoizedProps,b=p.memoizedState,_=e.stateNode,m=_.getSnapshotBeforeUpdate(e.elementType===e.type?A:$t(e.type,A),b);_.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(O(163))}}catch(T){be(e,e.return,T)}if(t=e.sibling,t!==null){t.return=e.return,G=t;break}G=e.return}return p=t0,t0=!1,p}function To(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&Lf(e,n,s)}i=i.next}while(i!==r)}}function Hl(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Of(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function kE(t){var e=t.alternate;e!==null&&(t.alternate=null,kE(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[bn],delete e[Vo],delete e[Af],delete e[vC],delete e[AC])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function GE(t){return t.tag===5||t.tag===3||t.tag===4}function n0(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||GE(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Df(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Zc));else if(r!==4&&(t=t.child,t!==null))for(Df(t,e,n),t=t.sibling;t!==null;)Df(t,e,n),t=t.sibling}function Ff(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Ff(t,e,n),t=t.sibling;t!==null;)Ff(t,e,n),t=t.sibling}var Ve=null,en=!1;function lr(t,e,n){for(n=n.child;n!==null;)VE(t,e,n),n=n.sibling}function VE(t,e,n){if(In&&typeof In.onCommitFiberUnmount=="function")try{In.onCommitFiberUnmount(Dl,n)}catch{}switch(n.tag){case 5:Qe||Ki(n,e);case 6:var r=Ve,i=en;Ve=null,lr(t,e,n),Ve=r,en=i,Ve!==null&&(en?(t=Ve,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ve.removeChild(n.stateNode));break;case 18:Ve!==null&&(en?(t=Ve,n=n.stateNode,t.nodeType===8?Fu(t.parentNode,n):t.nodeType===1&&Fu(t,n),Fo(t)):Fu(Ve,n.stateNode));break;case 4:r=Ve,i=en,Ve=n.stateNode.containerInfo,en=!0,lr(t,e,n),Ve=r,en=i;break;case 0:case 11:case 14:case 15:if(!Qe&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Lf(n,e,o),i=i.next}while(i!==r)}lr(t,e,n);break;case 1:if(!Qe&&(Ki(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){be(n,e,a)}lr(t,e,n);break;case 21:lr(t,e,n);break;case 22:n.mode&1?(Qe=(r=Qe)||n.memoizedState!==null,lr(t,e,n),Qe=r):lr(t,e,n);break;default:lr(t,e,n)}}function r0(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new FC),e.forEach(function(r){var i=JC.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function qt(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ve=a.stateNode,en=!1;break e;case 3:Ve=a.stateNode.containerInfo,en=!0;break e;case 4:Ve=a.stateNode.containerInfo,en=!0;break e}a=a.return}if(Ve===null)throw Error(O(160));VE(s,o,i),Ve=null,en=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(l){be(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)zE(e,t),e=e.sibling}function zE(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(qt(e,t),_n(t),r&4){try{To(3,t,t.return),Hl(3,t)}catch(A){be(t,t.return,A)}try{To(5,t,t.return)}catch(A){be(t,t.return,A)}}break;case 1:qt(e,t),_n(t),r&512&&n!==null&&Ki(n,n.return);break;case 5:if(qt(e,t),_n(t),r&512&&n!==null&&Ki(n,n.return),t.flags&32){var i=t.stateNode;try{Po(i,"")}catch(A){be(t,t.return,A)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&lA(i,s),of(a,o);var l=of(a,s);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];u==="style"?gA(i,h):u==="dangerouslySetInnerHTML"?fA(i,h):u==="children"?Po(i,h):Fd(i,u,h,l)}switch(a){case"input":ef(i,s);break;case"textarea":uA(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var g=s.value;g!=null?es(i,!!s.multiple,g,!1):f!==!!s.multiple&&(s.defaultValue!=null?es(i,!!s.multiple,s.defaultValue,!0):es(i,!!s.multiple,s.multiple?[]:"",!1))}i[Vo]=s}catch(A){be(t,t.return,A)}}break;case 6:if(qt(e,t),_n(t),r&4){if(t.stateNode===null)throw Error(O(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(A){be(t,t.return,A)}}break;case 3:if(qt(e,t),_n(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Fo(e.containerInfo)}catch(A){be(t,t.return,A)}break;case 4:qt(e,t),_n(t);break;case 13:qt(e,t),_n(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(pg=we())),r&4&&r0(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Qe=(l=Qe)||u,qt(e,t),Qe=l):qt(e,t),_n(t),r&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for(G=t,u=t.child;u!==null;){for(h=G=u;G!==null;){switch(f=G,g=f.child,f.tag){case 0:case 11:case 14:case 15:To(4,f,f.return);break;case 1:Ki(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(A){be(r,n,A)}}break;case 5:Ki(f,f.return);break;case 22:if(f.memoizedState!==null){s0(h);continue}}g!==null?(g.return=f,G=g):s0(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{i=h.stateNode,l?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=dA("display",o))}catch(A){be(t,t.return,A)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(A){be(t,t.return,A)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:qt(e,t),_n(t),r&4&&r0(t);break;case 21:break;default:qt(e,t),_n(t)}}function _n(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(GE(n)){var r=n;break e}n=n.return}throw Error(O(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Po(i,""),r.flags&=-33);var s=n0(t);Ff(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=n0(t);Df(t,a,o);break;default:throw Error(O(161))}}catch(c){be(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function UC(t,e,n){G=t,HE(t)}function HE(t,e,n){for(var r=(t.mode&1)!==0;G!==null;){var i=G,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Xa;if(!o){var a=i.alternate,c=a!==null&&a.memoizedState!==null||Qe;a=Xa;var l=Qe;if(Xa=o,(Qe=c)&&!l)for(G=i;G!==null;)o=G,c=o.child,o.tag===22&&o.memoizedState!==null?o0(i):c!==null?(c.return=o,G=c):o0(i);for(;s!==null;)G=s,HE(s),s=s.sibling;G=i,Xa=a,Qe=l}i0(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,G=s):i0(t)}}function i0(t){for(;G!==null;){var e=G;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Qe||Hl(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Qe)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:$t(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Vm(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Vm(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Fo(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(O(163))}Qe||e.flags&512&&Of(e)}catch(f){be(e,e.return,f)}}if(e===t){G=null;break}if(n=e.sibling,n!==null){n.return=e.return,G=n;break}G=e.return}}function s0(t){for(;G!==null;){var e=G;if(e===t){G=null;break}var n=e.sibling;if(n!==null){n.return=e.return,G=n;break}G=e.return}}function o0(t){for(;G!==null;){var e=G;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Hl(4,e)}catch(c){be(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(c){be(e,i,c)}}var s=e.return;try{Of(e)}catch(c){be(e,s,c)}break;case 5:var o=e.return;try{Of(e)}catch(c){be(e,o,c)}}}catch(c){be(e,e.return,c)}if(e===t){G=null;break}var a=e.sibling;if(a!==null){a.return=e.return,G=a;break}G=e.return}}var kC=Math.ceil,ll=ir.ReactCurrentDispatcher,dg=ir.ReactCurrentOwner,jt=ir.ReactCurrentBatchConfig,$=0,Ue=null,Ie=null,He=0,Tt=0,Yi=kr(0),Pe=0,Xo=null,ui=0,jl=0,gg=0,bo=null,lt=null,pg=0,_s=1/0,kn=null,ul=!1,Nf=null,Ir=null,Ka=!1,Tr=null,hl=0,So=0,Uf=null,Rc=-1,Pc=0;function it(){return $&6?we():Rc!==-1?Rc:Rc=we()}function Mr(t){return t.mode&1?$&2&&He!==0?He&-He:TC.transition!==null?(Pc===0&&(Pc=CA()),Pc):(t=oe,t!==0||(t=window.event,t=t===void 0?16:LA(t.type)),t):1}function cn(t,e,n,r){if(50<So)throw So=0,Uf=null,Error(O(185));sa(t,n,r),(!($&2)||t!==Ue)&&(t===Ue&&(!($&2)&&(jl|=n),Pe===4&&Ar(t,He)),pt(t,r),n===1&&$===0&&!(e.mode&1)&&(_s=we()+500,Gl&&Gr()))}function pt(t,e){var n=t.callbackNode;Tw(t,e);var r=Kc(t,t===Ue?He:0);if(r===0)n!==null&&pm(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&pm(n),e===1)t.tag===0?EC(a0.bind(null,t)):ZA(a0.bind(null,t)),_C(function(){!($&6)&&Gr()}),n=null;else{switch(xA(r)){case 1:n=Vd;break;case 4:n=SA;break;case 16:n=Xc;break;case 536870912:n=wA;break;default:n=Xc}n=qE(n,jE.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function jE(t,e){if(Rc=-1,Pc=0,$&6)throw Error(O(327));var n=t.callbackNode;if(ss()&&t.callbackNode!==n)return null;var r=Kc(t,t===Ue?He:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=fl(t,r);else{e=r;var i=$;$|=2;var s=JE();(Ue!==t||He!==e)&&(kn=null,_s=we()+500,ri(t,e));do try{zC();break}catch(a){WE(t,a)}while(1);eg(),ll.current=s,$=i,Ie!==null?e=0:(Ue=null,He=0,e=Pe)}if(e!==0){if(e===2&&(i=hf(t),i!==0&&(r=i,e=kf(t,i))),e===1)throw n=Xo,ri(t,0),Ar(t,r),pt(t,we()),n;if(e===6)Ar(t,r);else{if(i=t.current.alternate,!(r&30)&&!GC(i)&&(e=fl(t,r),e===2&&(s=hf(t),s!==0&&(r=s,e=kf(t,s))),e===1))throw n=Xo,ri(t,0),Ar(t,r),pt(t,we()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(O(345));case 2:Qr(t,lt,kn);break;case 3:if(Ar(t,r),(r&130023424)===r&&(e=pg+500-we(),10<e)){if(Kc(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){it(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=vf(Qr.bind(null,t,lt,kn),e);break}Qr(t,lt,kn);break;case 4:if(Ar(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-an(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=we()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*kC(r/1960))-r,10<r){t.timeoutHandle=vf(Qr.bind(null,t,lt,kn),r);break}Qr(t,lt,kn);break;case 5:Qr(t,lt,kn);break;default:throw Error(O(329))}}}return pt(t,we()),t.callbackNode===n?jE.bind(null,t):null}function kf(t,e){var n=bo;return t.current.memoizedState.isDehydrated&&(ri(t,e).flags|=256),t=fl(t,e),t!==2&&(e=lt,lt=n,e!==null&&Gf(e)),t}function Gf(t){lt===null?lt=t:lt.push.apply(lt,t)}function GC(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!un(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ar(t,e){for(e&=~gg,e&=~jl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-an(e),r=1<<n;t[n]=-1,e&=~r}}function a0(t){if($&6)throw Error(O(327));ss();var e=Kc(t,0);if(!(e&1))return pt(t,we()),null;var n=fl(t,e);if(t.tag!==0&&n===2){var r=hf(t);r!==0&&(e=r,n=kf(t,r))}if(n===1)throw n=Xo,ri(t,0),Ar(t,e),pt(t,we()),n;if(n===6)throw Error(O(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Qr(t,lt,kn),pt(t,we()),null}function mg(t,e){var n=$;$|=1;try{return t(e)}finally{$=n,$===0&&(_s=we()+500,Gl&&Gr())}}function hi(t){Tr!==null&&Tr.tag===0&&!($&6)&&ss();var e=$;$|=1;var n=jt.transition,r=oe;try{if(jt.transition=null,oe=1,t)return t()}finally{oe=r,jt.transition=n,$=e,!($&6)&&Gr()}}function _g(){Tt=Yi.current,pe(Yi)}function ri(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,mC(n)),Ie!==null)for(n=Ie.return;n!==null;){var r=n;switch(qd(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&$c();break;case 3:ps(),pe(dt),pe(Ze),og();break;case 5:sg(r);break;case 4:ps();break;case 13:pe(_e);break;case 19:pe(_e);break;case 10:tg(r.type._context);break;case 22:case 23:_g()}n=n.return}if(Ue=t,Ie=t=Rr(t.current,null),He=Tt=e,Pe=0,Xo=null,gg=jl=ui=0,lt=bo=null,$r!==null){for(e=0;e<$r.length;e++)if(n=$r[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}$r=null}return t}function WE(t,e){do{var n=Ie;try{if(eg(),Bc.current=cl,al){for(var r=ve.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}al=!1}if(li=0,Ne=Re=ve=null,Eo=!1,jo=0,dg.current=null,n===null||n.return===null){Pe=1,Xo=e,Ie=null;break}e:{var s=t,o=n.return,a=n,c=e;if(e=He,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var g=Km(o);if(g!==null){g.flags&=-257,Ym(g,o,a,s,e),g.mode&1&&Xm(s,l,e),e=g,c=l;var p=e.updateQueue;if(p===null){var A=new Set;A.add(c),e.updateQueue=A}else p.add(c);break e}else{if(!(e&1)){Xm(s,l,e),yg();break e}c=Error(O(426))}}else if(me&&a.mode&1){var b=Km(o);if(b!==null){!(b.flags&65536)&&(b.flags|=256),Ym(b,o,a,s,e),Zd(ms(c,a));break e}}s=c=ms(c,a),Pe!==4&&(Pe=2),bo===null?bo=[s]:bo.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var _=BE(s,c,e);Gm(s,_);break e;case 1:a=c;var m=s.type,v=s.stateNode;if(!(s.flags&128)&&(typeof m.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Ir===null||!Ir.has(v)))){s.flags|=65536,e&=-e,s.lanes|=e;var T=IE(s,a,e);Gm(s,T);break e}}s=s.return}while(s!==null)}KE(n)}catch(w){e=w,Ie===n&&n!==null&&(Ie=n=n.return);continue}break}while(1)}function JE(){var t=ll.current;return ll.current=cl,t===null?cl:t}function yg(){(Pe===0||Pe===3||Pe===2)&&(Pe=4),Ue===null||!(ui&268435455)&&!(jl&268435455)||Ar(Ue,He)}function fl(t,e){var n=$;$|=2;var r=JE();(Ue!==t||He!==e)&&(kn=null,ri(t,e));do try{VC();break}catch(i){WE(t,i)}while(1);if(eg(),$=n,ll.current=r,Ie!==null)throw Error(O(261));return Ue=null,He=0,Pe}function VC(){for(;Ie!==null;)XE(Ie)}function zC(){for(;Ie!==null&&!dw();)XE(Ie)}function XE(t){var e=QE(t.alternate,t,Tt);t.memoizedProps=t.pendingProps,e===null?KE(t):Ie=e,dg.current=null}function KE(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=DC(n,e),n!==null){n.flags&=32767,Ie=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Pe=6,Ie=null;return}}else if(n=OC(n,e,Tt),n!==null){Ie=n;return}if(e=e.sibling,e!==null){Ie=e;return}Ie=e=t}while(e!==null);Pe===0&&(Pe=5)}function Qr(t,e,n){var r=oe,i=jt.transition;try{jt.transition=null,oe=1,HC(t,e,n,r)}finally{jt.transition=i,oe=r}return null}function HC(t,e,n,r){do ss();while(Tr!==null);if($&6)throw Error(O(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(O(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(bw(t,s),t===Ue&&(Ie=Ue=null,He=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ka||(Ka=!0,qE(Xc,function(){return ss(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=jt.transition,jt.transition=null;var o=oe;oe=1;var a=$;$|=4,dg.current=null,NC(t,n),zE(n,t),lC(_f),Yc=!!mf,_f=mf=null,t.current=n,UC(n),gw(),$=a,oe=o,jt.transition=s}else t.current=n;if(Ka&&(Ka=!1,Tr=t,hl=i),s=t.pendingLanes,s===0&&(Ir=null),_w(n.stateNode),pt(t,we()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(ul)throw ul=!1,t=Nf,Nf=null,t;return hl&1&&t.tag!==0&&ss(),s=t.pendingLanes,s&1?t===Uf?So++:(So=0,Uf=t):So=0,Gr(),null}function ss(){if(Tr!==null){var t=xA(hl),e=jt.transition,n=oe;try{if(jt.transition=null,oe=16>t?16:t,Tr===null)var r=!1;else{if(t=Tr,Tr=null,hl=0,$&6)throw Error(O(331));var i=$;for($|=4,G=t.current;G!==null;){var s=G,o=s.child;if(G.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(G=l;G!==null;){var u=G;switch(u.tag){case 0:case 11:case 15:To(8,u,s)}var h=u.child;if(h!==null)h.return=u,G=h;else for(;G!==null;){u=G;var f=u.sibling,g=u.return;if(kE(u),u===l){G=null;break}if(f!==null){f.return=g,G=f;break}G=g}}}var p=s.alternate;if(p!==null){var A=p.child;if(A!==null){p.child=null;do{var b=A.sibling;A.sibling=null,A=b}while(A!==null)}}G=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,G=o;else e:for(;G!==null;){if(s=G,s.flags&2048)switch(s.tag){case 0:case 11:case 15:To(9,s,s.return)}var _=s.sibling;if(_!==null){_.return=s.return,G=_;break e}G=s.return}}var m=t.current;for(G=m;G!==null;){o=G;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,G=v;else e:for(o=m;G!==null;){if(a=G,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Hl(9,a)}}catch(w){be(a,a.return,w)}if(a===o){G=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,G=T;break e}G=a.return}}if($=i,Gr(),In&&typeof In.onPostCommitFiberRoot=="function")try{In.onPostCommitFiberRoot(Dl,t)}catch{}r=!0}return r}finally{oe=n,jt.transition=e}}return!1}function c0(t,e,n){e=ms(n,e),e=BE(t,e,1),t=Br(t,e,1),e=it(),t!==null&&(sa(t,1,e),pt(t,e))}function be(t,e,n){if(t.tag===3)c0(t,t,n);else for(;e!==null;){if(e.tag===3){c0(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ir===null||!Ir.has(r))){t=ms(n,t),t=IE(e,t,1),e=Br(e,t,1),t=it(),e!==null&&(sa(e,1,t),pt(e,t));break}}e=e.return}}function jC(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=it(),t.pingedLanes|=t.suspendedLanes&n,Ue===t&&(He&n)===n&&(Pe===4||Pe===3&&(He&130023424)===He&&500>we()-pg?ri(t,0):gg|=n),pt(t,e)}function YE(t,e){e===0&&(t.mode&1?(e=Ua,Ua<<=1,!(Ua&130023424)&&(Ua=4194304)):e=1);var n=it();t=$n(t,e),t!==null&&(sa(t,e,n),pt(t,n))}function WC(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),YE(t,n)}function JC(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(O(314))}r!==null&&r.delete(e),YE(t,n)}var QE;QE=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||dt.current)ht=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return ht=!1,LC(t,e,n);ht=!!(t.flags&131072)}else ht=!1,me&&e.flags&1048576&&$A(e,nl,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Mc(t,e),t=e.pendingProps;var i=fs(e,Ze.current);is(e,n),i=cg(null,e,r,t,i,n);var s=lg();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,gt(r)?(s=!0,el(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,rg(e),i.updater=Vl,e.stateNode=i,i._reactInternals=e,Cf(e,r,t,n),e=If(null,e,r,!0,s,n)):(e.tag=0,me&&s&&Qd(e),tt(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Mc(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=KC(r),t=$t(r,t),i){case 0:e=Bf(null,e,r,t,n);break e;case 1:e=Zm(null,e,r,t,n);break e;case 11:e=Qm(null,e,r,t,n);break e;case 14:e=qm(null,e,r,$t(r.type,t),n);break e}throw Error(O(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:$t(r,i),Bf(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:$t(r,i),Zm(t,e,r,i,n);case 3:e:{if(LE(e),t===null)throw Error(O(387));r=e.pendingProps,s=e.memoizedState,i=s.element,rE(t,e),sl(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=ms(Error(O(423)),e),e=$m(t,e,r,n,i);break e}else if(r!==i){i=ms(Error(O(424)),e),e=$m(t,e,r,n,i);break e}else for(St=xr(e.stateNode.containerInfo.firstChild),Ct=e,me=!0,tn=null,n=aE(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ds(),r===i){e=er(t,e,n);break e}tt(t,e,r,n)}e=e.child}return e;case 5:return cE(e),t===null&&bf(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,yf(r,i)?o=null:s!==null&&yf(r,s)&&(e.flags|=32),PE(t,e),tt(t,e,o,n),e.child;case 6:return t===null&&bf(e),null;case 13:return OE(t,e,n);case 4:return ig(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=gs(e,null,r,n):tt(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:$t(r,i),Qm(t,e,r,i,n);case 7:return tt(t,e,e.pendingProps,n),e.child;case 8:return tt(t,e,e.pendingProps.children,n),e.child;case 12:return tt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,ue(rl,r._currentValue),r._currentValue=o,s!==null)if(un(s.value,o)){if(s.children===i.children&&!dt.current){e=er(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(s.tag===1){c=Kn(-1,n&-n),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),Sf(s.return,n,e),a.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(O(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Sf(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}tt(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,is(e,n),i=Xt(i),r=r(i),e.flags|=1,tt(t,e,r,n),e.child;case 14:return r=e.type,i=$t(r,e.pendingProps),i=$t(r.type,i),qm(t,e,r,i,n);case 15:return ME(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:$t(r,i),Mc(t,e),e.tag=1,gt(r)?(t=!0,el(e)):t=!1,is(e,n),sE(e,r,i),Cf(e,r,i,n),If(null,e,r,!0,t,n);case 19:return DE(t,e,n);case 22:return RE(t,e,n)}throw Error(O(156,e.tag))};function qE(t,e){return bA(t,e)}function XC(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gt(t,e,n,r){return new XC(t,e,n,r)}function vg(t){return t=t.prototype,!(!t||!t.isReactComponent)}function KC(t){if(typeof t=="function")return vg(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Ud)return 11;if(t===kd)return 14}return 2}function Rr(t,e){var n=t.alternate;return n===null?(n=Gt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Lc(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")vg(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case ki:return ii(n.children,i,s,e);case Nd:o=8,i|=8;break;case Yh:return t=Gt(12,n,e,i|2),t.elementType=Yh,t.lanes=s,t;case Qh:return t=Gt(13,n,e,i),t.elementType=Qh,t.lanes=s,t;case qh:return t=Gt(19,n,e,i),t.elementType=qh,t.lanes=s,t;case oA:return Wl(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case iA:o=10;break e;case sA:o=9;break e;case Ud:o=11;break e;case kd:o=14;break e;case _r:o=16,r=null;break e}throw Error(O(130,t==null?t:typeof t,""))}return e=Gt(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function ii(t,e,n,r){return t=Gt(7,t,r,e),t.lanes=n,t}function Wl(t,e,n,r){return t=Gt(22,t,r,e),t.elementType=oA,t.lanes=n,t.stateNode={isHidden:!1},t}function ju(t,e,n){return t=Gt(6,t,null,e),t.lanes=n,t}function Wu(t,e,n){return e=Gt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function YC(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wu(0),this.expirationTimes=wu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wu(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Ag(t,e,n,r,i,s,o,a,c){return t=new YC(t,e,n,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Gt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},rg(s),t}function QC(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ui,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function ZE(t){if(!t)return Dr;t=t._reactInternals;e:{if(_i(t)!==t||t.tag!==1)throw Error(O(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(gt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(O(171))}if(t.tag===1){var n=t.type;if(gt(n))return qA(t,n,e)}return e}function $E(t,e,n,r,i,s,o,a,c){return t=Ag(n,r,!0,t,i,s,o,a,c),t.context=ZE(null),n=t.current,r=it(),i=Mr(n),s=Kn(r,i),s.callback=e??null,Br(n,s,i),t.current.lanes=i,sa(t,i,r),pt(t,r),t}function Jl(t,e,n,r){var i=e.current,s=it(),o=Mr(i);return n=ZE(n),e.context===null?e.context=n:e.pendingContext=n,e=Kn(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Br(i,e,o),t!==null&&(cn(t,i,o,s),xc(t,i,o)),o}function dl(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function l0(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Eg(t,e){l0(t,e),(t=t.alternate)&&l0(t,e)}function qC(){return null}var eT=typeof reportError=="function"?reportError:function(t){console.error(t)};function Tg(t){this._internalRoot=t}Xl.prototype.render=Tg.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(O(409));Jl(t,e,null,null)};Xl.prototype.unmount=Tg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;hi(function(){Jl(null,t,null,null)}),e[Zn]=null}};function Xl(t){this._internalRoot=t}Xl.prototype.unstable_scheduleHydration=function(t){if(t){var e=MA();t={blockedOn:null,target:t,priority:e};for(var n=0;n<vr.length&&e!==0&&e<vr[n].priority;n++);vr.splice(n,0,t),n===0&&PA(t)}};function bg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Kl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function u0(){}function ZC(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var l=dl(o);s.call(l)}}var o=$E(e,r,t,0,null,!1,!1,"",u0);return t._reactRootContainer=o,t[Zn]=o.current,ko(t.nodeType===8?t.parentNode:t),hi(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var l=dl(c);a.call(l)}}var c=Ag(t,0,!1,null,null,!1,!1,"",u0);return t._reactRootContainer=c,t[Zn]=c.current,ko(t.nodeType===8?t.parentNode:t),hi(function(){Jl(e,c,n,r)}),c}function Yl(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var c=dl(o);a.call(c)}}Jl(e,o,t,i)}else o=ZC(n,e,t,i,r);return dl(o)}BA=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=uo(e.pendingLanes);n!==0&&(zd(e,n|1),pt(e,we()),!($&6)&&(_s=we()+500,Gr()))}break;case 13:hi(function(){var r=$n(t,1);if(r!==null){var i=it();cn(r,t,1,i)}}),Eg(t,1)}};Hd=function(t){if(t.tag===13){var e=$n(t,134217728);if(e!==null){var n=it();cn(e,t,134217728,n)}Eg(t,134217728)}};IA=function(t){if(t.tag===13){var e=Mr(t),n=$n(t,e);if(n!==null){var r=it();cn(n,t,e,r)}Eg(t,e)}};MA=function(){return oe};RA=function(t,e){var n=oe;try{return oe=t,e()}finally{oe=n}};cf=function(t,e,n){switch(e){case"input":if(ef(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=kl(r);if(!i)throw Error(O(90));cA(r),ef(r,i)}}}break;case"textarea":uA(t,n);break;case"select":e=n.value,e!=null&&es(t,!!n.multiple,e,!1)}};_A=mg;yA=hi;var $C={usingClientEntryPoint:!1,Events:[aa,Hi,kl,pA,mA,mg]},Ks={findFiberByHostInstance:Zr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ex={bundleType:Ks.bundleType,version:Ks.version,rendererPackageName:Ks.rendererPackageName,rendererConfig:Ks.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ir.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=EA(t),t===null?null:t.stateNode},findFiberByHostInstance:Ks.findFiberByHostInstance||qC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ya=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ya.isDisabled&&Ya.supportsFiber)try{Dl=Ya.inject(ex),In=Ya}catch{}}It.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$C;It.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!bg(e))throw Error(O(200));return QC(t,e,null,n)};It.createRoot=function(t,e){if(!bg(t))throw Error(O(299));var n=!1,r="",i=eT;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Ag(t,1,!1,null,null,n,!1,r,i),t[Zn]=e.current,ko(t.nodeType===8?t.parentNode:t),new Tg(e)};It.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(O(188)):(t=Object.keys(t).join(","),Error(O(268,t)));return t=EA(e),t=t===null?null:t.stateNode,t};It.flushSync=function(t){return hi(t)};It.hydrate=function(t,e,n){if(!Kl(e))throw Error(O(200));return Yl(null,t,e,!0,n)};It.hydrateRoot=function(t,e,n){if(!bg(t))throw Error(O(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=eT;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=$E(e,null,t,1,n??null,i,!1,s,o),t[Zn]=e.current,ko(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new Xl(e)};It.render=function(t,e,n){if(!Kl(e))throw Error(O(200));return Yl(null,t,e,!1,n)};It.unmountComponentAtNode=function(t){if(!Kl(t))throw Error(O(40));return t._reactRootContainer?(hi(function(){Yl(null,null,t,!1,function(){t._reactRootContainer=null,t[Zn]=null})}),!0):!1};It.unstable_batchedUpdates=mg;It.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Kl(n))throw Error(O(200));if(t==null||t._reactInternals===void 0)throw Error(O(38));return Yl(t,e,n,!1,r)};It.version="18.2.0-next-9e3b772b8-20220608";function tT(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(tT)}catch(t){console.error(t)}}tT(),$v.exports=It;var Sg=$v.exports,h0=Sg;Xh.createRoot=h0.createRoot,Xh.hydrateRoot=h0.hydrateRoot;function ce(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Ql=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),f0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);f0&&parseFloat(f0[1]);const tx="3.4.14";function Rn(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Ju={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},nx=Ju.global||Ju.self||Ju.window||{},Yn=typeof process!="object"||String(process)!=="[object process]"||process.browser,wg=typeof importScripts=="function",rx=typeof window<"u"&&typeof window.orientation<"u",d0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);d0&&parseFloat(d0[1]);function Ko(t){"@babel/helpers - typeof";return Ko=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ko(t)}function ix(t,e){if(Ko(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Ko(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function sx(t){var e=ix(t,"string");return Ko(e)==="symbol"?e:String(e)}function d(t,e,n){return e=sx(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class ox{constructor(e,n){d(this,"name",void 0),d(this,"workerThread",void 0),d(this,"isRunning",!0),d(this,"result",void 0),d(this,"_resolve",()=>{}),d(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Rn(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Rn(this.isRunning),this.isRunning=!1,this._reject(e)}}let Xu=class{terminate(){}};const Ku=new Map;function ax(t){Rn(t.source&&!t.url||!t.source&&t.url);let e=Ku.get(t.source||t.url);return e||(t.url&&(e=cx(t.url),Ku.set(t.url,e)),t.source&&(e=nT(t.source),Ku.set(t.source,e))),Rn(e),e}function cx(t){if(!t.startsWith("http"))return t;const e=lx(t);return nT(e)}function nT(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function lx(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function rT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const r=n||new Set;if(t){if(g0(t))r.add(t);else if(g0(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)rT(t[i],e,r)}}return n===void 0?Array.from(r):[]}function g0(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Yu=()=>{};class Vf{static isSupported(){return typeof Worker<"u"&&Yn||typeof Xu<"u"&&!Yn}constructor(e){d(this,"name",void 0),d(this,"source",void 0),d(this,"url",void 0),d(this,"terminated",!1),d(this,"worker",void 0),d(this,"onMessage",void 0),d(this,"onError",void 0),d(this,"_loadableURL","");const{name:n,source:r,url:i}=e;Rn(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=Yu,this.onError=s=>console.log(s),this.worker=Yn?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Yu,this.onError=Yu,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||rT(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=ax({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Xu(r,{eval:!1})}else if(this.source)e=new Xu(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class ux{static isSupported(){return Vf.isSupported()}constructor(e){d(this,"name","unnamed"),d(this,"source",void 0),d(this,"url",void 0),d(this,"maxConcurrency",1),d(this,"maxMobileConcurrency",1),d(this,"onDebug",()=>{}),d(this,"reuseWorkers",!0),d(this,"props",{}),d(this,"jobQueue",[]),d(this,"idleQueue",[]),d(this,"count",0),d(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,o,a)=>s.done(a),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,o)=>s.error(o);const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new ox(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Vf({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return rx?this.maxMobileConcurrency:this.maxConcurrency}}const hx={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Vn{static isSupported(){return Vf.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Vn._workerFarm=Vn._workerFarm||new Vn({}),Vn._workerFarm.setProps(e),Vn._workerFarm}constructor(e){d(this,"props",void 0),d(this,"workerPools",new Map),this.props={...hx},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new ux({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}d(Vn,"_workerFarm",void 0);const fx="latest";function dx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},r="".concat(t.id,"-worker.js");let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(i="modules/".concat(t.module,"/dist/").concat(r)),!i){let s=t.version;s==="latest"&&(s=fx);const o=s?"@".concat(s):"";i="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(r)}return Rn(i),i}function gx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:tx;Rn(t,"no worker provided");const n=t.version;return!(!e||!n)}const px=null,mx=null,zf=null,iT=null,_x=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:px,readFileAsText:mx,requireFromFile:zf,requireFromString:iT},Symbol.toStringTag,{value:"Module"})),yx="3.4.14",Qu={};async function si(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e&&(t=vx(t,e,n)),Qu[t]=Qu[t]||Ax(t),await Qu[t]}function vx(t,e,n){if(t.startsWith("http"))return t;const r=n.modules||{};return r[t]?r[t]:Yn?n.CDN?(Rn(n.CDN.startsWith("http")),"".concat(n.CDN,"/").concat(e,"@").concat(yx,"/dist/libs/").concat(t)):wg?"../src/libs/".concat(t):"modules/".concat(e,"/src/libs/").concat(t):"modules/".concat(e,"/dist/libs/").concat(t)}async function Ax(t){if(t.endsWith("wasm"))return await(await fetch(t)).arrayBuffer();if(!Yn)try{return _x&&zf&&await zf(t)}catch{return null}if(wg)return importScripts(t);const n=await(await fetch(t)).text();return Ex(n,t)}function Ex(t,e){if(!Yn)return iT;if(wg)return eval.call(nx,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch{n.text=t}return document.body.appendChild(n),null}function Tx(t,e){return!Vn.isSupported()||!Yn&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function bx(t,e,n,r,i){const s=t.id,o=dx(t,n),c=Vn.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const l=await c.startJob("process-on-worker",Sx.bind(null,i));return l.postMessage("process",{input:e,options:n,context:r}),await(await l.result).result}async function Sx(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await t(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const c=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:c})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function wx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?p0(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?p0(t,0,e):""}function p0(t,e,n){if(t.byteLength<=e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}function Cx(t){try{return JSON.parse(t)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(wx(t),'"'))}}function xx(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function Bx(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=e.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),i=r.reduce((a,c)=>a+c.byteLength,0),s=new Uint8Array(i);let o=0;for(const a of r)s.set(a,o),o+=a.byteLength;return s.buffer}function Cg(t,e,n){const r=n!==void 0?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(r).buffer}function la(t,e){return ce(t>=0),ce(e>0),t+(e-1)&~(e-1)}function Ix(t,e,n){let r;if(t instanceof ArrayBuffer)r=new Uint8Array(t);else{const i=t.byteOffset,s=t.byteLength;r=new Uint8Array(t.buffer||t.arrayBuffer,i,s)}return e.set(r,n),n+la(r.byteLength,4)}async function Mx(t){const e=[];for await(const n of t)e.push(n);return Bx(...e)}function m0(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let _0=class{constructor(e,n){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=m0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(m0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},Rx=class{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof _0?i=e:i=new _0(n,r),this.stats[n]=i),i}};const Px="Queued Requests",Lx="Active Requests",Ox="Cancelled Requests",Dx="Queued Requests Ever",Fx="Active Requests Ever",Nx={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Ux{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};d(this,"props",void 0),d(this,"stats",void 0),d(this,"activeRequestCount",0),d(this,"requestQueue",[]),d(this,"requestMap",new Map),d(this,"deferredUpdate",null),this.props={...Nx,...e},this.stats=new Rx({id:this.props.id}),this.stats.get(Px),this.stats.get(Lx),this.stats.get(Ox),this.stats.get(Dx),this.stats.get(Fx)}scheduleRequest(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:n},i=new Promise(s=>(r.resolve=s,r));return this.requestQueue.push(r),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:n,resolve:r}=e;let i=!1;const s=()=>{i||(i=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const r=e[n];this._updateRequest(r)||(e.splice(n,1),this.requestMap.delete(r.handle),n--)}e.sort((n,r)=>n.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let kx="";const y0={};function Gx(t){for(const e in y0)if(t.startsWith(e)){const n=y0[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(kx).concat(t)),t}function Vx(t){return t&&typeof t=="object"&&t.isBuffer}function sT(t){if(Vx(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function oT(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function xg(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const zx=t=>typeof t=="boolean",wo=t=>typeof t=="function",ua=t=>t!==null&&typeof t=="object",v0=t=>ua(t)&&t.constructor==={}.constructor,Hx=t=>t&&typeof t[Symbol.iterator]=="function",jx=t=>t&&typeof t[Symbol.asyncIterator]=="function",yi=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,vi=t=>typeof Blob<"u"&&t instanceof Blob,Wx=t=>t&&typeof t=="object"&&t.isBuffer,Jx=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||ua(t)&&wo(t.tee)&&wo(t.cancel)&&wo(t.getReader),Xx=t=>ua(t)&&wo(t.read)&&wo(t.pipe)&&zx(t.readable),aT=t=>Jx(t)||Xx(t),Kx=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Yx=/^([-\w.]+\/[-\w.+]+)/;function Qx(t){const e=Yx.exec(t);return e?e[1]:t}function A0(t){const e=Kx.exec(t);return e?e[1]:""}const cT=/\?.*/;function qx(t){const e=t.match(cT);return e&&e[0]}function Bg(t){return t.replace(cT,"")}function ql(t){return yi(t)?t.url:vi(t)?t.name||"":typeof t=="string"?t:""}function Ig(t){if(yi(t)){const e=t,n=e.headers.get("content-type")||"",r=Bg(e.url);return Qx(n)||A0(r)}return vi(t)?t.type||"":typeof t=="string"?A0(t):""}function Zx(t){return yi(t)?t.headers["content-length"]||-1:vi(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function lT(t){if(yi(t))return t;const e={},n=Zx(t);n>=0&&(e["content-length"]=String(n));const r=ql(t),i=Ig(t);i&&(e["content-type"]=i);const s=await tB(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function $x(t){if(!t.ok){const e=await eB(t);throw new Error(e)}}async function eB(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let r=t.statusText;n.includes("application/json")&&(r+=" ".concat(await t.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function tB(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),r=nB(n);return"data:base64,".concat(r)}return null}function nB(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}async function E0(t,e){if(typeof t=="string"){t=Gx(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await lT(t)}function rB(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function ha(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||rB()}const Qa=globalThis.window||globalThis.self||globalThis.global,Ys=globalThis.process||{},uT=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";ha();function iB(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}let sB=class{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=iB(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}};function oB(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function aB(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function qu(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(n=Math.min(n,r/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let gl;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(gl||(gl={}));const cB=10;function T0(t){return typeof t!="string"?t:(t=t.toUpperCase(),gl[t]||gl.WHITE)}function lB(t,e,n){if(!ha&&typeof t=="string"){if(e){const r=T0(e);t="\x1B[".concat(r,"m").concat(t,"\x1B[39m")}if(n){const r=T0(n);t="\x1B[".concat(r+cB,"m").concat(t,"\x1B[49m")}}return t}function uB(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(t)))}}function pl(t,e){if(!t)throw new Error(e||"Assertion failed")}function wi(){let t;if(ha()&&Qa.performance){var e,n;t=Qa==null||(e=Qa.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in Ys){var r;const i=Ys==null||(r=Ys.hrtime)===null||r===void 0?void 0:r.call(Ys);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Ci={debug:ha()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},hB={enabled:!0,level:0};function Ft(){}const b0={},S0={once:!0};let Mg=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=uT,this._startTs=wi(),this._deltaTs=wi(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new sB("__probe-".concat(this.id,"__"),hB),this.timeStamp("".concat(this.id," started")),uB(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((wi()-this._startTs).toPrecision(10))}getDelta(){return Number((wi()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){pl(e,n)}warn(e){return this._getLogFunction(0,e,Ci.warn,arguments,S0)}error(e){return this._getLogFunction(0,e,Ci.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Ci.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Ci.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Ci.debug||Ci.info,arguments,S0)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Ft,r&&[r],{tag:pB(n)}):Ft}image(e){let{logLevel:n,priority:r,image:i,message:s="",scale:o=1}=e;return this._shouldLog(n||r)?ha()?gB({image:i,message:s,scale:o}):dB():Ft}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Ft)}group(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=w0({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ft)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=hT(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=w0({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,pl(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=wi();const o=s.tag||s.message;if(s.once&&o)if(!b0[o])b0[o]=wi();else return Ft;return n=fB(this.id,s.message,s),r.bind(console,n,...s.args)}return Ft}};Mg.VERSION=uT;function hT(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return pl(Number.isFinite(e)&&e>=0),e}function w0(t){const{logLevel:e,message:n}=t;t.logLevel=hT(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return pl(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function fB(t,e,n){if(typeof e=="string"){const r=n.time?aB(oB(n.total)):"";e=n.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),e=lB(e,n.color,n.background)}return e}function dB(t){return console.warn("removed"),Ft}function gB(t){let{image:e,message:n="",scale:r=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=qu(s,n,r);console.log(...o)},s.src=e,Ft}const i=e.nodeName||"";if(i.toLowerCase()==="img")return console.log(...qu(e,n,r)),Ft;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...qu(s,n,r)),s.src=e.toDataURL(),Ft}return Ft}function pB(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const C0=new Mg({id:"loaders.gl"});class mB{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class _B{constructor(){d(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.error.bind(this.console,...n)}}const fT={fetch:null,mimeType:void 0,nothrow:!1,log:new _B,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Ql,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},yB={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function dT(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const gT=()=>{const t=dT();return t.globalOptions=t.globalOptions||{...fT},t.globalOptions};function vB(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],AB(t,n),TB(e,t,r)}function AB(t,e){x0(t,null,fT,yB,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};x0(r,n.id,i,s,e)}}function x0(t,e,n,r,i){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const c=!e&&ua(t[a]),l=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!l&&!u){if(a in r)C0.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(r[a],"'"))();else if(!c){const h=EB(a,i);C0.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(h))()}}}}function EB(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return"Did you mean '".concat(i.id,".").concat(s,"'?");const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||"Did you mean '".concat(i.id,".").concat(s,"'?"))}return r}function TB(t,e,n){const i={...t.options||{}};return bB(i,n),i.log===null&&(i.log=new mB),B0(i,gT()),B0(i,e),i}function B0(t,e){for(const n in e)if(n in e){const r=e[n];v0(r)&&v0(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function bB(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Rg(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Pg(t){var e,n;ce(t,"null loader"),ce(Rg(t),"invalid loader");let r;return Array.isArray(t)&&(r=t[1],t=t[0],t={...t,options:{...t.options,...r}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const pT=()=>{const t=dT();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function SB(t){const e=pT();t=Array.isArray(t)?t:[t];for(const n of t){const r=Pg(n);e.find(i=>r===i)||e.unshift(r)}}function wB(){return pT()}const CB=new Mg({id:"loaders.gl"}),xB=/\.([^.]+)$/;async function BB(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!mT(t))return null;let i=I0(t,e,{...n,nothrow:!0},r);if(i)return i;if(vi(t)&&(t=await t.slice(0,10).arrayBuffer(),i=I0(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(_T(t));return i}function I0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!mT(t))return null;if(e&&!Array.isArray(e))return Pg(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...wB()),MB(i);const s=IB(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(_T(t));return s}function IB(t,e,n,r){const i=ql(t),s=Ig(t),o=Bg(i)||(r==null?void 0:r.url);let a=null,c="";if(n!=null&&n.mimeType&&(a=Zu(e,n==null?void 0:n.mimeType),c="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),a=a||RB(e,o),c=c||(a?"matched url ".concat(o):""),a=a||Zu(e,s),c=c||(a?"matched MIME type ".concat(s):""),a=a||LB(e,t),c=c||(a?"matched initial data ".concat(yT(t)):""),a=a||Zu(e,n==null?void 0:n.fallbackMimeType),c=c||(a?"matched fallback MIME type ".concat(s):""),c){var l;CB.log(1,"selectLoader selected ".concat((l=a)===null||l===void 0?void 0:l.name,": ").concat(c,"."))}return a}function mT(t){return!(t instanceof Response&&t.status===204)}function _T(t){const e=ql(t),n=Ig(t);let r="No valid loader found (";r+=e?"".concat(oT(e),", "):"no url provided, ",r+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const i=t?yT(t):"";return r+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",r+=")",r}function MB(t){for(const e of t)Pg(e)}function RB(t,e){const n=e&&xB.exec(e),r=n&&n[1];return r?PB(t,r):null}function PB(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function Zu(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function LB(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(OB(e,n))return n}else if(ArrayBuffer.isView(e)){if(M0(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&M0(e,0,n))return n;return null}function OB(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function M0(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>DB(t,e,n,i))}function DB(t,e,n,r){if(r instanceof ArrayBuffer)return xx(r,t,r.byteLength);switch(typeof r){case"function":return r(t,n);case"string":const i=Hf(t,e,r.length);return r===i;default:return!1}}function yT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Hf(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Hf(t,0,e):""}function Hf(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const FB=256*1024;function*NB(t,e){const n=(e==null?void 0:e.chunkSize)||FB;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const UB=256*1024;function kB(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=UB}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}()}const GB=1024*1024;async function*VB(t,e){const n=(e==null?void 0:e.chunkSize)||GB;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function R0(t,e){return Ql?zB(t,e):HB(t)}async function*zB(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield sT(o)}}catch{n.releaseLock()}}async function*HB(t,e){for await(const n of t)yield sT(n)}function jB(t,e){if(typeof t=="string")return NB(t,e);if(t instanceof ArrayBuffer)return kB(t,e);if(vi(t))return VB(t,e);if(aT(t))return R0(t,e);if(yi(t))return R0(t.body,e);throw new Error("makeIterator")}const vT="Cannot convert supplied data type";function WB(t,e,n){if(e.text&&typeof t=="string")return t;if(Wx(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(vT)}async function JB(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return WB(t,e);if(vi(t)&&(t=await lT(t)),yi(t)){const i=t;return await $x(i),e.binary?await i.arrayBuffer():await i.text()}if(aT(t)&&(t=jB(t,n)),Hx(t)||jx(t))return Mx(t);throw new Error(vT)}function AT(t,e){const n=gT(),r=t||n;return typeof r.fetch=="function"?r.fetch:ua(r.fetch)?i=>E0(i,r):e!=null&&e.fetch?e==null?void 0:e.fetch:E0}function XB(t,e,n){if(n)return n;const r={fetch:AT(e,t),...t};if(r.url){const i=Bg(r.url);r.baseUrl=i,r.queryString=qx(r.url),r.filename=oT(i),r.baseUrl=xg(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function KB(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:null}async function Lg(t,e,n,r){Rn(!r||typeof r=="object"),e&&!Array.isArray(e)&&!Rg(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=ql(t),o=KB(e,r),a=await BB(t,o,n);return a?(n=vB(n,a,o,i),r=XB({url:i,parse:Lg,loaders:o},n,r||null),await YB(a,t,n,r)):null}async function YB(t,e,n,r){if(gx(t),yi(e)){const i=e,{ok:s,redirected:o,status:a,statusText:c,type:l,url:u}=i,h=Object.fromEntries(i.headers.entries());r.response={headers:h,ok:s,redirected:o,status:a,statusText:c,type:l,url:u}}if(e=await JB(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,r,t);if(Tx(t,n))return await bx(t,e,n,r,Lg);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,r,t);if(t.parse)return await t.parse(e,n,r,t);throw Rn(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function Fr(t,e,n,r){!Array.isArray(e)&&!Rg(e)&&(n=e,e=void 0);const i=AT(n);let s=t;return typeof t=="string"&&(s=await i(t)),vi(t)&&(s=await i(t)),await Lg(s,e,n)}const QB="3.4.14",{_parseImageNode:qB}=globalThis,jf=typeof Image<"u",Wf=typeof ImageBitmap<"u",ZB=!!qB,Jf=Ql?!0:ZB;function $B(t){switch(t){case"auto":return Wf||jf||Jf;case"imagebitmap":return Wf;case"image":return jf;case"data":return Jf;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function eI(){if(Wf)return"imagebitmap";if(jf)return"image";if(Jf)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function tI(t){const e=rI(t);if(!e)throw new Error("Not an image");return e}function nI(t){switch(tI(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function rI(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const iI=/^data:image\/svg\+xml/,sI=/\.svg((\?|#).*)?$/;function Og(t){return t&&(iI.test(t)||sI.test(t))}function oI(t,e){if(Og(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return ET(t,e)}function ET(t,e){if(Og(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function TT(t,e,n){const r=oI(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await aI(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function aI(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>i(new Error("Could not load image ".concat(t,": ").concat(s)))}catch(s){i(s)}})}const cI={};let P0=!0;async function lI(t,e,n){let r;Og(n)?r=await TT(t,e,n):r=ET(t,n);const i=e&&e.imagebitmap;return await uI(r,i)}async function uI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((hI(e)||!P0)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),P0=!1}return await createImageBitmap(t)}function hI(t){for(const e in t||cI)return!1;return!0}function fI(t){return!mI(t,"ftyp",4)||!(t[8]&96)?null:dI(t)}function dI(t){switch(gI(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function gI(t,e,n){return String.fromCharCode(...t.slice(e,n))}function pI(t){return[...t].map(e=>e.charCodeAt(0))}function mI(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=pI(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const Sn=!1,Co=!0;function Dg(t){const e=fa(t);return yI(e)||EI(e)||vI(e)||AI(e)||_I(e)}function _I(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=fI(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function yI(t){const e=fa(t);return e.byteLength>=24&&e.getUint32(0,Sn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Sn),height:e.getUint32(20,Sn)}:null}function vI(t){const e=fa(t);return e.byteLength>=10&&e.getUint32(0,Sn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Co),height:e.getUint16(8,Co)}:null}function AI(t){const e=fa(t);return e.byteLength>=14&&e.getUint16(0,Sn)===16973&&e.getUint32(2,Co)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Co),height:e.getUint32(22,Co)}:null}function EI(t){const e=fa(t);if(!(e.byteLength>=3&&e.getUint16(0,Sn)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=TI();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Sn);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Sn),width:e.getUint16(s+7,Sn)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,Sn)}return null}function TI(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function fa(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function bI(t,e){const{mimeType:n}=Dg(t)||{},r=globalThis._parseImageNode;return ce(r),await r(t,n)}async function SI(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=wI(i);let a;switch(o){case"imagebitmap":a=await lI(t,e,s);break;case"image":a=await TT(t,e,s);break;case"data":a=await bI(t);break;default:ce(!1)}return i==="data"&&(a=nI(a)),a}function wI(t){switch(t){case"auto":case"data":return eI();default:return $B(t),t}}const CI=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],xI=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],BI={image:{type:"auto",decode:!0}},bT={id:"image",module:"images",name:"Images",version:QB,mimeTypes:xI,extensions:CI,parse:SI,tests:[t=>!!Dg(new DataView(t))],options:BI},$u={};function II(t){if($u[t]===void 0){const e=Ql?RI(t):MI(t);$u[t]=e}return $u[t]}function MI(t){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:n,_imageFormatsNode:r=e}=globalThis;return!!n&&r.includes(t)}function RI(t){switch(t){case"image/avif":case"image/webp":return PI(t);default:return!0}}function PI(t){try{return document.createElement("canvas").toDataURL(t).indexOf("data:".concat(t))===0}catch{return!1}}function ST(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function sr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||ST()}const Oc={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},qa=Oc.window||Oc.self||Oc.global,Qs=Oc.process||{},wT=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";sr();const eh=globalThis;function CT(t){if(!t&&!sr())return"Node";if(ST(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const r=n.indexOf("MSIE ")!==-1,i=n.indexOf("Trident/")!==-1;return r||i?"IE":eh.chrome?"Chrome":eh.safari?"Safari":eh.mozInnerScreenX?"Firefox":"Unknown"}function LI(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class OI{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";d(this,"storage",void 0),d(this,"id",void 0),d(this,"config",void 0),this.storage=LI(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function DI(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function FI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function th(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(n=Math.min(n,r/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let ml;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(ml||(ml={}));function L0(t){return typeof t=="string"?ml[t.toUpperCase()]||ml.WHITE:t}function NI(t,e,n){return!sr&&typeof t=="string"&&(e&&(e=L0(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=L0(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function UI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n);for(const i of r)typeof t[i]=="function"&&(e.find(s=>i===s)||(t[i]=t[i].bind(t)))}function _l(t,e){if(!t)throw new Error(e||"Assertion failed")}function xi(){let t;if(sr&&"performance"in qa){var e,n;t=qa==null||(e=qa.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in Qs){var r;const i=Qs==null||(r=Qs.hrtime)===null||r===void 0?void 0:r.call(Qs);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Bi={debug:sr&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},kI={enabled:!0,level:0};function Nt(){}const O0={},D0={once:!0};class Fg{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};d(this,"id",void 0),d(this,"VERSION",wT),d(this,"_startTs",xi()),d(this,"_deltaTs",xi()),d(this,"_storage",void 0),d(this,"userData",{}),d(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new OI("__probe-".concat(this.id,"__"),kI),this.timeStamp("".concat(this.id," started")),UI(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((xi()-this._startTs).toPrecision(10))}getDelta(){return Number((xi()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){_l(e,n)}warn(e){return this._getLogFunction(0,e,Bi.warn,arguments,D0)}error(e){return this._getLogFunction(0,e,Bi.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Bi.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Bi.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return this._getLogFunction(e,n,Bi.debug||Bi.info,arguments,D0)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Nt,r&&[r],{tag:HI(n)}):Nt}image(e){let{logLevel:n,priority:r,image:i,message:s="",scale:o=1}=e;return this._shouldLog(n||r)?sr?zI({image:i,message:s,scale:o}):VI():Nt}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Nt)}group(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=F0({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Nt)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=xT(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=F0({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,_l(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=xi();const o=s.tag||s.message;if(s.once)if(!O0[o])O0[o]=xi();else return Nt;return n=GI(this.id,s.message,s),r.bind(console,n,...s.args)}return Nt}}d(Fg,"VERSION",wT);function xT(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return _l(Number.isFinite(e)&&e>=0),e}function F0(t){const{logLevel:e,message:n}=t;t.logLevel=xT(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return _l(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function GI(t,e,n){if(typeof e=="string"){const r=n.time?FI(DI(n.total)):"";e=n.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),e=NI(e,n.color,n.background)}return e}function VI(t){return console.warn("removed"),Nt}function zI(t){let{image:e,message:n="",scale:r=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=th(s,n,r);console.log(...o)},s.src=e,Nt}const i=e.nodeName||"";if(i.toLowerCase()==="img")return console.log(...th(e,n,r)),Nt;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...th(s,n,r)),s.src=e.toDataURL(),Nt}return Nt}function HI(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const q=new Fg({id:"deck"});let Xf={};function jI(t){Xf=t}function Ke(t,e,n,r){q.level>0&&Xf[t]&&Xf[t].call(null,e,n,r)}function WI(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const JI={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:WI,parseTextSync:JSON.parse};function XI(){const t="8.9.32",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(q.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:q,_registerLoggers:jI},SB([JI,[bT,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const KI=XI(),W={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(W,"IDENTITY",{get:()=>(q.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Cn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Kf={common:0,meters:1,pixels:2},N0={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},V=new Fg({id:"luma.gl"});function nt(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const YI="Invalid WebGLRenderingContext",QI="Requires WebGL2";function Zl(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function J(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function qI(t){return J(t)?t:null}function $l(t){return nt(Zl(t),YI),t}function rt(t){return nt(J(t),QI),t}const fo={};function ZI(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function $I(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function eM(t,e){fo[t]=!0,e!==void 0&&ZI(e)}function tM(t){const e=t.getError;t.getError=function(){let r;do r=e.apply(t),r!==0&&(fo[r]=!0);while(r!==0);for(r in fo)if(fo[r])return delete fo[r],parseInt(r,10);return 0}}const da=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const i=new t.VertexAttrib(n);this.attribs[r]=i}this.maxAttrib=0};da.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};da.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Ai=function(e){const n=this;this.gl=e,tM(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(s){return s===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(s,o){switch(s){case 34962:n.currentArrayBuffer=o;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=o;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(s,o){const c=n.currentVertexArrayObject.attribs[s];switch(o){case 34975:return c.buffer;case 34338:return c.enabled;case 34339:return c.size;case 34340:return c.stride;case 34341:return c.type;case 34922:return c.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(s,o,a,c,l,u){const h=n.currentVertexArrayObject;h.maxAttrib=Math.max(h.maxAttrib,s);const f=h.attribs[s];return f.buffer=n.currentArrayBuffer,f.size=o,f.type=a,f.normalized=c,f.stride=l,f.offset=u,f.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{$I("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Ai.prototype.VERTEX_ARRAY_BINDING_OES=34229;Ai.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new da(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Ai.prototype.createVertexArrayOES=function(){const e=new da(this);return this.vertexArrayObjects.push(e),e};Ai.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Ai.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof da&&e.hasBeenBound&&e.ext===this)};Ai.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){eM(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(i===s)return;(!i||s.elementArrayBuffer!==i.elementArrayBuffer)&&r.bindBuffer.call(n,34963,s.elementArrayBuffer);let o=this.currentArrayBuffer;const a=Math.max(i?i.maxAttrib:0,s.maxAttrib);for(let c=0;c<=a;c++){const l=s.attribs[c],u=i?i.attribs[c]:null;if((!i||l.enabled!==u.enabled)&&(l.enabled?r.enableVertexAttribArray.call(n,c):r.disableVertexAttribArray.call(n,c)),l.enabled){let h=!1;(!i||l.buffer!==u.buffer)&&(o!==l.buffer&&(r.bindBuffer.call(n,34962,l.buffer),o=l.buffer),h=!0),(h||l.cached!==u.cached)&&r.vertexAttribPointer.call(n,c,l.size,l.type,l.normalized,l.stride,l.offset)}}this.currentArrayBuffer!==o&&r.bindBuffer.call(n,34962,this.currentArrayBuffer)};function nM(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=e.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};const n=t.getExtension;t.getExtension=function(i){const s=n.call(this,i);return s||(i!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Ai(this)),this.__OESVertexArrayObject))}}const U0="OES_element_index",k0="WEBGL_draw_buffers",rM="EXT_disjoint_timer_query",iM="EXT_disjoint_timer_query_webgl2",sM="EXT_texture_filter_anisotropic",G0="WEBGL_debug_renderer_info",oM=35723,aM=4352,cM=36795,lM=34047,uM=37445,hM=37446,le=t=>J(t)?void 0:0,fM={3074:t=>J(t)?void 0:36064,[oM]:t=>J(t)?void 0:aM,35977:le,32937:le,[cM]:(t,e)=>{const n=J(t)?t.getExtension(iM):t.getExtension(rM);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[uM]:(t,e)=>{const n=t.getExtension(G0);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[hM]:(t,e)=>{const n=t.getExtension(G0);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[lM]:(t,e)=>{const n=t.luma.extensions[sM];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:le,35071:le,37447:le,36063:(t,e)=>{if(!J(t)){const n=t.getExtension(k0);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:le,35374:le,35377:le,34852:t=>{if(!J(t)){const e=t.getExtension(k0);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(U0)?2147483647:65535,33001:t=>t.getExtension(U0)?16777216:65535,33e3:t=>16777216,37157:le,35373:le,35657:le,36183:le,37137:le,34045:le,35978:le,35979:le,35968:le,35376:le,35375:le,35659:le,37154:le,35371:le,35658:le,35076:le,35077:le,35380:le};function dM(t,e,n){const r=fM[n],i=typeof r=="function"?r(t,e,n):r;return i!==void 0?i:e(n)}const gM="OES_vertex_array_object",BT="ANGLE_instanced_arrays",pM="WEBGL_draw_buffers",mM="EXT_disjoint_timer_query",_M="EXT_texture_filter_anisotropic",yM="VertexArray requires WebGL2 or OES_vertex_array_object extension";function vM(t,e){return{webgl2:J(t),ext:t.getExtension(e)}}const IT={[gM]:{meta:{suffix:"OES"},createVertexArray:()=>{nt(!1,yM)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[BT]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){nt(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[pM]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{nt(!1)}},[mM]:{meta:{suffix:"EXT"},createQuery:()=>{nt(!1)},deleteQuery:()=>{nt(!1)},beginQuery:()=>{nt(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},nh={readBuffer:(t,e,n)=>{J(t)&&e(n)},getVertexAttrib:(t,e,n,r)=>{const{webgl2:i,ext:s}=vM(t,BT);let o;switch(r){case 35069:o=i?void 0:!1;break;case 35070:o=!i&&!s?0:void 0;break}return o!==void 0?o:e(n,r)},getProgramParameter:(t,e,n,r)=>{if(!J(t))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,r)},getInternalformatParameter:(t,e,n,r,i)=>{if(!J(t))switch(i){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,r,i)},getTexParameter(t,e,n,r){switch(r){case 34046:const{extensions:i}=t.luma,s=i[_M];r=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,r)},getParameter:dM,hint(t,e,n,r){return e(n,r)}};function AM(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(nM(t),EM(t),bM(t,IT),TM(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=AM;function EM(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function TM(t,e){let{target:n,target2:r}=e;Object.keys(nh).forEach(i=>{if(typeof nh[i]=="function"){const s=t[i]?t[i].bind(t):()=>{},o=nh[i].bind(null,t,s);n[i]=o,r[i]=o}})}function bM(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&SM(t,{extension:n,target:t.luma,target2:t})}function SM(t,e){let{extension:n,target:r,target2:i}=e;const s=IT[n];nt(s);const{meta:o={}}=s,{suffix:a=""}=o,c=t.getExtension(n);for(const l of Object.keys(s)){const u="".concat(l).concat(a);let h=null;l==="meta"||typeof t[l]=="function"||(c&&typeof c[u]=="function"?h=function(){return c[u](...arguments)}:typeof s[l]=="function"&&(h=s[l].bind(r))),h&&(r[l]=h,i[l]=h)}}const Ng={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ur=(t,e,n)=>e?t.enable(n):t.disable(n),V0=(t,e,n)=>t.hint(n,e),_t=(t,e,n)=>t.pixelStorei(n,e),wM=(t,e)=>{const n=J(t)?36009:36160;return t.bindFramebuffer(n,e)},CM=(t,e)=>t.bindFramebuffer(36008,e);function qs(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const xM={3042:ur,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:ur,2885:(t,e)=>t.cullFace(e),2929:ur,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:ur,35723:V0,36006:wM,2886:(t,e)=>t.frontFace(e),33170:V0,2849:(t,e)=>t.lineWidth(e),32823:ur,32824:"polygonOffset",10752:"polygonOffset",35977:ur,32938:"sampleCoverage",32939:"sampleCoverage",3089:ur,3088:(t,e)=>t.scissor(...e),2960:ur,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:_t,3317:_t,37440:_t,37441:_t,37443:_t,3330:_t,3332:_t,3331:_t,36010:CM,3314:_t,32878:_t,3316:_t,3315:_t,32877:_t,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=qs(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=qs(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=qs(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=qs(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=qs(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function Ee(t,e,n){return e[t]!==void 0?e[t]:n[t]}const BM={blendEquation:(t,e,n)=>t.blendEquationSeparate(Ee(32777,e,n),Ee(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Ee(32969,e,n),Ee(32968,e,n),Ee(32971,e,n),Ee(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Ee(32824,e,n),Ee(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Ee(32938,e,n),Ee(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Ee(2962,e,n),Ee(2967,e,n),Ee(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Ee(34816,e,n),Ee(36003,e,n),Ee(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Ee(2964,e,n),Ee(2965,e,n),Ee(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Ee(34817,e,n),Ee(34818,e,n),Ee(34819,e,n))},z0={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},yn=(t,e)=>t.isEnabled(e),H0={3042:yn,2884:yn,2929:yn,3024:yn,32823:yn,32926:yn,32928:yn,3089:yn,2960:yn,35977:yn};function MT(t){for(const e in t)return!1;return!0}function IM(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}function j0(t,e){const n=t[e].bind(t);t[e]=function(){const i=arguments.length<=0?void 0:arguments[0];return i in t.state.cache?t.state.enable?t.state.cache[i]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function MM(t,e,n){const r=t[e].bind(t);t[e]=function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];const{valueChanged:c,oldValue:l}=n(t.state._updateCache,...o);return c&&r(...o),l},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function RM(t){const e=t.useProgram.bind(t);t.useProgram=function(r){t.state.program!==r&&(e(r),t.state.program=r)}}class PM{constructor(e){let{copyState:n=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?PT(e):Object.assign({},Ng),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){nt(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];tr(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in e){nt(s!==void 0);const o=e[s],a=this.cache[s];IM(o,a)||(n=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function RT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:r}=e;if(nt(r!==void 0),!t.state){const{polyfillContext:i}=globalThis;i&&i(t),t.state=new PM(t,{copyState:r}),RM(t);for(const s in z0){const o=z0[s];MM(t,s,o)}j0(t,"getParameter"),j0(t,"isEnabled")}return t.state.enable=n,t}function LM(t){t.state||RT(t,{copyState:!1}),t.state.push()}function W0(t){nt(t.state),t.state.pop()}function tr(t,e){if(nt(Zl(t),"setParameters requires a WebGL context"),MT(e))return;const n={};for(const i in e){const s=Number(i),o=xM[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=BM[i];s(t,e,r)}}function PT(t,e){if(e=e||Ng,typeof e=="number"){const i=e,s=H0[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=H0[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function OM(t){tr(t,Ng)}function Wt(t,e,n){if(MT(e))return n(t);const{nocatch:r=!0}=e;LM(t),tr(t,e);let i;if(r)i=n(t),W0(t);else try{i=n(t)}finally{W0(t)}return i}function fi(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,r="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return r?t.drawingBufferWidth/r:1}return 1}function rh(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=fi(t),i=t.drawingBufferWidth,s=t.drawingBufferHeight;return FM(e,r,i,s,n)}function DM(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function FM(t,e,n,r,i){const s=J0(t[0],e,n);let o=X0(t[1],e,r,i),a=J0(t[0]+1,e,n);const c=a===n-1?a:a-1;a=X0(t[1]+1,e,r,i);let l;return i?(a=a===0?a:a+1,l=o,o=a):l=a===r-1?a:a-1,{x:s,y:o,width:Math.max(c-s+1,1),height:Math.max(l-o+1,1)}}function J0(t,e,n){return Math.min(Math.round(t*e),n-1)}function X0(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Ug=sr(),NM=Ug&&typeof document<"u",LT={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function OT(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};nt(Ug,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},LT,t);const{width:e,height:n}=t;function r(a){if(t.throwOnError)throw new Error(a);return console.error(a),null}t.onError=r;let i;const{canvas:s}=t,o=VM({canvas:s,width:e,height:n,onError:r});return i=GM(o,t),i?(i=kg(i,t),zM(i),i):null}function kg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||HM(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},LT,e);const{manageState:n,debug:r}=e;return n&&RT(t,{copyState:!1,log:function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return V.log(1,...s)()}}),Ug&&r&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),V.level=Math.max(V.level,1)):V.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function UM(t){const e=t.getParameter(7936),n=t.getParameter(7937),r=t.getExtension("WEBGL_debug_renderer_info"),i=r&&t.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),s=r&&t.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||e,renderer:s||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function kM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const r=DM(e.useDevicePixels);jM(t,r,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function GM(t,e){const{onError:n}=e;let r=null;const i=c=>r=c.statusMessage||r;t.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:s=!0,webgl2:o=!0}=e;let a=null;return o&&(a=a||t.getContext("webgl2",e),a=a||t.getContext("experimental-webgl2",e)),s&&(a=a||t.getContext("webgl",e),a=a||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",i,!1),a?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),a):n("Failed to create ".concat(o&&!s?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function VM(t){let{canvas:e,width:n=800,height:r=600,onError:i}=t,s;return typeof e=="string"?(NM&&document.readyState==="complete"||i("createGLContext called on canvas '".concat(e,"' before page was loaded")),s=document.getElementById(e)):e?s=e:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",s.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function zM(t){const e=J(t)?"WebGL2":"WebGL1",n=UM(t),r=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",i=t.debug?" debug":"";V.info(1,"".concat(e).concat(i," context ").concat(r))()}function HM(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function jM(t,e,n){let r="width"in n?n.width:t.canvas.clientWidth,i="height"in n?n.height:t.canvas.clientHeight;(!r||!i)&&(V.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=t.canvas.width||1,i=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),c=Math.floor(i*o);t.canvas.width=a,t.canvas.height=c,(t.drawingBufferWidth!==a||t.drawingBufferHeight!==c)&&(V.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/r,t.drawingBufferHeight/i),t.canvas.width=Math.floor(r*o),t.canvas.height=Math.floor(i*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:r,clientHeight:i,devicePixelRatio:e})}}function K0(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let Y0=class{constructor(e,n){d(this,"name",void 0),d(this,"type",void 0),d(this,"sampleSize",1),d(this,"time",void 0),d(this,"count",void 0),d(this,"samples",void 0),d(this,"lastTiming",void 0),d(this,"lastSampleTime",void 0),d(this,"lastSampleCount",void 0),d(this,"_count",0),d(this,"_time",0),d(this,"_samples",0),d(this,"_startTime",0),d(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=K0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(K0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},Gg=class{constructor(e){d(this,"id",void 0),d(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:r}=e;return this.stats[n]||(e instanceof Y0?this.stats[n]=e:this.stats[n]=new Y0(n,r)),this.stats[n]}};const xo="8.5.21",WM="set luma.log.level=1 (or higher) to trace rendering";class JM{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Gg({id:e})),this.stats.get(e)}}const ti=new JM;if(globalThis.luma&&globalThis.luma.VERSION!==xo)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(xo));globalThis.luma||(sr()&&V.log(1,"luma.gl ".concat(xo," - ").concat(WM))(),globalThis.luma=globalThis.luma||{VERSION:xo,version:xo,log:V,stats:ti,globals:{modules:{},nodeIO:{}}});function XM(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function KM(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function N(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function ih(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const r=t[e];return N(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function Pr(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const sh={};function nr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";sh[t]=sh[t]||1;const e=sh[t]++;return"".concat(t,"-").concat(e)}function Q0(t){return N(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function ys(t){let e=!0;for(const n in t){e=!1;break}return e}function DT(t,e,n,r){const i="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(t);r.forEach(o=>{s.methodName||(s[o]=()=>{throw V.removed("Calling removed method ".concat(e,".").concat(o,": "),i)(),new Error(o)})})}const Ii="Resource subclass must define virtual methods";let or=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$l(e);const{id:r,userData:i={}}=n;this.gl=e,this.gl2=e,this.id=r||nr(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=ih(this.gl,e),N(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const s=J(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension)))){const a=i.webgl1,c="webgl2"in i?i.webgl2:i.webgl1;return s?c:a}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:r}=e,i=this.constructor.PARAMETERS||{},s=J(this.gl),o={},a=n||Object.keys(i);for(const c of a){const l=i[c];if(l&&(!("webgl2"in l)||s)&&(!("extension"in l)||this.gl.getExtension(l.extension))){const h=r?Pr(this.gl,c):c;o[h]=this.getParameter(c,e),r&&l.type==="GLenum"&&(o[h]=Pr(this.gl,o[h]))}}return o}setParameter(e,n){e=ih(this.gl,e),N(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const s=J(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension))))throw new Error("Parameter not available on this platform");i.type==="GLenum"&&(n=ih(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,r){return DT(this,e,n,r)}initialize(e){}_createHandle(){throw new Error(Ii)}_deleteHandle(){throw new Error(Ii)}_bindHandle(e){throw new Error(Ii)}_getOptsFromHandle(){throw new Error(Ii)}_getParameter(e,n){throw new Error(Ii)}_setParameter(e,n){throw new Error(Ii)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=ti.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];ti.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const i=ti.get("Memory Usage".concat(r));i.get("GPU Memory").addCount(e),i.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=ti.get("Memory Usage".concat(n));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const YM="Failed to deduce GL constant from typed array";function Yf(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(YM)}}function Yo(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function QM(t){let{data:e,width:n,height:r,bytesPerPixel:i=4,temp:s}=t;const o=n*i;s=s||new Uint8Array(o);for(let a=0;a<r/2;++a){const c=a*o,l=(r-a-1)*o;s.set(e.subarray(c,c+o)),e.copyWithin(c,l,l+o),e.set(s,l)}}function qM(t){let{data:e,width:n,height:r}=t;const i=Math.round(n/2),s=Math.round(r/2),o=new Uint8Array(i*s*4);for(let a=0;a<s;a++)for(let c=0;c<i;c++)for(let l=0;l<4;l++)o[(a*i+c)*4+l]=e[(a*2*n+c*2)*4+l];return{data:o,width:i,height:s}}function Qf(t,e,n){const{removedProps:r={},deprecatedProps:i={},replacedProps:s={}}=n;for(const a in r)if(a in e){const l=r[a]?"".concat(t,".").concat(r[a]):"N/A";V.removed("".concat(t,".").concat(a),l)()}for(const a in i)if(a in e){const c=i[a];V.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(c))()}let o=null;for(const a in s)if(a in e){const c=s[a];V.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(c))(),o=o||Object.assign({},e),o[c]=e[a],delete o[a]}return o||e}const ZM={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},$M={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ut{static getBytesPerElement(e){return Yo(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return N(e.size),Yo(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new ut(ZM,...n)}constructor(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(i=>this._assign(i)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ut.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ut.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Qf("Accessor",e,$M),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const q0=10,FT={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},eR={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:FT},tR={removedProps:FT};class se extends or{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ut.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ut.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Qf("Buffer",e,eR),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=Qf("Buffer",e,tR),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new ut(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:r=0,srcOffset:i=0}=e,s=e.byteLength||e.length;N(n);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),i!==0||s!==void 0?(rt(this.gl),this.gl.bufferSubData(this.target,r,n,i,s)):this.gl.bufferSubData(o,r,n),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:r=0,writeOffset:i=0,size:s}=e;const{gl:o}=this;return rt(o),o.bindBuffer(36662,n.handle),o.bindBuffer(36663,this.handle),o.copyBufferSubData(36662,36663,r,i,s),o.bindBuffer(36662,null),o.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:r=0,length:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};rt(this.gl);const s=Yo(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(n),a=r;let c,l;e?(l=e.length,c=l-a):(c=Math.min(o,i||o),l=a+c);const u=Math.min(o,c);return i=i||u,N(i<=u),e=e||new s(l),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,r,i),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:r=0,size:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?i!==void 0?this.gl.bindBufferRange(e,n,this.handle,r,i):(N(r===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(q0,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;N(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.usage),this.gl.bufferSubData(i,n,e),this.gl.bindBuffer(i,null),this.debugData=e.slice(0,q0),this.bytesUsed=r,this._trackAllocatedMemory(r);const s=Yf(e);return N(s),this.setAccessor(new ut(this.accessor,{type:s})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;N(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,n),this.gl.bindBuffer(i,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=Yo(this.accessor.type||5126,{clamped:!1}),r=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new ut(this.accessor,{type:Yf(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return V.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return V.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return V.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return V.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new ut(this.accessor,e),this}}const Vg={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},NT={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},UT={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function nR(t,e){const n=Vg[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const r=J(t)&&n.gl2||n.gl1;return typeof r=="string"?t.getExtension(r):r}function rR(t,e){const n=Vg[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const iR=[9729,9728],Z0=globalThis.WebGLBuffer||function(){};class vs extends or{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:i}=n;let s=!0;return r&&(s=s&&nR(e,r),s=s&&(!i||rR(e,r))),s}constructor(e,n){const{id:r=nr("texture"),handle:i,target:s}=n;super(e,{id:r,handle:i}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(m=>this.initialize(Object.assign({},e,{pixels:m,data:m}))),this;const r=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(r&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:i=null,format:s=6408,border:o=0,recreate:a=!1,parameters:c={},pixelStore:l={},textureUnit:u=void 0}=e;n||(n=i);let{width:h,height:f,dataFormat:g,type:p,compressed:A=!1,mipmaps:b=!0}=e;const{depth:_=0}=e;return{width:h,height:f,compressed:A,dataFormat:g,type:p}=this._deduceParameters({format:s,type:p,dataFormat:g,compressed:A,data:n,width:h,height:f}),this.width=h,this.height=f,this.depth=_,this.format=s,this.type=p,this.dataFormat=g,this.border=o,this.textureUnit=u,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),b&&this._isNPOT()&&(V.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),b=!1,this._updateForNPOT(c)),this.mipmaps=b,this.setImageData({data:n,width:h,height:f,depth:_,format:s,type:p,dataFormat:g,border:o,mipmaps:b,parameters:l,compressed:A}),b&&this.generateMipmap(),this.setParameters(c),a&&(this.data=n),r&&(this._video={video:n,parameters:c,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:r,mipmaps:i=!1}=e;return r!==this.width||n!==this.height?this.initialize({width:r,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(V.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Wt(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:r=null,level:i=0,format:s=this.format,border:o=this.border,offset:a=0,parameters:c={}}=e;let{data:l=null,type:u=this.type,width:h=this.width,height:f=this.height,dataFormat:g=this.dataFormat,compressed:p=!1}=e;l||(l=r),{type:u,dataFormat:g,compressed:p,width:h,height:f}=this._deduceParameters({format:s,type:u,dataFormat:g,compressed:p,data:l,width:h,height:f});const{gl:A}=this;A.bindTexture(this.target,this.handle);let b=null;({data:l,dataType:b}=this._getDataType({data:l,compressed:p}));let _,m=0;if(Wt(this.gl,c,()=>{switch(b){case"null":A.texImage2D(n,i,s,h,f,o,g,u,l);break;case"typed-array":A.texImage2D(n,i,s,h,f,o,g,u,l,a);break;case"buffer":_=rt(A),_.bindBuffer(35052,l.handle||l),_.texImage2D(n,i,s,h,f,o,g,u,a),_.bindBuffer(35052,null);break;case"browser-object":J(A)?A.texImage2D(n,i,s,h,f,o,g,u,l):A.texImage2D(n,i,s,g,u,l);break;case"compressed":for(const[v,T]of l.entries())A.compressedTexImage2D(n,v,T.format,T.width,T.height,o,T.data),m+=T.levelSize;break;default:N(!1,"Unknown image data type")}}),b==="compressed")this._trackAllocatedMemory(m,"Texture");else if(l&&l.byteLength)this._trackAllocatedMemory(l.byteLength,"Texture");else{const v=NT[this.dataFormat]||4,T=UT[this.type]||1;this._trackAllocatedMemory(this.width*this.height*v*T,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:r=null,data:i=null,x:s=0,y:o=0,width:a=this.width,height:c=this.height,level:l=0,format:u=this.format,type:h=this.type,dataFormat:f=this.dataFormat,compressed:g=!1,offset:p=0,border:A=this.border,parameters:b={}}=e;if({type:h,dataFormat:f,compressed:g,width:a,height:c}=this._deduceParameters({format:u,type:h,dataFormat:f,compressed:g,data:i,width:a,height:c}),N(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const _=i;i=_.data,a=_.shape[0],c=_.shape[1]}i instanceof se&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Wt(this.gl,b,()=>{if(g)this.gl.compressedTexSubImage2D(n,l,s,o,a,c,u,i);else if(i===null)this.gl.texSubImage2D(n,l,s,o,a,c,f,h,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(n,l,s,o,a,c,f,h,i,p);else if(i instanceof Z0){const _=rt(this.gl);_.bindBuffer(35052,i),_.texSubImage2D(n,l,s,o,a,c,f,h,p),_.bindBuffer(35052,null)}else J(this.gl)?rt(this.gl).texSubImage2D(n,l,s,o,a,c,f,h,i):this.gl.texSubImage2D(n,l,s,o,f,h,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return V.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:r=!1}=e;return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof se?{data:n.handle,dataType:"buffer"}:n instanceof Z0?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:r}=e;let{width:i,height:s,dataFormat:o,type:a,compressed:c}=e;const l=Vg[n];return o=o||l&&l.dataFormat,a=a||l&&l.types[0],c=c||l&&l.compressed,{width:i,height:s}=this._deduceImageSize(r,i,s),{dataFormat:o,type:a,compressed:c,width:i,height:s,format:n,data:r}}_deduceImageSize(e,n,r){let i;return typeof ImageData<"u"&&e instanceof ImageData?i={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?i={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?i={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?i={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?i={width:e.videoWidth,height:e.videoHeight}:e?i={width:n,height:r}:i={width:n>=0?n:1,height:r>=0?r:1},N(i,"Could not deduced texture size"),N(n===void 0||i.width===n,"Deduced texture width does not match supplied width"),N(r===void 0||i.height===r,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:N(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return J(this.gl)||!this.width||!this.height?!1:!Q0(this.width)||!Q0(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:iR.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let sR="";function oR(t,e){return N(typeof t=="string"),t=sR+t,new Promise((n,r)=>{try{const i=new Image;i.onload=()=>n(i),i.onerror=()=>r(new Error("Could not load image ".concat(t,"."))),i.crossOrigin=e&&e.crossOrigin||"anonymous",i.src=t}catch(i){r(i)}})}class qe extends vs{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return vs.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$l(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:oR(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const qf=[34069,34070,34071,34072,34073,34074];class kT extends vs{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$l(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:n,data:r,x:i=0,y:s=0,mipmapLevel:o=0}=e;return this._subImage({target:n,data:r,x:i,y:s,mipmapLevel:o})}async setCubeMapImageData(e){let{width:n,height:r,pixels:i,data:s,border:o=0,format:a=6408,type:c=5121}=e;const{gl:l}=this,u=i||s,h=await Promise.all(qf.map(f=>{const g=u[f];return Promise.all(Array.isArray(g)?g:[g])}));this.bind(),qf.forEach((f,g)=>{h[g].length>1&&this.opts.mipmaps!==!1&&V.warn("".concat(this.id," has mipmap and multiple LODs."))(),h[g].forEach((p,A)=>{n&&r?l.texImage2D(f,A,a,n,r,o,a,c,p):l.texImage2D(f,A,a,a,c,p)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:r,height:i,pixels:s,data:o,border:a=0,format:c=6408,type:l=5121}=e,{gl:u}=this,h=s||o;return this.bind(),h instanceof Promise?h.then(f=>this.setImageDataForFace(Object.assign({},e,{face:n,data:f,pixels:f}))):this.width||this.height?u.texImage2D(n,0,c,r,i,a,c,l,h):u.texImage2D(n,0,c,c,l,h),this}}kT.FACES=qf;class aR extends vs{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return J(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};rt(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:r=6408,width:i,height:s,depth:o=1,border:a=0,format:c,type:l=5121,offset:u=0,data:h,parameters:f={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Wt(this.gl,f,()=>{ArrayBuffer.isView(h)&&this.gl.texImage3D(this.target,n,r,i,s,o,a,c,l,h),h instanceof se&&(this.gl.bindBuffer(35052,h.handle),this.gl.texImage3D(this.target,n,r,i,s,o,a,c,l,u))}),h&&h.byteLength)this._trackAllocatedMemory(h.byteLength,"Texture");else{const g=NT[this.dataFormat]||4,p=UT[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*g*p,"Texture")}return this.loaded=!0,this}}const Wr="EXT_color_buffer_float",$0={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:Wr,bpp:2},33327:{gl2:Wr,bpp:4},34842:{gl2:Wr,bpp:8},33326:{gl2:Wr,bpp:4},33328:{gl2:Wr,bpp:8},34836:{gl2:Wr,bpp:16},35898:{gl2:Wr,bpp:4}};function cR(t,e,n){const r=n[e];if(!r)return!1;const i=J(t)&&r.gl2||r.gl1;return typeof i=="string"?t.getExtension(i):i}class Qi extends or{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||cR(e,n,$0)}static getSamplesForFormat(e,n){let{format:r}=n;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:r=1,height:i=1,samples:s=0}=e;return N(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&J(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,n,r,i):this.gl.renderbufferStorage(36161,n,r,i),this.format=n,this.width=r,this.height=i,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*$0[this.format].bpp),this}resize(e){let{width:n,height:r}=e;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const lR=256,uR=1024,hR=16384,e_=6144,t_=6145,n_=6146,r_=34041,GT="clear: bad arguments";function zg(t){let{framebuffer:e=null,color:n=null,depth:r=null,stencil:i=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};e&&(s.framebuffer=e);let o=0;n&&(o|=hR,n!==!0&&(s.clearColor=n)),r&&(o|=lR,r!==!0&&(s.clearDepth=r)),i&&(o|=uR,r!==!0&&(s.clearStencil=r)),N(o!==0,GT),Wt(t,s,()=>{t.clear(o)})}function fR(t){let{framebuffer:e=null,buffer:n=e_,drawBuffer:r=0,value:i=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};rt(t),Wt(t,{framebuffer:e},()=>{switch(n){case e_:switch(i.constructor){case Int32Array:t.clearBufferiv(n,r,i);break;case Uint32Array:t.clearBufferuiv(n,r,i);break;case Float32Array:default:t.clearBufferfv(n,r,i)}break;case t_:t.clearBufferfv(t_,0,[i]);break;case n_:t.clearBufferiv(n_,0,[i]);break;case r_:const[s,o]=i;t.clearBufferfi(r_,0,s,o);break;default:N(!1,GT)}})}function dR(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return N(!1),0}}function eu(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:r=0,sourceFormat:i=6408}=e;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:c,sourceType:l}=e;const{framebuffer:u,deleteFramebuffer:h}=gR(t);N(u);const{gl:f,handle:g,attachments:p}=u;a=a||u.width,c=c||u.height,s===36064&&g===null&&(s=1028),N(p[s]),l=l||p[s].type,o=pR(o,l,i,a,c),l=l||Yf(o);const A=f.bindFramebuffer(36160,g);return f.readPixels(n,r,a,c,i,l,o),f.bindFramebuffer(36160,A||null),h&&u.delete(),o}function i_(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=eu(t,{sourceAttachment:e}),{width:i,height:s}=t;for(;s>n;)({data:r,width:i,height:s}=qM({data:r,width:i,height:s}));QM({data:r,width:i,height:s});const o=document.createElement("canvas");o.width=i,o.height=s;const a=o.getContext("2d"),c=a.createImageData(i,s);return c.data.set(r),a.putImageData(c,0,0),o.toDataURL()}function gR(t){return t instanceof Oe?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:SR(t),deleteFramebuffer:!0}}function pR(t,e,n,r,i){if(t)return t;e=e||5121;const s=Yo(e,{clamped:!1}),o=dR(n);return new s(r*i*o)}const ie={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function mR(t){const e=new qe(t,{format:6408,type:5126,dataFormat:6408}),n=new Oe(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),r=n.getStatus();return e.delete(),n.delete(),r===36053}const VT={[ie.WEBGL2]:[!1,!0],[ie.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[ie.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[ie.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[ie.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[ie.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[ie.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[ie.FLOAT_BLEND]:["EXT_float_blend"],[ie.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[ie.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[ie.TEXTURE_FLOAT]:["OES_texture_float",!0],[ie.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[ie.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[ie.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[ie.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[ie.COLOR_ATTACHMENT_RGBA32F]:[mR,"EXT_color_buffer_float"],[ie.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[ie.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[ie.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[ie.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[ie.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[ie.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},_R=2;function Hg(t,e){return yl(t,e)}function yl(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>zT(t,n))}function yR(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in VT)t.luma.caps[e]===void 0&&(t.luma.caps[e]=zT(t,e));return t.luma.caps}function zT(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=vR(t,e)),t.luma.caps[e]||V.log(_R,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function vR(t,e){const n=VT[e];N(n,e);let r;const i=J(t)&&n[1]||n[0];if(typeof i=="function")r=i(t);else if(Array.isArray(i)){r=!0;for(const s of i)r=r&&!!t.getExtension(s)}else typeof i=="string"?r=!!t.getExtension(i):typeof i=="boolean"?r=i:N(!1);return r}const s_="Multiple render targets not supported";class Oe extends or{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:i}=n;let s=!0;return r&&(s=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),i&&(s=s&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Oe(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=rt(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=rt(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:r=1,attachments:i=null,color:s=!0,depth:o=!0,stencil:a=!1,check:c=!0,readBuffer:l=void 0,drawBuffers:u=void 0}=e;if(N(n>=0&&r>=0,"Width and height need to be integers"),this.width=n,this.height=r,i)for(const h in i){const f=i[h];(Array.isArray(f)?f[0]:f).resize({width:n,height:r})}else i=this._createDefaultAttachments(s,o,a,n,r);this.update({clearAttachments:!0,attachments:i,readBuffer:l,drawBuffers:u}),i&&c&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:r,drawBuffers:i,clearAttachments:s=!1,resizeAttachments:o=!0}=e;this.attach(n,{clearAttachments:s,resizeAttachments:o});const{gl:a}=this,c=a.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),i&&this._setDrawBuffers(i),a.bindFramebuffer(36160,c||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:r}=e;if(this.handle===null)return N(n===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),n!==this.width&&r!==this.height&&V.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(r))();for(const i in this.attachments)this.attachments[i].resize({width:n,height:r});return this.width=n,this.height=r,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i={};n&&Object.keys(this.attachments).forEach(o=>{i[o]=null}),Object.assign(i,e);const s=this.gl.bindFramebuffer(36160,this.handle);for(const o in i){N(o!==void 0,"Misspelled framebuffer binding point?");const a=Number(o),c=i[a];let l=c;if(!l)this._unattach(a);else if(l instanceof Qi)this._attachRenderbuffer({attachment:a,renderbuffer:l});else if(Array.isArray(c)){const[u,h=0,f=0]=c;l=u,this._attachTexture({attachment:a,texture:u,layer:h,level:f})}else this._attachTexture({attachment:a,texture:l,layer:0,level:0});r&&l&&l.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(o=>!this.attachments[o]).forEach(o=>{delete this.attachments[o]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(ER(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:r,stencil:i,drawBuffers:s=[]}=e,o=this.gl.bindFramebuffer(36160,this.handle);return(n||r||i)&&zg(this.gl,{color:n,depth:r,stencil:i}),s.forEach((a,c)=>{fR(this.gl,{drawBuffer:c,value:a})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(){return V.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return V.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return V.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return V.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return V.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return V.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:r=0,y:i=0,width:s,height:o}=e;const a=rt(this.gl),c=a.bindFramebuffer(36008,this.handle);return r===0&&i===0&&s===void 0&&o===void 0?a.invalidateFramebuffer(36008,n):a.invalidateFramebuffer(36008,n,r,i,s,o),a.bindFramebuffer(36008,c),this}getAttachmentParameter(e,n,r){let i=this._getAttachmentParameterFallback(n);return i===null&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),r&&i>1e3&&(i=Pr(this.gl,i)),i}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const i={};for(const s of r){const o=n?Pr(this.gl,s):s;i[o]=this.getAttachmentParameter(e,s,n)}return i}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),r={};for(const i of n){const s=Number(i),o=e?Pr(this.gl,s):s;r[o]=this.getAttachmentParameters(s,e)}return r}show(){return typeof window<"u"&&window.open(i_(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>V.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const r=i_(this,{targetMaxHeight:100});return V.image({logLevel:e,message:n,image:r},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,r,i,s){let o=null;return e&&(o=o||{},o[36064]=new qe(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:s,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(o[36064])),n&&r?(o=o||{},o[33306]=new Qi(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(o[33306])):n?(o=o||{},o[36096]=new Qi(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:s}),this.ownResources.push(o[36096])):r&&N(!1),o}_unattach(e){const n=this.attachments[e];n&&(n instanceof Qi?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:r}=e;const{gl:i}=this;i.framebufferRenderbuffer(36160,n,36161,r.handle),this.attachments[n]=r}_attachTexture(e){let{attachment:n=36064,texture:r,layer:i,level:s}=e;const{gl:o}=this;switch(o.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:rt(o).framebufferTextureLayer(36160,n,r.target,s,i);break;case 34067:const c=AR(i);o.framebufferTexture2D(36160,n,c,r.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,r.handle,s);break;default:N(!1,"Illegal texture type")}o.bindTexture(r.target,null),this.attachments[n]=r}_setReadBuffer(e){const n=qI(this.gl);n?n.readBuffer(e):N(e===36064||e===1029,s_),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,r=rt(n);if(r)r.drawBuffers(e);else{const i=n.getExtension("WEBGL_draw_buffers");i?i.drawBuffersWEBGL(e):N(e.length===1&&(e[0]===36064||e[0]===1029),s_)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=yR(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function AR(t){return t<34069?t+34069:t}function ER(t){return(Oe.STATUS||{})[t]||"Framebuffer error ".concat(t)}const TR=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Oe.ATTACHMENT_PARAMETERS=TR;function bR(t,e){N(t instanceof qe||t instanceof kT||t instanceof aR);const n=t.constructor,{gl:r,width:i,height:s,format:o,type:a,dataFormat:c,border:l,mipmaps:u}=t,h=Object.assign({width:i,height:s,format:o,type:a,dataFormat:c,border:l,mipmaps:u},e);return new n(r,h)}function SR(t,e){const{gl:n,width:r,height:i,id:s}=t;return new Oe(n,Object.assign({},e,{id:"framebuffer-for-".concat(s),width:r,height:i,attachments:{36064:t}}))}function Dc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=t.match(n);return r?r[1]:e}const wR=35632,CR=35633;function xR(t){switch(t){case wR:return"fragment";case CR:return"vertex";default:return"unknown type"}}function BR(t,e,n,r){const i=t.split(/\r?\n/),s={},o={},a=r||Dc(e)||"(unnamed)",c="".concat(xR(n)," shader ").concat(a);for(let u=0;u<i.length;u++){const h=i[u];if(h.length<=1)continue;const f=h.split(":"),g=f[0],p=parseInt(f[2],10);if(isNaN(p))throw new Error("GLSL compilation error in ".concat(c,": ").concat(t));g!=="WARNING"?s[p]=h:o[p]=h}const l=IR(e);return{shaderName:c,errors:o_(s,l),warnings:o_(o,l)}}function o_(t,e){let n="";for(let r=0;r<e.length;r++){const i=e[r];if(!(!t[r+3]&&!t[r+2]&&!t[r+1])&&(n+="".concat(i,`
`),t[r+1])){const s=t[r+1],o=s.split(":",3),a=o[0],c=parseInt(o[1],10)||0,l=s.substring(o.join(":").length+1).trim();n+=HT("^^^ ".concat(a,": ").concat(l,`

`),c)}}return n}function IR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=t.split(/\r?\n/),i=String(r.length+e-1).length;return r.map((s,o)=>{const a=String(o+e),c=a.length;return HT(a,i-c)+n+s})}function HT(t,e){let n="";for(let r=0;r<e;++r)n+=" ";return"".concat(n).concat(t)}function jT(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const MR="Shader: GLSL source code must be a JavaScript string";class Qo extends or{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return N(!1),"unknown"}}constructor(e,n){$l(e),N(typeof n.source=="string",MR);const r=Dc(n.source,null)||n.id||nr("unnamed ".concat(Qo.getTypeName(n.shaderType)));super(e,{id:r}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const r=Dc(n,null);r&&(this.id=nr(r)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Qo.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Dc(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:i,errors:s,warnings:o}=BR(r,this.source,this.shaderType,this.id);throw V.error("GLSL compilation errors in ".concat(i,`
`).concat(s))(),V.warn("GLSL compilation warnings in ".concat(i,`
`).concat(o))(),new Error("GLSL compilation errors in ".concat(i))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class oh extends Qo{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class ah extends Qo{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const RR={5126:de.bind(null,"uniform1fv",yt,1,Xe),35664:de.bind(null,"uniform2fv",yt,2,Xe),35665:de.bind(null,"uniform3fv",yt,3,Xe),35666:de.bind(null,"uniform4fv",yt,4,Xe),5124:de.bind(null,"uniform1iv",hr,1,Xe),35667:de.bind(null,"uniform2iv",hr,2,Xe),35668:de.bind(null,"uniform3iv",hr,3,Xe),35669:de.bind(null,"uniform4iv",hr,4,Xe),35670:de.bind(null,"uniform1iv",hr,1,Xe),35671:de.bind(null,"uniform2iv",hr,2,Xe),35672:de.bind(null,"uniform3iv",hr,3,Xe),35673:de.bind(null,"uniform4iv",hr,4,Xe),35674:de.bind(null,"uniformMatrix2fv",yt,4,Nn),35675:de.bind(null,"uniformMatrix3fv",yt,9,Nn),35676:de.bind(null,"uniformMatrix4fv",yt,16,Nn),35678:Ge,35680:Ge,5125:de.bind(null,"uniform1uiv",Za,1,Xe),36294:de.bind(null,"uniform2uiv",Za,2,Xe),36295:de.bind(null,"uniform3uiv",Za,3,Xe),36296:de.bind(null,"uniform4uiv",Za,4,Xe),35685:de.bind(null,"uniformMatrix2x3fv",yt,6,Nn),35686:de.bind(null,"uniformMatrix2x4fv",yt,8,Nn),35687:de.bind(null,"uniformMatrix3x2fv",yt,6,Nn),35688:de.bind(null,"uniformMatrix3x4fv",yt,12,Nn),35689:de.bind(null,"uniformMatrix4x2fv",yt,8,Nn),35690:de.bind(null,"uniformMatrix4x3fv",yt,12,Nn),35678:Ge,35680:Ge,35679:Ge,35682:Ge,36289:Ge,36292:Ge,36293:Ge,36298:Ge,36299:Ge,36300:Ge,36303:Ge,36306:Ge,36307:Ge,36308:Ge,36311:Ge},PR={},LR={},OR={},a_=[0];function jg(t,e,n,r){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(a_[0]=t,t=a_);const i=t.length;if(i%e&&V.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let s=r[i];s||(s=new n(i),r[i]=s);for(let o=0;o<i;o++)s[o]=t[o];return s}function yt(t,e){return jg(t,e,Float32Array,PR)}function hr(t,e){return jg(t,e,Int32Array,LR)}function Za(t,e){return jg(t,e,Uint32Array,OR)}function c_(t,e,n){const r=RR[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,t,e)}function DR(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function FR(t,e,n){for(const r in t){const i=t[r];if((!n||!!n[r])&&!NR(i))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),i),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function NR(t){return Array.isArray(t)||ArrayBuffer.isView(t)?kR(t):isFinite(t)||t===!0||t===!1||t instanceof vs||t instanceof Qi?!0:t instanceof Oe?!!t.texture:!1}function UR(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const r=t[e];for(let i=0,s=n.length;i<s;++i)r[i]=n[i]}else t[e]=n.slice();else t[e]=n}function kR(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ge(){let t=null;return(e,n,r)=>{const i=t!==r;return i&&(e.uniform1i(n,r),t=r),i}}function de(t,e,n,r){let i=null,s=null;return(o,a,c)=>{const l=e(c,n),u=l.length;let h=!1;if(i===null)i=new Float32Array(u),s=u,h=!0;else{N(s===u,"Uniform length cannot change.");for(let f=0;f<u;++f)if(l[f]!==i[f]){h=!0;break}}return h&&(r(o,t,a,l),i.set(l)),h}}function Xe(t,e,n,r){t[e](n,r)}function Nn(t,e,n,r){t[e](n,!1,r)}const GR=5120,VR=5121,zR=5122,HR=5123,l_=0,$a=1,jR=2,WR=3,ec=4,JR=5,XR=6,Me=5126,KR=35664,YR=35665,QR=35666,Zs=5124,qR=35667,ZR=35668,$R=35669,$s=5125,eP=36294,tP=36295,nP=36296,rP=35670,iP=35671,sP=35672,oP=35673,aP=35674,cP=35675,lP=35676,uP=35685,hP=35686,fP=35687,dP=35688,gP=35689,pP=35690,Zf={[Me]:[Me,1,"float"],[KR]:[Me,2,"vec2"],[YR]:[Me,3,"vec3"],[QR]:[Me,4,"vec4"],[Zs]:[Zs,1,"int"],[qR]:[Zs,2,"ivec2"],[ZR]:[Zs,3,"ivec3"],[$R]:[Zs,4,"ivec4"],[$s]:[$s,1,"uint"],[eP]:[$s,2,"uvec2"],[tP]:[$s,3,"uvec3"],[nP]:[$s,4,"uvec4"],[rP]:[Me,1,"bool"],[iP]:[Me,2,"bvec2"],[sP]:[Me,3,"bvec3"],[oP]:[Me,4,"bvec4"],[aP]:[Me,8,"mat2"],[uP]:[Me,8,"mat2x3"],[hP]:[Me,8,"mat2x4"],[cP]:[Me,12,"mat3"],[fP]:[Me,12,"mat3x2"],[dP]:[Me,12,"mat3x4"],[lP]:[Me,16,"mat4"],[gP]:[Me,16,"mat4x2"],[pP]:[Me,16,"mat4x3"]};function mP(t){switch(t){case l_:return l_;case $a:return $a;case WR:return $a;case jR:return $a;case ec:return ec;case JR:return ec;case XR:return ec;default:return N(!1),0}}function u_(t){const e=Zf[t];if(!e)return null;const[n,r]=e;return{type:n,components:r}}function WT(t,e){switch(t){case GR:case VR:case zR:case HR:t=Me;break}for(const n in Zf){const[r,i,s]=Zf[n];if(r===t&&i===e)return{glType:n,name:s}}return null}class _P{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,r=n.getProgramParameter(e.handle,35721);for(let i=0;i<r;i++){const{name:s,type:o,size:a}=n.getActiveAttrib(e.handle,i),c=n.getAttribLocation(e.handle,s);c>=0&&this._addAttribute(c,s,o,a)}this.attributeInfos.sort((i,s)=>i.location-s.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!J(n))return;const r=n.getProgramParameter(e.handle,35971);for(let i=0;i<r;i++){const{name:s,type:o,size:a}=n.getTransformFeedbackVarying(e.handle,i);this._addVarying(i,s,o,a)}this.varyingInfos.sort((i,s)=>i.location-s.location)}_addAttribute(e,n,r,i){const{type:s,components:o}=u_(r),a={type:s,size:i*o};this._inferProperties(e,n,a);const c={location:e,name:n,accessor:new ut(a)};this.attributeInfos.push(c),this.attributeInfosByLocation[e]=c,this.attributeInfosByName[c.name]=c}_inferProperties(e,n,r){/instance/i.test(n)&&(r.divisor=1)}_addVarying(e,n,r,i){const{type:s,components:o}=u_(r),a=new ut({type:s,size:i*o}),c={location:e,name:n,accessor:a};this.varyingInfos.push(c),this.varyingInfosByName[c.name]=c}}const h_=4,yP=35981,vP=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class JT extends or{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",vP),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:r,fs:i,varyings:s,bufferMode:o=yP}=e;return this.hash=n||"",this.vs=typeof r=="string"?new oh(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof i=="string"?new ah(this.gl,{id:"".concat(e.id,"-fs"),source:i}):i,N(this.vs instanceof oh),N(this.fs instanceof ah),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(rt(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new _P(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:r=4,vertexCount:i,offset:s=0,start:o,end:a,isIndexed:c=!1,indexType:l=5123,instanceCount:u=0,isInstanced:h=u>0,vertexArray:f=null,transformFeedback:g,framebuffer:p,parameters:A={},uniforms:b,samplers:_}=e;if((b||_)&&(V.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(b||{})),V.priority>=n){const m=p?p.id:"default",v="mode=".concat(Pr(this.gl,r)," verts=").concat(i," ")+"instances=".concat(u," indexType=").concat(Pr(this.gl,l)," ")+"isInstanced=".concat(h," isIndexed=").concat(c," ")+"Framebuffer=".concat(m);V.log(n,v)()}return N(f),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||h&&u===0?!1:(f.bindForDraw(i,u,()=>{if(p!==void 0&&(A=Object.assign({},A,{framebuffer:p})),g){const m=mP(r);g.begin(m)}this._bindTextures(),Wt(this.gl,A,()=>{c&&h?this.gl2.drawElementsInstanced(r,i,l,s,u):c&&J(this.gl)&&!isNaN(o)&&!isNaN(a)?this.gl2.drawRangeElements(r,o,a,i,l,s):c?this.gl.drawElements(r,i,l,s):h?this.gl2.drawArraysInstanced(r,s,i,u):this.gl.drawArrays(r,s,i)}),g&&g.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};V.priority>=2&&FR(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const r=e[n],i=this._uniformSetters[n];if(i){let s=r,o=!1;if(s instanceof Oe&&(s=s.texture),s instanceof vs)if(o=this.uniforms[n]!==r,o){i.textureIndex===void 0&&(i.textureIndex=this._textureIndexCounter++);const a=s,{textureIndex:c}=i;a.bind(c),s=c,this._textureUniforms[n]=a}else s=i.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(i(s)||o)&&UR(this.uniforms,n,r)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const r=this._textureUniforms[n];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),r={};for(const i of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new oh({handle:i});break;case 35632:r.fs=new ah({handle:i});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=nr(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),V.time(h_,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),V.timeEnd(h_,"linkProgram for ".concat(this._getName()))(),e.debug||V.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const r=this.gl.getActiveUniform(this.handle,n),{name:i}=DR(r.name);let s=e.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=c_(e,s,r),r.size>1)for(let o=0;o<r.size;o++)s=e.getUniformLocation(this.handle,"".concat(i,"[").concat(o,"]")),this._uniformSetters["".concat(i,"[").concat(o,"]")]=c_(e,s,r)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const AP=34918,EP=34919,TP=35007,bP=36795,SP=35976,wP=35887,CP=36202;class vl extends or{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=J(e),i=yl(e,ie.TIMER_QUERY);let s=r||i;for(const o of n)switch(o){case"queries":s=s&&r;break;case"timers":s=s&&i;break;default:N(!1)}return s}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(TP)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?CP:wP)}beginTransformFeedbackQuery(){return this.begin(SP)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,EP);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(bP)}getResult(){return this.gl2.getQueryParameter(this.handle,AP)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((r,i)=>{const s=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):n++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return vl.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class XT extends or{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return J(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};rt(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,ys(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const r=this._getVaryingIndex(e),{buffer:i,byteSize:s,byteOffset:o}=this._getBufferParams(n);return r<0?(this.unused[e]=i,V.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=n,this.bindOnUse||this._bindBuffer(r,i,o,s),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,r,i;return e instanceof se?i=e:(i=e.buffer,r=e.byteSize,n=e.byteOffset),(n!==void 0||r!==void 0)&&(n=n||0,r=r||i.byteLength-n),{buffer:i,byteOffset:n,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:r,byteOffset:i}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,i,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const s=n&&n.handle;return!s||i===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,r,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let tc=null;function xP(t){return(!tc||tc.byteLength<t)&&(tc=new ArrayBuffer(t)),tc}function BP(t,e){const n=xP(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function IP(t){let{target:e,source:n,start:r=0,count:i=1}=t;const s=n.length,o=i*s;let a=0;for(let c=r;a<s;a++)e[c++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return e}const MP="elements must be GL.ELEMENT_ARRAY_BUFFER";class Et extends or{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?J(e)||CT()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Et(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Et.MAX_ATTRIBUTES=Et.MAX_ATTRIBUTES||e.getParameter(34921),Et.MAX_ATTRIBUTES}static setConstant(e,n,r){switch(r.constructor){case Float32Array:Et._setConstantFloatArray(e,n,r);break;case Int32Array:Et._setConstantIntArray(e,n,r);break;case Uint32Array:Et._setConstantUintArray(e,n,r);break;default:N(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Et.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return N(!e||e.target===34963,MP),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,r){if(n.target===34963)return this.setElementBuffer(n,r);const{size:i,type:s,stride:o,offset:a,normalized:c,integer:l,divisor:u}=r,{gl:h,gl2:f}=this;return e=Number(e),this.bind(()=>{h.bindBuffer(34962,n.handle),l?(N(J(h)),f.vertexAttribIPointer(e,i,s,o,a)):h.vertexAttribPointer(e,i,s,c,o,a),h.enableVertexAttribArray(e),f.vertexAttribDivisor(e,u||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!Et.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const r=this._normalizeConstantArrayValue(n),i=r.byteLength*e,s=r.length*e;let o=!this.buffer;if(this.buffer=this.buffer||new se(this.gl,i),o=o||this.buffer.reallocate(i),o=o||!this._compareConstantArrayValues(r,this.bufferValue),o){const a=BP(n.constructor,s);IP({target:a,source:r,start:0,count:s}),this.buffer.subData(a),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==n[r])return!1;return!0}static _setConstantFloatArray(e,n,r){switch(r.length){case 1:e.vertexAttrib1fv(n,r);break;case 2:e.vertexAttrib2fv(n,r);break;case 3:e.vertexAttrib3fv(n,r);break;case 4:e.vertexAttrib4fv(n,r);break;default:N(!1)}}static _setConstantIntArray(e,n,r){switch(N(J(e)),r.length){case 1:e.vertexAttribI1iv(n,r);break;case 2:e.vertexAttribI2iv(n,r);break;case 3:e.vertexAttribI3iv(n,r);break;case 4:e.vertexAttribI4iv(n,r);break;default:N(!1)}}static _setConstantUintArray(e,n,r){switch(N(J(e)),r.length){case 1:e.vertexAttribI1uiv(n,r);break;case 2:e.vertexAttribI2uiv(n,r);break;case 3:e.vertexAttribI3uiv(n,r);break;case 4:e.vertexAttribI4uiv(n,r);break;default:N(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:r}=n;return N(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const RP="VertexArray: attributes must be Buffers or constants (i.e. typed array)",PP=/^(.+)__LOCATION_([0-9]+)$/,LP=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class OP{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Et(e),DT(this,"VertexArray","v6.0",LP),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const r=e[n];this._setAttribute(n,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,r);const{location:i,accessor:s}=this._resolveLocationAndAccessor(e,n,n.accessor,r);return i>=0&&(this.values[i]=n,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,n,s)),this}setConstant(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:i,accessor:s}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},r));return i>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[i]=n,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new se(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof se&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof se&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,r){let i;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),i=r()}),i}_resolveLocationAndAccessor(e,n,r,i){const s={location:-1,accessor:null},{location:o,name:a}=this._getAttributeIndex(e);if(!Number.isFinite(o)||o<0)return this.unused[e]=n,V.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),s;const c=this._getAttributeInfo(a||o);if(!c)return s;const l=this.accessors[o]||{},u=ut.resolve(c.accessor,l,r,i),{size:h,type:f}=u;return N(Number.isFinite(h)&&Number.isFinite(f)),{location:o,accessor:u}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const r=PP.exec(e),i=r?r[1]:e,s=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+s,name:i}:{location:-1}}_setAttribute(e,n){if(n instanceof se)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof se){const r=n[0],i=n[1];this.setBuffer(e,r,i)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const r=n;this.setConstant(e,r)}else if(n.buffer instanceof se){const r=n;this.setBuffer(e,r.buffer,r)}else throw new Error(RP)}_setConstantAttributes(e,n){const r=Math.max(e|0,n|0);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,r);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)i=this.values[s],ArrayBuffer.isView(i)&&this._setConstantAttribute(s,i)}_setConstantAttributeZero(e,n){if(Et.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,n){Et.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const r=this.values[n],i=this.accessors[n];if(!r)return;const{divisor:s}=i,o=s>0;if(e.isInstanced=e.isInstanced||o,r instanceof se){const a=r;if(o){const c=a.getVertexCount(i);e.instanceCount=Math.min(e.instanceCount,c)}else{const c=a.getVertexCount(i);e.vertexCount=Math.min(e.vertexCount,c)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return V.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function DP(t,e){const{maxElts:n=16,size:r=1}=e;let i="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(i+=",".concat(o%r===0?" ":"")),i+=qo(t[o],e);const s=t.length>n?"...":"]";return"".concat(i).concat(s)}function qo(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:r=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return DP(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return r?"0":"0.";if(r||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const i=t.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function f_(t){let{header:e="Uniforms",program:n,uniforms:r,undefinedOnly:i=!1}=t;N(n);const s=".*_.*",o=".*Matrix",a=n._uniformSetters,c={},l=Object.keys(a).sort();let u=0;for(const g of l)!g.match(s)&&!g.match(o)&&ch({table:c,header:e,uniforms:r,uniformName:g,undefinedOnly:i})&&u++;for(const g of l)g.match(o)&&ch({table:c,header:e,uniforms:r,uniformName:g,undefinedOnly:i})&&u++;for(const g of l)c[g]||ch({table:c,header:e,uniforms:r,uniformName:g,undefinedOnly:i})&&u++;let h=0;const f={};if(!i)for(const g in r){const p=r[g];c[g]||(h++,f[g]={Type:"NOT USED: ".concat(p),[e]:qo(p)})}return{table:c,count:u,unusedTable:f,unusedCount:h}}function ch(t){let{table:e,header:n,uniforms:r,uniformName:i,undefinedOnly:s}=t;const o=r[i],a=FP(o);return!s||!a?(e[i]={[n]:a?qo(o):"N/A","Uniform Type":a?o:"NOT PROVIDED"},!0):!1}function FP(t){return t!=null}function NP(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=d_(e,e.elements,null,n));const i=e.values;for(const s in i){const o=e._getAttributeInfo(s);if(o){let a="".concat(s,": ").concat(o.name);const c=e.accessors[o.location];c&&(a="".concat(s,": ").concat(UP(o.name,c))),r[a]=d_(e,i[s],c,n)}}return r}function d_(t,e,n,r){const{gl:i}=t;if(!e)return{[r]:"null","Format ":"N/A"};let s="NOT PROVIDED",o=1,a=0,c=0,l,u,h;if(n&&(s=n.type,o=n.size,s=String(s).replace("Array",""),l=s.indexOf("nt")!==-1),e instanceof se){const f=e,{data:g,changed:p}=f.getDebugData();u=p?"*":"",h=g,c=f.byteLength,a=c/g.BYTES_PER_ELEMENT/o;let A;if(n){const b=n.divisor>0;A="".concat(b?"I ":"P "," ").concat(a," (x").concat(o,"=").concat(c," bytes ").concat(Pr(i,s),")")}else l=!0,A="".concat(c," bytes");return{[r]:"".concat(u).concat(qo(h,{size:o,isInteger:l})),"Format ":A}}return h=e,o=e.length,s=String(e.constructor.name).replace("Array",""),l=s.indexOf("nt")!==-1,{[r]:"".concat(qo(h,{size:o,isInteger:l})," (constant)"),"Format ":"".concat(o,"x").concat(s," (constant)")}}function UP(t,e){const{type:n,size:r}=e,i=WT(n,r);return i?"".concat(t," (").concat(i.name,")"):t}function kP(t){const e={},n="Accessors for ".concat(t.id);for(const r of t.attributeInfos)if(r){const i=g_(r);e["in ".concat(i)]={[n]:JSON.stringify(r.accessor)}}for(const r of t.varyingInfos)if(r){const i=g_(r);e["out ".concat(i)]={[n]:JSON.stringify(r.accessor)}}return e}function g_(t){const{type:e,size:n}=t.accessor,r=WT(e,n);return r?"".concat(r.name," ").concat(t.name):t.name}const p_=sr()&&typeof document<"u";let GP=0;class VP{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=b=>OT(b),onAddHTML:r=null,onInitialize:i=()=>{},onRender:s=()=>{},onFinalize:o=()=>{},onError:a,gl:c=null,glOptions:l={},debug:u=!1,createFramebuffer:h=!1,autoResizeViewport:f=!0,autoResizeDrawingBuffer:g=!0,stats:p=ti.get("animation-loop-".concat(GP++))}=e;let{useDevicePixels:A=!0}=e;"useDevicePixelRatio"in e&&(V.deprecated("useDevicePixelRatio","useDevicePixels")(),A=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:r,onInitialize:i,onRender:s,onFinalize:o,onError:a,gl:c,glOptions:l,debug:u,createFramebuffer:h},this.gl=c,this.needsRedraw=null,this.timeline=null,this.stats=p,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:f,autoResizeDrawingBuffer:g,useDevicePixels:A}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return N(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=vl.isSupported(this.gl,["timers"])?new vl(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):n}setViewParameters(){return V.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=p_?new Promise((e,n)=>{if(p_&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):KM(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):XM(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?kg(this.props.gl,e):this.onCreateContext(e),!Zl(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");OM(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let r=1;const{canvas:i}=this.gl;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&kM(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Oe(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const ga="vs",Wg="fs";function xt(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const lh={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function zP(t){const e={};for(const n in t){const r=t[n],i=HP(r);e[n]=i}return e}function HP(t){let e=m_(t);return e==="object"?t?"type"in t?Object.assign({},t,lh[t.type]):"value"in t?(e=m_(t.value),Object.assign({type:e},t,lh[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},lh[e])}function m_(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const jP="vs",WP="fs";class __{constructor(e){let{name:n,vs:r,fs:i,dependencies:s=[],uniforms:o,getUniforms:a,deprecations:c=[],defines:l={},inject:u={},vertexShader:h,fragmentShader:f}=e;xt(typeof n=="string"),this.name=n,this.vs=r||h,this.fs=i||f,this.getModuleUniforms=a,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(c),this.defines=l,this.injections=JP(u),o&&(this.uniforms=zP(o))}getModuleSource(e){let n;switch(e){case jP:n=this.vs||"";break;case WP:n=this.fs||"";break;default:xt(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},r=this.uniforms;for(const i in r){const s=r[i];i in e&&!s.private?(s.validate&&xt(s.validate(e[i],s),"".concat(this.name,": invalid ").concat(i)),n[i]=e[i]):n[i]=s.value}return n}}function JP(t){const e={vs:{},fs:{}};for(const n in t){let r=t[n];const i=n.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function XP(t){return KP(YT(t))}function KP(t){const e={},n={};return KT({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,i)=>n[i]-n[r]).map(r=>e[r])}function KT(t){let{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&KT({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function YT(t,e){return t.map(n=>(n instanceof __||(xt(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),xt(n.name,"shader module has no name"),n=new __(n),n.dependencies=YT(n.dependencies)),n))}function YP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",r=n.indexOf("MSIE ")!==-1,i=n.indexOf("Trident/")!==-1;return r||i}const QP=7936,qP=7937,ZP=7938,$P=35724,Jg={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},qr={};Object.keys(Jg).forEach(t=>{qr[t]=t});function e2(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function t2(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||QP),r=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||qP);return{gpuVendor:n2(n,r),vendor:n,renderer:r,version:t.getParameter(ZP),shadingLanguageVersion:t.getParameter($P)}}function n2(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const uh={};function y_(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Jg[e];if(xt(r,e),!YP(n))return!0;if(e in uh)return uh[e];const i=r[0],s=n.behavior||"enable",o="#extension GL_".concat(i," : ").concat(s,`
void main(void) {}`),a=t.createShader(35633);t.shaderSource(a,o),t.compileShader(a);const c=t.getShaderParameter(a,35713);return t.deleteShader(a),uh[e]=c,c}function r2(t,e){const n=Jg[e];xt(n,e);const r=e2(t)&&n[1]||n[0],i=typeof r=="string"?!!t.getExtension(r):r;return xt(i===!1||i===!0),i}function nc(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>r2(t,n))}function i2(t){switch(t2(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function s2(t,e,n){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return nc(t,qr.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),nc(t,qr.GLSL_DERIVATIVES)&&y_(t,qr.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),nc(t,qr.GLSL_FRAG_DATA)&&y_(t,qr.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),nc(t,qr.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const o2=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,a2=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,c2={[ga]:o2,[Wg]:a2},Fc="__LUMA_INJECT_DECLARATIONS__",v_=/void\s+main\s*\([^)]*\)\s*\{\n?/,A_=/}\n?[^{}]*$/,hh=[];function E_(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=e===ga;for(const s in n){const o=n[s];o.sort((c,l)=>c.order-l.order),hh.length=o.length;for(let c=0,l=o.length;c<l;++c)hh[c]=o[c].injection;const a="".concat(hh.join(`
`),`
`);switch(s){case"vs:#decl":i&&(t=t.replace(Fc,a));break;case"vs:#main-start":i&&(t=t.replace(v_,c=>c+a));break;case"vs:#main-end":i&&(t=t.replace(A_,c=>a+c));break;case"fs:#decl":i||(t=t.replace(Fc,a));break;case"fs:#main-start":i||(t=t.replace(v_,c=>c+a));break;case"fs:#main-end":i||(t=t.replace(A_,c=>a+c));break;default:t=t.replace(s,c=>c+a)}}return t=t.replace(Fc,""),r&&(t=t.replace(/\}\s*$/,s=>s+c2[e])),t}function $f(t){const e={};return xt(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const r in n)e[r]=e[r]?"".concat(e[r],`
`).concat(n[r]):n[r]}),e}function As(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const QT=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],l2=[...QT,[As("attribute"),"in $1"],[As("varying"),"out $1"]],u2=[...QT,[As("varying"),"in $1"]],qT=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],h2=[...qT,[As("in"),"attribute $1"],[As("out"),"varying $1"]],f2=[...qT,[As("in"),"varying $1"]],ed="gl_FragColor",td=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,d2=/void\s+main\s*\([^)]*\)\s*\{\n?/;function g2(t,e,n){switch(e){case 300:return n?Al(t,l2):p2(t);case 100:return n?Al(t,h2):m2(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Al(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function p2(t){t=Al(t,u2);const e=t.match(td);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(ed,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(d2,r=>"out vec4 ".concat(n,`;
`).concat(r)).replace(new RegExp("\\b".concat(ed,"\\b"),"g"),n)}return t}function m2(t){t=Al(t,f2);const e=t.match(td);if(e){const n=e[1];t=t.replace(td,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),ed)}return t}const _2=`

`.concat(Fc,`

`),ZT={[ga]:"vertex",[Wg]:"fragment"},y2=`precision highp float;

`;function v2(t,e){const{vs:n,fs:r}=e,i=XP(e.modules||[]);return{gl:t,vs:T_(t,Object.assign({},e,{source:n,type:ga,modules:i})),fs:T_(t,Object.assign({},e,{source:r,type:Wg,modules:i})),getUniforms:A2(i)}}function T_(t,e){let{id:n,source:r,type:i,modules:s,defines:o={},hookFunctions:a=[],inject:c={},transpileToGLSL100:l=!1,prologue:u=!0,log:h}=e;xt(typeof r=="string","shader source must be a string");const f=i===ga,g=r.split(`
`);let p=100,A="",b=r;g[0].indexOf("#version ")===0?(p=300,A=g[0],b=g.slice(1).join(`
`)):A="#version ".concat(p);const _={};s.forEach(I=>{Object.assign(_,I.getDefines())}),Object.assign(_,o);let m=u?"".concat(A,`
`).concat(T2({id:n,source:r,type:i}),`
`).concat(E2({type:i}),`
`).concat(i2(t),`
`).concat(s2(t),`
`).concat(b2(_),`
`).concat(f?"":y2,`
`):"".concat(A,`
`);const v=w2(a),T={},w={},x={};for(const I in c){const M=typeof c[I]=="string"?{injection:c[I],order:0}:c[I],L=I.match(/^(v|f)s:(#)?([\w-]+)$/);if(L){const R=L[2],z=L[3];R?z==="decl"?w[I]=[M]:x[I]=[M]:T[I]=[M]}else x[I]=[M]}for(const I of s){h&&I.checkDeprecations(b,h);const M=I.getModuleSource(i,p);m+=M;const L=I.injections[i];for(const R in L){const z=R.match(/^(v|f)s:#([\w-]+)$/);if(z){const ne=z[2]==="decl"?w:x;ne[R]=ne[R]||[],ne[R].push(L[R])}else T[R]=T[R]||[],T[R].push(L[R])}}return m+=_2,m=E_(m,i,w),m+=S2(v[i],T),m+=b,m=E_(m,i,x),m=g2(m,l?100:p,f),m}function A2(t){return function(n){const r={};for(const i of t){const s=i.getUniforms(n,r);Object.assign(r,s)}return r}}function E2(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(ZT[e].toUpperCase(),`
`)}function T2(t){let{id:e,source:n,type:r}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(ZT[r],`

`):""}function b2(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const r in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const i=t[r];(i||Number.isFinite(i))&&(n+="#define ".concat(r.toUpperCase()," ").concat(t[r],`
`))}return e===0&&(n+=`
`),n}function S2(t,e){let n="";for(const r in t){const i=t[r];if(n+="void ".concat(i.signature,` {
`),i.header&&(n+="  ".concat(i.header)),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)n+="  ".concat(o.injection,`
`)}i.footer&&(n+="  ".concat(i.footer)),n+=`}
`}return n}function w2(t){const e={vs:{},fs:{}};return t.forEach(n=>{let r;typeof n!="string"?(r=n,n=r.hook):r={},n=n.trim();const[i,s]=n.split(":"),o=n.replace(/\(.+/,"");e[i][o]=Object.assign(r,{signature:s})}),e}const C2="void main() {gl_FragColor = vec4(0);}",$T=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,x2=`#version 300 es
`.concat($T);function e1(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[r,i,s]=n;if(!e.includes(r)||!i||!s)return null;const o=s.split(";")[0];return{qualifier:r,type:i,name:o}}function t1(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:r,output:i}=t;if(!n)return e===300?x2:e>300?"#version ".concat(e,`
`).concat($T):C2;const s=M2(n,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(n,`;
out vec4 `).concat(i,`;
void main() {
  `).concat(i," = ").concat(s,`;
}`):"varying ".concat(r," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function B2(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return xt(!1),null}}function I2(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return xt(!1),null}}function M2(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return xt(!1),null}}const R2=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,P2={name:"fp32",vs:R2,fs:null};function rn(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const L2=1/Math.PI*180,O2=1/180*Math.PI,Le={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function D2(t,{precision:e=Le.precision}={}){return t=k2(t),"".concat(parseFloat(t.toPrecision(e)))}function Nr(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function F2(t){return U2(t)}function N2(t){return Wn(t)}function U2(t,e){return Xg(t,n=>n*O2,e)}function Wn(t,e){return Xg(t,n=>n*L2,e)}function Jn(t,e,n){return Xg(t,r=>Math.max(e,Math.min(n,r)))}function El(t,e,n){return Nr(t)?t.map((r,i)=>El(r,e[i],n)):n*e+(1-n)*t}function ln(t,e,n){const r=Le.EPSILON;n&&(Le.EPSILON=n);try{if(t===e)return!0;if(Nr(t)&&Nr(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!ln(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Le.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Le.EPSILON=r}}function k2(t){return Math.round(t/Le.EPSILON)*Le.EPSILON}function G2(t){return t.clone?t.clone():new Array(t.length)}function Xg(t,e,n){if(Nr(t)){const r=t;n=n||G2(r);for(let i=0;i<n.length&&i<r.length;++i)n[i]=e(t[i],i,n);return n}return e(t)}function V2(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class Kg extends V2(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Nr(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Le)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+D2(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!ln(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i];this[i]=s+r*(n[i]-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Le.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function z2(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function re(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Bo(t,e,n=""){if(Le.debug&&!z2(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class Yg extends Kg{get x(){return this[0]}set x(e){this[0]=re(e)}get y(){return this[1]}set y(e){this[1]=re(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return re(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return re(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return rn(e>=0&&e<this.ELEMENTS,"index is out of range"),re(this[e])}setComponent(e,n){return rn(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Io=1e-6,hn=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function H2(){var t=new hn(2);return hn!=Float32Array&&(t[0]=0,t[1]=0),t}function b_(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function j2(t,e){return t[0]=-e[0],t[1]=-e[1],t}function n1(t,e,n,r){var i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function W2(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function J2(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function r1(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function i1(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){var t=H2();return function(e,n,r,i,s,o){var a,c;for(n||(n=2),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,a=r;a<c;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function s1(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function o1(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function X2(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function K2(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t[3]=e[3],t}function a1(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=n[0]*r+n[3]*i+n[6]*s,t[1]=n[1]*r+n[4]*i+n[7]*s,t[2]=n[2]*r+n[5]*i+n[8]*s,t[3]=e[3],t}class Qg extends Yg{constructor(e=0,n=0){super(2),Nr(e)&&arguments.length===1?this.copy(e):(Le.debug&&(re(e),re(n)),this[0]=e,this[1]=n)}set(e,n){return this[0]=e,this[1]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Le.debug&&(re(e.x),re(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return i1(this,this,e),this.check()}transformAsVector(e){return s1(this,this,e),this.check()}transformByMatrix3(e){return r1(this,this,e),this.check()}transformByMatrix2x3(e){return J2(this,this,e),this.check()}transformByMatrix2(e){return W2(this,this,e),this.check()}}function c1(){var t=new hn(3);return hn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function l1(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function S_(t,e,n){var r=new hn(3);return r[0]=t,r[1]=e,r[2]=n,r}function Y2(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Q2(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function q2(t,e){var n=e[0],r=e[1],i=e[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function qg(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Nc(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],c=n[2];return t[0]=i*c-s*a,t[1]=s*o-r*c,t[2]=r*a-i*o,t}function Zg(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function u1(t,e,n){var r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function h1(t,e,n){var r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],c=e[1],l=e[2],u=i*l-s*c,h=s*a-r*l,f=r*c-i*a,g=i*f-s*h,p=s*u-r*f,A=r*h-i*u,b=o*2;return u*=b,h*=b,f*=b,g*=2,p*=2,A*=2,t[0]=a+u+g,t[1]=c+h+p,t[2]=l+f+A,t}function Z2(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function $2(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function eL(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function tL(t,e){var n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],c=Math.sqrt(n*n+r*r+i*i),l=Math.sqrt(s*s+o*o+a*a),u=c*l,h=u&&qg(t,e)/u;return Math.acos(Math.min(Math.max(h,-1),1))}var nL=Y2,rL=l1;(function(){var t=c1();return function(e,n,r,i,s,o){var a,c;for(n||(n=3),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,a=r;a<c;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const fh=[0,0,0];let rc;class C extends Yg{static get ZERO(){return rc||(rc=new C(0,0,0),Object.freeze(rc)),rc}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&Nr(e)?this.copy(e):(Le.debug&&(re(e),re(n),re(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Le.debug&&(re(e.x),re(e.y),re(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=re(e)}angle(e){return tL(this,e)}cross(e){return Nc(this,this,e),this.check()}rotateX({radians:e,origin:n=fh}){return Z2(this,this,n,e),this.check()}rotateY({radians:e,origin:n=fh}){return $2(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=fh}){return eL(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Zg(this,this,e),this.check()}transformAsVector(e){return o1(this,this,e),this.check()}transformByMatrix3(e){return u1(this,this,e),this.check()}transformByMatrix2(e){return X2(this,this,e),this.check()}transformByQuaternion(e){return h1(this,this,e),this.check()}}let ic;class $g extends Yg{static get ZERO(){return ic||(ic=new $g(0,0,0,0),Object.freeze(ic)),ic}constructor(e=0,n=0,r=0,i=0){super(-0,-0,-0,-0),Nr(e)&&arguments.length===1?this.copy(e):(Le.debug&&(re(e),re(n),re(r),re(i)),this[0]=e,this[1]=n,this[2]=r,this[3]=i)}set(e,n,r,i){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Le.debug&&(re(e.x),re(e.y),re(e.z),re(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=re(e)}get w(){return this[3]}set w(e){this[3]=re(e)}transform(e){return Zg(this,this,e),this.check()}transformByMatrix3(e){return a1(this,this,e),this.check()}transformByMatrix2(e){return K2(this,this,e),this.check()}transformByQuaternion(e){return h1(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class f1 extends Kg{toString(){let e="[";if(Le.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=re(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function iL(){var t=new hn(9);return hn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function sL(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function oL(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,f=-u*s+a*c,g=l*s-o*c,p=n*h+r*f+i*g;return p?(p=1/p,t[0]=h*p,t[1]=(-u*r+i*l)*p,t[2]=(a*r-i*o)*p,t[3]=f*p,t[4]=(u*n-i*c)*p,t[5]=(-a*n+i*s)*p,t[6]=g*p,t[7]=(-l*n+r*c)*p,t[8]=(o*n-r*s)*p,t):null}function aL(t){var e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],c=t[7],l=t[8];return e*(l*s-o*c)+n*(-l*i+o*a)+r*(c*i-s*a)}function w_(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=n[0],g=n[1],p=n[2],A=n[3],b=n[4],_=n[5],m=n[6],v=n[7],T=n[8];return t[0]=f*r+g*o+p*l,t[1]=f*i+g*a+p*u,t[2]=f*s+g*c+p*h,t[3]=A*r+b*o+_*l,t[4]=A*i+b*a+_*u,t[5]=A*s+b*c+_*h,t[6]=m*r+v*o+T*l,t[7]=m*i+v*a+T*u,t[8]=m*s+v*c+T*h,t}function cL(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=n[0],g=n[1];return t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=c,t[6]=f*r+g*o+l,t[7]=f*i+g*a+u,t[8]=f*s+g*c+h,t}function lL(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=Math.sin(n),g=Math.cos(n);return t[0]=g*r+f*o,t[1]=g*i+f*a,t[2]=g*s+f*c,t[3]=g*o-f*r,t[4]=g*a-f*i,t[5]=g*c-f*s,t[6]=l,t[7]=u,t[8]=h,t}function C_(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function uL(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,c=i+i,l=n*o,u=r*o,h=r*a,f=i*o,g=i*a,p=i*c,A=s*o,b=s*a,_=s*c;return t[0]=1-h-p,t[3]=u-_,t[6]=f+b,t[1]=u+_,t[4]=1-l-p,t[7]=g-A,t[2]=f-b,t[5]=g+A,t[8]=1-l-h,t}var nd;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(nd||(nd={}));const hL=Object.freeze([1,0,0,0,1,0,0,0,1]);class Se extends f1{static get IDENTITY(){return dL()}static get ZERO(){return fL()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return nd}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(hL)}fromObject(e){return this.check()}fromQuaternion(e){return uL(this,e),this.check()}set(e,n,r,i,s,o,a,c,l){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(e,n,r,i,s,o,a,c,l){return this[0]=e,this[1]=i,this[2]=a,this[3]=n,this[4]=s,this[5]=c,this[6]=r,this[7]=o,this[8]=l,this.check()}determinant(){return aL(this)}transpose(){return sL(this,this),this.check()}invert(){return oL(this,this),this.check()}multiplyLeft(e){return w_(this,e,this),this.check()}multiplyRight(e){return w_(this,this,e),this.check()}rotate(e){return lL(this,this,e),this.check()}scale(e){return Array.isArray(e)?C_(this,this,e):C_(this,this,[e,e]),this.check()}translate(e){return cL(this,this,e),this.check()}transform(e,n){let r;switch(e.length){case 2:r=r1(n||[-0,-0],e,this);break;case 3:r=u1(n||[-0,-0,-0],e,this);break;case 4:r=a1(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Bo(r,e.length),r}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let sc,oc;function fL(){return sc||(sc=new Se([0,0,0,0,0,0,0,0,0]),Object.freeze(sc)),sc}function dL(){return oc||(oc=new Se,Object.freeze(oc)),oc}function gL(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pL(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function rd(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],f=e[10],g=e[11],p=e[12],A=e[13],b=e[14],_=e[15],m=n*a-r*o,v=n*c-i*o,T=n*l-s*o,w=r*c-i*a,x=r*l-s*a,I=i*l-s*c,M=u*A-h*p,L=u*b-f*p,R=u*_-g*p,z=h*b-f*A,te=h*_-g*A,ne=f*_-g*b,X=m*ne-v*te+T*z+w*R-x*L+I*M;return X?(X=1/X,t[0]=(a*ne-c*te+l*z)*X,t[1]=(i*te-r*ne-s*z)*X,t[2]=(A*I-b*x+_*w)*X,t[3]=(f*x-h*I-g*w)*X,t[4]=(c*R-o*ne-l*L)*X,t[5]=(n*ne-i*R+s*L)*X,t[6]=(b*T-p*I-_*v)*X,t[7]=(u*I-f*T+g*v)*X,t[8]=(o*te-a*R+l*M)*X,t[9]=(r*R-n*te-s*M)*X,t[10]=(p*x-A*T+_*m)*X,t[11]=(h*T-u*x-g*m)*X,t[12]=(a*L-o*z-c*M)*X,t[13]=(n*z-r*L+i*M)*X,t[14]=(A*v-p*w-b*m)*X,t[15]=(u*w-h*v+f*m)*X,t):null}function mL(t){var e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],c=t[7],l=t[8],u=t[9],h=t[10],f=t[11],g=t[12],p=t[13],A=t[14],b=t[15],_=e*o-n*s,m=e*a-r*s,v=e*c-i*s,T=n*a-r*o,w=n*c-i*o,x=r*c-i*a,I=l*p-u*g,M=l*A-h*g,L=l*b-f*g,R=u*A-h*p,z=u*b-f*p,te=h*b-f*A;return _*te-m*z+v*R+T*L-w*M+x*I}function oi(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=e[9],g=e[10],p=e[11],A=e[12],b=e[13],_=e[14],m=e[15],v=n[0],T=n[1],w=n[2],x=n[3];return t[0]=v*r+T*a+w*h+x*A,t[1]=v*i+T*c+w*f+x*b,t[2]=v*s+T*l+w*g+x*_,t[3]=v*o+T*u+w*p+x*m,v=n[4],T=n[5],w=n[6],x=n[7],t[4]=v*r+T*a+w*h+x*A,t[5]=v*i+T*c+w*f+x*b,t[6]=v*s+T*l+w*g+x*_,t[7]=v*o+T*u+w*p+x*m,v=n[8],T=n[9],w=n[10],x=n[11],t[8]=v*r+T*a+w*h+x*A,t[9]=v*i+T*c+w*f+x*b,t[10]=v*s+T*l+w*g+x*_,t[11]=v*o+T*u+w*p+x*m,v=n[12],T=n[13],w=n[14],x=n[15],t[12]=v*r+T*a+w*h+x*A,t[13]=v*i+T*c+w*f+x*b,t[14]=v*s+T*l+w*g+x*_,t[15]=v*o+T*u+w*p+x*m,t}function Tl(t,e,n){var r=n[0],i=n[1],s=n[2],o,a,c,l,u,h,f,g,p,A,b,_;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],c=e[2],l=e[3],u=e[4],h=e[5],f=e[6],g=e[7],p=e[8],A=e[9],b=e[10],_=e[11],t[0]=o,t[1]=a,t[2]=c,t[3]=l,t[4]=u,t[5]=h,t[6]=f,t[7]=g,t[8]=p,t[9]=A,t[10]=b,t[11]=_,t[12]=o*r+u*i+p*s+e[12],t[13]=a*r+h*i+A*s+e[13],t[14]=c*r+f*i+b*s+e[14],t[15]=l*r+g*i+_*s+e[15]),t}function ep(t,e,n){var r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _L(t,e,n,r){var i=r[0],s=r[1],o=r[2],a=Math.hypot(i,s,o),c,l,u,h,f,g,p,A,b,_,m,v,T,w,x,I,M,L,R,z,te,ne,X,Rt;return a<Io?null:(a=1/a,i*=a,s*=a,o*=a,c=Math.sin(n),l=Math.cos(n),u=1-l,h=e[0],f=e[1],g=e[2],p=e[3],A=e[4],b=e[5],_=e[6],m=e[7],v=e[8],T=e[9],w=e[10],x=e[11],I=i*i*u+l,M=s*i*u+o*c,L=o*i*u-s*c,R=i*s*u-o*c,z=s*s*u+l,te=o*s*u+i*c,ne=i*o*u+s*c,X=s*o*u-i*c,Rt=o*o*u+l,t[0]=h*I+A*M+v*L,t[1]=f*I+b*M+T*L,t[2]=g*I+_*M+w*L,t[3]=p*I+m*M+x*L,t[4]=h*R+A*z+v*te,t[5]=f*R+b*z+T*te,t[6]=g*R+_*z+w*te,t[7]=p*R+m*z+x*te,t[8]=h*ne+A*X+v*Rt,t[9]=f*ne+b*X+T*Rt,t[10]=g*ne+_*X+w*Rt,t[11]=p*ne+m*X+x*Rt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function d1(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+l*r,t[5]=o*i+u*r,t[6]=a*i+h*r,t[7]=c*i+f*r,t[8]=l*i-s*r,t[9]=u*i-o*r,t[10]=h*i-a*r,t[11]=f*i-c*r,t}function yL(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],c=e[3],l=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-l*r,t[1]=o*i-u*r,t[2]=a*i-h*r,t[3]=c*i-f*r,t[8]=s*r+l*i,t[9]=o*r+u*i,t[10]=a*r+h*i,t[11]=c*r+f*i,t}function g1(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],c=e[3],l=e[4],u=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+l*r,t[1]=o*i+u*r,t[2]=a*i+h*r,t[3]=c*i+f*r,t[4]=l*i-s*r,t[5]=u*i-o*r,t[6]=h*i-a*r,t[7]=f*i-c*r,t}function vL(t,e){var n=e[0],r=e[1],i=e[2],s=e[4],o=e[5],a=e[6],c=e[8],l=e[9],u=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(c,l,u),t}function AL(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,c=i+i,l=n*o,u=r*o,h=r*a,f=i*o,g=i*a,p=i*c,A=s*o,b=s*a,_=s*c;return t[0]=1-h-p,t[1]=u+_,t[2]=f-b,t[3]=0,t[4]=u-_,t[5]=1-l-p,t[6]=g+A,t[7]=0,t[8]=f+b,t[9]=g-A,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function EL(t,e,n,r,i,s,o){var a=1/(n-e),c=1/(i-r),l=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*c,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*c,t[10]=(o+s)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*l,t[15]=0,t}function TL(t,e,n,r,i){var s=1/Math.tan(e/2),o;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var bL=TL;function SL(t,e,n,r,i,s,o){var a=1/(e-n),c=1/(r-i),l=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*c,t[14]=(o+s)*l,t[15]=1,t}var wL=SL;function CL(t,e,n,r){var i,s,o,a,c,l,u,h,f,g,p=e[0],A=e[1],b=e[2],_=r[0],m=r[1],v=r[2],T=n[0],w=n[1],x=n[2];return Math.abs(p-T)<Io&&Math.abs(A-w)<Io&&Math.abs(b-x)<Io?gL(t):(u=p-T,h=A-w,f=b-x,g=1/Math.hypot(u,h,f),u*=g,h*=g,f*=g,i=m*f-v*h,s=v*u-_*f,o=_*h-m*u,g=Math.hypot(i,s,o),g?(g=1/g,i*=g,s*=g,o*=g):(i=0,s=0,o=0),a=h*o-f*s,c=f*i-u*o,l=u*s-h*i,g=Math.hypot(a,c,l),g?(g=1/g,a*=g,c*=g,l*=g):(a=0,c=0,l=0),t[0]=i,t[1]=a,t[2]=u,t[3]=0,t[4]=s,t[5]=c,t[6]=h,t[7]=0,t[8]=o,t[9]=l,t[10]=f,t[11]=0,t[12]=-(i*p+s*A+o*b),t[13]=-(a*p+c*A+l*b),t[14]=-(u*p+h*A+f*b),t[15]=1,t)}function xL(){var t=new hn(4);return hn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function BL(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function p1(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function IL(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function ML(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function RL(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=s*o,t}function PL(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function LL(t,e,n,r){var i=e[0],s=e[1],o=e[2],a=e[3];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=o+r*(n[2]-o),t[3]=a+r*(n[3]-a),t}function pa(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}function OL(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],c=n[2],l=n[3],u=l*r+a*s-c*i,h=l*i+c*r-o*s,f=l*s+o*i-a*r,g=-o*r-a*i-c*s;return t[0]=u*l+g*-o+h*-c-f*-a,t[1]=h*l+g*-a+f*-o-u*-c,t[2]=f*l+g*-c+u*-a-h*-o,t[3]=e[3],t}(function(){var t=xL();return function(e,n,r,i,s,o){var a,c;for(n||(n=4),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,a=r;a<c;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var id;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(id||(id={}));const DL=45*Math.PI/180,FL=1,dh=.1,gh=500,NL=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Y extends f1{static get IDENTITY(){return kL()}static get ZERO(){return UL()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return id}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,a,c,l,u,h,f,g,p,A,b){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=u,this[10]=h,this[11]=f,this[12]=g,this[13]=p,this[14]=A,this[15]=b,this.check()}setRowMajor(e,n,r,i,s,o,a,c,l,u,h,f,g,p,A,b){return this[0]=e,this[1]=s,this[2]=l,this[3]=g,this[4]=n,this[5]=o,this[6]=u,this[7]=p,this[8]=r,this[9]=a,this[10]=h,this[11]=A,this[12]=i,this[13]=c,this[14]=f,this[15]=b,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(NL)}fromObject(e){return this.check()}fromQuaternion(e){return AL(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=dh,far:a=gh}=e;return a===1/0?VL(this,n,r,i,s,o):EL(this,n,r,i,s,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return CL(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=dh,far:a=gh}=e;return wL(this,n,r,i,s,o,a),this.check()}orthographic(e){const{fovy:n=DL,aspect:r=FL,focalDistance:i=1,near:s=dh,far:o=gh}=e;x_(n);const a=n/2,c=i*Math.tan(a),l=c*r;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return x_(n),bL(this,n,r,i,s),this.check()}determinant(){return mL(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return pL(this,this),this.check()}invert(){return rd(this,this),this.check()}multiplyLeft(e){return oi(this,e,this),this.check()}multiplyRight(e){return oi(this,this,e),this.check()}rotateX(e){return d1(this,this,e),this.check()}rotateY(e){return yL(this,this,e),this.check()}rotateZ(e){return g1(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return _L(this,this,e,n),this.check()}scale(e){return ep(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Tl(this,this,e),this.check()}transform(e,n){return e.length===4?(n=pa(n||[-0,-0,-0,-0],e,this),Bo(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=i1(n||[-0,-0],e,this);break;case 3:i=Zg(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Bo(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=s1(n||[-0,-0],e,this);break;case 3:r=o1(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Bo(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let ac,cc;function UL(){return ac||(ac=new Y([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ac)),ac}function kL(){return cc||(cc=new Y,Object.freeze(cc)),cc}function x_(t){if(t>Math.PI*2)throw Error("expected radians")}function VL(t,e,n,r,i,s){const o=2*s/(n-e),a=2*s/(i-r),c=(n+e)/(n-e),l=(i+r)/(i-r),u=-1,h=-1,f=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=c,t[9]=l,t[10]=u,t[11]=h,t[12]=0,t[13]=0,t[14]=f,t[15]=0,t}function B_(){var t=new hn(4);return hn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function zL(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function m1(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function I_(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=n[0],c=n[1],l=n[2],u=n[3];return t[0]=r*u+o*a+i*l-s*c,t[1]=i*u+o*c+s*a-r*l,t[2]=s*u+o*l+r*c-i*a,t[3]=o*u-r*a-i*c-s*l,t}function HL(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=r*c+o*a,t[1]=i*c+s*a,t[2]=s*c-i*a,t[3]=o*c-r*a,t}function jL(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=r*c-s*a,t[1]=i*c+o*a,t[2]=s*c+r*a,t[3]=o*c-i*a,t}function WL(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=r*c+i*a,t[1]=i*c-r*a,t[2]=s*c+o*a,t[3]=o*c-s*a,t}function JL(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function Uc(t,e,n,r){var i=e[0],s=e[1],o=e[2],a=e[3],c=n[0],l=n[1],u=n[2],h=n[3],f,g,p,A,b;return g=i*c+s*l+o*u+a*h,g<0&&(g=-g,c=-c,l=-l,u=-u,h=-h),1-g>Io?(f=Math.acos(g),p=Math.sin(f),A=Math.sin((1-r)*f)/p,b=Math.sin(r*f)/p):(A=1-r,b=r),t[0]=A*i+b*c,t[1]=A*s+b*l,t[2]=A*o+b*u,t[3]=A*a+b*h,t}function XL(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s,a=o?1/o:0;return t[0]=-n*a,t[1]=-r*a,t[2]=-i*a,t[3]=s*a,t}function KL(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function _1(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[s*3+s]-e[o*3+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[s*3+o]-e[o*3+s])*r,t[s]=(e[s*3+i]+e[i*3+s])*r,t[o]=(e[o*3+i]+e[i*3+o])*r}return t}var YL=BL,QL=p1,qL=PL,ZL=LL,$L=IL,eO=ML,y1=RL,tO=function(){var t=c1(),e=S_(1,0,0),n=S_(0,1,0);return function(r,i,s){var o=qg(i,s);return o<-.999999?(Nc(t,e,i),rL(t)<1e-6&&Nc(t,n,i),q2(t,t),m1(r,t,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Nc(t,i,s),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+o,y1(r,r))}}();(function(){var t=B_(),e=B_();return function(n,r,i,s,o,a){return Uc(t,r,o,a),Uc(e,i,s,a),Uc(n,t,e,2*a*(1-a)),n}})();(function(){var t=iL();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],y1(e,_1(e,t))}})();const nO=[0,0,0,1];class Zo extends Kg{constructor(e=0,n=0,r=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,r,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,r,i){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return _1(this,e),this.check()}fromAxisRotation(e,n){return m1(this,e,n),this.check()}identity(){return zL(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=re(e)}get y(){return this[1]}set y(e){this[1]=re(e)}get z(){return this[2]}set z(e){this[2]=re(e)}get w(){return this[3]}set w(e){this[3]=re(e)}len(){return $L(this)}lengthSquared(){return eO(this)}dot(e){return qL(this,e)}rotationTo(e,n){return tO(this,e,n),this.check()}add(e){return YL(this,this,e),this.check()}calculateW(){return JL(this,this),this.check()}conjugate(){return KL(this,this),this.check()}invert(){return XL(this,this),this.check()}lerp(e,n,r){return r===void 0?this.lerp(this,e,n):(ZL(this,e,n,r),this.check())}multiplyRight(e){return I_(this,this,e),this.check()}multiplyLeft(e){return I_(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return HL(this,this,e),this.check()}rotateY(e){return jL(this,this,e),this.check()}rotateZ(e){return WL(this,this,e),this.check()}scale(e){return QL(this,this,e),this.check()}slerp(e,n,r){let i,s,o;switch(arguments.length){case 1:({start:i=nO,target:s,ratio:o}=e);break;case 2:i=this,s=e,o=n;break;default:i=e,s=n,o=r}return Uc(this,i,s,o),this.check()}transformVector4(e,n=new $g){return OL(n,e,this),Bo(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const $o={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},M_=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,rO={lightSources:{}};function ph(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function iO(t){let{ambientLight:e,pointLights:n=[],directionalLights:r=[]}=t;const i={};return e?i["lighting_uAmbientLight.color"]=ph(e):i["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((s,o)=>{i["lighting_uPointLight[".concat(o,"].color")]=ph(s),i["lighting_uPointLight[".concat(o,"].position")]=s.position,i["lighting_uPointLight[".concat(o,"].attenuation")]=s.attenuation||[1,0,0]}),i.lighting_uPointLightCount=n.length,r.forEach((s,o)=>{i["lighting_uDirectionalLight[".concat(o,"].color")]=ph(s),i["lighting_uDirectionalLight[".concat(o,"].direction")]=s.direction}),i.lighting_uDirectionalLightCount=r.length,i}function v1(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:rO;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:r}=t.lightSources||{};return e||n&&n.length>0||r&&r.length>0?Object.assign({},iO({ambientLight:e,pointLights:n,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return v1({lightSources:e})}return{}}const tp={name:"lights",vs:M_,fs:M_,getUniforms:v1,defines:{MAX_LIGHTS:3}},sO=new Uint8Array([0,255,255,255]),oO={pickingSelectedColor:null,pickingHighlightColor:sO,pickingActive:!1,pickingAttribute:!1};function aO(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oO;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const cO=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,lO=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,uO={name:"picking",vs:cO,fs:lO,getUniforms:aO},A1=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,hO={};function fO(t){const{ambient:e=.35,diffuse:n=.6,shininess:r=32,specularColor:i=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:r,lighting_uSpecularColor:i.map(s=>s/255)}}function E1(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:hO;if(!("material"in t))return{};const{material:e}=t;return e?fO(e):{lighting_uEnabled:!1}}const dO={name:"gouraud-lighting",dependencies:[tp],vs:A1,defines:{LIGHTING_VERTEX:1},getUniforms:E1},gO={name:"phong-lighting",dependencies:[tp],fs:A1,defines:{LIGHTING_FRAGMENT:1},getUniforms:E1},pO=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,mO=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,np={name:"pbr",vs:pO,fs:mO,defines:{LIGHTING_FRAGMENT:1},dependencies:[tp]},_O=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,yO={name:"transform",vs:_O,fs:null};class ma{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new ma(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:r="",defines:i={},inject:s={},varyings:o=[],bufferMode:a=35981,transpileToGLSL100:c=!1}=e,l=this._getModuleList(e.modules),u=this._getHash(n),h=this._getHash(r),f=l.map(v=>this._getHash(v.name)).sort(),g=o.map(v=>this._getHash(v)),p=Object.keys(i).sort(),A=Object.keys(s).sort(),b=[],_=[];for(const v of p)b.push(this._getHash(v)),b.push(this._getHash(i[v]));for(const v of A)_.push(this._getHash(v)),_.push(this._getHash(s[v]));const m="".concat(u,"/").concat(h,"D").concat(b.join("/"),"M").concat(f.join("/"),"I").concat(_.join("/"),"V").concat(g.join("/"),"H").concat(this.stateHash,"B").concat(a).concat(c?"T":"");if(!this._programCache[m]){const v=v2(this.gl,{vs:n,fs:r,modules:l,inject:s,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:c});this._programCache[m]=new JT(this.gl,{hash:m,vs:v.vs,fs:v.fs,varyings:o,bufferMode:a}),this._getUniforms[m]=v.getUniforms||(T=>{}),this._useCounts[m]=0}return this._useCounts[m]++,this._programCache[m]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],c=a.name;n[i++]=a,r[c]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],c=a.name;r[c]||(n[i++]=a,r[c]=!0)}return n.length=i,n}}const vO={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function AO(t,e,n){const r={};let i=e.indices;for(const s in e.attributes){const o=e.attributes[s],a=EO(s,n);if(s==="indices")i=o;else if(o.constant)r[a]=o.value;else{const c=o.value,l={...o};delete l.value,r[a]=[new se(t,c),l],TO(s,l)}}if(i){const s=i.value||i;N(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const o={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};r.indices=[new se(t,{data:s,target:34963}),o]}return r}function EO(t,e){const{attributeMap:n=vO}=e||{};return n&&n[t]||t}function TO(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}N(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Mi=2,bO=1e4,SO="Model needs drawMode and vertexCount",R_=()=>{},wO={};class di{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=nr("model")}=n;N(Zl(e)),this.id=r,this.gl=e,this.id=n.id||nr("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||ma.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:r,fs:i,modules:s,defines:o,inject:a,varyings:c,bufferMode:l,transpileToGLSL100:u}=e;this.programProps={program:n,vs:r,fs:i,modules:s,defines:o,inject:a,varyings:c,bufferMode:l,transpileToGLSL100:u},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},N(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),SO)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:r,fs:i,modules:s,defines:o,inject:a,varyings:c,bufferMode:l,transpileToGLSL100:u}=e;this.programProps={program:n,vs:r,fs:i,modules:s,defines:o,inject:a,varyings:c,bufferMode:l,transpileToGLSL100:u},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return N(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return N(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=AO(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ys(e))return this;const n={};for(const r in e){const i=e[r];n[r]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return zg(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:r,uniforms:i={},attributes:s={},transformFeedback:o=this.transformFeedback,parameters:a={},vertexArray:c=this.vertexArray}=e;this.setAttributes(s),this.updateModuleSettings(n),this.setUniforms(i);let l;V.priority>=Mi&&(l=this._logDrawCallStart(Mi));const u=this.vertexArray.getDrawParams(),{isIndexed:h=u.isIndexed,indexType:f=u.indexType,indexOffset:g=u.indexOffset,vertexArrayInstanced:p=u.isInstanced}=this.props;p&&!this.isInstanced&&V.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:A,instanceCount:b}=this,{onBeforeRender:_=R_,onAfterRender:m=R_}=this.props;_(),this.program.setUniforms(this.uniforms);const v=this.program.draw(Object.assign(wO,e,{logPriority:l,uniforms:null,framebuffer:r,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:c,transformFeedback:o,isIndexed:h,indexType:f,isInstanced:A,instanceCount:b,offset:h?g:0}));return m(),V.priority>=Mi&&this._logDrawCallEnd(l,c,r),v}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:r,unbindModels:i=[]}=e;let{parameters:s}=e;r&&this._setFeedbackBuffers(r),n&&(s=Object.assign({},s,{35977:n})),i.forEach(o=>o.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:s}))}finally{i.forEach(o=>o.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return V.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:r,fs:i,modules:s,inject:o,defines:a,varyings:c,bufferMode:l,transpileToGLSL100:u}=this.programProps;n=this.programManager.get({vs:r,fs:i,modules:s,inject:o,defines:a,varyings:c,bufferMode:l,transpileToGLSL100:u}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}N(n instanceof JT,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new OP(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof se&&n.delete()}}_setAnimationProps(e){this.animated&&N(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ys(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new XT(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:bO;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),V.group(Mi,">>> DRAWING MODEL ".concat(this.id),{collapsed:V.level<=2})(),e}_logDrawCallEnd(e,n,r,i){if(e===void 0)return;const s=NP({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:o,unusedTable:a,unusedCount:c}=f_({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:l,count:u}=f_({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});u>0&&V.log("MISSING UNIFORMS",Object.keys(l))(),c>0&&V.log("UNUSED UNIFORMS",Object.keys(a))();const h=kP(this.vertexArray.configuration);V.table(e,s)(),V.table(e,o)(),V.table(e+1,h)(),i&&i.log({logLevel:Mi,message:"Rendered to ".concat(i.id)}),V.groupEnd(Mi)()}}class CO{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:i}=n;return{attributes:Object.assign({},r,e.attributes),transformFeedback:i}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],r=e?n[e]:null;return r?r instanceof se?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,r=this.getBuffer(n);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&N(J(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const i in this.feedbackMap){const s=this.feedbackMap[i];i in n&&(r[s]=i)}Object.assign(r,e.feedbackBuffers);for(const i in r){const s=r[i];if(typeof s=="string"){const o=n[s],{byteLength:a,usage:c,accessor:l}=o;r[i]=this._createNewBuffer(i,{byteLength:a,usage:c,accessor:l})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:r})}_setupTransformFeedback(e,n){let{model:r}=n;const{program:i}=r;e.transformFeedback=new XT(this.gl,{program:i,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:n,feedbackBuffers:r})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const i in this.feedbackMap){const s=this.feedbackMap[i];n[i]=e.feedbackBuffers[s],r[s]=e.sourceBuffers[i],N(r[s]instanceof se)}return{sourceBuffers:n,feedbackBuffers:r}}_createNewBuffer(e,n){const r=new se(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const xO="transform_uSampler_",bl="transform_uSize_",P_="transform_position";function BO(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:r,targetTexture:i}=t,o=Object.keys(n).length,a=null;const c={};let l=e,u={};if(o>0||r){const h=l.split(`
`),f=h.slice();if(h.forEach((g,p,A)=>{if(o>0){const b=LO(g,n);if(b){const{updatedLine:_,inject:m}=b;f[p]=_,u=$f([u,m]),Object.assign(c,b.samplerTextureMap),o--}}r&&!a&&(a=PO(g,r))}),r){N(i);const g="".concat(bl).concat(r),p="uniform vec2 ".concat(g,`;
`),A="     vec2 ".concat(P_," = transform_getPos(").concat(g,`);
     gl_Position = vec4(`).concat(P_,`, 0, 1.);
`);u=$f([u,{"vs:#decl":p,"vs:#main-start":A}])}l=f.join(`
`)}return{vs:l,targetTextureType:a,inject:u,samplerTextureMap:c}}function IO(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:r}=t;const i={};let s,o;n&&({width:s,height:o}=r,i["".concat(bl).concat(n)]=[s,o]);for(const a in e)({width:s,height:o}=e[a]),i["".concat(bl).concat(a)]=[s,o];return i}function MO(t){return e1(t,["attribute","in"])}function RO(t){const e="".concat(xO).concat(t),n="".concat(bl).concat(t),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:r}}function PO(t,e){const n=e1(t,["varying","out"]);return n&&n.name===e?n.type:null}function LO(t,e){const n={},r=MO(t);if(!r)return null;const{type:i,name:s}=r;if(s&&e[s]){const o="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:a,sizeName:c,uniformDeclerations:l}=RO(s),u=B2(i),h="  ".concat(i," ").concat(s," = transform_getInput(").concat(a,", ").concat(c,").").concat(u,`;
`);return n[a]=s,{updatedLine:o,inject:{"vs:#decl":l,"vs:#main-start":h},samplerTextureMap:n}}return null}const OO={10241:9728,10240:9728,10242:33071,10243:33071},DO="transform_output";class FO{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:r,framebuffer:i,targetTexture:s}=this.bindings[this.currentIndex],o=Object.assign({},n,e.attributes),a=Object.assign({},e.uniforms),c=Object.assign({},e.parameters);let l=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const h in this.samplerTextureMap){const f=this.samplerTextureMap[h];a[h]=r[f]}this._setSourceTextureParameters();const u=IO({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(a,u)}return this.hasTargetTexture&&(l=!1,c.viewport=[0,0,i.width,i.height]),{attributes:o,framebuffer:i,uniforms:a,discard:l,parameters:c}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],r=eu(n);if(!e)return r;const i=r.constructor,s=I2(this.targetTextureType),o=new i(r.length*s/4);let a=0;for(let c=0;c<r.length;c+=4)for(let l=0;l<s;l++)o[a++]=r[c+l];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:r}=e;if(r instanceof qe)return r;const i=n[r];return i?(this._targetRefTexName=r,this._createNewTexture(i)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:r={},_targetTexture:i}=e,s=this._createTargetTexture({sourceTextures:r,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:r,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((r,i,s)=>{s[i]=i}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new se(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:n,targetTexture:r})}}_updateBinding(e,n){const{sourceBuffers:r,sourceTextures:i,targetTexture:s}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,r),s){e.targetTexture=s;const{width:o,height:a}=s,{framebuffer:c}=e;c?(c.update({attachments:{36064:s},resizeAttachments:!1}),c.resize({width:o,height:a})):e.framebuffer=new Oe(this.gl,{id:"transform-framebuffer",width:o,height:a,attachments:{36064:s}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const r in n)n[r].setParameters(OO)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:r}}_createNewTexture(e){const n=bR(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:r}=this.bindings[this.currentIndex],{vs:i,uniforms:s,targetTextureType:o,inject:a,samplerTextureMap:c}=BO({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),l=$f([e.inject||{},a]);this.targetTextureType=o,this.samplerTextureMap=c;const u=e._fs||t1({version:jT(i),input:this.targetTextureVarying,inputType:o,output:DO}),h=this.hasSourceTextures||this.targetTextureVarying?[yO].concat(e.modules||[]):e.modules;return{vs:i,fs:u,modules:h,uniforms:s,inject:l}}}class ea{static isSupported(e){return J(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:r}=this;e&&e.delete(),n&&n.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,r=this._updateDrawOptions(e);n&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)e=e||r.swap();N(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n){const i=r.getData(e);if(i)return i}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new di(n,Object.assign({},e,{fs:e.fs||t1({version:jT(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)n=i.updateModelProps(n);return n}_buildResourceTransforms(e,n){NO(n)&&(this.bufferTransform=new CO(e,n)),UO(n)&&(this.textureTransform=new FO(e,n)),N(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)n=Object.assign(n,i.getDrawOptions(n));return n}}function NO(t){return!!(!ys(t.feedbackBuffers)||!ys(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function UO(t){return!!(!ys(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const L_={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class os{static get DRAW_MODE(){return L_}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=nr("geometry"),drawMode:r=L_.TRIANGLES,attributes:i={},indices:s=null,vertexCount:o=null}=e;this.id=n,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(i,s),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const r in e){let i=e[r];i=ArrayBuffer.isView(i)?{value:i}:i,N(ArrayBuffer.isView(i.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!i.size&&(i.size=3),r==="indices"?(N(!this.indices),this.indices=i):this.attributes[r]=i}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i in e){const s=e[i],{value:o,size:a,constant:c}=s;!c&&o&&a>=1&&(r=Math.min(r,o.length/a))}return N(Number.isFinite(r)),r}}let kO=1,GO=1;class T1{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=kO++,a={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=GO++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const VO=[255,255,255],zO=1;let HO=0;class b1{constructor(e={}){d(this,"id",void 0),d(this,"color",void 0),d(this,"intensity",void 0),d(this,"type","ambient");const{color:n=VO}=e,{intensity:r=zO}=e;this.id=e.id||"ambient-".concat(HO++),this.color=n,this.intensity=r}}const jO=[255,255,255],WO=1,JO=[0,0,-1];let XO=0;class sd{constructor(e={}){d(this,"id",void 0),d(this,"color",void 0),d(this,"intensity",void 0),d(this,"type","directional"),d(this,"direction",void 0),d(this,"shadow",void 0);const{color:n=jO}=e,{intensity:r=WO}=e,{direction:i=JO}=e,{_shadow:s=!1}=e;this.id=e.id||"directional-".concat(XO++),this.color=n,this.intensity=r,this.type="directional",this.direction=new C(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class KO{constructor(e,n={id:"pass"}){d(this,"id",void 0),d(this,"gl",void 0),d(this,"props",void 0);const{id:r}=n;this.id=r,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class rp extends KO{constructor(...e){super(...e),d(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return tr(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:r,viewports:i,views:s,onViewportActive:o,clearStack:a=!0,clearCanvas:c=!0}=e;e.pass=e.pass||"unknown";const l=this.gl;c&&QO(l,n),a&&(this._lastRenderIndex=-1);const u=[];for(const h of i){const f=s&&s[h.id];o==null||o(h);const g=this._getDrawLayerParams(h,e),p=h.subViewports||[h];for(const A of p){const b=this._drawLayersInViewport(l,{target:n,moduleParameters:r,viewport:A,view:f,pass:e.pass,layers:e.layers},g);u.push(b)}}return u}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,moduleParameters:c},l=!1){const u=[],h=S1(this._lastRenderIndex+1),f={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},g={};for(let p=0;p<n.length;p++){const A=n[p],b=this._shouldDrawLayer(A,f,s,g),_={shouldDrawLayer:b};b&&!l&&(_.layerRenderIndex=h(A,b),_.moduleParameters=this._getModuleParameters(A,a,r,c),_.layerParameters=this.getLayerParameters(A,p,e)),u[p]=_}return u}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:i,target:s,viewport:o,view:a},c){const l=YO(e,{moduleParameters:r,target:s,viewport:o});if(a&&a.props.clear){const h=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;Wt(e,{scissorTest:!0,scissor:l},()=>zg(e,h))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};tr(e,{viewport:l});for(let h=0;h<n.length;h++){const f=n[h],{shouldDrawLayer:g,layerRenderIndex:p,moduleParameters:A,layerParameters:b}=c[h];if(g&&f.props.pickable&&u.pickableCount++,f.isComposite)u.compositeCount++;else if(g){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,p),A.viewport=o;try{f._drawLayer({moduleParameters:A,uniforms:{layerIndex:p},parameters:b})}catch(_){f.raiseError(_,"drawing ".concat(f," to ").concat(i))}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in i||(i[a]=r(n)),!i[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,i){var s;const o=Object.assign(Object.create(((s=e.internalState)===null||s===void 0?void 0:s.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:fi(this.gl)});if(n)for(const c of n){var a;Object.assign(o,(a=c.getModuleParameters)===null||a===void 0?void 0:a.call(c,e))}return Object.assign(o,this.getModuleParameters(e,n),i)}}function S1(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,a=i.id,c=i.parent&&i.parent.id;let l;if(c&&!(c in e)&&r(i.parent,!1),c in n){const u=n[c]=n[c]||S1(e[c],e);l=u(i,s),n[a]=u}else Number.isFinite(o)?(l=o+(e[c]||0),n[a]=null):l=t;return s&&l>=t&&(t=l+1),e[a]=l,l};return r}function YO(t,{moduleParameters:e,target:n,viewport:r}){const i=n&&n.id!=="default-framebuffer",s=e&&e.devicePixelRatio||fi(t),o=i?n.height:t.drawingBufferHeight,a=r;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function QO(t,e){const n=e?e.width:t.drawingBufferWidth,r=e?e.height:t.drawingBufferHeight;tr(t,{viewport:[0,0,n,r]}),t.clear(16640)}class qO extends rp{constructor(e,n){super(e,n),d(this,"shadowMap",void 0),d(this,"depthBuffer",void 0),d(this,"fbo",void 0),this.shadowMap=new qe(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Qi(e,{format:33189,width:1,height:1}),this.fbo=new Oe(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const n=this.fbo;Wt(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],i=fi(this.gl),s=r.width*i,o=r.height*i;(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const w1="#define SMOOTH_EDGE_RADIUS 0.5",ZO=`
`.concat(w1,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),$O=`
`.concat(w1,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),e3={name:"geometry",vs:ZO,fs:$O},t3=Object.keys(W).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(W[t],";")).join(""),n3=Object.keys(Cn).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(Cn[t],";")).join(""),r3=Object.keys(Kf).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(Kf[t],";")).join(""),i3="".concat(t3,`
`).concat(n3,`
`).concat(r3,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function s3(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function _a(t){let e={},n;return r=>{for(const i in r)if(!s3(r[i],e[i])){n=t(r),e=r;break}return n}}const O_=[0,0,0,0],o3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],C1=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a3=[0,0,0],x1=[0,0,0],c3=_a(h3);function B1(t,e,n=x1){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===W.LNGLAT_OFFSETS||e===W.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Cn.WEB_MERCATOR:(e===W.LNGLAT||e===W.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Cn.WEB_MERCATOR_AUTO_OFFSET:e===W.LNGLAT?r=i:e===W.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Cn.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Cn.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function l3(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=O_,c=O_,l=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:f}=B1(t,e,n);return f&&(c=t.projectPosition(u||h),l=[l[0]-c[0],l[1]-c[1],l[2]-c[2]],c[3]=1,a=pa([],c,o),s=r||s,o=oi([],i,s),o=oi([],o,o3)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:c,cameraPosCommon:l,shaderCoordinateOrigin:h,geospatialOrigin:u}}function u3({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=W.DEFAULT,coordinateOrigin:i=x1,autoWrapLongitude:s=!1}){r===W.DEFAULT&&(r=t.isGeospatial?W.LNGLAT:W.CARTESIAN);const o=c3({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||C1,o}function h3({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:c,geospatialOrigin:l}=l3(t,n,r),u=t.getDistanceScales(),h=[t.width*e,t.height*e],f=pa([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,g={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:c,project_uCommonOrigin:o.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:h,project_uDevicePixelRatio:e,project_uFocalDistance:f,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:a3,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:C1,project_uCameraPosition:a};if(l){const p=t.getDistanceScales(l);switch(n){case W.METER_OFFSETS:g.project_uCommonUnitsPerWorldUnit=p.unitsPerMeter,g.project_uCommonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case W.LNGLAT:case W.LNGLAT_OFFSETS:t._pseudoMeters||(g.project_uCommonUnitsPerMeter=p.unitsPerMeter),g.project_uCommonUnitsPerWorldUnit=p.unitsPerDegree,g.project_uCommonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case W.CARTESIAN:g.project_uCommonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],g.project_uCommonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break}}return g}const f3={};function d3(t=f3){return"viewport"in t?u3(t):{}}const ip={name:"project",dependencies:[P2,e3],vs:i3,getUniforms:d3};function g3(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function as(t,e){const n=pa([],e,t);return p1(n,n,1/n[3]),n}function D_(t,e){const n=t%e;return n<0?e+n:n}function od(t,e,n){return t<e?e:t>n?n:t}function p3(t){return Math.log(t)*Math.LOG2E}const sp=Math.log2||p3;function rr(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const sn=Math.PI,I1=sn/4,Jt=sn/180,ad=180/sn,Es=512,Sl=4003e4,lc=85.051129,m3=1.5;function _3(t){return sp(t)}function wl(t){const[e,n]=t;rr(Number.isFinite(e)),rr(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*Jt,i=n*Jt,s=Es*(r+sn)/(2*sn),o=Es*(sn+Math.log(Math.tan(I1+i*.5)))/(2*sn);return[s,o]}function Ts(t){const[e,n]=t,r=e/Es*(2*sn)-sn,i=2*(Math.atan(Math.exp(n/Es*(2*sn)-sn))-I1);return[r*ad,i*ad]}function y3(t){const{latitude:e}=t;rr(Number.isFinite(e));const n=Math.cos(e*Jt);return _3(Sl*n)-9}function mh(t){const e=Math.cos(t*Jt);return Es/Sl/e}function cd(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;rr(Number.isFinite(e)&&Number.isFinite(n));const i=Es,s=Math.cos(e*Jt),o=i/360,a=o/s,c=i/Sl/s,l={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[o,a,c],degreesPerUnit:[1/o,1/a,1/c]};if(r){const u=Jt*Math.tan(e*Jt)/s,h=o*u/2,f=i/Sl*u,g=f/a*c;l.unitsPerDegree2=[0,h,f],l.unitsPerMeter2=[g,0,g]}return l}function M1(t,e){const[n,r,i]=t,[s,o,a]=e,{unitsPerMeter:c,unitsPerMeter2:l}=cd({longitude:n,latitude:r,highPrecision:!0}),u=wl(t);u[0]+=s*(c[0]+l[0]*o),u[1]+=o*(c[1]+l[1]*o);const h=Ts(u),f=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[h[0],h[1],f]:h}function v3(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,a=g3();Tl(a,a,[0,0,-i]),d1(a,a,-n*Jt),g1(a,a,r*Jt);const c=s/e;return ep(a,a,[c,c,c]),o&&Tl(a,a,Q2([],o)),a}function A3(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:c=1,farZMultiplier:l=1}=t;let{fovy:u=Cl(m3)}=t;r!==void 0&&(u=Cl(r));const h=u*Jt,f=i*Jt,g=R1(u);let p=g;o&&(p+=o[2]*a/Math.cos(f)/n);const A=h*(.5+(s?s[1]:0)/n),b=Math.sin(A)*p/Math.sin(od(Math.PI/2-f-A,.01,Math.PI-.01)),_=Math.sin(f)*b+p,m=p*10,v=Math.min(_*l,m);return{fov:h,aspect:e/n,focalDistance:g,near:c,far:v}}function Cl(t){return 2*Math.atan(.5/t)*ad}function R1(t){return .5/Math.tan(.5*t*Jt)}function P1(t,e){const[n,r,i=0]=t;return rr(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),as(e,[n,r,i,1])}function op(t,e,n=0){const[r,i,s]=t;if(rr(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return as(e,[r,i,s,1]);const o=as(e,[r,i,0,1]),a=as(e,[r,i,1,1]),c=o[2],l=a[2],u=c===l?0:((n||0)-c)/(l-c);return n1([],o,a,u)}function E3(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,c],[l,u]]=r,h=T3(t.padding),f=wl([a,od(u,-lc,lc)]),g=wl([l,od(c,-lc,lc)]),p=[Math.max(Math.abs(g[0]-f[0]),i),Math.max(Math.abs(g[1]-f[1]),i)],A=[e-h.left-h.right-Math.abs(o[0])*2,n-h.top-h.bottom-Math.abs(o[1])*2];rr(A[0]>0&&A[1]>0);const b=A[0]/p[0],_=A[1]/p[1],m=(h.right-h.left)/2/b,v=(h.top-h.bottom)/2/_,T=[(g[0]+f[0])/2+m,(g[1]+f[1])/2+v],w=Ts(T),x=Math.min(s,sp(Math.abs(Math.min(b,_))));return rr(Number.isFinite(x)),{longitude:w[0],latitude:w[1],zoom:x}}function T3(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(rr(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const F_=Math.PI/180;function b3(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),a=i([n,r],s);let c,l;const u=t.fovy?.5*t.fovy*F_:Math.atan(.5/t.altitude),h=(90-t.pitch)*F_;return u>h-.01?(c=N_(t,0,e),l=N_(t,n,e)):(c=i([0,0],s),l=i([n,0],s)),[o,a,l,c]}function N_(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=as(r,[e,0,1,1]),s=as(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),c=n1([],i,s,a),l=Ts(c);return l.push(n),l}const U_=512;function S3(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=t;(i<-180||i>180)&&(i=D_(i+180,360)-180),(a<-180||a>180)&&(a=D_(a+180,360)-180);const c=sp(n/U_);if(o<=c)o=c,s=0;else{const l=n/2/Math.pow(2,o),u=Ts([0,l])[1];if(s<u)s=u;else{const h=Ts([0,U_-l])[1];s>h&&(s=h)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const w3=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,C3=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,x3=_a(P3),B3=_a(L3),I3=[0,0,0,1],M3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function R3(t,e){const[n,r,i]=t,s=op([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function P3({viewport:t,center:e}){return new Y(t.viewProjectionMatrix).invert().transform(e)}function L3({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>R3(o,r));for(const o of e){const a=o.clone().translate(new C(t.center).negate()),c=s.map(u=>a.transform(u)),l=new Y().ortho({left:Math.min(...c.map(u=>u[0])),right:Math.max(...c.map(u=>u[0])),bottom:Math.min(...c.map(u=>u[1])),top:Math.max(...c.map(u=>u[1])),near:Math.min(...c.map(u=>-u[2])),far:Math.max(...c.map(u=>-u[2]))});n.push(l.multiplyRight(o))}return n}function O3(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||I3,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=x3({viewport:t.viewport,center:e.project_uCenter}),s=[],o=B3({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const c=o[a],l=c.clone().translate(new C(t.viewport.center).negate());e.project_uCoordinateSystem===W.LNGLAT&&e.project_uProjectionMode===Cn.WEB_MERCATOR?(o[a]=l,s[a]=i):(o[a]=c.clone().multiplyRight(M3),s[a]=l.transform(i))}for(let a=0;a<o.length;a++)r["shadow_uViewProjectionMatrices[".concat(a,"]")]=o[a],r["shadow_uProjectCenters[".concat(a,"]")]=s[a],t.shadowMaps&&t.shadowMaps.length>0?r["shadow_uShadowMap".concat(a)]=t.shadowMaps[a]:r["shadow_uShadowMap".concat(a)]=t.dummyShadowMap;return r}const _h={name:"shadow",dependencies:[ip],vs:w3,fs:C3,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?O3(t,e):{}},D3={color:[255,255,255],intensity:1},k_=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],F3=[0,0,0,200/255];class ap{constructor(e={}){d(this,"id","lighting-effect"),d(this,"props",void 0),d(this,"shadowColor",F3),d(this,"shadow",void 0),d(this,"ambientLight",void 0),d(this,"directionalLights",void 0),d(this,"pointLights",void 0),d(this,"shadowPasses",[]),d(this,"shadowMaps",[]),d(this,"dummyShadowMap",null),d(this,"programManager",void 0),d(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:r,viewports:i,onViewportActive:s,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=ma.getDefaultProgramManager(e),_h&&this.programManager.addDefaultModule(_h)),this.dummyShadowMap||(this.dummyShadowMap=new qe(e,{width:1,height:1}));for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:n,layerFilter:r,viewports:i,onViewportActive:s,views:o,moduleParameters:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(_h),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new Y().lookAt({eye:new C(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new qO(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new b1(D3),this.directionalLights.push(new sd(k_[0]),new sd(k_[1])))}}class N3{constructor(e={}){d(this,"_pool",[]),d(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:c}){const l=i||e&&e.constructor||Float32Array,u=n*r+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,u)}let h=1/0;c&&(h=c*r+s);const f=this._allocate(l,u,a,h);return e&&o?f.set(e):a||f.fill(0,0,4),this._release(e),f}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,c=o.findIndex(l=>l.byteLength>=a);if(c>=0){const l=new e(o.splice(c,1)[0],0,s);return r&&l.fill(0),l}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const ta=new N3;function go(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function U3(t){return[t[12],t[13],t[14]]}function k3(t){return{left:Ri(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Ri(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Ri(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Ri(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Ri(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Ri(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const G_=new C;function Ri(t,e,n,r){G_.set(t,e,n);const i=G_.len();return{distance:r/i,normal:new C(-t/i,-e/i,-n/i)}}function G3(t){return t-Math.fround(t)}let eo;function yh(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;eo=ta.allocate(eo,s,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<i;){for(let c=0;c<n;c++){const l=t[o++];eo[a+c]=l,eo[a+c+n]=G3(l)}a+=n*2}return eo.subarray(0,s*n*2)}function V3(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const z3=Math.PI/180,H3=go(),V_=[0,0,0],j3={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function W3({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const c=t/e,l=n?new Y().orthographic({fovy:r,aspect:c,focalDistance:i,near:o,far:a}):new Y().perspective({fovy:r,aspect:c,near:o,far:a});if(s){const{left:u=0,right:h=0,top:f=0,bottom:g=0}=s,p=Jn((u+t-h)/2,0,t)-t/2,A=Jn((f+e-g)/2,0,e)-e/2;l[8]-=p*2/t,l[9]+=A*2/e}return l}class Rs{constructor(e={}){d(this,"id",void 0),d(this,"x",void 0),d(this,"y",void 0),d(this,"width",void 0),d(this,"height",void 0),d(this,"padding",void 0),d(this,"isGeospatial",void 0),d(this,"zoom",void 0),d(this,"focalDistance",void 0),d(this,"position",void 0),d(this,"modelMatrix",void 0),d(this,"distanceScales",void 0),d(this,"scale",void 0),d(this,"center",void 0),d(this,"cameraPosition",void 0),d(this,"projectionMatrix",void 0),d(this,"viewMatrix",void 0),d(this,"viewMatrixUncentered",void 0),d(this,"viewMatrixInverse",void 0),d(this,"viewProjectionMatrix",void 0),d(this,"pixelProjectionMatrix",void 0),d(this,"pixelUnprojectionMatrix",void 0),d(this,"resolution",void 0),d(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||j3,this.focalDistance=e.focalDistance||1,this.position=e.position||V_,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Cn.WEB_MERCATOR:Cn.WEB_MERCATOR_AUTO_OFFSET:Cn.IDENTITY}equals(e){return e instanceof Rs?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&ln(e.projectionMatrix,this.projectionMatrix)&&ln(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=P1(r,this.pixelProjectionMatrix),[s,o]=i,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,c=r&&r*this.distanceScales.unitsPerMeter[2],l=op([i,a,o],this.pixelUnprojectionMatrix,c),[u,h,f]=this.unprojectPosition(l);return Number.isFinite(o)?[u,h,f]:Number.isFinite(r)?[u,h,r]:[u,h]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=wl(e);return n[1]=Jn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Ts(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e?cd({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,k3(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=y3({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||cd({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=V_;if(s&&(a=o?new Y(o).transformAsVector(s,[]):s),this.isGeospatial){const c=this.projectPosition([n,r,0]);this.center=new C(a).scale(this.distanceScales.unitsPerMeter).add(c)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=H3,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:c=1e3,padding:l=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Y().multiplyRight(n).translate(new C(this.center).negate()),this.projectionMatrix=r||W3({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*z3,focalDistance:u,padding:l,near:a,far:c});const h=go();oi(h,h,this.projectionMatrix),oi(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=rd([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=U3(this.viewMatrixInverse);const f=go(),g=go();ep(f,f,[this.width/2,-this.height/2,1]),Tl(f,f,[1,-1,0]),oi(g,f,this.viewProjectionMatrix),this.pixelProjectionMatrix=g,this.pixelUnprojectionMatrix=rd(go(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||q.warn("Pixel project matrix not invertible")()}}d(Rs,"displayName","Viewport");class bs extends Rs{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:c=1.01,nearZ:l,farZ:u,orthographic:h=!1,projectionMatrix:f,repeat:g=!1,worldOffset:p=0,position:A,padding:b,legacyMeterSizes:_=!1}=e;let{width:m,height:v,altitude:T=1.5}=e;const w=Math.pow(2,i);m=m||1,v=v||1;let x,I=null;if(f)T=f[5]/2,x=Cl(T);else{e.fovy?(x=e.fovy,T=R1(x)):x=Cl(T);let L;if(b){const{top:R=0,bottom:z=0}=b;L=[0,Jn((R+v-z)/2,0,v)-v/2]}I=A3({width:m,height:v,scale:w,center:A&&[0,0,A[2]*mh(n)],offset:L,pitch:s,fovy:x,nearZMultiplier:a,farZMultiplier:c}),Number.isFinite(l)&&(I.near=l),Number.isFinite(u)&&(I.far=u)}let M=v3({height:v,pitch:s,bearing:o,scale:w,altitude:T});p&&(M=new Y().translate([512*p,0,0]).multiplyLeft(M)),super({...e,width:m,height:v,viewMatrix:M,longitude:r,latitude:n,zoom:i,...I,fovy:x,focalDistance:T}),d(this,"longitude",void 0),d(this,"latitude",void 0),d(this,"pitch",void 0),d(this,"bearing",void 0),d(this,"altitude",void 0),d(this,"fovy",void 0),d(this,"orthographic",void 0),d(this,"_subViewports",void 0),d(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=T,this.fovy=x,this.orthographic=h,this._subViewports=g?[]:null,this._pseudoMeters=_,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new bs({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*mh(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/mh(r);return[n,r,i]}addMetersToLngLat(e,n){return M1(e,n)}panByPosition(e,n){const r=op(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=b_([],i,j2([],r)),o=b_([],this.center,s),[a,c]=this.unprojectFlat(o);return{longitude:a,latitude:c}}getBounds(e={}){const n=b3(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=E3({width:r,height:i,bounds:e,...n});return new bs({width:r,height:i,longitude:s,latitude:o,zoom:a})}}d(bs,"displayName","WebMercatorViewport");const z_=[0,0,0];function vh(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof bs){const[i,s,o=0]=t,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function J3(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===W.DEFAULT&&(i=e.isGeospatial?W.LNGLAT:W.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function L1(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,c=0]=t;switch(n&&([o,a,c]=pa([],[o,a,c,1],n)),r){case W.LNGLAT:return vh([o,a,c],e,s);case W.LNGLAT_OFFSETS:return vh([o+i[0],a+i[1],c+(i[2]||0)],e,s);case W.METER_OFFSETS:return vh(M1(i,[o,a,c]),e,s);case W.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],c+i[2]]:e.projectPosition([o,a,c])}}function O1(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=J3(e),{autoOffset:c=!0}=e,{geospatialOrigin:l=z_,shaderCoordinateOrigin:u=z_,offsetMode:h=!1}=c?B1(n,r,i):{},f=L1(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});if(h){const g=n.projectPosition(l||u);nL(f,f,g)}return f}const X3=[255,255,255],K3=1,Y3=[0,0,1],Q3=[0,0,1];let q3=0;class H_{constructor(e={}){d(this,"id",void 0),d(this,"color",void 0),d(this,"intensity",void 0),d(this,"type","point"),d(this,"position",void 0),d(this,"attenuation",void 0),d(this,"projectedLight",void 0);const{color:n=X3}=e,{intensity:r=K3}=e,{position:i=Q3}=e;this.id=e.id||"point-".concat(q3++),this.color=n,this.intensity=r,this.type="point",this.position=i,this.attenuation=Z3(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:n}=this,r=e.context.viewport,{coordinateSystem:i,coordinateOrigin:s}=e.props,o=O1(this.position,{viewport:r,coordinateSystem:i,coordinateOrigin:s,fromCoordinateSystem:r.isGeospatial?W.LNGLAT:W.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return n.color=this.color,n.intensity=this.intensity,n.position=o,n}}function Z3(t){return t.attenuation?t.attenuation:"intensity"in t?[0,0,t.intensity||0]:Y3}const j_={blendFunc:[1,0,32771,0],blendEquation:32774};class D1 extends rp{constructor(...e){super(...e),d(this,"pickZ",void 0),d(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:c,width:l,height:u},cullRect:h,effects:f,pass:g="picking",pickZ:p,moduleParameters:A}){const b=this.gl;this.pickZ=p;const _=this._resetColorEncoder(p),m=Wt(b,{scissorTest:!0,scissor:[a,c,l,u],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...j_,blend:!p},()=>super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:h,effects:f==null?void 0:f.filter(T=>T.useInPicking),pass:g,isPicking:!0,moduleParameters:A}));return this._colorEncoderState=null,{decodePickingColor:_&&eD.bind(null,_),stats:m}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,r){const i={...e.props.parameters},{pickable:s,operation:o}=e.props;return this._colorEncoderState?s&&o.includes("draw")&&(Object.assign(i,j_),i.blend=!0,i.blendColor=$3(this._colorEncoderState,e,r)):i.blend=!1,o.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function $3(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(q.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function eD(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Fi={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},xl=Symbol.for("component"),Lr=Symbol.for("propTypes"),Ah=Symbol.for("deprecatedProps"),cs=Symbol.for("asyncPropDefaults"),gi=Symbol.for("asyncPropOriginal"),br=Symbol.for("asyncPropResolved");function cp(t,e=()=>!0){return Array.isArray(t)?F1(t,e,[]):e(t)?[t]:[]}function F1(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?F1(i,e,n):e(i)&&n.push(i)}return n}function tD({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=n;o<i;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class nD{constructor(e,n,r){d(this,"id",void 0),d(this,"context",void 0),d(this,"isLoaded",void 0),d(this,"persistent",void 0),d(this,"_loadCount",0),d(this,"_subscribers",new Set),d(this,"_data",void 0),d(this,"_loader",void 0),d(this,"_error",void 0),d(this,"_content",void 0),this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=Fr(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class rD{constructor({gl:e,protocol:n}){d(this,"protocol",void 0),d(this,"_context",void 0),d(this,"_resources",void 0),d(this,"_consumers",void 0),d(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new nD(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{},a=o[n]||{},c=a.resourceId&&this._resources[a.resourceId];c&&(c.unsubscribe(a),this.prune()),r&&(o[n]=a,a.onChange=i,a.resourceId=r.id,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const iD=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,tu={name:"project32",dependencies:[ip],vs:iD},lp={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...uO},sD=[ip],oD=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function aD(t){const e=ma.getDefaultProgramManager(t);for(const n of sD)e.addDefaultModule(n);for(const n of oD)e.addShaderHook(n);return e}const cD="layerManager.setLayers",lD="layerManager.activateViewport";class uD{constructor(e,{deck:n,stats:r,viewport:i,timeline:s}={}){d(this,"layers",void 0),d(this,"context",void 0),d(this,"resourceManager",void 0),d(this,"_lastRenderedLayers",[]),d(this,"_needsRedraw",!1),d(this,"_needsUpdate",!1),d(this,"_nextLayers",null),d(this,"_debug",!1),d(this,"activateViewport",o=>{Ke(lD,this,o),o&&(this.context.viewport=o)}),this.layers=[],this.resourceManager=new rD({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&aD(e),stats:r||new Gg({id:"deck.gl"}),viewport:i||new Rs({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new T1,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Ke(cD,this,n,e),this._lastRenderedLayers=e;const r=cp(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,r){r.raiseError(n,"".concat(e," of ").concat(r))}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?q.warn("Multiple old layers with same id ".concat(o.id))():r[o.id]=o;const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s="Uniform transition in ".concat(o);break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&q.warn("Multiple new layers with same id ".concat(i.id))(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Fi.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Fi.MATCHED,n!==e&&(e.lifecycle=Fi.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Fi.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Fi.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function xn(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!xn(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!xn(t[s],e[s],n-1))return!1;return!0}return!1}class hD{constructor(e){d(this,"width",void 0),d(this,"height",void 0),d(this,"views",void 0),d(this,"viewState",void 0),d(this,"controllers",void 0),d(this,"timeline",void 0),d(this,"_viewports",void 0),d(this,"_viewportMap",void 0),d(this,"_isUpdating",void 0),d(this,"_needsRedraw",void 0),d(this,"_needsUpdate",void 0),d(this,"_eventManager",void 0),d(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=cp(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!xn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):q.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))===null||o===void 0?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let c=n[s.id];const l=!!s.controller;l&&!c&&(r=!0),(r||!l)&&c&&(c.finalize(),c=null),this.controllers[s.id]=this._updateController(s,o,a,c),a&&this._viewports.unshift(a)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const fD=/([0-9]+\.?[0-9]*)(%|px)/;function fr(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=fD.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function dr(t,e){return t.relative?Math.round(t.position*e):t.position}function ze(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Ss{constructor(e){d(this,"id",void 0),d(this,"viewportInstance",void 0),d(this,"_x",void 0),d(this,"_y",void 0),d(this,"_width",void 0),d(this,"_height",void 0),d(this,"_padding",void 0),d(this,"props",void 0);const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null,viewportInstance:c}=e||{};ze(!c||c instanceof Rs),this.viewportInstance=c,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=fr(r),this._y=fr(i),this._width=fr(s),this._height=fr(o),this._padding=a&&{left:fr(a.left||0),right:fr(a.right||0),top:fr(a.top||0),bottom:fr(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&xn(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:dr(this._x,e),y:dr(this._y,n),width:dr(this._width,e),height:dr(this._height,n)};return this._padding&&(r.padding={left:dr(this._padding.left,e),top:dr(this._padding.top,n),right:dr(this._padding.right,e),bottom:dr(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class ya{constructor(e){d(this,"_inProgress",void 0),d(this,"_handle",void 0),d(this,"_timeline",void 0),d(this,"time",void 0),d(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(n=(r=this.settings).onStart)===null||n===void 0||n.call(r,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const W_=()=>{},ld={BREAK:1,SNAP_TO_END:2,IGNORE:3},dD=t=>t,gD=ld.BREAK;class pD{constructor(e){d(this,"getControllerState",void 0),d(this,"props",void 0),d(this,"propsInTransition",void 0),d(this,"transition",void 0),d(this,"onViewStateChange",void 0),d(this,"onStateChange",void 0),d(this,"_onTransitionUpdate",n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:c}}=n,l=c(r/a),u=i.interpolateProps(s,o,l);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new ya(e.timeline),this.onViewStateChange=e.onViewStateChange||W_,this.onStateChange=e.onStateChange||W_}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===ld.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===ld.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const c={duration:o,easing:n.transitionEasing||dD,interpolator:s,interruption:n.transitionInterruption||gD,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(c),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class mD{constructor(e){d(this,"_propsToCompare",void 0),d(this,"_propsToExtract",void 0),d(this,"_requiredProps",void 0);const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!ln(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];ze(Number.isFinite(r)||Array.isArray(r),"".concat(n," is required for transition"))})}}const _D=["longitude","latitude","zoom","bearing","pitch"],yD=["longitude","latitude","zoom"];class N1 extends mD{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:_D,required:yD},super(r.transitionProps),d(this,"opts",void 0),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(n),c=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(c),aroundPosition:c,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=El(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,El(e.around,n.around,r)))}return i}}const gr={transitionDuration:0},vD=300,uc=t=>1-(1-t)*(1-t),Pi={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Jr={};class AD{constructor(e){d(this,"props",void 0),d(this,"state",{}),d(this,"transitionManager",void 0),d(this,"eventManager",void 0),d(this,"onViewStateChange",void 0),d(this,"onStateChange",void 0),d(this,"makeViewport",void 0),d(this,"_controllerState",void 0),d(this,"_events",{}),d(this,"_interactionState",{isDragging:!1}),d(this,"_customEvents",[]),d(this,"_eventStartBlocked",null),d(this,"_panMove",!1),d(this,"invertPan",!1),d(this,"dragMode","rotate"),d(this,"inertia",0),d(this,"scrollZoom",!0),d(this,"dragPan",!0),d(this,"dragRotate",!0),d(this,"doubleClickZoom",!0),d(this,"touchZoom",!0),d(this,"touchRotate",!1),d(this,"keyboard",!0),this.transitionManager=new pD({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?vD:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:c=!1,keyboard:l=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(Pi.WHEEL,u&&r),this.toggleEvents(Pi.PAN,u),this.toggleEvents(Pi.PINCH,u&&(a||c)),this.toggleEvents(Pi.TRIPLE_PAN,u&&c),this.toggleEvents(Pi.DOUBLE_TAP,u&&o),this.toggleEvents(Pi.KEYBOARD,u&&l),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=c,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,gr,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,gr,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:uc},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,gr,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:uc},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,gr,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,gr,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:uc},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Jr._startPinchRotation=e.rotation,Jr._lastPinchEvent=e,this.updateViewport(r,gr,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:Jr._startPinchRotation-r})}return this.updateViewport(n,gr,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Jr._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=Jr;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),c=Math.pow(2,o+a*n/2);s=s.zoom({pos:i,scale:c}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:uc},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Jr._startPinchRotation=null,Jr._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let c;const l={};switch(e.srcEvent.code){case"Minus":c=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),l.isZooming=!0;break;case"Equal":c=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),l.isZooming=!0;break;case"ArrowLeft":n?(c=a.rotateLeft(s),l.isRotating=!0):(c=a.moveLeft(i),l.isPanning=!0);break;case"ArrowRight":n?(c=a.rotateRight(s),l.isRotating=!0):(c=a.moveRight(i),l.isPanning=!0);break;case"ArrowUp":n?(c=a.rotateUp(o),l.isRotating=!0):(c=a.moveUp(i),l.isPanning=!0);break;case"ArrowDown":n?(c=a.rotateDown(o),l.isRotating=!0):(c=a.moveDown(i),l.isPanning=!0);break;default:return!1}return this.updateViewport(c,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?gr:e?{...n,transitionInterpolator:new N1({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class ED{constructor(e,n){d(this,"_viewportProps",void 0),d(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const J_=5,TD=1.2;class bD extends ED{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:c=0,altitude:l=1.5,position:u=[0,0,0],maxZoom:h=20,minZoom:f=0,maxPitch:g=60,minPitch:p=0,startPanLngLat:A,startZoomLngLat:b,startRotatePos:_,startBearing:m,startPitch:v,startZoom:T,normalize:w=!0}=e;ze(Number.isFinite(s)),ze(Number.isFinite(i)),ze(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:c,altitude:l,maxZoom:h,minZoom:f,maxPitch:g,minPitch:p,normalize:w,position:u},{startPanLngLat:A,startZoomLngLat:b,startRotatePos:_,startBearing:m,startPitch:v,startZoom:T}),d(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let c=i+Math.log2(r);c=Jn(c,a,o);const l=this.makeViewport({...this.getViewportProps(),zoom:c});return this._getUpdatedState({zoom:c,...l.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=Jn(i,r,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=Jn(a,o,s);const{normalize:c=!0}=e;return c&&Object.assign(e,S3(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],c=n[1],{width:l,height:u}=this.getViewportProps(),h=s/l;let f=0;o>0?Math.abs(u-c)>J_&&(f=o/(c-u)*TD):o<0&&c>J_&&(f=1-a/c),f=Jn(f,-1,1);const{minPitch:g,maxPitch:p}=this.getViewportProps(),A=i+180*h;let b=r;return f>0?b=r+f*(p-r):f<0&&(b=r-f*(g-r)),{pitch:b,bearing:A}}}class SD extends AD{constructor(...e){super(...e),d(this,"ControllerState",bD),d(this,"transition",{transitionDuration:300,transitionInterpolator:new N1({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),d(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class U1 extends Ss{get ViewportType(){return bs}get ControllerType(){return SD}}d(U1,"displayName","MapView");const wD=new ap;function CD(t,e){var n,r;const i=(n=t.order)!==null&&n!==void 0?n:1/0,s=(r=e.order)!==null&&r!==void 0?r:1/0;return i-s}class xD{constructor(){d(this,"effects",void 0),d(this,"_resolvedEffects",[]),d(this,"_defaultEffects",[]),d(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>CD(i,e)>0);r<0?n.push(e):n.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(xn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];s&&s!==i?s.setProps?(s.setProps(i.props),r.push(s)):(s.cleanup(),r.push(i)):r.push(i),delete n[i.id]}for(const i in n)n[i].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof ap)||this._resolvedEffects.push(wD),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class BD extends rp{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const ID="deckRenderer.renderLayers";class MD{constructor(e){d(this,"gl",void 0),d(this,"layerFilter",void 0),d(this,"drawPickingColors",void 0),d(this,"drawLayersPass",void 0),d(this,"pickLayersPass",void 0),d(this,"renderCount",void 0),d(this,"_needsRedraw",void 0),d(this,"renderBuffers",void 0),d(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new BD(e),this.pickLayersPass=new D1(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||Oe.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,Ke(ID,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(this.gl,n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Oe(this.gl),new Oe(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const s of e)if(s.postRender){if(s.id===this.lastPostProcessEffect){i.target=n.target,s.postRender(this.gl,i);break}const o=s.postRender(this.gl,i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const RD={pickedColor:null,pickedObjectIndex:-1};function PD({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:c,height:l}=s;let u=i*i,h=-1,f=0;for(let g=0;g<l;g++){const p=g+a-r,A=p*p;if(A>u)f+=4*c;else for(let b=0;b<c;b++){if(t[f+3]-1>=0){const m=b+o-n,v=m*m+A;v<=u&&(u=v,h=f)}f+=4}}if(h>=0){const g=t.slice(h,h+4),p=e(g);if(p){const A=Math.floor(h/4/c),b=h/4-A*c;return{...p,pickedColor:g,pickedX:o+b,pickedY:a+A}}q.error("Picked non-existent layer. Is picking buffer corrupt?")()}return RD}function LD({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):q.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function k1({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=DD((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let a;if(o){const c=[r-o.x,i-o.y];s!==void 0&&(c[2]=s),a=o.unproject(c)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function OD(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,c=o?[o]:[];if(r==="hover"){const h=n.index,f=n.layerId,g=o?o.props.id:null;if(g!==f||a!==h){if(g!==f){const p=i.find(A=>A.props.id===f);p&&c.unshift(p)}n.layerId=g,n.index=a,n.info=null}}const l=k1(t),u=new Map;return u.set(null,l),c.forEach(h=>{let f={...l};h===o&&(f.color=s,f.index=a,f.picked=!0),f=G1({layer:h,info:f,mode:r});const g=f.layer;h===o&&r==="hover"&&(n.info=f),u.set(g.id,f),r==="hover"&&g.updateAutoHighlight(f)}),u}function G1({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function DD(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class FD{constructor(e){d(this,"gl",void 0),d(this,"pickingFBO",void 0),d(this,"depthFBO",void 0),d(this,"pickLayersPass",void 0),d(this,"layerFilter",void 0),d(this,"lastPickedInfo",void 0),d(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new D1(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,c=o?r.find(f=>f.id===o):null,l=a&&i.find(f=>f.id===a)||i[0],u=l&&l.unproject([e-l.x,n-l.y]);return{...s,...{x:e,y:n,viewport:l,coordinate:u,layer:c}}}_resizeBuffer(){var e,n;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new Oe(r),Oe.isSupported(r,{colorBufferFloat:!0}))){const i=new Oe(r);i.attach({36064:new qe(r,{format:J(r)?34836:6408,type:5126})}),this.depthFBO=i}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:c="query",unproject3D:l,onViewportActive:u,effects:h}){const f=this._getPickable(e),g=fi(this.gl);if(!f)return{result:[],emptyInfo:k1({viewports:r,x:i,y:s,pixelRatio:g})};this._resizeBuffer();const p=rh(this.gl,[i,s],!0),A=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],b=Math.round(o*g),{width:_,height:m}=this.pickingFBO,v=this._getPickingRect({deviceX:A[0],deviceY:A[1],deviceRadius:b,deviceWidth:_,deviceHeight:m}),T={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let w;const x=[],I=new Set;for(let M=0;M<a;M++){let L;if(v){const z=this._drawAndSample({layers:f,views:n,viewports:r,onViewportActive:u,deviceRect:v,cullRect:T,effects:h,pass:"picking:".concat(c)});L=PD({...z,deviceX:A[0],deviceY:A[1],deviceRadius:b,deviceRect:v})}else L={pickedColor:null,pickedObjectIndex:-1};let R;if(L.pickedLayer&&l&&this.depthFBO){const{pickedColors:z}=this._drawAndSample({layers:[L.pickedLayer],views:n,viewports:r,onViewportActive:u,deviceRect:{x:L.pickedX,y:L.pickedY,width:1,height:1},cullRect:T,effects:h,pass:"picking:".concat(c,":z")},!0);z[3]&&(R=z[0])}L.pickedLayer&&M+1<a&&(I.add(L.pickedLayer),L.pickedLayer.disablePickingIndex(L.pickedObjectIndex)),w=OD({pickInfo:L,lastPickedInfo:this.lastPickedInfo,mode:c,layers:f,viewports:r,x:i,y:s,z:R,pixelRatio:g});for(const z of w.values())z.layer&&x.push(z);if(!L.pickedColor)break}for(const M of I)M.restorePickingColors();return{result:x,emptyInfo:w.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:c="query",maxObjects:l=null,onViewportActive:u,effects:h}){const f=this._getPickable(e);if(!f)return[];this._resizeBuffer();const g=fi(this.gl),p=rh(this.gl,[i,s],!0),A=p.x,b=p.y+p.height,_=rh(this.gl,[i+o,s+a],!0),m=_.x+_.width,v=_.y,T={x:A,y:v,width:m-A,height:b-v},w=this._drawAndSample({layers:f,views:n,viewports:r,onViewportActive:u,deviceRect:T,cullRect:{x:i,y:s,width:o,height:a},effects:h,pass:"picking:".concat(c)}),x=LD(w),I=new Map,M=Number.isFinite(l);for(let L=0;L<x.length&&!(M&&l&&I.size>=l);L++){const R=x[L];let z={color:R.pickedColor,layer:null,index:R.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:g};z=G1({layer:R.pickedLayer,info:z,mode:c}),I.has(z.object)||I.set(z.object,z)}return Array.from(I.values())}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:c},l=!1){const u=l?this.depthFBO:this.pickingFBO,h={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:c,pickZ:l,preRenderStats:{}};for(const m of a)m.useInPicking&&(h.preRenderStats[m.id]=m.preRender(this.gl,h));const{decodePickingColor:f}=this.pickLayersPass.render(h),{x:g,y:p,width:A,height:b}=s,_=new(l?Float32Array:Uint8Array)(A*b*4);return eu(u,{sourceX:g,sourceY:p,sourceWidth:A,sourceHeight:b,target:_}),{pickedColors:_,decodePickingColor:f}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,n-r),c=Math.min(i,e+r+1)-o,l=Math.min(s,n+r+1)-a;return c<=0||l<=0?null:{x:o,y:a,width:c,height:l}}}const ND={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class UD{constructor(e){d(this,"el",null),d(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,ND),n.appendChild(this.el))}setTooltip(e,n,r){const i=this.el;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(n,"px, ").concat(r,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var V1={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,i){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",c=Math.round,l=Math.abs,u=Date.now;function h(y,E,S){return setTimeout(v(y,S),E)}function f(y,E,S){return Array.isArray(y)?(g(y,S[E],S),!0):!1}function g(y,E,S){var B;if(y)if(y.forEach)y.forEach(E,S);else if(y.length!==i)for(B=0;B<y.length;)E.call(S,y[B],B,y),B++;else for(B in y)y.hasOwnProperty(B)&&E.call(S,y[B],B,y)}function p(y,E,S){var B="DEPRECATED METHOD: "+E+`
`+S+` AT 
`;return function(){var P=new Error("get-stack-trace"),k=P&&P.stack?P.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",K=e.console&&(e.console.warn||e.console.log);return K&&K.call(e.console,B,k),y.apply(this,arguments)}}var A;typeof Object.assign!="function"?A=function(E){if(E===i||E===null)throw new TypeError("Cannot convert undefined or null to object");for(var S=Object(E),B=1;B<arguments.length;B++){var P=arguments[B];if(P!==i&&P!==null)for(var k in P)P.hasOwnProperty(k)&&(S[k]=P[k])}return S}:A=Object.assign;var b=p(function(E,S,B){for(var P=Object.keys(S),k=0;k<P.length;)(!B||B&&E[P[k]]===i)&&(E[P[k]]=S[P[k]]),k++;return E},"extend","Use `assign`."),_=p(function(E,S){return b(E,S,!0)},"merge","Use `assign`.");function m(y,E,S){var B=E.prototype,P;P=y.prototype=Object.create(B),P.constructor=y,P._super=B,S&&A(P,S)}function v(y,E){return function(){return y.apply(E,arguments)}}function T(y,E){return typeof y==a?y.apply(E&&E[0]||i,E):y}function w(y,E){return y===i?E:y}function x(y,E,S){g(R(E),function(B){y.addEventListener(B,S,!1)})}function I(y,E,S){g(R(E),function(B){y.removeEventListener(B,S,!1)})}function M(y,E){for(;y;){if(y==E)return!0;y=y.parentNode}return!1}function L(y,E){return y.indexOf(E)>-1}function R(y){return y.trim().split(/\s+/g)}function z(y,E,S){if(y.indexOf&&!S)return y.indexOf(E);for(var B=0;B<y.length;){if(S&&y[B][S]==E||!S&&y[B]===E)return B;B++}return-1}function te(y){return Array.prototype.slice.call(y,0)}function ne(y,E,S){for(var B=[],P=[],k=0;k<y.length;){var K=E?y[k][E]:y[k];z(P,K)<0&&B.push(y[k]),P[k]=K,k++}return S&&(E?B=B.sort(function(ke,et){return ke[E]>et[E]}):B=B.sort()),B}function X(y,E){for(var S,B,P=E[0].toUpperCase()+E.slice(1),k=0;k<s.length;){if(S=s[k],B=S?S+P:E,B in y)return B;k++}return i}var Rt=1;function Pn(){return Rt++}function dn(y){var E=y.ownerDocument||y;return E.defaultView||E.parentWindow||e}var U=/mobile|tablet|ip(ad|hone|od)|android/i,H="ontouchstart"in e,j=X(e,"PointerEvent")!==i,he=H&&U.test(navigator.userAgent),fe="touch",ar="pen",Yt="mouse",Ls="kinect",Ln=25,Ce=1,zr=2,xe=4,at=8,ba=1,Os=2,Ds=4,Fs=8,Ns=16,gn=Os|Ds,Hr=Fs|Ns,Up=gn|Hr,kp=["x","y"],Sa=["clientX","clientY"];function Pt(y,E){var S=this;this.manager=y,this.callback=E,this.element=y.element,this.target=y.options.inputTarget,this.domHandler=function(B){T(y.options.enable,[y])&&S.handler(B)},this.init()}Pt.prototype={handler:function(){},init:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(dn(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&I(this.element,this.evEl,this.domHandler),this.evTarget&&I(this.target,this.evTarget,this.domHandler),this.evWin&&I(dn(this.element),this.evWin,this.domHandler)}};function nS(y){var E,S=y.options.inputClass;return S?E=S:j?E=hu:he?E=xa:H?E=fu:E=Ca,new E(y,rS)}function rS(y,E,S){var B=S.pointers.length,P=S.changedPointers.length,k=E&Ce&&B-P===0,K=E&(xe|at)&&B-P===0;S.isFirst=!!k,S.isFinal=!!K,k&&(y.session={}),S.eventType=E,iS(y,S),y.emit("hammer.input",S),y.recognize(S),y.session.prevInput=S}function iS(y,E){var S=y.session,B=E.pointers,P=B.length;S.firstInput||(S.firstInput=Gp(E)),P>1&&!S.firstMultiple?S.firstMultiple=Gp(E):P===1&&(S.firstMultiple=!1);var k=S.firstInput,K=S.firstMultiple,De=K?K.center:k.center,ke=E.center=Vp(B);E.timeStamp=u(),E.deltaTime=E.timeStamp-k.timeStamp,E.angle=uu(De,ke),E.distance=wa(De,ke),sS(S,E),E.offsetDirection=Hp(E.deltaX,E.deltaY);var et=zp(E.deltaTime,E.deltaX,E.deltaY);E.overallVelocityX=et.x,E.overallVelocityY=et.y,E.overallVelocity=l(et.x)>l(et.y)?et.x:et.y,E.scale=K?cS(K.pointers,B):1,E.rotation=K?aS(K.pointers,B):0,E.maxPointers=S.prevInput?E.pointers.length>S.prevInput.maxPointers?E.pointers.length:S.prevInput.maxPointers:E.pointers.length,oS(S,E);var mn=y.element;M(E.srcEvent.target,mn)&&(mn=E.srcEvent.target),E.target=mn}function sS(y,E){var S=E.center,B=y.offsetDelta||{},P=y.prevDelta||{},k=y.prevInput||{};(E.eventType===Ce||k.eventType===xe)&&(P=y.prevDelta={x:k.deltaX||0,y:k.deltaY||0},B=y.offsetDelta={x:S.x,y:S.y}),E.deltaX=P.x+(S.x-B.x),E.deltaY=P.y+(S.y-B.y)}function oS(y,E){var S=y.lastInterval||E,B=E.timeStamp-S.timeStamp,P,k,K,De;if(E.eventType!=at&&(B>Ln||S.velocity===i)){var ke=E.deltaX-S.deltaX,et=E.deltaY-S.deltaY,mn=zp(B,ke,et);k=mn.x,K=mn.y,P=l(mn.x)>l(mn.y)?mn.x:mn.y,De=Hp(ke,et),y.lastInterval=E}else P=S.velocity,k=S.velocityX,K=S.velocityY,De=S.direction;E.velocity=P,E.velocityX=k,E.velocityY=K,E.direction=De}function Gp(y){for(var E=[],S=0;S<y.pointers.length;)E[S]={clientX:c(y.pointers[S].clientX),clientY:c(y.pointers[S].clientY)},S++;return{timeStamp:u(),pointers:E,center:Vp(E),deltaX:y.deltaX,deltaY:y.deltaY}}function Vp(y){var E=y.length;if(E===1)return{x:c(y[0].clientX),y:c(y[0].clientY)};for(var S=0,B=0,P=0;P<E;)S+=y[P].clientX,B+=y[P].clientY,P++;return{x:c(S/E),y:c(B/E)}}function zp(y,E,S){return{x:E/y||0,y:S/y||0}}function Hp(y,E){return y===E?ba:l(y)>=l(E)?y<0?Os:Ds:E<0?Fs:Ns}function wa(y,E,S){S||(S=kp);var B=E[S[0]]-y[S[0]],P=E[S[1]]-y[S[1]];return Math.sqrt(B*B+P*P)}function uu(y,E,S){S||(S=kp);var B=E[S[0]]-y[S[0]],P=E[S[1]]-y[S[1]];return Math.atan2(P,B)*180/Math.PI}function aS(y,E){return uu(E[1],E[0],Sa)+uu(y[1],y[0],Sa)}function cS(y,E){return wa(E[0],E[1],Sa)/wa(y[0],y[1],Sa)}var lS={mousedown:Ce,mousemove:zr,mouseup:xe},uS="mousedown",hS="mousemove mouseup";function Ca(){this.evEl=uS,this.evWin=hS,this.pressed=!1,Pt.apply(this,arguments)}m(Ca,Pt,{handler:function(E){var S=lS[E.type];S&Ce&&E.button===0&&(this.pressed=!0),S&zr&&E.which!==1&&(S=xe),this.pressed&&(S&xe&&(this.pressed=!1),this.callback(this.manager,S,{pointers:[E],changedPointers:[E],pointerType:Yt,srcEvent:E}))}});var fS={pointerdown:Ce,pointermove:zr,pointerup:xe,pointercancel:at,pointerout:at},dS={2:fe,3:ar,4:Yt,5:Ls},jp="pointerdown",Wp="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(jp="MSPointerDown",Wp="MSPointerMove MSPointerUp MSPointerCancel");function hu(){this.evEl=jp,this.evWin=Wp,Pt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}m(hu,Pt,{handler:function(E){var S=this.store,B=!1,P=E.type.toLowerCase().replace("ms",""),k=fS[P],K=dS[E.pointerType]||E.pointerType,De=K==fe,ke=z(S,E.pointerId,"pointerId");k&Ce&&(E.button===0||De)?ke<0&&(S.push(E),ke=S.length-1):k&(xe|at)&&(B=!0),!(ke<0)&&(S[ke]=E,this.callback(this.manager,k,{pointers:S,changedPointers:[E],pointerType:K,srcEvent:E}),B&&S.splice(ke,1))}});var gS={touchstart:Ce,touchmove:zr,touchend:xe,touchcancel:at},pS="touchstart",mS="touchstart touchmove touchend touchcancel";function Jp(){this.evTarget=pS,this.evWin=mS,this.started=!1,Pt.apply(this,arguments)}m(Jp,Pt,{handler:function(E){var S=gS[E.type];if(S===Ce&&(this.started=!0),!!this.started){var B=_S.call(this,E,S);S&(xe|at)&&B[0].length-B[1].length===0&&(this.started=!1),this.callback(this.manager,S,{pointers:B[0],changedPointers:B[1],pointerType:fe,srcEvent:E})}}});function _S(y,E){var S=te(y.touches),B=te(y.changedTouches);return E&(xe|at)&&(S=ne(S.concat(B),"identifier",!0)),[S,B]}var yS={touchstart:Ce,touchmove:zr,touchend:xe,touchcancel:at},vS="touchstart touchmove touchend touchcancel";function xa(){this.evTarget=vS,this.targetIds={},Pt.apply(this,arguments)}m(xa,Pt,{handler:function(E){var S=yS[E.type],B=AS.call(this,E,S);B&&this.callback(this.manager,S,{pointers:B[0],changedPointers:B[1],pointerType:fe,srcEvent:E})}});function AS(y,E){var S=te(y.touches),B=this.targetIds;if(E&(Ce|zr)&&S.length===1)return B[S[0].identifier]=!0,[S,S];var P,k,K=te(y.changedTouches),De=[],ke=this.target;if(k=S.filter(function(et){return M(et.target,ke)}),E===Ce)for(P=0;P<k.length;)B[k[P].identifier]=!0,P++;for(P=0;P<K.length;)B[K[P].identifier]&&De.push(K[P]),E&(xe|at)&&delete B[K[P].identifier],P++;if(De.length)return[ne(k.concat(De),"identifier",!0),De]}var ES=2500,Xp=25;function fu(){Pt.apply(this,arguments);var y=v(this.handler,this);this.touch=new xa(this.manager,y),this.mouse=new Ca(this.manager,y),this.primaryTouch=null,this.lastTouches=[]}m(fu,Pt,{handler:function(E,S,B){var P=B.pointerType==fe,k=B.pointerType==Yt;if(!(k&&B.sourceCapabilities&&B.sourceCapabilities.firesTouchEvents)){if(P)TS.call(this,S,B);else if(k&&bS.call(this,B))return;this.callback(E,S,B)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function TS(y,E){y&Ce?(this.primaryTouch=E.changedPointers[0].identifier,Kp.call(this,E)):y&(xe|at)&&Kp.call(this,E)}function Kp(y){var E=y.changedPointers[0];if(E.identifier===this.primaryTouch){var S={x:E.clientX,y:E.clientY};this.lastTouches.push(S);var B=this.lastTouches,P=function(){var k=B.indexOf(S);k>-1&&B.splice(k,1)};setTimeout(P,ES)}}function bS(y){for(var E=y.srcEvent.clientX,S=y.srcEvent.clientY,B=0;B<this.lastTouches.length;B++){var P=this.lastTouches[B],k=Math.abs(E-P.x),K=Math.abs(S-P.y);if(k<=Xp&&K<=Xp)return!0}return!1}var Yp=X(o.style,"touchAction"),Qp=Yp!==i,qp="compute",Zp="auto",du="manipulation",jr="none",Us="pan-x",ks="pan-y",Ba=wS();function gu(y,E){this.manager=y,this.set(E)}gu.prototype={set:function(y){y==qp&&(y=this.compute()),Qp&&this.manager.element.style&&Ba[y]&&(this.manager.element.style[Yp]=y),this.actions=y.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var y=[];return g(this.manager.recognizers,function(E){T(E.options.enable,[E])&&(y=y.concat(E.getTouchAction()))}),SS(y.join(" "))},preventDefaults:function(y){var E=y.srcEvent,S=y.offsetDirection;if(this.manager.session.prevented){E.preventDefault();return}var B=this.actions,P=L(B,jr)&&!Ba[jr],k=L(B,ks)&&!Ba[ks],K=L(B,Us)&&!Ba[Us];if(P){var De=y.pointers.length===1,ke=y.distance<2,et=y.deltaTime<250;if(De&&ke&&et)return}if(!(K&&k)&&(P||k&&S&gn||K&&S&Hr))return this.preventSrc(E)},preventSrc:function(y){this.manager.session.prevented=!0,y.preventDefault()}};function SS(y){if(L(y,jr))return jr;var E=L(y,Us),S=L(y,ks);return E&&S?jr:E||S?E?Us:ks:L(y,du)?du:Zp}function wS(){if(!Qp)return!1;var y={},E=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(S){y[S]=E?e.CSS.supports("touch-action",S):!0}),y}var Ia=1,Lt=2,bi=4,cr=8,On=cr,Gs=16,pn=32;function Dn(y){this.options=A({},this.defaults,y||{}),this.id=Pn(),this.manager=null,this.options.enable=w(this.options.enable,!0),this.state=Ia,this.simultaneous={},this.requireFail=[]}Dn.prototype={defaults:{},set:function(y){return A(this.options,y),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(y){if(f(y,"recognizeWith",this))return this;var E=this.simultaneous;return y=Ma(y,this),E[y.id]||(E[y.id]=y,y.recognizeWith(this)),this},dropRecognizeWith:function(y){return f(y,"dropRecognizeWith",this)?this:(y=Ma(y,this),delete this.simultaneous[y.id],this)},requireFailure:function(y){if(f(y,"requireFailure",this))return this;var E=this.requireFail;return y=Ma(y,this),z(E,y)===-1&&(E.push(y),y.requireFailure(this)),this},dropRequireFailure:function(y){if(f(y,"dropRequireFailure",this))return this;y=Ma(y,this);var E=z(this.requireFail,y);return E>-1&&this.requireFail.splice(E,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(y){return!!this.simultaneous[y.id]},emit:function(y){var E=this,S=this.state;function B(P){E.manager.emit(P,y)}S<cr&&B(E.options.event+$p(S)),B(E.options.event),y.additionalEvent&&B(y.additionalEvent),S>=cr&&B(E.options.event+$p(S))},tryEmit:function(y){if(this.canEmit())return this.emit(y);this.state=pn},canEmit:function(){for(var y=0;y<this.requireFail.length;){if(!(this.requireFail[y].state&(pn|Ia)))return!1;y++}return!0},recognize:function(y){var E=A({},y);if(!T(this.options.enable,[this,E])){this.reset(),this.state=pn;return}this.state&(On|Gs|pn)&&(this.state=Ia),this.state=this.process(E),this.state&(Lt|bi|cr|Gs)&&this.tryEmit(E)},process:function(y){},getTouchAction:function(){},reset:function(){}};function $p(y){return y&Gs?"cancel":y&cr?"end":y&bi?"move":y&Lt?"start":""}function em(y){return y==Ns?"down":y==Fs?"up":y==Os?"left":y==Ds?"right":""}function Ma(y,E){var S=E.manager;return S?S.get(y):y}function Qt(){Dn.apply(this,arguments)}m(Qt,Dn,{defaults:{pointers:1},attrTest:function(y){var E=this.options.pointers;return E===0||y.pointers.length===E},process:function(y){var E=this.state,S=y.eventType,B=E&(Lt|bi),P=this.attrTest(y);return B&&(S&at||!P)?E|Gs:B||P?S&xe?E|cr:E&Lt?E|bi:Lt:pn}});function Ra(){Qt.apply(this,arguments),this.pX=null,this.pY=null}m(Ra,Qt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Up},getTouchAction:function(){var y=this.options.direction,E=[];return y&gn&&E.push(ks),y&Hr&&E.push(Us),E},directionTest:function(y){var E=this.options,S=!0,B=y.distance,P=y.direction,k=y.deltaX,K=y.deltaY;return P&E.direction||(E.direction&gn?(P=k===0?ba:k<0?Os:Ds,S=k!=this.pX,B=Math.abs(y.deltaX)):(P=K===0?ba:K<0?Fs:Ns,S=K!=this.pY,B=Math.abs(y.deltaY))),y.direction=P,S&&B>E.threshold&&P&E.direction},attrTest:function(y){return Qt.prototype.attrTest.call(this,y)&&(this.state&Lt||!(this.state&Lt)&&this.directionTest(y))},emit:function(y){this.pX=y.deltaX,this.pY=y.deltaY;var E=em(y.direction);E&&(y.additionalEvent=this.options.event+E),this._super.emit.call(this,y)}});function pu(){Qt.apply(this,arguments)}m(pu,Qt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[jr]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.scale-1)>this.options.threshold||this.state&Lt)},emit:function(y){if(y.scale!==1){var E=y.scale<1?"in":"out";y.additionalEvent=this.options.event+E}this._super.emit.call(this,y)}});function mu(){Dn.apply(this,arguments),this._timer=null,this._input=null}m(mu,Dn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Zp]},process:function(y){var E=this.options,S=y.pointers.length===E.pointers,B=y.distance<E.threshold,P=y.deltaTime>E.time;if(this._input=y,!B||!S||y.eventType&(xe|at)&&!P)this.reset();else if(y.eventType&Ce)this.reset(),this._timer=h(function(){this.state=On,this.tryEmit()},E.time,this);else if(y.eventType&xe)return On;return pn},reset:function(){clearTimeout(this._timer)},emit:function(y){this.state===On&&(y&&y.eventType&xe?this.manager.emit(this.options.event+"up",y):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function _u(){Qt.apply(this,arguments)}m(_u,Qt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[jr]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.rotation)>this.options.threshold||this.state&Lt)}});function yu(){Qt.apply(this,arguments)}m(yu,Qt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:gn|Hr,pointers:1},getTouchAction:function(){return Ra.prototype.getTouchAction.call(this)},attrTest:function(y){var E=this.options.direction,S;return E&(gn|Hr)?S=y.overallVelocity:E&gn?S=y.overallVelocityX:E&Hr&&(S=y.overallVelocityY),this._super.attrTest.call(this,y)&&E&y.offsetDirection&&y.distance>this.options.threshold&&y.maxPointers==this.options.pointers&&l(S)>this.options.velocity&&y.eventType&xe},emit:function(y){var E=em(y.offsetDirection);E&&this.manager.emit(this.options.event+E,y),this.manager.emit(this.options.event,y)}});function Pa(){Dn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}m(Pa,Dn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[du]},process:function(y){var E=this.options,S=y.pointers.length===E.pointers,B=y.distance<E.threshold,P=y.deltaTime<E.time;if(this.reset(),y.eventType&Ce&&this.count===0)return this.failTimeout();if(B&&P&&S){if(y.eventType!=xe)return this.failTimeout();var k=this.pTime?y.timeStamp-this.pTime<E.interval:!0,K=!this.pCenter||wa(this.pCenter,y.center)<E.posThreshold;this.pTime=y.timeStamp,this.pCenter=y.center,!K||!k?this.count=1:this.count+=1,this._input=y;var De=this.count%E.taps;if(De===0)return this.hasRequireFailures()?(this._timer=h(function(){this.state=On,this.tryEmit()},E.interval,this),Lt):On}return pn},failTimeout:function(){return this._timer=h(function(){this.state=pn},this.options.interval,this),pn},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==On&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Fn(y,E){return E=E||{},E.recognizers=w(E.recognizers,Fn.defaults.preset),new vu(y,E)}Fn.VERSION="2.0.7",Fn.defaults={domEvents:!1,touchAction:qp,enable:!0,inputTarget:null,inputClass:null,preset:[[_u,{enable:!1}],[pu,{enable:!1},["rotate"]],[yu,{direction:gn}],[Ra,{direction:gn},["swipe"]],[Pa],[Pa,{event:"doubletap",taps:2},["tap"]],[mu]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var CS=1,tm=2;function vu(y,E){this.options=A({},Fn.defaults,E||{}),this.options.inputTarget=this.options.inputTarget||y,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=y,this.input=nS(this),this.touchAction=new gu(this,this.options.touchAction),nm(this,!0),g(this.options.recognizers,function(S){var B=this.add(new S[0](S[1]));S[2]&&B.recognizeWith(S[2]),S[3]&&B.requireFailure(S[3])},this)}vu.prototype={set:function(y){return A(this.options,y),y.touchAction&&this.touchAction.update(),y.inputTarget&&(this.input.destroy(),this.input.target=y.inputTarget,this.input.init()),this},stop:function(y){this.session.stopped=y?tm:CS},recognize:function(y){var E=this.session;if(!E.stopped){this.touchAction.preventDefaults(y);var S,B=this.recognizers,P=E.curRecognizer;(!P||P&&P.state&On)&&(P=E.curRecognizer=null);for(var k=0;k<B.length;)S=B[k],E.stopped!==tm&&(!P||S==P||S.canRecognizeWith(P))?S.recognize(y):S.reset(),!P&&S.state&(Lt|bi|cr)&&(P=E.curRecognizer=S),k++}},get:function(y){if(y instanceof Dn)return y;for(var E=this.recognizers,S=0;S<E.length;S++)if(E[S].options.event==y)return E[S];return null},add:function(y){if(f(y,"add",this))return this;var E=this.get(y.options.event);return E&&this.remove(E),this.recognizers.push(y),y.manager=this,this.touchAction.update(),y},remove:function(y){if(f(y,"remove",this))return this;if(y=this.get(y),y){var E=this.recognizers,S=z(E,y);S!==-1&&(E.splice(S,1),this.touchAction.update())}return this},on:function(y,E){if(y!==i&&E!==i){var S=this.handlers;return g(R(y),function(B){S[B]=S[B]||[],S[B].push(E)}),this}},off:function(y,E){if(y!==i){var S=this.handlers;return g(R(y),function(B){E?S[B]&&S[B].splice(z(S[B],E),1):delete S[B]}),this}},emit:function(y,E){this.options.domEvents&&xS(y,E);var S=this.handlers[y]&&this.handlers[y].slice();if(!(!S||!S.length)){E.type=y,E.preventDefault=function(){E.srcEvent.preventDefault()};for(var B=0;B<S.length;)S[B](E),B++}},destroy:function(){this.element&&nm(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function nm(y,E){var S=y.element;if(S.style){var B;g(y.options.cssProps,function(P,k){B=X(S.style,k),E?(y.oldCssProps[B]=S.style[B],S.style[B]=P):S.style[B]=y.oldCssProps[B]||""}),E||(y.oldCssProps={})}}function xS(y,E){var S=n.createEvent("Event");S.initEvent(y,!0,!0),S.gesture=E,E.target.dispatchEvent(S)}A(Fn,{INPUT_START:Ce,INPUT_MOVE:zr,INPUT_END:xe,INPUT_CANCEL:at,STATE_POSSIBLE:Ia,STATE_BEGAN:Lt,STATE_CHANGED:bi,STATE_ENDED:cr,STATE_RECOGNIZED:On,STATE_CANCELLED:Gs,STATE_FAILED:pn,DIRECTION_NONE:ba,DIRECTION_LEFT:Os,DIRECTION_RIGHT:Ds,DIRECTION_UP:Fs,DIRECTION_DOWN:Ns,DIRECTION_HORIZONTAL:gn,DIRECTION_VERTICAL:Hr,DIRECTION_ALL:Up,Manager:vu,Input:Pt,TouchAction:gu,TouchInput:xa,MouseInput:Ca,PointerEventInput:hu,TouchMouseInput:fu,SingleTouchInput:Jp,Recognizer:Dn,AttrRecognizer:Qt,Tap:Pa,Pan:Ra,Swipe:yu,Pinch:pu,Rotate:_u,Press:mu,on:x,off:I,each:g,merge:_,extend:b,assign:A,inherit:m,bindFn:v,prefixed:X});var BS=typeof e<"u"?e:typeof self<"u"?self:{};BS.Hammer=Fn,typeof i=="function"&&i.amd?i(function(){return Fn}):t.exports?t.exports=Fn:e[r]=Fn})(window,document,"Hammer")})(V1);var va=V1.exports;const kD=zv(va),vn=IS({__proto__:null,default:kD},[va]),z1=1,H1=2,ud=4,GD={mousedown:z1,mousemove:H1,mouseup:ud};function VD(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function zD(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(VD(i,s=>s.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function HD(t){t.prototype.handler=function(n){let r=GD[n.type];r&z1&&n.button>=0&&(this.pressed=!0),r&H1&&n.which===0&&(r=ud),this.pressed&&(r&ud&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}zD(va.PointerEventInput);HD(va.MouseInput);const jD=va.Manager;class nu{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const WD=vn?[[vn.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[vn.Rotate,{enable:!1}],[vn.Pinch,{enable:!1}],[vn.Swipe,{enable:!1}],[vn.Pan,{threshold:0,enable:!1}],[vn.Press,{enable:!1}],[vn.Tap,{event:"doubletap",taps:2,enable:!1}],[vn.Tap,{event:"anytap",enable:!1}],[vn.Tap,{enable:!1}]]:null,X_={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},JD={doubletap:["tap"]},XD={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},up={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},KD={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},K_={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},YD=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",qi=typeof window<"u"?window:global;let hd=!1;try{const t={get passive(){return hd=!0,!0}};qi.addEventListener("test",null,t),qi.removeEventListener("test",null)}catch{hd=!1}const QD=YD.indexOf("firefox")!==-1,{WHEEL_EVENTS:qD}=up,Y_="wheel",Q_=4.000244140625,ZD=40,$D=.25;class eF extends nu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;qi.WheelEvent&&(QD&&i.deltaMode===qi.WheelEvent.DOM_DELTA_PIXEL&&(s/=qi.devicePixelRatio),i.deltaMode===qi.WheelEvent.DOM_DELTA_LINE&&(s*=ZD)),s!==0&&s%Q_===0&&(s=Math.floor(s/Q_)),i.shiftKey&&s&&(s=s*$D),this.callback({type:Y_,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(qD),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,hd?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Y_&&(this.options.enable=n)}}const{MOUSE_EVENTS:tF}=up,q_="pointermove",Z_="pointerover",$_="pointerout",ey="pointerenter",ty="pointerleave";class nF extends nu{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(tF),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===q_&&(this.enableMoveEvent=n),e===Z_&&(this.enableOverEvent=n),e===$_&&(this.enableOutEvent=n),e===ey&&(this.enableEnterEvent=n),e===ty&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(Z_,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit($_,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(ey,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(ty,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(q_,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:rF}=up,ny="keydown",ry="keyup";class iF extends nu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:ny,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:ry,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(rF),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===ny&&(this.enableDownEvent=n),e===ry&&(this.enableUpEvent=n)}}const iy="contextmenu";class sF extends nu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:iy,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===iy&&(this.options.enable=n)}}const fd=1,Bl=2,dd=4,oF={pointerdown:fd,pointermove:Bl,pointerup:dd,mousedown:fd,mousemove:Bl,mouseup:dd},aF=1,cF=2,lF=3,uF=0,hF=1,fF=2,dF=1,gF=2,pF=4;function mF(t){const e=oF[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r,which:i}=t.srcEvent;let s=!1,o=!1,a=!1;return e===dd||e===Bl&&!Number.isFinite(n)?(s=i===aF,o=i===cF,a=i===lF):e===Bl?(s=!!(n&dF),o=!!(n&pF),a=!!(n&gF)):e===fd&&(s=r===uF,o=r===hF,a=r===fF),{leftButton:s,middleButton:o,rightButton:a}}function _F(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const Eh={srcElement:"root",priority:0};class yF{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let i=n.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let c=Eh;typeof r=="string"||r&&r.addEventListener?c={...Eh,srcElement:r}:r&&(c={...Eh,...r});let l=a.get(c.srcElement);l||(l=[],a.set(c.srcElement,l));const u={type:e,handler:n,srcElement:c.srcElement,priority:c.priority};i&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let h=l.length-1;for(;h>=0&&!(l[h].priority>=u.priority);)h--;l.splice(h+1,0,u)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let c=0;c<r.length;c++){const{type:l,handler:u,once:h}=r[c];if(u({...e,type:l,stopPropagation:s,stopImmediatePropagation:o}),h&&a.push(r[c]),i)break}for(let c=0;c<a.length;c++){const{type:l,handler:u}=a[c];this.remove(l,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...mF(e),..._F(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const vF={events:null,recognizers:null,recognizerOptions:{},Manager:jD,touchAction:"none",tabIndex:0};class AF{constructor(e=null,n){this._onBasicInput=i=>{const{srcEvent:s}=i,o=XD[s.type];o&&this.manager.emit(o,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...vF,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||WD}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(X_).forEach(i=>{const s=this.manager.get(i);s&&X_[i].forEach(o=>{s.recognizeWith(o)})});for(const i in n.recognizerOptions){const s=this.manager.get(i);if(s){const o=n.recognizerOptions[i];delete o.enable,s.set(o)}}this.wheelInput=new eF(e,this._onOtherEvent,{enable:!1}),this.moveInput=new nF(e,this._onOtherEvent,{enable:!1}),this.keyInput=new iF(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new sF(e,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==n){i.set({enable:n});const s=JD[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=r.get(o);n?(a.requireFailure(e),i.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const u in e)this._addEventHandler(u,e[u],r,i,s);return}const{manager:o,events:a}=this,c=K_[e]||e;let l=a.get(c);l||(l=new yF(this),a.set(c,l),l.recognizerName=KD[c]||c,o&&o.on(c,l.handleEvent)),l.add(e,n,r,i,s),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:r}=this,i=K_[e]||e,s=r.get(i);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const c of r.values())if(c.recognizerName===o&&!c.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function Xr(){}const EF=({isDragging:t})=>t?"grabbing":"grab",j1={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Xr,onResize:Xr,onViewStateChange:Xr,onInteractionStateChange:Xr,onBeforeRender:Xr,onAfterRender:Xr,onLoad:Xr,onError:t=>q.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:EF,getTooltip:null,debug:!1,drawPickingColors:!1};class ru{constructor(e){d(this,"props",void 0),d(this,"width",0),d(this,"height",0),d(this,"userData",{}),d(this,"canvas",null),d(this,"viewManager",null),d(this,"layerManager",null),d(this,"effectManager",null),d(this,"deckRenderer",null),d(this,"deckPicker",null),d(this,"eventManager",null),d(this,"tooltip",null),d(this,"metrics",void 0),d(this,"animationLoop",void 0),d(this,"stats",void 0),d(this,"viewState",void 0),d(this,"cursorState",void 0),d(this,"_needsRedraw",void 0),d(this,"_pickRequest",void 0),d(this,"_lastPointerDownInfo",null),d(this,"_metricsCounter",void 0),d(this,"_onPointerMove",n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const i=n.offsetCenter;if(!i)return;r.x=i.x,r.y=i.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n}),d(this,"_onEvent",n=>{const r=N0[n.type],i=n.offsetCenter;if(!r||!i||!this.layerManager)return;const s=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:s,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:a}=o,c=a&&(a[r.handler]||a.props[r.handler]),l=this.props[r.handler];let u=!1;c&&(u=c.call(a,o,n)),!u&&l&&l(o,n)}),d(this,"_onPointerDown",n=>{const r=n.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo}),this.props={...j1,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&q.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),CT()==="IE"&&q.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Gg({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&ta.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,a,c;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(s=this.deckRenderer)===null||s===void 0||s.finalize(),this.deckRenderer=null,(o=this.deckPicker)===null||o===void 0||o.finalize(),this.deckPicker=null,(a=this.eventManager)===null||a===void 0||a.destroy(),this.eventManager=null,(c=this.tooltip)===null||c===void 0||c.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var l;(l=this.canvas.parentElement)===null||l===void 0||l.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&q.removed("onLayerHover","onHover")(),"onLayerClick"in e&&q.removed("onLayerClick","onClick")(),e.initialViewState&&!xn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return ze(this.viewManager),this.viewManager.views}getViewports(e){return ze(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,r){ze(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),ze(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=s}if(r||r===0){var i;const s=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((i=e.style)===null||i===void 0?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var e,n;const{canvas:r}=this;if(!r)return;const i=(e=r.clientWidth)!==null&&e!==void 0?e:r.width,s=(n=r.clientHeight)!==null&&n!==void 0?n:r.height;if(i!==this.width||s!==this.height){var o,a;this.width=i,this.height=s,(o=this.viewManager)===null||o===void 0||o.setProps({width:i,height:s}),(a=this.layerManager)===null||a===void 0||a.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:s})}}_createAnimationLoop(e){const{width:n,height:r,gl:i,glOptions:s,debug:o,onError:a,onBeforeRender:c,onAfterRender:l,useDevicePixels:u}=e;return new VP({width:n,height:r,useDevicePixels:u,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,gl:i,onCreateContext:h=>OT({...s,...h,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:h=>this._setGLContext(h.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:c,onAfterRender:l,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new U1({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let s=i,o=!1;for(const a of r){var n;s=a,o=((n=a.layer)===null||n===void 0?void 0:n.onHover(a,e.event))||o}if(!o&&this.props.onHover&&this.props.onHover(s,e.event),this.props.getTooltip&&this.tooltip){const a=this.props.getTooltip(s);this.tooltip.setTooltip(a,s.x,s.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,kg(e,{enable:!0,copyState:!0})),this.tooltip=new UD(this.canvas),tr(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new T1;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new AF(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in N0)this.eventManager.on(i,this._onEvent);this.viewManager=new hD({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new uD(e,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new xD,this.deckRenderer=new MD(e),this.deckPicker=new FD(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:r}=this.layerManager.context;tr(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),q.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=ti.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}d(ru,"defaultProps",j1);d(ru,"VERSION",KI);class Th{constructor(e,n){d(this,"opts",void 0),d(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:r}=this.source,{size:i}=n;let s=r;if(r&&r.length!==i){s=new Float32Array(i);const o=n.elementOffset||0;for(let a=0;a<i;++a)s[a]=r[o+a]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function TF(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function kc(t){return t.stride||t.size*t.bytesPerElement}function W1(t,e){e.offset&&q.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=kc(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function bF(t,e){const n=W1(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class SF{constructor(e,n,r){d(this,"gl",void 0),d(this,"id",void 0),d(this,"size",void 0),d(this,"settings",void 0),d(this,"value",void 0),d(this,"doublePrecision",void 0),d(this,"_buffer",void 0),d(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i===5130;let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a=5126:!i&&n.isIndexed?a=e&&Hg(e,ie.ELEMENT_INDEX_UINT32)?5125:5123:a=i||5126;let c=TF(i||a||5126);this.doublePrecision=s,s&&n.fp64===!1&&(c=Float32Array),this.value=null,this.settings={...n,defaultType:c,defaultValue:o,logicalType:i,type:a,size:this.size,bytesPerElement:c.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new se(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*kc(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),ta.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const r={},i=this.value instanceof Float64Array,s=bF(this.getAccessor(),n||{});return r[e]=new Th(this,s.high),r["".concat(e,"64Low")]=i?new Th(this,s.low):new Float32Array(this.size),r}if(n){const r=W1(this.getAccessor(),n);return{[e]:new Th(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let c=0;c<s;)for(let l=0;l<i;l++){const u=n[c++];u<o[l]&&(o[l]=u),u>a[l]&&(a[l]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof se?r={buffer:e}:r=e;const i={...this.settings,...r};if(n.bufferAccessor=i,n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=s}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null;const o=r.value instanceof Float64Array;i.type=r.type||s.accessor.type,i.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(o?2:1),i.stride=kc(i)}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s,i.bytesPerElement=s.BYTES_PER_ELEMENT,i.stride=kc(i);const{buffer:o,byteOffset:a}=this;this.doublePrecision&&s instanceof Float64Array&&(s=yh(s,i));const c=s.byteLength+a+i.stride*2;o.byteLength<c&&o.reallocate(c),o.setAccessor(null),o.subData({data:s,offset:a}),i.type=r.type||o.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?yh(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),offset:r*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=ta.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{buffer:o,byteOffset:a}=this;return o.byteLength<s.byteLength+a&&(o.reallocate(s.byteLength+a),n&&i&&o.subData({data:i instanceof Float64Array?yh(i,this):i,offset:a})),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&q.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}}const sy=[],oy=[];function J1(t,e=0,n=1/0){let r=sy;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(oy.length=t.length,r=oy):r=sy,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function X1(t){return t&&t[Symbol.asyncIterator]}function wF(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,c=r?r/a:n,l=i?i/a:0,u=Math.floor((t.length-l)/c);return(h,{index:f,target:g})=>{if(!s){const _=f*c+l;for(let m=0;m<n;m++)g[m]=t[_+m];return g}const p=s[f],A=s[f+1]||u;let b;if(o){b=new Array(A-p);for(let _=p;_<A;_++){const m=_*c+l;g=new Array(n);for(let v=0;v<n;v++)g[v]=t[m+v];b[_-p]=g}}else if(c===n)b=t.subarray(p*n+l,A*n+l);else{b=new t.constructor((A-p)*n);let _=0;for(let m=p;m<A;m++){const v=m*c+l;for(let T=0;T<n;T++)b[_++]=t[v+T]}}return b}}const CF=[],Gc=[[0,1/0]];function xF(t,e){if(t===Gc||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}function bh(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,a=e.length,c=o-r;if(a>c){n.set(e.subarray(0,c),r);return}if(n.set(e,r),!s)return;let l=a;for(;l<c;){const u=s(l,e);for(let h=0;h<i;h++)n[r+l]=u[h]||0,l++}}function BF({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!Array.isArray(s))return bh({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const c=r&&((u,h)=>r(u+a,h)),l=Math.min(i.length,s.length);for(let u=1;u<l;u++){const h=i[u]*n,f=s[u]*n;bh({source:t.subarray(o,h),target:e,start:a,end:f,size:n,getData:c}),o=h,a=f}return a<e.length&&bh({source:[],target:e,start:a,size:n,getData:c}),e}const IF={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function K1(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...IF[n],...e,...t,type:n}}function Y1(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function Q1(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function q1(t){t.push(t.shift())}function hp(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;return(r.noAlloc?i.length:e*s)*o}function Z1({buffer:t,numInstances:e,attribute:n,fromLength:r,fromStartIndices:i,getData:s=o=>o}){const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,a=n.size*o,c=n.byteOffset,l=n.startIndices,u=i&&l,h=hp(n,e),f=n.isConstant;if(!u&&r>=h)return;const g=f?n.value:n.getBuffer().getData({srcByteOffset:c});if(n.settings.normalized&&!f){const _=s;s=(m,v)=>n.normalizeConstant(_(m,v))}const p=f?(_,m)=>s(g,m):(_,m)=>s(g.subarray(_,_+a),m),A=t.getData({length:r}),b=new Float32Array(h);BF({source:A,target:b,sourceStartIndices:i,targetStartIndices:l,size:a,getData:p}),t.byteLength<b.byteLength+c&&t.reallocate(b.byteLength+c),t.subData({data:b,offset:c})}class fp extends SF{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Gc}),d(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return K1(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=xF(this.state.updateRanges,[r,i])}else this.state.updateRanges=Gc}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=CF}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==Gc),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let c=!0;if(o){for(const[l,u]of s)o.call(i,this,{data:n,startRow:l,endRow:u,props:r,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[l,u]of s){const h=Number.isFinite(l)?this.getVertexOffset(l):0,f=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:h,endOffset:f})}this._checkAttributeArray()}else c=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),c}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;ze(ArrayBuffer.isView(o.value),"invalid ".concat(i.accessor));const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=wF(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const r in e)Object.assign(n,super.getShaderAttributes(r,e[r]));return n}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:c,value:l,size:u,startIndices:h}=e,{accessor:f,transform:g}=a,p=c.binaryAccessor||(typeof f=="function"?f:s[f]);ze(typeof p=="function",'accessor "'.concat(f,'" is not a function'));let A=e.getVertexOffset(r);const{iterable:b,objectInfo:_}=J1(n,r,i);for(const m of b){_.index++;let v=p(m,_);if(g&&(v=g.call(this,v)),h){const T=(_.index<h.length-1?h[_.index+1]:o)-h[_.index];if(v&&Array.isArray(v[0])){let w=A;for(const x of v)e._normalizeValue(x,l,w),w+=u}else v&&v.length>u?l.set(v,A):(e._normalizeValue(v,_.target,0),tD({target:l,source:_.target,start:A,count:T}));A+=T*u}else e._normalizeValue(v,l,A),A+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class MF{constructor({gl:e,attribute:n,timeline:r}){d(this,"gl",void 0),d(this,"type","interpolation"),d(this,"attributeInTransition",void 0),d(this,"settings",void 0),d(this,"attribute",void 0),d(this,"transition",void 0),d(this,"currentStartIndices",void 0),d(this,"currentLength",void 0),d(this,"transform",void 0),d(this,"buffers",void 0),this.gl=e,this.transition=new ya(r),this.attribute=n,this.attributeInTransition=new fp(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=PF(e,n);const i={byteLength:0,usage:35050};this.buffers=[new se(e,i),new se(e,i)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:i,attribute:s}=this;q1(i);const o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of i)Z1({buffer:a,...o});this.currentStartIndices=s.startIndices,this.currentLength=hp(s,n),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:i[0],aTo:Y1(r,s)},feedbackBuffers:{vCurrent:i[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:r}=this.settings,{time:i}=this.transition;let s=i/n;r&&(s=r(s)),this.transform.run({uniforms:{time:s}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const RF=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function PF(t,e){const n=Q1(e.size);return new ea(t,{vs:RF,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class LF{constructor({gl:e,attribute:n,timeline:r}){d(this,"gl",void 0),d(this,"type","spring"),d(this,"attributeInTransition",void 0),d(this,"settings",void 0),d(this,"attribute",void 0),d(this,"transition",void 0),d(this,"currentStartIndices",void 0),d(this,"currentLength",void 0),d(this,"texture",void 0),d(this,"framebuffer",void 0),d(this,"transform",void 0),d(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new ya(r),this.attribute=n,this.attributeInTransition=new fp(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=DF(e),this.framebuffer=FF(e,this.texture),this.transform=OF(e,n,this.framebuffer);const i={byteLength:0,usage:35050};this.buffers=[new se(e,i),new se(e,i),new se(e,i)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:r,buffers:i,attribute:s}=this,o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of i)Z1({buffer:a,...o});this.settings=e,this.currentStartIndices=s.startIndices,this.currentLength=hp(s,n),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:Y1(r,s)}})}update(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this;if(!i.update())return!1;const o=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:o.stiffness,damping:o.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),q1(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),eu(r)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function OF(t,e,n){const r=Q1(e.size);return new ea(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function DF(t){return new qe(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function FF(t,e){return new Oe(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const NF={interpolation:MF,spring:LF};class UF{constructor(e,{id:n,timeline:r}){d(this,"id",void 0),d(this,"isSupported",void 0),d(this,"gl",void 0),d(this,"timeline",void 0),d(this,"transitions",void 0),d(this,"needsRedraw",void 0),d(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=ea.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){if(!this.isSupported){q.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}i&&this._removeTransition(e);const o=NF[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,gl:this.gl}):(q.error("unsupported transition type '".concat(r.type,"'"))(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const ay="attributeManager.invalidate",kF="attributeManager.updateStart",GF="attributeManager.updateEnd",VF="attribute.updateStart",zF="attribute.allocate",HF="attribute.updateEnd";class dp{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){d(this,"id",void 0),d(this,"gl",void 0),d(this,"attributes",void 0),d(this,"updateTriggers",void 0),d(this,"needsRedraw",void 0),d(this,"userData",void 0),d(this,"stats",void 0),d(this,"attributeTransitionManager",void 0),d(this,"mergeBoundsMemoized",_a(V3)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new UF(e,{id:"".concat(n,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);Ke(ay,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Ke(ay,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let c=!1;Ke(kF,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const l in this.attributes){const u=this.attributes[l],h=u.settings.accessor;u.startIndices=r,u.numInstances=n,s[l]&&q.removed("props.".concat(l),"data.attributes.".concat(l))(),u.setExternalBuffer(o[l])||u.setBinaryValue(typeof h=="string"?o[h]:void 0,e.startIndices)||typeof h=="string"&&!o[h]&&u.setConstantValue(s[h])||u.needsUpdate()&&(c=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}c&&Ke(GF,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])===null||i===void 0?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const r={};for(const i in e)n[i]||Object.assign(r,e[i].getShaderAttributes());return r}_add(e,n={}){for(const r in e){const i=e[r];this.attributes[r]=this._createAttribute(r,i,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,r){const i={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:r.instanced?1:n.divisor||0};return new fp(this.gl,i)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(Ke(VF,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&Ke(zF,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,Ke(HF,n,r))}}class jF extends ya{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=El(n,r,o)}}const cy=1e-5;function ly(t,e,n,r,i){const s=e-t,a=(n-e)*i,c=-s*r;return a+c+s+e}function WF(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=ly(t[o],e[o],n[o],r,i);return s}return ly(t,e,n,r,i)}function uy(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class JF extends ya{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=WF(s,o,n,r,i);const c=uy(a,n),l=uy(a,o);c<cy&&l<cy&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const XF={interpolation:jF,spring:JF};class KF{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const c=s.get(e),{value:l=c.settings.fromValue}=c;n=l,this.remove(e)}if(i=K1(i),!i)return;const o=XF[i.type];if(!o){q.error("unsupported transition type '".concat(i.type,"'"))();return}const a=new o(this.timeline);a.start({...i,fromValue:n,toValue:r}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function YF(t){const e=t[Lr];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function QF(t,e){const n=gp({newProps:t,oldProps:e,propTypes:t[Lr],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=ZF(t,e);let i=!1;return r||(i=$F(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:eN(t,e),transitionsChanged:qF(t,e)}}function qF(t,e){if(!t.transitions)return!1;const n={},r=t[Lr];let i=!1;for(const s in t.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&gd(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function gp({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(i," changed shallowly");for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return"".concat(i,".").concat(s," added");const o=gd(t[s],e[s],r[s]);if(o)return"".concat(i,".").concat(s," ").concat(o)}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return"".concat(i,".").concat(s," dropped");if(!Object.hasOwnProperty.call(t,s)){const o=gd(t[s],e[s],r[s]);if(o)return"".concat(i,".").concat(s," ").concat(o)}}return!1}function gd(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function ZF(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function $F(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&hy(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&hy(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function eN(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function hy(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},gp({oldProps:i,newProps:r,triggerName:n})}const tN="count(): argument not an object",nN="count(): argument not a container";function rN(t){if(!sN(t))throw new Error(tN);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(iN(t))return Object.keys(t).length;throw new Error(nN)}function iN(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function sN(t){return t!==null&&typeof t=="object"}function oN(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const aN={10241:9987,10240:9729,10242:33071,10243:33071},pd={};function cN(t,e,n,r){if(n instanceof qe)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={10241:n.data.length>1?9985:9729});const s=new qe(e,{...n,parameters:{...aN,...i,...r}});return pd[s.id]=t,s}function lN(t,e){!e||!(e instanceof qe)||pd[e.id]===t&&(e.delete(),delete pd[e.id])}const uN={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||md(t)&&(t.length===3||t.length===4)},equal(t,e,n){return xn(t,e,1)}},accessor:{validate(t,e){const n=Il(t);return n==="function"||n===Il(e.value)},equal(t,e,n){return typeof e=="function"?!0:xn(t,e,1)}},array:{validate(t,e){return e.optional&&!t||md(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?xn(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?xn(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:r}=n.props;return r&&t?r(t):t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.gl?null:cN(n.id,r.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{lN(n.id,t)}}};function hN(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=fN(i,s);e[i]=a,n[i]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function fN(t,e){switch(Il(e)){case"object":return to(t,e);case"array":return to(t,{type:"array",value:e,compare:!1});case"boolean":return to(t,{type:"boolean",value:e});case"number":return to(t,{type:"number",value:e});case"function":return to(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function to(t,e){return"type"in e?{name:t,...uN[e.type],...e}:"value"in e?{name:t,type:Il(e.value),...e}:{name:t,type:"object",value:e}}function md(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Il(t){return md(t)?"array":t===null?"null":typeof t}function dN(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=_d(t.constructor,n),i=Object.create(r);i[xl]=t,i[gi]={},i[br]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const gN="_mergedDefaultProps";function _d(t,e){let n=gN;if(e)for(const i of e){const s=i.constructor;s&&(n+=":".concat(s.extensionName||s.name))}const r=$1(t,n);return r||(t[n]=pN(t,e||[]))}function pN(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=_d(r),s=$1(t,"defaultProps")||{},o=hN(s),a=Object.assign(Object.create(null),i,o.defaultProps),c=Object.assign(Object.create(null),i==null?void 0:i[Lr],o.propTypes),l=Object.assign(Object.create(null),i==null?void 0:i[Ah],o.deprecatedProps);for(const u of e){const h=_d(u.constructor);h&&(Object.assign(a,h),Object.assign(c,h[Lr]),Object.assign(l,h[Ah]))}return mN(a,t),yN(a,c),_N(a,l),a[Lr]=c,a[Ah]=l,e.length===0&&!pp(t,"_propTypes")&&(t._propTypes=c),a}function mN(t,e){const n=AN(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function _N(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i="".concat(this.id,": ").concat(n);for(const s of e[n])pp(this,s)||(this[s]=r);q.deprecated(i,e[n].join("/"))()}})}function yN(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(n[o]=a,r[o]=vN(o))}t[cs]=n,t[gi]={},Object.defineProperties(t,r)}function vN(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||X1(e)?this[gi][t]=e:this[br][t]=e},get(){if(this[br]){if(t in this[br])return this[br][t]||this[cs][t];if(t in this[gi]){const e=this[xl]&&this[xl].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[cs][t]}}return this[cs][t]}}}function pp(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function $1(t,e){return pp(t,e)&&t[e]}function AN(t){const e=t.componentName;return e||q.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let EN=0;class mp{constructor(...e){d(this,"id",void 0),d(this,"props",void 0),d(this,"count",void 0),this.props=dN(this,e),this.id=this.props.id,this.count=EN++}clone(e){const{props:n}=this,r={};for(const i in n[cs])i in n[br]?r[i]=n[br][i]:i in n[gi]&&(r[i]=n[gi][i]);return new this.constructor({...n,...r,...e})}}d(mp,"componentName","Component");d(mp,"defaultProps",{});const TN=Object.freeze({});class bN{constructor(e){d(this,"component",void 0),d(this,"onAsyncPropUpdated",void 0),d(this,"asyncProps",void 0),d(this,"oldProps",void 0),d(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||TN}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[xl]||this.component;const n=e[br]||{},r=e[gi]||e,i=e[cs]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(X1(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:c}=this.component.props;c?s=c(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Lr];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class SN extends bN{constructor({attributeManager:e,layer:n}){super(n),d(this,"attributeManager",void 0),d(this,"needsRedraw",void 0),d(this,"needsUpdate",void 0),d(this,"subLayers",void 0),d(this,"usesPickingColorCache",void 0),d(this,"hasPickingBuffer",void 0),d(this,"changeFlags",void 0),d(this,"viewport",void 0),d(this,"uniformTransitions",void 0),d(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const wN="layer.changeFlag",CN="layer.initialize",xN="layer.update",BN="layer.finalize",IN="layer.matched",fy=2**24-1,MN=Object.freeze([]),RN=_a(({oldViewport:t,viewport:e})=>t.equals(e));let An=new Uint8ClampedArray(0);const PN={data:{type:"data",value:MN,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;if(i=i||n.getLoadOptions(),r=r||n.props.loaders,s){var a;i={...i,fetch:{...(a=i)===null||a===void 0?void 0:a.fetch,signal:s}}}let c=o.contains(t);return!c&&!i&&(o.add({resourceId:t,data:Fr(t,r),persistent:!1}),c=!0),c?o.subscribe({resourceId:t,onChange:l=>{var u;return(u=n.internalState)===null||u===void 0?void 0:u.reloadAsyncProp(e,l)},consumerId:n.id,requestId:e}):Fr(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:W.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Vr extends mp{constructor(...e){super(...e),d(this,"internalState",null),d(this,"lifecycle",Fi.NO_STATE),d(this,"context",void 0),d(this,"state",void 0),d(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){ze(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=L1(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=P1(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return ze(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){ze(this.internalState);const r=this.internalState.viewport||this.context.viewport;return O1(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===W.DEFAULT||e===W.LNGLAT||e===W.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){ze(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:rN(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=oN(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:c}=n.attributes,l=a||c;l&&(o&&l.constant&&(l.constant=!1,n.invalidate(l.id)),!l.value&&!o&&(l.constant=!0,l.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i;if(n&&(e=new Error("".concat(n,": ").concat(e.message),{cause:e})),!((r=(i=this.props).onError)!==null&&r!==void 0&&r.call(i,e))){var s,o;(s=this.context)===null||s===void 0||(o=s.onError)===null||o===void 0||o.call(s,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!RN({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(An.length/3);if(this.internalState.usesPickingColorCache=!0,r<n){n>fy&&q.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),An=ta.allocate(An,n,{size:3,copy:!0,maxCount:Math.max(n,fy)});const i=Math.floor(An.length/3),s=[];for(let o=r;o<i;o++)this.encodePickingColor(o,s),An[o*3+0]=s[0],An[o*3+1]=s[1],An[o*3+2]=s[2]}e.value=An.subarray(0,n*3)}_setModelAttributes(e,n){const r=this.getAttributeManager(),i=e.userData.excludeAttributes||{},s=r.getShaderAttributes(n,i);e.setAttributes(s)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,c=this.encodePickingColor(e);for(let l=0;l<n.length;l++){const u=s.getVertexOffset(l);a[u]===c[0]&&a[u+1]===c[1]&&a[u+2]===c[2]&&this._disablePickingIndex(l)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.subData({data:new Uint8Array(o-s),offset:s})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==An.buffer&&(r.value=An.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){ze(!this.internalState),ze(Number.isFinite(this.props.coordinateSystem)),Ke(CN,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new SN({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(q.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new KF(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ke(IN,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ke(xN,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),c=this.getModels();if(r.gl)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const l=this.getModels()[0]!==c[0];this._postUpdate(a,l)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Ke(BN,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const i=this.props,s=this.context;this.props=this.internalState.propsInTransition||i;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:a}=this.props,c=a&&a(n)||[0,0];tr(s.gl,{polygonOffset:c}),Wt(s.gl,r,()=>{const l={moduleParameters:e,uniforms:n,parameters:r,context:s};for(const u of this.props.extensions)u.draw.call(this,l,u);this.draw(l)})}finally{this.props=i}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=n[i];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&Ke(wN,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const r=QF(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged){var i;this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)===null||i===void 0?void 0:i[s])}return this.setChangeFlags(r)}validateProps(){YF(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.pickingHighlightColor=r(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new dp(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:c}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==c){const l={};o||(l.pickingSelectedColor=null),Array.isArray(c)&&(l.pickingHighlightColor=c),(n||a!==i.highlightedObjectIndex)&&(l.pickingSelectedColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setModuleParameters(l)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}d(Vr,"defaultProps",PN);d(Vr,"layerName","Layer");const LN="compositeLayer.renderLayers";class _p extends Vr{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,i)}return e}getSubLayerProps(e={}){var n;const{opacity:r,pickable:i,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:l,highlightColor:u,coordinateSystem:h,coordinateOrigin:f,wrapLongitude:g,positionFormat:p,modelMatrix:A,extensions:b,fetch:_,operation:m,_subLayerProps:v}=this.props,T={id:"",updateTriggers:{},opacity:r,pickable:i,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:l,highlightColor:u,coordinateSystem:h,coordinateOrigin:f,wrapLongitude:g,positionFormat:p,modelMatrix:A,extensions:b,fetch:_,operation:m},w=v&&e.id&&v[e.id],x=w&&w.updateTriggers,I=e.id||"sublayer";if(w){const M=this.props[Lr],L=e.type?e.type._propTypes:{};for(const R in w){const z=L[R]||M[R];z&&z.type==="accessor"&&(w[R]=this.getSubLayerAccessor(w[R]))}}Object.assign(T,e,w),T.id="".concat(this.props.id,"-").concat(I),T.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...x};for(const M of b){const L=M.getSubLayerProps.call(this,M);L&&Object.assign(T,L,{updateTriggers:Object.assign(T.updateTriggers,L.updateTriggers)})}return T}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const s=this.renderLayers();r=cp(s,Boolean),this.internalState.subLayers=r}Ke(LN,this,i,r);for(const s of r)s.parent=this}}d(_p,"layerName","CompositeLayer");const ON=typeof window<"u"?F.useLayoutEffect:F.useEffect,DN=ON;function Ml(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const FN={position:"absolute",zIndex:-1};function eb(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>eb(n,e));if(iu(t)){if(NN(t))return e.style=FN,F.cloneElement(t,e);if(UN(t))return F.cloneElement(t,e)}return t}function iu(t){return t&&typeof t=="object"&&"type"in t||!1}function NN(t){var e;return(e=t.props)===null||e===void 0?void 0:e.mapStyle}function UN(t){const e=t.type;return e&&e.deckGLViewProps}function yd(t){if(typeof t=="function")return F.createElement(Ss,{},t);if(Array.isArray(t))return t.map(yd);if(iu(t)){if(t.type===F.Fragment)return yd(t.props.children);if(Ml(t.type,Ss))return t}return t}function kN({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return F.Children.forEach(yd(t),o=>{if(iu(o)){const a=o.type;if(Ml(a,Vr)){const c=GN(a,o.props);i.push(c)}else r.push(o);if(Ml(a,Ss)&&a!==Ss&&o.props.id){const c=new a(o.props);s[c.id]=c}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function GN(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}function VN({children:t,deck:e,ContextProvider:n}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let a=s,c=o;iu(o)&&Ml(o.type,Ss)&&(a=o.props.id||s,c=o.props.children);const l=r.getViewport(a),u=r.getViewState(a);if(l){u.padding=l.padding;const{x:h,y:f,width:g,height:p}=l;c=eb(c,{x:h,y:f,width:g,height:p,viewport:l,viewState:u}),i[a]||(i[a]={viewport:l,children:[]}),i[a].children.push(c)}}return Object.keys(i).map(o=>{const{viewport:a,children:c}=i[o],{x:l,y:u,width:h,height:f}=a,g={position:"absolute",left:l,top:u,width:h,height:f},p="view-".concat(o),A=F.createElement("div",{key:p,id:p,style:g},...c);if(n){const b={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:_=>{_.viewId=o,e._onViewStateChange(_)}};return F.createElement(n,{key:p,value:b},A)}return A})}const zN={mixBlendMode:null};function HN({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in zN?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function jN(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function tb(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function WN(t,e,n){const r=new e({...n,_customRender:i=>{t.redrawReason=i;const s=r.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():tb(t)}});return r}const nb=F.forwardRef((t,e)=>{const[n,r]=F.useState(0),s=F.useRef({control:null,version:n,forceUpdate:()=>r(w=>w+1)}).current,o=F.useRef(null),a=F.useRef(null),c=F.useMemo(()=>kN(t),[t.layers,t.views,t.children]);let l=!0;const u=w=>{var x;return l&&t.viewState?(s.viewStateUpdateRequested=w,null):(s.viewStateUpdateRequested=null,(x=t.onViewStateChange)===null||x===void 0?void 0:x.call(t,w))},h=w=>{if(l)s.interactionStateUpdateRequested=w;else{var x;s.interactionStateUpdateRequested=null,(x=t.onInteractionStateChange)===null||x===void 0||x.call(t,w)}},f=F.useMemo(()=>{const w={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:c.layers,views:c.views,onViewStateChange:u,onInteractionStateChange:h};return delete w._customRender,s.deck&&s.deck.setProps(w),w},[t]);F.useEffect(()=>{const w=t.Deck||ru;return s.deck=WN(s,w,{...f,parent:o.current,canvas:a.current}),()=>{var x;return(x=s.deck)===null||x===void 0?void 0:x.finalize()}},[]),DN(()=>{tb(s);const{viewStateUpdateRequested:w,interactionStateUpdateRequested:x}=s;w&&u(w),x&&h(x)}),F.useImperativeHandle(e,()=>jN(s),[]);const g=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:p,width:A,height:b,id:_,style:m}=t,{containerStyle:v,canvasStyle:T}=F.useMemo(()=>HN({width:A,height:b,style:m}),[A,b,m]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===g||s.version!==n){s.lastRenderedViewports=g,s.version=n;const w=VN({children:c.children,deck:s.deck,ContextProvider:p}),x=F.createElement("canvas",{key:"canvas",id:_||"deckgl-overlay",ref:a,style:T});s.control=F.createElement("div",{id:"".concat(_||"deckgl","-wrapper"),ref:o,style:v},[x,w])}return l=!1,s.control});nb.defaultProps=ru.defaultProps;const JN=nb,XN=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function KN(t,e=!1,n=Float32Array){let r;if(Number.isFinite(t[0]))r=new n(t);else{r=new n(t.length*4);let i=0;for(let s=0;s<t.length;s++){const o=t[s];r[i++]=o[0],r[i++]=o[1],r[i++]=o[2],r[i++]=Number.isFinite(o[3])?o[3]:255}}if(e)for(let i=0;i<r.length;i++)r[i]/=255;return r}function YN(t,e){const n={};for(const r in t)e.includes(r)||(n[r]=t[r]);return n}class rb extends _p{constructor(...e){super(...e),d(this,"state",void 0)}initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:YN(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){const r=this.getShaders({});r&&r.defines&&(r.defines.NON_INSTANCED_MODEL=1),this.updateShaders(r)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:e,mousePosition:n,gl:r}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:n,pickingActive:0,devicePixelRatio:fi(r)})}updateShaders(e){}isAggregationDirty(e,n={}){const{props:r,oldProps:i,changeFlags:s}=e,{compareAll:o=!1,dimension:a}=n,{ignoreProps:c}=this.state,{props:l,accessors:u=[]}=a,{updateTriggersChanged:h}=s;if(s.dataChanged)return!0;if(h){if(h.all)return!0;for(const f of u)if(h[f])return!0}if(o)return s.extensionsChanged?!0:gp({oldProps:i,newProps:r,ignoreProps:c,propTypes:this.constructor._propTypes});for(const f of l)if(r[f]!==i[f])return!0;return!1}isAttributeChanged(e){const{changedAttributes:n}=this.state;return e?n&&n[e]!==void 0:!QN(n)}_getAttributeManager(){return new dp(this.context.gl,{id:this.props.id,stats:this.context.stats})}}d(rb,"layerName","AggregationLayer");function QN(t){let e=!0;for(const n in t){e=!1;break}return e}const qN=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ZN=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,ib=[0,0,0,255],sb=[0,0,1],$N={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:sb},getColor:{type:"accessor",value:ib},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function eU(t){const{header:e,attributes:n}=t;!e||!n||(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}class yp extends Vr{getShaders(){return super.getShaders({vs:qN,fs:ZN,modules:[tu,dO,lp]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:sb},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:ib}})}updateState(e){const{changeFlags:n,props:r}=e;if(super.updateState(e),n.extensionsChanged){var i;const{gl:s}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}n.dataChanged&&eU(r.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:r}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:Kf[r],radiusPixels:n}).draw()}_getModel(e){const n=[];for(let r=0;r<3;r++){const i=r/3*Math.PI*2;n.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new di(e,{...this.getShaders(),id:this.props.id,geometry:new os({drawMode:4,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}d(yp,"layerName","PointCloudLayer");d(yp,"defaultProps",$N);function tU(t){const e=t.map(a=>a[0]),n=t.map(a=>a[1]),r=Math.min.apply(null,e),i=Math.max.apply(null,e),s=Math.min.apply(null,n),o=Math.max.apply(null,n);return[r,s,i,o]}function nU(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}const dy=new Float32Array(12);function gy(t,e=2){let n=0;for(const r of t)for(let i=0;i<e;i++)dy[n++]=r[i]||0;return dy}function rU(t,e,n){const[r,i,s,o]=t,a=s-r,c=o-i;let l=a,u=c;a/c<e/n?l=e/n*c:u=n/e*a,l<e&&(l=e,u=n);const h=(s+r)/2,f=(o+i)/2;return[h-l/2,f-u/2,h+l/2,f+u/2]}function iU(t,e){const[n,r,i,s]=e;return[(t[0]-n)/(i-n),(t[1]-r)/(s-r)]}function sU({gl:t,floatTargetSupport:e}){return e?{format:J(t)?34836:6408,type:5126}:{format:6408,type:5121}}const oU=`#define SHADER_NAME heatp-map-layer-vertex-shader

uniform sampler2D maxTexture;
uniform float intensity;
uniform vec2 colorDomain;
uniform float threshold;
uniform float aggregationMode;

attribute vec3 positions;
attribute vec2 texCoords;

varying vec2 vTexCoords;
varying float vIntensityMin;
varying float vIntensityMax;

void main(void) {
  gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
  vTexCoords = texCoords;
  vec4 maxTexture = texture2D(maxTexture, vec2(0.5));
  float maxValue = aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
  float minValue = maxValue * threshold;
  if (colorDomain[1] > 0.) {
    maxValue = colorDomain[1];
    minValue = colorDomain[0];
  }
  vIntensityMax = intensity / maxValue;
  vIntensityMin = intensity / minValue;
}
`,aU=`#define SHADER_NAME triangle-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D texture;
uniform sampler2D colorTexture;
uniform float aggregationMode;

varying vec2 vTexCoords;
varying float vIntensityMin;
varying float vIntensityMax;

vec4 getLinearColor(float value) {
  float factor = clamp(value * vIntensityMax, 0., 1.);
  vec4 color = texture2D(colorTexture, vec2(factor, 0.5));
  color.a *= min(value * vIntensityMin, 1.0);
  return color;
}

void main(void) {
  vec4 weights = texture2D(texture, vTexCoords);
  float weight = weights.r;

  if (aggregationMode > 0.5) {
    weight /= max(1.0, weights.a);
  }
  if (weight <= 0.) {
     discard;
  }

  vec4 linearColor = getLinearColor(weight);
  linearColor.a *= opacity;
  gl_FragColor =linearColor;
}
`;class ob extends Vr{getShaders(){return{vs:oU,fs:aU,modules:[tu]}}initializeState({gl:e}){this.getAttributeManager().add({positions:{size:3,noAlloc:!0},texCoords:{size:2,noAlloc:!0}}),this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:n}=this.props;return new di(e,{...this.getShaders(),id:this.props.id,geometry:new os({drawMode:6,vertexCount:n})})}draw({uniforms:e}){const{model:n}=this.state,{texture:r,maxTexture:i,colorTexture:s,intensity:o,threshold:a,aggregationMode:c,colorDomain:l}=this.props;n.setUniforms({...e,texture:r,maxTexture:i,colorTexture:s,intensity:o,threshold:a,aggregationMode:c,colorDomain:l}).draw()}}d(ob,"layerName","TriangleLayer");const cU=`attribute vec3 positions;
attribute vec3 positions64Low;
attribute float weights;
varying vec4 weightsTexture;
uniform float radiusPixels;
uniform float textureWidth;
uniform vec4 commonBounds;
uniform float weightsScale;
void main()
{
  weightsTexture = vec4(weights * weightsScale, 0., 0., 1.);

  float radiusTexels  = project_pixel_size(radiusPixels) * textureWidth / (commonBounds.z - commonBounds.x);
  gl_PointSize = radiusTexels * 2.;

  vec3 commonPosition = project_position(positions, positions64Low);
  gl_Position.xy = (commonPosition.xy - commonBounds.xy) / (commonBounds.zw - commonBounds.xy) ;
  gl_Position.xy = (gl_Position.xy * 2.) - (1.);
}
`,lU=`varying vec4 weightsTexture;
float gaussianKDE(float u){
  return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
  float dist = length(gl_PointCoord - vec2(0.5, 0.5));
  if (dist > 0.5) {
    discard;
  }
  gl_FragColor = weightsTexture * gaussianKDE(2. * dist);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,uU=`attribute vec4 inTexture;
varying vec4 outTexture;

void main()
{
outTexture = inTexture;
gl_Position = vec4(0, 0, 0, 1.);
gl_PointSize = 1.0;
}
`,hU=`varying vec4 outTexture;
void main() {
  gl_FragColor = outTexture;
  gl_FragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,fU=2,Sh={mipmaps:!1,parameters:{10240:9729,10241:9729,10242:33071,10243:33071},dataFormat:6408},py=[0,0],dU={SUM:0,MEAN:1},gU={getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:XN,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},pU=[ie.BLEND_EQUATION_MINMAX,ie.TEXTURE_FLOAT],mU=[ie.COLOR_ATTACHMENT_RGBA32F,ie.FLOAT_BLEND],_U={data:{props:["radiusPixels"]}};class vp extends rb{constructor(...e){super(...e),d(this,"state",void 0)}initializeState(){const{gl:e}=this.context;if(!yl(e,pU)){this.setState({supported:!1}),q.error("HeatmapLayer: ".concat(this.id," is not supported on this browser"))();return}super.initializeAggregationLayer(_U),this.setState({supported:!0,colorDomain:py}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){this.state.supported&&(super.updateState(e),this._updateHeatmapState(e))}_updateHeatmapState(e){const{props:n,oldProps:r}=e,i=this._getChangeFlags(e);(i.dataChanged||i.viewportChanged)&&(i.boundsChanged=this._updateBounds(i.dataChanged),this._updateTextureRenderingBounds()),i.dataChanged||i.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):i.viewportZoomChanged&&this._debouncedUpdateWeightmap(),n.colorRange!==r.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){if(!this.state.supported)return[];const{weightsTexture:e,triPositionBuffer:n,triTexCoordBuffer:r,maxWeightsTexture:i,colorTexture:s,colorDomain:o}=this.state,{updateTriggers:a,intensity:c,threshold:l,aggregation:u}=this.props,h=this.getSubLayerClass("triangle",ob);return new h(this.getSubLayerProps({id:"triangle-layer",updateTriggers:a}),{coordinateSystem:W.DEFAULT,data:{attributes:{positions:n,texCoords:r}},vertexCount:4,maxTexture:i,colorTexture:s,aggregationMode:dU[u]||0,texture:e,intensity:c,threshold:l,colorDomain:o})}finalizeState(e){super.finalizeState(e);const{weightsTransform:n,weightsTexture:r,maxWeightTransform:i,maxWeightsTexture:s,triPositionBuffer:o,triTexCoordBuffer:a,colorTexture:c,updateTimer:l}=this.state;n==null||n.delete(),r==null||r.delete(),i==null||i.delete(),s==null||s.delete(),o==null||o.delete(),a==null||a.delete(),c==null||c.delete(),l&&clearTimeout(l)}_getAttributeManager(){return new dp(this.context.gl,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const n={},{dimensions:r}=this.state;n.dataChanged=this.isAttributeChanged()||this.isAggregationDirty(e,{compareAll:!0,dimension:r.data}),n.viewportChanged=e.changeFlags.viewportChanged;const{zoom:i}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==i)&&(n.viewportZoomChanged=!0),n}_createTextures(){const{gl:e}=this.context,{textureSize:n,format:r,type:i}=this.state;this.setState({weightsTexture:new qe(e,{width:n,height:n,format:r,type:i,...Sh}),maxWeightsTexture:new qe(e,{format:r,type:i,...Sh})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:5130,accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{gl:e}=this.context,{weightsTextureSize:n}=this.props,r=Math.min(n,PT(e,3379)),i=yl(e,mU),{format:s,type:o}=sU({gl:e,floatTargetSupport:i}),a=i?1:1/255;this.setState({textureSize:r,format:s,type:o,weightsScale:a}),i||q.warn("HeatmapLayer: ".concat(this.id," rendering to float texture not supported, fallingback to low precession format"))()}getShaders(e){return super.getShaders(e==="max-weights-transform"?{vs:uU,_fs:hU}:{vs:cU,_fs:lU})}_createWeightsTransform(e={}){var n;const{gl:r}=this.context;let{weightsTransform:i}=this.state;const{weightsTexture:s}=this.state;(n=i)===null||n===void 0||n.delete(),i=new ea(r,{id:"".concat(this.id,"-weights-transform"),elementCount:1,_targetTexture:s,_targetTextureVarying:"weightsTexture",...e}),this.setState({weightsTransform:i})}_setupResources(){const{gl:e}=this.context;this._createTextures();const{textureSize:n,weightsTexture:r,maxWeightsTexture:i}=this.state,s=this.getShaders("weights-transform");this._createWeightsTransform(s);const o=this.getShaders("max-weights-transform"),a=new ea(e,{id:"".concat(this.id,"-max-weights-transform"),_sourceTextures:{inTexture:r},_targetTexture:i,_targetTextureVarying:"outTexture",...o,elementCount:n*n});this.setState({weightsTexture:r,maxWeightsTexture:i,maxWeightTransform:a,zoom:null,triPositionBuffer:new se(e,{byteLength:48,accessor:{size:3}}),triTexCoordBuffer:new se(e,{byteLength:48,accessor:{size:2}})})}updateShaders(e){this._createWeightsTransform(e)}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32776}})}_updateBounds(e=!1){const{viewport:n}=this.context,r=[n.unproject([0,0]),n.unproject([n.width,0]),n.unproject([n.width,n.height]),n.unproject([0,n.height])].map(a=>a.map(Math.fround)),i=tU(r),s={visibleWorldBounds:i,viewportCorners:r};let o=!1;if(e||!this.state.worldBounds||!nU(this.state.worldBounds,i)){const a=this._worldToCommonBounds(i),c=this._commonToWorldBounds(a);this.props.coordinateSystem===W.LNGLAT&&(c[1]=Math.max(c[1],-85.051129),c[3]=Math.min(c[3],85.051129),c[0]=Math.max(c[0],-360),c[2]=Math.min(c[2],360));const l=this._worldToCommonBounds(c);s.worldBounds=c,s.normalizedCommonBounds=l,o=!0}return this.setState(s),o}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:n,normalizedCommonBounds:r,viewportCorners:i}=this.state,{viewport:s}=this.context;e.subData(gy(i,3));const o=i.map(a=>iU(s.projectPosition(a),r));n.subData(gy(o,2))}_updateColorTexture(e){const{colorRange:n}=e.props;let{colorTexture:r}=this.state;const i=KN(n,!1,Uint8Array);r?r.setImageData({data:i,width:n.length}):r=new qe(this.context.gl,{data:i,width:n.length,height:1,...Sh}),this.setState({colorTexture:r})}_updateWeightmap(){const{radiusPixels:e,colorDomain:n,aggregation:r}=this.props,{weightsTransform:i,worldBounds:s,textureSize:o,weightsTexture:a,weightsScale:c}=this.state;this.state.isWeightMapDirty=!1;const l=this._worldToCommonBounds(s,{useLayerCoordinateSystem:!0});if(n&&r==="SUM"){const{viewport:h}=this.context,f=h.distanceScales.metersPerUnit[2]*(l[2]-l[0])/o;this.state.colorDomain=n.map(g=>g*f*c)}else this.state.colorDomain=n||py;const u={radiusPixels:e,commonBounds:l,textureWidth:o,weightsScale:c};i.update({elementCount:this.getNumInstances()}),Wt(this.context.gl,{clearColor:[0,0,0,0]},()=>{i.run({uniforms:u,parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32774},clearRenderTarget:!0,attributes:this.getAttributes(),moduleSettings:this.getModuleSettings()})}),this._updateMaxWeightValue(),a.setParameters({10240:9729,10241:9729})}_debouncedUpdateWeightmap(e=!1){let{updateTimer:n}=this.state;const{debounceTimeout:r}=this.props;e?(n=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(n),n=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),r)),this.setState({updateTimer:n})}_worldToCommonBounds(e,n={}){const{useLayerCoordinateSystem:r=!1}=n,[i,s,o,a]=e,{viewport:c}=this.context,{textureSize:l}=this.state,{coordinateSystem:u}=this.props,h=r&&(u===W.LNGLAT_OFFSETS||u===W.METER_OFFSETS),f=h?c.projectPosition(this.props.coordinateOrigin):[0,0],g=l*fU/c.scale;let p,A;return r&&!h?(p=this.projectPosition([i,s,0]),A=this.projectPosition([o,a,0])):(p=c.projectPosition([i,s,0]),A=c.projectPosition([o,a,0])),rU([p[0]-f[0],p[1]-f[1],A[0]-f[0],A[1]-f[1]],g,g)}_commonToWorldBounds(e){const[n,r,i,s]=e,{viewport:o}=this.context,a=o.unprojectPosition([n,r]),c=o.unprojectPosition([i,s]);return a.slice(0,2).concat(c.slice(0,2))}}d(vp,"layerName","HeatmapLayer");d(vp,"defaultProps",gU);const bt={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new C;new C;const no=new C,my=new C;class Aa{constructor(e=[0,0,0],n=0){d(this,"center",void 0),d(this,"radius",void 0),this.radius=-0,this.center=new C,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=no.from(n),this.center=new C().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Aa(this.center,this.radius)}union(e){const n=this.center,r=this.radius,i=e.center,s=e.radius,o=no.copy(i).subtract(n),a=o.magnitude();if(r>=a+s)return this.clone();if(s>=a+r)return e.clone();const c=(r+a+s)*.5;return my.copy(o).scale((-r+c)/a).add(n),this.center.copy(my),this.radius=c,this}expand(e){const r=no.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const n=vL(no,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const r=no.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const n=this.center,r=this.radius,s=e.normal.dot(n)+e.distance;return s<-r?bt.OUTSIDE:s<r?bt.INTERSECTING:bt.INSIDE}}const yU=new C,vU=new C,hc=new C,fc=new C,dc=new C,AU=new C,EU=new C,Un={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Ea{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){d(this,"center",void 0),d(this,"halfAxes",void 0),this.center=new C().from(e),this.halfAxes=new Se(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new C(e).len(),new C(n).len(),new C(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),i=new C(e).normalize(),s=new C(n).normalize(),o=new C(r).normalize();return new Zo().fromMatrix3(new Se([...i,...s,...o]))}fromCenterHalfSizeQuaternion(e,n,r){const i=new Zo(r),s=new Se().fromQuaternion(i);return s[0]=s[0]*n[0],s[1]=s[1]*n[0],s[2]=s[2]*n[0],s[3]=s[3]*n[1],s[4]=s[4]*n[1],s[5]=s[5]*n[1],s[6]=s[6]*n[2],s[7]=s[7]*n[2],s[8]=s[8]*n[2],this.center=new C().from(e),this.halfAxes=s,this}clone(){return new Ea(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Aa){const n=this.halfAxes,r=n.getColumn(0,hc),i=n.getColumn(1,fc),s=n.getColumn(2,dc),o=yU.copy(r).add(i).add(s);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const n=this.center,r=e.normal,i=this.halfAxes,s=r.x,o=r.y,a=r.z,c=Math.abs(s*i[Un.COLUMN0ROW0]+o*i[Un.COLUMN0ROW1]+a*i[Un.COLUMN0ROW2])+Math.abs(s*i[Un.COLUMN1ROW0]+o*i[Un.COLUMN1ROW1]+a*i[Un.COLUMN1ROW2])+Math.abs(s*i[Un.COLUMN2ROW0]+o*i[Un.COLUMN2ROW1]+a*i[Un.COLUMN2ROW2]),l=r.dot(n)+e.distance;return l<=-c?bt.OUTSIDE:l>=c?bt.INSIDE:bt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=vU.from(e).subtract(this.center),r=this.halfAxes,i=r.getColumn(0,hc),s=r.getColumn(1,fc),o=r.getColumn(2,dc),a=i.magnitude(),c=s.magnitude(),l=o.magnitude();i.normalize(),s.normalize(),o.normalize();let u=0,h;return h=Math.abs(n.dot(i))-a,h>0&&(u+=h*h),h=Math.abs(n.dot(s))-c,h>0&&(u+=h*h),h=Math.abs(n.dot(o))-l,h>0&&(u+=h*h),u}computePlaneDistances(e,n,r=[-0,-0]){let i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,c=a.getColumn(0,hc),l=a.getColumn(1,fc),u=a.getColumn(2,dc),h=AU.copy(c).add(l).add(u).add(o),f=EU.copy(h).subtract(e);let g=n.dot(f);return i=Math.min(g,i),s=Math.max(g,s),h.copy(o).add(c).add(l).subtract(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),h.copy(o).add(c).subtract(l).add(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),h.copy(o).add(c).subtract(l).subtract(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),o.copy(h).subtract(c).add(l).add(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),o.copy(h).subtract(c).add(l).subtract(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),o.copy(h).subtract(c).subtract(l).add(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),o.copy(h).subtract(c).subtract(l).subtract(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),r[0]=i,r[1]=s,r}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,hc);n.transformAsPoint(e);const r=this.halfAxes.getColumn(1,fc);r.transformAsPoint(e);const i=this.halfAxes.getColumn(2,dc);return i.transformAsPoint(e),this.halfAxes=new Se([...n,...r,...i]),this}getTransform(){throw new Error("not implemented")}}const _y=new C,yy=new C;class nn{constructor(e=[0,0,1],n=0){d(this,"normal",void 0),d(this,"distance",void 0),this.normal=new C,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return rn(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=_y.from(e),this.normal.from(n).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,n,r,i){return this.normal.set(e,n,r),rn(ln(this.normal.len(),1)),this.distance=i,this}clone(){return new nn(this.normal,this.distance)}equals(e){return ln(this.distance,e.distance)&&ln(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=yy.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,n)}projectPointOntoPlane(e,n=[0,0,0]){e=_y.from(e);const r=this.getPointDistance(e),i=yy.copy(this.normal).scale(r);return e.subtract(i).to(n)}}const vy=[new C([1,0,0]),new C([0,1,0]),new C([0,0,1])],Ay=new C,TU=new C;new nn(new C(1,0,0),0);class Vt{constructor(e=[]){d(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*vy.length;const n=e.center,r=e.radius;let i=0;for(const s of vy){let o=this.planes[i],a=this.planes[i+1];o||(o=this.planes[i]=new nn),a||(a=this.planes[i+1]=new nn);const c=Ay.copy(s).scale(-r).add(n);-s.dot(c),o.fromPointNormal(c,s);const l=Ay.copy(s).scale(r).add(n),u=TU.copy(s).negate();-u.dot(l),a.fromPointNormal(l,u),i+=2}return this}computeVisibility(e){let n=bt.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case bt.OUTSIDE:return bt.OUTSIDE;case bt.INTERSECTING:n=bt.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(rn(Number.isFinite(n),"parentPlaneMask is required."),n===Vt.MASK_OUTSIDE||n===Vt.MASK_INSIDE)return n;let r=Vt.MASK_INSIDE;const i=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&!(n&o))continue;const a=i[s],c=e.intersectPlane(a);if(c===bt.OUTSIDE)return Vt.MASK_OUTSIDE;c===bt.INTERSECTING&&(r|=o)}return r}}d(Vt,"MASK_OUTSIDE",4294967295);d(Vt,"MASK_INSIDE",0);d(Vt,"MASK_INDETERMINATE",2147483647);new C;new C;new C;new C;new C;new C;new C;new C;new C;new C;new C;new C;new C;new C;new C;new C;new C;const En=new Se,bU=new Se,SU=new Se,gc=new Se,Ey=new Se;function wU(t,e={}){const n=$o.EPSILON20,r=10;let i=0,s=0;const o=bU,a=SU;o.identity(),a.copy(t);const c=n*CU(a);for(;s<r&&xU(a)>c;)BU(a,gc),Ey.copy(gc).transpose(),a.multiplyRight(gc),a.multiplyLeft(Ey),o.multiplyRight(gc),++i>2&&(++s,i=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function CU(t){let e=0;for(let n=0;n<9;++n){const r=t[n];e+=r*r}return Math.sqrt(e)}const vd=[1,0,0],Ad=[2,2,1];function xU(t){let e=0;for(let n=0;n<3;++n){const r=t[En.getElementIndex(Ad[n],vd[n])];e+=2*r*r}return Math.sqrt(e)}function BU(t,e){const n=$o.EPSILON15;let r=0,i=1;for(let l=0;l<3;++l){const u=Math.abs(t[En.getElementIndex(Ad[l],vd[l])]);u>r&&(i=l,r=u)}const s=vd[i],o=Ad[i];let a=1,c=0;if(Math.abs(t[En.getElementIndex(o,s)])>n){const l=t[En.getElementIndex(o,o)],u=t[En.getElementIndex(s,s)],h=t[En.getElementIndex(o,s)],f=(l-u)/2/h;let g;f<0?g=-1/(-f+Math.sqrt(1+f*f)):g=1/(f+Math.sqrt(1+f*f)),a=1/Math.sqrt(1+g*g),c=g*a}return Se.IDENTITY.to(e),e[En.getElementIndex(s,s)]=e[En.getElementIndex(o,o)]=a,e[En.getElementIndex(o,s)]=c,e[En.getElementIndex(s,o)]=-c,e}const pr=new C,IU=new C,MU=new C,RU=new C,PU=new C,LU=new Se,OU={diagonal:new Se,unitary:new Se};function DU(t,e=new Ea){if(!t||t.length===0)return e.halfAxes=new Se([0,0,0,0,0,0,0,0,0]),e.center=new C,e;const n=t.length,r=new C(0,0,0);for(const L of t)r.add(L);const i=1/n;r.multiplyByScalar(i);let s=0,o=0,a=0,c=0,l=0,u=0;for(const L of t){const R=pr.copy(L).subtract(r);s+=R.x*R.x,o+=R.x*R.y,a+=R.x*R.z,c+=R.y*R.y,l+=R.y*R.z,u+=R.z*R.z}s*=i,o*=i,a*=i,c*=i,l*=i,u*=i;const h=LU;h[0]=s,h[1]=o,h[2]=a,h[3]=o,h[4]=c,h[5]=l,h[6]=a,h[7]=l,h[8]=u;const{unitary:f}=wU(h,OU),g=e.halfAxes.copy(f);let p=g.getColumn(0,MU),A=g.getColumn(1,RU),b=g.getColumn(2,PU),_=-Number.MAX_VALUE,m=-Number.MAX_VALUE,v=-Number.MAX_VALUE,T=Number.MAX_VALUE,w=Number.MAX_VALUE,x=Number.MAX_VALUE;for(const L of t)pr.copy(L),_=Math.max(pr.dot(p),_),m=Math.max(pr.dot(A),m),v=Math.max(pr.dot(b),v),T=Math.min(pr.dot(p),T),w=Math.min(pr.dot(A),w),x=Math.min(pr.dot(b),x);p=p.multiplyByScalar(.5*(T+_)),A=A.multiplyByScalar(.5*(w+m)),b=b.multiplyByScalar(.5*(x+v)),e.center.copy(p).add(A).add(b);const I=IU.set(_-T,m-w,v-x).multiplyByScalar(.5),M=new Se([I[0],0,0,0,I[1],0,0,0,I[2]]);return e.halfAxes.multiplyRight(M),e}const wh=Math.PI/180,pc=new Float32Array(16),Ty=new Float32Array(12);function by(t,e,n){const r=e[0]*wh,i=e[1]*wh,s=e[2]*wh,o=Math.sin(s),a=Math.sin(r),c=Math.sin(i),l=Math.cos(s),u=Math.cos(r),h=Math.cos(i),f=n[0],g=n[1],p=n[2];t[0]=f*h*u,t[1]=f*c*u,t[2]=f*-a,t[3]=g*(-c*l+h*a*o),t[4]=g*(h*l+c*a*o),t[5]=g*u*o,t[6]=p*(c*o+h*a*l),t[7]=p*(-h*o+c*a*l),t[8]=p*u*l}function Sy(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const ab={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:r,getOrientation:i,getScale:s,getTranslation:o,getTransformMatrix:a}=this.props,c=Array.isArray(a),l=c&&a.length===16,u=Array.isArray(s),h=Array.isArray(i),f=Array.isArray(o),g=l||!c&&!!a(r[0]);g?t.constant=l:t.constant=h&&u&&f;const p=t.value;if(t.constant){let A;g?(pc.set(a),A=Sy(pc)):(A=Ty,by(A,i,s),A.set(o,9)),t.value=new Float32Array(A)}else{let A=e*t.size;const{iterable:b,objectInfo:_}=J1(r,e,n);for(const m of b){_.index++;let v;if(g)pc.set(l?a:a(m,_)),v=Sy(pc);else{v=Ty;const T=h?i:i(m,_),w=u?s:s(m,_);by(v,T,w),v.set(f?o:o(m,_),9)}p[A++]=v[0],p[A++]=v[1],p[A++]=v[2],p[A++]=v[3],p[A++]=v[4],p[A++]=v[5],p[A++]=v[6],p[A++]=v[7],p[A++]=v[8],p[A++]=v[9],p[A++]=v[10],p[A++]=v[11]}}}};function cb(t,e){return e===W.CARTESIAN||e===W.METER_OFFSETS||e===W.DEFAULT&&!t.isGeospatial}const FU=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,NU=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function lb(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],c=a&&a.length;for(let l=0;l<c;l+=3){const u=a[l],h=a[l+1],f=a[l+2];e=u<e?u:e,n=h<n?h:n,r=f<r?f:r,i=u>i?u:i,s=h>s?h:s,o=f>o?f:o}return[[e,n,r],[i,s,o]]}function UU(t,e){if(!t)throw new Error(e||"loader assertion failed.")}class Zi{constructor(e,n){d(this,"fields",void 0),d(this,"metadata",void 0),UU(Array.isArray(e)),kU(e),this.fields=e,this.metadata=n||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let n=0;n<this.fields.length;++n)if(!this.fields[n].compareTo(e.fields[n]))return!1;return!0}select(){const e=Object.create(null);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(const o of r)e[o]=!0;const s=this.fields.filter(o=>e[o.name]);return new Zi(s,this.metadata)}selectAt(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];const i=n.map(s=>this.fields[s]).filter(Boolean);return new Zi(i,this.metadata)}assign(e){let n,r=this.metadata;if(e instanceof Zi){const o=e;n=o.fields,r=wy(wy(new Map,this.metadata),o.metadata)}else n=e;const i=Object.create(null);for(const o of this.fields)i[o.name]=o;for(const o of n)i[o.name]=o;const s=Object.values(i);return new Zi(s,r)}}function kU(t){const e={};for(const n of t)e[n.name]&&console.warn("Schema: duplicated field name",n.name,n),e[n.name]=!0}function wy(t,e){return new Map([...t||new Map,...e||new Map])}class Rl{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;d(this,"name",void 0),d(this,"type",void 0),d(this,"nullable",void 0),d(this,"metadata",void 0),this.name=e,this.type=n,this.nullable=r,this.metadata=i}get typeId(){return this.type&&this.type.typeId}clone(){return new Rl(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let Te=function(t){return t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth",t}({}),ub,hb,fb;class Ap{static isNull(e){return e&&e.typeId===Te.Null}static isInt(e){return e&&e.typeId===Te.Int}static isFloat(e){return e&&e.typeId===Te.Float}static isBinary(e){return e&&e.typeId===Te.Binary}static isUtf8(e){return e&&e.typeId===Te.Utf8}static isBool(e){return e&&e.typeId===Te.Bool}static isDecimal(e){return e&&e.typeId===Te.Decimal}static isDate(e){return e&&e.typeId===Te.Date}static isTime(e){return e&&e.typeId===Te.Time}static isTimestamp(e){return e&&e.typeId===Te.Timestamp}static isInterval(e){return e&&e.typeId===Te.Interval}static isList(e){return e&&e.typeId===Te.List}static isStruct(e){return e&&e.typeId===Te.Struct}static isUnion(e){return e&&e.typeId===Te.Union}static isFixedSizeBinary(e){return e&&e.typeId===Te.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===Te.FixedSizeList}static isMap(e){return e&&e.typeId===Te.Map}static isDictionary(e){return e&&e.typeId===Te.Dictionary}get typeId(){return Te.NONE}compareTo(e){return this===e}}ub=Symbol.toStringTag;class Ps extends Ap{constructor(e,n){super(),d(this,"isSigned",void 0),d(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=n}get typeId(){return Te.Int}get[ub](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class GU extends Ps{constructor(){super(!0,8)}}class VU extends Ps{constructor(){super(!0,16)}}class zU extends Ps{constructor(){super(!0,32)}}class HU extends Ps{constructor(){super(!1,8)}}class jU extends Ps{constructor(){super(!1,16)}}class WU extends Ps{constructor(){super(!1,32)}}const db={HALF:16,SINGLE:32,DOUBLE:64};hb=Symbol.toStringTag;class gb extends Ap{constructor(e){super(),d(this,"precision",void 0),this.precision=e}get typeId(){return Te.Float}get[hb](){return"Float"}toString(){return"Float".concat(this.precision)}}class JU extends gb{constructor(){super(db.SINGLE)}}class XU extends gb{constructor(){super(db.DOUBLE)}}fb=Symbol.toStringTag;class KU extends Ap{constructor(e,n){super(),d(this,"listSize",void 0),d(this,"children",void 0),this.listSize=e,this.children=[n]}get typeId(){return Te.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[fb](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function YU(t){switch(t.constructor){case Int8Array:return new GU;case Uint8Array:return new HU;case Int16Array:return new VU;case Uint16Array:return new jU;case Int32Array:return new zU;case Uint32Array:return new WU;case Float32Array:return new JU;case Float64Array:return new XU;default:throw new Error("array type not supported")}}function QU(t,e,n){const r=YU(e.value),i=n||qU(e);return new Rl(t,new KU(e.size,new Rl("value",r)),!1,i)}function qU(t){const e=new Map;return"byteOffset"in t&&e.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&e.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&e.set("normalized",t.normalized.toString()),e}function Cy(t,e){(t.COLOR_0||t.colors)&&e||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),q.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function xy(t,e){if(t.attributes)return Cy(t.attributes,e),t instanceof os?t:new os(t);if(t.positions||t.POSITION)return Cy(t,e),new os({attributes:t});throw Error("Invalid mesh")}const ZU=[0,0,0,255],$U={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:ZU},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class Ep extends Vr{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){const e=!J(this.context.gl),n={};return Hg(this.context.gl,ie.GLSL_DERIVATIVES)&&(n.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:FU,fs:NU,modules:[tu,gO,lp],transpileToGLSL100:e,defines:n})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let n=this.state.positionBounds;if(n)return n;const{mesh:r}=this.props;if(!r)return null;if(n=(e=r.header)===null||e===void 0?void 0:e.boundingBox,!n){const{attributes:i}=xy(r,this.props._useMeshColors);i.POSITION=i.POSITION||i.positions,n=lb(i)}return this.state.positionBounds=n,n}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:ab}),this.setState({emptyTexture:new qe(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e;if(n.mesh!==r.mesh||i.extensionsChanged){var s;if(this.state.positionBounds=null,(s=this.state.model)===null||s===void 0||s.delete(),n.mesh){this.state.model=this.getModel(n.mesh);const o=n.mesh.attributes||n.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==r.texture&&this.setTexture(n.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){if(!this.state.model)return;const{viewport:n}=this.context,{sizeScale:r,coordinateSystem:i,_instanced:s}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:r,composeModelMatrix:!s||cb(n,i),flatShading:!this.state.hasNormals}).draw()}getModel(e){const n=new di(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:xy(e,this.props._useMeshColors),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:i}=this.state;return n.setUniforms({sampler:r||i,hasTexture:!!r}),n}setTexture(e){const{emptyTexture:n,model:r}=this.state;r&&r.setUniforms({sampler:e||n,hasTexture:!!e})}}d(Ep,"defaultProps",$U);d(Ep,"layerName","SimpleMeshLayer");class ls{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n}=e;this.id=n||nr(this.constructor.name),this.display=!0,this.position=new C,this.rotation=new C,this.scale=new C(1,1,1),this.matrix=new Y,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(e){return N(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return N(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return N(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:n,rotation:r,scale:i,update:s=!0}=e;return n&&this.setPosition(n),r&&this.setRotation(r),i&&this.setScale(i),s&&this.updateMatrix(),this}updateMatrix(){const e=this.position,n=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(n),this.matrix.scale(r),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:n,rotation:r,scale:i}=e;return n&&this.setPosition(n),r&&this.setRotation(r),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,n){N(e),n=n||this.matrix;const r=new Y(e).multiplyRight(n),i=r.invert(),s=i.transpose();return{viewMatrix:e,modelMatrix:n,objectMatrix:n,worldMatrix:r,worldInverseMatrix:i,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Mo extends ls{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:n=[]}=e;V.assert(n.every(r=>r instanceof ls),"every child must an instance of ScenegraphNode"),super(e),this.children=n}add(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(const i of n)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(e){const n=this.children,r=n.indexOf(e);return r>-1&&n.splice(r,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((n,r)=>{let{worldMatrix:i}=r;const s=n.getBounds();if(!s)return;const[o,a]=s,c=new C(o).add(a).divide([2,2,2]);i.transformAsPoint(c,c);const l=new C(a).subtract(o).divide([2,2,2]);i.transformAsVector(l,l);for(let u=0;u<8;u++){const h=new C(u&1?-1:1,u&2?-1:1,u&4?-1:1).multiply(l).add(c);for(let f=0;f<3;f++)e[0][f]=Math.min(e[0][f],h[f]),e[1][f]=Math.max(e[1][f],h[f])}}),Number.isFinite(e[0][0])?e:null}traverse(e){let{worldMatrix:n=new Y}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new Y(n).multiplyRight(this.matrix);for(const i of this.children)i instanceof Mo?i.traverse(e,{worldMatrix:r}):e(i,{worldMatrix:r})}}const ek={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},tk={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function By(t){if(!t._animation){const e=tk[t.componentType],n=ek[t.type],r=n*t.count,{buffer:i,byteOffset:s}=t.bufferView.data,o=new e(i,s+(t.byteOffset||0),r);if(n===1)t._animation=Array.from(o);else{const a=[];for(let c=0;c<o.length;c+=n)a.push(Array.from(o.slice(c,c+n)));t._animation=a}}return t._animation}const nk=new Y;function rk(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const n=nk.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}const Ch=new Zo;function ik(t,e,n,r,i){if(e==="rotation"){Ch.slerp({start:n,target:r,ratio:i});for(let s=0;s<Ch.length;s++)t[e][s]=Ch[s]}else for(let s=0;s<n.length;s++)t[e][s]=i*r[s]+(1-i)*n[s]}function sk(t,e,n){let{p0:r,outTangent0:i,inTangent1:s,p1:o,tDiff:a,ratio:c}=n;for(let l=0;l<t[e].length;l++){const u=i[l]*a,h=s[l]*a;t[e][l]=(2*Math.pow(c,3)-3*Math.pow(c,2)+1)*r[l]+(Math.pow(c,3)-2*Math.pow(c,2)+c)*u+(-2*Math.pow(c,3)+3*Math.pow(c,2))*o[l]+(Math.pow(c,3)-Math.pow(c,2))*h}}function ok(t,e,n){for(let r=0;r<n.length;r++)t[e][r]=n[r]}function ak(t,e,n,r){let{input:i,interpolation:s,output:o}=e;const a=i[i.length-1],c=t%a,l=i.findIndex(g=>g>=c),u=Math.max(0,l-1);if(!Array.isArray(n[r]))switch(r){case"translation":n[r]=[0,0,0];break;case"rotation":n[r]=[0,0,0,1];break;case"scale":n[r]=[1,1,1];break;default:V.warn("Bad animation path ".concat(r))()}N(n[r].length===o[u].length);const h=i[u],f=i[l];switch(s){case"STEP":ok(n,r,o[u]);break;case"LINEAR":if(f>h){const g=(c-h)/(f-h);ik(n,r,o[u],o[l],g)}break;case"CUBICSPLINE":if(f>h){const g=(c-h)/(f-h),p=f-h,A=o[3*u+1],b=o[3*u+2],_=o[3*l+0],m=o[3*l+1];sk(n,r,{p0:A,outTangent0:b,inTangent1:_,p1:m,tDiff:p,ratio:g})}break;default:V.warn("Interpolation ".concat(s," not supported"))();break}}class ck{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const r=(e/1e3-this.startTime)*this.speed;this.channels.forEach(i=>{let{sampler:s,target:o,path:a}=i;ak(r,s,o,a),rk(o,o._node)})}}class lk{constructor(e){this.animations=e.animations.map((n,r)=>{const i=n.name||"Animation-".concat(r),s=n.samplers.map(a=>{let{input:c,interpolation:l="LINEAR",output:u}=a;return{input:By(e.accessors[c]),interpolation:l,output:By(e.accessors[u])}}),o=n.channels.map(a=>{let{sampler:c,target:l}=a;return{sampler:s[c],target:e.nodes[l.node],path:l.path}});return new ck({name:i,channels:o})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(n=>n.animate(e))}getAnimations(){return this.animations}}class uk extends ls{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(n),this.onBeforeRender=null,this.AfterRender=null,e instanceof di?(this.model=e,this._setModelNodeProps(n)):this.model=new di(e,n),this.bounds=null,this.managedResources=n.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class pb{constructor(e,n){let{attributes:r,material:i,pbrDebug:s,imageBasedLightingEnvironment:o,lights:a,useTangents:c}=n;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},Hg(e,ie.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],o&&(this.uniforms.u_DiffuseEnvSampler=o.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=o.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=o.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),s&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(r.NORMAL,"HAS_NORMALS"),this.defineIfPresent(r.TANGENT&&c,"HAS_TANGENTS"),this.defineIfPresent(r.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(o,"USE_IBL"),this.defineIfPresent(a,"USE_LIGHTS"),this.defineIfPresent(s,"PBR_DEBUG"),i&&this.parseMaterial(i)}defineIfPresent(e,n){e&&(this.defines[n]=1)}parseTexture(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const i=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},s=e.texture.source.image;let o,a={};s.compressed?(o=s,a={[this.gl.TEXTURE_MIN_FILTER]:s.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):o={data:s};const c=new qe(this.gl,{id:e.name||e.id,parameters:{...i,...a},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...o});this.uniforms[n]=c,this.defineIfPresent(r,r),this.generatedTextures.push(c)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:n=1,roughnessFactor:r=1}=e;this.uniforms.u_MetallicRoughnessValues=[n,r]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:n=1}=e.normalTexture;this.uniforms.u_NormalScale=n}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:n=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=n}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:n=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=n}else e.alphaMode==="BLEND"&&(V.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const hk=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,fk=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function Iy(t,e){return J(t)?`#version 300 es
`.concat(e):e}function dk(t,e){const{id:n,drawMode:r,vertexCount:i,attributes:s,modelOptions:o}=e,a=new pb(t,e);V.info(4,"createGLTFModel defines: ",a.defines)();const c=[];c.push(...a.generatedTextures),c.push(...Object.values(s).map(u=>u.buffer));const l=new uk(t,{id:n,drawMode:r,vertexCount:i,modules:[np],parameters:a.parameters,vs:Iy(t,hk),fs:Iy(t,fk),managedResources:c,...o,defines:{...a.defines,...o.defines}});return l.setProps({attributes:s}),l.setUniforms(a.uniforms),l}const gk={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pk={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class mk{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},pk,n)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new lk(this.gltf):null}createScene(e){const r=(e.nodes||[]).map(s=>this.createNode(s));return new Mo({id:e.name||e.id,children:r})}createNode(e){if(!e._node){const r=(e.children||[]).map(s=>this.createNode(s));e.mesh&&r.push(this.createMesh(e.mesh));const i=new Mo({id:e.name||e.id,children:r});if(e.matrix)i.setMatrix(e.matrix);else{if(i.matrix.identity(),e.translation&&i.matrix.translate(e.translation),e.rotation){const s=new Y().fromQuaternion(e.rotation);i.matrix.multiplyRight(s)}e.scale&&i.matrix.scale(e.scale)}e._node=i}return e._node}createMesh(e){if(!e._mesh){const r=(e.primitives||[]).map((s,o)=>this.createPrimitive(s,o,e)),i=new Mo({id:e.name||e.id,children:r});e._mesh=i}return e._mesh}getVertexCount(e){V.warn("getVertexCount() not found")()}createPrimitive(e,n,r){const i=dk(this.gl,Object.assign({id:e.name||"".concat(r.name||r.id,"-primitive-").concat(n),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return i.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],i}createAttributes(e,n){const r={};return Object.keys(e).forEach(i=>{r[i]=this.createAccessor(e[i],this.createBuffer(e[i],this.gl.ARRAY_BUFFER))}),n&&(r.indices=this.createAccessor(n,this.createBuffer(n,this.gl.ELEMENT_ARRAY_BUFFER))),V.info(4,"glTF Attributes",{attributes:e,indices:n,generated:r})(),r}createBuffer(e,n){e.bufferView||(e.bufferView={});const{bufferView:r}=e;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[n]||(r.lumaBuffers[n]=new se(this.gl,{id:"from-".concat(r.id),data:r.data||e.value,target:n})),r.lumaBuffers[n]}createAccessor(e,n){return new ut({buffer:n,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:gk[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function _k(t,e,n){const r=new mk(t,n),i=r.instantiate(e),s=r.createAnimator();return{scenes:i,animator:s}}const yk="3.4.14",vk="3.4.14",mb="3.4.14",Ak="https://unpkg.com/@loaders.gl/textures@".concat(mb,"/dist/libs/basis_encoder.wasm"),Ek="https://unpkg.com/@loaders.gl/textures@".concat(mb,"/dist/libs/basis_encoder.js");let xh;async function My(t){const e=t.modules||{};return e.basis?e.basis:(xh=xh||Tk(t),await xh)}async function Tk(t){let e=null,n=null;return[e,n]=await Promise.all([await si("basis_transcoder.js","textures",t),await si("basis_transcoder.wasm","textures",t)]),e=e||globalThis.BASIS,await bk(e,n)}function bk(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(i=>{const{BasisFile:s,initializeBasis:o}=i;o(),r({BasisFile:s})})})}let Bh;async function Ry(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(Bh=Bh||Sk(t),await Bh)}async function Sk(t){let e=null,n=null;return[e,n]=await Promise.all([await si(Ek,"textures",t),await si(Ak,"textures",t)]),e=e||globalThis.BASIS,await wk(e,n)}function wk(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(i=>{const{BasisFile:s,KTX2File:o,initializeBasis:a,BasisEncoder:c}=i;a(),r({BasisFile:s,KTX2File:o,BasisEncoder:c})})})}const Li={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},Ck=["","WEBKIT_","MOZ_"],Py={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let mc=null;function xk(t){if(!mc){t=t||Bk()||void 0,mc=new Set;for(const e of Ck)for(const n in Py)if(t&&t.getExtension("".concat(e).concat(n))){const r=Py[n];mc.add(r)}}return mc}function Bk(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var Ly,Oy,Dy,Fy,Ny,Uy,ky,Gy;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(Ly||(Ly={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(Oy||(Oy={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(Dy||(Dy={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(Fy||(Fy={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(Ny||(Ny={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(Uy||(Uy={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(ky||(ky={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(Gy||(Gy={}));const vt=[171,75,84,88,32,50,48,187,13,10,26,10];function Ik(t){const e=new Uint8Array(t);return!(e.byteLength<vt.length||e[0]!==vt[0]||e[1]!==vt[1]||e[2]!==vt[2]||e[3]!==vt[3]||e[4]!==vt[4]||e[5]!==vt[5]||e[6]!==vt[6]||e[7]!==vt[7]||e[8]!==vt[8]||e[9]!==vt[9]||e[10]!==vt[10]||e[11]!==vt[11])}const Mk={etc1:{basisFormat:0,compressed:!0,format:Li.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Li.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Li.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Li.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Li.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Li.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Rk(t,e){if(e.basis.containerFormat==="auto"){if(Ik(t)){const r=await Ry(e);return Vy(r.KTX2File,t,e)}const{BasisFile:n}=await My(e);return Ih(n,t,e)}switch(e.basis.module){case"encoder":const n=await Ry(e);switch(e.basis.containerFormat){case"ktx2":return Vy(n.KTX2File,t,e);case"basis":default:return Ih(n.BasisFile,t,e)}case"transcoder":default:const{BasisFile:r}=await My(e);return Ih(r,t,e)}}function Ih(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const i=r.getNumImages(),s=[];for(let o=0;o<i;o++){const a=r.getNumLevels(o),c=[];for(let l=0;l<a;l++)c.push(Pk(r,o,l,n));s.push(c)}return s}finally{r.close(),r.delete()}}function Pk(t,e,n,r){const i=t.getImageWidth(e,n),s=t.getImageHeight(e,n),o=t.getHasAlpha(),{compressed:a,format:c,basisFormat:l}=_b(r,o),u=t.getImageTranscodedSizeInBytes(e,n,l),h=new Uint8Array(u);if(!t.transcodeImage(h,e,n,l,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:s,data:h,compressed:a,format:c,hasAlpha:o}}function Vy(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=r.getLevels(),s=[];for(let o=0;o<i;o++){s.push(Lk(r,o,n));break}return[s]}finally{r.close(),r.delete()}}function Lk(t,e,n){const{alphaFlag:r,height:i,width:s}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:c}=_b(n,r),l=t.getImageTranscodedSizeInBytes(e,0,0,c),u=new Uint8Array(l);if(!t.transcodeImage(u,e,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:i,data:u,compressed:o,levelSize:l,hasAlpha:r,format:a}}function _b(t,e){let n=t&&t.basis&&t.basis.format;return n==="auto"&&(n=yb()),typeof n=="object"&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),Mk[n]}function yb(){const t=xk();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const Ok={name:"Basis",id:Yn?"basis":"basis-nodejs",module:"textures",version:vk,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},Dk={...Ok,parse:Rk};function wt(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function vb(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return r.substr(0,r.lastIndexOf("/")+1)+t}function Fk(t,e,n){const r=t.bufferViews[n];wt(r);const i=r.buffer,s=e[i];wt(s);const o=(r.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,o,r.byteLength)}const zy=["SCALAR","VEC2","VEC3","VEC4"],Nk=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Uk=new Map(Nk),kk={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Gk={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Vk={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Ab(t){return zy[t-1]||zy[0]}function Eb(t){const e=Uk.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function Tp(t,e){const n=Vk[t.componentType],r=kk[t.type],i=Gk[t.componentType],s=t.count*r,o=t.count*r*i;return wt(o>=0&&o<=e.byteLength),{ArrayType:n,length:s,byteLength:o}}function Tb(t){let{images:e,bufferViews:n}=t;e=e||[],n=n||[];const r=e.map(o=>o.bufferView);n=n.filter(o=>!r.includes(o));const i=n.reduce((o,a)=>o+a.byteLength,0),s=e.reduce((o,a)=>{const{width:c,height:l}=a.image;return o+c*l},0);return i+Math.ceil(4*s*1.33)}const zk={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class mt{constructor(e){d(this,"gltf",void 0),d(this,"sourceBuffers",void 0),d(this,"byteLength",void 0),this.gltf=e||{json:{...zk},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const n=this.getUsedExtensions().find(i=>i===e),r=this.json.extensions||{};return n?r[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,n){return(e.extensions||{})[n]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,n){if(typeof n=="object")return n;const r=this.json[e]&&this.json[e][n];if(!r)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(n,"]"));return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);const n=e.buffer,r=this.gltf.buffers[n];wt(r);const i=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),i=this.getBuffer(n.buffer).data,{ArrayType:s,length:o}=Tp(e,n),a=n.byteOffset+e.byteOffset;return new s(i,a,o)}getTypedArrayForImageData(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),i=this.getBuffer(n.buffer).data,s=n.byteOffset||0;return new Uint8Array(i,s,n.byteLength)}addApplicationData(e,n){return this.json[e]=n,this}addExtraData(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}addObjectExtension(e,n,r){return e.extensions=e.extensions||{},e.extensions[n]=r,this.registerUsedExtension(n),this}setObjectExtension(e,n,r){const i=e.extensions||{};i[n]=r}removeObjectExtension(e,n){const r=e.extensions||{},i=r[n];return delete r[n],i}addExtension(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return wt(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}addRequiredExtension(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return wt(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:n}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(e){const{meshIndex:n,matrix:r}=e;this.json.nodes=this.json.nodes||[];const i={mesh:n};return r&&(i.matrix=r),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:n,indices:r,material:i,mode:s=4}=e,a={primitives:[{attributes:this._addAttributes(n),mode:s}]};if(r){const c=this._addIndices(r);a.primitives[0].indices=c}return Number.isFinite(i)&&(a.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,n){const r=Dg(e),i=n||(r==null?void 0:r.mimeType),o={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e){const n=e.byteLength;wt(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:0,byteOffset:this.byteLength,byteLength:n};return this.byteLength+=la(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,n){const r={bufferView:e,type:Ab(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const r=this.addBufferView(e);let i={min:n.min,max:n.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,n.size));const s={size:n.size,componentType:Eb(e),count:Math.round(e.length/n.size),min:i.min,max:i.max};return this.addAccessor(r,Object.assign(s,n))}addTexture(e){const{imageIndex:n}=e,r={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,n;this.gltf.buffers=[];const r=this.byteLength,i=new ArrayBuffer(r),s=new Uint8Array(i);let o=0;for(const a of this.sourceBuffers||[])o=Ix(a,s,o);(e=this.json)!==null&&e!==void 0&&(n=e.buffers)!==null&&n!==void 0&&n[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=i,this.sourceBuffers=[i]}_removeStringFromArray(e,n){let r=!0;for(;r;){const i=e.indexOf(n);i>-1?e.splice(i,1):r=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={};for(const r in e){const i=e[r],s=this._getGltfAttributeName(r),o=this.addBinaryBuffer(i.value,i);n[s]=o}return n}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,n){const r={min:null,max:null};if(e.length<n)return r;r.min=[],r.max=[];const i=e.subarray(0,n);for(const s of i)r.min.push(s),r.max.push(s);for(let s=n;s<e.length;s+=n)for(let o=0;o<n;o++)r.min[0+o]=Math.min(r.min[0+o],e[s+o]),r.max[0+o]=Math.max(r.max[0+o],e[s+o]);return r}}const Hk="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",jk="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Wk=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Jk=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Xk={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Kk={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Yk(t,e,n,r,i){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const o=await Qk();$k(o,o.exports[Kk[i]],t,e,n,r,o.exports[Xk[s||"NONE"]])}let Mh;async function Qk(){return Mh||(Mh=qk()),Mh}async function qk(){let t=Hk;WebAssembly.validate(Wk)&&(t=jk,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(Zk(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function Zk(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;++r){const i=t.charCodeAt(r);e[r]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let n=0;for(let r=0;r<t.length;++r)e[n++]=e[r]<60?Jk[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,n)}function $k(t,e,n,r,i,s,o){const a=t.exports.sbrk,c=r+3&-4,l=a(c*i),u=a(s.length),h=new Uint8Array(t.exports.memory.buffer);h.set(s,u);const f=e(l,r,i,u,s.length);if(f===0&&o&&o(l,c,i),n.set(h.subarray(l,l+r*i)),a(l-a(0)),f!==0)throw new Error("Malformed buffer data: ".concat(f))}const bp="EXT_meshopt_compression",eG=bp;async function tG(t,e){var n;const r=new mt(t);if(!(e!=null&&(n=e.gltf)!==null&&n!==void 0&&n.decompressMeshes))return;const i=[];for(const s of t.json.bufferViews||[])i.push(nG(r,s));await Promise.all(i),r.removeExtension(bp)}async function nG(t,e){const n=t.getObjectExtension(e,bp);if(n){const{byteOffset:r=0,byteLength:i=0,byteStride:s,count:o,mode:a,filter:c="NONE",buffer:l}=n,u=t.gltf.buffers[l],h=new Uint8Array(u.arrayBuffer,u.byteOffset+r,i),f=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await Yk(f,o,s,h,a,c),f}return null}const rG=Object.freeze(Object.defineProperty({__proto__:null,decode:tG,name:eG},Symbol.toStringTag,{value:"Module"})),Ni="EXT_texture_webp",iG=Ni;function sG(t,e){const n=new mt(t);if(!II("image/webp")){if(n.getRequiredExtensions().includes(Ni))throw new Error("gltf: Required extension ".concat(Ni," not supported by browser"));return}const{json:r}=n;for(const i of r.textures||[]){const s=n.getObjectExtension(i,Ni);s&&(i.source=s.source),n.removeObjectExtension(i,Ni)}n.removeExtension(Ni)}const oG=Object.freeze(Object.defineProperty({__proto__:null,name:iG,preprocess:sG},Symbol.toStringTag,{value:"Module"})),Vc="KHR_texture_basisu",aG=Vc;function cG(t,e){const n=new mt(t),{json:r}=n;for(const i of r.textures||[]){const s=n.getObjectExtension(i,Vc);s&&(i.source=s.source),n.removeObjectExtension(i,Vc)}n.removeExtension(Vc)}const lG=Object.freeze(Object.defineProperty({__proto__:null,name:aG,preprocess:cG},Symbol.toStringTag,{value:"Module"})),uG="3.4.14",hG={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},fG={name:"Draco",id:Yn?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:uG,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:hG};function dG(t,e,n){const r=bb(e.metadata),i=[],s=gG(e.attributes);for(const o in t){const a=t[o],c=Hy(o,a,s[o]);i.push(c)}if(n){const o=Hy("indices",n);i.push(o)}return new Zi(i,r)}function gG(t){const e={};for(const n in t){const r=t[n];e[r.name||"undefined"]=r}return e}function Hy(t,e,n){const r=n?bb(n.metadata):void 0;return QU(t,e,r)}function bb(t){const e=new Map;for(const n in t)e.set("".concat(n,".string"),JSON.stringify(t[n]));return e}const jy={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},pG={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},mG=4;class _G{constructor(e){d(this,"draco",void 0),d(this,"decoder",void 0),d(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);const i=this.decoder.GetEncodedGeometryType(r),s=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(i){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(r,s);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(r,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!s.ptr){const f="DRACO decompression failed: ".concat(o.error_msg());throw new Error(f)}const a=this._getDracoLoaderData(s,i,n),c=this._getMeshData(s,a,n),l=lb(c.attributes),u=dG(c.attributes,a,c.indices);return{loader:"draco",loaderData:a,header:{vertexCount:s.num_points(),boundingBox:l},...c,schema:u}}finally{this.draco.destroy(r),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,n,r){const i=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,r);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:s}}_getDracoAttributes(e,n){const r={};for(let i=0;i<e.num_attributes();i++){const s=this.decoder.GetAttribute(e,i),o=this._getAttributeMetadata(e,i);r[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:i,metadata:o};const a=this._getQuantizationTransform(s,n);a&&(r[s.unique_id()].quantization_transform=a);const c=this._getOctahedronTransform(s,n);c&&(r[s.unique_id()].octahedron_transform=c)}return r}_getMeshData(e,n,r){const i=this._getMeshAttributes(n,e,r);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,n,r){const i={};for(const s of Object.values(e.attributes)){const o=this._deduceAttributeName(s,r);s.name=o;const{value:a,size:c}=this._getAttributeValues(n,s);i[o]={value:a,size:c,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return i}_getTriangleListIndices(e){const r=e.num_faces()*3,i=r*mG,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,r).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),AG(n)}finally{this.draco.destroy(n)}}_getAttributeValues(e,n){const r=pG[n.data_type],i=n.num_components,o=e.num_points()*i,a=o*r.BYTES_PER_ELEMENT,c=yG(this.draco,r);let l;const u=this.draco._malloc(a);try{const h=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,h,c,a,u),l=new r(this.draco.HEAPF32.buffer,u,o).slice()}finally{this.draco._free(u)}return{value:l,size:i}}_deduceAttributeName(e,n){const r=e.unique_id;for(const[o,a]of Object.entries(n.extraAttributes||{}))if(a===r)return o;const i=e.attribute_type;for(const o in jy)if(this.draco[o]===i)return jy[o];const s=n.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:"CUSTOM_ATTRIBUTE_".concat(r)}_getTopLevelMetadata(e){const n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}_getAttributeMetadata(e,n){const r=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const n={},r=this.metadataQuerier.NumEntries(e);for(let i=0;i<r;i++){const s=this.metadataQuerier.GetEntryName(e,i);n[s]=this._getDracoMetadataField(e,s)}return n}_getDracoMetadataField(e,n){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,r);const i=vG(r);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:i}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:n=[],octahedronAttributes:r=[]}=e,i=[...n,...r];for(const s of i)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(e,n){const{quantizedAttributes:r=[]}=n,i=e.attribute_type();if(r.map(o=>this.decoder[o]).includes(i)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,n){const{octahedronAttributes:r=[]}=n,i=e.attribute_type();if(r.map(o=>this.decoder[o]).includes(i)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function yG(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function vG(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}function AG(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}const EG="1.5.5",Sp="https://www.gstatic.com/draco/versioned/decoders/".concat(EG),TG="".concat(Sp,"/draco_decoder.js"),bG="".concat(Sp,"/draco_wasm_wrapper.js"),SG="".concat(Sp,"/draco_decoder.wasm");let ro;async function wG(t){const e=t.modules||{};return e.draco3d?ro=ro||e.draco3d.createDecoderModule({}).then(n=>({draco:n})):ro=ro||CG(t),await ro}async function CG(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await si(TG,"draco",t);break;case"wasm":default:[e,n]=await Promise.all([await si(bG,"draco",t),await si(SG,"draco",t)])}return e=e||globalThis.DracoDecoderModule,await xG(e,n)}function xG(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t({...n,onModuleLoaded:i=>r({draco:i})})})}const Sb={...fG,parse:BG};async function BG(t,e){const{draco:n}=await wG(e),r=new _G(n);try{return r.parseSync(t,e==null?void 0:e.draco)}finally{r.destroy()}}function IG(t){const e={};for(const n in t){const r=t[n];if(n!=="indices"){const i=wb(r);e[n]=i}}return e}function wb(t){const{buffer:e,size:n,count:r}=MG(t);return{value:e,size:n,byteOffset:0,count:r,type:Ab(n),componentType:Eb(e)}}function MG(t){let e=t,n=1,r=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=RG(e,Float32Array)),r=e.length/n),{buffer:e,size:n,count:r}}function RG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return t?Array.isArray(t)?new e(t):n&&!(t instanceof e)?new e(t):t:null}const pi="KHR_draco_mesh_compression",PG=pi;function LG(t,e,n){const r=new mt(t);for(const i of Cb(r))r.getObjectExtension(i,pi)}async function OG(t,e,n){var r;if(!(e!=null&&(r=e.gltf)!==null&&r!==void 0&&r.decompressMeshes))return;const i=new mt(t),s=[];for(const o of Cb(i))i.getObjectExtension(o,pi)&&s.push(FG(i,o,e,n));await Promise.all(s),i.removeExtension(pi)}function DG(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new mt(t);for(const r of n.json.meshes||[])NG(r,e),n.addRequiredExtension(pi)}async function FG(t,e,n,r){const i=t.getObjectExtension(e,pi);if(!i)return;const s=t.getTypedArrayForBufferView(i.bufferView),o=Cg(s.buffer,s.byteOffset),{parse:a}=r,c={...n};delete c["3d-tiles"];const l=await a(o,Sb,c,r),u=IG(l.attributes);for(const[h,f]of Object.entries(u))if(h in e.attributes){const g=e.attributes[h],p=t.getAccessor(g);p!=null&&p.min&&p!==null&&p!==void 0&&p.max&&(f.min=p.min,f.max=p.max)}e.attributes=u,l.indices&&(e.indices=wb(l.indices)),UG(e)}function NG(t,e){var n;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=i.DracoWriter.encodeSync({attributes:t}),a=s==null||(n=s.parseSync)===null||n===void 0?void 0:n.call(s,{attributes:t}),c=i._addFauxAttributes(a.attributes),l=i.addBufferView(o);return{primitives:[{attributes:c,mode:r,extensions:{[pi]:{bufferView:l,attributes:c}}}]}}function UG(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*Cb(t){for(const e of t.json.meshes||[])for(const n of e.primitives)yield n}const kG=Object.freeze(Object.defineProperty({__proto__:null,decode:OG,encode:DG,name:PG,preprocess:LG},Symbol.toStringTag,{value:"Module"})),GG={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},VG={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},wp="KHR_texture_transform",zG=wp,_c=new C,HG=new Se,jG=new Se;async function WG(t,e){if(!new mt(t).getExtension(wp))return;const i=t.json.materials||[];for(let s=0;s<i.length;s++)JG(s,t)}function JG(t,e){var n,r,i;const s=[],o=(n=e.json.materials)===null||n===void 0?void 0:n[t],a=o==null||(r=o.pbrMetallicRoughness)===null||r===void 0?void 0:r.baseColorTexture;a&&io(e,t,a,s);const c=o==null?void 0:o.emissiveTexture;c&&io(e,t,c,s);const l=o==null?void 0:o.normalTexture;l&&io(e,t,l,s);const u=o==null?void 0:o.occlusionTexture;u&&io(e,t,u,s);const h=o==null||(i=o.pbrMetallicRoughness)===null||i===void 0?void 0:i.metallicRoughnessTexture;h&&io(e,t,h,s)}function io(t,e,n,r){const i=XG(n,r);if(!i)return;const s=t.json.meshes||[];for(const o of s)for(const a of o.primitives){const c=a.material;Number.isFinite(c)&&e===c&&KG(t,a,i)}}function XG(t,e){var n;const r=(n=t.extensions)===null||n===void 0?void 0:n[wp],{texCoord:i=0}=t,{texCoord:s=i}=r;if(!(e.findIndex(a=>{let[c,l]=a;return c===i&&l===s})!==-1)){const a=qG(r);return i!==s&&(t.texCoord=s),e.push([i,s]),{originalTexCoord:i,texCoord:s,matrix:a}}return null}function KG(t,e,n){const{originalTexCoord:r,texCoord:i,matrix:s}=n,o=e.attributes["TEXCOORD_".concat(r)];if(Number.isFinite(o)){var a;const l=(a=t.json.accessors)===null||a===void 0?void 0:a[o];if(l&&l.bufferView){var c;const u=(c=t.json.bufferViews)===null||c===void 0?void 0:c[l.bufferView];if(u){const{arrayBuffer:h,byteOffset:f}=t.buffers[u.buffer],g=(f||0)+(l.byteOffset||0)+(u.byteOffset||0),{ArrayType:p,length:A}=Tp(l,u),b=VG[l.componentType],_=GG[l.type],m=u.byteStride||b*_,v=new Float32Array(A);for(let T=0;T<l.count;T++){const w=new p(h,g+T*m,2);_c.set(w[0],w[1],1),_c.transformByMatrix3(s),v.set([_c[0],_c[1]],T*_)}r===i?YG(l,u,t.buffers,v):QG(i,l,e,t,v)}}}}function YG(t,e,n,r){t.componentType=5126,n.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=n.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function QG(t,e,n,r,i){r.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const s=r.json.bufferViews;if(!s)return;s.push({buffer:r.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const o=r.json.accessors;o&&(o.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),n.attributes["TEXCOORD_".concat(t)]=o.length-1)}function qG(t){const{offset:e=[0,0],rotation:n=0,scale:r=[1,1]}=t,i=new Se().set(1,0,0,0,1,0,e[0],e[1],1),s=HG.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),o=jG.set(r[0],0,0,0,r[1],0,0,0,1);return i.multiplyRight(s).multiplyRight(o)}const ZG=Object.freeze(Object.defineProperty({__proto__:null,decode:WG,name:zG},Symbol.toStringTag,{value:"Module"})),ni="KHR_lights_punctual",$G=ni;async function e4(t){const e=new mt(t),{json:n}=e,r=e.getExtension(ni);r&&(e.json.lights=r.lights,e.removeExtension(ni));for(const i of n.nodes||[]){const s=e.getObjectExtension(i,ni);s&&(i.light=s.light),e.removeObjectExtension(i,ni)}}async function t4(t){const e=new mt(t),{json:n}=e;if(n.lights){const r=e.addExtension(ni);wt(!r.lights),r.lights=n.lights,delete n.lights}if(e.json.lights){for(const r of e.json.lights){const i=r.node;e.addObjectExtension(i,ni,r)}delete e.json.lights}}const n4=Object.freeze(Object.defineProperty({__proto__:null,decode:e4,encode:t4,name:$G},Symbol.toStringTag,{value:"Module"})),na="KHR_materials_unlit",r4=na;async function i4(t){const e=new mt(t),{json:n}=e;for(const r of n.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,na);e.removeExtension(na)}function s4(t){const e=new mt(t),{json:n}=e;if(e.materials)for(const r of n.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,na,{}),e.addExtension(na))}const o4=Object.freeze(Object.defineProperty({__proto__:null,decode:i4,encode:s4,name:r4},Symbol.toStringTag,{value:"Module"})),po="KHR_techniques_webgl",a4=po;async function c4(t){const e=new mt(t),{json:n}=e,r=e.getExtension(po);if(r){const i=u4(r,e);for(const s of n.materials||[]){const o=e.getObjectExtension(s,po);o&&(s.technique=Object.assign({},o,i[o.technique]),s.technique.values=h4(s.technique,e)),e.removeObjectExtension(s,po)}e.removeExtension(po)}}async function l4(t,e){}function u4(t,e){const{programs:n=[],shaders:r=[],techniques:i=[]}=t,s=new TextDecoder;return r.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=s.decode(e.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(o=>{o.fragmentShader=r[o.fragmentShader],o.vertexShader=r[o.vertexShader]}),i.forEach(o=>{o.program=n[o.program]}),i}function h4(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(r=>{t.uniforms[r].value&&!(r in n)&&(n[r]=t.uniforms[r].value)}),Object.keys(n).forEach(r=>{typeof n[r]=="object"&&n[r].index!==void 0&&(n[r].texture=e.getTexture(n[r].index))}),n}const f4=Object.freeze(Object.defineProperty({__proto__:null,decode:c4,encode:l4,name:a4},Symbol.toStringTag,{value:"Module"})),xb="EXT_feature_metadata",d4=xb;async function g4(t){const e=new mt(t);p4(e)}function p4(t){var e;const n=t.getExtension(xb),r=n==null||(e=n.schema)===null||e===void 0?void 0:e.classes,i=n==null?void 0:n.featureTables;if((n==null?void 0:n.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),r&&i)for(const o in r){const a=r[o],c=y4(i,o);c&&m4(t,c,a)}}function m4(t,e,n){for(const i in n.properties){var r;const s=n.properties[i],o=e==null||(r=e.properties)===null||r===void 0?void 0:r[i],a=e.count;if(o){const c=_4(t,s,a,o);o.data=c}}}function _4(t,e,n,r){const i=r.bufferView;let s=t.getTypedArrayForBufferView(i);switch(e.type){case"STRING":{const o=r.stringOffsetBufferView,a=t.getTypedArrayForBufferView(o);s=v4(s,a,n);break}}return s}function y4(t,e){for(const n in t){const r=t[n];if(r.class===e)return r}return null}function v4(t,e,n){const r=[],i=new TextDecoder("utf8");let s=0;const o=4;for(let a=0;a<n;a++){const c=e[(a+1)*o]-e[a*o],l=t.subarray(s,c+s),u=i.decode(l);r.push(u),s+=c}return r}const A4=Object.freeze(Object.defineProperty({__proto__:null,decode:g4,name:d4},Symbol.toStringTag,{value:"Module"})),Bb=[rG,oG,lG,kG,n4,o4,f4,ZG,A4];function E4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=Bb.filter(s=>Ib(s.name,e));for(const s of r){var i;(i=s.preprocess)===null||i===void 0||i.call(s,t,e,n)}}async function T4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=Bb.filter(s=>Ib(s.name,e));for(const s of r){var i;await((i=s.decode)===null||i===void 0?void 0:i.call(s,t,e,n))}}function Ib(t,e){var n;const r=(e==null||(n=e.gltf)===null||n===void 0?void 0:n.excludeExtensions)||{};return!(t in r&&!r[t])}const Rh="KHR_binary_glTF";function b4(t){const e=new mt(t),{json:n}=e;for(const r of n.images||[]){const i=e.getObjectExtension(r,Rh);i&&Object.assign(r,i),e.removeObjectExtension(r,Rh)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(Rh)}const Wy={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},S4={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class w4{constructor(){d(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),d(this,"json",void 0)}normalize(e,n){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(r.asset.version));return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),b4(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const n in Wy)this._convertTopLevelObjectToArray(e,n)}_convertTopLevelObjectToArray(e,n){const r=e[n];if(!(!r||Array.isArray(r))){e[n]=[];for(const i in r){const s=r[i];s.id=s.id||i;const o=e[n].length;e[n].push(s),this.idToIndexMap[n][i]=o}}}_convertObjectIdsToArrayIndices(e){for(const n in Wy)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const n of e.textures)this._convertTextureIds(n);for(const n of e.meshes)this._convertMeshIds(n);for(const n of e.nodes)this._convertNodeIds(n);for(const n of e.scenes)this._convertSceneIds(n)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const n of e.primitives){const{attributes:r,indices:i,material:s}=n;for(const o in r)r[o]=this._convertIdToIndex(r[o],"accessor");i&&(n.indices=this._convertIdToIndex(i,"accessor")),s&&(n.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(n=>this._convertIdToIndex(n,"node"))),e.meshes&&(e.meshes=e.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(e,n){e[n]||(console.warn("gltf v1: json doesn't contain attribute ".concat(n)),e[n]=[]);for(const r of e[n])for(const i in r){const s=r[i],o=this._convertIdToIndex(s,i);r[i]=o}}_convertIdToIndex(e,n){const r=S4[n];if(r in this.idToIndexMap){const i=this.idToIndexMap[r][e];if(!Number.isFinite(i))throw new Error("gltf v1: failed to resolve ".concat(n," with id ").concat(e));return i}return e}_updateObjects(e){for(const n of this.json.buffers)delete n.type}_updateMaterial(e){for(const s of e.materials){var n,r,i;s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((n=s.values)===null||n===void 0?void 0:n.tex)||((r=s.values)===null||r===void 0?void 0:r.texture2d_0)||((i=s.values)===null||i===void 0?void 0:i.diffuseTex),a=e.textures.findIndex(c=>c.id===o);a!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:a})}}}function C4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new w4().normalize(t,e)}const x4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},B4={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Dt={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},I4={magFilter:Dt.TEXTURE_MAG_FILTER,minFilter:Dt.TEXTURE_MIN_FILTER,wrapS:Dt.TEXTURE_WRAP_S,wrapT:Dt.TEXTURE_WRAP_T},M4={[Dt.TEXTURE_MAG_FILTER]:Dt.LINEAR,[Dt.TEXTURE_MIN_FILTER]:Dt.NEAREST_MIPMAP_LINEAR,[Dt.TEXTURE_WRAP_S]:Dt.REPEAT,[Dt.TEXTURE_WRAP_T]:Dt.REPEAT};function R4(t){return B4[t]}function P4(t){return x4[t]}class L4{constructor(){d(this,"baseUri",""),d(this,"json",{}),d(this,"buffers",[]),d(this,"images",[])}postProcess(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:r,buffers:i=[],images:s=[],baseUri:o=""}=e;return wt(r),this.baseUri=o,this.json=r,this.buffers=i,this.images=s,this._resolveTree(this.json,n),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map((n,r)=>this._resolveBufferView(n,r))),e.images&&(e.images=e.images.map((n,r)=>this._resolveImage(n,r))),e.samplers&&(e.samplers=e.samplers.map((n,r)=>this._resolveSampler(n,r))),e.textures&&(e.textures=e.textures.map((n,r)=>this._resolveTexture(n,r))),e.accessors&&(e.accessors=e.accessors.map((n,r)=>this._resolveAccessor(n,r))),e.materials&&(e.materials=e.materials.map((n,r)=>this._resolveMaterial(n,r))),e.meshes&&(e.meshes=e.meshes.map((n,r)=>this._resolveMesh(n,r))),e.nodes&&(e.nodes=e.nodes.map((n,r)=>this._resolveNode(n,r))),e.skins&&(e.skins=e.skins.map((n,r)=>this._resolveSkin(n,r))),e.scenes&&(e.scenes=e.scenes.map((n,r)=>this._resolveScene(n,r))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,n){if(typeof n=="object")return n;const r=this.json[e]&&this.json[e][n];return r||console.warn("glTF file error: Could not find ".concat(e,"[").concat(n,"]")),r}_resolveScene(e,n){return e.id=e.id||"scene-".concat(n),e.nodes=(e.nodes||[]).map(r=>this.getNode(r)),e}_resolveNode(e,n){return e.id=e.id||"node-".concat(n),e.children&&(e.children=e.children.map(r=>this.getNode(r))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((r,i)=>{const s=this.getMesh(i);return r.id=s.id,r.primitives=r.primitives.concat(s.primitives),r},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,n){return e.id=e.id||"skin-".concat(n),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,n){return e.id=e.id||"mesh-".concat(n),e.primitives&&(e.primitives=e.primitives.map(r=>{r={...r};const i=r.attributes;r.attributes={};for(const s in i)r.attributes[s]=this.getAccessor(i[s]);return r.indices!==void 0&&(r.indices=this.getAccessor(r.indices)),r.material!==void 0&&(r.material=this.getMaterial(r.material)),r})),e}_resolveMaterial(e,n){if(e.id=e.id||"material-".concat(n),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const r=e.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,n){if(e.id=e.id||"accessor-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=R4(e.componentType),e.components=P4(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const r=e.bufferView.buffer,{ArrayType:i,byteLength:s}=Tp(e,e.bufferView),o=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+r.byteOffset;let a=r.arrayBuffer.slice(o,o+s);e.bufferView.byteStride&&(a=this._getValueFromInterleavedBuffer(r,o,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new i(a)}return e}_getValueFromInterleavedBuffer(e,n,r,i,s){const o=new Uint8Array(s*i);for(let a=0;a<s;a++){const c=n+a*r;o.set(new Uint8Array(e.arrayBuffer.slice(c,c+i)),a*i)}return o.buffer}_resolveTexture(e,n){return e.id=e.id||"texture-".concat(n),e.sampler="sampler"in e?this.getSampler(e.sampler):M4,e.source=this.getImage(e.source),e}_resolveSampler(e,n){e.id=e.id||"sampler-".concat(n),e.parameters={};for(const r in e){const i=this._enumSamplerParameter(r);i!==void 0&&(e.parameters[i]=e[r])}return e}_enumSamplerParameter(e){return I4[e]}_resolveImage(e,n){e.id=e.id||"image-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const r=this.images[n];return r&&(e.image=r),e}_resolveBufferView(e,n){const r=e.buffer,i={id:"bufferView-".concat(n),...e,buffer:this.buffers[r]},s=this.buffers[r].arrayBuffer;let o=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(o+=e.byteOffset),i.data=new Uint8Array(s,o,e.byteLength),i}_resolveCamera(e,n){return e.id=e.id||"camera-".concat(n),e.perspective,e.orthographic,e}}function O4(t,e){return new L4().postProcess(t,e)}const Jy=1735152710,Cp=12,Pl=8,D4=1313821514,F4=5130562,N4=0,U4=1,k4=0,ws=!0;function G4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}function V4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new DataView(t),{magic:i=Jy}=n,s=r.getUint32(e,!1);return s===i||s===Jy}function z4(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e),i=G4(r,n+0),s=r.getUint32(n+4,ws),o=r.getUint32(n+8,ws);switch(Object.assign(t,{header:{byteOffset:n,byteLength:o,hasBinChunk:!1},type:i,version:s,json:{},binChunks:[]}),n+=Cp,t.version){case 1:return H4(t,r,n);case 2:return j4(t,r,n,{});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}function H4(t,e,n){ce(t.header.byteLength>Cp+Pl);const r=e.getUint32(n+0,ws),i=e.getUint32(n+4,ws);return n+=Pl,ce(i===k4),Ed(t,e,n,r),n+=r,n+=Td(t,e,n,t.header.byteLength),n}function j4(t,e,n,r){return ce(t.header.byteLength>Cp+Pl),W4(t,e,n,r),n+t.header.byteLength}function W4(t,e,n,r){for(;n+8<=t.header.byteLength;){const i=e.getUint32(n+0,ws),s=e.getUint32(n+4,ws);switch(n+=Pl,s){case D4:Ed(t,e,n,i);break;case F4:Td(t,e,n,i);break;case N4:r.strict||Ed(t,e,n,i);break;case U4:r.strict||Td(t,e,n,i);break}n+=la(i,4)}return n}function Ed(t,e,n,r){const i=new Uint8Array(e.buffer,n,r),o=new TextDecoder("utf8").decode(i);return t.json=JSON.parse(o),la(r,4)}function Td(t,e,n,r){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:r,arrayBuffer:e.buffer}),la(r,4)}async function J4(t,e){var n,r,i,s;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;X4(t,e,o,a),C4(t,{normalize:a==null||(n=a.gltf)===null||n===void 0?void 0:n.normalize}),E4(t,a,c);const l=[];if(a!=null&&(r=a.gltf)!==null&&r!==void 0&&r.loadBuffers&&t.json.buffers&&await K4(t,a,c),a!=null&&(i=a.gltf)!==null&&i!==void 0&&i.loadImages){const h=Y4(t,a,c);l.push(h)}const u=T4(t,a,c);return l.push(u),await Promise.all(l),a!=null&&(s=a.gltf)!==null&&s!==void 0&&s.postProcess?O4(t,a):t}function X4(t,e,n,r){if(r.uri&&(t.baseUri=r.uri),e instanceof ArrayBuffer&&!V4(e,n,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=Cx(e);else if(e instanceof ArrayBuffer){const o={};n=z4(o,e,n,r.glb),wt(o.type==="glTF","Invalid GLB magic string ".concat(o.type)),t._glb=o,t.json=o.json}else wt(!1,"GLTF: must be ArrayBuffer or string");const i=t.json.buffers||[];if(t.buffers=new Array(i.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:o}=t._glb;t.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const s=t.json.images||[];t.images=new Array(s.length).fill({})}async function K4(t,e,n){const r=t.json.buffers||[];for(let o=0;o<r.length;++o){const a=r[o];if(a.uri){var i,s;const{fetch:c}=n;wt(c);const l=vb(a.uri,e),u=await(n==null||(i=n.fetch)===null||i===void 0?void 0:i.call(n,l)),h=await(u==null||(s=u.arrayBuffer)===null||s===void 0?void 0:s.call(u));t.buffers[o]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete a.uri}else t.buffers[o]===null&&(t.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function Y4(t,e,n){const r=Q4(t),i=t.json.images||[],s=[];for(const o of r)s.push(q4(t,i[o],o,e,n));return await Promise.all(s)}function Q4(t){const e=new Set,n=t.json.textures||[];for(const r of n)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function q4(t,e,n,r,i){const{fetch:s,parse:o}=i;let a;if(e.uri&&!e.hasOwnProperty("bufferView")){const l=vb(e.uri,r);a=await(await s(l)).arrayBuffer(),e.bufferView={data:a}}if(Number.isFinite(e.bufferView)){const l=Fk(t.json,t.buffers,e.bufferView);a=Cg(l.buffer,l.byteOffset,l.byteLength)}wt(a,"glTF image has no data");let c=await o(a,[bT,Dk],{mimeType:e.mimeType,basis:r.basis||{format:yb()}},i);c&&c[0]&&(c={compressed:!0,mipmaps:!1,width:c[0].width,height:c[0].height,data:c[0]}),t.images=t.images||[],t.images[n]=c}const ra={name:"glTF",id:"gltf",module:"gltf",version:yk,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Z4,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function Z4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;e={...ra.options,...e},e.gltf={...ra.options.gltf,...e.gltf};const{byteOffset:r=0}=e;return await J4({},t,r,e,n)}async function $4(t){const e=[];return t.scenes.forEach(n=>{n.traverse(r=>{Object.values(r.model.getUniforms()).forEach(i=>{i.loaded===!1&&e.push(i)})})}),await eV(()=>e.some(n=>!n.loaded))}async function eV(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const tV=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,nV=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,Mb=[255,255,255,255],rV={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Mb},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[ra]};class xp extends Vr{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){const e=[tu,lp];return this.props._lighting==="pbr"&&e.push(np),super.getShaders({vs:tV,fs:nV,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:Mb,transition:!0},instanceModelMatrix:ab})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;n.scenegraph!==r.scenegraph?this._updateScenegraph():n._animations!==r._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,n._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}_updateScenegraph(){const e=this.props,{gl:n}=this.context;let r=null;if(e.scenegraph instanceof ls)r={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const a=e.scenegraph,c=_k(n,a,this._getModelOptions());r={gltf:a,...c},$4(c).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(q.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),r=e.scenegraph);const i={layer:this,gl:n},s=e.getScene(r,i),o=e.getAnimator(r,i);s instanceof ls?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,o,e._animations),this.setState({scenegraph:s,animator:o})):s!==null&&q.warn("invalid scenegraph:",s)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const n=this.getAttributeManager().getAttributes();e.traverse(r=>{this._setModelAttributes(r.model,n)})}}_applyAnimationsProp(e,n,r){if(!e||!n||!r)return;const i=n.getAnimations();Object.keys(r).sort().forEach(s=>{const o=r[s];if(s==="*")i.forEach(a=>{Object.assign(a,o)});else if(Number.isFinite(Number(s))){const a=Number(s);a>=0&&a<i.length?Object.assign(i[a],o):q.warn("animation ".concat(s," not found"))()}else{const a=i.find(({name:c})=>c===s);a?Object.assign(a,o):q.warn("animation ".concat(s," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof ls&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let n=null;return e&&(typeof e=="function"?n=e({gl:this.context.gl,layer:this}):n=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:n,modelOptions:{isInstanced:!0,transpileToGLSL100:!J(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(n=>{this._setModelAttributes(n.model,e)})}draw({moduleParameters:e=null,parameters:n={},context:r}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(r.timeline.getTime()),this.setNeedsRedraw());const{viewport:i}=this.context,{sizeScale:s,sizeMinPixels:o,sizeMaxPixels:a,opacity:c,coordinateSystem:l}=this.props,u=this.getNumInstances();this.state.scenegraph.traverse((h,{worldMatrix:f})=>{h.model.setInstanceCount(u),h.updateModuleSettings(e),h.draw({parameters:n,uniforms:{sizeScale:s,opacity:c,sizeMinPixels:o,sizeMaxPixels:a,composeModelMatrix:cb(i,l),sceneModelMatrix:f,u_Camera:h.model.getUniforms().project_uCameraPosition}})})}}d(xp,"defaultProps",rV);d(xp,"layerName","ScenegraphLayer");const iV=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,sV=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function oV(t){t.COLOR_0||t.colors||(t.colors={constant:!0,value:new Float32Array([1,1,1])})}const aV={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class Bp extends Ep{getShaders(){const e=super.getShaders();return e.modules.push(np),{...e,vs:iV,fs:sV}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const n=this.getAttributeManager();e&&n.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;n.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(n.pbrMaterial)}draw(e){const{featureIds:n}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!n}),super.draw(e))}getModel(e){const{id:n,pbrMaterial:r}=this.props,i=this.parseMaterial(r,e);this.setState({materialParser:i});const s=this.getShaders();return oV(e.attributes),new di(this.context.gl,{...this.getShaders(),id:n,geometry:e,defines:{...s.defines,...i==null?void 0:i.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:i==null?void 0:i.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:n}=this.state;if(n){const{mesh:r}=this.props,i=this.parseMaterial(e,r);this.setState({materialParser:i}),n.setUniforms(i.uniforms)}}parseMaterial(e,n){var r;const i=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(r=this.state.materialParser)===null||r===void 0||r.delete(),new pb(this.context.gl,{attributes:{NORMAL:n.attributes.normals,TEXCOORD_0:n.attributes.texCoords},material:{unlit:i,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const n=this.props.featureIds,r=new Uint8ClampedArray(n.length*e.size),i=[];for(let s=0;s<n.length;s++)this.encodePickingColor(n[s],i),r[s*3]=i[0],r[s*3+1]=i[1],r[s*3+2]=i[2];e.value=r}finalizeState(e){var n;super.finalizeState(e),(n=this.state.materialParser)===null||n===void 0||n.delete(),this.setState({materialParser:null})}}d(Bp,"layerName","MeshLayer");d(Bp,"defaultProps",aV);const cV=6378137,lV=6378137,uV=6356752314245179e-9;function su(t){return t}new C;function hV(t,e=[],n=su){return"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):"x"in t?(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function fV(t,e=[]){return hV(t,e,Le._cartographicRadians?su:F2)}function dV(t,e,n=su){return"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):"x"in e?(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function gV(t,e){return dV(t,e,Le._cartographicRadians?su:N2)}const Oi=new C,pV=new C,mV=new C;function _V(t,e,n=[]){const{oneOverRadii:r,oneOverRadiiSquared:i,centerToleranceSquared:s}=e;Oi.from(t);const o=Oi.x,a=Oi.y,c=Oi.z,l=r.x,u=r.y,h=r.z,f=o*o*l*l,g=a*a*u*u,p=c*c*h*h,A=f+g+p,b=Math.sqrt(1/A);if(!Number.isFinite(b))return;const _=pV;if(_.copy(t).scale(b),A<s)return _.to(n);const m=i.x,v=i.y,T=i.z,w=mV;w.set(_.x*m*2,_.y*v*2,_.z*T*2);let x=(1-b)*Oi.len()/(.5*w.len()),I=0,M,L,R,z;do{x-=I,M=1/(1+x*m),L=1/(1+x*v),R=1/(1+x*T);const te=M*M,ne=L*L,X=R*R,Rt=te*M,Pn=ne*L,dn=X*R;z=f*te+g*ne+p*X-1;const H=-2*(f*Rt*m+g*Pn*v+p*dn*T);I=z/H}while(Math.abs(z)>$o.EPSILON12);return Oi.scale([M,L,R]).to(n)}const Xy=1e-14,yV=new C,Ky={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Ph={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},so={east:new C,north:new C,up:new C,west:new C,south:new C,down:new C},vV=new C,AV=new C,EV=new C;function Yy(t,e,n,r,i,s){const o=Ky[e]&&Ky[e][n];rn(o&&(!r||r===o));let a,c,l;const u=yV.copy(i);if(ln(u.x,0,Xy)&&ln(u.y,0,Xy)){const f=Math.sign(u.z);a=vV.fromArray(Ph[e]),e!=="east"&&e!=="west"&&a.scale(f),c=AV.fromArray(Ph[n]),n!=="east"&&n!=="west"&&c.scale(f),l=EV.fromArray(Ph[r]),r!=="east"&&r!=="west"&&l.scale(f)}else{const{up:f,east:g,north:p}=so;g.set(-u.y,u.x,0).normalize(),t.geodeticSurfaceNormal(u,f),p.copy(f).cross(g);const{down:A,west:b,south:_}=so;A.copy(f).scale(-1),b.copy(g).scale(-1),_.copy(p).scale(-1),a=so[e],c=so[n],l=so[r]}return s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=0,s[4]=c.x,s[5]=c.y,s[6]=c.z,s[7]=0,s[8]=l.x,s[9]=l.y,s[10]=l.z,s[11]=0,s[12]=u.x,s[13]=u.y,s[14]=u.z,s[15]=1,s}const yc=new C,Qy=new C,TV=new C,Zt=new C,bV=new C,vc=new C;class ye{constructor(e=0,n=0,r=0){d(this,"radii",void 0),d(this,"radiiSquared",void 0),d(this,"radiiToTheFourth",void 0),d(this,"oneOverRadii",void 0),d(this,"oneOverRadiiSquared",void 0),d(this,"minimumRadius",void 0),d(this,"maximumRadius",void 0),d(this,"centerToleranceSquared",$o.EPSILON1),d(this,"squaredXOverSquaredZ",void 0),rn(e>=0),rn(n>=0),rn(r>=0),this.radii=new C(e,n,r),this.radiiSquared=new C(e*e,n*n,r*r),this.radiiToTheFourth=new C(e*e*e*e,n*n*n*n,r*r*r*r),this.oneOverRadii=new C(e===0?0:1/e,n===0?0:1/n,r===0?0:1/r),this.oneOverRadiiSquared=new C(e===0?0:1/(e*e),n===0?0:1/(n*n),r===0?0:1/(r*r)),this.minimumRadius=Math.min(e,n,r),this.maximumRadius=Math.max(e,n,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,n=[0,0,0]){const r=Qy,i=TV,[,,s]=e;this.geodeticSurfaceNormalCartographic(e,r),i.copy(this.radiiSquared).scale(r);const o=Math.sqrt(r.dot(i));return i.scale(1/o),r.scale(s),i.add(r),i.to(n)}cartesianToCartographic(e,n=[0,0,0]){vc.from(e);const r=this.scaleToGeodeticSurface(vc,Zt);if(!r)return;const i=this.geodeticSurfaceNormal(r,Qy),s=bV;s.copy(vc).subtract(r);const o=Math.atan2(i.y,i.x),a=Math.asin(i.z),c=Math.sign(qg(s,vc))*l1(s);return gV([o,a,c],n)}eastNorthUpToFixedFrame(e,n=new Y){return Yy(this,"east","north","up",e,n)}localFrameToFixedFrame(e,n,r,i,s=new Y){return Yy(this,e,n,r,i,s)}geocentricSurfaceNormal(e,n=[0,0,0]){return yc.from(e).normalize().to(n)}geodeticSurfaceNormalCartographic(e,n=[0,0,0]){const r=fV(e),i=r[0],s=r[1],o=Math.cos(s);return yc.set(o*Math.cos(i),o*Math.sin(i),Math.sin(s)).normalize(),yc.to(n)}geodeticSurfaceNormal(e,n=[0,0,0]){return yc.from(e).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(e,n){return _V(e,this,n)}scaleToGeocentricSurface(e,n=[0,0,0]){Zt.from(e);const r=Zt.x,i=Zt.y,s=Zt.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(r*r*o.x+i*i*o.y+s*s*o.z);return Zt.multiplyScalar(a).to(n)}transformPositionToScaledSpace(e,n=[0,0,0]){return Zt.from(e).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(e,n=[0,0,0]){return Zt.from(e).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(e,n=0,r=[0,0,0]){rn(ln(this.radii.x,this.radii.y,$o.EPSILON15)),rn(this.radii.z>0),Zt.from(e);const i=Zt.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-n))return Zt.set(0,0,i).to(r)}}d(ye,"WGS84",new ye(cV,lV,uV));function qy(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Zy{constructor(e,n){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=qy(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(qy()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class SV{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof Zy?i=e:i=new Zy(n,r),this.stats[n]=i),i}}class wV{constructor(e,n,r){d(this,"item",void 0),d(this,"previous",void 0),d(this,"next",void 0),this.item=e,this.previous=n,this.next=r}}class CV{constructor(){d(this,"head",null),d(this,"tail",null),d(this,"_length",0)}get length(){return this._length}add(e){const n=new wV(e,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,n){e!==n&&(this.remove(n),this._insert(e,n))}_insert(e,n){const r=e.next;e.next=n,this.tail===e?this.tail=n:r.previous=n,n.next=r,n.previous=e,++this._length}}class xV{constructor(){d(this,"_list",void 0),d(this,"_sentinel",void 0),d(this,"_trimTiles",void 0),this._list=new CV,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const n=e._cacheNode;n&&this._list.splice(this._sentinel,n)}add(e,n,r){n._cacheNode||(n._cacheNode=this._list.add(n),r&&r(e,n))}unloadTile(e,n,r){const i=n._cacheNode;i&&(this._list.remove(i),n._cacheNode=null,r&&r(e,n))}unloadTiles(e,n){const r=this._trimTiles;this._trimTiles=!1;const i=this._list,s=e.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=i.head;for(;a!==o&&(e.gpuMemoryUsageInBytes>s||r);){const c=a.item;a=a.next,this.unloadTile(e,c,n)}}trim(){this._trimTiles=!0}}function BV(t,e){ce(t),ce(e);const{rtcCenter:n,gltfUpAxis:r}=e,{computedTransform:i,boundingVolume:{center:s}}=t;let o=new Y(i);switch(n&&o.translate(n),r){case"Z":break;case"Y":const h=new Y().rotateX(Math.PI/2);o=o.multiplyRight(h);break;case"X":const f=new Y().rotateY(-Math.PI/2);o=o.multiplyRight(f);break}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new C(s);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const c=ye.WGS84.cartesianToCartographic(a,new C),u=ye.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=u.multiplyRight(o),e.cartographicOrigin=c,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const $y=new C,Lh=new C,bd=new Vt([new nn,new nn,new nn,new nn,new nn,new nn]);function IV(t,e){const{cameraDirection:n,cameraUp:r,height:i}=t,{metersPerUnit:s}=t.distanceScales,o=zc(t,t.center),a=ye.WGS84.eastNorthUpToFixedFrame(o),c=t.unprojectPosition(t.cameraPosition),l=ye.WGS84.cartographicToCartesian(c,new C),u=new C(a.transformAsVector(new C(n).scale(s))).normalize(),h=new C(a.transformAsVector(new C(r).scale(s))).normalize();RV(t);const f=t.constructor,{longitude:g,latitude:p,width:A,bearing:b,zoom:_}=t,m=new f({longitude:g,latitude:p,height:i,width:A,bearing:b,zoom:_,pitch:0});return{camera:{position:l,direction:u,up:h},viewport:t,topDownViewport:m,height:i,cullingVolume:bd,frameNumber:e,sseDenominator:1.15}}function MV(t,e,n){if(n===0||t.length<=n)return[t,[]];const r=[],{longitude:i,latitude:s}=e.viewport;for(const[l,u]of t.entries()){const[h,f]=u.header.mbs,g=Math.abs(i-h),p=Math.abs(s-f),A=Math.sqrt(p*p+g*g);r.push([l,A])}const o=r.sort((l,u)=>l[1]-u[1]),a=[];for(let l=0;l<n;l++)a.push(t[o[l][0]]);const c=[];for(let l=n;l<o.length;l++)c.push(t[o[l][0]]);return[a,c]}function RV(t){const e=t.getFrustumPlanes(),n=ev(e.near,t.cameraPosition),r=zc(t,n),i=zc(t,t.cameraPosition,Lh);let s=0;bd.planes[s++].fromPointNormal(r,$y.copy(r).subtract(i));for(const o in e){if(o==="near")continue;const a=e[o],c=ev(a,n,Lh),l=zc(t,c,Lh);bd.planes[s++].fromPointNormal(l,$y.copy(r).subtract(l))}}function ev(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new C;const r=t.normal.dot(e);return n.copy(t.normal).scale(t.distance-r).add(e),n}function zc(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new C;const r=t.unprojectPosition(e);return ye.WGS84.cartographicToCartesian(r,n)}const PV=6378137,LV=6378137,Sd=6356752314245179e-9,tv=new C;function OV(t,e){if(t instanceof Ea){const{halfAxes:n}=t,r=FV(n);return Math.log2(Sd/(r+e[2]))}else if(t instanceof Aa){const{radius:n}=t;return Math.log2(Sd/(n+e[2]))}else if(t.width&&t.height){const{width:n,height:r}=t,i=Math.log2(PV/n),s=Math.log2(LV/r);return(i+s)/2}return 1}function Rb(t,e,n){const r=ye.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],new C),i=Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)+Math.pow(r[2]-n[2],2));return Math.log2(Sd/(i+e[2]))}function DV(t,e,n){const[r,i,s,o]=t;return Rb({xmin:r,xmax:s,ymin:i,ymax:o,zmin:0,zmax:0},e,n)}function FV(t){t.getColumn(0,tv);const e=t.getColumn(1),n=t.getColumn(2);return tv.add(e).add(n).len()}const At={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Qn={ADD:1,REPLACE:2},us={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Ot={I3S:"I3S",TILES3D:"TILES3D"},ou={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},NV={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function Pb(t){return t!=null}const Ye=new C,Hc=new C,UV=new C,kV=new C;function Oh(t,e,n){if(ce(t,"3D Tile: boundingVolume must be defined"),t.box)return VV(t.box,e,n);if(t.region){const[r,i,s,o,a,c]=t.region,l=ye.WGS84.cartographicToCartesian([Wn(r),Wn(o),a],UV),u=ye.WGS84.cartographicToCartesian([Wn(s),Wn(i),c],kV),h=new C().addVectors(l,u).multiplyScalar(.5),f=new C().subVectors(l,u).len()/2;return nv([h[0],h[1],h[2],f],new Y)}if(t.sphere)return nv(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function GV(t,e){if(t.box)return zV(e);if(t.region){const[n,r,i,s,o,a]=t.region;return[[Wn(n),Wn(r),o],[Wn(i),Wn(s),a]]}if(t.sphere)return HV(e);throw new Error("Unkown boundingVolume type")}function VV(t,e,n){const r=new C(t[0],t[1],t[2]);e.transform(r,r);let i=[];if(t.length===10){const l=t.slice(3,6),u=new Zo;u.fromArray(t,6);const h=new C([1,0,0]),f=new C([0,1,0]),g=new C([0,0,1]);h.transformByQuaternion(u),h.scale(l[0]),f.transformByQuaternion(u),f.scale(l[1]),g.transformByQuaternion(u),g.scale(l[2]),i=[...h.toArray(),...f.toArray(),...g.toArray()]}else i=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const s=e.transformAsVector(i.slice(0,3)),o=e.transformAsVector(i.slice(3,6)),a=e.transformAsVector(i.slice(6,9)),c=new Se([s[0],s[1],s[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return Pb(n)?(n.center=r,n.halfAxes=c,n):new Ea(r,c)}function nv(t,e,n){const r=new C(t[0],t[1],t[2]);e.transform(r,r);const i=e.getScale(Hc),s=Math.max(Math.max(i[0],i[1]),i[2]),o=t[3]*s;return Pb(n)?(n.center=r,n.radius=o,n):new Aa(r,o)}function zV(t){const e=Lb(),{halfAxes:n}=t,r=new C(n.getColumn(0)),i=new C(n.getColumn(1)),s=new C(n.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let c=0;c<2;c++)Ye.copy(t.center),Ye.add(r),Ye.add(i),Ye.add(s),Ob(e,Ye),s.negate();i.negate()}r.negate()}return e}function HV(t){const e=Lb(),{center:n,radius:r}=t,i=ye.WGS84.scaleToGeodeticSurface(n,Ye);let s;i?s=ye.WGS84.geodeticSurfaceNormal(i):s=new C(0,0,1);let o=new C(s[2],-s[1],0);o.len()>0?o.normalize():o=new C(0,1,0);const a=o.clone().cross(s);for(const c of[o,a,s]){Hc.copy(c).scale(r);for(let l=0;l<2;l++)Ye.copy(n),Ye.add(Hc),Ob(e,Ye),Hc.negate()}return e}function Lb(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function Ob(t,e){ye.WGS84.cartesianToCartographic(e,Ye),t[0][0]=Math.min(t[0][0],Ye[0]),t[0][1]=Math.min(t[0][1],Ye[1]),t[0][2]=Math.min(t[0][2],Ye[2]),t[1][0]=Math.max(t[1][0],Ye[0]),t[1][1]=Math.max(t[1][1],Ye[1]),t[1][2]=Math.max(t[1][2],Ye[2])}new C;new C;new Y;new C;new C;new C;function jV(t,e){const n=t*e;return 1-Math.exp(-(n*n))}function WV(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const n=t.dynamicScreenSpaceErrorComputedDensity,r=t.dynamicScreenSpaceErrorFactor;return jV(e,n)*r}return 0}function JV(t,e,n){const r=t.tileset,i=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,s=n?i:t.lodMetricValue;if(s===0)return 0;const o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:c}=e,{viewDistanceScale:l}=r.options;let u=s*a*(l||1)/(o*c);return u-=WV(r,o),u}const Dh=new C,rv=new C,mr=new C,iv=new C,XV=new C,Fh=new Y,sv=new Y;function KV(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const n=2*Db(t,e);return n<2?"OUT":!t.header.children||n<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function Db(t,e){const{topDownViewport:n}=e,r=t.header.mbs[1],i=t.header.mbs[0],s=t.header.mbs[2],o=t.header.mbs[3],a=[...t.boundingVolume.center],c=n.unprojectPosition(n.cameraPosition);ye.WGS84.cartographicToCartesian(c,Dh),rv.copy(Dh).subtract(a).normalize(),ye.WGS84.eastNorthUpToFixedFrame(a,Fh),sv.copy(Fh).invert(),mr.copy(Dh).transform(sv);const l=Math.sqrt(mr[0]*mr[0]+mr[1]*mr[1]),u=l*l/mr[2];iv.copy([mr[0],mr[1],u]);const f=iv.transform(Fh).subtract(a).normalize(),p=rv.cross(f).normalize().scale(o).add(a),A=ye.WGS84.cartesianToCartographic(p),b=n.project([i,r,s]),_=n.project(A);return XV.copy(b).subtract(_).magnitude()}function YV(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class ov{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;d(this,"_map",new Map),d(this,"_array",void 0),d(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return ce(e<this._array.length),this._array[e]}set(e,n){ce(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=n,this._map.set(n,e)}delete(e){const n=this._map.get(e);n>=0&&(this._array.splice(n,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const n=this.length++;this._array[n]=e,this._map.set(e,n)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){ce(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){ce(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const QV={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class au{traversalFinished(e){return!0}constructor(e){d(this,"options",void 0),d(this,"root",null),d(this,"selectedTiles",{}),d(this,"requestedTiles",{}),d(this,"emptyTiles",{}),d(this,"lastUpdate",new Date().getTime()),d(this,"updateDebounceTime",1e3),d(this,"_traversalStack",new ov),d(this,"_emptyTraversalStack",new ov),d(this,"_frameNumber",null),this.options={...QV,...e}}traverse(e,n,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,n),this._frameNumber=n.frameNumber,this.executeTraversal(e,n)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,n){const r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){const s=r.pop();let o=!1;this.canTraverse(s,n)&&(this.updateChildTiles(s,n),o=this.updateAndPushChildren(s,n,r,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const a=s.parent,c=!!(!a||a._shouldRefine),l=!o;s.hasRenderContent?s.refine===Qn.ADD?(this.loadTile(s,n),this.selectTile(s,n)):s.refine===Qn.REPLACE&&(this.loadTile(s,n),l&&this.selectTile(s,n)):(this.emptyTiles[s.id]=s,this.loadTile(s,n),l&&this.selectTile(s,n)),this.touchTile(s,n),s._shouldRefine=o&&c}const i=new Date().getTime();(this.traversalFinished(n)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(n))}updateChildTiles(e,n){const r=e.children;for(const i of r)this.updateTile(i,n)}updateAndPushChildren(e,n,r,i){const{loadSiblings:s,skipLevelOfDetail:o}=this.options,a=e.children;a.sort(this.compareDistanceToCamera.bind(this));const c=e.refine===Qn.REPLACE&&e.hasRenderContent&&!o;let l=!1,u=!0;for(const h of a)if(h._selectionDepth=i,h.isVisibleAndInRequestVolume?(r.find(h)&&r.delete(h),r.push(h),l=!0):(c||s)&&(this.loadTile(h,n),this.touchTile(h,n)),c){let f;if(h._inRequestVolume?h.hasRenderContent?f=h.contentAvailable:f=this.executeEmptyTraversal(h,n):f=!1,u=u&&f,!u)return!1}return l||(u=!1),u}updateTile(e,n){this.updateTileVisibility(e,n)}selectTile(e,n){this.shouldSelectTile(e)&&(e._selectedFrame=n.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,n){this.shouldLoadTile(e)&&(e._requestedFrame=n.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,n){e.tileset._cache.touch(e),e._touchedFrame=n.frameNumber}canTraverse(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!i&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,n,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=e._screenSpaceError;return r&&(i=e.getScreenSpaceError(n,!0)),i>this.options.maximumScreenSpaceError}updateTileVisibility(e,n){const r=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===n.viewport.id&&r.push(i);else r.push(n.viewport.id);e.updateVisibility(n,r)}compareDistanceToCamera(e,n){return e._distanceToCamera-n._distanceToCamera}anyChildrenVisible(e,n){let r=!1;for(const i of e.children)i.updateVisibility(n),r=r||i.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,n){let r=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0&&r;){const s=i.pop();if(this.updateTile(s,n),s.isVisibleAndInRequestVolume||this.loadTile(s,n),this.touchTile(s,n),!s.hasRenderContent&&this.canTraverse(s,n,!1,!0)){const a=s.children;for(const c of a)i.find(c)&&i.delete(c),i.push(c)}else!s.contentAvailable&&!s.hasEmptyContent&&(r=!1)}return r}}const av=new C;function qV(t){return t!=null}class wd{constructor(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";d(this,"tileset",void 0),d(this,"header",void 0),d(this,"id",void 0),d(this,"url",void 0),d(this,"parent",void 0),d(this,"refine",void 0),d(this,"type",void 0),d(this,"contentUrl",void 0),d(this,"lodMetricType","geometricError"),d(this,"lodMetricValue",0),d(this,"boundingVolume",null),d(this,"content",null),d(this,"contentState",At.UNLOADED),d(this,"gpuMemoryUsageInBytes",0),d(this,"children",[]),d(this,"depth",0),d(this,"viewportIds",[]),d(this,"transform",new Y),d(this,"extensions",null),d(this,"implicitTiling",null),d(this,"userData",{}),d(this,"computedTransform",void 0),d(this,"hasEmptyContent",!1),d(this,"hasTilesetContent",!1),d(this,"traverser",new au({})),d(this,"_cacheNode",null),d(this,"_frameNumber",null),d(this,"_expireDate",null),d(this,"_expiredContent",null),d(this,"_boundingBox",void 0),d(this,"_distanceToCamera",0),d(this,"_screenSpaceError",0),d(this,"_visibilityPlaneMask",void 0),d(this,"_visible",void 0),d(this,"_contentBoundingVolume",void 0),d(this,"_viewerRequestVolume",void 0),d(this,"_initialTransform",new Y),d(this,"_priority",0),d(this,"_selectedFrame",0),d(this,"_requestedFrame",0),d(this,"_selectionDepth",0),d(this,"_touchedFrame",0),d(this,"_centerZDepth",0),d(this,"_shouldRefine",!1),d(this,"_stackLength",0),d(this,"_visitedFrame",0),d(this,"_inRequestVolume",!1),d(this,"_lodJudge",null),this.header=n,this.tileset=e,this.id=i||n.id,this.url=n.url,this.parent=r,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===At.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===At.UNLOADED}get contentExpired(){return this.contentState===At.EXPIRED}get contentFailed(){return this.contentState===At.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=GV(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,n){switch(this.tileset.type){case Ot.I3S:return Db(this,e);case Ot.TILES3D:return JV(this,e,n);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:n}=e.options,r=this.refine===Qn.ADD||n;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===At.UNLOADED)return-1;const i=this.parent,o=i&&(!r||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,a=e.root?e.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=At.LOADING;const n=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!n)return this.contentState=At.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,s={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await Fr(r,i,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=At.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=At.FAILED,r}finally{n.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=At.UNLOADED,!0}updateVisibility(e,n){if(this._frameNumber===e.frameNumber)return;const r=this.parent,i=r?r._visibilityPlaneMask:Vt.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==Vt.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=n}visibility(e,n){const{cullingVolume:r}=e,{boundingVolume:i}=this;return r.computeVisibilityWithPlaneMask(i,n)}contentVisibility(){return!0}distanceToTile(e){const n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:n}=e;const r=this.boundingVolume;return av.subVectors(r.center,n.position),n.direction.dot(av)}insideViewerRequestVolume(e){const n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(qV(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=At.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Y(e.transform):new Y;const n=this.parent,r=this.tileset,i=n&&n.computedTransform?n.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new Y(i).multiplyRight(this.transform);const s=n&&n._initialTransform?n._initialTransform.clone():new Y;this._initialTransform=new Y(s).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=At.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Vt.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Qn.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=Oh(e.boundingVolume,this.computedTransform,this.boundingVolume);const n=e.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=Oh(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=Oh(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const n=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Y).clone().multiplyRight(this.transform);n.equals(this.computedTransform)||(this.computedTransform=n,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return YV(this.tileset.tileset)}}}class ZV extends au{compareDistanceToCamera(e,n){return n._distanceToCamera===0&&e._distanceToCamera===0?n._centerZDepth-e._centerZDepth:n._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,n){if(super.updateTileVisibility(e,n),!e.isVisibleAndInRequestVolume)return;const r=e.children.length>0;if(e.hasTilesetContent&&r){const o=e.children[0];this.updateTileVisibility(o,n),e._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(e,n)){e._visible=!1;return}const i=e.refine===Qn.REPLACE,s=e._optimChildrenWithinParent===NV.USE_OPTIMIZATION;if(i&&s&&r&&!this.anyChildrenVisible(e,n)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,n){const{parent:r}=e;return!r||r.hasTilesetContent||r.refine!==Qn.ADD?!1:!this.shouldRefine(e,n,!0)}}class $V{constructor(){d(this,"frameNumberMap",new Map)}register(e,n){const r=this.frameNumberMap.get(e)||new Map,i=r.get(n)||0;r.set(n,i+1),this.frameNumberMap.set(e,r)}deregister(e,n){const r=this.frameNumberMap.get(e);if(!r)return;const i=r.get(n)||1;r.set(n,i-1)}isZero(e,n){var r;return(((r=this.frameNumberMap.get(e))===null||r===void 0?void 0:r.get(n))||0)===0}}const Nh={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class e6{constructor(){d(this,"_statusMap",void 0),d(this,"pendingTilesRegister",new $V),this._statusMap={}}add(e,n,r,i){if(!this._statusMap[n]){const{frameNumber:s,viewport:{id:o}}=i;this._statusMap[n]={request:e,callback:r,key:n,frameState:i,status:Nh.REQUESTED},this.pendingTilesRegister.register(o,s),e().then(a=>{this._statusMap[n].status=Nh.COMPLETED;const{frameNumber:c,viewport:{id:l}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(l,c),this._statusMap[n].callback(a,i)}).catch(a=>{this._statusMap[n].status=Nh.ERROR;const{frameNumber:c,viewport:{id:l}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(l,c),r(a)})}}update(e,n){if(this._statusMap[e]){const{frameNumber:r,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,r);const{frameNumber:s,viewport:{id:o}}=n;this.pendingTilesRegister.register(o,s),this._statusMap[e].frameState=n}}find(e){return this._statusMap[e]}hasPendingTiles(e,n){return!this.pendingTilesRegister.isZero(e,n)}}class t6 extends au{constructor(e){super(e),d(this,"_tileManager",void 0),this._tileManager=new e6}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,n){return e._lodJudge=KV(e,n),e._lodJudge==="DIG"}updateChildTiles(e,n){const r=e.header.children||[],i=e.children,s=e.tileset;for(const o of r){const a="".concat(o.id,"-").concat(n.viewport.id),c=i&&i.find(l=>l.id===a);if(c)c&&this.updateTile(c,n);else{let l=()=>this._loadTile(o.id,s);this._tileManager.find(a)?this._tileManager.update(a,n):(s.tileset.nodePages&&(l=()=>s.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(l,a,h=>this._onTileLoad(h,e,a),n))}}return!1}async _loadTile(e,n){const{loader:r}=n,i=n.getTileUrl("".concat(n.url,"/nodes/").concat(e)),s={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await Fr(i,r,s)}_onTileLoad(e,n,r){const i=new wd(n.tileset,e,n,r);n.children.push(i);const s=this._tileManager.find(i.id).frameState;this.updateTile(i,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,s)}}const n6={description:"",ellipsoid:ye.WGS84,modelMatrix:new Y,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Ac="Tiles In Tileset(s)",Uh="Tiles In Memory",cv="Tiles In View",lv="Tiles To Render",uv="Tiles Loaded",kh="Tiles Loading",hv="Tiles Unloaded",fv="Failed Tile Loads",dv="Points/Vertices",Gh="Tile Memory Use";class r6{constructor(e,n){d(this,"options",void 0),d(this,"loadOptions",void 0),d(this,"type",void 0),d(this,"tileset",void 0),d(this,"loader",void 0),d(this,"url",void 0),d(this,"basePath",void 0),d(this,"modelMatrix",void 0),d(this,"ellipsoid",void 0),d(this,"lodMetricType",void 0),d(this,"lodMetricValue",void 0),d(this,"refine",void 0),d(this,"root",null),d(this,"roots",{}),d(this,"asset",{}),d(this,"description",""),d(this,"properties",void 0),d(this,"extras",null),d(this,"attributions",{}),d(this,"credits",{}),d(this,"stats",void 0),d(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),d(this,"cartographicCenter",null),d(this,"cartesianCenter",null),d(this,"zoom",1),d(this,"boundingVolume",null),d(this,"dynamicScreenSpaceErrorComputedDensity",0),d(this,"maximumMemoryUsage",32),d(this,"gpuMemoryUsageInBytes",0),d(this,"_frameNumber",0),d(this,"_queryParams",{}),d(this,"_extensionsUsed",[]),d(this,"_tiles",{}),d(this,"_pendingCount",0),d(this,"selectedTiles",[]),d(this,"traverseCounter",0),d(this,"geometricError",0),d(this,"lastUpdatedVieports",null),d(this,"_requestedTiles",[]),d(this,"_emptyTiles",[]),d(this,"frameStateData",{}),d(this,"_traverser",void 0),d(this,"_cache",new xV),d(this,"_requestScheduler",void 0),d(this,"updatePromise",null),d(this,"tilesetInitializationPromise",void 0),this.options={...n6,...n},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||xg(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Ux({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new SV({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(n=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),n(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const n=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;const r=[];for(const i of n){const s=i.id;this._needTraverse(s)?r.push(s):this.traverseCounter--}for(const i of n){const s=i.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!r.includes(s))continue;const o=IV(i,this._frameNumber);this._traverser.traverse(this.roots[s],o,this.options)}}_needTraverse(e){let n=e;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[e]),n===e}_onTraversalEnd(e){const n=e.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[n],i=Object.values(this._traverser.selectedTiles),[s,o]=MV(i,e,this.options.maximumTilesSelected);r.selectedTiles=s;for(const a of o)a.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const n=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,n){if(e.length!==n.length)return!0;const r=new Set(e.map(o=>o.id)),i=new Set(n.map(o=>o.id));let s=e.filter(o=>!i.has(o.id)).length>0;return s=s||n.filter(o=>!r.has(o.id)).length>0,s}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,n)=>e._unloadTile(n))}_updateStats(){let e=0,n=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(e++,r.content.pointCount?n+=r.content.pointCount:n+=r.content.vertexCount);this.stats.get(cv).count=this.selectedTiles.length,this.stats.get(lv).count=e,this.stats.get(dv).count=n}async _initializeTileSet(e){this.type===Ot.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Ot.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Ot.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const n=this.tileset.fullExtent;if(n){const{xmin:i,xmax:s,ymin:o,ymax:a,zmin:c,zmax:l}=n;this.cartographicCenter=new C(i+(s-i)/2,o+(a-o)/2,c+(l-c)/2),this.cartesianCenter=ye.WGS84.cartographicToCartesian(this.cartographicCenter,new C),this.zoom=Rb(n,this.cartographicCenter,this.cartesianCenter);return}const r=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(r){const[i,s,o,a]=r;this.cartographicCenter=new C(i+(o-i)/2,s+(a-s)/2,0),this.cartesianCenter=ye.WGS84.cartographicToCartesian(this.cartographicCenter,new C),this.zoom=DV(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new C,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:n}=e.boundingVolume;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new C,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?this.cartographicCenter=ye.WGS84.cartesianToCartographic(n,new C):this.cartographicCenter=new C(0,0,-ye.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=OV(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(Ac),this.stats.get(kh),this.stats.get(Uh),this.stats.get(cv),this.stats.get(lv),this.stats.get(uv),this.stats.get(hv),this.stats.get(fv),this.stats.get(dv),this.stats.get(Gh,"memory")}_initializeTileHeaders(e,n){const r=new wd(this,e.root,n);if(n&&(n.children.push(r),r.depth=n.depth+1),this.type===Ot.TILES3D){const s=[];for(s.push(r);s.length>0;){const o=s.pop();this.stats.get(Ac).incrementCount();const a=o.header.children||[];for(const c of a){var i;const l=new wd(this,c,o);if((i=l.contentUrl)!==null&&i!==void 0&&i.includes("?session=")){const h=new URL(l.contentUrl).searchParams.get("session");h&&(this._queryParams.session=h)}o.children.push(l),l.depth=o.depth+1,s.push(l)}}}return r}_initializeTraverser(){let e;switch(this.type){case Ot.TILES3D:e=ZV;break;case Ot.I3S:e=t6;break;default:e=au}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let n;try{this._onStartTileLoading(),n=await e.loadContent()}catch(r){this._onTileLoadError(e,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,n)}}_onTileLoadError(e,n){this.stats.get(fv).incrementCount();const r=n.message||n.toString(),i=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(r)),this.options.onTileError(e,r,i)}_onTileLoad(e,n){if(n){if(this.type===Ot.I3S){var r,i;const s=((r=this.tileset)===null||r===void 0||(i=r.nodePagesTile)===null||i===void 0?void 0:i.nodesInNodePages)||0;this.stats.get(Ac).reset(),this.stats.get(Ac).addCount(s)}e&&e.content&&BV(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===Ot.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Ot.TILES3D){var n;const{extensionsRemoved:r=[]}=((n=e.content)===null||n===void 0?void 0:n.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(kh).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(kh).decrementCount()}_addTileToCache(e){this._cache.add(this,e,n=>n._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(uv).incrementCount(),this.stats.get(Uh).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(Gh).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(Uh).decrementCount(),this.stats.get(hv).incrementCount(),this.stats.get(Gh).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const n=e.pop();for(const r of n.children)e.push(r);this._destroyTile(n)}this.root=null}_destroySubtree(e){const n=e,r=[];for(r.push(n);r.length>0;){e=r.pop();for(const i of e.children)r.push(i);e!==n&&this._destroyTile(e)}n.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const n=new URLSearchParams(e.queryString),r=Object.fromEntries(n.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const Fb="3.4.14",oo={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function Nb(t,e,n){ce(t instanceof ArrayBuffer);const r=new TextDecoder("utf8"),i=new Uint8Array(t,e,n);return r.decode(i)}function i6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=new DataView(t);return"".concat(String.fromCharCode(n.getUint8(e+0))).concat(String.fromCharCode(n.getUint8(e+1))).concat(String.fromCharCode(n.getUint8(e+2))).concat(String.fromCharCode(n.getUint8(e+3)))}const s6={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Be={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Z={...s6,...Be},Vh={[Be.DOUBLE]:Float64Array,[Be.FLOAT]:Float32Array,[Be.UNSIGNED_SHORT]:Uint16Array,[Be.UNSIGNED_INT]:Uint32Array,[Be.UNSIGNED_BYTE]:Uint8Array,[Be.BYTE]:Int8Array,[Be.SHORT]:Int16Array,[Be.INT]:Int32Array},o6={DOUBLE:Be.DOUBLE,FLOAT:Be.FLOAT,UNSIGNED_SHORT:Be.UNSIGNED_SHORT,UNSIGNED_INT:Be.UNSIGNED_INT,UNSIGNED_BYTE:Be.UNSIGNED_BYTE,BYTE:Be.BYTE,SHORT:Be.SHORT,INT:Be.INT},zh="Failed to convert GL type";class Bn{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const n in Vh)if(Vh[n]===e)return n;throw new Error(zh)}static fromName(e){const n=o6[e];if(!n)throw new Error(zh);return n}static getArrayType(e){switch(e){case Be.UNSIGNED_SHORT_5_6_5:case Be.UNSIGNED_SHORT_4_4_4_4:case Be.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const n=Vh[e];if(!n)throw new Error(zh);return n}}static getByteSize(e){return Bn.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Bn.getArrayType(e)}static createTypedArray(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;i===void 0&&(i=(n.byteLength-r)/Bn.getByteSize(e));const s=Bn.getArrayType(e);return new s(n,r,i)}}function a6(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(e))}function c6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=t>>11&31,r=t>>5&63,i=t&31;return e[0]=n<<3,e[1]=r<<2,e[2]=i<<3,e}new Qg;new C;new Qg;new Qg;function gv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return Jn(t,0,e)/e*2-1}function pv(t){return t<0?-1:1}function l6(t,e,n,r){if(a6(r),t<0||t>n||e<0||e>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(r.x=gv(t,n),r.y=gv(e,n),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const i=r.x;r.x=(1-Math.abs(r.y))*pv(i),r.y=(1-Math.abs(i))*pv(r.y)}return r.normalize()}function u6(t,e,n){return l6(t,e,255,n)}class Ip{constructor(e,n){d(this,"json",void 0),d(this,"buffer",void 0),d(this,"featuresLength",0),d(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=n}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Z.UNSIGNED_INT,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,n,r,1,i.byteOffset):i}getPropertyArray(e,n,r){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(n=Bn.fromName(i.componentType)),this._getTypedArrayFromBinary(e,n,r,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,n,i)}getProperty(e,n,r,i,s){const o=this.json[e];if(!o)return o;const a=this.getPropertyArray(e,n,r);if(r===1)return a[i];for(let c=0;c<r;++c)s[c]=a[r*i+c];return s}_getTypedArrayFromBinary(e,n,r,i,s){const o=this._cachedTypedArrays;let a=o[e];return a||(a=Bn.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+s,i*r),o[e]=a),a}_getTypedArrayFromArray(e,n,r){const i=this._cachedTypedArrays;let s=i[e];return s||(s=Bn.createTypedArray(n,r),i[e]=s),s}}const h6={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},f6={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},d6={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}};function g6(t,e,n,r){const{componentType:i}=t;ce(t.componentType);const s=typeof i=="string"?Bn.fromName(i):i,o=h6[t.type],a=f6[t.type],c=d6[t.type];return n+=t.byteOffset,{values:Bn.createTypedArray(s,e,n,o*r),type:s,size:o,unpacker:a,packer:c}}const wn=t=>t!==void 0;function p6(t,e,n){if(!e)return null;let r=t.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,r=i),r?m6(r,n):null}function m6(t,e){let n,r,i;const s=t.instancesLength,o=t.classes;let a=t.classIds,c=t.parentCounts,l=t.parentIds,u=s;wn(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,i=getBinaryAccessor(a),a=i.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,s));let h;if(wn(c))for(wn(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),c=i.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,s)),h=new Uint16Array(s),u=0,n=0;n<s;++n)h[n]=u,u+=c[n];wn(l)&&wn(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,i=getBinaryAccessor(l),l=i.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,u));const f=o.length;for(n=0;n<f;++n){const b=o[n].length,_=o[n].instances,m=getBinaryProperties(b,_,e);o[n].instances=combine(m,_)}const g=new Array(f).fill(0),p=new Uint16Array(s);for(n=0;n<s;++n)r=a[n],p[n]=g[r],++g[r];const A={classes:o,classIds:a,classIndexes:p,parentCounts:c,parentIndexes:h,parentIds:l};return v6(A),A}function ao(t,e,n){if(!t)return;const r=t.parentCounts;return t.parentIds?n(t,e):r>0?_6(t,e,n):y6(t,e,n)}function _6(t,e,n){const r=t.classIds,i=t.parentCounts,s=t.parentIds,o=t.parentIndexes,a=r.length,c=scratchVisited;c.length=Math.max(c.length,a);const l=++marker,u=scratchStack;for(u.length=0,u.push(e);u.length>0;){if(e=u.pop(),c[e]===l)continue;c[e]=l;const h=n(t,e);if(wn(h))return h;const f=i[e],g=o[e];for(let p=0;p<f;++p){const A=s[g+p];A!==e&&u.push(A)}}return null}function y6(t,e,n){let r=!0;for(;r;){const i=n(t,e);if(wn(i))return i;const s=t.parentIds[e];r=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}function v6(t){const n=t.classIds.length;for(let r=0;r<n;++r)Ub(t,r,stack)}function Ub(t,e,n){const r=t.parentCounts,i=t.parentIds,s=t.parentIndexes,a=t.classIds.length;if(!wn(i))return;assert(e<a,"Parent index ".concat(e," exceeds the total number of instances: ").concat(a)),assert(n.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),n.push(e);const c=wn(r)?r[e]:1,l=wn(r)?s[e]:e;for(let u=0;u<c;++u){const h=i[l+u];h!==e&&Ub(t,h,n)}n.pop(e)}function ct(t){return t!=null}const Ec=(t,e)=>t,A6={HIERARCHY:!0,extensions:!0,extras:!0};class kb{constructor(e,n,r){var i;let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};d(this,"json",void 0),d(this,"binary",void 0),d(this,"featureCount",void 0),d(this,"_extensions",void 0),d(this,"_properties",void 0),d(this,"_binaryProperties",void 0),d(this,"_hierarchy",void 0),ce(r>=0),this.json=e||{},this.binary=n,this.featureCount=r,this._extensions=((i=this.json)===null||i===void 0?void 0:i.extensions)||{},this._properties={};for(const o in this.json)A6[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=p6(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,n){if(this._checkBatchId(e),ce(typeof n=="string",n),this._hierarchy){const r=ao(this._hierarchy,e,(i,s)=>{const o=i.classIds[s];return i.classes[o].name===n});return ct(r)}return!1}isExactClass(e,n){return ce(typeof n=="string",n),this.getExactClassName(e)===n}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const n=this._hierarchy.classIds[e];return this._hierarchy.classes[n].name}}hasProperty(e,n){return this._checkBatchId(e),ce(typeof n=="string",n),ct(this._properties[n])||this._hasPropertyInHierarchy(e,n)}getPropertyNames(e,n){this._checkBatchId(e),n=ct(n)?n:[],n.length=0;const r=Object.keys(this._properties);return n.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,n),n}getProperty(e,n){if(this._checkBatchId(e),ce(typeof n=="string",n),this._binaryProperties){const i=this._binaryProperties[n];if(ct(i))return this._getBinaryProperty(i,e)}const r=this._properties[n];if(ct(r))return Ec(r[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,n);if(ct(i))return i}}setProperty(e,n,r){const i=this.featureCount;if(this._checkBatchId(e),ce(typeof n=="string",n),this._binaryProperties){const o=this._binaryProperties[n];if(o){this._setBinaryProperty(o,e,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,n,r))return;let s=this._properties[n];ct(s)||(this._properties[n]=new Array(i),s=this._properties[n]),s[e]=Ec(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,n){return e.unpack(e.typedArray,n)}_setBinaryProperty(e,n,r){e.pack(r,e.typedArray,n)}_initializeBinaryProperties(){let e=null;for(const n in this._properties){const r=this._properties[n],i=this._initializeBinaryProperty(n,r);i&&(e=e||{},e[n]=i)}return e}_initializeBinaryProperty(e,n){if("byteOffset"in n){const r=n;ce(this.binary,"Property ".concat(e," requires a batch table binary.")),ce(r.type,"Property ".concat(e," requires a type."));const i=g6(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,n){if(!this._hierarchy)return!1;const r=ao(this._hierarchy,e,(i,s)=>{const o=i.classIds[s],a=i.classes[o].instances;return ct(a[n])});return ct(r)}_getPropertyNamesInHierarchy(e,n){ao(this._hierarchy,e,(r,i)=>{const s=r.classIds[i],o=r.classes[s].instances;for(const a in o)o.hasOwnProperty(a)&&n.indexOf(a)===-1&&n.push(a)})}_getHierarchyProperty(e,n){return ao(this._hierarchy,e,(r,i)=>{const s=r.classIds[i],o=r.classes[s],a=r.classIndexes[i],c=o.instances[n];return ct(c)?ct(c.typedArray)?this._getBinaryProperty(c,a):Ec(c[a]):null})}_setHierarchyProperty(e,n,r,i){const s=ao(this._hierarchy,n,(o,a)=>{const c=o.classIds[a],l=o.classes[c],u=o.classIndexes[a],h=l.instances[r];return ct(h)?(ce(a===n,'Inherited property "'.concat(r,'" is read-only.')),ct(h.typedArray)?this._setBinaryProperty(h,u,i):h[u]=Ec(i),!0):!1});return ct(s)}}const Hh=4;function cu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e);if(t.magic=r.getUint32(n,!0),n+=Hh,t.version=r.getUint32(n,!0),n+=Hh,t.byteLength=r.getUint32(n,!0),n+=Hh,t.version!==1)throw new Error("3D Tile Version ".concat(t.version," not supported"));return n}const Di=4,mv="b3dm tile in legacy format.";function Mp(t,e,n){const r=new DataView(e);let i;t.header=t.header||{};let s=r.getUint32(n,!0);n+=Di;let o=r.getUint32(n,!0);n+=Di;let a=r.getUint32(n,!0);n+=Di;let c=r.getUint32(n,!0);return n+=Di,a>=570425344?(n-=Di*2,i=s,a=o,c=0,s=0,o=0,console.warn(mv)):c>=570425344&&(n-=Di,i=a,a=s,c=o,s=0,o=0,console.warn(mv)),t.header.featureTableJsonByteLength=s,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=c,t.header.batchLength=i,n}function Rp(t,e,n,r){return n=E6(t,e,n),n=T6(t,e,n),n}function E6(t,e,n,r){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:s,batchLength:o}=t.header;if(t.featureTableJson={BATCH_LENGTH:o||0},i>0){const a=Nb(e,n,i);t.featureTableJson=JSON.parse(a)}return n+=i,t.featureTableBinary=new Uint8Array(e,n,s),n+=s,n}function T6(t,e,n,r){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:s}=t.header;if(i>0){const o=Nb(e,n,i);t.batchTableJson=JSON.parse(o),n+=i,s>0&&(t.batchTableBinary=new Uint8Array(e,n,s),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=s)}return n}function Gb(t,e,n){if(!e&&(!t||!t.batchIds||!n))return null;const{batchIds:r,isRGB565:i,pointCount:s}=t;if(r&&n){const o=new Uint8ClampedArray(s*3);for(let a=0;a<s;a++){const c=r[a],u=n.getProperty(c,"dimensions").map(h=>h*255);o[a*3]=u[0],o[a*3+1]=u[1],o[a*3+2]=u[2]}return{type:Z.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(i){const o=new Uint8ClampedArray(s*3);for(let a=0;a<s;a++){const c=c6(e[a]);o[a*3]=c[0],o[a*3+1]=c[1],o[a*3+2]=c[2]}return{type:Z.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return e&&e.length===s*3?{type:Z.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Z.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const _v=new C;function b6(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array(t.pointsLength*3);for(let r=0;r<t.pointsLength;r++)u6(e[r*2],e[r*2+1],_v),_v.toArray(n,r*3);return{type:Z.FLOAT,size:2,value:n}}return{type:Z.FLOAT,size:2,value:e}}function S6(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,w6(t,e)):{type:Z.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function w6(t,e){const n=new C,r=new Float32Array(t.pointCount*3);for(let i=0;i<t.pointCount;i++)n.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(r,i*3);return r}async function C6(t,e,n,r,i){n=cu(t,e,n),n=Mp(t,e,n),n=Rp(t,e,n),x6(t);const{featureTable:s,batchTable:o}=B6(t);return await L6(t,s,o,r,i),I6(t,s,r),M6(t,s,o),R6(t,s),n}function x6(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function B6(t){const e=new Ip(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",Z.FLOAT,3);const r=P6(t,e);return{featureTable:e,batchTable:r}}function I6(t,e,n){if(!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",Z.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const r=e.getPropertyArray("POSITION_QUANTIZED",Z.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65536-1,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Z.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Z.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=S6(t,r,n)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function M6(t,e,n){if(!t.attributes.colors){let r=null;e.hasProperty("RGBA")?(r=e.getPropertyArray("RGBA",Z.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?r=e.getPropertyArray("RGB",Z.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(r=e.getPropertyArray("RGB565",Z.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=Gb(t,r,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Z.UNSIGNED_BYTE,4))}function R6(t,e){if(!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",Z.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",Z.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=b6(t,n)}}function P6(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",Z.UNSIGNED_SHORT,1),t.batchIds)){const r=e.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:s}=t;n=new kb(i,s,r)}return n}async function L6(t,e,n,r,i){let s,o,a;const c=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);const l=e.getExtension("3DTILES_draco_point_compression");if(l){o=l.properties;const h=l.byteOffset,f=l.byteLength;if(!o||!Number.isFinite(h)||!f)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=t.featureTableBinary.slice(h,h+f),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;const u={buffer:s,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await O6(t,u,r,i)}async function O6(t,e,n,r){const{parse:i}=r,s={...n,draco:{...n.draco,extraAttributes:e.batchTableProperties||{}}};delete s["3d-tiles"];const o=await i(e.buffer,Sb,s),a=o.attributes.POSITION&&o.attributes.POSITION.value,c=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,l=o.attributes.NORMAL&&o.attributes.NORMAL.value,u=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,h=a&&o.attributes.POSITION.value.quantization,f=l&&o.attributes.NORMAL.value.quantization;if(h){const p=o.POSITION.data.quantization,A=p.range;t.quantizedVolumeScale=new C(A,A,A),t.quantizedVolumeOffset=new C(p.minValues),t.quantizedRange=(1<<p.quantizationBits)-1,t.isQuantizedDraco=!0}f&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const g={};if(e.batchTableProperties)for(const p of Object.keys(e.batchTableProperties))o.attributes[p]&&o.attributes[p].value&&(g[p.toLowerCase()]=o.attributes[p].value);t.attributes={positions:a,colors:Gb(t,c,void 0),normals:l,batchIds:u,...g}}const Cd={URI:0,EMBEDDED:1};function Vb(t,e,n,r){t.rotateYtoZ=!0;const i=t.byteOffset+t.byteLength-n;if(i===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=Cg(e,n,i),t.gltfByteOffset=0,t.gltfByteLength=i,n%4===0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}async function zb(t,e,n,r){const i=n["3d-tiles"]||{};if(D6(t,e),i.loadGLTF){const{parse:s,fetch:o}=r;t.gltfUrl&&(t.gltfArrayBuffer=await o(t.gltfUrl,n),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await s(t.gltfArrayBuffer,ra,n,r),t.gpuMemoryUsageInBytes=Tb(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}function D6(t,e,n){switch(e){case Cd.URI:const r=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),s=new TextDecoder().decode(r);t.gltfUrl=s.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case Cd.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function F6(t,e,n,r,i){var s;n=N6(t,e,n,r),await zb(t,Cd.EMBEDDED,r,i);const o=t==null||(s=t.gltf)===null||s===void 0?void 0:s.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),n}function N6(t,e,n,r,i){n=cu(t,e,n),n=Mp(t,e,n),n=Rp(t,e,n),n=Vb(t,e,n,r);const s=new Ip(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=s.getGlobalProperty("RTC_CENTER",Z.FLOAT,3),n}async function U6(t,e,n,r,i){return n=k6(t,e,n,r),await zb(t,t.gltfFormat,r,i),n}function k6(t,e,n,r,i){if(n=cu(t,e,n),t.version!==1)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));n=Mp(t,e,n);const s=new DataView(e);if(t.gltfFormat=s.getUint32(n,!0),n+=4,n=Rp(t,e,n),n=Vb(t,e,n,r),t.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new Ip(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",Z.FLOAT,3);const c=new kb(t.batchTableJson,t.batchTableBinary,a);return G6(t,o,c,a),n}function G6(t,e,n,r){const s={instances:new Array(r),batchTable:t._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,o=new C;new C,new C,new C;const a=new Se,c=new Zo,l=new C,u={},h=new Y,f=[],g=[],p=new C,A=new C;for(let b=0;b<r;b++){let _;if(e.hasProperty("POSITION"))_=e.getProperty("POSITION",Z.FLOAT,3,b,o);else if(e.hasProperty("POSITION_QUANTIZED")){_=e.getProperty("POSITION_QUANTIZED",Z.UNSIGNED_SHORT,3,b,o);const I=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Z.FLOAT,3,p);if(!I)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const M=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Z.FLOAT,3,A);if(!M)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const L=65535;for(let R=0;R<3;R++)_[R]=_[R]/L*M[R]+I[R]}if(!_)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(_),u.translation=o,t.normalUp=e.getProperty("NORMAL_UP",Z.FLOAT,3,b,f),t.normalRight=e.getProperty("NORMAL_RIGHT",Z.FLOAT,3,b,g),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Z.UNSIGNED_SHORT,2,f),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Z.UNSIGNED_SHORT,2,g),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(ye.WGS84.eastNorthUpToFixedFrame(o,h),h.getRotationMatrix3(a)):a.identity()}c.fromMatrix3(a),u.rotation=c,l.set(1,1,1);const m=e.getProperty("SCALE",Z.FLOAT,1,b);Number.isFinite(m)&&l.multiplyByScalar(m);const v=e.getProperty("SCALE_NON_UNIFORM",Z.FLOAT,3,b,f);v&&l.scale(v),u.scale=l;let T=e.getProperty("BATCH_ID",Z.UNSIGNED_SHORT,1,b);T===void 0&&(T=b);const w=new Y().fromQuaternion(u.rotation);h.identity(),h.translate(u.translation),h.multiplyRight(w),h.scale(u.scale);const x=h.clone();s[b]={modelMatrix:x,batchId:T}}t.instances=s}async function V6(t,e,n,r,i,s){n=cu(t,e,n);const o=new DataView(e);for(t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-n>12;){const a={};t.tiles.push(a),n=await s(e,n,r,i,a)}return n}async function z6(t,e,n,r){t.rotateYtoZ=!0,t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y";const{parse:i}=r;t.gltf=await i(e,ra,n,r),t.gpuMemoryUsageInBytes=Tb(t.gltf)}async function Hb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(i.byteOffset=e,i.type=i6(t,e),i.type){case oo.COMPOSITE:return await V6(i,t,e,n,r,Hb);case oo.BATCHED_3D_MODEL:return await F6(i,t,e,n,r);case oo.GLTF:return await z6(i,t,n,r);case oo.INSTANCED_3D_MODEL:return await U6(i,t,e,n,r);case oo.POINT_CLOUD:return await C6(i,t,e,n,r);default:throw new Error("3DTileLoader: unknown type ".concat(i.type))}}const H6=1952609651,j6=1;async function W6(t,e,n){if(new Uint32Array(t.slice(0,4))[0]!==H6)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==j6)throw new Error("Wrong subtree file verson, must be 1");const s=yv(t.slice(8,16)),o=new Uint8Array(t,24,s),c=new TextDecoder("utf8").decode(o),l=JSON.parse(c),u=yv(t.slice(16,24));let h=new ArrayBuffer(0);return u&&(h=t.slice(24+s)),"bufferView"in l.tileAvailability&&(l.tileAvailability.explicitBitstream=await jh(l,"tileAvailability",h,n)),"bufferView"in l.contentAvailability&&(l.contentAvailability.explicitBitstream=await jh(l,"contentAvailability",h,n)),"bufferView"in l.childSubtreeAvailability&&(l.childSubtreeAvailability.explicitBitstream=await jh(l,"childSubtreeAvailability",h,n)),l}function J6(t,e){if(e.startsWith("http")){const s=new URL(t,e);return decodeURI(s.toString())}const r="http://".concat(e),i=new URL(t,r);return"/".concat(i.host).concat(i.pathname)}async function jh(t,e,n,r){const i=t[e].bufferView,s=t.bufferViews[i],o=t.buffers[s.buffer];if(!(r!=null&&r.url)||!r.fetch)throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(o.uri){const a=J6(o.uri,r==null?void 0:r.url),l=await(await r.fetch(a)).arrayBuffer();return new Uint8Array(l,s.byteOffset,s.byteLength)}return new Uint8Array(n,s.byteOffset,s.byteLength)}function yv(t){const e=new DataView(t),n=e.getUint32(0,!0),r=e.getUint32(4,!0);return n+2**32*r}const jb={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:Fb,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:W6,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var zt=null;try{zt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ae(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}ae.prototype.__isLong__;Object.defineProperty(ae.prototype,"__isLong__",{value:!0});function $e(t){return(t&&t.__isLong__)===!0}function vv(t){var e=Math.clz32(t&-t);return t?31-e:e}ae.isLong=$e;var Av={},Ev={};function Ei(t,e){var n,r,i;return e?(t>>>=0,(i=0<=t&&t<256)&&(r=Ev[t],r)?r:(n=ee(t,0,!0),i&&(Ev[t]=n),n)):(t|=0,(i=-128<=t&&t<128)&&(r=Av[t],r)?r:(n=ee(t,t<0?-1:0,!1),i&&(Av[t]=n),n))}ae.fromInt=Ei;function Ht(t,e){if(isNaN(t))return e?Xn:on;if(e){if(t<0)return Xn;if(t>=Wb)return Kb}else{if(t<=-bv)return ft;if(t+1>=bv)return Xb}return t<0?Ht(-t,e).neg():ee(t%Cs|0,t/Cs|0,e)}ae.fromNumber=Ht;function ee(t,e,n){return new ae(t,e,n)}ae.fromBits=ee;var Ll=Math.pow;function Pp(t,e,n){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(n=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?Xn:on;if(n=n||10,n<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return Pp(t.substring(1),e,n).neg();for(var i=Ht(Ll(n,8)),s=on,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),c=parseInt(t.substring(o,o+a),n);if(a<8){var l=Ht(Ll(n,a));s=s.mul(l).add(Ht(c))}else s=s.mul(i),s=s.add(Ht(c))}return s.unsigned=e,s}ae.fromString=Pp;function fn(t,e){return typeof t=="number"?Ht(t,e):typeof t=="string"?Pp(t,e):ee(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}ae.fromValue=fn;var Tv=65536,X6=1<<24,Cs=Tv*Tv,Wb=Cs*Cs,bv=Wb/2,Sv=Ei(X6),on=Ei(0);ae.ZERO=on;var Xn=Ei(0,!0);ae.UZERO=Xn;var $i=Ei(1);ae.ONE=$i;var Jb=Ei(1,!0);ae.UONE=Jb;var xd=Ei(-1);ae.NEG_ONE=xd;var Xb=ee(-1,2147483647,!1);ae.MAX_VALUE=Xb;var Kb=ee(-1,-1,!0);ae.MAX_UNSIGNED_VALUE=Kb;var ft=ee(0,-2147483648,!1);ae.MIN_VALUE=ft;var D=ae.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low};D.toNumber=function(){return this.unsigned?(this.high>>>0)*Cs+(this.low>>>0):this.high*Cs+(this.low>>>0)};D.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ft)){var n=Ht(e),r=this.div(n),i=r.mul(n).sub(this);return r.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=Ht(Ll(e,6),this.unsigned),o=this,a="";;){var c=o.div(s),l=o.sub(c.mul(s)).toInt()>>>0,u=l.toString(e);if(o=c,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};D.getHighBits=function(){return this.high};D.getHighBitsUnsigned=function(){return this.high>>>0};D.getLowBits=function(){return this.low};D.getLowBitsUnsigned=function(){return this.low>>>0};D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ft)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};D.isZero=function(){return this.high===0&&this.low===0};D.eqz=D.isZero;D.isNegative=function(){return!this.unsigned&&this.high<0};D.isPositive=function(){return this.unsigned||this.high>=0};D.isOdd=function(){return(this.low&1)===1};D.isEven=function(){return(this.low&1)===0};D.equals=function(e){return $e(e)||(e=fn(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};D.eq=D.equals;D.notEquals=function(e){return!this.eq(e)};D.neq=D.notEquals;D.ne=D.notEquals;D.lessThan=function(e){return this.comp(e)<0};D.lt=D.lessThan;D.lessThanOrEqual=function(e){return this.comp(e)<=0};D.lte=D.lessThanOrEqual;D.le=D.lessThanOrEqual;D.greaterThan=function(e){return this.comp(e)>0};D.gt=D.greaterThan;D.greaterThanOrEqual=function(e){return this.comp(e)>=0};D.gte=D.greaterThanOrEqual;D.ge=D.greaterThanOrEqual;D.compare=function(e){if($e(e)||(e=fn(e)),this.eq(e))return 0;var n=this.isNegative(),r=e.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};D.comp=D.compare;D.negate=function(){return!this.unsigned&&this.eq(ft)?ft:this.not().add($i)};D.neg=D.negate;D.add=function(e){$e(e)||(e=fn(e));var n=this.high>>>16,r=this.high&65535,i=this.low>>>16,s=this.low&65535,o=e.high>>>16,a=e.high&65535,c=e.low>>>16,l=e.low&65535,u=0,h=0,f=0,g=0;return g+=s+l,f+=g>>>16,g&=65535,f+=i+c,h+=f>>>16,f&=65535,h+=r+a,u+=h>>>16,h&=65535,u+=n+o,u&=65535,ee(f<<16|g,u<<16|h,this.unsigned)};D.subtract=function(e){return $e(e)||(e=fn(e)),this.add(e.neg())};D.sub=D.subtract;D.multiply=function(e){if(this.isZero())return this;if($e(e)||(e=fn(e)),zt){var n=zt.mul(this.low,this.high,e.low,e.high);return ee(n,zt.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Xn:on;if(this.eq(ft))return e.isOdd()?ft:on;if(e.eq(ft))return this.isOdd()?ft:on;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Sv)&&e.lt(Sv))return Ht(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,i=this.high&65535,s=this.low>>>16,o=this.low&65535,a=e.high>>>16,c=e.high&65535,l=e.low>>>16,u=e.low&65535,h=0,f=0,g=0,p=0;return p+=o*u,g+=p>>>16,p&=65535,g+=s*u,f+=g>>>16,g&=65535,g+=o*l,f+=g>>>16,g&=65535,f+=i*u,h+=f>>>16,f&=65535,f+=s*l,h+=f>>>16,f&=65535,f+=o*c,h+=f>>>16,f&=65535,h+=r*u+i*l+s*c+o*a,h&=65535,ee(g<<16|p,h<<16|f,this.unsigned)};D.mul=D.multiply;D.divide=function(e){if($e(e)||(e=fn(e)),e.isZero())throw Error("division by zero");if(zt){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?zt.div_u:zt.div_s)(this.low,this.high,e.low,e.high);return ee(n,zt.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Xn:on;var r,i,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Xn;if(e.gt(this.shru(1)))return Jb;s=Xn}else{if(this.eq(ft)){if(e.eq($i)||e.eq(xd))return ft;if(e.eq(ft))return $i;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(on)?e.isNegative()?$i:xd:(i=this.sub(e.mul(r)),s=r.add(i.div(e)),s)}else if(e.eq(ft))return this.unsigned?Xn:on;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=on}for(i=this;i.gte(e);){r=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),c=a<=48?1:Ll(2,a-48),l=Ht(r),u=l.mul(e);u.isNegative()||u.gt(i);)r-=c,l=Ht(r,this.unsigned),u=l.mul(e);l.isZero()&&(l=$i),s=s.add(l),i=i.sub(u)}return s};D.div=D.divide;D.modulo=function(e){if($e(e)||(e=fn(e)),zt){var n=(this.unsigned?zt.rem_u:zt.rem_s)(this.low,this.high,e.low,e.high);return ee(n,zt.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};D.mod=D.modulo;D.rem=D.modulo;D.not=function(){return ee(~this.low,~this.high,this.unsigned)};D.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};D.clz=D.countLeadingZeros;D.countTrailingZeros=function(){return this.low?vv(this.low):vv(this.high)+32};D.ctz=D.countTrailingZeros;D.and=function(e){return $e(e)||(e=fn(e)),ee(this.low&e.low,this.high&e.high,this.unsigned)};D.or=function(e){return $e(e)||(e=fn(e)),ee(this.low|e.low,this.high|e.high,this.unsigned)};D.xor=function(e){return $e(e)||(e=fn(e)),ee(this.low^e.low,this.high^e.high,this.unsigned)};D.shiftLeft=function(e){return $e(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ee(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ee(0,this.low<<e-32,this.unsigned)};D.shl=D.shiftLeft;D.shiftRight=function(e){return $e(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ee(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ee(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};D.shr=D.shiftRight;D.shiftRightUnsigned=function(e){return $e(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ee(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?ee(this.high,0,this.unsigned):ee(this.high>>>e-32,0,this.unsigned)};D.shru=D.shiftRightUnsigned;D.shr_u=D.shiftRightUnsigned;D.rotateLeft=function(e){var n;return $e(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?ee(this.high,this.low,this.unsigned):e<32?(n=32-e,ee(this.low<<e|this.high>>>n,this.high<<e|this.low>>>n,this.unsigned)):(e-=32,n=32-e,ee(this.high<<e|this.low>>>n,this.low<<e|this.high>>>n,this.unsigned))};D.rotl=D.rotateLeft;D.rotateRight=function(e){var n;return $e(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?ee(this.high,this.low,this.unsigned):e<32?(n=32-e,ee(this.high<<n|this.low>>>e,this.low<<n|this.high>>>e,this.unsigned)):(e-=32,n=32-e,ee(this.low<<n|this.high>>>e,this.high<<n|this.low>>>e,this.unsigned))};D.rotr=D.rotateRight;D.toSigned=function(){return this.unsigned?ee(this.low,this.high,!1):this};D.toUnsigned=function(){return this.unsigned?this:ee(this.low,this.high,!0)};D.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};D.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};D.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};ae.fromBytes=function(e,n,r){return r?ae.fromBytesLE(e,n):ae.fromBytesBE(e,n)};ae.fromBytesLE=function(e,n){return new ae(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};ae.fromBytesBE=function(e,n){return new ae(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const K6=16;function Yb(t){t==="X"&&(t="");const e=t.padEnd(K6,"0");return ae.fromString(e,!0,16)}function Y6(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const n=e%4;e=(e-n)/4;const r=e;e*=4;const s=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-r-s.length).join("0")+s}function Q6(t,e){const n=q6(t).shiftRightUnsigned(2);return t.add(ae.fromNumber(2*e+1-4).multiply(n))}function q6(t){return t.and(t.not().add(1))}const Z6=3,$6=30,e9=2*$6+1,wv=180/Math.PI;function t9(t){if(t.length===0)throw new Error("Invalid Hilbert quad key ".concat(t));const e=t.split("/"),n=parseInt(e[0],10),r=e[1],i=r.length;let s=0;const o=[0,0];for(let a=i-1;a>=0;a--){s=i-a;const c=r[a];let l=0,u=0;c==="1"?u=1:c==="2"?(l=1,u=1):c==="3"&&(l=1);const h=Math.pow(2,s-1);r9(h,o,l,u),o[0]+=h*l,o[1]+=h*u}if(n%2===1){const a=o[0];o[0]=o[1],o[1]=a}return{face:n,ij:o,level:s}}function n9(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<Z6+e9;)e="0"+e;const n=e.lastIndexOf("1"),r=e.substring(0,3),i=e.substring(3,n),s=i.length/2,o=ae.fromString(r,!0,2).toString(10);let a="";if(s!==0)for(a=ae.fromString(i,!0,2).toString(4);a.length<s;)a="0"+a;return"".concat(o,"/").concat(a)}function Qb(t,e,n){const r=1<<e;return[(t[0]+n[0])/r,(t[1]+n[1])/r]}function Cv(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function qb(t){return[Cv(t[0]),Cv(t[1])]}function Zb(t,e){let[n,r]=e;switch(t){case 0:return[1,n,r];case 1:return[-n,1,r];case 2:return[-n,-r,1];case 3:return[-1,-r,-n];case 4:return[r,-1,-n];case 5:return[r,n,-1];default:throw new Error("Invalid face")}}function $b(t){let[e,n,r]=t;const i=Math.atan2(r,Math.sqrt(e*e+n*n));return[Math.atan2(n,e)*wv,i*wv]}function r9(t,e,n,r){if(r===0){n===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function i9(t){const e=Qb(t.ij,t.level,[.5,.5]),n=qb(e),r=Zb(t.face,n);return $b(r)}const s9=100;function xv(t){const{face:e,ij:n,level:r}=t,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(s9*Math.pow(2,-r))),o=new Float64Array(4*s*2+2);let a=0,c=0;for(let l=0;l<4;l++){const u=i[l].slice(0),h=i[l+1],f=(h[0]-u[0])/s,g=(h[1]-u[1])/s;for(let p=0;p<s;p++){u[0]+=f,u[1]+=g;const A=Qb(n,r,u),b=qb(A),_=Zb(e,b),m=$b(_);Math.abs(m[1])>89.999&&(m[0]=c);const v=m[0]-c;m[0]+=v>180?-360:v<-180?360:0,o[a++]=m[0],o[a++]=m[1],c=m[0]}}return o[a++]=o[0],o[a++]=o[1],o}function Lp(t){const e=o9(t);return t9(e)}function o9(t){if(t.indexOf("/")>0)return t;const e=Yb(t);return n9(e)}function a9(t){const e=Lp(t);return i9(e)}function c9(t){let e;if(t.face===2||t.face===5){let n=null,r=0;for(let i=0;i<4;i++){const s="".concat(t.face,"/").concat(i),o=Lp(s),a=xv(o);(typeof n>"u"||n===null)&&(n=new Float64Array(4*a.length)),n.set(a,r),r+=a.length}e=Bv(n)}else{const n=xv(t);e=Bv(n)}return e}function Bv(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],n=[];for(let r=0;r<t.length;r+=2)e.push(t[r]),n.push(t[r+1]);return e.sort((r,i)=>r-i),n.sort((r,i)=>r-i),{west:e[0],east:e[e.length-1],north:n[n.length-1],south:n[0]}}function l9(t,e){const n=(e==null?void 0:e.minimumHeight)||0,r=(e==null?void 0:e.maximumHeight)||0,i=Lp(t),s=c9(i),o=s.west,a=s.south,c=s.east,l=s.north,u=[];return u.push(new C(o,l,n)),u.push(new C(c,l,n)),u.push(new C(c,a,n)),u.push(new C(o,a,n)),u.push(new C(o,l,r)),u.push(new C(c,l,r)),u.push(new C(c,a,r)),u.push(new C(o,a,r)),u}function eS(t){const e=t.token,n={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},r=l9(e,n),i=a9(e),s=i[0],o=i[1],a=ye.WGS84.cartographicToCartesian([s,o,n.maximumHeight]),c=new C(a[0],a[1],a[2]);r.push(c);const l=DU(r);return[...l.center,...l.halfAxes]}const u9=4,h9=8,f9={QUADTREE:u9,OCTREE:h9};function d9(t,e,n){if(t!=null&&t.box){const r=Yb(t.s2VolumeInfo.token),i=Q6(r,e),s=Y6(i),o={...t.s2VolumeInfo};switch(o.token=s,n){case"OCTREE":const l=t.s2VolumeInfo,u=l.maximumHeight-l.minimumHeight,h=u/2,f=l.minimumHeight+u/2;l.minimumHeight=f-h,l.maximumHeight=f+h;break}return{box:eS(o),s2VolumeInfo:o}}}async function tS(t){const{options:e,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,globalData:i={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:s}=t;let{subtree:o,level:a=0}=t;const{subdivisionScheme:c,subtreeLevels:l,maximumLevel:u,contentUrlTemplate:h,subtreesUriTemplate:f,basePath:g}=e,p={children:[],lodMetricValue:0,contentUrl:""},A=f9[c],b=r&1,_=r>>1&1,m=r>>2&1,v=(A**a-1)/(A-1);let T=Kr(n.mortonIndex,r),w=v+T,x=Kr(n.x,b),I=Kr(n.y,_),M=Kr(n.z,m),L=!1;a+1>l&&(L=Wh(o.childSubtreeAvailability,T));const R=Kr(i.x,x),z=Kr(i.y,I),te=Kr(i.z,M),ne=a+i.level;if(L){const U="".concat(g,"/").concat(f),H=Bd(U,ne,R,z,te);o=await Fr(H,jb),i.mortonIndex=T,i.x=x,i.y=I,i.z=M,i.level=a,T=0,w=0,x=0,I=0,M=0,a=0}if(!Wh(o.tileAvailability,w)||a>u)return p;Wh(o.contentAvailability,w)&&(p.contentUrl=Bd(h,ne,R,z,te));const Pn=a+1,dn={mortonIndex:T,x,y:I,z:M};for(let U=0;U<A;U++){const H=d9(s,U,c),j=await tS({subtree:o,options:e,parentData:dn,childIndex:U,level:Pn,globalData:i,s2VolumeBox:H});if(j.contentUrl||j.children.length){const he=ne+1,ar=g9(j,he,{childTileX:x,childTileY:I,childTileZ:M},e,s);p.children.push(ar)}}return p}function Wh(t,e){return"constant"in t?!!t.constant:t.explicitBitstream?_9(e,t.explicitBitstream):!1}function g9(t,e,n,r,i){const{basePath:s,refine:o,getRefine:a,lodMetricType:c,getTileType:l,rootLodMetricValue:u,rootBoundingVolume:h}=r,f=t.contentUrl&&t.contentUrl.replace("".concat(s,"/"),""),g=u/2**e,p=i!=null&&i.box?{box:i.box}:h,A=p9(e,p,n);return{children:t.children,contentUrl:t.contentUrl,content:{uri:f},id:t.contentUrl,refine:a(o),type:l(t),lodMetricType:c,lodMetricValue:g,geometricError:g,transform:t.transform,boundingVolume:A}}function p9(t,e,n){if(e.region){const{childTileX:r,childTileY:i,childTileZ:s}=n,[o,a,c,l,u,h]=e.region,f=2**t,g=(c-o)/f,p=(l-a)/f,A=(h-u)/f,[b,_]=[o+g*r,o+g*(r+1)],[m,v]=[a+p*i,a+p*(i+1)],[T,w]=[u+A*s,u+A*(s+1)];return{region:[b,m,_,v,T,w]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}function Kr(t,e){return parseInt(t.toString(2)+e.toString(2),2)}function Bd(t,e,n,r,i){const s=m9({level:e,x:n,y:r,z:i});return t.replace(/{level}|{x}|{y}|{z}/gi,o=>s[o])}function m9(t){const e={};for(const n in t)e["{".concat(n,"}")]=t[n];return e}function _9(t,e){const n=Math.floor(t/8),r=t%8;return(e[n]>>r&1)===1}function Op(t){if(!t.contentUrl)return us.EMPTY;const n=t.contentUrl.split("?")[0].split(".").pop();switch(n){case"pnts":return us.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return us.SCENEGRAPH;default:return n}}function Dp(t){switch(t){case"REPLACE":case"replace":return Qn.REPLACE;case"ADD":case"add":return Qn.ADD;default:return t}}function Id(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const r=new URL(t,"".concat(e,"/"));return decodeURI(r.toString())}else if(t.startsWith("/"))return t;return"".concat(e,"/").concat(t)}function Iv(t,e){if(!t)return null;if(t.content){const n=t.content.uri||t.content.url;t.contentUrl=Id(n,e.basePath)}return t.id=t.contentUrl,t.lodMetricType=ou.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=Op(t),t.refine=Dp(t.refine),t}async function y9(t,e){const n=t.basePath;let r;const i=Rv(t==null?void 0:t.root);i&&t.root?r=await Mv(t.root,t,i,e):r=Iv(t.root,t);const s=[];for(s.push(r);s.length>0;){const a=(s.pop()||{}).children||[];for(let c of a){const l=Rv(c);l?c=await Mv(c,t,l,e):Iv(c,{basePath:n}),s.push(c)}}return r}async function Mv(t,e,n,r){var i,s;const o=e.basePath,{subdivisionScheme:a,maximumLevel:c,subtreeLevels:l,subtrees:{uri:u}}=n,h=Bd(u,0,0,0,0),f=Id(h,o),g=await Fr(f,jb,r),p=Id(t.content.uri,o),A=e==null||(i=e.root)===null||i===void 0?void 0:i.refine,b=t.geometricError,_=(s=t.boundingVolume.extensions)===null||s===void 0?void 0:s["3DTILES_bounding_volume_S2"];if(_){const w={box:eS(_),s2VolumeInfo:_};t.boundingVolume=w}const m=t.boundingVolume,v={contentUrlTemplate:p,subtreesUriTemplate:u,subdivisionScheme:a,subtreeLevels:l,maximumLevel:c,refine:A,basePath:o,lodMetricType:ou.GEOMETRIC_ERROR,rootLodMetricValue:b,rootBoundingVolume:m,getTileType:Op,getRefine:Dp};return await v9(t,g,v)}async function v9(t,e,n){if(!t)return null;t.lodMetricType=ou.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform;const{children:r,contentUrl:i}=await tS({subtree:e,options:n,s2VolumeBox:t});return i&&(t.contentUrl=i,t.content={uri:i.replace("".concat(n.basePath,"/"),"")}),t.refine=Dp(t.refine),t.type=Op(t),t.children=r,t.id=t.contentUrl,t}function Rv(t){var e;return(t==null||(e=t.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(t==null?void 0:t.implicitTiling)}const Fp={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:Fb,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:b9,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function A9(t){return xg(t.url)}async function E9(t,e,n){const r={content:{featureIds:null}};return await Hb(t,0,e,n,r.content),r.content}async function T9(t,e,n){var r;const i=JSON.parse(new TextDecoder().decode(t));return i.loader=e.loader||Fp,i.url=n.url,i.queryString=n.queryString,i.basePath=A9(i),i.root=await y9(i,e),i.type=Ot.TILES3D,i.lodMetricType=ou.GEOMETRIC_ERROR,i.lodMetricValue=((r=i.root)===null||r===void 0?void 0:r.lodMetricValue)||0,i}async function b9(t,e,n){const r=e["3d-tiles"]||{};let i;return r.isTileset==="auto"?i=n.url&&n.url.indexOf(".json")!==-1:i=r.isTileset,i?t=await T9(t,e,n):t=await E9(t,e,n),t}const Pv=[0],S9={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Fp,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,n)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class Np extends _p{constructor(...e){super(...e),d(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&q.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){const{tileset3d:e}=this.state;return e!==null&&e.isLoaded()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:n,changeFlags:r}){if(e.data&&e.data!==n.data&&this._loadTileset(e.data),r.viewportChanged){const{activeViewports:i}=this.state;Object.keys(i).length&&(this._updateTileset(i),this.state.lastUpdatedViewports=i,this.state.activeViewports={})}if(r.propsChanged){const{layerMap:i}=this.state;for(const s in i)i[s].needsUpdate=!0}}activateViewport(e){const{activeViewports:n,lastUpdatedViewports:r}=this.state;this.internalState.viewport=e,n[e.id]=e;const i=r==null?void 0:r[e.id];(!i||!e.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:n}){const r=n&&n.props.tile;return e.picked&&(e.object=r),e.sourceTile=r,e}filterSubLayer({layer:e,viewport:n}){const{tile:r}=e.props,{id:i}=n;return r.selected&&r.viewportIds.includes(i)}_updateAutoHighlight(e){const n=e.sourceTile,r=this.state.layerMap[n==null?void 0:n.id];r&&r.layer&&r.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:n={}}=this.props;let r=this.props.loader||this.props.loaders;Array.isArray(r)&&(r=r[0]);const i={loadOptions:{...n}};let s=e;if(r.preload){const c=await r.preload(e,n);c.url&&(s=c.url),c.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:c.headers}),Object.assign(i,c)}const o=await Fr(s,r,i.loadOptions),a=new r6(o,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:a,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(a)}_onTileLoad(e){const{lastUpdatedViewports:n}=this.state;this.props.onTileLoad(e),this._updateTileset(n),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:n}=this.state,{timeline:r}=this.context,i=Object.keys(e).length;!r||!i||!n||n.selectTiles(Object.values(e)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(e,n){if(!e.content)return null;switch(e.type){case us.POINTCLOUD:return this._makePointCloudLayer(e,n);case us.SCENEGRAPH:return this._make3DModelLayer(e);case us.MESH:return this._makeSimpleMeshLayer(e,n);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,n){const{attributes:r,pointCount:i,constantRGBA:s,cartographicOrigin:o,modelMatrix:a}=e.content,{positions:c,normals:l,colors:u}=r;if(!c)return null;const h=n&&n.props.data||{header:{vertexCount:i},attributes:{POSITION:c,NORMAL:l,COLOR_0:u}},{pointSize:f,getPointColor:g}=this.props,p=this.getSubLayerClass("pointcloud",yp);return new p({pointSize:f},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:h,coordinateSystem:W.METER_OFFSETS,coordinateOrigin:o,modelMatrix:a,getColor:s||g,_offset:0})}_make3DModelLayer(e){const{gltf:n,instances:r,cartographicOrigin:i,modelMatrix:s}=e.content,o=this.getSubLayerClass("scenegraph",xp);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:r||Pv,scenegraph:n,coordinateSystem:W.METER_OFFSETS,coordinateOrigin:i,modelMatrix:s,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,n){const r=e.content,{attributes:i,indices:s,modelMatrix:o,cartographicOrigin:a,coordinateSystem:c=W.METER_OFFSETS,material:l,featureIds:u}=r,{_getMeshColor:h}=this.props,f=n&&n.props.mesh||new os({drawMode:4,attributes:w9(i),indices:s}),g=this.getSubLayerClass("mesh",Bp);return new g(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:f,data:Pv,getColor:h(e),pbrMaterial:l,modelMatrix:o,coordinateOrigin:a,coordinateSystem:c,featureIds:u,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:n}=this.state;return e?e.tiles.map(r=>{const i=n[r.id]=n[r.id]||{tile:r};let{layer:s}=i;return r.selected&&(s?i.needsUpdate&&(s=this._getSubLayer(r,s),i.needsUpdate=!1):s=this._getSubLayer(r)),i.layer=s,s}).filter(Boolean):null}}d(Np,"defaultProps",S9);d(Np,"layerName","Tile3DLayer");function w9(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}const C9="modulepreload",x9=function(t){return"/mapengine-survey/step3/deckgl-heatmaplayer/"+t},Lv={},B9=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=x9(s),s in Lv)return;Lv[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=i.length-1;u>=0;u--){const h=i[u];if(h.href===s&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":C9,o||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),o)return new Promise((u,h)=>{l.addEventListener("load",u),l.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},I9=F.createContext(null);function M9(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===i&&r===s}function zn(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!zn(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const i of n)if(!e.hasOwnProperty(i)||!zn(t[i],e[i]))return!1;return!0}return!1}function R9(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function Ov(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();zn(n,r)||e.setProjection(n)}function Dv(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function Fv(t,e){const n=e.viewState||e;let r=!1;if("longitude"in n&&"latitude"in n){const i=t.center;t.center=new i.constructor(n.longitude,n.latitude),r=r||i!==t.center}if("zoom"in n){const i=t.zoom;t.zoom=n.zoom,r=r||i!==t.zoom}if("bearing"in n){const i=t.bearing;t.bearing=n.bearing,r=r||i!==t.bearing}if("pitch"in n){const i=t.pitch;t.pitch=n.pitch,r=r||i!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),r}const P9=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Nv(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const s=e[r.ref];if(s){i=i||Object.assign({},r),delete i.ref;for(const o of P9)o in s&&(i[o]=s[o])}return i||r});return{...t,layers:n}}const Uv={version:8,sources:{},layers:[]},kv={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Jh={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Gv={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},L9=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],O9=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class xs{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const s=this.props[Gv[i.type]];s?s(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const s=this.props[kv[i.type]];s&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),s(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const s=this.props[Jh[i.type]];s&&s(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const i=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||i||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=xs.savedMaps.pop();if(!r)return null;const i=r.map,s=i.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);i._container=n;const o=i._resizeObserver;o&&(o.disconnect(),o.observe(n)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:a}=e;return a&&(a.bounds?i.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):r._updateViewState(a,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=Uv}=n,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||D9()||null,container:e,style:Nv(r)},s=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,n.gl)}const o=new this._MapClass(i);s.padding&&o.setPadding(s.padding),n.cursor&&(o.getCanvas().style.cursor=n.cursor),this._createShadowTransform(o);const a=o._render;o._render=u=>{this._inRender=!0,a.call(o,u),this._inRender=!1};const c=o._renderTaskQueue.run;o._renderTaskQueue.run=u=>{c.call(o._renderTaskQueue,u),this._onBeforeRepaint()},o.on("render",()=>this._onAfterRepaint());const l=o.fire;o.fire=this._fireEvent.bind(this,l),o.on("resize",()=>{this._renderTransform.resize(o.transform.width,o.transform.height)}),o.on("styledata",()=>{this._updateStyleComponents(this.props,{}),Ov(o.transform,this._renderTransform)}),o.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in kv)o.on(u,this._onPointerEvent);for(const u in Jh)o.on(u,this._onCameraEvent);for(const u in Gv)o.on(u,this._onEvent);this._map=o}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),xs.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=R9(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,i=this._renderTransform,{zoom:s,pitch:o,bearing:a}=i,c=r.isMoving();c&&(i.cameraElevationReference="sea");const l=Fv(i,{...Dv(r.transform),...e});if(c&&(i.cameraElevationReference="ground"),l&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=s!==i.zoom),u.rotate||(u.rotate=a!==i.bearing),u.pitch||(u.pitch=o!==i.pitch)}return c||Fv(r.transform,e),l}_updateSettings(e,n){const r=this._map;let i=!1;for(const s of L9)if(s in e&&!zn(e[s],n[s])){i=!0;const o=r[`set${s[0].toUpperCase()}${s.slice(1)}`];o==null||o.call(r,e[s])}return i}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:r=Uv,styleDiffing:i=!0}=e,s={diff:i};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Nv(r),s),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let i=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!zn(e.light,n.light)&&(i=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!zn(e.fog,n.fog)&&(i=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!zn(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(i=!0,r.setTerrain(e.terrain))),i}_updateHandlers(e,n){var r,i;const s=this._map;let o=!1;for(const a of O9){const c=(r=e[a])!==null&&r!==void 0?r:!0,l=(i=n[a])!==null&&i!==void 0?i:!0;zn(c,l)||(o=!0,c?s[a].enable(c):s[a].disable())}return o}_queryRenderedFeatures(e){const n=this._map,r=n.transform,{interactiveLayerIds:i=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=r}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),c=a.length>0;!c&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,c&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,r){const i=this._map,s=i.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in Jh&&(typeof n=="object"&&(n.viewState=Dv(s)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,n,r),i.transform=s,i):(e.call(i,n,r),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{Ov(this._renderTransform,n),e.transform=n}}}xs.savedMaps=[];function D9(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const F9=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function N9(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const i=e.transform;e.transform=t.transform;const s=e.project(r);return e.transform=i,s},unproject:r=>{const i=e.transform;e.transform=t.transform;const s=e.unproject(r);return e.transform=i,s},queryTerrainElevation:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryTerrainElevation(r,i);return e.transform=s,o},queryRenderedFeatures:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryRenderedFeatures(r,i);return e.transform=s,o}};for(const r of U9(e))!(r in n)&&!F9.includes(r)&&(n[r]=e[r].bind(e));return n}function U9(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const k9=typeof document<"u"?F.useLayoutEffect:F.useEffect,G9=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function V9(t,e){for(const r of G9)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!1)}const lu=F.createContext(null);function z9(t,e,n){const r=F.useContext(I9),[i,s]=F.useState(null),o=F.useRef(),{current:a}=F.useRef({mapLib:null,map:null});F.useEffect(()=>{const u=t.mapLib;let h=!0,f;return Promise.resolve(u||n).then(g=>{if(!h)return;if(!g)throw new Error("Invalid mapLib");const p="Map"in g?g:g.default;if(!p.Map)throw new Error("Invalid mapLib");if(V9(p,t),!p.supported||p.supported(t))t.reuseMaps&&(f=xs.reuse(t,o.current)),f||(f=new xs(p.Map,t,o.current)),a.map=N9(f),a.mapLib=p,s(f),r==null||r.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(g=>{const{onError:p}=t;p?p({type:"error",target:null,originalEvent:null,error:g}):console.error(g)}),()=>{h=!1,f&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?f.recycle():f.destroy())}},[]),k9(()=>{i&&i.setProps(t)}),F.useImperativeHandle(e,()=>a.map,[i]);const c=F.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),l={height:"100%"};return F.createElement("div",{id:t.id,ref:o,style:c},i&&F.createElement(lu.Provider,{value:a},F.createElement("div",{"mapboxgl-children":"",style:l},t.children)))}const H9=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Ti(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!H9.test(r)?n[r]=`${i}px`:n[r]=i}}function j9(t,e){const{map:n,mapLib:r}=F.useContext(lu),i=F.useRef({props:t});i.current.props=t;const s=F.useMemo(()=>{let A=!1;F.Children.forEach(t.children,m=>{m&&(A=!0)});const b={...t,element:A?document.createElement("div"):null},_=new r.Marker(b);return _.setLngLat([t.longitude,t.latitude]),_.getElement().addEventListener("click",m=>{var v,T;(T=(v=i.current.props).onClick)===null||T===void 0||T.call(v,{type:"click",target:_,originalEvent:m})}),_.on("dragstart",m=>{var v,T;const w=m;w.lngLat=s.getLngLat(),(T=(v=i.current.props).onDragStart)===null||T===void 0||T.call(v,w)}),_.on("drag",m=>{var v,T;const w=m;w.lngLat=s.getLngLat(),(T=(v=i.current.props).onDrag)===null||T===void 0||T.call(v,w)}),_.on("dragend",m=>{var v,T;const w=m;w.lngLat=s.getLngLat(),(T=(v=i.current.props).onDragEnd)===null||T===void 0||T.call(v,w)}),_},[]);F.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:o,latitude:a,offset:c,style:l,draggable:u=!1,popup:h=null,rotation:f=0,rotationAlignment:g="auto",pitchAlignment:p="auto"}=t;return F.useEffect(()=>{Ti(s.getElement(),l)},[l]),F.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==o||s.getLngLat().lat!==a)&&s.setLngLat([o,a]),c&&!M9(s.getOffset(),c)&&s.setOffset(c),s.isDraggable()!==u&&s.setDraggable(u),s.getRotation()!==f&&s.setRotation(f),s.getRotationAlignment()!==g&&s.setRotationAlignment(g),s.getPitchAlignment()!==p&&s.setPitchAlignment(p),s.getPopup()!==h&&s.setPopup(h),Sg.createPortal(t.children,s.getElement())}F.memo(F.forwardRef(j9));function Vv(t){return new Set(t?t.trim().split(/\s+/):[])}function W9(t,e){const{map:n,mapLib:r}=F.useContext(lu),i=F.useMemo(()=>document.createElement("div"),[]),s=F.useRef({props:t});s.current.props=t;const o=F.useMemo(()=>{const a={...t},c=new r.Popup(a);return c.setLngLat([t.longitude,t.latitude]),c.once("open",l=>{var u,h;(h=(u=s.current.props).onOpen)===null||h===void 0||h.call(u,l)}),c},[]);if(F.useEffect(()=>{const a=c=>{var l,u;(u=(l=s.current.props).onClose)===null||u===void 0||u.call(l,c)};return o.on("close",a),o.setDOMContent(i).addTo(n.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),F.useEffect(()=>{Ti(o.getElement(),t.style)},[t.style]),F.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!zn(o.options.offset,t.offset)&&o.setOffset(t.offset),(o.options.anchor!==t.anchor||o.options.maxWidth!==t.maxWidth)&&(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const a=Vv(o.options.className),c=Vv(t.className);for(const l of a)c.has(l)||o.removeClassName(l);for(const l of c)a.has(l)||o.addClassName(l);o.options.className=t.className}return Sg.createPortal(t.children,i)}F.memo(F.forwardRef(W9));function Ta(t,e,n,r){const i=F.useContext(lu),s=F.useMemo(()=>t(i),[]);return F.useEffect(()=>{const o=r||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,c=typeof n=="function"?n:typeof e=="function"?e:null,{map:l}=i;return l.hasControl(s)||(l.addControl(s,o==null?void 0:o.position),a&&a(i)),()=>{c&&c(i),l.hasControl(s)&&l.removeControl(s)}},[]),s}function J9(t){const e=Ta(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return F.useEffect(()=>{Ti(e._container,t.style)},[t.style]),null}F.memo(J9);function X9(t){const e=Ta(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return F.useEffect(()=>{Ti(e._controlContainer,t.style)},[t.style]),null}F.memo(X9);function K9(t,e){const n=F.useRef({props:t}),r=Ta(({mapLib:i})=>{const s=new i.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var c,l;(l=(c=n.current.props).onGeolocate)===null||l===void 0||l.call(c,a)}),s.on("error",a=>{var c,l;(l=(c=n.current.props).onError)===null||l===void 0||l.call(c,a)}),s.on("outofmaxbounds",a=>{var c,l;(l=(c=n.current.props).onOutOfMaxBounds)===null||l===void 0||l.call(c,a)}),s.on("trackuserlocationstart",a=>{var c,l;(l=(c=n.current.props).onTrackUserLocationStart)===null||l===void 0||l.call(c,a)}),s.on("trackuserlocationend",a=>{var c,l;(l=(c=n.current.props).onTrackUserLocationEnd)===null||l===void 0||l.call(c,a)}),s},{position:t.position});return n.current.props=t,F.useImperativeHandle(e,()=>r,[]),F.useEffect(()=>{Ti(r._container,t.style)},[t.style]),null}F.memo(F.forwardRef(K9));function Y9(t){const e=Ta(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return F.useEffect(()=>{Ti(e._container,t.style)},[t.style]),null}F.memo(Y9);function Q9(t){const e=Ta(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=F.useRef(t),r=n.current;n.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),F.useEffect(()=>{Ti(e._container,i)},[i]),null}F.memo(Q9);const q9=B9(()=>import("./maplibre-gl-0885d5a3.js").then(t=>t.m),[]),Z9=(()=>F.forwardRef(function(e,n){return z9(e,n,q9)}))();const $9=new ap({ambientLight:new b1({color:[255,182,193],intensity:.6}),pointLight1:new H_({color:[255,255,255],intensity:.8,position:[-.144528,49.739968,8e4]}),pointLight2:new H_({color:[255,255,255],intensity:.8,position:[-3.807751,54.104682,8e3]}),directionalLight:new sd({color:[255,255,255],intensity:.8,direction:[-3,-9,-1]})}),ez={ambient:.8,diffuse:.6,shininess:300,specularColor:[255,255,255]},tz=-80,nz="./fire-hydrant_R5.json",rz={longitude:139.775,latitude:35.68,zoom:14,pitch:45,bearing:0},iz=[[255,255,178,0],[255,255,0,255]],sz=["https://assets.cms.plateau.reearth.io/assets/22/a919cc-1c92-4165-8adc-fcc534251b63/13100_tokyo23-ku_2022_3dtiles_1_1_op_bldg_13101_chiyoda-ku_lod2_no_texture/tileset.json","https://assets.cms.plateau.reearth.io/assets/3f/3dfe7e-e4a9-42b7-8b08-6fe528ed1245/13100_tokyo23-ku_2022_3dtiles_1_1_op_bldg_13102_chuo-ku_lod2_no_texture/tileset.json","https://assets.cms.plateau.reearth.io/assets/6f/a16e61-ab05-4121-ad75-ca78d9180e06/13100_tokyo23-ku_2022_3dtiles_1_1_op_bldg_13103_minato-ku_lod2_no_texture/tileset.json","https://assets.cms.plateau.reearth.io/assets/4a/878097-66f2-4a39-b9fc-85ffee93dbdc/13100_tokyo23-ku_2022_3dtiles_1_1_op_bldg_13104_shinjuku-ku_lod2_no_texture/tileset.json"];function oz(t,e,n=.8){return e.map((i,s)=>new Np({id:`${t}-${s}`,data:i,loader:Fp,opacity:n,MATERIAL:ez,onTileLoad:o=>{o.content.cartographicOrigin=new C(o.content.cartographicOrigin.x,o.content.cartographicOrigin.y,o.content.cartographicOrigin.z+tz)}}))}function az({data:t=nz,intensity:e=1,threshold:n=.03,radiusPixels:r=50,initialBuildingOpacity:i=.5}){const[s,o]=F.useState(i),c=[[...oz("tileset",sz,s)],new vp({data:t,id:"heatmp-layer",pickable:!1,getPosition:l=>[l[0],l[1]],getWeight:l=>l[2],radiusPixels:r,intensity:e,threshold:n,colorRange:iz})];return Fe.jsxs(Fe.Fragment,{children:[Fe.jsxs("div",{className:"absolute left-5 top-5 z-10 bg-neutral-900/80 text-white p-3 flex flex-col gap-2",children:[Fe.jsx("h1",{className:"font-bold text-lg",children:"deck.gl - HeatmapLayer"}),Fe.jsxs("div",{className:"text-xs",children:["消火栓の位置",Fe.jsx("br",{}),"建物は、千代田区、中央区、港区、新宿区のみ表示",Fe.jsx("br",{})]}),Fe.jsx("div",{className:"flex flex-col gap-1.5",children:Fe.jsxs("div",{className:"flex gap-3",children:[Fe.jsx("input",{type:"range",min:"0",max:"1.0",step:"0.1",value:s,onChange:l=>o(l.target.valueAsNumber)}),Fe.jsx("label",{className:"block text-xs",children:"建物透過度"})]})})]}),Fe.jsx(JN,{initialViewState:rz,controller:!0,layers:c,effects:[$9],children:Fe.jsx(Z9,{style:{width:"100vw",height:"100vh"},mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json"})}),Fe.jsxs("div",{className:"absolute z-10 right-5 bottom-5 bg-gray-600 rounded-md px-3 py-1 text-white",children:["このアプリは以下の著作物を改変して利用しています。",Fe.jsx("br",{}),Fe.jsx("a",{href:"https://catalog.data.metro.tokyo.lg.jp/dataset/t000017d0000000007",children:"【東京消防庁 消火栓及び防火水槽等】"})]})]})}Xh.createRoot(document.getElementById("root")).render(Fe.jsx(WS.StrictMode,{children:Fe.jsx(az,{})}));export{cz as c,zv as g};
