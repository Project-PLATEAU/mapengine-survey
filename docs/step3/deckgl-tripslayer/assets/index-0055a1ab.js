function $D(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const a=Object.getOwnPropertyDescriptor(i,r);a&&Object.defineProperty(t,r,a.get?a:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();var ZD=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dx(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var k2={exports:{}},__={},z2={exports:{}},en={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lp=Symbol.for("react.element"),JD=Symbol.for("react.portal"),KD=Symbol.for("react.fragment"),YD=Symbol.for("react.strict_mode"),QD=Symbol.for("react.profiler"),e3=Symbol.for("react.provider"),t3=Symbol.for("react.context"),n3=Symbol.for("react.forward_ref"),i3=Symbol.for("react.suspense"),r3=Symbol.for("react.memo"),s3=Symbol.for("react.lazy"),KA=Symbol.iterator;function o3(t){return t===null||typeof t!="object"?null:(t=KA&&t[KA]||t["@@iterator"],typeof t=="function"?t:null)}var N2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},U2=Object.assign,G2={};function $h(t,e,n){this.props=t,this.context=e,this.refs=G2,this.updater=n||N2}$h.prototype.isReactComponent={};$h.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};$h.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function V2(){}V2.prototype=$h.prototype;function fx(t,e,n){this.props=t,this.context=e,this.refs=G2,this.updater=n||N2}var px=fx.prototype=new V2;px.constructor=fx;U2(px,$h.prototype);px.isPureReactComponent=!0;var YA=Array.isArray,j2=Object.prototype.hasOwnProperty,mx={current:null},H2={key:!0,ref:!0,__self:!0,__source:!0};function W2(t,e,n){var i,r={},a=null,h=null;if(e!=null)for(i in e.ref!==void 0&&(h=e.ref),e.key!==void 0&&(a=""+e.key),e)j2.call(e,i)&&!H2.hasOwnProperty(i)&&(r[i]=e[i]);var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){for(var _=Array(l),v=0;v<l;v++)_[v]=arguments[v+2];r.children=_}if(t&&t.defaultProps)for(i in l=t.defaultProps,l)r[i]===void 0&&(r[i]=l[i]);return{$$typeof:lp,type:t,key:a,ref:h,props:r,_owner:mx.current}}function a3(t,e){return{$$typeof:lp,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function gx(t){return typeof t=="object"&&t!==null&&t.$$typeof===lp}function l3(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var QA=/\/+/g;function n0(t,e){return typeof t=="object"&&t!==null&&t.key!=null?l3(""+t.key):e.toString(36)}function sg(t,e,n,i,r){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var h=!1;if(t===null)h=!0;else switch(a){case"string":case"number":h=!0;break;case"object":switch(t.$$typeof){case lp:case JD:h=!0}}if(h)return h=t,r=r(h),t=i===""?"."+n0(h,0):i,YA(r)?(n="",t!=null&&(n=t.replace(QA,"$&/")+"/"),sg(r,e,n,"",function(v){return v})):r!=null&&(gx(r)&&(r=a3(r,n+(!r.key||h&&h.key===r.key?"":(""+r.key).replace(QA,"$&/")+"/")+t)),e.push(r)),1;if(h=0,i=i===""?".":i+":",YA(t))for(var l=0;l<t.length;l++){a=t[l];var _=i+n0(a,l);h+=sg(a,e,n,_,r)}else if(_=o3(t),typeof _=="function")for(t=_.call(t),l=0;!(a=t.next()).done;)a=a.value,_=i+n0(a,l++),h+=sg(a,e,n,_,r);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return h}function mm(t,e,n){if(t==null)return t;var i=[],r=0;return sg(t,i,"","",function(a){return e.call(n,a,r++)}),i}function c3(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Wr={current:null},og={transition:null},u3={ReactCurrentDispatcher:Wr,ReactCurrentBatchConfig:og,ReactCurrentOwner:mx};en.Children={map:mm,forEach:function(t,e,n){mm(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return mm(t,function(){e++}),e},toArray:function(t){return mm(t,function(e){return e})||[]},only:function(t){if(!gx(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};en.Component=$h;en.Fragment=KD;en.Profiler=QD;en.PureComponent=fx;en.StrictMode=YD;en.Suspense=i3;en.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=u3;en.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=U2({},t.props),r=t.key,a=t.ref,h=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,h=mx.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(_ in e)j2.call(e,_)&&!H2.hasOwnProperty(_)&&(i[_]=e[_]===void 0&&l!==void 0?l[_]:e[_])}var _=arguments.length-2;if(_===1)i.children=n;else if(1<_){l=Array(_);for(var v=0;v<_;v++)l[v]=arguments[v+2];i.children=l}return{$$typeof:lp,type:t.type,key:r,ref:a,props:i,_owner:h}};en.createContext=function(t){return t={$$typeof:t3,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:e3,_context:t},t.Consumer=t};en.createElement=W2;en.createFactory=function(t){var e=W2.bind(null,t);return e.type=t,e};en.createRef=function(){return{current:null}};en.forwardRef=function(t){return{$$typeof:n3,render:t}};en.isValidElement=gx;en.lazy=function(t){return{$$typeof:s3,_payload:{_status:-1,_result:t},_init:c3}};en.memo=function(t,e){return{$$typeof:r3,type:t,compare:e===void 0?null:e}};en.startTransition=function(t){var e=og.transition;og.transition={};try{t()}finally{og.transition=e}};en.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};en.useCallback=function(t,e){return Wr.current.useCallback(t,e)};en.useContext=function(t){return Wr.current.useContext(t)};en.useDebugValue=function(){};en.useDeferredValue=function(t){return Wr.current.useDeferredValue(t)};en.useEffect=function(t,e){return Wr.current.useEffect(t,e)};en.useId=function(){return Wr.current.useId()};en.useImperativeHandle=function(t,e,n){return Wr.current.useImperativeHandle(t,e,n)};en.useInsertionEffect=function(t,e){return Wr.current.useInsertionEffect(t,e)};en.useLayoutEffect=function(t,e){return Wr.current.useLayoutEffect(t,e)};en.useMemo=function(t,e){return Wr.current.useMemo(t,e)};en.useReducer=function(t,e,n){return Wr.current.useReducer(t,e,n)};en.useRef=function(t){return Wr.current.useRef(t)};en.useState=function(t){return Wr.current.useState(t)};en.useSyncExternalStore=function(t,e,n){return Wr.current.useSyncExternalStore(t,e,n)};en.useTransition=function(){return Wr.current.useTransition()};en.version="18.2.0";z2.exports=en;var it=z2.exports;const h3=dx(it);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var d3=it,f3=Symbol.for("react.element"),p3=Symbol.for("react.fragment"),m3=Object.prototype.hasOwnProperty,g3=d3.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_3={key:!0,ref:!0,__self:!0,__source:!0};function q2(t,e,n){var i,r={},a=null,h=null;n!==void 0&&(a=""+n),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(h=e.ref);for(i in e)m3.call(e,i)&&!_3.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:f3,type:t,key:a,ref:h,props:r,_owner:g3.current}}__.Fragment=p3;__.jsx=q2;__.jsxs=q2;k2.exports=__;var ki=k2.exports,Bv={},X2={exports:{}},Os={},$2={exports:{}},Z2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(tt,At){var Pt=tt.length;tt.push(At);e:for(;0<Pt;){var tn=Pt-1>>>1,$t=tt[tn];if(0<r($t,At))tt[tn]=At,tt[Pt]=$t,Pt=tn;else break e}}function n(tt){return tt.length===0?null:tt[0]}function i(tt){if(tt.length===0)return null;var At=tt[0],Pt=tt.pop();if(Pt!==At){tt[0]=Pt;e:for(var tn=0,$t=tt.length,Kn=$t>>>1;tn<Kn;){var Zt=2*(tn+1)-1,Pr=tt[Zt],Qi=Zt+1,mn=tt[Qi];if(0>r(Pr,Pt))Qi<$t&&0>r(mn,Pr)?(tt[tn]=mn,tt[Qi]=Pt,tn=Qi):(tt[tn]=Pr,tt[Zt]=Pt,tn=Zt);else if(Qi<$t&&0>r(mn,Pt))tt[tn]=mn,tt[Qi]=Pt,tn=Qi;else break e}}return At}function r(tt,At){var Pt=tt.sortIndex-At.sortIndex;return Pt!==0?Pt:tt.id-At.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var h=Date,l=h.now();t.unstable_now=function(){return h.now()-l}}var _=[],v=[],S=1,I=null,B=3,z=!1,V=!1,J=!1,ue=typeof setTimeout=="function"?setTimeout:null,j=typeof clearTimeout=="function"?clearTimeout:null,W=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Z(tt){for(var At=n(v);At!==null;){if(At.callback===null)i(v);else if(At.startTime<=tt)i(v),At.sortIndex=At.expirationTime,e(_,At);else break;At=n(v)}}function ae(tt){if(J=!1,Z(tt),!V)if(n(_)!==null)V=!0,ai(be);else{var At=n(v);At!==null&&Bi(ae,At.startTime-tt)}}function be(tt,At){V=!1,J&&(J=!1,j(ke),ke=-1),z=!0;var Pt=B;try{for(Z(At),I=n(_);I!==null&&(!(I.expirationTime>At)||tt&&!ut());){var tn=I.callback;if(typeof tn=="function"){I.callback=null,B=I.priorityLevel;var $t=tn(I.expirationTime<=At);At=t.unstable_now(),typeof $t=="function"?I.callback=$t:I===n(_)&&i(_),Z(At)}else i(_);I=n(_)}if(I!==null)var Kn=!0;else{var Zt=n(v);Zt!==null&&Bi(ae,Zt.startTime-At),Kn=!1}return Kn}finally{I=null,B=Pt,z=!1}}var Ee=!1,Le=null,ke=-1,Ue=5,Me=-1;function ut(){return!(t.unstable_now()-Me<Ue)}function Lt(){if(Le!==null){var tt=t.unstable_now();Me=tt;var At=!0;try{At=Le(!0,tt)}finally{At?Ft():(Ee=!1,Le=null)}}else Ee=!1}var Ft;if(typeof W=="function")Ft=function(){W(Lt)};else if(typeof MessageChannel<"u"){var Rt=new MessageChannel,Jn=Rt.port2;Rt.port1.onmessage=Lt,Ft=function(){Jn.postMessage(null)}}else Ft=function(){ue(Lt,0)};function ai(tt){Le=tt,Ee||(Ee=!0,Ft())}function Bi(tt,At){ke=ue(function(){tt(t.unstable_now())},At)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(tt){tt.callback=null},t.unstable_continueExecution=function(){V||z||(V=!0,ai(be))},t.unstable_forceFrameRate=function(tt){0>tt||125<tt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ue=0<tt?Math.floor(1e3/tt):5},t.unstable_getCurrentPriorityLevel=function(){return B},t.unstable_getFirstCallbackNode=function(){return n(_)},t.unstable_next=function(tt){switch(B){case 1:case 2:case 3:var At=3;break;default:At=B}var Pt=B;B=At;try{return tt()}finally{B=Pt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(tt,At){switch(tt){case 1:case 2:case 3:case 4:case 5:break;default:tt=3}var Pt=B;B=tt;try{return At()}finally{B=Pt}},t.unstable_scheduleCallback=function(tt,At,Pt){var tn=t.unstable_now();switch(typeof Pt=="object"&&Pt!==null?(Pt=Pt.delay,Pt=typeof Pt=="number"&&0<Pt?tn+Pt:tn):Pt=tn,tt){case 1:var $t=-1;break;case 2:$t=250;break;case 5:$t=1073741823;break;case 4:$t=1e4;break;default:$t=5e3}return $t=Pt+$t,tt={id:S++,callback:At,priorityLevel:tt,startTime:Pt,expirationTime:$t,sortIndex:-1},Pt>tn?(tt.sortIndex=Pt,e(v,tt),n(_)===null&&tt===n(v)&&(J?(j(ke),ke=-1):J=!0,Bi(ae,Pt-tn))):(tt.sortIndex=$t,e(_,tt),V||z||(V=!0,ai(be))),tt},t.unstable_shouldYield=ut,t.unstable_wrapCallback=function(tt){var At=B;return function(){var Pt=B;B=At;try{return tt.apply(this,arguments)}finally{B=Pt}}}})(Z2);$2.exports=Z2;var y3=$2.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J2=it,Rs=y3;function Xe(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var K2=new Set,kf={};function Jc(t,e){Ph(t,e),Ph(t+"Capture",e)}function Ph(t,e){for(kf[t]=e,t=0;t<e.length;t++)K2.add(e[t])}var Va=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Lv=Object.prototype.hasOwnProperty,v3=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,eE={},tE={};function x3(t){return Lv.call(tE,t)?!0:Lv.call(eE,t)?!1:v3.test(t)?tE[t]=!0:(eE[t]=!0,!1)}function b3(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function w3(t,e,n,i){if(e===null||typeof e>"u"||b3(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function qr(t,e,n,i,r,a,h){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=h}var lr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){lr[t]=new qr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];lr[e]=new qr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){lr[t]=new qr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){lr[t]=new qr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){lr[t]=new qr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){lr[t]=new qr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){lr[t]=new qr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){lr[t]=new qr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){lr[t]=new qr(t,5,!1,t.toLowerCase(),null,!1,!1)});var _x=/[\-:]([a-z])/g;function yx(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(_x,yx);lr[e]=new qr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(_x,yx);lr[e]=new qr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(_x,yx);lr[e]=new qr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){lr[t]=new qr(t,1,!1,t.toLowerCase(),null,!1,!1)});lr.xlinkHref=new qr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){lr[t]=new qr(t,1,!1,t.toLowerCase(),null,!0,!0)});function vx(t,e,n,i){var r=lr.hasOwnProperty(e)?lr[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(w3(e,n,r,i)&&(n=null),i||r===null?x3(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Za=J2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,gm=Symbol.for("react.element"),nh=Symbol.for("react.portal"),ih=Symbol.for("react.fragment"),xx=Symbol.for("react.strict_mode"),Rv=Symbol.for("react.profiler"),Y2=Symbol.for("react.provider"),Q2=Symbol.for("react.context"),bx=Symbol.for("react.forward_ref"),Dv=Symbol.for("react.suspense"),Ov=Symbol.for("react.suspense_list"),wx=Symbol.for("react.memo"),Tl=Symbol.for("react.lazy"),eI=Symbol.for("react.offscreen"),nE=Symbol.iterator;function Xd(t){return t===null||typeof t!="object"?null:(t=nE&&t[nE]||t["@@iterator"],typeof t=="function"?t:null)}var oi=Object.assign,i0;function mf(t){if(i0===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);i0=e&&e[1]||""}return`
`+i0+t}var r0=!1;function s0(t,e){if(!t||r0)return"";r0=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(v){var i=v}Reflect.construct(t,[],e)}else{try{e.call()}catch(v){i=v}t.call(e.prototype)}else{try{throw Error()}catch(v){i=v}t()}}catch(v){if(v&&i&&typeof v.stack=="string"){for(var r=v.stack.split(`
`),a=i.stack.split(`
`),h=r.length-1,l=a.length-1;1<=h&&0<=l&&r[h]!==a[l];)l--;for(;1<=h&&0<=l;h--,l--)if(r[h]!==a[l]){if(h!==1||l!==1)do if(h--,l--,0>l||r[h]!==a[l]){var _=`
`+r[h].replace(" at new "," at ");return t.displayName&&_.includes("<anonymous>")&&(_=_.replace("<anonymous>",t.displayName)),_}while(1<=h&&0<=l);break}}}finally{r0=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?mf(t):""}function A3(t){switch(t.tag){case 5:return mf(t.type);case 16:return mf("Lazy");case 13:return mf("Suspense");case 19:return mf("SuspenseList");case 0:case 2:case 15:return t=s0(t.type,!1),t;case 11:return t=s0(t.type.render,!1),t;case 1:return t=s0(t.type,!0),t;default:return""}}function Fv(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ih:return"Fragment";case nh:return"Portal";case Rv:return"Profiler";case xx:return"StrictMode";case Dv:return"Suspense";case Ov:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Q2:return(t.displayName||"Context")+".Consumer";case Y2:return(t._context.displayName||"Context")+".Provider";case bx:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case wx:return e=t.displayName||null,e!==null?e:Fv(t.type)||"Memo";case Tl:e=t._payload,t=t._init;try{return Fv(t(e))}catch{}}return null}function E3(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Fv(e);case 8:return e===xx?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Vl(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function tI(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function T3(t){var e=tI(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,a=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(h){i=""+h,a.call(this,h)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(h){i=""+h},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function _m(t){t._valueTracker||(t._valueTracker=T3(t))}function nI(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=tI(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Cg(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function kv(t,e){var n=e.checked;return oi({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function iE(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Vl(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function iI(t,e){e=e.checked,e!=null&&vx(t,"checked",e,!1)}function zv(t,e){iI(t,e);var n=Vl(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Nv(t,e.type,n):e.hasOwnProperty("defaultValue")&&Nv(t,e.type,Vl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function rE(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Nv(t,e,n){(e!=="number"||Cg(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var gf=Array.isArray;function yh(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Vl(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Uv(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Xe(91));return oi({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function sE(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Xe(92));if(gf(n)){if(1<n.length)throw Error(Xe(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Vl(n)}}function rI(t,e){var n=Vl(e.value),i=Vl(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function oE(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function sI(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Gv(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?sI(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ym,oI=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ym=ym||document.createElement("div"),ym.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ym.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function zf(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var wf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},S3=["Webkit","ms","Moz","O"];Object.keys(wf).forEach(function(t){S3.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),wf[e]=wf[t]})});function aI(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||wf.hasOwnProperty(t)&&wf[t]?(""+e).trim():e+"px"}function lI(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=aI(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var C3=oi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Vv(t,e){if(e){if(C3[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Xe(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Xe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Xe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Xe(62))}}function jv(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Hv=null;function Ax(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Wv=null,vh=null,xh=null;function aE(t){if(t=hp(t)){if(typeof Wv!="function")throw Error(Xe(280));var e=t.stateNode;e&&(e=w_(e),Wv(t.stateNode,t.type,e))}}function cI(t){vh?xh?xh.push(t):xh=[t]:vh=t}function uI(){if(vh){var t=vh,e=xh;if(xh=vh=null,aE(t),e)for(t=0;t<e.length;t++)aE(e[t])}}function hI(t,e){return t(e)}function dI(){}var o0=!1;function fI(t,e,n){if(o0)return t(e,n);o0=!0;try{return hI(t,e,n)}finally{o0=!1,(vh!==null||xh!==null)&&(dI(),uI())}}function Nf(t,e){var n=t.stateNode;if(n===null)return null;var i=w_(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Xe(231,e,typeof n));return n}var qv=!1;if(Va)try{var $d={};Object.defineProperty($d,"passive",{get:function(){qv=!0}}),window.addEventListener("test",$d,$d),window.removeEventListener("test",$d,$d)}catch{qv=!1}function I3(t,e,n,i,r,a,h,l,_){var v=Array.prototype.slice.call(arguments,3);try{e.apply(n,v)}catch(S){this.onError(S)}}var Af=!1,Ig=null,Pg=!1,Xv=null,P3={onError:function(t){Af=!0,Ig=t}};function M3(t,e,n,i,r,a,h,l,_){Af=!1,Ig=null,I3.apply(P3,arguments)}function B3(t,e,n,i,r,a,h,l,_){if(M3.apply(this,arguments),Af){if(Af){var v=Ig;Af=!1,Ig=null}else throw Error(Xe(198));Pg||(Pg=!0,Xv=v)}}function Kc(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function pI(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function lE(t){if(Kc(t)!==t)throw Error(Xe(188))}function L3(t){var e=t.alternate;if(!e){if(e=Kc(t),e===null)throw Error(Xe(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var a=r.alternate;if(a===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return lE(r),t;if(a===i)return lE(r),e;a=a.sibling}throw Error(Xe(188))}if(n.return!==i.return)n=r,i=a;else{for(var h=!1,l=r.child;l;){if(l===n){h=!0,n=r,i=a;break}if(l===i){h=!0,i=r,n=a;break}l=l.sibling}if(!h){for(l=a.child;l;){if(l===n){h=!0,n=a,i=r;break}if(l===i){h=!0,i=a,n=r;break}l=l.sibling}if(!h)throw Error(Xe(189))}}if(n.alternate!==i)throw Error(Xe(190))}if(n.tag!==3)throw Error(Xe(188));return n.stateNode.current===n?t:e}function mI(t){return t=L3(t),t!==null?gI(t):null}function gI(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=gI(t);if(e!==null)return e;t=t.sibling}return null}var _I=Rs.unstable_scheduleCallback,cE=Rs.unstable_cancelCallback,R3=Rs.unstable_shouldYield,D3=Rs.unstable_requestPaint,Ei=Rs.unstable_now,O3=Rs.unstable_getCurrentPriorityLevel,Ex=Rs.unstable_ImmediatePriority,yI=Rs.unstable_UserBlockingPriority,Mg=Rs.unstable_NormalPriority,F3=Rs.unstable_LowPriority,vI=Rs.unstable_IdlePriority,y_=null,la=null;function k3(t){if(la&&typeof la.onCommitFiberRoot=="function")try{la.onCommitFiberRoot(y_,t,void 0,(t.current.flags&128)===128)}catch{}}var Lo=Math.clz32?Math.clz32:U3,z3=Math.log,N3=Math.LN2;function U3(t){return t>>>=0,t===0?32:31-(z3(t)/N3|0)|0}var vm=64,xm=4194304;function _f(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Bg(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,a=t.pingedLanes,h=n&268435455;if(h!==0){var l=h&~r;l!==0?i=_f(l):(a&=h,a!==0&&(i=_f(a)))}else h=n&~r,h!==0?i=_f(h):a!==0&&(i=_f(a));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,a=e&-e,r>=a||r===16&&(a&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Lo(e),r=1<<n,i|=t[n],e&=~r;return i}function G3(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function V3(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,a=t.pendingLanes;0<a;){var h=31-Lo(a),l=1<<h,_=r[h];_===-1?(!(l&n)||l&i)&&(r[h]=G3(l,e)):_<=e&&(t.expiredLanes|=l),a&=~l}}function $v(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function xI(){var t=vm;return vm<<=1,!(vm&4194240)&&(vm=64),t}function a0(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function cp(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Lo(e),t[e]=n}function j3(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Lo(n),a=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~a}}function Tx(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Lo(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var yn=0;function bI(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var wI,Sx,AI,EI,TI,Zv=!1,bm=[],Ll=null,Rl=null,Dl=null,Uf=new Map,Gf=new Map,Cl=[],H3="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function uE(t,e){switch(t){case"focusin":case"focusout":Ll=null;break;case"dragenter":case"dragleave":Rl=null;break;case"mouseover":case"mouseout":Dl=null;break;case"pointerover":case"pointerout":Uf.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gf.delete(e.pointerId)}}function Zd(t,e,n,i,r,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},e!==null&&(e=hp(e),e!==null&&Sx(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function W3(t,e,n,i,r){switch(e){case"focusin":return Ll=Zd(Ll,t,e,n,i,r),!0;case"dragenter":return Rl=Zd(Rl,t,e,n,i,r),!0;case"mouseover":return Dl=Zd(Dl,t,e,n,i,r),!0;case"pointerover":var a=r.pointerId;return Uf.set(a,Zd(Uf.get(a)||null,t,e,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,Gf.set(a,Zd(Gf.get(a)||null,t,e,n,i,r)),!0}return!1}function SI(t){var e=Rc(t.target);if(e!==null){var n=Kc(e);if(n!==null){if(e=n.tag,e===13){if(e=pI(n),e!==null){t.blockedOn=e,TI(t.priority,function(){AI(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ag(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Jv(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Hv=i,n.target.dispatchEvent(i),Hv=null}else return e=hp(n),e!==null&&Sx(e),t.blockedOn=n,!1;e.shift()}return!0}function hE(t,e,n){ag(t)&&n.delete(e)}function q3(){Zv=!1,Ll!==null&&ag(Ll)&&(Ll=null),Rl!==null&&ag(Rl)&&(Rl=null),Dl!==null&&ag(Dl)&&(Dl=null),Uf.forEach(hE),Gf.forEach(hE)}function Jd(t,e){t.blockedOn===e&&(t.blockedOn=null,Zv||(Zv=!0,Rs.unstable_scheduleCallback(Rs.unstable_NormalPriority,q3)))}function Vf(t){function e(r){return Jd(r,t)}if(0<bm.length){Jd(bm[0],t);for(var n=1;n<bm.length;n++){var i=bm[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Ll!==null&&Jd(Ll,t),Rl!==null&&Jd(Rl,t),Dl!==null&&Jd(Dl,t),Uf.forEach(e),Gf.forEach(e),n=0;n<Cl.length;n++)i=Cl[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Cl.length&&(n=Cl[0],n.blockedOn===null);)SI(n),n.blockedOn===null&&Cl.shift()}var bh=Za.ReactCurrentBatchConfig,Lg=!0;function X3(t,e,n,i){var r=yn,a=bh.transition;bh.transition=null;try{yn=1,Cx(t,e,n,i)}finally{yn=r,bh.transition=a}}function $3(t,e,n,i){var r=yn,a=bh.transition;bh.transition=null;try{yn=4,Cx(t,e,n,i)}finally{yn=r,bh.transition=a}}function Cx(t,e,n,i){if(Lg){var r=Jv(t,e,n,i);if(r===null)_0(t,e,i,Rg,n),uE(t,i);else if(W3(r,t,e,n,i))i.stopPropagation();else if(uE(t,i),e&4&&-1<H3.indexOf(t)){for(;r!==null;){var a=hp(r);if(a!==null&&wI(a),a=Jv(t,e,n,i),a===null&&_0(t,e,i,Rg,n),a===r)break;r=a}r!==null&&i.stopPropagation()}else _0(t,e,i,null,n)}}var Rg=null;function Jv(t,e,n,i){if(Rg=null,t=Ax(i),t=Rc(t),t!==null)if(e=Kc(t),e===null)t=null;else if(n=e.tag,n===13){if(t=pI(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Rg=t,null}function CI(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(O3()){case Ex:return 1;case yI:return 4;case Mg:case F3:return 16;case vI:return 536870912;default:return 16}default:return 16}}var Pl=null,Ix=null,lg=null;function II(){if(lg)return lg;var t,e=Ix,n=e.length,i,r="value"in Pl?Pl.value:Pl.textContent,a=r.length;for(t=0;t<n&&e[t]===r[t];t++);var h=n-t;for(i=1;i<=h&&e[n-i]===r[a-i];i++);return lg=r.slice(t,1<i?1-i:void 0)}function cg(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function wm(){return!0}function dE(){return!1}function Fs(t){function e(n,i,r,a,h){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=a,this.target=h,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(a):a[l]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?wm:dE,this.isPropagationStopped=dE,this}return oi(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=wm)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=wm)},persist:function(){},isPersistent:wm}),e}var Zh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Px=Fs(Zh),up=oi({},Zh,{view:0,detail:0}),Z3=Fs(up),l0,c0,Kd,v_=oi({},up,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mx,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Kd&&(Kd&&t.type==="mousemove"?(l0=t.screenX-Kd.screenX,c0=t.screenY-Kd.screenY):c0=l0=0,Kd=t),l0)},movementY:function(t){return"movementY"in t?t.movementY:c0}}),fE=Fs(v_),J3=oi({},v_,{dataTransfer:0}),K3=Fs(J3),Y3=oi({},up,{relatedTarget:0}),u0=Fs(Y3),Q3=oi({},Zh,{animationName:0,elapsedTime:0,pseudoElement:0}),eO=Fs(Q3),tO=oi({},Zh,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),nO=Fs(tO),iO=oi({},Zh,{data:0}),pE=Fs(iO),rO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},sO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},oO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function aO(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=oO[t])?!!e[t]:!1}function Mx(){return aO}var lO=oi({},up,{key:function(t){if(t.key){var e=rO[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=cg(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?sO[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mx,charCode:function(t){return t.type==="keypress"?cg(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?cg(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),cO=Fs(lO),uO=oi({},v_,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),mE=Fs(uO),hO=oi({},up,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mx}),dO=Fs(hO),fO=oi({},Zh,{propertyName:0,elapsedTime:0,pseudoElement:0}),pO=Fs(fO),mO=oi({},v_,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),gO=Fs(mO),_O=[9,13,27,32],Bx=Va&&"CompositionEvent"in window,Ef=null;Va&&"documentMode"in document&&(Ef=document.documentMode);var yO=Va&&"TextEvent"in window&&!Ef,PI=Va&&(!Bx||Ef&&8<Ef&&11>=Ef),gE=String.fromCharCode(32),_E=!1;function MI(t,e){switch(t){case"keyup":return _O.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function BI(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var rh=!1;function vO(t,e){switch(t){case"compositionend":return BI(e);case"keypress":return e.which!==32?null:(_E=!0,gE);case"textInput":return t=e.data,t===gE&&_E?null:t;default:return null}}function xO(t,e){if(rh)return t==="compositionend"||!Bx&&MI(t,e)?(t=II(),lg=Ix=Pl=null,rh=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return PI&&e.locale!=="ko"?null:e.data;default:return null}}var bO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yE(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!bO[t.type]:e==="textarea"}function LI(t,e,n,i){cI(i),e=Dg(e,"onChange"),0<e.length&&(n=new Px("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Tf=null,jf=null;function wO(t){jI(t,0)}function x_(t){var e=ah(t);if(nI(e))return t}function AO(t,e){if(t==="change")return e}var RI=!1;if(Va){var h0;if(Va){var d0="oninput"in document;if(!d0){var vE=document.createElement("div");vE.setAttribute("oninput","return;"),d0=typeof vE.oninput=="function"}h0=d0}else h0=!1;RI=h0&&(!document.documentMode||9<document.documentMode)}function xE(){Tf&&(Tf.detachEvent("onpropertychange",DI),jf=Tf=null)}function DI(t){if(t.propertyName==="value"&&x_(jf)){var e=[];LI(e,jf,t,Ax(t)),fI(wO,e)}}function EO(t,e,n){t==="focusin"?(xE(),Tf=e,jf=n,Tf.attachEvent("onpropertychange",DI)):t==="focusout"&&xE()}function TO(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return x_(jf)}function SO(t,e){if(t==="click")return x_(e)}function CO(t,e){if(t==="input"||t==="change")return x_(e)}function IO(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Fo=typeof Object.is=="function"?Object.is:IO;function Hf(t,e){if(Fo(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Lv.call(e,r)||!Fo(t[r],e[r]))return!1}return!0}function bE(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function wE(t,e){var n=bE(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=bE(n)}}function OI(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?OI(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function FI(){for(var t=window,e=Cg();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Cg(t.document)}return e}function Lx(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function PO(t){var e=FI(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&OI(n.ownerDocument.documentElement,n)){if(i!==null&&Lx(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,a=Math.min(i.start,r);i=i.end===void 0?a:Math.min(i.end,r),!t.extend&&a>i&&(r=i,i=a,a=r),r=wE(n,a);var h=wE(n,i);r&&h&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==h.node||t.focusOffset!==h.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),a>i?(t.addRange(e),t.extend(h.node,h.offset)):(e.setEnd(h.node,h.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var MO=Va&&"documentMode"in document&&11>=document.documentMode,sh=null,Kv=null,Sf=null,Yv=!1;function AE(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Yv||sh==null||sh!==Cg(i)||(i=sh,"selectionStart"in i&&Lx(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Sf&&Hf(Sf,i)||(Sf=i,i=Dg(Kv,"onSelect"),0<i.length&&(e=new Px("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=sh)))}function Am(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var oh={animationend:Am("Animation","AnimationEnd"),animationiteration:Am("Animation","AnimationIteration"),animationstart:Am("Animation","AnimationStart"),transitionend:Am("Transition","TransitionEnd")},f0={},kI={};Va&&(kI=document.createElement("div").style,"AnimationEvent"in window||(delete oh.animationend.animation,delete oh.animationiteration.animation,delete oh.animationstart.animation),"TransitionEvent"in window||delete oh.transitionend.transition);function b_(t){if(f0[t])return f0[t];if(!oh[t])return t;var e=oh[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in kI)return f0[t]=e[n];return t}var zI=b_("animationend"),NI=b_("animationiteration"),UI=b_("animationstart"),GI=b_("transitionend"),VI=new Map,EE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ql(t,e){VI.set(t,e),Jc(e,[t])}for(var p0=0;p0<EE.length;p0++){var m0=EE[p0],BO=m0.toLowerCase(),LO=m0[0].toUpperCase()+m0.slice(1);ql(BO,"on"+LO)}ql(zI,"onAnimationEnd");ql(NI,"onAnimationIteration");ql(UI,"onAnimationStart");ql("dblclick","onDoubleClick");ql("focusin","onFocus");ql("focusout","onBlur");ql(GI,"onTransitionEnd");Ph("onMouseEnter",["mouseout","mouseover"]);Ph("onMouseLeave",["mouseout","mouseover"]);Ph("onPointerEnter",["pointerout","pointerover"]);Ph("onPointerLeave",["pointerout","pointerover"]);Jc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Jc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Jc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Jc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Jc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Jc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),RO=new Set("cancel close invalid load scroll toggle".split(" ").concat(yf));function TE(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,B3(i,e,void 0,t),t.currentTarget=null}function jI(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var a=void 0;if(e)for(var h=i.length-1;0<=h;h--){var l=i[h],_=l.instance,v=l.currentTarget;if(l=l.listener,_!==a&&r.isPropagationStopped())break e;TE(r,l,v),a=_}else for(h=0;h<i.length;h++){if(l=i[h],_=l.instance,v=l.currentTarget,l=l.listener,_!==a&&r.isPropagationStopped())break e;TE(r,l,v),a=_}}}if(Pg)throw t=Xv,Pg=!1,Xv=null,t}function Gn(t,e){var n=e[i1];n===void 0&&(n=e[i1]=new Set);var i=t+"__bubble";n.has(i)||(HI(e,t,2,!1),n.add(i))}function g0(t,e,n){var i=0;e&&(i|=4),HI(n,t,i,e)}var Em="_reactListening"+Math.random().toString(36).slice(2);function Wf(t){if(!t[Em]){t[Em]=!0,K2.forEach(function(n){n!=="selectionchange"&&(RO.has(n)||g0(n,!1,t),g0(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Em]||(e[Em]=!0,g0("selectionchange",!1,e))}}function HI(t,e,n,i){switch(CI(e)){case 1:var r=X3;break;case 4:r=$3;break;default:r=Cx}n=r.bind(null,e,n,t),r=void 0,!qv||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function _0(t,e,n,i,r){var a=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var h=i.tag;if(h===3||h===4){var l=i.stateNode.containerInfo;if(l===r||l.nodeType===8&&l.parentNode===r)break;if(h===4)for(h=i.return;h!==null;){var _=h.tag;if((_===3||_===4)&&(_=h.stateNode.containerInfo,_===r||_.nodeType===8&&_.parentNode===r))return;h=h.return}for(;l!==null;){if(h=Rc(l),h===null)return;if(_=h.tag,_===5||_===6){i=a=h;continue e}l=l.parentNode}}i=i.return}fI(function(){var v=a,S=Ax(n),I=[];e:{var B=VI.get(t);if(B!==void 0){var z=Px,V=t;switch(t){case"keypress":if(cg(n)===0)break e;case"keydown":case"keyup":z=cO;break;case"focusin":V="focus",z=u0;break;case"focusout":V="blur",z=u0;break;case"beforeblur":case"afterblur":z=u0;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":z=fE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":z=K3;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":z=dO;break;case zI:case NI:case UI:z=eO;break;case GI:z=pO;break;case"scroll":z=Z3;break;case"wheel":z=gO;break;case"copy":case"cut":case"paste":z=nO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":z=mE}var J=(e&4)!==0,ue=!J&&t==="scroll",j=J?B!==null?B+"Capture":null:B;J=[];for(var W=v,Z;W!==null;){Z=W;var ae=Z.stateNode;if(Z.tag===5&&ae!==null&&(Z=ae,j!==null&&(ae=Nf(W,j),ae!=null&&J.push(qf(W,ae,Z)))),ue)break;W=W.return}0<J.length&&(B=new z(B,V,null,n,S),I.push({event:B,listeners:J}))}}if(!(e&7)){e:{if(B=t==="mouseover"||t==="pointerover",z=t==="mouseout"||t==="pointerout",B&&n!==Hv&&(V=n.relatedTarget||n.fromElement)&&(Rc(V)||V[ja]))break e;if((z||B)&&(B=S.window===S?S:(B=S.ownerDocument)?B.defaultView||B.parentWindow:window,z?(V=n.relatedTarget||n.toElement,z=v,V=V?Rc(V):null,V!==null&&(ue=Kc(V),V!==ue||V.tag!==5&&V.tag!==6)&&(V=null)):(z=null,V=v),z!==V)){if(J=fE,ae="onMouseLeave",j="onMouseEnter",W="mouse",(t==="pointerout"||t==="pointerover")&&(J=mE,ae="onPointerLeave",j="onPointerEnter",W="pointer"),ue=z==null?B:ah(z),Z=V==null?B:ah(V),B=new J(ae,W+"leave",z,n,S),B.target=ue,B.relatedTarget=Z,ae=null,Rc(S)===v&&(J=new J(j,W+"enter",V,n,S),J.target=Z,J.relatedTarget=ue,ae=J),ue=ae,z&&V)t:{for(J=z,j=V,W=0,Z=J;Z;Z=Vu(Z))W++;for(Z=0,ae=j;ae;ae=Vu(ae))Z++;for(;0<W-Z;)J=Vu(J),W--;for(;0<Z-W;)j=Vu(j),Z--;for(;W--;){if(J===j||j!==null&&J===j.alternate)break t;J=Vu(J),j=Vu(j)}J=null}else J=null;z!==null&&SE(I,B,z,J,!1),V!==null&&ue!==null&&SE(I,ue,V,J,!0)}}e:{if(B=v?ah(v):window,z=B.nodeName&&B.nodeName.toLowerCase(),z==="select"||z==="input"&&B.type==="file")var be=AO;else if(yE(B))if(RI)be=CO;else{be=TO;var Ee=EO}else(z=B.nodeName)&&z.toLowerCase()==="input"&&(B.type==="checkbox"||B.type==="radio")&&(be=SO);if(be&&(be=be(t,v))){LI(I,be,n,S);break e}Ee&&Ee(t,B,v),t==="focusout"&&(Ee=B._wrapperState)&&Ee.controlled&&B.type==="number"&&Nv(B,"number",B.value)}switch(Ee=v?ah(v):window,t){case"focusin":(yE(Ee)||Ee.contentEditable==="true")&&(sh=Ee,Kv=v,Sf=null);break;case"focusout":Sf=Kv=sh=null;break;case"mousedown":Yv=!0;break;case"contextmenu":case"mouseup":case"dragend":Yv=!1,AE(I,n,S);break;case"selectionchange":if(MO)break;case"keydown":case"keyup":AE(I,n,S)}var Le;if(Bx)e:{switch(t){case"compositionstart":var ke="onCompositionStart";break e;case"compositionend":ke="onCompositionEnd";break e;case"compositionupdate":ke="onCompositionUpdate";break e}ke=void 0}else rh?MI(t,n)&&(ke="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(ke="onCompositionStart");ke&&(PI&&n.locale!=="ko"&&(rh||ke!=="onCompositionStart"?ke==="onCompositionEnd"&&rh&&(Le=II()):(Pl=S,Ix="value"in Pl?Pl.value:Pl.textContent,rh=!0)),Ee=Dg(v,ke),0<Ee.length&&(ke=new pE(ke,t,null,n,S),I.push({event:ke,listeners:Ee}),Le?ke.data=Le:(Le=BI(n),Le!==null&&(ke.data=Le)))),(Le=yO?vO(t,n):xO(t,n))&&(v=Dg(v,"onBeforeInput"),0<v.length&&(S=new pE("onBeforeInput","beforeinput",null,n,S),I.push({event:S,listeners:v}),S.data=Le))}jI(I,e)})}function qf(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Dg(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,a=r.stateNode;r.tag===5&&a!==null&&(r=a,a=Nf(t,n),a!=null&&i.unshift(qf(t,a,r)),a=Nf(t,e),a!=null&&i.push(qf(t,a,r))),t=t.return}return i}function Vu(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function SE(t,e,n,i,r){for(var a=e._reactName,h=[];n!==null&&n!==i;){var l=n,_=l.alternate,v=l.stateNode;if(_!==null&&_===i)break;l.tag===5&&v!==null&&(l=v,r?(_=Nf(n,a),_!=null&&h.unshift(qf(n,_,l))):r||(_=Nf(n,a),_!=null&&h.push(qf(n,_,l)))),n=n.return}h.length!==0&&t.push({event:e,listeners:h})}var DO=/\r\n?/g,OO=/\u0000|\uFFFD/g;function CE(t){return(typeof t=="string"?t:""+t).replace(DO,`
`).replace(OO,"")}function Tm(t,e,n){if(e=CE(e),CE(t)!==e&&n)throw Error(Xe(425))}function Og(){}var Qv=null,e1=null;function t1(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var n1=typeof setTimeout=="function"?setTimeout:void 0,FO=typeof clearTimeout=="function"?clearTimeout:void 0,IE=typeof Promise=="function"?Promise:void 0,kO=typeof queueMicrotask=="function"?queueMicrotask:typeof IE<"u"?function(t){return IE.resolve(null).then(t).catch(zO)}:n1;function zO(t){setTimeout(function(){throw t})}function y0(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Vf(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Vf(e)}function Ol(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function PE(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Jh=Math.random().toString(36).slice(2),na="__reactFiber$"+Jh,Xf="__reactProps$"+Jh,ja="__reactContainer$"+Jh,i1="__reactEvents$"+Jh,NO="__reactListeners$"+Jh,UO="__reactHandles$"+Jh;function Rc(t){var e=t[na];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ja]||n[na]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=PE(t);t!==null;){if(n=t[na])return n;t=PE(t)}return e}t=n,n=t.parentNode}return null}function hp(t){return t=t[na]||t[ja],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ah(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Xe(33))}function w_(t){return t[Xf]||null}var r1=[],lh=-1;function Xl(t){return{current:t}}function Vn(t){0>lh||(t.current=r1[lh],r1[lh]=null,lh--)}function kn(t,e){lh++,r1[lh]=t.current,t.current=e}var jl={},Cr=Xl(jl),ls=Xl(!1),Vc=jl;function Mh(t,e){var n=t.type.contextTypes;if(!n)return jl;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},a;for(a in n)r[a]=e[a];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function cs(t){return t=t.childContextTypes,t!=null}function Fg(){Vn(ls),Vn(Cr)}function ME(t,e,n){if(Cr.current!==jl)throw Error(Xe(168));kn(Cr,e),kn(ls,n)}function WI(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(Xe(108,E3(t)||"Unknown",r));return oi({},n,i)}function kg(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||jl,Vc=Cr.current,kn(Cr,t),kn(ls,ls.current),!0}function BE(t,e,n){var i=t.stateNode;if(!i)throw Error(Xe(169));n?(t=WI(t,e,Vc),i.__reactInternalMemoizedMergedChildContext=t,Vn(ls),Vn(Cr),kn(Cr,t)):Vn(ls),kn(ls,n)}var Ba=null,A_=!1,v0=!1;function qI(t){Ba===null?Ba=[t]:Ba.push(t)}function GO(t){A_=!0,qI(t)}function $l(){if(!v0&&Ba!==null){v0=!0;var t=0,e=yn;try{var n=Ba;for(yn=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Ba=null,A_=!1}catch(r){throw Ba!==null&&(Ba=Ba.slice(t+1)),_I(Ex,$l),r}finally{yn=e,v0=!1}}return null}var ch=[],uh=0,zg=null,Ng=0,Ys=[],Qs=0,jc=null,Da=1,Oa="";function Mc(t,e){ch[uh++]=Ng,ch[uh++]=zg,zg=t,Ng=e}function XI(t,e,n){Ys[Qs++]=Da,Ys[Qs++]=Oa,Ys[Qs++]=jc,jc=t;var i=Da;t=Oa;var r=32-Lo(i)-1;i&=~(1<<r),n+=1;var a=32-Lo(e)+r;if(30<a){var h=r-r%5;a=(i&(1<<h)-1).toString(32),i>>=h,r-=h,Da=1<<32-Lo(e)+r|n<<r|i,Oa=a+t}else Da=1<<a|n<<r|i,Oa=t}function Rx(t){t.return!==null&&(Mc(t,1),XI(t,1,0))}function Dx(t){for(;t===zg;)zg=ch[--uh],ch[uh]=null,Ng=ch[--uh],ch[uh]=null;for(;t===jc;)jc=Ys[--Qs],Ys[Qs]=null,Oa=Ys[--Qs],Ys[Qs]=null,Da=Ys[--Qs],Ys[Qs]=null}var Bs=null,Ps=null,Zn=!1,Co=null;function $I(t,e){var n=eo(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function LE(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Bs=t,Ps=Ol(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Bs=t,Ps=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=jc!==null?{id:Da,overflow:Oa}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=eo(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Bs=t,Ps=null,!0):!1;default:return!1}}function s1(t){return(t.mode&1)!==0&&(t.flags&128)===0}function o1(t){if(Zn){var e=Ps;if(e){var n=e;if(!LE(t,e)){if(s1(t))throw Error(Xe(418));e=Ol(n.nextSibling);var i=Bs;e&&LE(t,e)?$I(i,n):(t.flags=t.flags&-4097|2,Zn=!1,Bs=t)}}else{if(s1(t))throw Error(Xe(418));t.flags=t.flags&-4097|2,Zn=!1,Bs=t}}}function RE(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Bs=t}function Sm(t){if(t!==Bs)return!1;if(!Zn)return RE(t),Zn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!t1(t.type,t.memoizedProps)),e&&(e=Ps)){if(s1(t))throw ZI(),Error(Xe(418));for(;e;)$I(t,e),e=Ol(e.nextSibling)}if(RE(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Xe(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Ps=Ol(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Ps=null}}else Ps=Bs?Ol(t.stateNode.nextSibling):null;return!0}function ZI(){for(var t=Ps;t;)t=Ol(t.nextSibling)}function Bh(){Ps=Bs=null,Zn=!1}function Ox(t){Co===null?Co=[t]:Co.push(t)}var VO=Za.ReactCurrentBatchConfig;function To(t,e){if(t&&t.defaultProps){e=oi({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Ug=Xl(null),Gg=null,hh=null,Fx=null;function kx(){Fx=hh=Gg=null}function zx(t){var e=Ug.current;Vn(Ug),t._currentValue=e}function a1(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function wh(t,e){Gg=t,Fx=hh=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(os=!0),t.firstContext=null)}function oo(t){var e=t._currentValue;if(Fx!==t)if(t={context:t,memoizedValue:e,next:null},hh===null){if(Gg===null)throw Error(Xe(308));hh=t,Gg.dependencies={lanes:0,firstContext:t}}else hh=hh.next=t;return e}var Dc=null;function Nx(t){Dc===null?Dc=[t]:Dc.push(t)}function JI(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Nx(e)):(n.next=r.next,r.next=n),e.interleaved=n,Ha(t,i)}function Ha(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Sl=!1;function Ux(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function KI(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Na(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Fl(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,an&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Ha(t,n)}return r=i.interleaved,r===null?(e.next=e,Nx(i)):(e.next=r.next,r.next=e),i.interleaved=e,Ha(t,n)}function ug(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Tx(t,n)}}function DE(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var h={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?r=a=h:a=a.next=h,n=n.next}while(n!==null);a===null?r=a=e:a=a.next=e}else r=a=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Vg(t,e,n,i){var r=t.updateQueue;Sl=!1;var a=r.firstBaseUpdate,h=r.lastBaseUpdate,l=r.shared.pending;if(l!==null){r.shared.pending=null;var _=l,v=_.next;_.next=null,h===null?a=v:h.next=v,h=_;var S=t.alternate;S!==null&&(S=S.updateQueue,l=S.lastBaseUpdate,l!==h&&(l===null?S.firstBaseUpdate=v:l.next=v,S.lastBaseUpdate=_))}if(a!==null){var I=r.baseState;h=0,S=v=_=null,l=a;do{var B=l.lane,z=l.eventTime;if((i&B)===B){S!==null&&(S=S.next={eventTime:z,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var V=t,J=l;switch(B=e,z=n,J.tag){case 1:if(V=J.payload,typeof V=="function"){I=V.call(z,I,B);break e}I=V;break e;case 3:V.flags=V.flags&-65537|128;case 0:if(V=J.payload,B=typeof V=="function"?V.call(z,I,B):V,B==null)break e;I=oi({},I,B);break e;case 2:Sl=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,B=r.effects,B===null?r.effects=[l]:B.push(l))}else z={eventTime:z,lane:B,tag:l.tag,payload:l.payload,callback:l.callback,next:null},S===null?(v=S=z,_=I):S=S.next=z,h|=B;if(l=l.next,l===null){if(l=r.shared.pending,l===null)break;B=l,l=B.next,B.next=null,r.lastBaseUpdate=B,r.shared.pending=null}}while(1);if(S===null&&(_=I),r.baseState=_,r.firstBaseUpdate=v,r.lastBaseUpdate=S,e=r.shared.interleaved,e!==null){r=e;do h|=r.lane,r=r.next;while(r!==e)}else a===null&&(r.shared.lanes=0);Wc|=h,t.lanes=h,t.memoizedState=I}}function OE(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(Xe(191,r));r.call(i)}}}var YI=new J2.Component().refs;function l1(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:oi({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var E_={isMounted:function(t){return(t=t._reactInternals)?Kc(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Hr(),r=zl(t),a=Na(i,r);a.payload=e,n!=null&&(a.callback=n),e=Fl(t,a,r),e!==null&&(Ro(e,t,r,i),ug(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Hr(),r=zl(t),a=Na(i,r);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=Fl(t,a,r),e!==null&&(Ro(e,t,r,i),ug(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Hr(),i=zl(t),r=Na(n,i);r.tag=2,e!=null&&(r.callback=e),e=Fl(t,r,i),e!==null&&(Ro(e,t,i,n),ug(e,t,i))}};function FE(t,e,n,i,r,a,h){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,a,h):e.prototype&&e.prototype.isPureReactComponent?!Hf(n,i)||!Hf(r,a):!0}function QI(t,e,n){var i=!1,r=jl,a=e.contextType;return typeof a=="object"&&a!==null?a=oo(a):(r=cs(e)?Vc:Cr.current,i=e.contextTypes,a=(i=i!=null)?Mh(t,r):jl),e=new e(n,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=E_,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=a),e}function kE(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&E_.enqueueReplaceState(e,e.state,null)}function c1(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=YI,Ux(t);var a=e.contextType;typeof a=="object"&&a!==null?r.context=oo(a):(a=cs(e)?Vc:Cr.current,r.context=Mh(t,a)),r.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(l1(t,e,a,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&E_.enqueueReplaceState(r,r.state,null),Vg(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Yd(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Xe(309));var i=n.stateNode}if(!i)throw Error(Xe(147,t));var r=i,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(h){var l=r.refs;l===YI&&(l=r.refs={}),h===null?delete l[a]:l[a]=h},e._stringRef=a,e)}if(typeof t!="string")throw Error(Xe(284));if(!n._owner)throw Error(Xe(290,t))}return t}function Cm(t,e){throw t=Object.prototype.toString.call(e),Error(Xe(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function zE(t){var e=t._init;return e(t._payload)}function eP(t){function e(j,W){if(t){var Z=j.deletions;Z===null?(j.deletions=[W],j.flags|=16):Z.push(W)}}function n(j,W){if(!t)return null;for(;W!==null;)e(j,W),W=W.sibling;return null}function i(j,W){for(j=new Map;W!==null;)W.key!==null?j.set(W.key,W):j.set(W.index,W),W=W.sibling;return j}function r(j,W){return j=Nl(j,W),j.index=0,j.sibling=null,j}function a(j,W,Z){return j.index=Z,t?(Z=j.alternate,Z!==null?(Z=Z.index,Z<W?(j.flags|=2,W):Z):(j.flags|=2,W)):(j.flags|=1048576,W)}function h(j){return t&&j.alternate===null&&(j.flags|=2),j}function l(j,W,Z,ae){return W===null||W.tag!==6?(W=S0(Z,j.mode,ae),W.return=j,W):(W=r(W,Z),W.return=j,W)}function _(j,W,Z,ae){var be=Z.type;return be===ih?S(j,W,Z.props.children,ae,Z.key):W!==null&&(W.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===Tl&&zE(be)===W.type)?(ae=r(W,Z.props),ae.ref=Yd(j,W,Z),ae.return=j,ae):(ae=gg(Z.type,Z.key,Z.props,null,j.mode,ae),ae.ref=Yd(j,W,Z),ae.return=j,ae)}function v(j,W,Z,ae){return W===null||W.tag!==4||W.stateNode.containerInfo!==Z.containerInfo||W.stateNode.implementation!==Z.implementation?(W=C0(Z,j.mode,ae),W.return=j,W):(W=r(W,Z.children||[]),W.return=j,W)}function S(j,W,Z,ae,be){return W===null||W.tag!==7?(W=Nc(Z,j.mode,ae,be),W.return=j,W):(W=r(W,Z),W.return=j,W)}function I(j,W,Z){if(typeof W=="string"&&W!==""||typeof W=="number")return W=S0(""+W,j.mode,Z),W.return=j,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case gm:return Z=gg(W.type,W.key,W.props,null,j.mode,Z),Z.ref=Yd(j,null,W),Z.return=j,Z;case nh:return W=C0(W,j.mode,Z),W.return=j,W;case Tl:var ae=W._init;return I(j,ae(W._payload),Z)}if(gf(W)||Xd(W))return W=Nc(W,j.mode,Z,null),W.return=j,W;Cm(j,W)}return null}function B(j,W,Z,ae){var be=W!==null?W.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number")return be!==null?null:l(j,W,""+Z,ae);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case gm:return Z.key===be?_(j,W,Z,ae):null;case nh:return Z.key===be?v(j,W,Z,ae):null;case Tl:return be=Z._init,B(j,W,be(Z._payload),ae)}if(gf(Z)||Xd(Z))return be!==null?null:S(j,W,Z,ae,null);Cm(j,Z)}return null}function z(j,W,Z,ae,be){if(typeof ae=="string"&&ae!==""||typeof ae=="number")return j=j.get(Z)||null,l(W,j,""+ae,be);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case gm:return j=j.get(ae.key===null?Z:ae.key)||null,_(W,j,ae,be);case nh:return j=j.get(ae.key===null?Z:ae.key)||null,v(W,j,ae,be);case Tl:var Ee=ae._init;return z(j,W,Z,Ee(ae._payload),be)}if(gf(ae)||Xd(ae))return j=j.get(Z)||null,S(W,j,ae,be,null);Cm(W,ae)}return null}function V(j,W,Z,ae){for(var be=null,Ee=null,Le=W,ke=W=0,Ue=null;Le!==null&&ke<Z.length;ke++){Le.index>ke?(Ue=Le,Le=null):Ue=Le.sibling;var Me=B(j,Le,Z[ke],ae);if(Me===null){Le===null&&(Le=Ue);break}t&&Le&&Me.alternate===null&&e(j,Le),W=a(Me,W,ke),Ee===null?be=Me:Ee.sibling=Me,Ee=Me,Le=Ue}if(ke===Z.length)return n(j,Le),Zn&&Mc(j,ke),be;if(Le===null){for(;ke<Z.length;ke++)Le=I(j,Z[ke],ae),Le!==null&&(W=a(Le,W,ke),Ee===null?be=Le:Ee.sibling=Le,Ee=Le);return Zn&&Mc(j,ke),be}for(Le=i(j,Le);ke<Z.length;ke++)Ue=z(Le,j,ke,Z[ke],ae),Ue!==null&&(t&&Ue.alternate!==null&&Le.delete(Ue.key===null?ke:Ue.key),W=a(Ue,W,ke),Ee===null?be=Ue:Ee.sibling=Ue,Ee=Ue);return t&&Le.forEach(function(ut){return e(j,ut)}),Zn&&Mc(j,ke),be}function J(j,W,Z,ae){var be=Xd(Z);if(typeof be!="function")throw Error(Xe(150));if(Z=be.call(Z),Z==null)throw Error(Xe(151));for(var Ee=be=null,Le=W,ke=W=0,Ue=null,Me=Z.next();Le!==null&&!Me.done;ke++,Me=Z.next()){Le.index>ke?(Ue=Le,Le=null):Ue=Le.sibling;var ut=B(j,Le,Me.value,ae);if(ut===null){Le===null&&(Le=Ue);break}t&&Le&&ut.alternate===null&&e(j,Le),W=a(ut,W,ke),Ee===null?be=ut:Ee.sibling=ut,Ee=ut,Le=Ue}if(Me.done)return n(j,Le),Zn&&Mc(j,ke),be;if(Le===null){for(;!Me.done;ke++,Me=Z.next())Me=I(j,Me.value,ae),Me!==null&&(W=a(Me,W,ke),Ee===null?be=Me:Ee.sibling=Me,Ee=Me);return Zn&&Mc(j,ke),be}for(Le=i(j,Le);!Me.done;ke++,Me=Z.next())Me=z(Le,j,ke,Me.value,ae),Me!==null&&(t&&Me.alternate!==null&&Le.delete(Me.key===null?ke:Me.key),W=a(Me,W,ke),Ee===null?be=Me:Ee.sibling=Me,Ee=Me);return t&&Le.forEach(function(Lt){return e(j,Lt)}),Zn&&Mc(j,ke),be}function ue(j,W,Z,ae){if(typeof Z=="object"&&Z!==null&&Z.type===ih&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case gm:e:{for(var be=Z.key,Ee=W;Ee!==null;){if(Ee.key===be){if(be=Z.type,be===ih){if(Ee.tag===7){n(j,Ee.sibling),W=r(Ee,Z.props.children),W.return=j,j=W;break e}}else if(Ee.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===Tl&&zE(be)===Ee.type){n(j,Ee.sibling),W=r(Ee,Z.props),W.ref=Yd(j,Ee,Z),W.return=j,j=W;break e}n(j,Ee);break}else e(j,Ee);Ee=Ee.sibling}Z.type===ih?(W=Nc(Z.props.children,j.mode,ae,Z.key),W.return=j,j=W):(ae=gg(Z.type,Z.key,Z.props,null,j.mode,ae),ae.ref=Yd(j,W,Z),ae.return=j,j=ae)}return h(j);case nh:e:{for(Ee=Z.key;W!==null;){if(W.key===Ee)if(W.tag===4&&W.stateNode.containerInfo===Z.containerInfo&&W.stateNode.implementation===Z.implementation){n(j,W.sibling),W=r(W,Z.children||[]),W.return=j,j=W;break e}else{n(j,W);break}else e(j,W);W=W.sibling}W=C0(Z,j.mode,ae),W.return=j,j=W}return h(j);case Tl:return Ee=Z._init,ue(j,W,Ee(Z._payload),ae)}if(gf(Z))return V(j,W,Z,ae);if(Xd(Z))return J(j,W,Z,ae);Cm(j,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"?(Z=""+Z,W!==null&&W.tag===6?(n(j,W.sibling),W=r(W,Z),W.return=j,j=W):(n(j,W),W=S0(Z,j.mode,ae),W.return=j,j=W),h(j)):n(j,W)}return ue}var Lh=eP(!0),tP=eP(!1),dp={},ca=Xl(dp),$f=Xl(dp),Zf=Xl(dp);function Oc(t){if(t===dp)throw Error(Xe(174));return t}function Gx(t,e){switch(kn(Zf,e),kn($f,t),kn(ca,dp),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Gv(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Gv(e,t)}Vn(ca),kn(ca,e)}function Rh(){Vn(ca),Vn($f),Vn(Zf)}function nP(t){Oc(Zf.current);var e=Oc(ca.current),n=Gv(e,t.type);e!==n&&(kn($f,t),kn(ca,n))}function Vx(t){$f.current===t&&(Vn(ca),Vn($f))}var ii=Xl(0);function jg(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var x0=[];function jx(){for(var t=0;t<x0.length;t++)x0[t]._workInProgressVersionPrimary=null;x0.length=0}var hg=Za.ReactCurrentDispatcher,b0=Za.ReactCurrentBatchConfig,Hc=0,si=null,zi=null,Ji=null,Hg=!1,Cf=!1,Jf=0,jO=0;function br(){throw Error(Xe(321))}function Hx(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Fo(t[n],e[n]))return!1;return!0}function Wx(t,e,n,i,r,a){if(Hc=a,si=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,hg.current=t===null||t.memoizedState===null?XO:$O,t=n(i,r),Cf){a=0;do{if(Cf=!1,Jf=0,25<=a)throw Error(Xe(301));a+=1,Ji=zi=null,e.updateQueue=null,hg.current=ZO,t=n(i,r)}while(Cf)}if(hg.current=Wg,e=zi!==null&&zi.next!==null,Hc=0,Ji=zi=si=null,Hg=!1,e)throw Error(Xe(300));return t}function qx(){var t=Jf!==0;return Jf=0,t}function ta(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ji===null?si.memoizedState=Ji=t:Ji=Ji.next=t,Ji}function ao(){if(zi===null){var t=si.alternate;t=t!==null?t.memoizedState:null}else t=zi.next;var e=Ji===null?si.memoizedState:Ji.next;if(e!==null)Ji=e,zi=t;else{if(t===null)throw Error(Xe(310));zi=t,t={memoizedState:zi.memoizedState,baseState:zi.baseState,baseQueue:zi.baseQueue,queue:zi.queue,next:null},Ji===null?si.memoizedState=Ji=t:Ji=Ji.next=t}return Ji}function Kf(t,e){return typeof e=="function"?e(t):e}function w0(t){var e=ao(),n=e.queue;if(n===null)throw Error(Xe(311));n.lastRenderedReducer=t;var i=zi,r=i.baseQueue,a=n.pending;if(a!==null){if(r!==null){var h=r.next;r.next=a.next,a.next=h}i.baseQueue=r=a,n.pending=null}if(r!==null){a=r.next,i=i.baseState;var l=h=null,_=null,v=a;do{var S=v.lane;if((Hc&S)===S)_!==null&&(_=_.next={lane:0,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null}),i=v.hasEagerState?v.eagerState:t(i,v.action);else{var I={lane:S,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null};_===null?(l=_=I,h=i):_=_.next=I,si.lanes|=S,Wc|=S}v=v.next}while(v!==null&&v!==a);_===null?h=i:_.next=l,Fo(i,e.memoizedState)||(os=!0),e.memoizedState=i,e.baseState=h,e.baseQueue=_,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do a=r.lane,si.lanes|=a,Wc|=a,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function A0(t){var e=ao(),n=e.queue;if(n===null)throw Error(Xe(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,a=e.memoizedState;if(r!==null){n.pending=null;var h=r=r.next;do a=t(a,h.action),h=h.next;while(h!==r);Fo(a,e.memoizedState)||(os=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),n.lastRenderedState=a}return[a,i]}function iP(){}function rP(t,e){var n=si,i=ao(),r=e(),a=!Fo(i.memoizedState,r);if(a&&(i.memoizedState=r,os=!0),i=i.queue,Xx(aP.bind(null,n,i,t),[t]),i.getSnapshot!==e||a||Ji!==null&&Ji.memoizedState.tag&1){if(n.flags|=2048,Yf(9,oP.bind(null,n,i,r,e),void 0,null),Yi===null)throw Error(Xe(349));Hc&30||sP(n,e,r)}return r}function sP(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=si.updateQueue,e===null?(e={lastEffect:null,stores:null},si.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function oP(t,e,n,i){e.value=n,e.getSnapshot=i,lP(e)&&cP(t)}function aP(t,e,n){return n(function(){lP(e)&&cP(t)})}function lP(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Fo(t,n)}catch{return!0}}function cP(t){var e=Ha(t,1);e!==null&&Ro(e,t,1,-1)}function NE(t){var e=ta();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Kf,lastRenderedState:t},e.queue=t,t=t.dispatch=qO.bind(null,si,t),[e.memoizedState,t]}function Yf(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=si.updateQueue,e===null?(e={lastEffect:null,stores:null},si.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function uP(){return ao().memoizedState}function dg(t,e,n,i){var r=ta();si.flags|=t,r.memoizedState=Yf(1|e,n,void 0,i===void 0?null:i)}function T_(t,e,n,i){var r=ao();i=i===void 0?null:i;var a=void 0;if(zi!==null){var h=zi.memoizedState;if(a=h.destroy,i!==null&&Hx(i,h.deps)){r.memoizedState=Yf(e,n,a,i);return}}si.flags|=t,r.memoizedState=Yf(1|e,n,a,i)}function UE(t,e){return dg(8390656,8,t,e)}function Xx(t,e){return T_(2048,8,t,e)}function hP(t,e){return T_(4,2,t,e)}function dP(t,e){return T_(4,4,t,e)}function fP(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function pP(t,e,n){return n=n!=null?n.concat([t]):null,T_(4,4,fP.bind(null,e,t),n)}function $x(){}function mP(t,e){var n=ao();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Hx(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function gP(t,e){var n=ao();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Hx(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function _P(t,e,n){return Hc&21?(Fo(n,e)||(n=xI(),si.lanes|=n,Wc|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,os=!0),t.memoizedState=n)}function HO(t,e){var n=yn;yn=n!==0&&4>n?n:4,t(!0);var i=b0.transition;b0.transition={};try{t(!1),e()}finally{yn=n,b0.transition=i}}function yP(){return ao().memoizedState}function WO(t,e,n){var i=zl(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},vP(t))xP(e,n);else if(n=JI(t,e,n,i),n!==null){var r=Hr();Ro(n,t,i,r),bP(n,e,i)}}function qO(t,e,n){var i=zl(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(vP(t))xP(e,r);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var h=e.lastRenderedState,l=a(h,n);if(r.hasEagerState=!0,r.eagerState=l,Fo(l,h)){var _=e.interleaved;_===null?(r.next=r,Nx(e)):(r.next=_.next,_.next=r),e.interleaved=r;return}}catch{}finally{}n=JI(t,e,r,i),n!==null&&(r=Hr(),Ro(n,t,i,r),bP(n,e,i))}}function vP(t){var e=t.alternate;return t===si||e!==null&&e===si}function xP(t,e){Cf=Hg=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function bP(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Tx(t,n)}}var Wg={readContext:oo,useCallback:br,useContext:br,useEffect:br,useImperativeHandle:br,useInsertionEffect:br,useLayoutEffect:br,useMemo:br,useReducer:br,useRef:br,useState:br,useDebugValue:br,useDeferredValue:br,useTransition:br,useMutableSource:br,useSyncExternalStore:br,useId:br,unstable_isNewReconciler:!1},XO={readContext:oo,useCallback:function(t,e){return ta().memoizedState=[t,e===void 0?null:e],t},useContext:oo,useEffect:UE,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,dg(4194308,4,fP.bind(null,e,t),n)},useLayoutEffect:function(t,e){return dg(4194308,4,t,e)},useInsertionEffect:function(t,e){return dg(4,2,t,e)},useMemo:function(t,e){var n=ta();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=ta();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=WO.bind(null,si,t),[i.memoizedState,t]},useRef:function(t){var e=ta();return t={current:t},e.memoizedState=t},useState:NE,useDebugValue:$x,useDeferredValue:function(t){return ta().memoizedState=t},useTransition:function(){var t=NE(!1),e=t[0];return t=HO.bind(null,t[1]),ta().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=si,r=ta();if(Zn){if(n===void 0)throw Error(Xe(407));n=n()}else{if(n=e(),Yi===null)throw Error(Xe(349));Hc&30||sP(i,e,n)}r.memoizedState=n;var a={value:n,getSnapshot:e};return r.queue=a,UE(aP.bind(null,i,a,t),[t]),i.flags|=2048,Yf(9,oP.bind(null,i,a,n,e),void 0,null),n},useId:function(){var t=ta(),e=Yi.identifierPrefix;if(Zn){var n=Oa,i=Da;n=(i&~(1<<32-Lo(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Jf++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=jO++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},$O={readContext:oo,useCallback:mP,useContext:oo,useEffect:Xx,useImperativeHandle:pP,useInsertionEffect:hP,useLayoutEffect:dP,useMemo:gP,useReducer:w0,useRef:uP,useState:function(){return w0(Kf)},useDebugValue:$x,useDeferredValue:function(t){var e=ao();return _P(e,zi.memoizedState,t)},useTransition:function(){var t=w0(Kf)[0],e=ao().memoizedState;return[t,e]},useMutableSource:iP,useSyncExternalStore:rP,useId:yP,unstable_isNewReconciler:!1},ZO={readContext:oo,useCallback:mP,useContext:oo,useEffect:Xx,useImperativeHandle:pP,useInsertionEffect:hP,useLayoutEffect:dP,useMemo:gP,useReducer:A0,useRef:uP,useState:function(){return A0(Kf)},useDebugValue:$x,useDeferredValue:function(t){var e=ao();return zi===null?e.memoizedState=t:_P(e,zi.memoizedState,t)},useTransition:function(){var t=A0(Kf)[0],e=ao().memoizedState;return[t,e]},useMutableSource:iP,useSyncExternalStore:rP,useId:yP,unstable_isNewReconciler:!1};function Dh(t,e){try{var n="",i=e;do n+=A3(i),i=i.return;while(i);var r=n}catch(a){r=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:r,digest:null}}function E0(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function u1(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var JO=typeof WeakMap=="function"?WeakMap:Map;function wP(t,e,n){n=Na(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Xg||(Xg=!0,x1=i),u1(t,e)},n}function AP(t,e,n){n=Na(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){u1(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){u1(t,e),typeof i!="function"&&(kl===null?kl=new Set([this]):kl.add(this));var h=e.stack;this.componentDidCatch(e.value,{componentStack:h!==null?h:""})}),n}function GE(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new JO;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=uF.bind(null,t,e,n),e.then(t,t))}function VE(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function jE(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Na(-1,1),e.tag=2,Fl(n,e,1))),n.lanes|=1),t)}var KO=Za.ReactCurrentOwner,os=!1;function Gr(t,e,n,i){e.child=t===null?tP(e,null,n,i):Lh(e,t.child,n,i)}function HE(t,e,n,i,r){n=n.render;var a=e.ref;return wh(e,r),i=Wx(t,e,n,i,a,r),n=qx(),t!==null&&!os?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Wa(t,e,r)):(Zn&&n&&Rx(e),e.flags|=1,Gr(t,e,i,r),e.child)}function WE(t,e,n,i,r){if(t===null){var a=n.type;return typeof a=="function"&&!nb(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=a,EP(t,e,a,i,r)):(t=gg(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&r)){var h=a.memoizedProps;if(n=n.compare,n=n!==null?n:Hf,n(h,i)&&t.ref===e.ref)return Wa(t,e,r)}return e.flags|=1,t=Nl(a,i),t.ref=e.ref,t.return=e,e.child=t}function EP(t,e,n,i,r){if(t!==null){var a=t.memoizedProps;if(Hf(a,i)&&t.ref===e.ref)if(os=!1,e.pendingProps=i=a,(t.lanes&r)!==0)t.flags&131072&&(os=!0);else return e.lanes=t.lanes,Wa(t,e,r)}return h1(t,e,n,i,r)}function TP(t,e,n){var i=e.pendingProps,r=i.children,a=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},kn(fh,Cs),Cs|=n;else{if(!(n&1073741824))return t=a!==null?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,kn(fh,Cs),Cs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=a!==null?a.baseLanes:n,kn(fh,Cs),Cs|=i}else a!==null?(i=a.baseLanes|n,e.memoizedState=null):i=n,kn(fh,Cs),Cs|=i;return Gr(t,e,r,n),e.child}function SP(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function h1(t,e,n,i,r){var a=cs(n)?Vc:Cr.current;return a=Mh(e,a),wh(e,r),n=Wx(t,e,n,i,a,r),i=qx(),t!==null&&!os?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Wa(t,e,r)):(Zn&&i&&Rx(e),e.flags|=1,Gr(t,e,n,r),e.child)}function qE(t,e,n,i,r){if(cs(n)){var a=!0;kg(e)}else a=!1;if(wh(e,r),e.stateNode===null)fg(t,e),QI(e,n,i),c1(e,n,i,r),i=!0;else if(t===null){var h=e.stateNode,l=e.memoizedProps;h.props=l;var _=h.context,v=n.contextType;typeof v=="object"&&v!==null?v=oo(v):(v=cs(n)?Vc:Cr.current,v=Mh(e,v));var S=n.getDerivedStateFromProps,I=typeof S=="function"||typeof h.getSnapshotBeforeUpdate=="function";I||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(l!==i||_!==v)&&kE(e,h,i,v),Sl=!1;var B=e.memoizedState;h.state=B,Vg(e,i,h,r),_=e.memoizedState,l!==i||B!==_||ls.current||Sl?(typeof S=="function"&&(l1(e,n,S,i),_=e.memoizedState),(l=Sl||FE(e,n,l,i,B,_,v))?(I||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(e.flags|=4194308)):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=_),h.props=i,h.state=_,h.context=v,i=l):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{h=e.stateNode,KI(t,e),l=e.memoizedProps,v=e.type===e.elementType?l:To(e.type,l),h.props=v,I=e.pendingProps,B=h.context,_=n.contextType,typeof _=="object"&&_!==null?_=oo(_):(_=cs(n)?Vc:Cr.current,_=Mh(e,_));var z=n.getDerivedStateFromProps;(S=typeof z=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(l!==I||B!==_)&&kE(e,h,i,_),Sl=!1,B=e.memoizedState,h.state=B,Vg(e,i,h,r);var V=e.memoizedState;l!==I||B!==V||ls.current||Sl?(typeof z=="function"&&(l1(e,n,z,i),V=e.memoizedState),(v=Sl||FE(e,n,v,i,B,V,_)||!1)?(S||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(i,V,_),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(i,V,_)),typeof h.componentDidUpdate=="function"&&(e.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof h.componentDidUpdate!="function"||l===t.memoizedProps&&B===t.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&B===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=V),h.props=i,h.state=V,h.context=_,i=v):(typeof h.componentDidUpdate!="function"||l===t.memoizedProps&&B===t.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&B===t.memoizedState||(e.flags|=1024),i=!1)}return d1(t,e,n,i,a,r)}function d1(t,e,n,i,r,a){SP(t,e);var h=(e.flags&128)!==0;if(!i&&!h)return r&&BE(e,n,!1),Wa(t,e,a);i=e.stateNode,KO.current=e;var l=h&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&h?(e.child=Lh(e,t.child,null,a),e.child=Lh(e,null,l,a)):Gr(t,e,l,a),e.memoizedState=i.state,r&&BE(e,n,!0),e.child}function CP(t){var e=t.stateNode;e.pendingContext?ME(t,e.pendingContext,e.pendingContext!==e.context):e.context&&ME(t,e.context,!1),Gx(t,e.containerInfo)}function XE(t,e,n,i,r){return Bh(),Ox(r),e.flags|=256,Gr(t,e,n,i),e.child}var f1={dehydrated:null,treeContext:null,retryLane:0};function p1(t){return{baseLanes:t,cachePool:null,transitions:null}}function IP(t,e,n){var i=e.pendingProps,r=ii.current,a=!1,h=(e.flags&128)!==0,l;if((l=h)||(l=t!==null&&t.memoizedState===null?!1:(r&2)!==0),l?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),kn(ii,r&1),t===null)return o1(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(h=i.children,t=i.fallback,a?(i=e.mode,a=e.child,h={mode:"hidden",children:h},!(i&1)&&a!==null?(a.childLanes=0,a.pendingProps=h):a=I_(h,i,0,null),t=Nc(t,i,n,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=p1(n),e.memoizedState=f1,t):Zx(e,h));if(r=t.memoizedState,r!==null&&(l=r.dehydrated,l!==null))return YO(t,e,h,i,l,r,n);if(a){a=i.fallback,h=e.mode,r=t.child,l=r.sibling;var _={mode:"hidden",children:i.children};return!(h&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=_,e.deletions=null):(i=Nl(r,_),i.subtreeFlags=r.subtreeFlags&14680064),l!==null?a=Nl(l,a):(a=Nc(a,h,n,null),a.flags|=2),a.return=e,i.return=e,i.sibling=a,e.child=i,i=a,a=e.child,h=t.child.memoizedState,h=h===null?p1(n):{baseLanes:h.baseLanes|n,cachePool:null,transitions:h.transitions},a.memoizedState=h,a.childLanes=t.childLanes&~n,e.memoizedState=f1,i}return a=t.child,t=a.sibling,i=Nl(a,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Zx(t,e){return e=I_({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Im(t,e,n,i){return i!==null&&Ox(i),Lh(e,t.child,null,n),t=Zx(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function YO(t,e,n,i,r,a,h){if(n)return e.flags&256?(e.flags&=-257,i=E0(Error(Xe(422))),Im(t,e,h,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=i.fallback,r=e.mode,i=I_({mode:"visible",children:i.children},r,0,null),a=Nc(a,r,h,null),a.flags|=2,i.return=e,a.return=e,i.sibling=a,e.child=i,e.mode&1&&Lh(e,t.child,null,h),e.child.memoizedState=p1(h),e.memoizedState=f1,a);if(!(e.mode&1))return Im(t,e,h,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var l=i.dgst;return i=l,a=Error(Xe(419)),i=E0(a,i,void 0),Im(t,e,h,i)}if(l=(h&t.childLanes)!==0,os||l){if(i=Yi,i!==null){switch(h&-h){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|h)?0:r,r!==0&&r!==a.retryLane&&(a.retryLane=r,Ha(t,r),Ro(i,t,r,-1))}return tb(),i=E0(Error(Xe(421))),Im(t,e,h,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=hF.bind(null,t),r._reactRetry=e,null):(t=a.treeContext,Ps=Ol(r.nextSibling),Bs=e,Zn=!0,Co=null,t!==null&&(Ys[Qs++]=Da,Ys[Qs++]=Oa,Ys[Qs++]=jc,Da=t.id,Oa=t.overflow,jc=e),e=Zx(e,i.children),e.flags|=4096,e)}function $E(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),a1(t.return,e,n)}function T0(t,e,n,i,r){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function PP(t,e,n){var i=e.pendingProps,r=i.revealOrder,a=i.tail;if(Gr(t,e,i.children,n),i=ii.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&$E(t,n,e);else if(t.tag===19)$E(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(kn(ii,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&jg(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),T0(e,!1,r,n,a);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&jg(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}T0(e,!0,n,null,a);break;case"together":T0(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function fg(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Wa(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Wc|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Xe(153));if(e.child!==null){for(t=e.child,n=Nl(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Nl(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function QO(t,e,n){switch(e.tag){case 3:CP(e),Bh();break;case 5:nP(e);break;case 1:cs(e.type)&&kg(e);break;case 4:Gx(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;kn(Ug,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(kn(ii,ii.current&1),e.flags|=128,null):n&e.child.childLanes?IP(t,e,n):(kn(ii,ii.current&1),t=Wa(t,e,n),t!==null?t.sibling:null);kn(ii,ii.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return PP(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),kn(ii,ii.current),i)break;return null;case 22:case 23:return e.lanes=0,TP(t,e,n)}return Wa(t,e,n)}var MP,m1,BP,LP;MP=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};m1=function(){};BP=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Oc(ca.current);var a=null;switch(n){case"input":r=kv(t,r),i=kv(t,i),a=[];break;case"select":r=oi({},r,{value:void 0}),i=oi({},i,{value:void 0}),a=[];break;case"textarea":r=Uv(t,r),i=Uv(t,i),a=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Og)}Vv(n,i);var h;n=null;for(v in r)if(!i.hasOwnProperty(v)&&r.hasOwnProperty(v)&&r[v]!=null)if(v==="style"){var l=r[v];for(h in l)l.hasOwnProperty(h)&&(n||(n={}),n[h]="")}else v!=="dangerouslySetInnerHTML"&&v!=="children"&&v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(kf.hasOwnProperty(v)?a||(a=[]):(a=a||[]).push(v,null));for(v in i){var _=i[v];if(l=r!=null?r[v]:void 0,i.hasOwnProperty(v)&&_!==l&&(_!=null||l!=null))if(v==="style")if(l){for(h in l)!l.hasOwnProperty(h)||_&&_.hasOwnProperty(h)||(n||(n={}),n[h]="");for(h in _)_.hasOwnProperty(h)&&l[h]!==_[h]&&(n||(n={}),n[h]=_[h])}else n||(a||(a=[]),a.push(v,n)),n=_;else v==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,l=l?l.__html:void 0,_!=null&&l!==_&&(a=a||[]).push(v,_)):v==="children"?typeof _!="string"&&typeof _!="number"||(a=a||[]).push(v,""+_):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&(kf.hasOwnProperty(v)?(_!=null&&v==="onScroll"&&Gn("scroll",t),a||l===_||(a=[])):(a=a||[]).push(v,_))}n&&(a=a||[]).push("style",n);var v=a;(e.updateQueue=v)&&(e.flags|=4)}};LP=function(t,e,n,i){n!==i&&(e.flags|=4)};function Qd(t,e){if(!Zn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function wr(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function eF(t,e,n){var i=e.pendingProps;switch(Dx(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wr(e),null;case 1:return cs(e.type)&&Fg(),wr(e),null;case 3:return i=e.stateNode,Rh(),Vn(ls),Vn(Cr),jx(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Sm(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Co!==null&&(A1(Co),Co=null))),m1(t,e),wr(e),null;case 5:Vx(e);var r=Oc(Zf.current);if(n=e.type,t!==null&&e.stateNode!=null)BP(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Xe(166));return wr(e),null}if(t=Oc(ca.current),Sm(e)){i=e.stateNode,n=e.type;var a=e.memoizedProps;switch(i[na]=e,i[Xf]=a,t=(e.mode&1)!==0,n){case"dialog":Gn("cancel",i),Gn("close",i);break;case"iframe":case"object":case"embed":Gn("load",i);break;case"video":case"audio":for(r=0;r<yf.length;r++)Gn(yf[r],i);break;case"source":Gn("error",i);break;case"img":case"image":case"link":Gn("error",i),Gn("load",i);break;case"details":Gn("toggle",i);break;case"input":iE(i,a),Gn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Gn("invalid",i);break;case"textarea":sE(i,a),Gn("invalid",i)}Vv(n,a),r=null;for(var h in a)if(a.hasOwnProperty(h)){var l=a[h];h==="children"?typeof l=="string"?i.textContent!==l&&(a.suppressHydrationWarning!==!0&&Tm(i.textContent,l,t),r=["children",l]):typeof l=="number"&&i.textContent!==""+l&&(a.suppressHydrationWarning!==!0&&Tm(i.textContent,l,t),r=["children",""+l]):kf.hasOwnProperty(h)&&l!=null&&h==="onScroll"&&Gn("scroll",i)}switch(n){case"input":_m(i),rE(i,a,!0);break;case"textarea":_m(i),oE(i);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(i.onclick=Og)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{h=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=sI(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=h.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=h.createElement(n,{is:i.is}):(t=h.createElement(n),n==="select"&&(h=t,i.multiple?h.multiple=!0:i.size&&(h.size=i.size))):t=h.createElementNS(t,n),t[na]=e,t[Xf]=i,MP(t,e,!1,!1),e.stateNode=t;e:{switch(h=jv(n,i),n){case"dialog":Gn("cancel",t),Gn("close",t),r=i;break;case"iframe":case"object":case"embed":Gn("load",t),r=i;break;case"video":case"audio":for(r=0;r<yf.length;r++)Gn(yf[r],t);r=i;break;case"source":Gn("error",t),r=i;break;case"img":case"image":case"link":Gn("error",t),Gn("load",t),r=i;break;case"details":Gn("toggle",t),r=i;break;case"input":iE(t,i),r=kv(t,i),Gn("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=oi({},i,{value:void 0}),Gn("invalid",t);break;case"textarea":sE(t,i),r=Uv(t,i),Gn("invalid",t);break;default:r=i}Vv(n,r),l=r;for(a in l)if(l.hasOwnProperty(a)){var _=l[a];a==="style"?lI(t,_):a==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,_!=null&&oI(t,_)):a==="children"?typeof _=="string"?(n!=="textarea"||_!=="")&&zf(t,_):typeof _=="number"&&zf(t,""+_):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(kf.hasOwnProperty(a)?_!=null&&a==="onScroll"&&Gn("scroll",t):_!=null&&vx(t,a,_,h))}switch(n){case"input":_m(t),rE(t,i,!1);break;case"textarea":_m(t),oE(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Vl(i.value));break;case"select":t.multiple=!!i.multiple,a=i.value,a!=null?yh(t,!!i.multiple,a,!1):i.defaultValue!=null&&yh(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Og)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return wr(e),null;case 6:if(t&&e.stateNode!=null)LP(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Xe(166));if(n=Oc(Zf.current),Oc(ca.current),Sm(e)){if(i=e.stateNode,n=e.memoizedProps,i[na]=e,(a=i.nodeValue!==n)&&(t=Bs,t!==null))switch(t.tag){case 3:Tm(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Tm(i.nodeValue,n,(t.mode&1)!==0)}a&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[na]=e,e.stateNode=i}return wr(e),null;case 13:if(Vn(ii),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Zn&&Ps!==null&&e.mode&1&&!(e.flags&128))ZI(),Bh(),e.flags|=98560,a=!1;else if(a=Sm(e),i!==null&&i.dehydrated!==null){if(t===null){if(!a)throw Error(Xe(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Xe(317));a[na]=e}else Bh(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;wr(e),a=!1}else Co!==null&&(A1(Co),Co=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||ii.current&1?Ni===0&&(Ni=3):tb())),e.updateQueue!==null&&(e.flags|=4),wr(e),null);case 4:return Rh(),m1(t,e),t===null&&Wf(e.stateNode.containerInfo),wr(e),null;case 10:return zx(e.type._context),wr(e),null;case 17:return cs(e.type)&&Fg(),wr(e),null;case 19:if(Vn(ii),a=e.memoizedState,a===null)return wr(e),null;if(i=(e.flags&128)!==0,h=a.rendering,h===null)if(i)Qd(a,!1);else{if(Ni!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(h=jg(t),h!==null){for(e.flags|=128,Qd(a,!1),i=h.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)a=n,t=i,a.flags&=14680066,h=a.alternate,h===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=h.childLanes,a.lanes=h.lanes,a.child=h.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=h.memoizedProps,a.memoizedState=h.memoizedState,a.updateQueue=h.updateQueue,a.type=h.type,t=h.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return kn(ii,ii.current&1|2),e.child}t=t.sibling}a.tail!==null&&Ei()>Oh&&(e.flags|=128,i=!0,Qd(a,!1),e.lanes=4194304)}else{if(!i)if(t=jg(h),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Qd(a,!0),a.tail===null&&a.tailMode==="hidden"&&!h.alternate&&!Zn)return wr(e),null}else 2*Ei()-a.renderingStartTime>Oh&&n!==1073741824&&(e.flags|=128,i=!0,Qd(a,!1),e.lanes=4194304);a.isBackwards?(h.sibling=e.child,e.child=h):(n=a.last,n!==null?n.sibling=h:e.child=h,a.last=h)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=Ei(),e.sibling=null,n=ii.current,kn(ii,i?n&1|2:n&1),e):(wr(e),null);case 22:case 23:return eb(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Cs&1073741824&&(wr(e),e.subtreeFlags&6&&(e.flags|=8192)):wr(e),null;case 24:return null;case 25:return null}throw Error(Xe(156,e.tag))}function tF(t,e){switch(Dx(e),e.tag){case 1:return cs(e.type)&&Fg(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Rh(),Vn(ls),Vn(Cr),jx(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Vx(e),null;case 13:if(Vn(ii),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Xe(340));Bh()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Vn(ii),null;case 4:return Rh(),null;case 10:return zx(e.type._context),null;case 22:case 23:return eb(),null;case 24:return null;default:return null}}var Pm=!1,Sr=!1,nF=typeof WeakSet=="function"?WeakSet:Set,gt=null;function dh(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){mi(t,e,i)}else n.current=null}function g1(t,e,n){try{n()}catch(i){mi(t,e,i)}}var ZE=!1;function iF(t,e){if(Qv=Lg,t=FI(),Lx(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var h=0,l=-1,_=-1,v=0,S=0,I=t,B=null;t:for(;;){for(var z;I!==n||r!==0&&I.nodeType!==3||(l=h+r),I!==a||i!==0&&I.nodeType!==3||(_=h+i),I.nodeType===3&&(h+=I.nodeValue.length),(z=I.firstChild)!==null;)B=I,I=z;for(;;){if(I===t)break t;if(B===n&&++v===r&&(l=h),B===a&&++S===i&&(_=h),(z=I.nextSibling)!==null)break;I=B,B=I.parentNode}I=z}n=l===-1||_===-1?null:{start:l,end:_}}else n=null}n=n||{start:0,end:0}}else n=null;for(e1={focusedElem:t,selectionRange:n},Lg=!1,gt=e;gt!==null;)if(e=gt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,gt=t;else for(;gt!==null;){e=gt;try{var V=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(V!==null){var J=V.memoizedProps,ue=V.memoizedState,j=e.stateNode,W=j.getSnapshotBeforeUpdate(e.elementType===e.type?J:To(e.type,J),ue);j.__reactInternalSnapshotBeforeUpdate=W}break;case 3:var Z=e.stateNode.containerInfo;Z.nodeType===1?Z.textContent="":Z.nodeType===9&&Z.documentElement&&Z.removeChild(Z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Xe(163))}}catch(ae){mi(e,e.return,ae)}if(t=e.sibling,t!==null){t.return=e.return,gt=t;break}gt=e.return}return V=ZE,ZE=!1,V}function If(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var a=r.destroy;r.destroy=void 0,a!==void 0&&g1(e,n,a)}r=r.next}while(r!==i)}}function S_(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function _1(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function RP(t){var e=t.alternate;e!==null&&(t.alternate=null,RP(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[na],delete e[Xf],delete e[i1],delete e[NO],delete e[UO])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function DP(t){return t.tag===5||t.tag===3||t.tag===4}function JE(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||DP(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function y1(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Og));else if(i!==4&&(t=t.child,t!==null))for(y1(t,e,n),t=t.sibling;t!==null;)y1(t,e,n),t=t.sibling}function v1(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(v1(t,e,n),t=t.sibling;t!==null;)v1(t,e,n),t=t.sibling}var or=null,So=!1;function _l(t,e,n){for(n=n.child;n!==null;)OP(t,e,n),n=n.sibling}function OP(t,e,n){if(la&&typeof la.onCommitFiberUnmount=="function")try{la.onCommitFiberUnmount(y_,n)}catch{}switch(n.tag){case 5:Sr||dh(n,e);case 6:var i=or,r=So;or=null,_l(t,e,n),or=i,So=r,or!==null&&(So?(t=or,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):or.removeChild(n.stateNode));break;case 18:or!==null&&(So?(t=or,n=n.stateNode,t.nodeType===8?y0(t.parentNode,n):t.nodeType===1&&y0(t,n),Vf(t)):y0(or,n.stateNode));break;case 4:i=or,r=So,or=n.stateNode.containerInfo,So=!0,_l(t,e,n),or=i,So=r;break;case 0:case 11:case 14:case 15:if(!Sr&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var a=r,h=a.destroy;a=a.tag,h!==void 0&&(a&2||a&4)&&g1(n,e,h),r=r.next}while(r!==i)}_l(t,e,n);break;case 1:if(!Sr&&(dh(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(l){mi(n,e,l)}_l(t,e,n);break;case 21:_l(t,e,n);break;case 22:n.mode&1?(Sr=(i=Sr)||n.memoizedState!==null,_l(t,e,n),Sr=i):_l(t,e,n);break;default:_l(t,e,n)}}function KE(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new nF),e.forEach(function(i){var r=dF.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Ao(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var a=t,h=e,l=h;e:for(;l!==null;){switch(l.tag){case 5:or=l.stateNode,So=!1;break e;case 3:or=l.stateNode.containerInfo,So=!0;break e;case 4:or=l.stateNode.containerInfo,So=!0;break e}l=l.return}if(or===null)throw Error(Xe(160));OP(a,h,r),or=null,So=!1;var _=r.alternate;_!==null&&(_.return=null),r.return=null}catch(v){mi(r,e,v)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)FP(e,t),e=e.sibling}function FP(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ao(e,t),Jo(t),i&4){try{If(3,t,t.return),S_(3,t)}catch(J){mi(t,t.return,J)}try{If(5,t,t.return)}catch(J){mi(t,t.return,J)}}break;case 1:Ao(e,t),Jo(t),i&512&&n!==null&&dh(n,n.return);break;case 5:if(Ao(e,t),Jo(t),i&512&&n!==null&&dh(n,n.return),t.flags&32){var r=t.stateNode;try{zf(r,"")}catch(J){mi(t,t.return,J)}}if(i&4&&(r=t.stateNode,r!=null)){var a=t.memoizedProps,h=n!==null?n.memoizedProps:a,l=t.type,_=t.updateQueue;if(t.updateQueue=null,_!==null)try{l==="input"&&a.type==="radio"&&a.name!=null&&iI(r,a),jv(l,h);var v=jv(l,a);for(h=0;h<_.length;h+=2){var S=_[h],I=_[h+1];S==="style"?lI(r,I):S==="dangerouslySetInnerHTML"?oI(r,I):S==="children"?zf(r,I):vx(r,S,I,v)}switch(l){case"input":zv(r,a);break;case"textarea":rI(r,a);break;case"select":var B=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var z=a.value;z!=null?yh(r,!!a.multiple,z,!1):B!==!!a.multiple&&(a.defaultValue!=null?yh(r,!!a.multiple,a.defaultValue,!0):yh(r,!!a.multiple,a.multiple?[]:"",!1))}r[Xf]=a}catch(J){mi(t,t.return,J)}}break;case 6:if(Ao(e,t),Jo(t),i&4){if(t.stateNode===null)throw Error(Xe(162));r=t.stateNode,a=t.memoizedProps;try{r.nodeValue=a}catch(J){mi(t,t.return,J)}}break;case 3:if(Ao(e,t),Jo(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Vf(e.containerInfo)}catch(J){mi(t,t.return,J)}break;case 4:Ao(e,t),Jo(t);break;case 13:Ao(e,t),Jo(t),r=t.child,r.flags&8192&&(a=r.memoizedState!==null,r.stateNode.isHidden=a,!a||r.alternate!==null&&r.alternate.memoizedState!==null||(Yx=Ei())),i&4&&KE(t);break;case 22:if(S=n!==null&&n.memoizedState!==null,t.mode&1?(Sr=(v=Sr)||S,Ao(e,t),Sr=v):Ao(e,t),Jo(t),i&8192){if(v=t.memoizedState!==null,(t.stateNode.isHidden=v)&&!S&&t.mode&1)for(gt=t,S=t.child;S!==null;){for(I=gt=S;gt!==null;){switch(B=gt,z=B.child,B.tag){case 0:case 11:case 14:case 15:If(4,B,B.return);break;case 1:dh(B,B.return);var V=B.stateNode;if(typeof V.componentWillUnmount=="function"){i=B,n=B.return;try{e=i,V.props=e.memoizedProps,V.state=e.memoizedState,V.componentWillUnmount()}catch(J){mi(i,n,J)}}break;case 5:dh(B,B.return);break;case 22:if(B.memoizedState!==null){QE(I);continue}}z!==null?(z.return=B,gt=z):QE(I)}S=S.sibling}e:for(S=null,I=t;;){if(I.tag===5){if(S===null){S=I;try{r=I.stateNode,v?(a=r.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(l=I.stateNode,_=I.memoizedProps.style,h=_!=null&&_.hasOwnProperty("display")?_.display:null,l.style.display=aI("display",h))}catch(J){mi(t,t.return,J)}}}else if(I.tag===6){if(S===null)try{I.stateNode.nodeValue=v?"":I.memoizedProps}catch(J){mi(t,t.return,J)}}else if((I.tag!==22&&I.tag!==23||I.memoizedState===null||I===t)&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===t)break e;for(;I.sibling===null;){if(I.return===null||I.return===t)break e;S===I&&(S=null),I=I.return}S===I&&(S=null),I.sibling.return=I.return,I=I.sibling}}break;case 19:Ao(e,t),Jo(t),i&4&&KE(t);break;case 21:break;default:Ao(e,t),Jo(t)}}function Jo(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(DP(n)){var i=n;break e}n=n.return}throw Error(Xe(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(zf(r,""),i.flags&=-33);var a=JE(t);v1(t,a,r);break;case 3:case 4:var h=i.stateNode.containerInfo,l=JE(t);y1(t,l,h);break;default:throw Error(Xe(161))}}catch(_){mi(t,t.return,_)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function rF(t,e,n){gt=t,kP(t)}function kP(t,e,n){for(var i=(t.mode&1)!==0;gt!==null;){var r=gt,a=r.child;if(r.tag===22&&i){var h=r.memoizedState!==null||Pm;if(!h){var l=r.alternate,_=l!==null&&l.memoizedState!==null||Sr;l=Pm;var v=Sr;if(Pm=h,(Sr=_)&&!v)for(gt=r;gt!==null;)h=gt,_=h.child,h.tag===22&&h.memoizedState!==null?eT(r):_!==null?(_.return=h,gt=_):eT(r);for(;a!==null;)gt=a,kP(a),a=a.sibling;gt=r,Pm=l,Sr=v}YE(t)}else r.subtreeFlags&8772&&a!==null?(a.return=r,gt=a):YE(t)}}function YE(t){for(;gt!==null;){var e=gt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Sr||S_(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Sr)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:To(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&OE(e,a,i);break;case 3:var h=e.updateQueue;if(h!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}OE(e,h,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var _=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":_.autoFocus&&n.focus();break;case"img":_.src&&(n.src=_.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var v=e.alternate;if(v!==null){var S=v.memoizedState;if(S!==null){var I=S.dehydrated;I!==null&&Vf(I)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Xe(163))}Sr||e.flags&512&&_1(e)}catch(B){mi(e,e.return,B)}}if(e===t){gt=null;break}if(n=e.sibling,n!==null){n.return=e.return,gt=n;break}gt=e.return}}function QE(t){for(;gt!==null;){var e=gt;if(e===t){gt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,gt=n;break}gt=e.return}}function eT(t){for(;gt!==null;){var e=gt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{S_(4,e)}catch(_){mi(e,n,_)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(_){mi(e,r,_)}}var a=e.return;try{_1(e)}catch(_){mi(e,a,_)}break;case 5:var h=e.return;try{_1(e)}catch(_){mi(e,h,_)}}}catch(_){mi(e,e.return,_)}if(e===t){gt=null;break}var l=e.sibling;if(l!==null){l.return=e.return,gt=l;break}gt=e.return}}var sF=Math.ceil,qg=Za.ReactCurrentDispatcher,Jx=Za.ReactCurrentOwner,ro=Za.ReactCurrentBatchConfig,an=0,Yi=null,Mi=null,ar=0,Cs=0,fh=Xl(0),Ni=0,Qf=null,Wc=0,C_=0,Kx=0,Pf=null,rs=null,Yx=0,Oh=1/0,Ma=null,Xg=!1,x1=null,kl=null,Mm=!1,Ml=null,$g=0,Mf=0,b1=null,pg=-1,mg=0;function Hr(){return an&6?Ei():pg!==-1?pg:pg=Ei()}function zl(t){return t.mode&1?an&2&&ar!==0?ar&-ar:VO.transition!==null?(mg===0&&(mg=xI()),mg):(t=yn,t!==0||(t=window.event,t=t===void 0?16:CI(t.type)),t):1}function Ro(t,e,n,i){if(50<Mf)throw Mf=0,b1=null,Error(Xe(185));cp(t,n,i),(!(an&2)||t!==Yi)&&(t===Yi&&(!(an&2)&&(C_|=n),Ni===4&&Il(t,ar)),us(t,i),n===1&&an===0&&!(e.mode&1)&&(Oh=Ei()+500,A_&&$l()))}function us(t,e){var n=t.callbackNode;V3(t,e);var i=Bg(t,t===Yi?ar:0);if(i===0)n!==null&&cE(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&cE(n),e===1)t.tag===0?GO(tT.bind(null,t)):qI(tT.bind(null,t)),kO(function(){!(an&6)&&$l()}),n=null;else{switch(bI(i)){case 1:n=Ex;break;case 4:n=yI;break;case 16:n=Mg;break;case 536870912:n=vI;break;default:n=Mg}n=WP(n,zP.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function zP(t,e){if(pg=-1,mg=0,an&6)throw Error(Xe(327));var n=t.callbackNode;if(Ah()&&t.callbackNode!==n)return null;var i=Bg(t,t===Yi?ar:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Zg(t,i);else{e=i;var r=an;an|=2;var a=UP();(Yi!==t||ar!==e)&&(Ma=null,Oh=Ei()+500,zc(t,e));do try{lF();break}catch(l){NP(t,l)}while(1);kx(),qg.current=a,an=r,Mi!==null?e=0:(Yi=null,ar=0,e=Ni)}if(e!==0){if(e===2&&(r=$v(t),r!==0&&(i=r,e=w1(t,r))),e===1)throw n=Qf,zc(t,0),Il(t,i),us(t,Ei()),n;if(e===6)Il(t,i);else{if(r=t.current.alternate,!(i&30)&&!oF(r)&&(e=Zg(t,i),e===2&&(a=$v(t),a!==0&&(i=a,e=w1(t,a))),e===1))throw n=Qf,zc(t,0),Il(t,i),us(t,Ei()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(Xe(345));case 2:Bc(t,rs,Ma);break;case 3:if(Il(t,i),(i&130023424)===i&&(e=Yx+500-Ei(),10<e)){if(Bg(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Hr(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=n1(Bc.bind(null,t,rs,Ma),e);break}Bc(t,rs,Ma);break;case 4:if(Il(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var h=31-Lo(i);a=1<<h,h=e[h],h>r&&(r=h),i&=~a}if(i=r,i=Ei()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*sF(i/1960))-i,10<i){t.timeoutHandle=n1(Bc.bind(null,t,rs,Ma),i);break}Bc(t,rs,Ma);break;case 5:Bc(t,rs,Ma);break;default:throw Error(Xe(329))}}}return us(t,Ei()),t.callbackNode===n?zP.bind(null,t):null}function w1(t,e){var n=Pf;return t.current.memoizedState.isDehydrated&&(zc(t,e).flags|=256),t=Zg(t,e),t!==2&&(e=rs,rs=n,e!==null&&A1(e)),t}function A1(t){rs===null?rs=t:rs.push.apply(rs,t)}function oF(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!Fo(a(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Il(t,e){for(e&=~Kx,e&=~C_,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Lo(e),i=1<<n;t[n]=-1,e&=~i}}function tT(t){if(an&6)throw Error(Xe(327));Ah();var e=Bg(t,0);if(!(e&1))return us(t,Ei()),null;var n=Zg(t,e);if(t.tag!==0&&n===2){var i=$v(t);i!==0&&(e=i,n=w1(t,i))}if(n===1)throw n=Qf,zc(t,0),Il(t,e),us(t,Ei()),n;if(n===6)throw Error(Xe(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Bc(t,rs,Ma),us(t,Ei()),null}function Qx(t,e){var n=an;an|=1;try{return t(e)}finally{an=n,an===0&&(Oh=Ei()+500,A_&&$l())}}function qc(t){Ml!==null&&Ml.tag===0&&!(an&6)&&Ah();var e=an;an|=1;var n=ro.transition,i=yn;try{if(ro.transition=null,yn=1,t)return t()}finally{yn=i,ro.transition=n,an=e,!(an&6)&&$l()}}function eb(){Cs=fh.current,Vn(fh)}function zc(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,FO(n)),Mi!==null)for(n=Mi.return;n!==null;){var i=n;switch(Dx(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Fg();break;case 3:Rh(),Vn(ls),Vn(Cr),jx();break;case 5:Vx(i);break;case 4:Rh();break;case 13:Vn(ii);break;case 19:Vn(ii);break;case 10:zx(i.type._context);break;case 22:case 23:eb()}n=n.return}if(Yi=t,Mi=t=Nl(t.current,null),ar=Cs=e,Ni=0,Qf=null,Kx=C_=Wc=0,rs=Pf=null,Dc!==null){for(e=0;e<Dc.length;e++)if(n=Dc[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,a=n.pending;if(a!==null){var h=a.next;a.next=r,i.next=h}n.pending=i}Dc=null}return t}function NP(t,e){do{var n=Mi;try{if(kx(),hg.current=Wg,Hg){for(var i=si.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Hg=!1}if(Hc=0,Ji=zi=si=null,Cf=!1,Jf=0,Jx.current=null,n===null||n.return===null){Ni=1,Qf=e,Mi=null;break}e:{var a=t,h=n.return,l=n,_=e;if(e=ar,l.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){var v=_,S=l,I=S.tag;if(!(S.mode&1)&&(I===0||I===11||I===15)){var B=S.alternate;B?(S.updateQueue=B.updateQueue,S.memoizedState=B.memoizedState,S.lanes=B.lanes):(S.updateQueue=null,S.memoizedState=null)}var z=VE(h);if(z!==null){z.flags&=-257,jE(z,h,l,a,e),z.mode&1&&GE(a,v,e),e=z,_=v;var V=e.updateQueue;if(V===null){var J=new Set;J.add(_),e.updateQueue=J}else V.add(_);break e}else{if(!(e&1)){GE(a,v,e),tb();break e}_=Error(Xe(426))}}else if(Zn&&l.mode&1){var ue=VE(h);if(ue!==null){!(ue.flags&65536)&&(ue.flags|=256),jE(ue,h,l,a,e),Ox(Dh(_,l));break e}}a=_=Dh(_,l),Ni!==4&&(Ni=2),Pf===null?Pf=[a]:Pf.push(a),a=h;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var j=wP(a,_,e);DE(a,j);break e;case 1:l=_;var W=a.type,Z=a.stateNode;if(!(a.flags&128)&&(typeof W.getDerivedStateFromError=="function"||Z!==null&&typeof Z.componentDidCatch=="function"&&(kl===null||!kl.has(Z)))){a.flags|=65536,e&=-e,a.lanes|=e;var ae=AP(a,l,e);DE(a,ae);break e}}a=a.return}while(a!==null)}VP(n)}catch(be){e=be,Mi===n&&n!==null&&(Mi=n=n.return);continue}break}while(1)}function UP(){var t=qg.current;return qg.current=Wg,t===null?Wg:t}function tb(){(Ni===0||Ni===3||Ni===2)&&(Ni=4),Yi===null||!(Wc&268435455)&&!(C_&268435455)||Il(Yi,ar)}function Zg(t,e){var n=an;an|=2;var i=UP();(Yi!==t||ar!==e)&&(Ma=null,zc(t,e));do try{aF();break}catch(r){NP(t,r)}while(1);if(kx(),an=n,qg.current=i,Mi!==null)throw Error(Xe(261));return Yi=null,ar=0,Ni}function aF(){for(;Mi!==null;)GP(Mi)}function lF(){for(;Mi!==null&&!R3();)GP(Mi)}function GP(t){var e=HP(t.alternate,t,Cs);t.memoizedProps=t.pendingProps,e===null?VP(t):Mi=e,Jx.current=null}function VP(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=tF(n,e),n!==null){n.flags&=32767,Mi=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ni=6,Mi=null;return}}else if(n=eF(n,e,Cs),n!==null){Mi=n;return}if(e=e.sibling,e!==null){Mi=e;return}Mi=e=t}while(e!==null);Ni===0&&(Ni=5)}function Bc(t,e,n){var i=yn,r=ro.transition;try{ro.transition=null,yn=1,cF(t,e,n,i)}finally{ro.transition=r,yn=i}return null}function cF(t,e,n,i){do Ah();while(Ml!==null);if(an&6)throw Error(Xe(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Xe(177));t.callbackNode=null,t.callbackPriority=0;var a=n.lanes|n.childLanes;if(j3(t,a),t===Yi&&(Mi=Yi=null,ar=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Mm||(Mm=!0,WP(Mg,function(){return Ah(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=ro.transition,ro.transition=null;var h=yn;yn=1;var l=an;an|=4,Jx.current=null,iF(t,n),FP(n,t),PO(e1),Lg=!!Qv,e1=Qv=null,t.current=n,rF(n),D3(),an=l,yn=h,ro.transition=a}else t.current=n;if(Mm&&(Mm=!1,Ml=t,$g=r),a=t.pendingLanes,a===0&&(kl=null),k3(n.stateNode),us(t,Ei()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Xg)throw Xg=!1,t=x1,x1=null,t;return $g&1&&t.tag!==0&&Ah(),a=t.pendingLanes,a&1?t===b1?Mf++:(Mf=0,b1=t):Mf=0,$l(),null}function Ah(){if(Ml!==null){var t=bI($g),e=ro.transition,n=yn;try{if(ro.transition=null,yn=16>t?16:t,Ml===null)var i=!1;else{if(t=Ml,Ml=null,$g=0,an&6)throw Error(Xe(331));var r=an;for(an|=4,gt=t.current;gt!==null;){var a=gt,h=a.child;if(gt.flags&16){var l=a.deletions;if(l!==null){for(var _=0;_<l.length;_++){var v=l[_];for(gt=v;gt!==null;){var S=gt;switch(S.tag){case 0:case 11:case 15:If(8,S,a)}var I=S.child;if(I!==null)I.return=S,gt=I;else for(;gt!==null;){S=gt;var B=S.sibling,z=S.return;if(RP(S),S===v){gt=null;break}if(B!==null){B.return=z,gt=B;break}gt=z}}}var V=a.alternate;if(V!==null){var J=V.child;if(J!==null){V.child=null;do{var ue=J.sibling;J.sibling=null,J=ue}while(J!==null)}}gt=a}}if(a.subtreeFlags&2064&&h!==null)h.return=a,gt=h;else e:for(;gt!==null;){if(a=gt,a.flags&2048)switch(a.tag){case 0:case 11:case 15:If(9,a,a.return)}var j=a.sibling;if(j!==null){j.return=a.return,gt=j;break e}gt=a.return}}var W=t.current;for(gt=W;gt!==null;){h=gt;var Z=h.child;if(h.subtreeFlags&2064&&Z!==null)Z.return=h,gt=Z;else e:for(h=W;gt!==null;){if(l=gt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:S_(9,l)}}catch(be){mi(l,l.return,be)}if(l===h){gt=null;break e}var ae=l.sibling;if(ae!==null){ae.return=l.return,gt=ae;break e}gt=l.return}}if(an=r,$l(),la&&typeof la.onPostCommitFiberRoot=="function")try{la.onPostCommitFiberRoot(y_,t)}catch{}i=!0}return i}finally{yn=n,ro.transition=e}}return!1}function nT(t,e,n){e=Dh(n,e),e=wP(t,e,1),t=Fl(t,e,1),e=Hr(),t!==null&&(cp(t,1,e),us(t,e))}function mi(t,e,n){if(t.tag===3)nT(t,t,n);else for(;e!==null;){if(e.tag===3){nT(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(kl===null||!kl.has(i))){t=Dh(n,t),t=AP(e,t,1),e=Fl(e,t,1),t=Hr(),e!==null&&(cp(e,1,t),us(e,t));break}}e=e.return}}function uF(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Hr(),t.pingedLanes|=t.suspendedLanes&n,Yi===t&&(ar&n)===n&&(Ni===4||Ni===3&&(ar&130023424)===ar&&500>Ei()-Yx?zc(t,0):Kx|=n),us(t,e)}function jP(t,e){e===0&&(t.mode&1?(e=xm,xm<<=1,!(xm&130023424)&&(xm=4194304)):e=1);var n=Hr();t=Ha(t,e),t!==null&&(cp(t,e,n),us(t,n))}function hF(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),jP(t,n)}function dF(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(Xe(314))}i!==null&&i.delete(e),jP(t,n)}var HP;HP=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||ls.current)os=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return os=!1,QO(t,e,n);os=!!(t.flags&131072)}else os=!1,Zn&&e.flags&1048576&&XI(e,Ng,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;fg(t,e),t=e.pendingProps;var r=Mh(e,Cr.current);wh(e,n),r=Wx(null,e,i,t,r,n);var a=qx();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,cs(i)?(a=!0,kg(e)):a=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Ux(e),r.updater=E_,e.stateNode=r,r._reactInternals=e,c1(e,i,t,n),e=d1(null,e,i,!0,a,n)):(e.tag=0,Zn&&a&&Rx(e),Gr(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(fg(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=pF(i),t=To(i,t),r){case 0:e=h1(null,e,i,t,n);break e;case 1:e=qE(null,e,i,t,n);break e;case 11:e=HE(null,e,i,t,n);break e;case 14:e=WE(null,e,i,To(i.type,t),n);break e}throw Error(Xe(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:To(i,r),h1(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:To(i,r),qE(t,e,i,r,n);case 3:e:{if(CP(e),t===null)throw Error(Xe(387));i=e.pendingProps,a=e.memoizedState,r=a.element,KI(t,e),Vg(e,i,null,n);var h=e.memoizedState;if(i=h.element,a.isDehydrated)if(a={element:i,isDehydrated:!1,cache:h.cache,pendingSuspenseBoundaries:h.pendingSuspenseBoundaries,transitions:h.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){r=Dh(Error(Xe(423)),e),e=XE(t,e,i,n,r);break e}else if(i!==r){r=Dh(Error(Xe(424)),e),e=XE(t,e,i,n,r);break e}else for(Ps=Ol(e.stateNode.containerInfo.firstChild),Bs=e,Zn=!0,Co=null,n=tP(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Bh(),i===r){e=Wa(t,e,n);break e}Gr(t,e,i,n)}e=e.child}return e;case 5:return nP(e),t===null&&o1(e),i=e.type,r=e.pendingProps,a=t!==null?t.memoizedProps:null,h=r.children,t1(i,r)?h=null:a!==null&&t1(i,a)&&(e.flags|=32),SP(t,e),Gr(t,e,h,n),e.child;case 6:return t===null&&o1(e),null;case 13:return IP(t,e,n);case 4:return Gx(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Lh(e,null,i,n):Gr(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:To(i,r),HE(t,e,i,r,n);case 7:return Gr(t,e,e.pendingProps,n),e.child;case 8:return Gr(t,e,e.pendingProps.children,n),e.child;case 12:return Gr(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,a=e.memoizedProps,h=r.value,kn(Ug,i._currentValue),i._currentValue=h,a!==null)if(Fo(a.value,h)){if(a.children===r.children&&!ls.current){e=Wa(t,e,n);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var l=a.dependencies;if(l!==null){h=a.child;for(var _=l.firstContext;_!==null;){if(_.context===i){if(a.tag===1){_=Na(-1,n&-n),_.tag=2;var v=a.updateQueue;if(v!==null){v=v.shared;var S=v.pending;S===null?_.next=_:(_.next=S.next,S.next=_),v.pending=_}}a.lanes|=n,_=a.alternate,_!==null&&(_.lanes|=n),a1(a.return,n,e),l.lanes|=n;break}_=_.next}}else if(a.tag===10)h=a.type===e.type?null:a.child;else if(a.tag===18){if(h=a.return,h===null)throw Error(Xe(341));h.lanes|=n,l=h.alternate,l!==null&&(l.lanes|=n),a1(h,n,e),h=a.sibling}else h=a.child;if(h!==null)h.return=a;else for(h=a;h!==null;){if(h===e){h=null;break}if(a=h.sibling,a!==null){a.return=h.return,h=a;break}h=h.return}a=h}Gr(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,wh(e,n),r=oo(r),i=i(r),e.flags|=1,Gr(t,e,i,n),e.child;case 14:return i=e.type,r=To(i,e.pendingProps),r=To(i.type,r),WE(t,e,i,r,n);case 15:return EP(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:To(i,r),fg(t,e),e.tag=1,cs(i)?(t=!0,kg(e)):t=!1,wh(e,n),QI(e,i,r),c1(e,i,r,n),d1(null,e,i,!0,t,n);case 19:return PP(t,e,n);case 22:return TP(t,e,n)}throw Error(Xe(156,e.tag))};function WP(t,e){return _I(t,e)}function fF(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function eo(t,e,n,i){return new fF(t,e,n,i)}function nb(t){return t=t.prototype,!(!t||!t.isReactComponent)}function pF(t){if(typeof t=="function")return nb(t)?1:0;if(t!=null){if(t=t.$$typeof,t===bx)return 11;if(t===wx)return 14}return 2}function Nl(t,e){var n=t.alternate;return n===null?(n=eo(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function gg(t,e,n,i,r,a){var h=2;if(i=t,typeof t=="function")nb(t)&&(h=1);else if(typeof t=="string")h=5;else e:switch(t){case ih:return Nc(n.children,r,a,e);case xx:h=8,r|=8;break;case Rv:return t=eo(12,n,e,r|2),t.elementType=Rv,t.lanes=a,t;case Dv:return t=eo(13,n,e,r),t.elementType=Dv,t.lanes=a,t;case Ov:return t=eo(19,n,e,r),t.elementType=Ov,t.lanes=a,t;case eI:return I_(n,r,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Y2:h=10;break e;case Q2:h=9;break e;case bx:h=11;break e;case wx:h=14;break e;case Tl:h=16,i=null;break e}throw Error(Xe(130,t==null?t:typeof t,""))}return e=eo(h,n,e,r),e.elementType=t,e.type=i,e.lanes=a,e}function Nc(t,e,n,i){return t=eo(7,t,i,e),t.lanes=n,t}function I_(t,e,n,i){return t=eo(22,t,i,e),t.elementType=eI,t.lanes=n,t.stateNode={isHidden:!1},t}function S0(t,e,n){return t=eo(6,t,null,e),t.lanes=n,t}function C0(t,e,n){return e=eo(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function mF(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=a0(0),this.expirationTimes=a0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=a0(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function ib(t,e,n,i,r,a,h,l,_){return t=new mF(t,e,n,l,_),e===1?(e=1,a===!0&&(e|=8)):e=0,a=eo(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ux(a),t}function gF(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:nh,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function qP(t){if(!t)return jl;t=t._reactInternals;e:{if(Kc(t)!==t||t.tag!==1)throw Error(Xe(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(cs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Xe(171))}if(t.tag===1){var n=t.type;if(cs(n))return WI(t,n,e)}return e}function XP(t,e,n,i,r,a,h,l,_){return t=ib(n,i,!0,t,r,a,h,l,_),t.context=qP(null),n=t.current,i=Hr(),r=zl(n),a=Na(i,r),a.callback=e??null,Fl(n,a,r),t.current.lanes=r,cp(t,r,i),us(t,i),t}function P_(t,e,n,i){var r=e.current,a=Hr(),h=zl(r);return n=qP(n),e.context===null?e.context=n:e.pendingContext=n,e=Na(a,h),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Fl(r,e,h),t!==null&&(Ro(t,r,h,a),ug(t,r,h)),h}function Jg(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function iT(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function rb(t,e){iT(t,e),(t=t.alternate)&&iT(t,e)}function _F(){return null}var $P=typeof reportError=="function"?reportError:function(t){console.error(t)};function sb(t){this._internalRoot=t}M_.prototype.render=sb.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Xe(409));P_(t,e,null,null)};M_.prototype.unmount=sb.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;qc(function(){P_(null,t,null,null)}),e[ja]=null}};function M_(t){this._internalRoot=t}M_.prototype.unstable_scheduleHydration=function(t){if(t){var e=EI();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Cl.length&&e!==0&&e<Cl[n].priority;n++);Cl.splice(n,0,t),n===0&&SI(t)}};function ob(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function B_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function rT(){}function yF(t,e,n,i,r){if(r){if(typeof i=="function"){var a=i;i=function(){var v=Jg(h);a.call(v)}}var h=XP(e,i,t,0,null,!1,!1,"",rT);return t._reactRootContainer=h,t[ja]=h.current,Wf(t.nodeType===8?t.parentNode:t),qc(),h}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var l=i;i=function(){var v=Jg(_);l.call(v)}}var _=ib(t,0,!1,null,null,!1,!1,"",rT);return t._reactRootContainer=_,t[ja]=_.current,Wf(t.nodeType===8?t.parentNode:t),qc(function(){P_(e,_,n,i)}),_}function L_(t,e,n,i,r){var a=n._reactRootContainer;if(a){var h=a;if(typeof r=="function"){var l=r;r=function(){var _=Jg(h);l.call(_)}}P_(e,h,t,r)}else h=yF(n,e,t,r,i);return Jg(h)}wI=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=_f(e.pendingLanes);n!==0&&(Tx(e,n|1),us(e,Ei()),!(an&6)&&(Oh=Ei()+500,$l()))}break;case 13:qc(function(){var i=Ha(t,1);if(i!==null){var r=Hr();Ro(i,t,1,r)}}),rb(t,1)}};Sx=function(t){if(t.tag===13){var e=Ha(t,134217728);if(e!==null){var n=Hr();Ro(e,t,134217728,n)}rb(t,134217728)}};AI=function(t){if(t.tag===13){var e=zl(t),n=Ha(t,e);if(n!==null){var i=Hr();Ro(n,t,e,i)}rb(t,e)}};EI=function(){return yn};TI=function(t,e){var n=yn;try{return yn=t,e()}finally{yn=n}};Wv=function(t,e,n){switch(e){case"input":if(zv(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=w_(i);if(!r)throw Error(Xe(90));nI(i),zv(i,r)}}}break;case"textarea":rI(t,n);break;case"select":e=n.value,e!=null&&yh(t,!!n.multiple,e,!1)}};hI=Qx;dI=qc;var vF={usingClientEntryPoint:!1,Events:[hp,ah,w_,cI,uI,Qx]},ef={findFiberByHostInstance:Rc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},xF={bundleType:ef.bundleType,version:ef.version,rendererPackageName:ef.rendererPackageName,rendererConfig:ef.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Za.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=mI(t),t===null?null:t.stateNode},findFiberByHostInstance:ef.findFiberByHostInstance||_F,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bm.isDisabled&&Bm.supportsFiber)try{y_=Bm.inject(xF),la=Bm}catch{}}Os.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vF;Os.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ob(e))throw Error(Xe(200));return gF(t,e,null,n)};Os.createRoot=function(t,e){if(!ob(t))throw Error(Xe(299));var n=!1,i="",r=$P;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=ib(t,1,!1,null,null,n,!1,i,r),t[ja]=e.current,Wf(t.nodeType===8?t.parentNode:t),new sb(e)};Os.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Xe(188)):(t=Object.keys(t).join(","),Error(Xe(268,t)));return t=mI(e),t=t===null?null:t.stateNode,t};Os.flushSync=function(t){return qc(t)};Os.hydrate=function(t,e,n){if(!B_(e))throw Error(Xe(200));return L_(null,t,e,!0,n)};Os.hydrateRoot=function(t,e,n){if(!ob(t))throw Error(Xe(405));var i=n!=null&&n.hydratedSources||null,r=!1,a="",h=$P;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(h=n.onRecoverableError)),e=XP(e,null,t,1,n??null,r,!1,a,h),t[ja]=e.current,Wf(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new M_(e)};Os.render=function(t,e,n){if(!B_(e))throw Error(Xe(200));return L_(null,t,e,!1,n)};Os.unmountComponentAtNode=function(t){if(!B_(t))throw Error(Xe(40));return t._reactRootContainer?(qc(function(){L_(null,null,t,!1,function(){t._reactRootContainer=null,t[ja]=null})}),!0):!1};Os.unstable_batchedUpdates=Qx;Os.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!B_(n))throw Error(Xe(200));if(t==null||t._reactInternals===void 0)throw Error(Xe(38));return L_(t,e,n,!1,i)};Os.version="18.2.0-next-9e3b772b8-20220608";function ZP(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ZP)}catch(t){console.error(t)}}ZP(),X2.exports=Os;var ab=X2.exports,sT=ab;Bv.createRoot=sT.createRoot,Bv.hydrateRoot=sT.hydrateRoot;const bF="modulepreload",wF=function(t){return"/mapengine-survey/step3/deckgl-tripslayer/"+t},oT={},AF=function(e,n,i){if(!n||n.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(n.map(a=>{if(a=wF(a),a in oT)return;oT[a]=!0;const h=a.endsWith(".css"),l=h?'[rel="stylesheet"]':"";if(!!i)for(let S=r.length-1;S>=0;S--){const I=r[S];if(I.href===a&&(!h||I.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${l}`))return;const v=document.createElement("link");if(v.rel=h?"stylesheet":bF,h||(v.as="script",v.crossOrigin=""),v.href=a,document.head.appendChild(v),h)return new Promise((S,I)=>{v.addEventListener("load",S),v.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e()).catch(a=>{const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=a,window.dispatchEvent(h),!h.defaultPrevented)throw a})},EF=it.createContext(null);function TF(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,a=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===a}function La(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!La(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!La(t[r],e[r]))return!1;return!0}return!1}function SF(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function aT(t,e){if(!t.getProjection)return;const n=t.getProjection(),i=e.getProjection();La(n,i)||e.setProjection(n)}function lT(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function cT(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const r=t.center;t.center=new r.constructor(n.longitude,n.latitude),i=i||r!==t.center}if("zoom"in n){const r=t.zoom;t.zoom=n.zoom,i=i||r!==t.zoom}if("bearing"in n){const r=t.bearing;t.bearing=n.bearing,i=i||r!==t.bearing}if("pitch"in n){const r=t.pitch;t.pitch=n.pitch,i=i||r!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const CF=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function uT(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{let r=null;"interactive"in i&&(r=Object.assign({},i),delete r.interactive);const a=e[i.ref];if(a){r=r||Object.assign({},i),delete r.ref;for(const h of CF)h in a&&(r[h]=a[h])}return r||i});return{...t,layers:n}}const hT={version:8,sources:{},layers:[]},dT={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},I0={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},fT={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},IF=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],PF=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Fh{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const a=this.props[fT[r.type]];a?a(r):r.type==="error"&&console.error(r.error)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const a=this.props[dT[r.type]];a&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),a(r),delete r.features)},this._onCameraEvent=r=>{if(!this._internalUpdate){const a=this.props[I0[r.type]];a&&a(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const r=this._updateSize(e),a=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||r||a&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=Fh.savedMaps.pop();if(!i)return null;const r=i.map,a=r.getContainer();for(n.className=a.className;a.childNodes.length>0;)n.appendChild(a.childNodes[0]);r._container=n;const h=r._resizeObserver;h&&(h.disconnect(),h.observe(n)),i.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:l}=e;return l&&(l.bounds?r.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):i._updateViewState(l,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),r._update(),i}_initialize(e){const{props:n}=this,{mapStyle:i=hT}=n,r={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||MF()||null,container:e,style:uT(i)},a=r.initialViewState||r.viewState||r;if(Object.assign(r,{center:[a.longitude||0,a.latitude||0],zoom:a.zoom||0,pitch:a.pitch||0,bearing:a.bearing||0}),n.gl){const S=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=S,n.gl)}const h=new this._MapClass(r);a.padding&&h.setPadding(a.padding),n.cursor&&(h.getCanvas().style.cursor=n.cursor),this._createShadowTransform(h);const l=h._render;h._render=S=>{this._inRender=!0,l.call(h,S),this._inRender=!1};const _=h._renderTaskQueue.run;h._renderTaskQueue.run=S=>{_.call(h._renderTaskQueue,S),this._onBeforeRepaint()},h.on("render",()=>this._onAfterRepaint());const v=h.fire;h.fire=this._fireEvent.bind(this,v),h.on("resize",()=>{this._renderTransform.resize(h.transform.width,h.transform.height)}),h.on("styledata",()=>{this._updateStyleComponents(this.props,{}),aT(h.transform,this._renderTransform)}),h.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const S in dT)h.on(S,this._onPointerEvent);for(const S in I0)h.on(S,this._onCameraEvent);for(const S in fT)h.on(S,this._onEvent);this._map=h}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),Fh.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=SF(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,r=this._renderTransform,{zoom:a,pitch:h,bearing:l}=r,_=i.isMoving();_&&(r.cameraElevationReference="sea");const v=cT(r,{...lT(i.transform),...e});if(_&&(r.cameraElevationReference="ground"),v&&n){const S=this._deferredEvents;S.move=!0,S.zoom||(S.zoom=a!==r.zoom),S.rotate||(S.rotate=l!==r.bearing),S.pitch||(S.pitch=h!==r.pitch)}return _||cT(i.transform,e),v}_updateSettings(e,n){const i=this._map;let r=!1;for(const a of IF)if(a in e&&!La(e[a],n[a])){r=!0;const h=i[`set${a[0].toUpperCase()}${a.slice(1)}`];h==null||h.call(i,e[a])}return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:i=hT,styleDiffing:r=!0}=e,a={diff:r};return"localIdeographFontFamily"in e&&(a.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(uT(i),a),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let r=!1;return i.isStyleLoaded()&&("light"in e&&i.setLight&&!La(e.light,n.light)&&(r=!0,i.setLight(e.light)),"fog"in e&&i.setFog&&!La(e.fog,n.fog)&&(r=!0,i.setFog(e.fog)),"terrain"in e&&i.setTerrain&&!La(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(r=!0,i.setTerrain(e.terrain))),r}_updateHandlers(e,n){var i,r;const a=this._map;let h=!1;for(const l of PF){const _=(i=e[l])!==null&&i!==void 0?i:!0,v=(r=n[l])!==null&&r!==void 0?r:!0;La(_,v)||(h=!0,_?a[l].enable(_):a[l].disable())}return h}_queryRenderedFeatures(e){const n=this._map,i=n.transform,{interactiveLayerIds:r=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:r.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=i}}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const a=e.type,h=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,l=this._queryRenderedFeatures(e.point),_=l.length>0;!_&&h&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,_&&!h&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=a}else this._hoveredFeatures=null}_fireEvent(e,n,i){const r=this._map,a=r.transform,h=typeof n=="string"?n:n.type;return h==="move"&&this._updateViewState(this.props,!1),h in I0&&(typeof n=="object"&&(n.viewState=lT(a)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,n,i),r.transform=a,r):(e.call(r,n,i),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{aT(this._renderTransform,n),e.transform=n}}}Fh.savedMaps=[];function MF(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const BF=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function LF(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:i=>{const r=e.transform;e.transform=t.transform;const a=e.project(i);return e.transform=r,a},unproject:i=>{const r=e.transform;e.transform=t.transform;const a=e.unproject(i);return e.transform=r,a},queryTerrainElevation:(i,r)=>{const a=e.transform;e.transform=t.transform;const h=e.queryTerrainElevation(i,r);return e.transform=a,h},queryRenderedFeatures:(i,r)=>{const a=e.transform;e.transform=t.transform;const h=e.queryRenderedFeatures(i,r);return e.transform=a,h}};for(const i of RF(e))!(i in n)&&!BF.includes(i)&&(n[i]=e[i].bind(e));return n}function RF(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const DF=typeof document<"u"?it.useLayoutEffect:it.useEffect,OF=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function FF(t,e){for(const i of OF)i in e&&(t[i]=e[i]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,i=>{i&&console.error(i)},!1)}const R_=it.createContext(null);function kF(t,e,n){const i=it.useContext(EF),[r,a]=it.useState(null),h=it.useRef(),{current:l}=it.useRef({mapLib:null,map:null});it.useEffect(()=>{const S=t.mapLib;let I=!0,B;return Promise.resolve(S||n).then(z=>{if(!I)return;if(!z)throw new Error("Invalid mapLib");const V="Map"in z?z:z.default;if(!V.Map)throw new Error("Invalid mapLib");if(FF(V,t),!V.supported||V.supported(t))t.reuseMaps&&(B=Fh.reuse(t,h.current)),B||(B=new Fh(V.Map,t,h.current)),l.map=LF(B),l.mapLib=V,a(B),i==null||i.onMapMount(l.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(z=>{const{onError:V}=t;V?V({type:"error",target:null,originalEvent:null,error:z}):console.error(z)}),()=>{I=!1,B&&(i==null||i.onMapUnmount(t.id),t.reuseMaps?B.recycle():B.destroy())}},[]),DF(()=>{r&&r.setProps(t)}),it.useImperativeHandle(e,()=>l.map,[r]);const _=it.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),v={height:"100%"};return it.createElement("div",{id:t.id,ref:h,style:_},r&&it.createElement(R_.Provider,{value:l},it.createElement("div",{"mapboxgl-children":"",style:v},t.children)))}const zF=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Yc(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const r=e[i];Number.isFinite(r)&&!zF.test(i)?n[i]=`${r}px`:n[i]=r}}function NF(t,e){const{map:n,mapLib:i}=it.useContext(R_),r=it.useRef({props:t});r.current.props=t;const a=it.useMemo(()=>{let J=!1;it.Children.forEach(t.children,W=>{W&&(J=!0)});const ue={...t,element:J?document.createElement("div"):null},j=new i.Marker(ue);return j.setLngLat([t.longitude,t.latitude]),j.getElement().addEventListener("click",W=>{var Z,ae;(ae=(Z=r.current.props).onClick)===null||ae===void 0||ae.call(Z,{type:"click",target:j,originalEvent:W})}),j.on("dragstart",W=>{var Z,ae;const be=W;be.lngLat=a.getLngLat(),(ae=(Z=r.current.props).onDragStart)===null||ae===void 0||ae.call(Z,be)}),j.on("drag",W=>{var Z,ae;const be=W;be.lngLat=a.getLngLat(),(ae=(Z=r.current.props).onDrag)===null||ae===void 0||ae.call(Z,be)}),j.on("dragend",W=>{var Z,ae;const be=W;be.lngLat=a.getLngLat(),(ae=(Z=r.current.props).onDragEnd)===null||ae===void 0||ae.call(Z,be)}),j},[]);it.useEffect(()=>(a.addTo(n.getMap()),()=>{a.remove()}),[]);const{longitude:h,latitude:l,offset:_,style:v,draggable:S=!1,popup:I=null,rotation:B=0,rotationAlignment:z="auto",pitchAlignment:V="auto"}=t;return it.useEffect(()=>{Yc(a.getElement(),v)},[v]),it.useImperativeHandle(e,()=>a,[]),(a.getLngLat().lng!==h||a.getLngLat().lat!==l)&&a.setLngLat([h,l]),_&&!TF(a.getOffset(),_)&&a.setOffset(_),a.isDraggable()!==S&&a.setDraggable(S),a.getRotation()!==B&&a.setRotation(B),a.getRotationAlignment()!==z&&a.setRotationAlignment(z),a.getPitchAlignment()!==V&&a.setPitchAlignment(V),a.getPopup()!==I&&a.setPopup(I),ab.createPortal(t.children,a.getElement())}it.memo(it.forwardRef(NF));function pT(t){return new Set(t?t.trim().split(/\s+/):[])}function UF(t,e){const{map:n,mapLib:i}=it.useContext(R_),r=it.useMemo(()=>document.createElement("div"),[]),a=it.useRef({props:t});a.current.props=t;const h=it.useMemo(()=>{const l={...t},_=new i.Popup(l);return _.setLngLat([t.longitude,t.latitude]),_.once("open",v=>{var S,I;(I=(S=a.current.props).onOpen)===null||I===void 0||I.call(S,v)}),_},[]);if(it.useEffect(()=>{const l=_=>{var v,S;(S=(v=a.current.props).onClose)===null||S===void 0||S.call(v,_)};return h.on("close",l),h.setDOMContent(r).addTo(n.getMap()),()=>{h.off("close",l),h.isOpen()&&h.remove()}},[]),it.useEffect(()=>{Yc(h.getElement(),t.style)},[t.style]),it.useImperativeHandle(e,()=>h,[]),h.isOpen()&&((h.getLngLat().lng!==t.longitude||h.getLngLat().lat!==t.latitude)&&h.setLngLat([t.longitude,t.latitude]),t.offset&&!La(h.options.offset,t.offset)&&h.setOffset(t.offset),(h.options.anchor!==t.anchor||h.options.maxWidth!==t.maxWidth)&&(h.options.anchor=t.anchor,h.setMaxWidth(t.maxWidth)),h.options.className!==t.className)){const l=pT(h.options.className),_=pT(t.className);for(const v of l)_.has(v)||h.removeClassName(v);for(const v of _)l.has(v)||h.addClassName(v);h.options.className=t.className}return ab.createPortal(t.children,r)}it.memo(it.forwardRef(UF));function fp(t,e,n,i){const r=it.useContext(R_),a=it.useMemo(()=>t(r),[]);return it.useEffect(()=>{const h=i||n||e,l=typeof e=="function"&&typeof n=="function"?e:null,_=typeof n=="function"?n:typeof e=="function"?e:null,{map:v}=r;return v.hasControl(a)||(v.addControl(a,h==null?void 0:h.position),l&&l(r)),()=>{_&&_(r),v.hasControl(a)&&v.removeControl(a)}},[]),a}function GF(t){const e=fp(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return it.useEffect(()=>{Yc(e._container,t.style)},[t.style]),null}it.memo(GF);function VF(t){const e=fp(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return it.useEffect(()=>{Yc(e._controlContainer,t.style)},[t.style]),null}it.memo(VF);function jF(t,e){const n=it.useRef({props:t}),i=fp(({mapLib:r})=>{const a=new r.GeolocateControl(t),h=a._setupUI;return a._setupUI=l=>{a._container.hasChildNodes()||h(l)},a.on("geolocate",l=>{var _,v;(v=(_=n.current.props).onGeolocate)===null||v===void 0||v.call(_,l)}),a.on("error",l=>{var _,v;(v=(_=n.current.props).onError)===null||v===void 0||v.call(_,l)}),a.on("outofmaxbounds",l=>{var _,v;(v=(_=n.current.props).onOutOfMaxBounds)===null||v===void 0||v.call(_,l)}),a.on("trackuserlocationstart",l=>{var _,v;(v=(_=n.current.props).onTrackUserLocationStart)===null||v===void 0||v.call(_,l)}),a.on("trackuserlocationend",l=>{var _,v;(v=(_=n.current.props).onTrackUserLocationEnd)===null||v===void 0||v.call(_,l)}),a},{position:t.position});return n.current.props=t,it.useImperativeHandle(e,()=>i,[]),it.useEffect(()=>{Yc(i._container,t.style)},[t.style]),null}it.memo(it.forwardRef(jF));function HF(t){const e=fp(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return it.useEffect(()=>{Yc(e._container,t.style)},[t.style]),null}it.memo(HF);function WF(t){const e=fp(({mapLib:a})=>new a.ScaleControl(t),{position:t.position}),n=it.useRef(t),i=n.current;n.current=t;const{style:r}=t;return t.maxWidth!==void 0&&t.maxWidth!==i.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==i.unit&&e.setUnit(t.unit),it.useEffect(()=>{Yc(e._container,r)},[r]),null}it.memo(WF);const qF=AF(()=>import("./__vite-optional-peer-dep_mapbox-gl_react-map-gl-b25bb000.js"),[]),XF=(()=>it.forwardRef(function(e,n){return kF(e,n,qF)}))();var JP={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(ZD,function(){var n,i,r;function a(l,_){if(!n)n=_;else if(!i)i=_;else{var v="var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk);",S={};n(S),r=_(S),typeof window<"u"&&(r.workerUrl=window.URL.createObjectURL(new Blob([v],{type:"text/javascript"})))}}a(["exports"],function(l){function _(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var v=S;function S(c,s){this.x=c,this.y=s}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,s){return this.clone()._rotateAround(c,s)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var s=c.x-this.x,u=c.y-this.y;return s*s+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,s){return Math.atan2(this.x*s-this.y*c,this.x*c+this.y*s)},_matMult:function(c){var s=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=s,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var s=Math.cos(c),u=Math.sin(c),f=u*this.x+s*this.y;return this.x=s*this.x-u*this.y,this.y=f,this},_rotateAround:function(c,s){var u=Math.cos(c),f=Math.sin(c),m=s.y+f*(this.x-s.x)+u*(this.y-s.y);return this.x=s.x+u*(this.x-s.x)-f*(this.y-s.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(c){return c instanceof S?c:Array.isArray(c)?new S(c[0],c[1]):c};var I=_(v),B=z;function z(c,s,u,f){this.cx=3*c,this.bx=3*(u-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(f-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=s,this.p2x=u,this.p2y=f}z.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,s){if(s===void 0&&(s=1e-6),c<0)return 0;if(c>1)return 1;for(var u=c,f=0;f<8;f++){var m=this.sampleCurveX(u)-c;if(Math.abs(m)<s)return u;var b=this.sampleCurveDerivativeX(u);if(Math.abs(b)<1e-6)break;u-=m/b}var w=0,A=1;for(u=c,f=0;f<20&&(m=this.sampleCurveX(u),!(Math.abs(m-c)<s));f++)c>m?w=u:A=u,u=.5*(A-w)+w;return u},solve:function(c,s){return this.sampleCurveY(this.solveCurveX(c,s))}};var V=_(B);function J(c,s,u,f){const m=new V(c,s,u,f);return function(b){return m.solve(b)}}const ue=J(.25,.1,.25,1);function j(c,s,u){return Math.min(u,Math.max(s,c))}function W(c,s,u){const f=u-s,m=((c-s)%f+f)%f+s;return m===s?u:m}function Z(c,...s){for(const u of s)for(const f in u)c[f]=u[f];return c}let ae=1;function be(c,s,u){const f={};for(const m in c)f[m]=s.call(u||this,c[m],m,c);return f}function Ee(c,s,u){const f={};for(const m in c)s.call(u||this,c[m],m,c)&&(f[m]=c[m]);return f}function Le(c){return Array.isArray(c)?c.map(Le):typeof c=="object"&&c?be(c,Le):c}const ke={};function Ue(c){ke[c]||(typeof console<"u"&&console.warn(c),ke[c]=!0)}function Me(c,s,u){return(u.y-c.y)*(s.x-c.x)>(s.y-c.y)*(u.x-c.x)}function ut(c){let s=0;for(let u,f,m=0,b=c.length,w=b-1;m<b;w=m++)u=c[m],f=c[w],s+=(f.x-u.x)*(u.y+f.y);return s}function Lt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Ft=null;function Rt(c){if(Ft==null){const s=c.navigator?c.navigator.userAgent:null;Ft=!!c.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Ft}function Jn(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const ai="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Bi,tt;const At={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(c){const s=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(c,s=0){return this.getImageCanvasContext(c).getImageData(-s,-s,c.width+2*s,c.height+2*s)},getImageCanvasContext(c){const s=window.document.createElement("canvas"),u=s.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return s.width=c.width,s.height=c.height,u.drawImage(c,0,0,c.width,c.height),u},resolveURL:c=>(Bi||(Bi=document.createElement("a")),Bi.href=c,Bi.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(tt==null&&(tt=matchMedia("(prefers-reduced-motion: reduce)")),tt.matches)}},Pt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class tn extends Error{constructor(s,u,f,m){super(`AJAXError: ${u} (${s}): ${f}`),this.status=s,this.statusText=u,this.url=f,this.body=m}}const $t=Lt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Kn=c=>Pt.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))];function Zt(c,s){const u=new AbortController,f=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:$t(),signal:u.signal});let m=!1,b=!1;return c.type==="json"&&f.headers.set("Accept","application/json"),b||fetch(f).then(w=>w.ok?(A=>{(c.type==="arrayBuffer"||c.type==="image"?A.arrayBuffer():c.type==="json"?A.json():A.text()).then(C=>{b||(m=!0,s(null,C,A.headers.get("Cache-Control"),A.headers.get("Expires")))}).catch(C=>{b||s(new Error(C.message))})})(w):w.blob().then(A=>s(new tn(w.status,w.statusText,c.url,A)))).catch(w=>{w.code!==20&&s(new Error(w.message))}),{cancel:()=>{b=!0,m||u.abort()}}}const Pr=function(c,s){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){if(Lt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,s);if(!Lt())return(Kn(c.url)||Zt)(c,s)}if(!(/^file:/.test(u=c.url)||/^file:/.test($t())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Zt(c,s);if(Lt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,s,void 0,!0)}var u;return function(f,m){const b=new XMLHttpRequest;b.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(b.responseType="arraybuffer");for(const w in f.headers)b.setRequestHeader(w,f.headers[w]);return f.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=f.credentials==="include",b.onerror=()=>{m(new Error(b.statusText))},b.onload=()=>{if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let w=b.response;if(f.type==="json")try{w=JSON.parse(b.response)}catch(A){return m(A)}m(null,w,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else{const w=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});m(new tn(b.status,b.statusText,f.url,w))}},b.send(f.body),{cancel:()=>b.abort()}}(c,s)},Qi=function(c,s){return Pr(Z(c,{type:"arrayBuffer"}),s)};function mn(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const s=new URL(c),u=window.location;return s.protocol===u.protocol&&s.host===u.host}function cr(c,s,u){u[c]&&u[c].indexOf(s)!==-1||(u[c]=u[c]||[],u[c].push(s))}function cn(c,s,u){if(u&&u[c]){const f=u[c].indexOf(s);f!==-1&&u[c].splice(f,1)}}class gn{constructor(s,u={}){Z(this,u),this.type=s}}class er extends gn{constructor(s,u={}){super("error",Z({error:s},u))}}class ur{on(s,u){return this._listeners=this._listeners||{},cr(s,u,this._listeners),this}off(s,u){return cn(s,u,this._listeners),cn(s,u,this._oneTimeListeners),this}once(s,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},cr(s,u,this._oneTimeListeners),this):new Promise(f=>this.once(s,f))}fire(s,u){typeof s=="string"&&(s=new gn(s,u||{}));const f=s.type;if(this.listens(f)){s.target=this;const m=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const A of m)A.call(this,s);const b=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const A of b)cn(f,A,this._oneTimeListeners),A.call(this,s);const w=this._eventedParent;w&&(Z(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(s))}else s instanceof er&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,u){return this._eventedParent=s,this._eventedParentData=u,this}}var Be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const tr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Xr(c,s){const u={};for(const f in c)f!=="ref"&&(u[f]=c[f]);return tr.forEach(f=>{f in s&&(u[f]=s[f])}),u}function Ut(c,s){if(Array.isArray(c)){if(!Array.isArray(s)||c.length!==s.length)return!1;for(let u=0;u<c.length;u++)if(!Ut(c[u],s[u]))return!1;return!0}if(typeof c=="object"&&c!==null&&s!==null){if(typeof s!="object"||Object.keys(c).length!==Object.keys(s).length)return!1;for(const u in c)if(!Ut(c[u],s[u]))return!1;return!0}return c===s}const Gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ks(c,s,u){u.push({command:Gt.addSource,args:[c,s[c]]})}function zs(c,s,u){s.push({command:Gt.removeSource,args:[c]}),u[c]=!0}function lo(c,s,u,f){zs(c,u,f),ks(c,s,u)}function Li(c,s,u){let f;for(f in c[u])if(Object.prototype.hasOwnProperty.call(c[u],f)&&f!=="data"&&!Ut(c[u][f],s[u][f]))return!1;for(f in s[u])if(Object.prototype.hasOwnProperty.call(s[u],f)&&f!=="data"&&!Ut(c[u][f],s[u][f]))return!1;return!0}function Sn(c,s,u,f,m,b){let w;for(w in s=s||{},c=c||{})Object.prototype.hasOwnProperty.call(c,w)&&(Ut(c[w],s[w])||u.push({command:b,args:[f,w,s[w],m]}));for(w in s)Object.prototype.hasOwnProperty.call(s,w)&&!Object.prototype.hasOwnProperty.call(c,w)&&(Ut(c[w],s[w])||u.push({command:b,args:[f,w,s[w],m]}))}function ha(c){return c.id}function No(c,s){return c[s.id]=s,c}class We{constructor(s,u,f,m){this.message=(s?`${s}: `:"")+f,m&&(this.identifier=m),u!=null&&u.__line__&&(this.line=u.__line__)}}function Ri(c,...s){for(const u of s)for(const f in u)c[f]=u[f];return c}class Di extends Error{constructor(s,u){super(u),this.message=u,this.key=s}}class $r{constructor(s,u=[]){this.parent=s,this.bindings={};for(const[f,m]of u)this.bindings[f]=m}concat(s){return new $r(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const ds={kind:"null"},$e={kind:"number"},It={kind:"string"},Mt={kind:"boolean"},Ti={kind:"color"},fs={kind:"object"},Et={kind:"value"},Zr={kind:"collator"},Jr={kind:"formatted"},Mr={kind:"padding"},hr={kind:"resolvedImage"},Ns={kind:"variableAnchorOffsetCollection"};function li(c,s){return{kind:"array",itemType:c,N:s}}function un(c){if(c.kind==="array"){const s=un(c.itemType);return typeof c.N=="number"?`array<${s}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${s}>`}return c.kind}const co=[ds,$e,It,Mt,Ti,Jr,fs,li(Et),Mr,hr,Ns];function Kr(c,s){if(s.kind==="error")return null;if(c.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Kr(c.itemType,s.itemType))&&(typeof c.N!="number"||c.N===s.N))return null}else{if(c.kind===s.kind)return null;if(c.kind==="value"){for(const u of co)if(!Kr(u,s))return null}}return`Expected ${un(c)} but found ${un(s)} instead.`}function ie(c,s){return s.some(u=>u.kind===c.kind)}function N(c,s){return s.some(u=>u==="null"?c===null:u==="array"?Array.isArray(c):u==="object"?c&&!Array.isArray(c)&&typeof c=="object":u===typeof c)}function G(c,s){return c.kind==="array"&&s.kind==="array"?c.itemType.kind===s.itemType.kind&&typeof c.N=="number":c.kind===s.kind}const K=.96422,oe=.82521,he=4/29,_e=6/29,fe=3*_e*_e,de=_e*_e*_e,ve=Math.PI/180,Re=180/Math.PI;function De(c){return(c%=360)<0&&(c+=360),c}function ze([c,s,u,f]){let m,b;const w=Ct((.2225045*(c=vt(c))+.7168786*(s=vt(s))+.0606169*(u=vt(u)))/1);c===s&&s===u?m=b=w:(m=Ct((.4360747*c+.3850649*s+.1430804*u)/K),b=Ct((.0139322*c+.0971045*s+.7141733*u)/oe));const A=116*w-16;return[A<0?0:A,500*(m-w),200*(w-b),f]}function vt(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Ct(c){return c>de?Math.pow(c,1/3):c/fe+he}function lt([c,s,u,f]){let m=(c+16)/116,b=isNaN(s)?m:m+s/500,w=isNaN(u)?m:m-u/200;return m=1*St(m),b=K*St(b),w=oe*St(w),[pt(3.1338561*b-1.6168667*m-.4906146*w),pt(-.9787684*b+1.9161415*m+.033454*w),pt(.0719453*b-.2289914*m+1.4052427*w),f]}function pt(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function St(c){return c>_e?c*c*c:fe*(c-he)}function Ht(c){return parseInt(c.padEnd(2,c),16)/255}function qt(c,s){return Bt(s?c/100:c,0,1)}function Bt(c,s,u){return Math.min(Math.max(s,c),u)}function Dt(c){return!c.some(Number.isNaN)}const _i={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class wt{constructor(s,u,f,m=1,b=!0){this.r=s,this.g=u,this.b=f,this.a=m,b||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[s,u,f,m]))}static parse(s){if(s instanceof wt)return s;if(typeof s!="string")return;const u=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const m=_i[f];if(m){const[w,A,C]=m;return[w/255,A/255,C/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const w=f.length<6?1:2;let A=1;return[Ht(f.slice(A,A+=w)),Ht(f.slice(A,A+=w)),Ht(f.slice(A,A+=w)),Ht(f.slice(A,A+w)||"ff")]}if(f.startsWith("rgb")){const w=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[A,C,M,O,k,U,q,X,te,se,ce,xe]=w,me=[O||" ",q||" ",se].join("");if(me==="  "||me==="  /"||me===",,"||me===",,,"){const we=[M,U,te].join(""),Se=we==="%%%"?100:we===""?255:0;if(Se){const Fe=[Bt(+C/Se,0,1),Bt(+k/Se,0,1),Bt(+X/Se,0,1),ce?qt(+ce,xe):1];if(Dt(Fe))return Fe}}return}}const b=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[w,A,C,M,O,k,U,q,X]=b,te=[C||" ",O||" ",U].join("");if(te==="  "||te==="  /"||te===",,"||te===",,,"){const se=[+A,Bt(+M,0,100),Bt(+k,0,100),q?qt(+q,X):1];if(Dt(se))return function([ce,xe,me,we]){function Se(Fe){const nt=(Fe+ce/30)%12,dt=xe*Math.min(me,1-me);return me-dt*Math.max(-1,Math.min(nt-3,9-nt,1))}return ce=De(ce),xe/=100,me/=100,[Se(0),Se(8),Se(4),we]}(se)}}}(s);return u?new wt(...u,!1):void 0}get rgb(){const{r:s,g:u,b:f,a:m}=this,b=m||1/0;return this.overwriteGetter("rgb",[s/b,u/b,f/b,m])}get hcl(){return this.overwriteGetter("hcl",function(s){const[u,f,m,b]=ze(s),w=Math.sqrt(f*f+m*m);return[Math.round(1e4*w)?De(Math.atan2(m,f)*Re):NaN,w,u,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ze(this.rgb))}overwriteGetter(s,u){return Object.defineProperty(this,s,{value:u}),u}toString(){const[s,u,f,m]=this.rgb;return`rgba(${[s,u,f].map(b=>Math.round(255*b)).join(",")},${m})`}}wt.black=new wt(0,0,0,1),wt.white=new wt(1,1,1,1),wt.transparent=new wt(0,0,0,0),wt.red=new wt(1,0,0,1);class jn{constructor(s,u,f){this.sensitivity=s?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,u){return this.collator.compare(s,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yi{constructor(s,u,f,m,b){this.text=s,this.image=u,this.scale=f,this.fontStack=m,this.textColor=b}}class xn{constructor(s){this.sections=s}static fromString(s){return new xn([new yi(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof xn?s:xn.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class bn{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof bn)return s;if(typeof s=="number")return new bn([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const u of s)if(typeof u!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new bn(s)}}toString(){return JSON.stringify(this.values)}}const Uo=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Cn{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Cn)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let u=0;u<s.length;u+=2){const f=s[u],m=s[u+1];if(typeof f!="string"||!Uo.has(f)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new Cn(s)}}toString(){return JSON.stringify(this.values)}}class Hn{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new Hn({name:s,available:!1}):null}}function Go(c,s,u,f){return typeof c=="number"&&c>=0&&c<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[c,s,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[c,s,u,f]:[c,s,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function nr(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof wt||c instanceof jn||c instanceof xn||c instanceof bn||c instanceof Cn||c instanceof Hn)return!0;if(Array.isArray(c)){for(const s of c)if(!nr(s))return!1;return!0}if(typeof c=="object"){for(const s in c)if(!nr(c[s]))return!1;return!0}return!1}function sn(c){if(c===null)return ds;if(typeof c=="string")return It;if(typeof c=="boolean")return Mt;if(typeof c=="number")return $e;if(c instanceof wt)return Ti;if(c instanceof jn)return Zr;if(c instanceof xn)return Jr;if(c instanceof bn)return Mr;if(c instanceof Cn)return Ns;if(c instanceof Hn)return hr;if(Array.isArray(c)){const s=c.length;let u;for(const f of c){const m=sn(f);if(u){if(u===m)continue;u=Et;break}u=m}return li(u||Et,s)}return fs}function ps(c){const s=typeof c;return c===null?"":s==="string"||s==="number"||s==="boolean"?String(c):c instanceof wt||c instanceof xn||c instanceof bn||c instanceof Cn||c instanceof Hn?c.toString():JSON.stringify(c)}class Us{constructor(s,u){this.type=s,this.value=u}static parse(s,u){if(s.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!nr(s[1]))return u.error("invalid value");const f=s[1];let m=sn(f);const b=u.expectedType;return m.kind!=="array"||m.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(m=b),new Us(m,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class wn{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const Vi={string:It,number:$e,boolean:Mt,object:fs};class Yn{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");let f,m=1;const b=s[0];if(b==="array"){let A,C;if(s.length>2){const M=s[1];if(typeof M!="string"||!(M in Vi)||M==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);A=Vi[M],m++}else A=Et;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return u.error('The length argument to "array" must be a positive integer literal',2);C=s[2],m++}f=li(A,C)}else{if(!Vi[b])throw new Error(`Types doesn't contain name = ${b}`);f=Vi[b]}const w=[];for(;m<s.length;m++){const A=u.parse(s[m],m,Et);if(!A)return null;w.push(A)}return new Yn(f,w)}evaluate(s){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(s);if(!Kr(this.type,sn(f)))return f;if(u===this.args.length-1)throw new wn(`Expected value to be of type ${un(this.type)}, but found ${un(sn(f))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Vo={"to-boolean":Mt,"to-color":Ti,"to-number":$e,"to-string":It};class dr{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const f=s[0];if(!Vo[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&s.length!==2)return u.error("Expected one argument.");const m=Vo[f],b=[];for(let w=1;w<s.length;w++){const A=u.parse(s[w],w,Et);if(!A)return null;b.push(A)}return new dr(m,b)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let u,f;for(const m of this.args){if(u=m.evaluate(s),f=null,u instanceof wt)return u;if(typeof u=="string"){const b=s.parseColor(u);if(b)return b}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Go(u[0],u[1],u[2],u[3]),!f))return new wt(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new wn(f||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const f of this.args){u=f.evaluate(s);const m=bn.parse(u);if(m)return m}throw new wn(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const f of this.args){u=f.evaluate(s);const m=Cn.parse(u);if(m)return m}throw new wn(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const f of this.args){if(u=f.evaluate(s),u===null)return 0;const m=Number(u);if(!isNaN(m))return m}throw new wn(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return xn.fromString(ps(this.args[0].evaluate(s)));case"resolvedImage":return Hn.fromString(ps(this.args[0].evaluate(s)));default:return ps(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const uo=["Unknown","Point","LineString","Polygon"];class Kt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?uo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let u=this._parseColorCache[s];return u||(u=this._parseColorCache[s]=wt.parse(s)),u}}class ho{constructor(s,u,f=[],m,b=new $r,w=[]){this.registry=s,this.path=f,this.key=f.map(A=>`[${A}]`).join(""),this.scope=b,this.errors=w,this.expectedType=m,this._isConstant=u}parse(s,u,f,m,b={}){return u?this.concat(u,f,m)._parse(s,b):this._parse(s,b)}_parse(s,u){function f(m,b,w){return w==="assert"?new Yn(b,[m]):w==="coerce"?new dr(b,[m]):m}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=s[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[m];if(b){let w=b.parse(s,this);if(!w)return null;if(this.expectedType){const A=this.expectedType,C=w.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||C.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(A.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array")if(A.kind!=="variableAnchorOffsetCollection"||C.kind!=="value"&&C.kind!=="array"){if(this.checkSubtype(A,C))return null}else w=f(w,A,u.typeAnnotation||"coerce");else w=f(w,A,u.typeAnnotation||"coerce");else w=f(w,A,u.typeAnnotation||"coerce");else w=f(w,A,u.typeAnnotation||"assert")}if(!(w instanceof Us)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const A=new Kt;try{w=new Us(w.type,w.evaluate(A))}catch(C){return this.error(C.message),null}}return w}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,u,f){const m=typeof s=="number"?this.path.concat(s):this.path,b=f?this.scope.concat(f):this.scope;return new ho(this.registry,this._isConstant,m,u||null,b,this.errors)}error(s,...u){const f=`${this.key}${u.map(m=>`[${m}]`).join("")}`;this.errors.push(new Di(f,s))}checkSubtype(s,u){const f=Kr(s,u);return f&&this.error(f),f}}class ji{constructor(s,u,f){this.type=Zr,this.locale=f,this.caseSensitive=s,this.diacriticSensitive=u}static parse(s,u){if(s.length!==2)return u.error("Expected one argument.");const f=s[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const m=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Mt);if(!m)return null;const b=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Mt);if(!b)return null;let w=null;return f.locale&&(w=u.parse(f.locale,1,It),!w)?null:new ji(m,b,w)}evaluate(s){return new jn(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const Gs=8192;function da(c,s){c[0]=Math.min(c[0],s[0]),c[1]=Math.min(c[1],s[1]),c[2]=Math.max(c[2],s[0]),c[3]=Math.max(c[3],s[1])}function fo(c,s){return!(c[0]<=s[0]||c[2]>=s[2]||c[1]<=s[1]||c[3]>=s[3])}function iu(c,s){const u=(180+c[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,m=Math.pow(2,s.z);return[Math.round(u*m*Gs),Math.round(f*m*Gs)]}function ru(c,s,u){const f=c[0]-s[0],m=c[1]-s[1],b=c[0]-u[0],w=c[1]-u[1];return f*w-b*m==0&&f*b<=0&&m*w<=0}function Ya(c,s){let u=!1;for(let w=0,A=s.length;w<A;w++){const C=s[w];for(let M=0,O=C.length;M<O-1;M++){if(ru(c,C[M],C[M+1]))return!1;(m=C[M])[1]>(f=c)[1]!=(b=C[M+1])[1]>f[1]&&f[0]<(b[0]-m[0])*(f[1]-m[1])/(b[1]-m[1])+m[0]&&(u=!u)}}var f,m,b;return u}function $(c,s){for(let u=0;u<s.length;u++)if(Ya(c,s[u]))return!0;return!1}function Y(c,s,u,f){const m=f[0]-u[0],b=f[1]-u[1],w=(c[0]-u[0])*b-m*(c[1]-u[1]),A=(s[0]-u[0])*b-m*(s[1]-u[1]);return w>0&&A<0||w<0&&A>0}function pe(c,s,u){for(const M of u)for(let O=0;O<M.length-1;++O)if((A=[(w=M[O+1])[0]-(b=M[O])[0],w[1]-b[1]])[0]*(C=[(m=s)[0]-(f=c)[0],m[1]-f[1]])[1]-A[1]*C[0]!=0&&Y(f,m,b,w)&&Y(b,w,f,m))return!0;var f,m,b,w,A,C;return!1}function Pe(c,s){for(let u=0;u<c.length;++u)if(!Ya(c[u],s))return!1;for(let u=0;u<c.length-1;++u)if(pe(c[u],c[u+1],s))return!1;return!0}function je(c,s){for(let u=0;u<s.length;u++)if(Pe(c,s[u]))return!0;return!1}function ot(c,s,u){const f=[];for(let m=0;m<c.length;m++){const b=[];for(let w=0;w<c[m].length;w++){const A=iu(c[m][w],u);da(s,A),b.push(A)}f.push(b)}return f}function Vt(c,s,u){const f=[];for(let m=0;m<c.length;m++){const b=ot(c[m],s,u);f.push(b)}return f}function Qn(c,s,u,f){if(c[0]<u[0]||c[0]>u[2]){const m=.5*f;let b=c[0]-u[0]>m?-f:u[0]-c[0]>m?f:0;b===0&&(b=c[0]-u[2]>m?-f:u[2]-c[0]>m?f:0),c[0]+=b}da(s,c)}function Wn(c,s,u,f){const m=Math.pow(2,f.z)*Gs,b=[f.x*Gs,f.y*Gs],w=[];for(const A of c)for(const C of A){const M=[C.x+b[0],C.y+b[1]];Qn(M,s,u,m),w.push(M)}return w}function Si(c,s,u,f){const m=Math.pow(2,f.z)*Gs,b=[f.x*Gs,f.y*Gs],w=[];for(const C of c){const M=[];for(const O of C){const k=[O.x+b[0],O.y+b[1]];da(s,k),M.push(k)}w.push(M)}if(s[2]-s[0]<=m/2){(A=s)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const C of w)for(const M of C)Qn(M,s,u,m)}var A;return w}class Ci{constructor(s,u){this.type=Mt,this.geojson=s,this.geometries=u}static parse(s,u){if(s.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(nr(s[1])){const f=s[1];if(f.type==="FeatureCollection")for(let m=0;m<f.features.length;++m){const b=f.features[m].geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Ci(f,f.features[m].geometry)}else if(f.type==="Feature"){const m=f.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Ci(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Ci(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(u,f){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=u.canonicalID();if(f.type==="Polygon"){const A=ot(f.coordinates,b,w),C=Wn(u.geometry(),m,b,w);if(!fo(m,b))return!1;for(const M of C)if(!Ya(M,A))return!1}if(f.type==="MultiPolygon"){const A=Vt(f.coordinates,b,w),C=Wn(u.geometry(),m,b,w);if(!fo(m,b))return!1;for(const M of C)if(!$(M,A))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(u,f){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=u.canonicalID();if(f.type==="Polygon"){const A=ot(f.coordinates,b,w),C=Si(u.geometry(),m,b,w);if(!fo(m,b))return!1;for(const M of C)if(!Pe(M,A))return!1}if(f.type==="MultiPolygon"){const A=Vt(f.coordinates,b,w),C=Si(u.geometry(),m,b,w);if(!fo(m,b))return!1;for(const M of C)if(!je(M,A))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class su{constructor(s,u){this.type=u.type,this.name=s,this.boundExpression=u}static parse(s,u){if(s.length!==2||typeof s[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=s[1];return u.scope.has(f)?new su(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Br{constructor(s,u,f,m){this.name=s,this.type=u,this._evaluate=f,this.args=m}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,u){const f=s[0],m=Br.definitions[f];if(!m)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(m)?m[0]:m.type,w=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,A=w.filter(([M])=>!Array.isArray(M)||M.length===s.length-1);let C=null;for(const[M,O]of A){C=new ho(u.registry,Jl,u.path,null,u.scope);const k=[];let U=!1;for(let q=1;q<s.length;q++){const X=s[q],te=Array.isArray(M)?M[q-1]:M.type,se=C.parse(X,1+k.length,te);if(!se){U=!0;break}k.push(se)}if(!U)if(Array.isArray(M)&&M.length!==k.length)C.error(`Expected ${M.length} arguments, but found ${k.length} instead.`);else{for(let q=0;q<k.length;q++){const X=Array.isArray(M)?M[q]:M.type,te=k[q];C.concat(q+1).checkSubtype(X,te.type)}if(C.errors.length===0)return new Br(f,b,O,k)}}if(A.length===1)u.errors.push(...C.errors);else{const M=(A.length?A:w).map(([k])=>{return U=k,Array.isArray(U)?`(${U.map(un).join(", ")})`:`(${un(U.type)}...)`;var U}).join(" | "),O=[];for(let k=1;k<s.length;k++){const U=u.parse(s[k],1+O.length);if(!U)return null;O.push(un(U.type))}u.error(`Expected arguments of type ${M}, but found (${O.join(", ")}) instead.`)}return null}static register(s,u){Br.definitions=u;for(const f in u)s[f]=Br}}function Jl(c){if(c instanceof su)return Jl(c.boundExpression);if(c instanceof Br&&c.name==="error"||c instanceof ji||c instanceof Ci)return!1;const s=c instanceof dr||c instanceof Yn;let u=!0;return c.eachChild(f=>{u=s?u&&Jl(f):u&&f instanceof Us}),!!u&&ou(c)&&Yl(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ou(c){if(c instanceof Br&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Ci)return!1;let s=!0;return c.eachChild(u=>{s&&!ou(u)&&(s=!1)}),s}function Kl(c){if(c instanceof Br&&c.name==="feature-state")return!1;let s=!0;return c.eachChild(u=>{s&&!Kl(u)&&(s=!1)}),s}function Yl(c,s){if(c instanceof Br&&s.indexOf(c.name)>=0)return!1;let u=!0;return c.eachChild(f=>{u&&!Yl(f,s)&&(u=!1)}),u}function Ql(c,s){const u=c.length-1;let f,m,b=0,w=u,A=0;for(;b<=w;)if(A=Math.floor((b+w)/2),f=c[A],m=c[A+1],f<=s){if(A===u||s<m)return A;b=A+1}else{if(!(f>s))throw new wn("Input is not a number.");w=A-1}return 0}class ec{constructor(s,u,f){this.type=s,this.input=u,this.labels=[],this.outputs=[];for(const[m,b]of f)this.labels.push(m),this.outputs.push(b)}static parse(s,u){if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(s[1],1,$e);if(!f)return null;const m=[];let b=null;u.expectedType&&u.expectedType.kind!=="value"&&(b=u.expectedType);for(let w=1;w<s.length;w+=2){const A=w===1?-1/0:s[w],C=s[w+1],M=w,O=w+1;if(typeof A!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(m.length&&m[m.length-1][0]>=A)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const k=u.parse(C,O,b);if(!k)return null;b=b||k.type,m.push([A,k])}return new ec(b,f,m)}evaluate(s){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(s);const m=this.input.evaluate(s);if(m<=u[0])return f[0].evaluate(s);const b=u.length;return m>=u[b-1]?f[b-1].evaluate(s):f[Ql(u,m)].evaluate(s)}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function fa(c,s,u){return c+u*(s-c)}function au(c,s,u){return c.map((f,m)=>fa(f,s[m],u))}const Lr={number:fa,color:function(c,s,u,f="rgb"){switch(f){case"rgb":{const[m,b,w,A]=au(c.rgb,s.rgb,u);return new wt(m,b,w,A,!1)}case"hcl":{const[m,b,w,A]=c.hcl,[C,M,O,k]=s.hcl;let U,q;if(isNaN(m)||isNaN(C))isNaN(m)?isNaN(C)?U=NaN:(U=C,w!==1&&w!==0||(q=M)):(U=m,O!==1&&O!==0||(q=b));else{let xe=C-m;C>m&&xe>180?xe-=360:C<m&&m-C>180&&(xe+=360),U=m+u*xe}const[X,te,se,ce]=function([xe,me,we,Se]){return xe=isNaN(xe)?0:xe*ve,lt([we,Math.cos(xe)*me,Math.sin(xe)*me,Se])}([U,q??fa(b,M,u),fa(w,O,u),fa(A,k,u)]);return new wt(X,te,se,ce,!1)}case"lab":{const[m,b,w,A]=lt(au(c.lab,s.lab,u));return new wt(m,b,w,A,!1)}}},array:au,padding:function(c,s,u){return new bn(au(c.values,s.values,u))},variableAnchorOffsetCollection:function(c,s,u){const f=c.values,m=s.values;if(f.length!==m.length)throw new wn(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${s.toString()}`);const b=[];for(let w=0;w<f.length;w+=2){if(f[w]!==m[w])throw new wn(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${f[w]}, to[${w}]: ${m[w]}`);b.push(f[w]);const[A,C]=f[w+1],[M,O]=m[w+1];b.push([fa(A,M,u),fa(C,O,u)])}return new Cn(b)}};class Rr{constructor(s,u,f,m,b){this.type=s,this.operator=u,this.interpolation=f,this.input=m,this.labels=[],this.outputs=[];for(const[w,A]of b)this.labels.push(w),this.outputs.push(A)}static interpolationFactor(s,u,f,m){let b=0;if(s.name==="exponential")b=Qh(u,s.base,f,m);else if(s.name==="linear")b=Qh(u,1,f,m);else if(s.name==="cubic-bezier"){const w=s.controlPoints;b=new V(w[0],w[1],w[2],w[3]).solve(Qh(u,1,f,m))}return b}static parse(s,u){let[f,m,b,...w]=s;if(!Array.isArray(m)||m.length===0)return u.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const M=m[1];if(typeof M!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:M}}else{if(m[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const M=m.slice(1);if(M.length!==4||M.some(O=>typeof O!="number"||O<0||O>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}}if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(b=u.parse(b,2,$e),!b)return null;const A=[];let C=null;f==="interpolate-hcl"||f==="interpolate-lab"?C=Ti:u.expectedType&&u.expectedType.kind!=="value"&&(C=u.expectedType);for(let M=0;M<w.length;M+=2){const O=w[M],k=w[M+1],U=M+3,q=M+4;if(typeof O!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(A.length&&A[A.length-1][0]>=O)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const X=u.parse(k,q,C);if(!X)return null;C=C||X.type,A.push([O,X])}return G(C,$e)||G(C,Ti)||G(C,Mr)||G(C,Ns)||G(C,li($e))?new Rr(C,f,m,b,A):u.error(`Type ${un(C)} is not interpolatable.`)}evaluate(s){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(s);const m=this.input.evaluate(s);if(m<=u[0])return f[0].evaluate(s);const b=u.length;if(m>=u[b-1])return f[b-1].evaluate(s);const w=Ql(u,m),A=Rr.interpolationFactor(this.interpolation,m,u[w],u[w+1]),C=f[w].evaluate(s),M=f[w+1].evaluate(s);switch(this.operator){case"interpolate":return Lr[this.type.kind](C,M,A);case"interpolate-hcl":return Lr.color(C,M,A,"hcl");case"interpolate-lab":return Lr.color(C,M,A,"lab")}}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Qh(c,s,u,f){const m=f-u,b=c-u;return m===0?0:s===1?b/m:(Math.pow(s,b)-1)/(Math.pow(s,m)-1)}class lu{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expectected at least one argument.");let f=null;const m=u.expectedType;m&&m.kind!=="value"&&(f=m);const b=[];for(const A of s.slice(1)){const C=u.parse(A,1+b.length,f,void 0,{typeAnnotation:"omit"});if(!C)return null;f=f||C.type,b.push(C)}if(!f)throw new Error("No output type");const w=m&&b.some(A=>Kr(m,A.type));return new lu(w?Et:f,b)}evaluate(s){let u,f=null,m=0;for(const b of this.args)if(m++,f=b.evaluate(s),f&&f instanceof Hn&&!f.available&&(u||(u=f.name),f=null,m===this.args.length&&(f=u)),f!==null)break;return f}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class Qa{constructor(s,u){this.type=u.type,this.bindings=[].concat(s),this.result=u}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const u of this.bindings)s(u[1]);s(this.result)}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const f=[];for(let b=1;b<s.length-1;b+=2){const w=s[b];if(typeof w!="string")return u.error(`Expected string, but found ${typeof w} instead.`,b);if(/[^a-zA-Z0-9_]/.test(w))return u.error("Variable names must contain only alphanumeric characters or '_'.",b);const A=u.parse(s[b+1],b+1);if(!A)return null;f.push([w,A])}const m=u.parse(s[s.length-1],s.length-1,u.expectedType,f);return m?new Qa(f,m):null}outputDefined(){return this.result.outputDefined()}}class el{constructor(s,u,f){this.type=s,this.index=u,this.input=f}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,$e),m=u.parse(s[2],2,li(u.expectedType||Et));return f&&m?new el(m.type.itemType,f,m):null}evaluate(s){const u=this.index.evaluate(s),f=this.input.evaluate(s);if(u<0)throw new wn(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new wn(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new wn(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class Yt{constructor(s,u){this.type=Mt,this.needle=s,this.haystack=u}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,Et),m=u.parse(s[2],2,Et);return f&&m?ie(f.type,[Mt,It,$e,ds,Et])?new Yt(f,m):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${un(f.type)} instead`):null}evaluate(s){const u=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!f)return!1;if(!N(u,["boolean","string","number","null"]))throw new wn(`Expected first argument to be of type boolean, string, number or null, but found ${un(sn(u))} instead.`);if(!N(f,["string","array"]))throw new wn(`Expected second argument to be of type array or string, but found ${un(sn(f))} instead.`);return f.indexOf(u)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class cu{constructor(s,u,f){this.type=$e,this.needle=s,this.haystack=u,this.fromIndex=f}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,Et),m=u.parse(s[2],2,Et);if(!f||!m)return null;if(!ie(f.type,[Mt,It,$e,ds,Et]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${un(f.type)} instead`);if(s.length===4){const b=u.parse(s[3],3,$e);return b?new cu(f,m,b):null}return new cu(f,m)}evaluate(s){const u=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!N(u,["boolean","string","number","null"]))throw new wn(`Expected first argument to be of type boolean, string, number or null, but found ${un(sn(u))} instead.`);if(!N(f,["string","array"]))throw new wn(`Expected second argument to be of type array or string, but found ${un(sn(f))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(s);return f.indexOf(u,m)}return f.indexOf(u)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class ed{constructor(s,u,f,m,b,w){this.inputType=s,this.type=u,this.input=f,this.cases=m,this.outputs=b,this.otherwise=w}static parse(s,u){if(s.length<5)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return u.error("Expected an even number of arguments.");let f,m;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);const b={},w=[];for(let M=2;M<s.length-1;M+=2){let O=s[M];const k=s[M+1];Array.isArray(O)||(O=[O]);const U=u.concat(M);if(O.length===0)return U.error("Expected at least one branch label.");for(const X of O){if(typeof X!="number"&&typeof X!="string")return U.error("Branch labels must be numbers or strings.");if(typeof X=="number"&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof X=="number"&&Math.floor(X)!==X)return U.error("Numeric branch labels must be integer values.");if(f){if(U.checkSubtype(f,sn(X)))return null}else f=sn(X);if(b[String(X)]!==void 0)return U.error("Branch labels must be unique.");b[String(X)]=w.length}const q=u.parse(k,M,m);if(!q)return null;m=m||q.type,w.push(q)}const A=u.parse(s[1],1,Et);if(!A)return null;const C=u.parse(s[s.length-1],s.length-1,m);return C?A.type.kind!=="value"&&u.concat(1).checkSubtype(f,A.type)?null:new ed(f,m,A,b,w,C):null}evaluate(s){const u=this.input.evaluate(s);return(sn(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class td{constructor(s,u,f){this.type=s,this.branches=u,this.otherwise=f}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const m=[];for(let w=1;w<s.length-1;w+=2){const A=u.parse(s[w],w,Mt);if(!A)return null;const C=u.parse(s[w+1],w+1,f);if(!C)return null;m.push([A,C]),f=f||C.type}const b=u.parse(s[s.length-1],s.length-1,f);if(!b)return null;if(!f)throw new Error("Can't infer output type");return new td(f,m,b)}evaluate(s){for(const[u,f]of this.branches)if(u.evaluate(s))return f.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[u,f]of this.branches)s(u),s(f);s(this.otherwise)}outputDefined(){return this.branches.every(([s,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class uu{constructor(s,u,f,m){this.type=s,this.input=u,this.beginIndex=f,this.endIndex=m}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,Et),m=u.parse(s[2],2,$e);if(!f||!m)return null;if(!ie(f.type,[li(Et),It,Et]))return u.error(`Expected first argument to be of type array or string, but found ${un(f.type)} instead`);if(s.length===4){const b=u.parse(s[3],3,$e);return b?new uu(f.type,f,m,b):null}return new uu(f.type,f,m)}evaluate(s){const u=this.input.evaluate(s),f=this.beginIndex.evaluate(s);if(!N(u,["string","array"]))throw new wn(`Expected first argument to be of type array or string, but found ${un(sn(u))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(s);return u.slice(f,m)}return u.slice(f)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function Cp(c,s){return c==="=="||c==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Ip(c,s,u,f){return f.compare(s,u)===0}function tl(c,s,u){const f=c!=="=="&&c!=="!=";return class KP{constructor(b,w,A){this.type=Mt,this.lhs=b,this.rhs=w,this.collator=A,this.hasUntypedArgument=b.type.kind==="value"||w.type.kind==="value"}static parse(b,w){if(b.length!==3&&b.length!==4)return w.error("Expected two or three arguments.");const A=b[0];let C=w.parse(b[1],1,Et);if(!C)return null;if(!Cp(A,C.type))return w.concat(1).error(`"${A}" comparisons are not supported for type '${un(C.type)}'.`);let M=w.parse(b[2],2,Et);if(!M)return null;if(!Cp(A,M.type))return w.concat(2).error(`"${A}" comparisons are not supported for type '${un(M.type)}'.`);if(C.type.kind!==M.type.kind&&C.type.kind!=="value"&&M.type.kind!=="value")return w.error(`Cannot compare types '${un(C.type)}' and '${un(M.type)}'.`);f&&(C.type.kind==="value"&&M.type.kind!=="value"?C=new Yn(M.type,[C]):C.type.kind!=="value"&&M.type.kind==="value"&&(M=new Yn(C.type,[M])));let O=null;if(b.length===4){if(C.type.kind!=="string"&&M.type.kind!=="string"&&C.type.kind!=="value"&&M.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(O=w.parse(b[3],3,Zr),!O)return null}return new KP(C,M,O)}evaluate(b){const w=this.lhs.evaluate(b),A=this.rhs.evaluate(b);if(f&&this.hasUntypedArgument){const C=sn(w),M=sn(A);if(C.kind!==M.kind||C.kind!=="string"&&C.kind!=="number")throw new wn(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${C.kind}, ${M.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const C=sn(w),M=sn(A);if(C.kind!=="string"||M.kind!=="string")return s(b,w,A)}return this.collator?u(b,w,A,this.collator.evaluate(b)):s(b,w,A)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const $_=tl("==",function(c,s,u){return s===u},Ip),Z_=tl("!=",function(c,s,u){return s!==u},function(c,s,u,f){return!Ip(0,s,u,f)}),J_=tl("<",function(c,s,u){return s<u},function(c,s,u,f){return f.compare(s,u)<0}),K_=tl(">",function(c,s,u){return s>u},function(c,s,u,f){return f.compare(s,u)>0}),Y_=tl("<=",function(c,s,u){return s<=u},function(c,s,u,f){return f.compare(s,u)<=0}),Q_=tl(">=",function(c,s,u){return s>=u},function(c,s,u,f){return f.compare(s,u)>=0});class nd{constructor(s,u,f,m,b){this.type=It,this.number=s,this.locale=u,this.currency=f,this.minFractionDigits=m,this.maxFractionDigits=b}static parse(s,u){if(s.length!==3)return u.error("Expected two arguments.");const f=u.parse(s[1],1,$e);if(!f)return null;const m=s[2];if(typeof m!="object"||Array.isArray(m))return u.error("NumberFormat options argument must be an object.");let b=null;if(m.locale&&(b=u.parse(m.locale,1,It),!b))return null;let w=null;if(m.currency&&(w=u.parse(m.currency,1,It),!w))return null;let A=null;if(m["min-fraction-digits"]&&(A=u.parse(m["min-fraction-digits"],1,$e),!A))return null;let C=null;return m["max-fraction-digits"]&&(C=u.parse(m["max-fraction-digits"],1,$e),!C)?null:new nd(f,b,w,A,C)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class hu{constructor(s){this.type=Jr,this.sections=s}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const f=s[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const m=[];let b=!1;for(let w=1;w<=s.length-1;++w){const A=s[w];if(b&&typeof A=="object"&&!Array.isArray(A)){b=!1;let C=null;if(A["font-scale"]&&(C=u.parse(A["font-scale"],1,$e),!C))return null;let M=null;if(A["text-font"]&&(M=u.parse(A["text-font"],1,li(It)),!M))return null;let O=null;if(A["text-color"]&&(O=u.parse(A["text-color"],1,Ti),!O))return null;const k=m[m.length-1];k.scale=C,k.font=M,k.textColor=O}else{const C=u.parse(s[w],1,Et);if(!C)return null;const M=C.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,m.push({content:C,scale:null,font:null,textColor:null})}}return new hu(m)}evaluate(s){return new xn(this.sections.map(u=>{const f=u.content.evaluate(s);return sn(f)===hr?new yi("",f,null,null,null):new yi(ps(f),null,u.scale?u.scale.evaluate(s):null,u.font?u.font.evaluate(s).join(","):null,u.textColor?u.textColor.evaluate(s):null)}))}eachChild(s){for(const u of this.sections)s(u.content),u.scale&&s(u.scale),u.font&&s(u.font),u.textColor&&s(u.textColor)}outputDefined(){return!1}}class id{constructor(s){this.type=hr,this.input=s}static parse(s,u){if(s.length!==2)return u.error("Expected two arguments.");const f=u.parse(s[1],1,It);return f?new id(f):u.error("No image name provided.")}evaluate(s){const u=this.input.evaluate(s),f=Hn.fromString(u);return f&&s.availableImages&&(f.available=s.availableImages.indexOf(u)>-1),f}eachChild(s){s(this.input)}outputDefined(){return!1}}class rd{constructor(s){this.type=$e,this.input=s}static parse(s,u){if(s.length!==2)return u.error(`Expected 1 argument, but found ${s.length-1} instead.`);const f=u.parse(s[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${un(f.type)} instead.`):new rd(f):null}evaluate(s){const u=this.input.evaluate(s);if(typeof u=="string"||Array.isArray(u))return u.length;throw new wn(`Expected value to be of type string or array, but found ${un(sn(u))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const nl={"==":$_,"!=":Z_,">":K_,"<":J_,">=":Q_,"<=":Y_,array:Yn,at:el,boolean:Yn,case:td,coalesce:lu,collator:ji,format:hu,image:id,in:Yt,"index-of":cu,interpolate:Rr,"interpolate-hcl":Rr,"interpolate-lab":Rr,length:rd,let:Qa,literal:Us,match:ed,number:Yn,"number-format":nd,object:Yn,slice:uu,step:ec,string:Yn,"to-boolean":dr,"to-color":dr,"to-number":dr,"to-string":dr,var:su,within:Ci};function Pp(c,[s,u,f,m]){s=s.evaluate(c),u=u.evaluate(c),f=f.evaluate(c);const b=m?m.evaluate(c):1,w=Go(s,u,f,b);if(w)throw new wn(w);return new wt(s/255,u/255,f/255,b,!1)}function Mp(c,s){return c in s}function sd(c,s){const u=s[c];return u===void 0?null:u}function pa(c){return{type:c}}function Bp(c){return{result:"success",value:c}}function il(c){return{result:"error",value:c}}function rl(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Lp(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function od(c){return!!c.expression&&c.expression.interpolated}function nn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function du(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function ey(c){return c}function Rp(c,s){const u=s.type==="color",f=c.stops&&typeof c.stops[0][0]=="object",m=f||!(f||c.property!==void 0),b=c.type||(od(s)?"exponential":"interval");if(u||s.type==="padding"){const O=u?wt.parse:bn.parse;(c=Ri({},c)).stops&&(c.stops=c.stops.map(k=>[k[0],O(k[1])])),c.default=O(c.default?c.default:s.default)}if(c.colorSpace&&(w=c.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var w;let A,C,M;if(b==="exponential")A=Dp;else if(b==="interval")A=ny;else if(b==="categorical"){A=ty,C=Object.create(null);for(const O of c.stops)C[O[0]]=O[1];M=typeof c.stops[0][0]}else{if(b!=="identity")throw new Error(`Unknown function type "${b}"`);A=iy}if(f){const O={},k=[];for(let X=0;X<c.stops.length;X++){const te=c.stops[X],se=te[0].zoom;O[se]===void 0&&(O[se]={zoom:se,type:c.type,property:c.property,default:c.default,stops:[]},k.push(se)),O[se].stops.push([te[0].value,te[1]])}const U=[];for(const X of k)U.push([O[X].zoom,Rp(O[X],s)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:Rr.interpolationFactor.bind(void 0,q),zoomStops:U.map(X=>X[0]),evaluate:({zoom:X},te)=>Dp({stops:U,base:c.base},s,X).evaluate(X,te)}}if(m){const O=b==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:Rr.interpolationFactor.bind(void 0,O),zoomStops:c.stops.map(k=>k[0]),evaluate:({zoom:k})=>A(c,s,k,C,M)}}return{kind:"source",evaluate(O,k){const U=k&&k.properties?k.properties[c.property]:void 0;return U===void 0?ma(c.default,s.default):A(c,s,U,C,M)}}}function ma(c,s,u){return c!==void 0?c:s!==void 0?s:u!==void 0?u:void 0}function ty(c,s,u,f,m){return ma(typeof u===m?f[u]:void 0,c.default,s.default)}function ny(c,s,u){if(nn(u)!=="number")return ma(c.default,s.default);const f=c.stops.length;if(f===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[f-1][0])return c.stops[f-1][1];const m=Ql(c.stops.map(b=>b[0]),u);return c.stops[m][1]}function Dp(c,s,u){const f=c.base!==void 0?c.base:1;if(nn(u)!=="number")return ma(c.default,s.default);const m=c.stops.length;if(m===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[m-1][0])return c.stops[m-1][1];const b=Ql(c.stops.map(O=>O[0]),u),w=function(O,k,U,q){const X=q-U,te=O-U;return X===0?0:k===1?te/X:(Math.pow(k,te)-1)/(Math.pow(k,X)-1)}(u,f,c.stops[b][0],c.stops[b+1][0]),A=c.stops[b][1],C=c.stops[b+1][1],M=Lr[s.type]||ey;return typeof A.evaluate=="function"?{evaluate(...O){const k=A.evaluate.apply(void 0,O),U=C.evaluate.apply(void 0,O);if(k!==void 0&&U!==void 0)return M(k,U,w,c.colorSpace)}}:M(A,C,w,c.colorSpace)}function iy(c,s,u){switch(s.type){case"color":u=wt.parse(u);break;case"formatted":u=xn.fromString(u.toString());break;case"resolvedImage":u=Hn.fromString(u.toString());break;case"padding":u=bn.parse(u);break;default:nn(u)===s.type||s.type==="enum"&&s.values[u]||(u=void 0)}return ma(u,c.default,s.default)}Br.register(nl,{error:[{kind:"error"},[It],(c,[s])=>{throw new wn(s.evaluate(c))}],typeof:[It,[Et],(c,[s])=>un(sn(s.evaluate(c)))],"to-rgba":[li($e,4),[Ti],(c,[s])=>{const[u,f,m,b]=s.evaluate(c).rgb;return[255*u,255*f,255*m,b]}],rgb:[Ti,[$e,$e,$e],Pp],rgba:[Ti,[$e,$e,$e,$e],Pp],has:{type:Mt,overloads:[[[It],(c,[s])=>Mp(s.evaluate(c),c.properties())],[[It,fs],(c,[s,u])=>Mp(s.evaluate(c),u.evaluate(c))]]},get:{type:Et,overloads:[[[It],(c,[s])=>sd(s.evaluate(c),c.properties())],[[It,fs],(c,[s,u])=>sd(s.evaluate(c),u.evaluate(c))]]},"feature-state":[Et,[It],(c,[s])=>sd(s.evaluate(c),c.featureState||{})],properties:[fs,[],c=>c.properties()],"geometry-type":[It,[],c=>c.geometryType()],id:[Et,[],c=>c.id()],zoom:[$e,[],c=>c.globals.zoom],"heatmap-density":[$e,[],c=>c.globals.heatmapDensity||0],"line-progress":[$e,[],c=>c.globals.lineProgress||0],accumulated:[Et,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[$e,pa($e),(c,s)=>{let u=0;for(const f of s)u+=f.evaluate(c);return u}],"*":[$e,pa($e),(c,s)=>{let u=1;for(const f of s)u*=f.evaluate(c);return u}],"-":{type:$e,overloads:[[[$e,$e],(c,[s,u])=>s.evaluate(c)-u.evaluate(c)],[[$e],(c,[s])=>-s.evaluate(c)]]},"/":[$e,[$e,$e],(c,[s,u])=>s.evaluate(c)/u.evaluate(c)],"%":[$e,[$e,$e],(c,[s,u])=>s.evaluate(c)%u.evaluate(c)],ln2:[$e,[],()=>Math.LN2],pi:[$e,[],()=>Math.PI],e:[$e,[],()=>Math.E],"^":[$e,[$e,$e],(c,[s,u])=>Math.pow(s.evaluate(c),u.evaluate(c))],sqrt:[$e,[$e],(c,[s])=>Math.sqrt(s.evaluate(c))],log10:[$e,[$e],(c,[s])=>Math.log(s.evaluate(c))/Math.LN10],ln:[$e,[$e],(c,[s])=>Math.log(s.evaluate(c))],log2:[$e,[$e],(c,[s])=>Math.log(s.evaluate(c))/Math.LN2],sin:[$e,[$e],(c,[s])=>Math.sin(s.evaluate(c))],cos:[$e,[$e],(c,[s])=>Math.cos(s.evaluate(c))],tan:[$e,[$e],(c,[s])=>Math.tan(s.evaluate(c))],asin:[$e,[$e],(c,[s])=>Math.asin(s.evaluate(c))],acos:[$e,[$e],(c,[s])=>Math.acos(s.evaluate(c))],atan:[$e,[$e],(c,[s])=>Math.atan(s.evaluate(c))],min:[$e,pa($e),(c,s)=>Math.min(...s.map(u=>u.evaluate(c)))],max:[$e,pa($e),(c,s)=>Math.max(...s.map(u=>u.evaluate(c)))],abs:[$e,[$e],(c,[s])=>Math.abs(s.evaluate(c))],round:[$e,[$e],(c,[s])=>{const u=s.evaluate(c);return u<0?-Math.round(-u):Math.round(u)}],floor:[$e,[$e],(c,[s])=>Math.floor(s.evaluate(c))],ceil:[$e,[$e],(c,[s])=>Math.ceil(s.evaluate(c))],"filter-==":[Mt,[It,Et],(c,[s,u])=>c.properties()[s.value]===u.value],"filter-id-==":[Mt,[Et],(c,[s])=>c.id()===s.value],"filter-type-==":[Mt,[It],(c,[s])=>c.geometryType()===s.value],"filter-<":[Mt,[It,Et],(c,[s,u])=>{const f=c.properties()[s.value],m=u.value;return typeof f==typeof m&&f<m}],"filter-id-<":[Mt,[Et],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u<f}],"filter->":[Mt,[It,Et],(c,[s,u])=>{const f=c.properties()[s.value],m=u.value;return typeof f==typeof m&&f>m}],"filter-id->":[Mt,[Et],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u>f}],"filter-<=":[Mt,[It,Et],(c,[s,u])=>{const f=c.properties()[s.value],m=u.value;return typeof f==typeof m&&f<=m}],"filter-id-<=":[Mt,[Et],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u<=f}],"filter->=":[Mt,[It,Et],(c,[s,u])=>{const f=c.properties()[s.value],m=u.value;return typeof f==typeof m&&f>=m}],"filter-id->=":[Mt,[Et],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u>=f}],"filter-has":[Mt,[Et],(c,[s])=>s.value in c.properties()],"filter-has-id":[Mt,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Mt,[li(It)],(c,[s])=>s.value.indexOf(c.geometryType())>=0],"filter-id-in":[Mt,[li(Et)],(c,[s])=>s.value.indexOf(c.id())>=0],"filter-in-small":[Mt,[It,li(Et)],(c,[s,u])=>u.value.indexOf(c.properties()[s.value])>=0],"filter-in-large":[Mt,[It,li(Et)],(c,[s,u])=>function(f,m,b,w){for(;b<=w;){const A=b+w>>1;if(m[A]===f)return!0;m[A]>f?w=A-1:b=A+1}return!1}(c.properties()[s.value],u.value,0,u.value.length-1)],all:{type:Mt,overloads:[[[Mt,Mt],(c,[s,u])=>s.evaluate(c)&&u.evaluate(c)],[pa(Mt),(c,s)=>{for(const u of s)if(!u.evaluate(c))return!1;return!0}]]},any:{type:Mt,overloads:[[[Mt,Mt],(c,[s,u])=>s.evaluate(c)||u.evaluate(c)],[pa(Mt),(c,s)=>{for(const u of s)if(u.evaluate(c))return!0;return!1}]]},"!":[Mt,[Mt],(c,[s])=>!s.evaluate(c)],"is-supported-script":[Mt,[It],(c,[s])=>{const u=c.globals&&c.globals.isSupportedScript;return!u||u(s.evaluate(c))}],upcase:[It,[It],(c,[s])=>s.evaluate(c).toUpperCase()],downcase:[It,[It],(c,[s])=>s.evaluate(c).toLowerCase()],concat:[It,pa(Et),(c,s)=>s.map(u=>ps(u.evaluate(c))).join("")],"resolved-locale":[It,[Zr],(c,[s])=>s.evaluate(c).resolvedLocale()]});class zn{constructor(s,u){var f;this.expression=s,this._warningHistory={},this._evaluator=new Kt,this._defaultValue=u?(f=u).type==="color"&&du(f.default)?new wt(0,0,0,0):f.type==="color"?wt.parse(f.default)||null:f.type==="padding"?bn.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?Cn.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(s,u,f,m,b,w){return this._evaluator.globals=s,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(s,u,f,m,b,w){this._evaluator.globals=s,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new wn(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function fu(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in nl}function jt(c,s){const u=new ho(nl,Jl,[],s?function(m){const b={color:Ti,string:It,number:$e,enum:It,boolean:Mt,formatted:Jr,padding:Mr,resolvedImage:hr,variableAnchorOffsetCollection:Ns};return m.type==="array"?li(b[m.value]||Et,m.length):b[m.type]}(s):void 0),f=u.parse(c,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Bp(new zn(f,s)):il(u.errors)}class tc{constructor(s,u){this.kind=s,this._styleExpression=u,this.isStateDependent=s!=="constant"&&!Kl(u.expression)}evaluateWithoutErrorHandling(s,u,f,m,b,w){return this._styleExpression.evaluateWithoutErrorHandling(s,u,f,m,b,w)}evaluate(s,u,f,m,b,w){return this._styleExpression.evaluate(s,u,f,m,b,w)}}class An{constructor(s,u,f,m){this.kind=s,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=s!=="camera"&&!Kl(u.expression),this.interpolationType=m}evaluateWithoutErrorHandling(s,u,f,m,b,w){return this._styleExpression.evaluateWithoutErrorHandling(s,u,f,m,b,w)}evaluate(s,u,f,m,b,w){return this._styleExpression.evaluate(s,u,f,m,b,w)}interpolationFactor(s,u,f){return this.interpolationType?Rr.interpolationFactor(this.interpolationType,s,u,f):0}}function En(c,s){const u=jt(c,s);if(u.result==="error")return u;const f=u.value.expression,m=ou(f);if(!m&&!rl(s))return il([new Di("","data expressions not supported")]);const b=Yl(f,["zoom"]);if(!b&&!Lp(s))return il([new Di("","zoom expressions not supported")]);const w=nc(f);return w||b?w instanceof Di?il([w]):w instanceof Rr&&!od(s)?il([new Di("",'"interpolate" expressions cannot be used with this property')]):Bp(w?new An(m?"camera":"composite",u.value,w.labels,w instanceof Rr?w.interpolation:void 0):new tc(m?"constant":"source",u.value)):il([new Di("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ga{constructor(s,u){this._parameters=s,this._specification=u,Ri(this,Rp(this._parameters,this._specification))}static deserialize(s){return new ga(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function nc(c){let s=null;if(c instanceof Qa)s=nc(c.result);else if(c instanceof lu){for(const u of c.args)if(s=nc(u),s)break}else(c instanceof ec||c instanceof Rr)&&c.input instanceof Br&&c.input.name==="zoom"&&(s=c);return s instanceof Di||c.eachChild(u=>{const f=nc(u);f instanceof Di?s=f:!s&&f?s=new Di("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&f&&s!==f&&(s=new Di("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function ad(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const s of c.slice(1))if(!ad(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const ry={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ld(c){if(c==null)return{filter:()=>!0,needGeometry:!1};ad(c)||(c=ic(c));const s=jt(c,ry);if(s.result==="error")throw new Error(s.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,f,m)=>s.value.evaluate(u,f,{},m),needGeometry:cd(c)}}function sy(c,s){return c<s?-1:c>s?1:0}function cd(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let s=1;s<c.length;s++)if(cd(c[s]))return!0;return!1}function ic(c){if(!c)return!0;const s=c[0];return c.length<=1?s!=="any":s==="=="?pu(c[1],c[2],"=="):s==="!="?gu(pu(c[1],c[2],"==")):s==="<"||s===">"||s==="<="||s===">="?pu(c[1],c[2],s):s==="any"?(u=c.slice(1),["any"].concat(u.map(ic))):s==="all"?["all"].concat(c.slice(1).map(ic)):s==="none"?["all"].concat(c.slice(1).map(ic).map(gu)):s==="in"?ud(c[1],c.slice(2)):s==="!in"?gu(ud(c[1],c.slice(2))):s==="has"?mu(c[1]):s==="!has"?gu(mu(c[1])):s!=="within"||c;var u}function pu(c,s,u){switch(c){case"$type":return[`filter-type-${u}`,s];case"$id":return[`filter-id-${u}`,s];default:return[`filter-${u}`,c,s]}}function ud(c,s){if(s.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(u=>typeof u!=typeof s[0])?["filter-in-large",c,["literal",s.sort(sy)]]:["filter-in-small",c,["literal",s]]}}function mu(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function gu(c){return["!",c]}function hd(c){const s=typeof c;if(s==="number"||s==="boolean"||s==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let m="[";for(const b of c)m+=`${hd(b)},`;return`${m}]`}const u=Object.keys(c).sort();let f="{";for(let m=0;m<u.length;m++)f+=`${JSON.stringify(u[m])}:${hd(c[u[m]])},`;return`${f}}`}function oy(c){let s="";for(const u of tr)s+=`/${hd(c[u])}`;return s}function Op(c){const s=c.value;return s?[new We(c.key,s,"constants have been deprecated as of v8")]:[]}function qn(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function _a(c){if(Array.isArray(c))return c.map(_a);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const s={};for(const u in c)s[u]=_a(c[u]);return s}return qn(c)}function Yr(c){const s=c.key,u=c.value,f=c.valueSpec||{},m=c.objectElementValidators||{},b=c.style,w=c.styleSpec,A=c.validateSpec;let C=[];const M=nn(u);if(M!=="object")return[new We(s,u,`object expected, ${M} found`)];for(const O in u){const k=O.split(".")[0],U=f[k]||f["*"];let q;if(m[k])q=m[k];else if(f[k])q=A;else if(m["*"])q=m["*"];else{if(!f["*"]){C.push(new We(s,u[O],`unknown property "${O}"`));continue}q=A}C=C.concat(q({key:(s&&`${s}.`)+O,value:u[O],valueSpec:U,style:b,styleSpec:w,object:u,objectKey:O,validateSpec:A},u))}for(const O in f)m[O]||f[O].required&&f[O].default===void 0&&u[O]===void 0&&C.push(new We(s,u,`missing required property "${O}"`));return C}function dd(c){const s=c.value,u=c.valueSpec,f=c.style,m=c.styleSpec,b=c.key,w=c.arrayElementValidator||c.validateSpec;if(nn(s)!=="array")return[new We(b,s,`array expected, ${nn(s)} found`)];if(u.length&&s.length!==u.length)return[new We(b,s,`array length ${u.length} expected, length ${s.length} found`)];if(u["min-length"]&&s.length<u["min-length"])return[new We(b,s,`array length at least ${u["min-length"]} expected, length ${s.length} found`)];let A={type:u.value,values:u.values};m.$version<7&&(A.function=u.function),nn(u.value)==="object"&&(A=u.value);let C=[];for(let M=0;M<s.length;M++)C=C.concat(w({array:s,arrayIndex:M,value:s[M],valueSpec:A,validateSpec:c.validateSpec,style:f,styleSpec:m,key:`${b}[${M}]`}));return C}function _u(c){const s=c.key,u=c.value,f=c.valueSpec;let m=nn(u);return m==="number"&&u!=u&&(m="NaN"),m!=="number"?[new We(s,u,`number expected, ${m} found`)]:"minimum"in f&&u<f.minimum?[new We(s,u,`${u} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&u>f.maximum?[new We(s,u,`${u} is greater than the maximum value ${f.maximum}`)]:[]}function fd(c){const s=c.valueSpec,u=qn(c.value.type);let f,m,b,w={};const A=u!=="categorical"&&c.value.property===void 0,C=!A,M=nn(c.value.stops)==="array"&&nn(c.value.stops[0])==="array"&&nn(c.value.stops[0][0])==="object",O=Yr({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(q){if(u==="identity")return[new We(q.key,q.value,'identity function may not have a "stops" property')];let X=[];const te=q.value;return X=X.concat(dd({key:q.key,value:te,valueSpec:q.valueSpec,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:k})),nn(te)==="array"&&te.length===0&&X.push(new We(q.key,te,"array must have at least one stop")),X},default:function(q){return q.validateSpec({key:q.key,value:q.value,valueSpec:s,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec})}}});return u==="identity"&&A&&O.push(new We(c.key,c.value,'missing required property "property"')),u==="identity"||c.value.stops||O.push(new We(c.key,c.value,'missing required property "stops"')),u==="exponential"&&c.valueSpec.expression&&!od(c.valueSpec)&&O.push(new We(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(C&&!rl(c.valueSpec)?O.push(new We(c.key,c.value,"property functions not supported")):A&&!Lp(c.valueSpec)&&O.push(new We(c.key,c.value,"zoom functions not supported"))),u!=="categorical"&&!M||c.value.property!==void 0||O.push(new We(c.key,c.value,'"property" property is required')),O;function k(q){let X=[];const te=q.value,se=q.key;if(nn(te)!=="array")return[new We(se,te,`array expected, ${nn(te)} found`)];if(te.length!==2)return[new We(se,te,`array length 2 expected, length ${te.length} found`)];if(M){if(nn(te[0])!=="object")return[new We(se,te,`object expected, ${nn(te[0])} found`)];if(te[0].zoom===void 0)return[new We(se,te,"object stop key must have zoom")];if(te[0].value===void 0)return[new We(se,te,"object stop key must have value")];if(b&&b>qn(te[0].zoom))return[new We(se,te[0].zoom,"stop zoom values must appear in ascending order")];qn(te[0].zoom)!==b&&(b=qn(te[0].zoom),m=void 0,w={}),X=X.concat(Yr({key:`${se}[0]`,value:te[0],valueSpec:{zoom:{}},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:_u,value:U}}))}else X=X.concat(U({key:`${se}[0]`,value:te[0],valueSpec:{},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec},te));return fu(_a(te[1]))?X.concat([new We(`${se}[1]`,te[1],"expressions are not allowed in function stops.")]):X.concat(q.validateSpec({key:`${se}[1]`,value:te[1],valueSpec:s,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec}))}function U(q,X){const te=nn(q.value),se=qn(q.value),ce=q.value!==null?q.value:X;if(f){if(te!==f)return[new We(q.key,ce,`${te} stop domain type must match previous stop domain type ${f}`)]}else f=te;if(te!=="number"&&te!=="string"&&te!=="boolean")return[new We(q.key,ce,"stop domain value must be a number, string, or boolean")];if(te!=="number"&&u!=="categorical"){let xe=`number expected, ${te} found`;return rl(s)&&u===void 0&&(xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(q.key,ce,xe)]}return u!=="categorical"||te!=="number"||isFinite(se)&&Math.floor(se)===se?u!=="categorical"&&te==="number"&&m!==void 0&&se<m?[new We(q.key,ce,"stop domain values must appear in ascending order")]:(m=se,u==="categorical"&&se in w?[new We(q.key,ce,"stop domain values must be unique")]:(w[se]=!0,[])):[new We(q.key,ce,`integer expected, found ${se}`)]}}function po(c){const s=(c.expressionContext==="property"?En:jt)(_a(c.value),c.valueSpec);if(s.result==="error")return s.value.map(f=>new We(`${c.key}${f.key}`,c.value,f.message));const u=s.value.expression||s.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!u.outputDefined())return[new We(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Kl(u))return[new We(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!Kl(u))return[new We(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Yl(u,["zoom","feature-state"]))return[new We(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!ou(u))return[new We(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function rc(c){const s=c.key,u=c.value,f=c.valueSpec,m=[];return Array.isArray(f.values)?f.values.indexOf(qn(u))===-1&&m.push(new We(s,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(qn(u))===-1&&m.push(new We(s,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),m}function yu(c){return ad(_a(c.value))?po(Ri({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Fp(c)}function Fp(c){const s=c.value,u=c.key;if(nn(s)!=="array")return[new We(u,s,`array expected, ${nn(s)} found`)];const f=c.styleSpec;let m,b=[];if(s.length<1)return[new We(u,s,"filter array must have at least 1 element")];switch(b=b.concat(rc({key:`${u}[0]`,value:s[0],valueSpec:f.filter_operator,style:c.style,styleSpec:c.styleSpec})),qn(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&qn(s[1])==="$type"&&b.push(new We(u,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&b.push(new We(u,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(m=nn(s[1]),m!=="string"&&b.push(new We(`${u}[1]`,s[1],`string expected, ${m} found`)));for(let w=2;w<s.length;w++)m=nn(s[w]),qn(s[1])==="$type"?b=b.concat(rc({key:`${u}[${w}]`,value:s[w],valueSpec:f.geometry_type,style:c.style,styleSpec:c.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&b.push(new We(`${u}[${w}]`,s[w],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let w=1;w<s.length;w++)b=b.concat(Fp({key:`${u}[${w}]`,value:s[w],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":m=nn(s[1]),s.length!==2?b.push(new We(u,s,`filter array for "${s[0]}" operator must have 2 elements`)):m!=="string"&&b.push(new We(`${u}[1]`,s[1],`string expected, ${m} found`));break;case"within":m=nn(s[1]),s.length!==2?b.push(new We(u,s,`filter array for "${s[0]}" operator must have 2 elements`)):m!=="object"&&b.push(new We(`${u}[1]`,s[1],`object expected, ${m} found`))}return b}function vu(c,s){const u=c.key,f=c.validateSpec,m=c.style,b=c.styleSpec,w=c.value,A=c.objectKey,C=b[`${s}_${c.layerType}`];if(!C)return[];const M=A.match(/^(.*)-transition$/);if(s==="paint"&&M&&C[M[1]]&&C[M[1]].transition)return f({key:u,value:w,valueSpec:b.transition,style:m,styleSpec:b});const O=c.valueSpec||C[A];if(!O)return[new We(u,w,`unknown property "${A}"`)];let k;if(nn(w)==="string"&&rl(O)&&!O.tokens&&(k=/^{([^}]+)}$/.exec(w)))return[new We(u,w,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const U=[];return c.layerType==="symbol"&&(A==="text-field"&&m&&!m.glyphs&&U.push(new We(u,w,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&du(_a(w))&&qn(w.type)==="identity"&&U.push(new We(u,w,'"text-font" does not support identity functions'))),U.concat(f({key:c.key,value:w,valueSpec:O,style:m,styleSpec:b,expressionContext:"property",propertyType:s,propertyKey:A}))}function sc(c){return vu(c,"paint")}function xu(c){return vu(c,"layout")}function bu(c){let s=[];const u=c.value,f=c.key,m=c.style,b=c.styleSpec;u.type||u.ref||s.push(new We(f,u,'either "type" or "ref" is required'));let w=qn(u.type);const A=qn(u.ref);if(u.id){const C=qn(u.id);for(let M=0;M<c.arrayIndex;M++){const O=m.layers[M];qn(O.id)===C&&s.push(new We(f,u.id,`duplicate layer id "${u.id}", previously used at line ${O.id.__line__}`))}}if("ref"in u){let C;["type","source","source-layer","filter","layout"].forEach(M=>{M in u&&s.push(new We(f,u[M],`"${M}" is prohibited for ref layers`))}),m.layers.forEach(M=>{qn(M.id)===A&&(C=M)}),C?C.ref?s.push(new We(f,u.ref,"ref cannot reference another ref layer")):w=qn(C.type):s.push(new We(f,u.ref,`ref layer "${A}" not found`))}else if(w!=="background")if(u.source){const C=m.sources&&m.sources[u.source],M=C&&qn(C.type);C?M==="vector"&&w==="raster"?s.push(new We(f,u.source,`layer "${u.id}" requires a raster source`)):M!=="raster-dem"&&w==="hillshade"?s.push(new We(f,u.source,`layer "${u.id}" requires a raster-dem source`)):M==="raster"&&w!=="raster"?s.push(new We(f,u.source,`layer "${u.id}" requires a vector source`)):M!=="vector"||u["source-layer"]?M==="raster-dem"&&w!=="hillshade"?s.push(new We(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!u.paint||!u.paint["line-gradient"]||M==="geojson"&&C.lineMetrics||s.push(new We(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new We(f,u,`layer "${u.id}" must specify a "source-layer"`)):s.push(new We(f,u.source,`source "${u.source}" not found`))}else s.push(new We(f,u,'missing required property "source"'));return s=s.concat(Yr({key:f,value:u,valueSpec:b.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${f}.type`,value:u.type,valueSpec:b.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:u,objectKey:"type"}),filter:yu,layout:C=>Yr({layer:u,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":M=>xu(Ri({layerType:w},M))}}),paint:C=>Yr({layer:u,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":M=>sc(Ri({layerType:w},M))}})}})),s}function jo(c){const s=c.value,u=c.key,f=nn(s);return f!=="string"?[new We(u,s,`string expected, ${f} found`)]:[]}const kp={promoteId:function({key:c,value:s}){if(nn(s)==="string")return jo({key:c,value:s});{const u=[];for(const f in s)u.push(...jo({key:`${c}.${f}`,value:s[f]}));return u}}};function oc(c){const s=c.value,u=c.key,f=c.styleSpec,m=c.style,b=c.validateSpec;if(!s.type)return[new We(u,s,'"type" is required')];const w=qn(s.type);let A;switch(w){case"vector":case"raster":return A=Yr({key:u,value:s,valueSpec:f[`source_${w.replace("-","_")}`],style:c.style,styleSpec:f,objectElementValidators:kp,validateSpec:b}),A;case"raster-dem":return A=function(C){var M;const O=(M=C.sourceName)!==null&&M!==void 0?M:"",k=C.value,U=C.styleSpec,q=U.source_raster_dem,X=C.style;let te=[];const se=nn(k);if(k===void 0)return te;if(se!=="object")return te.push(new We("source_raster_dem",k,`object expected, ${se} found`)),te;const ce=qn(k.encoding)==="custom",xe=["redFactor","greenFactor","blueFactor","baseShift"],me=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const we in k)!ce&&xe.includes(we)?te.push(new We(we,k[we],`In "${O}": "${we}" is only valid when "encoding" is set to "custom". ${me} encoding found`)):q[we]?te=te.concat(C.validateSpec({key:we,value:k[we],valueSpec:q[we],validateSpec:C.validateSpec,style:X,styleSpec:U})):te.push(new We(we,k[we],`unknown property "${we}"`));return te}({sourceName:u,value:s,style:c.style,styleSpec:f,validateSpec:b}),A;case"geojson":if(A=Yr({key:u,value:s,valueSpec:f.source_geojson,style:m,styleSpec:f,validateSpec:b,objectElementValidators:kp}),s.cluster)for(const C in s.clusterProperties){const[M,O]=s.clusterProperties[C],k=typeof M=="string"?[M,["accumulated"],["get",C]]:M;A.push(...po({key:`${u}.${C}.map`,value:O,validateSpec:b,expressionContext:"cluster-map"})),A.push(...po({key:`${u}.${C}.reduce`,value:k,validateSpec:b,expressionContext:"cluster-reduce"}))}return A;case"video":return Yr({key:u,value:s,valueSpec:f.source_video,style:m,validateSpec:b,styleSpec:f});case"image":return Yr({key:u,value:s,valueSpec:f.source_image,style:m,validateSpec:b,styleSpec:f});case"canvas":return[new We(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rc({key:`${u}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,validateSpec:b,styleSpec:f})}}function zp(c){const s=c.value,u=c.styleSpec,f=u.light,m=c.style;let b=[];const w=nn(s);if(s===void 0)return b;if(w!=="object")return b=b.concat([new We("light",s,`object expected, ${w} found`)]),b;for(const A in s){const C=A.match(/^(.*)-transition$/);b=b.concat(C&&f[C[1]]&&f[C[1]].transition?c.validateSpec({key:A,value:s[A],valueSpec:u.transition,validateSpec:c.validateSpec,style:m,styleSpec:u}):f[A]?c.validateSpec({key:A,value:s[A],valueSpec:f[A],validateSpec:c.validateSpec,style:m,styleSpec:u}):[new We(A,s[A],`unknown property "${A}"`)])}return b}function Np(c){const s=c.value,u=c.styleSpec,f=u.terrain,m=c.style;let b=[];const w=nn(s);if(s===void 0)return b;if(w!=="object")return b=b.concat([new We("terrain",s,`object expected, ${w} found`)]),b;for(const A in s)b=b.concat(f[A]?c.validateSpec({key:A,value:s[A],valueSpec:f[A],validateSpec:c.validateSpec,style:m,styleSpec:u}):[new We(A,s[A],`unknown property "${A}"`)]);return b}function Up(c){let s=[];const u=c.value,f=c.key;if(Array.isArray(u)){const m=[],b=[];for(const w in u)u[w].id&&m.includes(u[w].id)&&s.push(new We(f,u,`all the sprites' ids must be unique, but ${u[w].id} is duplicated`)),m.push(u[w].id),u[w].url&&b.includes(u[w].url)&&s.push(new We(f,u,`all the sprites' URLs must be unique, but ${u[w].url} is duplicated`)),b.push(u[w].url),s=s.concat(Yr({key:`${f}[${w}]`,value:u[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return s}return jo({key:f,value:u})}const Gp={"*":()=>[],array:dd,boolean:function(c){const s=c.value,u=c.key,f=nn(s);return f!=="boolean"?[new We(u,s,`boolean expected, ${f} found`)]:[]},number:_u,color:function(c){const s=c.key,u=c.value,f=nn(u);return f!=="string"?[new We(s,u,`color expected, ${f} found`)]:wt.parse(String(u))?[]:[new We(s,u,`color expected, "${u}" found`)]},constants:Op,enum:rc,filter:yu,function:fd,layer:bu,object:Yr,source:oc,light:zp,terrain:Np,string:jo,formatted:function(c){return jo(c).length===0?[]:po(c)},resolvedImage:function(c){return jo(c).length===0?[]:po(c)},padding:function(c){const s=c.key,u=c.value;if(nn(u)==="array"){if(u.length<1||u.length>4)return[new We(s,u,`padding requires 1 to 4 values; ${u.length} values found`)];const f={type:"number"};let m=[];for(let b=0;b<u.length;b++)m=m.concat(c.validateSpec({key:`${s}[${b}]`,value:u[b],validateSpec:c.validateSpec,valueSpec:f}));return m}return _u({key:s,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const s=c.key,u=c.value,f=nn(u),m=c.styleSpec;if(f!=="array"||u.length<1||u.length%2!=0)return[new We(s,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let w=0;w<u.length;w+=2)b=b.concat(rc({key:`${s}[${w}]`,value:u[w],valueSpec:m.layout_symbol["text-anchor"]})),b=b.concat(dd({key:`${s}[${w+1}]`,value:u[w+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:m}));return b},sprite:Up};function ac(c){const s=c.value,u=c.valueSpec,f=c.styleSpec;return c.validateSpec=ac,u.expression&&du(qn(s))?fd(c):u.expression&&fu(_a(s))?po(c):u.type&&Gp[u.type]?Gp[u.type](c):Yr(Ri({},c,{valueSpec:u.type?f[u.type]:u}))}function lc(c){const s=c.value,u=c.key,f=jo(c);return f.length||(s.indexOf("{fontstack}")===-1&&f.push(new We(u,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&f.push(new We(u,s,'"glyphs" url must include a "{range}" token'))),f}function Dr(c,s=Be){let u=[];return u=u.concat(ac({key:"",value:c,valueSpec:s.$root,styleSpec:s,style:c,validateSpec:ac,objectElementValidators:{glyphs:lc,"*":()=>[]}})),c.constants&&(u=u.concat(Op({key:"constants",value:c.constants,style:c,styleSpec:s,validateSpec:ac}))),cc(u)}function ci(c){return function(s){return c({...s,validateSpec:ac})}}function cc(c){return[].concat(c).sort((s,u)=>s.line-u.line)}function mo(c){return function(...s){return cc(c.apply(this,s))}}Dr.source=mo(ci(oc)),Dr.sprite=mo(ci(Up)),Dr.glyphs=mo(ci(lc)),Dr.light=mo(ci(zp)),Dr.terrain=mo(ci(Np)),Dr.layer=mo(ci(bu)),Dr.filter=mo(ci(yu)),Dr.paintProperty=mo(ci(sc)),Dr.layoutProperty=mo(ci(xu));const uc=Dr,ay=uc.light,hc=uc.paintProperty,ly=uc.layoutProperty;function wu(c,s){let u=!1;if(s&&s.length)for(const f of s)c.fire(new er(new Error(f.message))),u=!0;return u}class dc{constructor(s,u,f){const m=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const w=new Int32Array(this.arrayBuffer);s=w[0],this.d=(u=w[1])+2*(f=w[2]);for(let C=0;C<this.d*this.d;C++){const M=w[3+C],O=w[3+C+1];m.push(M===O?null:w.subarray(M,O))}const A=w[3+m.length+1];this.keys=w.subarray(w[3+m.length],A),this.bboxes=w.subarray(A),this.insert=this._insertReadonly}else{this.d=u+2*f;for(let w=0;w<this.d*this.d;w++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=f,this.scale=u/s,this.uid=0;const b=f/u*s;this.min=-b,this.max=s+b}insert(s,u,f,m,b){this._forEachCell(u,f,m,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,u,f,m,b,w){this.cells[b].push(w)}query(s,u,f,m,b){const w=this.min,A=this.max;if(s<=w&&u<=w&&A<=f&&A<=m&&!b)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(s,u,f,m,this._queryCell,C,{},b),C}}_queryCell(s,u,f,m,b,w,A,C){const M=this.cells[b];if(M!==null){const O=this.keys,k=this.bboxes;for(let U=0;U<M.length;U++){const q=M[U];if(A[q]===void 0){const X=4*q;(C?C(k[X+0],k[X+1],k[X+2],k[X+3]):s<=k[X+2]&&u<=k[X+3]&&f>=k[X+0]&&m>=k[X+1])?(A[q]=!0,w.push(O[q])):A[q]=!1}}}}_forEachCell(s,u,f,m,b,w,A,C){const M=this._convertToCellCoord(s),O=this._convertToCellCoord(u),k=this._convertToCellCoord(f),U=this._convertToCellCoord(m);for(let q=M;q<=k;q++)for(let X=O;X<=U;X++){const te=this.d*X+q;if((!C||C(this._convertFromCellCoord(q),this._convertFromCellCoord(X),this._convertFromCellCoord(q+1),this._convertFromCellCoord(X+1)))&&b.call(this,s,u,f,m,te,w,A,C))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,u=3+this.cells.length+1+1;let f=0;for(let w=0;w<this.cells.length;w++)f+=this.cells[w].length;const m=new Int32Array(u+f+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let b=u;for(let w=0;w<s.length;w++){const A=s[w];m[3+w]=b,m.set(A,b),b+=A.length}return m[3+s.length]=b,m.set(this.keys,b),b+=this.keys.length,m[3+s.length+1]=b,m.set(this.bboxes,b),b+=this.bboxes.length,m.buffer}static serialize(s,u){const f=s.toArrayBuffer();return u&&u.push(f),{buffer:f}}static deserialize(s){return new dc(s.buffer)}}const Vs={};function rt(c,s,u={}){if(Vs[c])throw new Error(`${c} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:c,writeable:!1}),Vs[c]={klass:s,omit:u.omit||[],shallow:u.shallow||[]}}rt("Object",Object),rt("TransferableGridIndex",dc),rt("Color",wt),rt("Error",Error),rt("AJAXError",tn),rt("ResolvedImage",Hn),rt("StylePropertyFunction",ga),rt("StyleExpression",zn,{omit:["_evaluator"]}),rt("ZoomDependentExpression",An),rt("ZoomConstantExpression",tc),rt("CompoundExpression",Br,{omit:["_evaluate"]});for(const c in nl)nl[c]._classRegistryKey||rt(`Expression_${c}`,nl[c]);function sl(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function fc(c,s){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob)return c;if(sl(c)||Jn(c))return s&&s.push(c),c;if(ArrayBuffer.isView(c)){const u=c;return s&&s.push(u.buffer),u}if(c instanceof ImageData)return s&&s.push(c.data.buffer),c;if(Array.isArray(c)){const u=[];for(const f of c)u.push(fc(f,s));return u}if(typeof c=="object"){const u=c.constructor,f=u._classRegistryKey;if(!f)throw new Error("can't serialize object of unregistered class");if(!Vs[f])throw new Error(`${f} is not registered.`);const m=u.serialize?u.serialize(c,s):{};if(u.serialize){if(s&&m===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in c){if(!c.hasOwnProperty(b)||Vs[f].omit.indexOf(b)>=0)continue;const w=c[b];m[b]=Vs[f].shallow.indexOf(b)>=0?w:fc(w,s)}c instanceof Error&&(m.message=c.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(m.$name=f),m}throw new Error("can't serialize object of type "+typeof c)}function ya(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||sl(c)||Jn(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(ya);if(typeof c=="object"){const s=c.$name||"Object";if(!Vs[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:u}=Vs[s];if(!u)throw new Error(`can't deserialize unregistered class ${s}`);if(u.deserialize)return u.deserialize(c);const f=Object.create(u.prototype);for(const m of Object.keys(c)){if(m==="$name")continue;const b=c[m];f[m]=Vs[s].shallow.indexOf(m)>=0?b:ya(b)}return f}throw new Error("can't deserialize object of type "+typeof c)}class pd{constructor(){this.first=!0}update(s,u){const f=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=f,!0))}}const Qe={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Au(c){for(const s of c)if(pc(s.charCodeAt(0)))return!0;return!1}function Vp(c){for(const s of c)if(!cy(s.charCodeAt(0)))return!1;return!0}function cy(c){return!(Qe.Arabic(c)||Qe["Arabic Supplement"](c)||Qe["Arabic Extended-A"](c)||Qe["Arabic Presentation Forms-A"](c)||Qe["Arabic Presentation Forms-B"](c))}function pc(c){return!(c!==746&&c!==747&&(c<4352||!(Qe["Bopomofo Extended"](c)||Qe.Bopomofo(c)||Qe["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Qe["CJK Compatibility Ideographs"](c)||Qe["CJK Compatibility"](c)||Qe["CJK Radicals Supplement"](c)||Qe["CJK Strokes"](c)||!(!Qe["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Qe["CJK Unified Ideographs Extension A"](c)||Qe["CJK Unified Ideographs"](c)||Qe["Enclosed CJK Letters and Months"](c)||Qe["Hangul Compatibility Jamo"](c)||Qe["Hangul Jamo Extended-A"](c)||Qe["Hangul Jamo Extended-B"](c)||Qe["Hangul Jamo"](c)||Qe["Hangul Syllables"](c)||Qe.Hiragana(c)||Qe["Ideographic Description Characters"](c)||Qe.Kanbun(c)||Qe["Kangxi Radicals"](c)||Qe["Katakana Phonetic Extensions"](c)||Qe.Katakana(c)&&c!==12540||!(!Qe["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Qe["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Qe["Unified Canadian Aboriginal Syllabics"](c)||Qe["Unified Canadian Aboriginal Syllabics Extended"](c)||Qe["Vertical Forms"](c)||Qe["Yijing Hexagram Symbols"](c)||Qe["Yi Syllables"](c)||Qe["Yi Radicals"](c))))}function mc(c){return!(pc(c)||function(s){return!!(Qe["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Qe["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Qe["Letterlike Symbols"](s)||Qe["Number Forms"](s)||Qe["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Qe["Control Pictures"](s)&&s!==9251||Qe["Optical Character Recognition"](s)||Qe["Enclosed Alphanumerics"](s)||Qe["Geometric Shapes"](s)||Qe["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Qe["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Qe["CJK Symbols and Punctuation"](s)||Qe.Katakana(s)||Qe["Private Use Area"](s)||Qe["CJK Compatibility Forms"](s)||Qe["Small Form Variants"](s)||Qe["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(c))}function md(c){return c>=1424&&c<=2303||Qe["Arabic Presentation Forms-A"](c)||Qe["Arabic Presentation Forms-B"](c)}function uy(c,s){return!(!s&&md(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Qe.Khmer(c))}function jp(c){for(const s of c)if(md(s.charCodeAt(0)))return!0;return!1}const gd="deferred",gc="loading",_d="loaded";let yd=null,fr="unavailable",Ho=null;const vd=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(fr="error"),yd&&yd(c)};function xd(){bd.fire(new gn("pluginStateChange",{pluginStatus:fr,pluginURL:Ho}))}const bd=new ur,wd=function(){return fr},Hp=function(){if(fr!==gd||!Ho)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");fr=gc,xd(),Ho&&Qi({url:Ho},c=>{c?vd(c):(fr=_d,xd())})},Qr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>fr===_d||Qr.applyArabicShaping!=null,isLoading:()=>fr===gc,setState(c){if(!Lt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");fr=c.pluginStatus,Ho=c.pluginURL},isParsed(){if(!Lt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Qr.applyArabicShaping!=null&&Qr.processBidirectionalText!=null&&Qr.processStyledBidirectionalText!=null},getPluginURL(){if(!Lt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Ho}};class In{constructor(s,u){this.zoom=s,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new pd,this.transition={})}isSupportedScript(s){return function(u,f){for(const m of u)if(!uy(m.charCodeAt(0),f))return!1;return!0}(s,Qr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,u=s-Math.floor(s),f=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}}}class Eu{constructor(s,u){this.property=s,this.value=u,this.expression=function(f,m){if(du(f))return new ga(f,m);if(fu(f)){const b=En(f,m);if(b.result==="error")throw new Error(b.value.map(w=>`${w.key}: ${w.message}`).join(", "));return b.value}{let b=f;return m.type==="color"&&typeof f=="string"?b=wt.parse(f):m.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(b=Cn.parse(f)):b=bn.parse(f),{kind:"constant",evaluate:()=>b}}}(u===void 0?s.specification.default:u,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,u,f){return this.property.possiblyEvaluate(this,s,u,f)}}class ol{constructor(s){this.property=s,this.value=new Eu(s,void 0)}transitioned(s,u){return new Tu(this.property,this.value,u,Z({},s.transition,this.transition),s.now)}untransitioned(){return new Tu(this.property,this.value,null,{},0)}}class Wp{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return Le(this._values[s].value.value)}setValue(s,u){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new ol(this._values[s].property)),this._values[s].value=new Eu(this._values[s].property,u===null?void 0:Le(u))}getTransition(s){return Le(this._values[s].transition)}setTransition(s,u){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new ol(this._values[s].property)),this._values[s].transition=Le(u)||void 0}serialize(){const s={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(s[u]=f);const m=this.getTransition(u);m!==void 0&&(s[`${u}-transition`]=m)}return s}transitioned(s,u){const f=new qp(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].transitioned(s,u._values[m]);return f}untransitioned(){const s=new qp(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].untransitioned();return s}}class Tu{constructor(s,u,f,m,b){this.property=s,this.value=u,this.begin=b+m.delay||0,this.end=this.begin+m.duration||0,s.specification.transition&&(m.delay||m.duration)&&(this.prior=f)}possiblyEvaluate(s,u,f){const m=s.now||0,b=this.value.possiblyEvaluate(s,u,f),w=this.prior;if(w){if(m>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(m<this.begin)return w.possiblyEvaluate(s,u,f);{const A=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(s,u,f),b,function(C){if(C<=0)return 0;if(C>=1)return 1;const M=C*C,O=M*C;return 4*(C<.5?O:3*(C-M)+O-.75)}(A))}}return b}}class qp{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,u,f){const m=new _c(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(s,u,f);return m}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class hy{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}hasValue(s){return this._values[s].value!==void 0}getValue(s){return Le(this._values[s].value)}setValue(s,u){this._values[s]=new Eu(this._values[s].property,u===null?void 0:Le(u))}serialize(){const s={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(s[u]=f)}return s}possiblyEvaluate(s,u,f){const m=new _c(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(s,u,f);return m}}class ms{constructor(s,u,f){this.property=s,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,u,f,m){return this.property.evaluate(this.value,this.parameters,s,u,f,m)}}class _c{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class mt{constructor(s){this.specification=s}possiblyEvaluate(s,u){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(u)}interpolate(s,u,f){const m=Lr[this.specification.type];return m?m(s,u,f):s}}class Tt{constructor(s,u){this.specification=s,this.overrides=u}possiblyEvaluate(s,u,f,m){return new ms(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(u,null,{},f,m)}:s.expression,u)}interpolate(s,u,f){if(s.value.kind!=="constant"||u.value.kind!=="constant")return s;if(s.value.value===void 0||u.value.value===void 0)return new ms(this,{kind:"constant",value:void 0},s.parameters);const m=Lr[this.specification.type];if(m){const b=m(s.value.value,u.value.value,f);return new ms(this,{kind:"constant",value:b},s.parameters)}return s}evaluate(s,u,f,m,b,w){return s.kind==="constant"?s.value:s.evaluate(u,f,m,b,w)}}class Su extends Tt{possiblyEvaluate(s,u,f,m){if(s.value===void 0)return new ms(this,{kind:"constant",value:void 0},u);if(s.expression.kind==="constant"){const b=s.expression.evaluate(u,null,{},f,m),w=s.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,A=this._calculate(w,w,w,u);return new ms(this,{kind:"constant",value:A},u)}if(s.expression.kind==="camera"){const b=this._calculate(s.expression.evaluate({zoom:u.zoom-1}),s.expression.evaluate({zoom:u.zoom}),s.expression.evaluate({zoom:u.zoom+1}),u);return new ms(this,{kind:"constant",value:b},u)}return new ms(this,s.expression,u)}evaluate(s,u,f,m,b,w){if(s.kind==="source"){const A=s.evaluate(u,f,m,b,w);return this._calculate(A,A,A,u)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(u.zoom)-1},f,m),s.evaluate({zoom:Math.floor(u.zoom)},f,m),s.evaluate({zoom:Math.floor(u.zoom)+1},f,m),u):s.value}_calculate(s,u,f,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:f,to:u}}interpolate(s){return s}}class Ad{constructor(s){this.specification=s}possiblyEvaluate(s,u,f,m){if(s.value!==void 0){if(s.expression.kind==="constant"){const b=s.expression.evaluate(u,null,{},f,m);return this._calculate(b,b,b,u)}return this._calculate(s.expression.evaluate(new In(Math.floor(u.zoom-1),u)),s.expression.evaluate(new In(Math.floor(u.zoom),u)),s.expression.evaluate(new In(Math.floor(u.zoom+1),u)),u)}}_calculate(s,u,f,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:f,to:u}}interpolate(s){return s}}class Ed{constructor(s){this.specification=s}possiblyEvaluate(s,u,f,m){return!!s.expression.evaluate(u,null,{},f,m)}interpolate(){return!1}}class pr{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in s){const f=s[u];f.specification.overridable&&this.overridableProperties.push(u);const m=this.defaultPropertyValues[u]=new Eu(f,void 0),b=this.defaultTransitionablePropertyValues[u]=new ol(f);this.defaultTransitioningPropertyValues[u]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate({})}}}rt("DataDrivenProperty",Tt),rt("DataConstantProperty",mt),rt("CrossFadedDataDrivenProperty",Su),rt("CrossFadedProperty",Ad),rt("ColorRampProperty",Ed);const va="-transition";class js extends ur{constructor(s,u){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),u.layout&&(this._unevaluatedLayout=new hy(u.layout)),u.paint)){this._transitionablePaint=new Wp(u.paint);for(const f in s.paint)this.setPaintProperty(f,s.paint[f],{validate:!1});for(const f in s.layout)this.setLayoutProperty(f,s.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _c(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,u,f={}){u!=null&&this._validate(ly,`layers.${this.id}.layout.${s}`,s,u,f)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,u):this.visibility=u)}getPaintProperty(s){return s.endsWith(va)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,u,f={}){if(u!=null&&this._validate(hc,`layers.${this.id}.paint.${s}`,s,u,f))return!1;if(s.endsWith(va))return this._transitionablePaint.setTransition(s.slice(0,-11),u||void 0),!1;{const m=this._transitionablePaint._values[s],b=m.property.specification["property-type"]==="cross-faded-data-driven",w=m.value.isDataDriven(),A=m.value;this._transitionablePaint.setValue(s,u),this._handleSpecialPaintPropertyUpdate(s);const C=this._transitionablePaint._values[s].value;return C.isDataDriven()||w||b||this._handleOverridablePaintPropertyUpdate(s,A,C)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,u,f){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,u){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,u)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),Ee(s,(u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length))}_validate(s,u,f,m,b={}){return(!b||b.validate!==!1)&&wu(this,s.call(uc,{key:u,layerType:this.type,objectKey:f,value:m,styleSpec:Be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const u=this.paint.get(s);if(u instanceof ms&&rl(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const dy={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class yc{constructor(s,u){this._structArray=s,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ln{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,u){return s._trim(),u&&(s.isTransferred=!0,u.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const u=Object.create(this.prototype);return u.arrayBuffer=s.arrayBuffer,u.length=s.length,u.capacity=s.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ei(c,s=1){let u=0,f=0;return{members:c.map(m=>{const b=dy[m.type].BYTES_PER_ELEMENT,w=u=Xp(u,Math.max(s,b)),A=m.components||1;return f=Math.max(f,b),u+=b*A,{name:m.name,type:m.type,components:A,offset:w}}),size:Xp(u,Math.max(f,s)),alignment:s}}function Xp(c,s){return Math.ceil(c/s)*s}class es extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u){const f=this.length;return this.resize(f+1),this.emplace(f,s,u)}emplace(s,u,f){const m=2*s;return this.int16[m+0]=u,this.int16[m+1]=f,s}}es.prototype.bytesPerElement=4,rt("StructArrayLayout2i4",es);class vc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,u,f)}emplace(s,u,f,m){const b=3*s;return this.int16[b+0]=u,this.int16[b+1]=f,this.int16[b+2]=m,s}}vc.prototype.bytesPerElement=6,rt("StructArrayLayout3i6",vc);class xc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,s,u,f,m)}emplace(s,u,f,m,b){const w=4*s;return this.int16[w+0]=u,this.int16[w+1]=f,this.int16[w+2]=m,this.int16[w+3]=b,s}}xc.prototype.bytesPerElement=8,rt("StructArrayLayout4i8",xc);class Cu extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,m,b,w){const A=this.length;return this.resize(A+1),this.emplace(A,s,u,f,m,b,w)}emplace(s,u,f,m,b,w,A){const C=6*s;return this.int16[C+0]=u,this.int16[C+1]=f,this.int16[C+2]=m,this.int16[C+3]=b,this.int16[C+4]=w,this.int16[C+5]=A,s}}Cu.prototype.bytesPerElement=12,rt("StructArrayLayout2i4i12",Cu);class bc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,m,b,w){const A=this.length;return this.resize(A+1),this.emplace(A,s,u,f,m,b,w)}emplace(s,u,f,m,b,w,A){const C=4*s,M=8*s;return this.int16[C+0]=u,this.int16[C+1]=f,this.uint8[M+4]=m,this.uint8[M+5]=b,this.uint8[M+6]=w,this.uint8[M+7]=A,s}}bc.prototype.bytesPerElement=8,rt("StructArrayLayout2i4ub8",bc);class wc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u){const f=this.length;return this.resize(f+1),this.emplace(f,s,u)}emplace(s,u,f){const m=2*s;return this.float32[m+0]=u,this.float32[m+1]=f,s}}wc.prototype.bytesPerElement=8,rt("StructArrayLayout2f8",wc);class al extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f,m,b,w,A,C,M,O){const k=this.length;return this.resize(k+1),this.emplace(k,s,u,f,m,b,w,A,C,M,O)}emplace(s,u,f,m,b,w,A,C,M,O,k){const U=10*s;return this.uint16[U+0]=u,this.uint16[U+1]=f,this.uint16[U+2]=m,this.uint16[U+3]=b,this.uint16[U+4]=w,this.uint16[U+5]=A,this.uint16[U+6]=C,this.uint16[U+7]=M,this.uint16[U+8]=O,this.uint16[U+9]=k,s}}al.prototype.bytesPerElement=20,rt("StructArrayLayout10ui20",al);class xa extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f,m,b,w,A,C,M,O,k,U){const q=this.length;return this.resize(q+1),this.emplace(q,s,u,f,m,b,w,A,C,M,O,k,U)}emplace(s,u,f,m,b,w,A,C,M,O,k,U,q){const X=12*s;return this.int16[X+0]=u,this.int16[X+1]=f,this.int16[X+2]=m,this.int16[X+3]=b,this.uint16[X+4]=w,this.uint16[X+5]=A,this.uint16[X+6]=C,this.uint16[X+7]=M,this.int16[X+8]=O,this.int16[X+9]=k,this.int16[X+10]=U,this.int16[X+11]=q,s}}xa.prototype.bytesPerElement=24,rt("StructArrayLayout4i4ui4i24",xa);class Td extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,u,f)}emplace(s,u,f,m){const b=3*s;return this.float32[b+0]=u,this.float32[b+1]=f,this.float32[b+2]=m,s}}Td.prototype.bytesPerElement=12,rt("StructArrayLayout3f12",Td);class Iu extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint32[1*s+0]=u,s}}Iu.prototype.bytesPerElement=4,rt("StructArrayLayout1ul4",Iu);class ba extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f,m,b,w,A,C,M){const O=this.length;return this.resize(O+1),this.emplace(O,s,u,f,m,b,w,A,C,M)}emplace(s,u,f,m,b,w,A,C,M,O){const k=10*s,U=5*s;return this.int16[k+0]=u,this.int16[k+1]=f,this.int16[k+2]=m,this.int16[k+3]=b,this.int16[k+4]=w,this.int16[k+5]=A,this.uint32[U+3]=C,this.uint16[k+8]=M,this.uint16[k+9]=O,s}}ba.prototype.bytesPerElement=20,rt("StructArrayLayout6i1ul2ui20",ba);class Sd extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,m,b,w){const A=this.length;return this.resize(A+1),this.emplace(A,s,u,f,m,b,w)}emplace(s,u,f,m,b,w,A){const C=6*s;return this.int16[C+0]=u,this.int16[C+1]=f,this.int16[C+2]=m,this.int16[C+3]=b,this.int16[C+4]=w,this.int16[C+5]=A,s}}Sd.prototype.bytesPerElement=12,rt("StructArrayLayout2i2i2i12",Sd);class Cd extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,m,b){const w=this.length;return this.resize(w+1),this.emplace(w,s,u,f,m,b)}emplace(s,u,f,m,b,w){const A=4*s,C=8*s;return this.float32[A+0]=u,this.float32[A+1]=f,this.float32[A+2]=m,this.int16[C+6]=b,this.int16[C+7]=w,s}}Cd.prototype.bytesPerElement=16,rt("StructArrayLayout2f1f2i16",Cd);class Pu extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,s,u,f,m)}emplace(s,u,f,m,b){const w=12*s,A=3*s;return this.uint8[w+0]=u,this.uint8[w+1]=f,this.float32[A+1]=m,this.float32[A+2]=b,s}}Pu.prototype.bytesPerElement=12,rt("StructArrayLayout2ub2f12",Pu);class Mu extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,u,f)}emplace(s,u,f,m){const b=3*s;return this.uint16[b+0]=u,this.uint16[b+1]=f,this.uint16[b+2]=m,s}}Mu.prototype.bytesPerElement=6,rt("StructArrayLayout3ui6",Mu);class Id extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,m,b,w,A,C,M,O,k,U,q,X,te,se,ce){const xe=this.length;return this.resize(xe+1),this.emplace(xe,s,u,f,m,b,w,A,C,M,O,k,U,q,X,te,se,ce)}emplace(s,u,f,m,b,w,A,C,M,O,k,U,q,X,te,se,ce,xe){const me=24*s,we=12*s,Se=48*s;return this.int16[me+0]=u,this.int16[me+1]=f,this.uint16[me+2]=m,this.uint16[me+3]=b,this.uint32[we+2]=w,this.uint32[we+3]=A,this.uint32[we+4]=C,this.uint16[me+10]=M,this.uint16[me+11]=O,this.uint16[me+12]=k,this.float32[we+7]=U,this.float32[we+8]=q,this.uint8[Se+36]=X,this.uint8[Se+37]=te,this.uint8[Se+38]=se,this.uint32[we+10]=ce,this.int16[me+22]=xe,s}}Id.prototype.bytesPerElement=48,rt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Id);class rn extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,m,b,w,A,C,M,O,k,U,q,X,te,se,ce,xe,me,we,Se,Fe,nt,dt,et,Ye,qe,st){const Je=this.length;return this.resize(Je+1),this.emplace(Je,s,u,f,m,b,w,A,C,M,O,k,U,q,X,te,se,ce,xe,me,we,Se,Fe,nt,dt,et,Ye,qe,st)}emplace(s,u,f,m,b,w,A,C,M,O,k,U,q,X,te,se,ce,xe,me,we,Se,Fe,nt,dt,et,Ye,qe,st,Je){const Ve=32*s,bt=16*s;return this.int16[Ve+0]=u,this.int16[Ve+1]=f,this.int16[Ve+2]=m,this.int16[Ve+3]=b,this.int16[Ve+4]=w,this.int16[Ve+5]=A,this.int16[Ve+6]=C,this.int16[Ve+7]=M,this.uint16[Ve+8]=O,this.uint16[Ve+9]=k,this.uint16[Ve+10]=U,this.uint16[Ve+11]=q,this.uint16[Ve+12]=X,this.uint16[Ve+13]=te,this.uint16[Ve+14]=se,this.uint16[Ve+15]=ce,this.uint16[Ve+16]=xe,this.uint16[Ve+17]=me,this.uint16[Ve+18]=we,this.uint16[Ve+19]=Se,this.uint16[Ve+20]=Fe,this.uint16[Ve+21]=nt,this.uint16[Ve+22]=dt,this.uint32[bt+12]=et,this.float32[bt+13]=Ye,this.float32[bt+14]=qe,this.uint16[Ve+30]=st,this.uint16[Ve+31]=Je,s}}rn.prototype.bytesPerElement=64,rt("StructArrayLayout8i15ui1ul2f2ui64",rn);class y extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.float32[1*s+0]=u,s}}y.prototype.bytesPerElement=4,rt("StructArrayLayout1f4",y);class o extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,u,f)}emplace(s,u,f,m){const b=3*s;return this.uint16[6*s+0]=u,this.float32[b+1]=f,this.float32[b+2]=m,s}}o.prototype.bytesPerElement=12,rt("StructArrayLayout1ui2f12",o);class d extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,u,f)}emplace(s,u,f,m){const b=4*s;return this.uint32[2*s+0]=u,this.uint16[b+2]=f,this.uint16[b+3]=m,s}}d.prototype.bytesPerElement=8,rt("StructArrayLayout1ul2ui8",d);class p extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u){const f=this.length;return this.resize(f+1),this.emplace(f,s,u)}emplace(s,u,f){const m=2*s;return this.uint16[m+0]=u,this.uint16[m+1]=f,s}}p.prototype.bytesPerElement=4,rt("StructArrayLayout2ui4",p);class g extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint16[1*s+0]=u,s}}g.prototype.bytesPerElement=2,rt("StructArrayLayout1ui2",g);class x extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,s,u,f,m)}emplace(s,u,f,m,b){const w=4*s;return this.float32[w+0]=u,this.float32[w+1]=f,this.float32[w+2]=m,this.float32[w+3]=b,s}}x.prototype.bytesPerElement=16,rt("StructArrayLayout4f16",x);class E extends yc{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new I(this.anchorPointX,this.anchorPointY)}}E.prototype.size=20;class T extends ba{get(s){return new E(this,s)}}rt("CollisionBoxArray",T);class P extends yc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}P.prototype.size=48;class L extends Id{get(s){return new P(this,s)}}rt("PlacedSymbolArray",L);class D extends yc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}D.prototype.size=64;class F extends rn{get(s){return new D(this,s)}}rt("SymbolInstanceArray",F);class H extends y{getoffsetX(s){return this.float32[1*s+0]}}rt("GlyphOffsetArray",H);class ne extends vc{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}rt("SymbolLineVertexArray",ne);class ee extends yc{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ee.prototype.size=12;class re extends o{get(s){return new ee(this,s)}}rt("TextAnchorOffsetArray",re);class Q extends yc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Q.prototype.size=8;class ge extends d{get(s){return new Q(this,s)}}rt("FeatureIndexArray",ge);class Ae extends es{}class le extends es{}class ye extends es{}class Ce extends Cu{}class Ie extends bc{}class Oe extends wc{}class Ge extends al{}class Ne extends xa{}class He extends Td{}class ht extends Iu{}class kt extends Sd{}class Ke extends Pu{}class yt extends Mu{}class ct extends p{}const Pn=ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:zt}=Pn;class xt{constructor(s=[]){this.segments=s}prepareSegment(s,u,f,m){let b=this.segments[this.segments.length-1];return s>xt.MAX_VERTEX_ARRAY_LENGTH&&Ue(`Max vertices per segment is ${xt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!b||b.vertexLength+s>xt.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==m)&&(b={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},m!==void 0&&(b.sortKey=m),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const s of this.segments)for(const u in s.vaos)s.vaos[u].destroy()}static simpleSegment(s,u,f,m){return new xt([{vertexOffset:s,primitiveOffset:u,vertexLength:f,primitiveLength:m,vaos:{},sortKey:0}])}}function Nt(c,s){return 256*(c=j(Math.floor(c),0,255))+j(Math.floor(s),0,255)}xt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rt("SegmentVector",xt);const Rn=ei([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var hn={exports:{}},Or={exports:{}};Or.exports=function(c,s){var u,f,m,b,w,A,C,M;for(f=c.length-(u=3&c.length),m=s,w=3432918353,A=461845907,M=0;M<f;)C=255&c.charCodeAt(M)|(255&c.charCodeAt(++M))<<8|(255&c.charCodeAt(++M))<<16|(255&c.charCodeAt(++M))<<24,++M,m=27492+(65535&(b=5*(65535&(m=(m^=C=(65535&(C=(C=(65535&C)*w+(((C>>>16)*w&65535)<<16)&4294967295)<<15|C>>>17))*A+(((C>>>16)*A&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(C=0,u){case 3:C^=(255&c.charCodeAt(M+2))<<16;case 2:C^=(255&c.charCodeAt(M+1))<<8;case 1:m^=C=(65535&(C=(C=(65535&(C^=255&c.charCodeAt(M)))*w+(((C>>>16)*w&65535)<<16)&4294967295)<<15|C>>>17))*A+(((C>>>16)*A&65535)<<16)&4294967295}return m^=c.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0};var Oi=Or.exports,Xn={exports:{}};Xn.exports=function(c,s){for(var u,f=c.length,m=s^f,b=0;f>=4;)u=1540483477*(65535&(u=255&c.charCodeAt(b)|(255&c.charCodeAt(++b))<<8|(255&c.charCodeAt(++b))<<16|(255&c.charCodeAt(++b))<<24))+((1540483477*(u>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++b;switch(f){case 3:m^=(255&c.charCodeAt(b+2))<<16;case 2:m^=(255&c.charCodeAt(b+1))<<8;case 1:m=1540483477*(65535&(m^=255&c.charCodeAt(b)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};var mr=Oi,Hs=Xn.exports;hn.exports=mr,hn.exports.murmur3=mr,hn.exports.murmur2=Hs;var gs=_(hn.exports);class Ws{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,u,f,m){this.ids.push(ll(s)),this.positions.push(u,f,m)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=ll(s);let f=0,m=this.ids.length-1;for(;f<m;){const w=f+m>>1;this.ids[w]>=u?m=w:f=w+1}const b=[];for(;this.ids[f]===u;)b.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return b}static serialize(s,u){const f=new Float64Array(s.ids),m=new Uint32Array(s.positions);return Wo(f,m,0,f.length-1),u&&u.push(f.buffer,m.buffer),{ids:f,positions:m}}static deserialize(s){const u=new Ws;return u.ids=s.ids,u.positions=s.positions,u.indexed=!0,u}}function ll(c){const s=+c;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:gs(String(c))}function Wo(c,s,u,f){for(;u<f;){const m=c[u+f>>1];let b=u-1,w=f+1;for(;;){do b++;while(c[b]<m);do w--;while(c[w]>m);if(b>=w)break;go(c,b,w),go(s,3*b,3*w),go(s,3*b+1,3*w+1),go(s,3*b+2,3*w+2)}w-u<f-w?(Wo(c,s,u,w),u=w+1):(Wo(c,s,w+1,f),f=w)}}function go(c,s,u){const f=c[s];c[s]=c[u],c[u]=f}rt("FeaturePositionMap",Ws);class ti{constructor(s,u){this.gl=s.gl,this.location=u}}class vi extends ti{constructor(s,u){super(s,u),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Hi extends ti{constructor(s,u){super(s,u),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class cl extends ti{constructor(s,u){super(s,u),this.current=wt.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const xi=new Float32Array(16);function ui(c){return[Nt(255*c.r,255*c.g),Nt(255*c.b,255*c.a)]}class Wi{constructor(s,u,f){this.value=s,this.uniformNames=u.map(m=>`u_${m}`),this.type=f}setUniform(s,u,f){s.set(f.constantOr(this.value))}getBinding(s,u,f){return this.type==="color"?new cl(s,u):new vi(s,u)}}class Dn{constructor(s,u){this.uniformNames=u.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=s.tlbr}setUniform(s,u,f,m){const b=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&s.set(b)}getBinding(s,u,f){return f.substr(0,9)==="u_pattern"?new Hi(s,u):new vi(s,u)}}class _o{constructor(s,u,f,m){this.expression=s,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(b=>({name:`a_${b}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(s,u,f,m,b){const w=this.paintVertexArray.length,A=this.expression.evaluate(new In(0),u,{},m,[],b);this.paintVertexArray.resize(s),this._setPaintValue(w,s,A)}updatePaintArray(s,u,f,m){const b=this.expression.evaluate({zoom:0},f,m);this._setPaintValue(s,u,b)}_setPaintValue(s,u,f){if(this.type==="color"){const m=ui(f);for(let b=s;b<u;b++)this.paintVertexArray.emplace(b,m[0],m[1])}else{for(let m=s;m<u;m++)this.paintVertexArray.emplace(m,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _s{constructor(s,u,f,m,b,w){this.expression=s,this.uniformNames=u.map(A=>`u_${A}_t`),this.type=f,this.useIntegerZoom=m,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=u.map(A=>({name:`a_${A}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(s,u,f,m,b){const w=this.expression.evaluate(new In(this.zoom),u,{},m,[],b),A=this.expression.evaluate(new In(this.zoom+1),u,{},m,[],b),C=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(C,s,w,A)}updatePaintArray(s,u,f,m){const b=this.expression.evaluate({zoom:this.zoom},f,m),w=this.expression.evaluate({zoom:this.zoom+1},f,m);this._setPaintValue(s,u,b,w)}_setPaintValue(s,u,f,m){if(this.type==="color"){const b=ui(f),w=ui(m);for(let A=s;A<u;A++)this.paintVertexArray.emplace(A,b[0],b[1],w[0],w[1])}else{for(let b=s;b<u;b++)this.paintVertexArray.emplace(b,f,m);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(m))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,u){const f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,m=j(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);s.set(m)}getBinding(s,u,f){return new vi(s,u)}}class qo{constructor(s,u,f,m,b,w){this.expression=s,this.type=u,this.useIntegerZoom=f,this.zoom=m,this.layerId=w,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(s,u,f){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(m,s,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(s,u,f,m,b){this._setPaintValues(s,u,f.patterns&&f.patterns[this.layerId],b)}_setPaintValues(s,u,f,m){if(!m||!f)return;const{min:b,mid:w,max:A}=f,C=m[b],M=m[w],O=m[A];if(C&&M&&O)for(let k=s;k<u;k++)this.zoomInPaintVertexArray.emplace(k,M.tl[0],M.tl[1],M.br[0],M.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],M.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,M.tl[0],M.tl[1],M.br[0],M.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],M.pixelRatio,O.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,Rn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,Rn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class $p{constructor(s,u,f){this.binders={},this._buffers=[];const m=[];for(const b in s.paint._values){if(!f(b))continue;const w=s.paint.get(b);if(!(w instanceof ms&&rl(w.property.specification)))continue;const A=fy(b,s.type),C=w.value,M=w.property.specification.type,O=w.property.useIntegerZoom,k=w.property.specification["property-type"],U=k==="cross-faded"||k==="cross-faded-data-driven";if(C.kind==="constant")this.binders[b]=U?new Dn(C.value,A):new Wi(C.value,A,M),m.push(`/u_${b}`);else if(C.kind==="source"||U){const q=Aa(b,M,"source");this.binders[b]=U?new qo(C,M,O,u,q,s.id):new _o(C,A,M,q),m.push(`/a_${b}`)}else{const q=Aa(b,M,"composite");this.binders[b]=new _s(C,A,M,O,u,q),m.push(`/z_${b}`)}}this.cacheKey=m.sort().join("")}getMaxValue(s){const u=this.binders[s];return u instanceof _o||u instanceof _s?u.maxValue:0}populatePaintArrays(s,u,f,m,b){for(const w in this.binders){const A=this.binders[w];(A instanceof _o||A instanceof _s||A instanceof qo)&&A.populatePaintArray(s,u,f,m,b)}}setConstantPatternPositions(s,u){for(const f in this.binders){const m=this.binders[f];m instanceof Dn&&m.setConstantPatternPositions(s,u)}}updatePaintArrays(s,u,f,m,b){let w=!1;for(const A in s){const C=u.getPositions(A);for(const M of C){const O=f.feature(M.index);for(const k in this.binders){const U=this.binders[k];if((U instanceof _o||U instanceof _s||U instanceof qo)&&U.expression.isStateDependent===!0){const q=m.paint.get(k);U.expression=q.value,U.updatePaintArray(M.start,M.end,O,s[A],b),w=!0}}}}return w}defines(){const s=[];for(const u in this.binders){const f=this.binders[u];(f instanceof Wi||f instanceof Dn)&&s.push(...f.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return s}getBinderAttributes(){const s=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof _o||f instanceof _s)for(let m=0;m<f.paintVertexAttributes.length;m++)s.push(f.paintVertexAttributes[m].name);else if(f instanceof qo)for(let m=0;m<Rn.members.length;m++)s.push(Rn.members[m].name)}return s}getBinderUniforms(){const s=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Wi||f instanceof Dn||f instanceof _s)for(const m of f.uniformNames)s.push(m)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,u){const f=[];for(const m in this.binders){const b=this.binders[m];if(b instanceof Wi||b instanceof Dn||b instanceof _s){for(const w of b.uniformNames)if(u[w]){const A=b.getBinding(s,u[w],w);f.push({name:w,property:m,binding:A})}}}return f}setUniforms(s,u,f,m){for(const{name:b,property:w,binding:A}of u)this.binders[w].setUniform(A,m,f.get(w),b)}updatePaintBuffers(s){this._buffers=[];for(const u in this.binders){const f=this.binders[u];if(s&&f instanceof qo){const m=s.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(f instanceof _o||f instanceof _s)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(s){for(const u in this.binders){const f=this.binders[u];(f instanceof _o||f instanceof _s||f instanceof qo)&&f.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const u=this.binders[s];(u instanceof _o||u instanceof _s||u instanceof qo)&&u.destroy()}}}class wa{constructor(s,u,f=()=>!0){this.programConfigurations={};for(const m of s)this.programConfigurations[m.id]=new $p(m,u,f);this.needsUpload=!1,this._featureMap=new Ws,this._bufferOffset=0}populatePaintArrays(s,u,f,m,b,w){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(s,u,m,b,w);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,u,f,m){for(const b of f)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(s,this._featureMap,u,b,m)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function fy(c,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${s}-`,"").replace(/-/g,"_")]}function Aa(c,s,u){const f={color:{source:wc,composite:x},number:{source:y,composite:wc}},m=function(b){return{"line-pattern":{source:Ge,composite:Ge},"fill-pattern":{source:Ge,composite:Ge},"fill-extrusion-pattern":{source:Ge,composite:Ge}}[b]}(c);return m&&m[u]||f[s][u]}rt("ConstantBinder",Wi),rt("CrossFadedConstantBinder",Dn),rt("SourceExpressionBinder",_o),rt("CrossFadedCompositeBinder",qo),rt("CompositeExpressionBinder",_s),rt("ProgramConfiguration",$p,{omit:["_buffers"]}),rt("ProgramConfigurationSet",wa);const Nn=8192,Bu=Math.pow(2,14)-1,Pd=-Bu-1;function yo(c){const s=Nn/c.extent,u=c.loadGeometry();for(let f=0;f<u.length;f++){const m=u[f];for(let b=0;b<m.length;b++){const w=m[b],A=Math.round(w.x*s),C=Math.round(w.y*s);w.x=j(A,Pd,Bu),w.y=j(C,Pd,Bu),(A<w.x||A>w.x+1||C<w.y||C>w.y+1)&&Ue("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Xo(c,s){return{type:c.type,id:c.id,properties:c.properties,geometry:s?yo(c):[]}}function ul(c,s,u,f,m){c.emplaceBack(2*s+(f+1)/2,2*u+(m+1)/2)}class py{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new le,this.indexArray=new yt,this.segments=new xt,this.programConfigurations=new wa(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){const m=this.layers[0],b=[];let w=null,A=!1;m.type==="circle"&&(w=m.layout.get("circle-sort-key"),A=!w.isConstant());for(const{feature:C,id:M,index:O,sourceLayerIndex:k}of s){const U=this.layers[0]._featureFilter.needGeometry,q=Xo(C,U);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),q,f))continue;const X=A?w.evaluate(q,{},f):void 0,te={id:M,properties:C.properties,type:C.type,sourceLayerIndex:k,index:O,geometry:U?q.geometry:yo(C),patterns:{},sortKey:X};b.push(te)}A&&b.sort((C,M)=>C.sortKey-M.sortKey);for(const C of b){const{geometry:M,index:O,sourceLayerIndex:k}=C,U=s[O].feature;this.addFeature(C,M,O,f),u.featureIndex.insert(U,M,O,k,this.index)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,zt),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,u,f,m){for(const b of u)for(const w of b){const A=w.x,C=w.y;if(A<0||A>=Nn||C<0||C>=Nn)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),O=M.vertexLength;ul(this.layoutVertexArray,A,C,-1,-1),ul(this.layoutVertexArray,A,C,1,-1),ul(this.layoutVertexArray,A,C,1,1),ul(this.layoutVertexArray,A,C,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+3,O+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{},m)}}function xw(c,s){for(let u=0;u<c.length;u++)if(Lu(s,c[u]))return!0;for(let u=0;u<s.length;u++)if(Lu(c,s[u]))return!0;return!!my(c,s)}function tR(c,s,u){return!!Lu(c,s)||!!gy(s,c,u)}function bw(c,s){if(c.length===1)return Aw(s,c[0]);for(let u=0;u<s.length;u++){const f=s[u];for(let m=0;m<f.length;m++)if(Lu(c,f[m]))return!0}for(let u=0;u<c.length;u++)if(Aw(s,c[u]))return!0;for(let u=0;u<s.length;u++)if(my(c,s[u]))return!0;return!1}function nR(c,s,u){if(c.length>1){if(my(c,s))return!0;for(let f=0;f<s.length;f++)if(gy(s[f],c,u))return!0}for(let f=0;f<c.length;f++)if(gy(c[f],s,u))return!0;return!1}function my(c,s){if(c.length===0||s.length===0)return!1;for(let u=0;u<c.length-1;u++){const f=c[u],m=c[u+1];for(let b=0;b<s.length-1;b++)if(iR(f,m,s[b],s[b+1]))return!0}return!1}function iR(c,s,u,f){return Me(c,u,f)!==Me(s,u,f)&&Me(c,s,u)!==Me(c,s,f)}function gy(c,s,u){const f=u*u;if(s.length===1)return c.distSqr(s[0])<f;for(let m=1;m<s.length;m++)if(ww(c,s[m-1],s[m])<f)return!0;return!1}function ww(c,s,u){const f=s.distSqr(u);if(f===0)return c.distSqr(s);const m=((c.x-s.x)*(u.x-s.x)+(c.y-s.y)*(u.y-s.y))/f;return c.distSqr(m<0?s:m>1?u:u.sub(s)._mult(m)._add(s))}function Aw(c,s){let u,f,m,b=!1;for(let w=0;w<c.length;w++){u=c[w];for(let A=0,C=u.length-1;A<u.length;C=A++)f=u[A],m=u[C],f.y>s.y!=m.y>s.y&&s.x<(m.x-f.x)*(s.y-f.y)/(m.y-f.y)+f.x&&(b=!b)}return b}function Lu(c,s){let u=!1;for(let f=0,m=c.length-1;f<c.length;m=f++){const b=c[f],w=c[m];b.y>s.y!=w.y>s.y&&s.x<(w.x-b.x)*(s.y-b.y)/(w.y-b.y)+b.x&&(u=!u)}return u}function rR(c,s,u){const f=u[0],m=u[2];if(c.x<f.x&&s.x<f.x||c.x>m.x&&s.x>m.x||c.y<f.y&&s.y<f.y||c.y>m.y&&s.y>m.y)return!1;const b=Me(c,s,u[0]);return b!==Me(c,s,u[1])||b!==Me(c,s,u[2])||b!==Me(c,s,u[3])}function Md(c,s,u){const f=s.paint.get(c).value;return f.kind==="constant"?f.value:u.programConfigurations.get(s.id).getMaxValue(c)}function Zp(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Jp(c,s,u,f,m){if(!s[0]&&!s[1])return c;const b=I.convert(s)._mult(m);u==="viewport"&&b._rotate(-f);const w=[];for(let A=0;A<c.length;A++)w.push(c[A].sub(b));return w}let Ew,Tw;rt("CircleBucket",py,{omit:["layers"]});var sR={get paint(){return Tw=Tw||new pr({"circle-radius":new Tt(Be.paint_circle["circle-radius"]),"circle-color":new Tt(Be.paint_circle["circle-color"]),"circle-blur":new Tt(Be.paint_circle["circle-blur"]),"circle-opacity":new Tt(Be.paint_circle["circle-opacity"]),"circle-translate":new mt(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new mt(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mt(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mt(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tt(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tt(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tt(Be.paint_circle["circle-stroke-opacity"])})},get layout(){return Ew=Ew||new pr({"circle-sort-key":new Tt(Be.layout_circle["circle-sort-key"])})}},gr=1e-6,Ru=typeof Float32Array<"u"?Float32Array:Array;function _y(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Sw(c,s,u){var f=s[0],m=s[1],b=s[2],w=s[3],A=s[4],C=s[5],M=s[6],O=s[7],k=s[8],U=s[9],q=s[10],X=s[11],te=s[12],se=s[13],ce=s[14],xe=s[15],me=u[0],we=u[1],Se=u[2],Fe=u[3];return c[0]=me*f+we*A+Se*k+Fe*te,c[1]=me*m+we*C+Se*U+Fe*se,c[2]=me*b+we*M+Se*q+Fe*ce,c[3]=me*w+we*O+Se*X+Fe*xe,c[4]=(me=u[4])*f+(we=u[5])*A+(Se=u[6])*k+(Fe=u[7])*te,c[5]=me*m+we*C+Se*U+Fe*se,c[6]=me*b+we*M+Se*q+Fe*ce,c[7]=me*w+we*O+Se*X+Fe*xe,c[8]=(me=u[8])*f+(we=u[9])*A+(Se=u[10])*k+(Fe=u[11])*te,c[9]=me*m+we*C+Se*U+Fe*se,c[10]=me*b+we*M+Se*q+Fe*ce,c[11]=me*w+we*O+Se*X+Fe*xe,c[12]=(me=u[12])*f+(we=u[13])*A+(Se=u[14])*k+(Fe=u[15])*te,c[13]=me*m+we*C+Se*U+Fe*se,c[14]=me*b+we*M+Se*q+Fe*ce,c[15]=me*w+we*O+Se*X+Fe*xe,c}Math.hypot||(Math.hypot=function(){for(var c=0,s=arguments.length;s--;)c+=arguments[s]*arguments[s];return Math.sqrt(c)});var Bd,oR=Sw;function Kp(c,s,u){var f=s[0],m=s[1],b=s[2],w=s[3];return c[0]=u[0]*f+u[4]*m+u[8]*b+u[12]*w,c[1]=u[1]*f+u[5]*m+u[9]*b+u[13]*w,c[2]=u[2]*f+u[6]*m+u[10]*b+u[14]*w,c[3]=u[3]*f+u[7]*m+u[11]*b+u[15]*w,c}Bd=new Ru(4),Ru!=Float32Array&&(Bd[0]=0,Bd[1]=0,Bd[2]=0,Bd[3]=0);class aR extends js{constructor(s){super(s,sR)}createBucket(s){return new py(s)}queryRadius(s){const u=s;return Md("circle-radius",this,u)+Md("circle-stroke-width",this,u)+Zp(this.paint.get("circle-translate"))}queryIntersectsFeature(s,u,f,m,b,w,A,C){const M=Jp(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,A),O=this.paint.get("circle-radius").evaluate(u,f)+this.paint.get("circle-stroke-width").evaluate(u,f),k=this.paint.get("circle-pitch-alignment")==="map",U=k?M:function(X,te){return X.map(se=>Cw(se,te))}(M,C),q=k?O*A:O;for(const X of m)for(const te of X){const se=k?te:Cw(te,C);let ce=q;const xe=Kp([],[te.x,te.y,0,1],C);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ce*=xe[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ce*=w.cameraToCenterDistance/xe[3]),tR(U,se,ce))return!0}return!1}}function Cw(c,s){const u=Kp([],[c.x,c.y,0,1],s);return new I(u[0]/u[3],u[1]/u[3])}class Iw extends py{}let Pw;rt("HeatmapBucket",Iw,{omit:["layers"]});var lR={get paint(){return Pw=Pw||new pr({"heatmap-radius":new Tt(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tt(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mt(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ed(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mt(Be.paint_heatmap["heatmap-opacity"])})}};function yy(c,{width:s,height:u},f,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==s*u*f)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${s*u*f}`)}else m=new Uint8Array(s*u*f);return c.width=s,c.height=u,c.data=m,c}function Mw(c,{width:s,height:u},f){if(s===c.width&&u===c.height)return;const m=yy({},{width:s,height:u},f);vy(c,m,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,s),height:Math.min(c.height,u)},f),c.width=s,c.height=u,c.data=m.data}function vy(c,s,u,f,m,b){if(m.width===0||m.height===0)return s;if(m.width>c.width||m.height>c.height||u.x>c.width-m.width||u.y>c.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>s.width||m.height>s.height||f.x>s.width-m.width||f.y>s.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const w=c.data,A=s.data;if(w===A)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<m.height;C++){const M=((u.y+C)*c.width+u.x)*b,O=((f.y+C)*s.width+f.x)*b;for(let k=0;k<m.width*b;k++)A[O+k]=w[M+k]}return s}class Ld{constructor(s,u){yy(this,s,1,u)}resize(s){Mw(this,s,1)}clone(){return new Ld({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,f,m,b){vy(s,u,f,m,b,1)}}class ys{constructor(s,u){yy(this,s,4,u)}resize(s){Mw(this,s,4)}replace(s,u){u?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new ys({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,f,m,b){vy(s,u,f,m,b,4)}}function Bw(c){const s={},u=c.resolution||256,f=c.clips?c.clips.length:1,m=c.image||new ys({width:u,height:f});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const b=(w,A,C)=>{s[c.evaluationKey]=C;const M=c.expression.evaluate(s);m.data[w+A+0]=Math.floor(255*M.r/M.a),m.data[w+A+1]=Math.floor(255*M.g/M.a),m.data[w+A+2]=Math.floor(255*M.b/M.a),m.data[w+A+3]=Math.floor(255*M.a)};if(c.clips)for(let w=0,A=0;w<f;++w,A+=4*u)for(let C=0,M=0;C<u;C++,M+=4){const O=C/(u-1),{start:k,end:U}=c.clips[w];b(A,M,k*(1-O)+U*O)}else for(let w=0,A=0;w<u;w++,A+=4)b(0,A,w/(u-1));return m}rt("AlphaImage",Ld),rt("RGBAImage",ys);class cR extends js{createBucket(s){return new Iw(s)}constructor(s){super(s,lR),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Bw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Lw;var uR={get paint(){return Lw=Lw||new pr({"hillshade-illumination-direction":new mt(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new mt(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mt(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mt(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mt(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mt(Be.paint_hillshade["hillshade-accent-color"])})}};class hR extends js{constructor(s){super(s,uR)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const dR=ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:fR}=dR;var xy={exports:{}};function Yp(c,s,u){u=u||2;var f,m,b,w,A,C,M,O=s&&s.length,k=O?s[0]*u:c.length,U=Rw(c,0,k,u,!0),q=[];if(!U||U.next===U.prev)return q;if(O&&(U=function(te,se,ce,xe){var me,we,Se,Fe=[];for(me=0,we=se.length;me<we;me++)(Se=Rw(te,se[me]*xe,me<we-1?se[me+1]*xe:te.length,xe,!1))===Se.next&&(Se.steiner=!0),Fe.push(bR(Se));for(Fe.sort(yR),me=0;me<Fe.length;me++)ce=vR(Fe[me],ce);return ce}(c,s,U,u)),c.length>80*u){f=b=c[0],m=w=c[1];for(var X=u;X<k;X+=u)(A=c[X])<f&&(f=A),(C=c[X+1])<m&&(m=C),A>b&&(b=A),C>w&&(w=C);M=(M=Math.max(b-f,w-m))!==0?32767/M:0}return Rd(U,q,u,f,m,M,0),q}function Rw(c,s,u,f,m){var b,w;if(m===Ay(c,s,u,f)>0)for(b=s;b<u;b+=f)w=Fw(b,c[b],c[b+1],w);else for(b=u-f;b>=s;b-=f)w=Fw(b,c[b],c[b+1],w);return w&&Qp(w,w.next)&&(Od(w),w=w.next),w}function Ac(c,s){if(!c)return c;s||(s=c);var u,f=c;do if(u=!1,f.steiner||!Qp(f,f.next)&&ni(f.prev,f,f.next)!==0)f=f.next;else{if(Od(f),(f=s=f.prev)===f.next)break;u=!0}while(u||f!==s);return s}function Rd(c,s,u,f,m,b,w){if(c){!w&&b&&function(O,k,U,q){var X=O;do X.z===0&&(X.z=by(X.x,X.y,k,U,q)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==O);X.prevZ.nextZ=null,X.prevZ=null,function(te){var se,ce,xe,me,we,Se,Fe,nt,dt=1;do{for(ce=te,te=null,we=null,Se=0;ce;){for(Se++,xe=ce,Fe=0,se=0;se<dt&&(Fe++,xe=xe.nextZ);se++);for(nt=dt;Fe>0||nt>0&&xe;)Fe!==0&&(nt===0||!xe||ce.z<=xe.z)?(me=ce,ce=ce.nextZ,Fe--):(me=xe,xe=xe.nextZ,nt--),we?we.nextZ=me:te=me,me.prevZ=we,we=me;ce=xe}we.nextZ=null,dt*=2}while(Se>1)}(X)}(c,f,m,b);for(var A,C,M=c;c.prev!==c.next;)if(A=c.prev,C=c.next,b?mR(c,f,m,b):pR(c))s.push(A.i/u|0),s.push(c.i/u|0),s.push(C.i/u|0),Od(c),c=C.next,M=C.next;else if((c=C)===M){w?w===1?Rd(c=gR(Ac(c),s,u),s,u,f,m,b,2):w===2&&_R(c,s,u,f,m,b):Rd(Ac(c),s,u,f,m,b,1);break}}}function pR(c){var s=c.prev,u=c,f=c.next;if(ni(s,u,f)>=0)return!1;for(var m=s.x,b=u.x,w=f.x,A=s.y,C=u.y,M=f.y,O=m<b?m<w?m:w:b<w?b:w,k=A<C?A<M?A:M:C<M?C:M,U=m>b?m>w?m:w:b>w?b:w,q=A>C?A>M?A:M:C>M?C:M,X=f.next;X!==s;){if(X.x>=O&&X.x<=U&&X.y>=k&&X.y<=q&&Du(m,A,b,C,w,M,X.x,X.y)&&ni(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function mR(c,s,u,f){var m=c.prev,b=c,w=c.next;if(ni(m,b,w)>=0)return!1;for(var A=m.x,C=b.x,M=w.x,O=m.y,k=b.y,U=w.y,q=A<C?A<M?A:M:C<M?C:M,X=O<k?O<U?O:U:k<U?k:U,te=A>C?A>M?A:M:C>M?C:M,se=O>k?O>U?O:U:k>U?k:U,ce=by(q,X,s,u,f),xe=by(te,se,s,u,f),me=c.prevZ,we=c.nextZ;me&&me.z>=ce&&we&&we.z<=xe;){if(me.x>=q&&me.x<=te&&me.y>=X&&me.y<=se&&me!==m&&me!==w&&Du(A,O,C,k,M,U,me.x,me.y)&&ni(me.prev,me,me.next)>=0||(me=me.prevZ,we.x>=q&&we.x<=te&&we.y>=X&&we.y<=se&&we!==m&&we!==w&&Du(A,O,C,k,M,U,we.x,we.y)&&ni(we.prev,we,we.next)>=0))return!1;we=we.nextZ}for(;me&&me.z>=ce;){if(me.x>=q&&me.x<=te&&me.y>=X&&me.y<=se&&me!==m&&me!==w&&Du(A,O,C,k,M,U,me.x,me.y)&&ni(me.prev,me,me.next)>=0)return!1;me=me.prevZ}for(;we&&we.z<=xe;){if(we.x>=q&&we.x<=te&&we.y>=X&&we.y<=se&&we!==m&&we!==w&&Du(A,O,C,k,M,U,we.x,we.y)&&ni(we.prev,we,we.next)>=0)return!1;we=we.nextZ}return!0}function gR(c,s,u){var f=c;do{var m=f.prev,b=f.next.next;!Qp(m,b)&&Dw(m,f,f.next,b)&&Dd(m,b)&&Dd(b,m)&&(s.push(m.i/u|0),s.push(f.i/u|0),s.push(b.i/u|0),Od(f),Od(f.next),f=c=b),f=f.next}while(f!==c);return Ac(f)}function _R(c,s,u,f,m,b){var w=c;do{for(var A=w.next.next;A!==w.prev;){if(w.i!==A.i&&wR(w,A)){var C=Ow(w,A);return w=Ac(w,w.next),C=Ac(C,C.next),Rd(w,s,u,f,m,b,0),void Rd(C,s,u,f,m,b,0)}A=A.next}w=w.next}while(w!==c)}function yR(c,s){return c.x-s.x}function vR(c,s){var u=function(m,b){var w,A=b,C=m.x,M=m.y,O=-1/0;do{if(M<=A.y&&M>=A.next.y&&A.next.y!==A.y){var k=A.x+(M-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(k<=C&&k>O&&(O=k,w=A.x<A.next.x?A:A.next,k===C))return w}A=A.next}while(A!==b);if(!w)return null;var U,q=w,X=w.x,te=w.y,se=1/0;A=w;do C>=A.x&&A.x>=X&&C!==A.x&&Du(M<te?C:O,M,X,te,M<te?O:C,M,A.x,A.y)&&(U=Math.abs(M-A.y)/(C-A.x),Dd(A,m)&&(U<se||U===se&&(A.x>w.x||A.x===w.x&&xR(w,A)))&&(w=A,se=U)),A=A.next;while(A!==q);return w}(c,s);if(!u)return s;var f=Ow(u,c);return Ac(f,f.next),Ac(u,u.next)}function xR(c,s){return ni(c.prev,c,s.prev)<0&&ni(s.next,c,c.next)<0}function by(c,s,u,f,m){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-u)*m|0)|c<<8))|c<<4))|c<<2))|c<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-f)*m|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function bR(c){var s=c,u=c;do(s.x<u.x||s.x===u.x&&s.y<u.y)&&(u=s),s=s.next;while(s!==c);return u}function Du(c,s,u,f,m,b,w,A){return(m-w)*(s-A)>=(c-w)*(b-A)&&(c-w)*(f-A)>=(u-w)*(s-A)&&(u-w)*(b-A)>=(m-w)*(f-A)}function wR(c,s){return c.next.i!==s.i&&c.prev.i!==s.i&&!function(u,f){var m=u;do{if(m.i!==u.i&&m.next.i!==u.i&&m.i!==f.i&&m.next.i!==f.i&&Dw(m,m.next,u,f))return!0;m=m.next}while(m!==u);return!1}(c,s)&&(Dd(c,s)&&Dd(s,c)&&function(u,f){var m=u,b=!1,w=(u.x+f.x)/2,A=(u.y+f.y)/2;do m.y>A!=m.next.y>A&&m.next.y!==m.y&&w<(m.next.x-m.x)*(A-m.y)/(m.next.y-m.y)+m.x&&(b=!b),m=m.next;while(m!==u);return b}(c,s)&&(ni(c.prev,c,s.prev)||ni(c,s.prev,s))||Qp(c,s)&&ni(c.prev,c,c.next)>0&&ni(s.prev,s,s.next)>0)}function ni(c,s,u){return(s.y-c.y)*(u.x-s.x)-(s.x-c.x)*(u.y-s.y)}function Qp(c,s){return c.x===s.x&&c.y===s.y}function Dw(c,s,u,f){var m=tm(ni(c,s,u)),b=tm(ni(c,s,f)),w=tm(ni(u,f,c)),A=tm(ni(u,f,s));return m!==b&&w!==A||!(m!==0||!em(c,u,s))||!(b!==0||!em(c,f,s))||!(w!==0||!em(u,c,f))||!(A!==0||!em(u,s,f))}function em(c,s,u){return s.x<=Math.max(c.x,u.x)&&s.x>=Math.min(c.x,u.x)&&s.y<=Math.max(c.y,u.y)&&s.y>=Math.min(c.y,u.y)}function tm(c){return c>0?1:c<0?-1:0}function Dd(c,s){return ni(c.prev,c,c.next)<0?ni(c,s,c.next)>=0&&ni(c,c.prev,s)>=0:ni(c,s,c.prev)<0||ni(c,c.next,s)<0}function Ow(c,s){var u=new wy(c.i,c.x,c.y),f=new wy(s.i,s.x,s.y),m=c.next,b=s.prev;return c.next=s,s.prev=c,u.next=m,m.prev=u,f.next=u,u.prev=f,b.next=f,f.prev=b,f}function Fw(c,s,u,f){var m=new wy(c,s,u);return f?(m.next=f.next,m.prev=f,f.next.prev=m,f.next=m):(m.prev=m,m.next=m),m}function Od(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function wy(c,s,u){this.i=c,this.x=s,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ay(c,s,u,f){for(var m=0,b=s,w=u-f;b<u;b+=f)m+=(c[w]-c[b])*(c[b+1]+c[w+1]),w=b;return m}xy.exports=Yp,xy.exports.default=Yp,Yp.deviation=function(c,s,u,f){var m=s&&s.length,b=Math.abs(Ay(c,0,m?s[0]*u:c.length,u));if(m)for(var w=0,A=s.length;w<A;w++)b-=Math.abs(Ay(c,s[w]*u,w<A-1?s[w+1]*u:c.length,u));var C=0;for(w=0;w<f.length;w+=3){var M=f[w]*u,O=f[w+1]*u,k=f[w+2]*u;C+=Math.abs((c[M]-c[k])*(c[O+1]-c[M+1])-(c[M]-c[O])*(c[k+1]-c[M+1]))}return b===0&&C===0?0:Math.abs((C-b)/b)},Yp.flatten=function(c){for(var s=c[0][0].length,u={vertices:[],holes:[],dimensions:s},f=0,m=0;m<c.length;m++){for(var b=0;b<c[m].length;b++)for(var w=0;w<s;w++)u.vertices.push(c[m][b][w]);m>0&&u.holes.push(f+=c[m-1].length)}return u};var kw=_(xy.exports);function AR(c,s,u,f,m){zw(c,s,u||0,f||c.length-1,m||ER)}function zw(c,s,u,f,m){for(;f>u;){if(f-u>600){var b=f-u+1,w=s-u+1,A=Math.log(b),C=.5*Math.exp(2*A/3),M=.5*Math.sqrt(A*C*(b-C)/b)*(w-b/2<0?-1:1);zw(c,s,Math.max(u,Math.floor(s-w*C/b+M)),Math.min(f,Math.floor(s+(b-w)*C/b+M)),m)}var O=c[s],k=u,U=f;for(Fd(c,u,s),m(c[f],O)>0&&Fd(c,u,f);k<U;){for(Fd(c,k,U),k++,U--;m(c[k],O)<0;)k++;for(;m(c[U],O)>0;)U--}m(c[u],O)===0?Fd(c,u,U):Fd(c,++U,f),U<=s&&(u=U+1),s<=U&&(f=U-1)}}function Fd(c,s,u){var f=c[s];c[s]=c[u],c[u]=f}function ER(c,s){return c<s?-1:c>s?1:0}function Ey(c,s){const u=c.length;if(u<=1)return[c];const f=[];let m,b;for(let w=0;w<u;w++){const A=ut(c[w]);A!==0&&(c[w].area=Math.abs(A),b===void 0&&(b=A<0),b===A<0?(m&&f.push(m),m=[c[w]]):m.push(c[w]))}if(m&&f.push(m),s>1)for(let w=0;w<f.length;w++)f[w].length<=s||(AR(f[w],s,1,f[w].length-1,TR),f[w]=f[w].slice(0,s));return f}function TR(c,s){return s.area-c.area}function Ty(c,s,u){const f=u.patternDependencies;let m=!1;for(const b of s){const w=b.paint.get(`${c}-pattern`);w.isConstant()||(m=!0);const A=w.constantOr(null);A&&(m=!0,f[A.to]=!0,f[A.from]=!0)}return m}function Sy(c,s,u,f,m){const b=m.patternDependencies;for(const w of s){const A=w.paint.get(`${c}-pattern`).value;if(A.kind!=="constant"){let C=A.evaluate({zoom:f-1},u,{},m.availableImages),M=A.evaluate({zoom:f},u,{},m.availableImages),O=A.evaluate({zoom:f+1},u,{},m.availableImages);C=C&&C.name?C.name:C,M=M&&M.name?M.name:M,O=O&&O.name?O.name:O,b[C]=!0,b[M]=!0,b[O]=!0,u.patterns[w.id]={min:C,mid:M,max:O}}}return u}class Cy{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ye,this.indexArray=new yt,this.indexArray2=new ct,this.programConfigurations=new wa(s.layers,s.zoom),this.segments=new xt,this.segments2=new xt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){this.hasPattern=Ty("fill",this.layers,u);const m=this.layers[0].layout.get("fill-sort-key"),b=!m.isConstant(),w=[];for(const{feature:A,id:C,index:M,sourceLayerIndex:O}of s){const k=this.layers[0]._featureFilter.needGeometry,U=Xo(A,k);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),U,f))continue;const q=b?m.evaluate(U,{},f,u.availableImages):void 0,X={id:C,properties:A.properties,type:A.type,sourceLayerIndex:O,index:M,geometry:k?U.geometry:yo(A),patterns:{},sortKey:q};w.push(X)}b&&w.sort((A,C)=>A.sortKey-C.sortKey);for(const A of w){const{geometry:C,index:M,sourceLayerIndex:O}=A;if(this.hasPattern){const k=Sy("fill",this.layers,A,this.zoom,u);this.patternFeatures.push(k)}else this.addFeature(A,C,M,f,{});u.featureIndex.insert(s[M].feature,C,M,O,this.index)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}addFeatures(s,u,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,fR),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,u,f,m,b){for(const w of Ey(u,500)){let A=0;for(const q of w)A+=q.length;const C=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),M=C.vertexLength,O=[],k=[];for(const q of w){if(q.length===0)continue;q!==w[0]&&k.push(O.length/2);const X=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),te=X.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(te+q.length-1,te),O.push(q[0].x),O.push(q[0].y);for(let se=1;se<q.length;se++)this.layoutVertexArray.emplaceBack(q[se].x,q[se].y),this.indexArray2.emplaceBack(te+se-1,te+se),O.push(q[se].x),O.push(q[se].y);X.vertexLength+=q.length,X.primitiveLength+=q.length}const U=kw(O,k);for(let q=0;q<U.length;q+=3)this.indexArray.emplaceBack(M+U[q],M+U[q+1],M+U[q+2]);C.vertexLength+=A,C.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,b,m)}}let Nw,Uw;rt("FillBucket",Cy,{omit:["layers","patternFeatures"]});var SR={get paint(){return Uw=Uw||new pr({"fill-antialias":new mt(Be.paint_fill["fill-antialias"]),"fill-opacity":new Tt(Be.paint_fill["fill-opacity"]),"fill-color":new Tt(Be.paint_fill["fill-color"]),"fill-outline-color":new Tt(Be.paint_fill["fill-outline-color"]),"fill-translate":new mt(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new mt(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Su(Be.paint_fill["fill-pattern"])})},get layout(){return Nw=Nw||new pr({"fill-sort-key":new Tt(Be.layout_fill["fill-sort-key"])})}};class CR extends js{constructor(s){super(s,SR)}recalculate(s,u){super.recalculate(s,u);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new Cy(s)}queryRadius(){return Zp(this.paint.get("fill-translate"))}queryIntersectsFeature(s,u,f,m,b,w,A){return bw(Jp(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,A),m)}isTileClipped(){return!0}}const IR=ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),PR=ei([{name:"a_centroid",components:2,type:"Int16"}],4),{members:MR}=IR;var hl={},BR=v,Gw=Ou;function Ou(c,s,u,f,m){this.properties={},this.extent=u,this.type=0,this._pbf=c,this._geometry=-1,this._keys=f,this._values=m,c.readFields(LR,this,s)}function LR(c,s,u){c==1?s.id=u.readVarint():c==2?function(f,m){for(var b=f.readVarint()+f.pos;f.pos<b;){var w=m._keys[f.readVarint()],A=m._values[f.readVarint()];m.properties[w]=A}}(u,s):c==3?s.type=u.readVarint():c==4&&(s._geometry=u.pos)}function RR(c){for(var s,u,f=0,m=0,b=c.length,w=b-1;m<b;w=m++)f+=((u=c[w]).x-(s=c[m]).x)*(s.y+u.y);return f}Ou.types=["Unknown","Point","LineString","Polygon"],Ou.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var s,u=c.readVarint()+c.pos,f=1,m=0,b=0,w=0,A=[];c.pos<u;){if(m<=0){var C=c.readVarint();f=7&C,m=C>>3}if(m--,f===1||f===2)b+=c.readSVarint(),w+=c.readSVarint(),f===1&&(s&&A.push(s),s=[]),s.push(new BR(b,w));else{if(f!==7)throw new Error("unknown command "+f);s&&s.push(s[0].clone())}}return s&&A.push(s),A},Ou.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var s=c.readVarint()+c.pos,u=1,f=0,m=0,b=0,w=1/0,A=-1/0,C=1/0,M=-1/0;c.pos<s;){if(f<=0){var O=c.readVarint();u=7&O,f=O>>3}if(f--,u===1||u===2)(m+=c.readSVarint())<w&&(w=m),m>A&&(A=m),(b+=c.readSVarint())<C&&(C=b),b>M&&(M=b);else if(u!==7)throw new Error("unknown command "+u)}return[w,C,A,M]},Ou.prototype.toGeoJSON=function(c,s,u){var f,m,b=this.extent*Math.pow(2,u),w=this.extent*c,A=this.extent*s,C=this.loadGeometry(),M=Ou.types[this.type];function O(q){for(var X=0;X<q.length;X++){var te=q[X];q[X]=[360*(te.x+w)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(te.y+A)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(f=0;f<C.length;f++)k[f]=C[f][0];O(C=k);break;case 2:for(f=0;f<C.length;f++)O(C[f]);break;case 3:for(C=function(q){var X=q.length;if(X<=1)return[q];for(var te,se,ce=[],xe=0;xe<X;xe++){var me=RR(q[xe]);me!==0&&(se===void 0&&(se=me<0),se===me<0?(te&&ce.push(te),te=[q[xe]]):te.push(q[xe]))}return te&&ce.push(te),ce}(C),f=0;f<C.length;f++)for(m=0;m<C[f].length;m++)O(C[f][m])}C.length===1?C=C[0]:M="Multi"+M;var U={type:"Feature",geometry:{type:M,coordinates:C},properties:this.properties};return"id"in this&&(U.id=this.id),U};var DR=Gw,Vw=jw;function jw(c,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(OR,this,s),this.length=this._features.length}function OR(c,s,u){c===15?s.version=u.readVarint():c===1?s.name=u.readString():c===5?s.extent=u.readVarint():c===2?s._features.push(u.pos):c===3?s._keys.push(u.readString()):c===4&&s._values.push(function(f){for(var m=null,b=f.readVarint()+f.pos;f.pos<b;){var w=f.readVarint()>>3;m=w===1?f.readString():w===2?f.readFloat():w===3?f.readDouble():w===4?f.readVarint64():w===5?f.readVarint():w===6?f.readSVarint():w===7?f.readBoolean():null}return m}(u))}jw.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var s=this._pbf.readVarint()+this._pbf.pos;return new DR(this._pbf,s,this.extent,this._keys,this._values)};var FR=Vw;function kR(c,s,u){if(c===3){var f=new FR(u,u.readVarint()+u.pos);f.length&&(s[f.name]=f)}}hl.VectorTile=function(c,s){this.layers=c.readFields(kR,{},s)},hl.VectorTileFeature=Gw,hl.VectorTileLayer=Vw;const zR=hl.VectorTileFeature.types,Iy=Math.pow(2,13);function kd(c,s,u,f,m,b,w,A){c.emplaceBack(s,u,2*Math.floor(f*Iy)+w,m*Iy*2,b*Iy*2,Math.round(A))}class Py{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new Ce,this.centroidVertexArray=new Ae,this.indexArray=new yt,this.programConfigurations=new wa(s.layers,s.zoom),this.segments=new xt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){this.features=[],this.hasPattern=Ty("fill-extrusion",this.layers,u);for(const{feature:m,id:b,index:w,sourceLayerIndex:A}of s){const C=this.layers[0]._featureFilter.needGeometry,M=Xo(m,C);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),M,f))continue;const O={id:b,sourceLayerIndex:A,index:w,geometry:C?M.geometry:yo(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(Sy("fill-extrusion",this.layers,O,this.zoom,u)):this.addFeature(O,O.geometry,w,f,{}),u.featureIndex.insert(m,O.geometry,w,A,this.index,!0)}}addFeatures(s,u,f){for(const m of this.features){const{geometry:b}=m;this.addFeature(m,b,m.index,u,f)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,MR),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,PR.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,u,f,m,b){const w={x:0,y:0,vertexCount:0};for(const A of Ey(u,500)){let C=0;for(const X of A)C+=X.length;let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const X of A){if(X.length===0||UR(X))continue;let te=0;for(let se=0;se<X.length;se++){const ce=X[se];if(se>=1){const xe=X[se-1];if(!NR(ce,xe)){M.vertexLength+4>xt.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const me=ce.sub(xe)._perp()._unit(),we=xe.dist(ce);te+we>32768&&(te=0),kd(this.layoutVertexArray,ce.x,ce.y,me.x,me.y,0,0,te),kd(this.layoutVertexArray,ce.x,ce.y,me.x,me.y,0,1,te),w.x+=2*ce.x,w.y+=2*ce.y,w.vertexCount+=2,te+=we,kd(this.layoutVertexArray,xe.x,xe.y,me.x,me.y,0,0,te),kd(this.layoutVertexArray,xe.x,xe.y,me.x,me.y,0,1,te),w.x+=2*xe.x,w.y+=2*xe.y,w.vertexCount+=2;const Se=M.vertexLength;this.indexArray.emplaceBack(Se,Se+2,Se+1),this.indexArray.emplaceBack(Se+1,Se+2,Se+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+C>xt.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray)),zR[s.type]!=="Polygon")continue;const O=[],k=[],U=M.vertexLength;for(const X of A)if(X.length!==0){X!==A[0]&&k.push(O.length/2);for(let te=0;te<X.length;te++){const se=X[te];kd(this.layoutVertexArray,se.x,se.y,0,0,1,1,0),w.x+=se.x,w.y+=se.y,w.vertexCount+=1,O.push(se.x),O.push(se.y)}}const q=kw(O,k);for(let X=0;X<q.length;X+=3)this.indexArray.emplaceBack(U+q[X],U+q[X+2],U+q[X+1]);M.primitiveLength+=q.length/3,M.vertexLength+=C}for(let A=0;A<w.vertexCount;A++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,b,m)}}function NR(c,s){return c.x===s.x&&(c.x<0||c.x>Nn)||c.y===s.y&&(c.y<0||c.y>Nn)}function UR(c){return c.every(s=>s.x<0)||c.every(s=>s.x>Nn)||c.every(s=>s.y<0)||c.every(s=>s.y>Nn)}let Hw;rt("FillExtrusionBucket",Py,{omit:["layers","features"]});var GR={get paint(){return Hw=Hw||new pr({"fill-extrusion-opacity":new mt(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mt(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mt(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Su(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mt(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class VR extends js{constructor(s){super(s,GR)}createBucket(s){return new Py(s)}queryRadius(){return Zp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(s,u,f,m,b,w,A,C){const M=Jp(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,A),O=this.paint.get("fill-extrusion-height").evaluate(u,f),k=this.paint.get("fill-extrusion-base").evaluate(u,f),U=function(X,te,se,ce){const xe=[];for(const me of X){const we=[me.x,me.y,0,1];Kp(we,we,te),xe.push(new I(we[0]/we[3],we[1]/we[3]))}return xe}(M,C),q=function(X,te,se,ce){const xe=[],me=[],we=ce[8]*te,Se=ce[9]*te,Fe=ce[10]*te,nt=ce[11]*te,dt=ce[8]*se,et=ce[9]*se,Ye=ce[10]*se,qe=ce[11]*se;for(const st of X){const Je=[],Ve=[];for(const bt of st){const ft=bt.x,Ot=bt.y,Tn=ce[0]*ft+ce[4]*Ot+ce[12],Mn=ce[1]*ft+ce[5]*Ot+ce[13],wi=ce[2]*ft+ce[6]*Ot+ce[14],ts=ce[3]*ft+ce[7]*Ot+ce[15],_r=wi+Fe,hi=ts+nt,Ii=Tn+dt,Xi=Mn+et,kr=wi+Ye,yr=ts+qe,di=new I((Tn+we)/hi,(Mn+Se)/hi);di.z=_r/hi,Je.push(di);const Ai=new I(Ii/yr,Xi/yr);Ai.z=kr/yr,Ve.push(Ai)}xe.push(Je),me.push(Ve)}return[xe,me]}(m,k,O,C);return function(X,te,se){let ce=1/0;bw(se,te)&&(ce=Ww(se,te[0]));for(let xe=0;xe<te.length;xe++){const me=te[xe],we=X[xe];for(let Se=0;Se<me.length-1;Se++){const Fe=me[Se],nt=[Fe,me[Se+1],we[Se+1],we[Se],Fe];xw(se,nt)&&(ce=Math.min(ce,Ww(se,nt)))}}return ce!==1/0&&ce}(q[0],q[1],U)}}function zd(c,s){return c.x*s.x+c.y*s.y}function Ww(c,s){if(c.length===1){let u=0;const f=s[u++];let m;for(;!m||f.equals(m);)if(m=s[u++],!m)return 1/0;for(;u<s.length;u++){const b=s[u],w=c[0],A=m.sub(f),C=b.sub(f),M=w.sub(f),O=zd(A,A),k=zd(A,C),U=zd(C,C),q=zd(M,A),X=zd(M,C),te=O*U-k*k,se=(U*q-k*X)/te,ce=(O*X-k*q)/te,xe=f.z*(1-se-ce)+m.z*se+b.z*ce;if(isFinite(xe))return xe}return 1/0}{let u=1/0;for(const f of s)u=Math.min(u,f.z);return u}}const jR=ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:HR}=jR,WR=ei([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:qR}=WR,XR=hl.VectorTileFeature.types,$R=Math.cos(Math.PI/180*37.5),qw=Math.pow(2,14)/.5;class My{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Ie,this.layoutVertexArray2=new Oe,this.indexArray=new yt,this.programConfigurations=new wa(s.layers,s.zoom),this.segments=new xt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){this.hasPattern=Ty("line",this.layers,u);const m=this.layers[0].layout.get("line-sort-key"),b=!m.isConstant(),w=[];for(const{feature:A,id:C,index:M,sourceLayerIndex:O}of s){const k=this.layers[0]._featureFilter.needGeometry,U=Xo(A,k);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),U,f))continue;const q=b?m.evaluate(U,{},f):void 0,X={id:C,properties:A.properties,type:A.type,sourceLayerIndex:O,index:M,geometry:k?U.geometry:yo(A),patterns:{},sortKey:q};w.push(X)}b&&w.sort((A,C)=>A.sortKey-C.sortKey);for(const A of w){const{geometry:C,index:M,sourceLayerIndex:O}=A;if(this.hasPattern){const k=Sy("line",this.layers,A,this.zoom,u);this.patternFeatures.push(k)}else this.addFeature(A,C,M,f,{});u.featureIndex.insert(s[M].feature,C,M,O,this.index)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}addFeatures(s,u,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,qR)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,HR),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,u,f,m,b){const w=this.layers[0].layout,A=w.get("line-join").evaluate(s,{}),C=w.get("line-cap"),M=w.get("line-miter-limit"),O=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const k of u)this.addLine(k,s,A,C,M,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,b,m)}addLine(s,u,f,m,b,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ce=0;ce<s.length-1;ce++)this.totalDistance+=s[ce].dist(s[ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=XR[u.type]==="Polygon";let C=s.length;for(;C>=2&&s[C-1].equals(s[C-2]);)C--;let M=0;for(;M<C-1&&s[M].equals(s[M+1]);)M++;if(C<(A?3:2))return;f==="bevel"&&(b=1.05);const O=this.overscaling<=16?15*Nn/(512*this.overscaling):0,k=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let U,q,X,te,se;this.e1=this.e2=-1,A&&(U=s[C-2],se=s[M].sub(U)._unit()._perp());for(let ce=M;ce<C;ce++){if(X=ce===C-1?A?s[M+1]:void 0:s[ce+1],X&&s[ce].equals(X))continue;se&&(te=se),U&&(q=U),U=s[ce],se=X?X.sub(U)._unit()._perp():te,te=te||se;let xe=te.add(se);xe.x===0&&xe.y===0||xe._unit();const me=te.x*se.x+te.y*se.y,we=xe.x*se.x+xe.y*se.y,Se=we!==0?1/we:1/0,Fe=2*Math.sqrt(2-2*we),nt=we<$R&&q&&X,dt=te.x*se.y-te.y*se.x>0;if(nt&&ce>M){const qe=U.dist(q);if(qe>2*O){const st=U.sub(U.sub(q)._mult(O/qe)._round());this.updateDistance(q,st),this.addCurrentVertex(st,te,0,0,k),q=st}}const et=q&&X;let Ye=et?f:A?"butt":m;if(et&&Ye==="round"&&(Se<w?Ye="miter":Se<=2&&(Ye="fakeround")),Ye==="miter"&&Se>b&&(Ye="bevel"),Ye==="bevel"&&(Se>2&&(Ye="flipbevel"),Se<b&&(Ye="miter")),q&&this.updateDistance(q,U),Ye==="miter")xe._mult(Se),this.addCurrentVertex(U,xe,0,0,k);else if(Ye==="flipbevel"){if(Se>100)xe=se.mult(-1);else{const qe=Se*te.add(se).mag()/te.sub(se).mag();xe._perp()._mult(qe*(dt?-1:1))}this.addCurrentVertex(U,xe,0,0,k),this.addCurrentVertex(U,xe.mult(-1),0,0,k)}else if(Ye==="bevel"||Ye==="fakeround"){const qe=-Math.sqrt(Se*Se-1),st=dt?qe:0,Je=dt?0:qe;if(q&&this.addCurrentVertex(U,te,st,Je,k),Ye==="fakeround"){const Ve=Math.round(180*Fe/Math.PI/20);for(let bt=1;bt<Ve;bt++){let ft=bt/Ve;if(ft!==.5){const Tn=ft-.5;ft+=ft*Tn*(ft-1)*((1.0904+me*(me*(3.55645-1.43519*me)-3.2452))*Tn*Tn+(.848013+me*(.215638*me-1.06021)))}const Ot=se.sub(te)._mult(ft)._add(te)._unit()._mult(dt?-1:1);this.addHalfVertex(U,Ot.x,Ot.y,!1,dt,0,k)}}X&&this.addCurrentVertex(U,se,-st,-Je,k)}else if(Ye==="butt")this.addCurrentVertex(U,xe,0,0,k);else if(Ye==="square"){const qe=q?1:-1;this.addCurrentVertex(U,xe,qe,qe,k)}else Ye==="round"&&(q&&(this.addCurrentVertex(U,te,0,0,k),this.addCurrentVertex(U,te,1,1,k,!0)),X&&(this.addCurrentVertex(U,se,-1,-1,k,!0),this.addCurrentVertex(U,se,0,0,k)));if(nt&&ce<C-1){const qe=U.dist(X);if(qe>2*O){const st=U.add(X.sub(U)._mult(O/qe)._round());this.updateDistance(U,st),this.addCurrentVertex(st,se,0,0,k),U=st}}}}addCurrentVertex(s,u,f,m,b,w=!1){const A=u.y*m-u.x,C=-u.y-u.x*m;this.addHalfVertex(s,u.x+u.y*f,u.y-u.x*f,w,!1,f,b),this.addHalfVertex(s,A,C,w,!0,-m,b),this.distance>qw/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,u,f,m,b,w))}addHalfVertex({x:s,y:u},f,m,b,w,A,C){const M=.5*(this.lineClips?this.scaledDistance*(qw-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(b?1:0),(u<<1)+(w?1:0),Math.round(63*f)+128,Math.round(63*m)+128,1+(A===0?0:A<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),C.primitiveLength++),w?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,u){this.distance+=s.dist(u),this.updateScaledDistance()}}let Xw,$w;rt("LineBucket",My,{omit:["layers","patternFeatures"]});var Zw={get paint(){return $w=$w||new pr({"line-opacity":new Tt(Be.paint_line["line-opacity"]),"line-color":new Tt(Be.paint_line["line-color"]),"line-translate":new mt(Be.paint_line["line-translate"]),"line-translate-anchor":new mt(Be.paint_line["line-translate-anchor"]),"line-width":new Tt(Be.paint_line["line-width"]),"line-gap-width":new Tt(Be.paint_line["line-gap-width"]),"line-offset":new Tt(Be.paint_line["line-offset"]),"line-blur":new Tt(Be.paint_line["line-blur"]),"line-dasharray":new Ad(Be.paint_line["line-dasharray"]),"line-pattern":new Su(Be.paint_line["line-pattern"]),"line-gradient":new Ed(Be.paint_line["line-gradient"])})},get layout(){return Xw=Xw||new pr({"line-cap":new mt(Be.layout_line["line-cap"]),"line-join":new Tt(Be.layout_line["line-join"]),"line-miter-limit":new mt(Be.layout_line["line-miter-limit"]),"line-round-limit":new mt(Be.layout_line["line-round-limit"]),"line-sort-key":new Tt(Be.layout_line["line-sort-key"])})}};class ZR extends Tt{possiblyEvaluate(s,u){return u=new In(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(s,u)}evaluate(s,u,f,m){return u=Z({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(s,u,f,m)}}let nm;class JR extends js{constructor(s){super(s,Zw),this.gradientVersion=0,nm||(nm=new ZR(Zw.paint.properties["line-width"].specification),nm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof ec,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,u){super.recalculate(s,u),this.paint._values["line-floorwidth"]=nm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new My(s)}queryRadius(s){const u=s,f=Jw(Md("line-width",this,u),Md("line-gap-width",this,u)),m=Md("line-offset",this,u);return f/2+Math.abs(m)+Zp(this.paint.get("line-translate"))}queryIntersectsFeature(s,u,f,m,b,w,A){const C=Jp(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,A),M=A/2*Jw(this.paint.get("line-width").evaluate(u,f),this.paint.get("line-gap-width").evaluate(u,f)),O=this.paint.get("line-offset").evaluate(u,f);return O&&(m=function(k,U){const q=[];for(let X=0;X<k.length;X++){const te=k[X],se=[];for(let ce=0;ce<te.length;ce++){const xe=te[ce-1],me=te[ce],we=te[ce+1],Se=ce===0?new I(0,0):me.sub(xe)._unit()._perp(),Fe=ce===te.length-1?new I(0,0):we.sub(me)._unit()._perp(),nt=Se._add(Fe)._unit(),dt=nt.x*Fe.x+nt.y*Fe.y;dt!==0&&nt._mult(1/dt),se.push(nt._mult(U)._add(me))}q.push(se)}return q}(m,O*A)),function(k,U,q){for(let X=0;X<U.length;X++){const te=U[X];if(k.length>=3){for(let se=0;se<te.length;se++)if(Lu(k,te[se]))return!0}if(nR(k,te,q))return!0}return!1}(C,m,M)}isTileClipped(){return!0}}function Jw(c,s){return s>0?s+2*c:c}const KR=ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),YR=ei([{name:"a_projected_pos",components:3,type:"Float32"}],4);ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const QR=ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ei([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Kw=ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),eD=ei([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function tD(c,s,u){return c.sections.forEach(f=>{f.text=function(m,b,w){const A=b.layout.get("text-transform").evaluate(w,{});return A==="uppercase"?m=m.toLocaleUpperCase():A==="lowercase"&&(m=m.toLocaleLowerCase()),Qr.applyArabicShaping&&(m=Qr.applyArabicShaping(m)),m}(f.text,s,u)}),c}ei([{name:"triangle",components:3,type:"Uint16"}]),ei([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ei([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ei([{type:"Float32",name:"offsetX"}]),ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ei([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Nd={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var bi=24,Yw=fn,Qw=function(c,s,u,f,m){var b,w,A=8*m-f-1,C=(1<<A)-1,M=C>>1,O=-7,k=u?m-1:0,U=u?-1:1,q=c[s+k];for(k+=U,b=q&(1<<-O)-1,q>>=-O,O+=A;O>0;b=256*b+c[s+k],k+=U,O-=8);for(w=b&(1<<-O)-1,b>>=-O,O+=f;O>0;w=256*w+c[s+k],k+=U,O-=8);if(b===0)b=1-M;else{if(b===C)return w?NaN:1/0*(q?-1:1);w+=Math.pow(2,f),b-=M}return(q?-1:1)*w*Math.pow(2,b-f)},eA=function(c,s,u,f,m,b){var w,A,C,M=8*b-m-1,O=(1<<M)-1,k=O>>1,U=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=f?0:b-1,X=f?1:-1,te=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(A=isNaN(s)?1:0,w=O):(w=Math.floor(Math.log(s)/Math.LN2),s*(C=Math.pow(2,-w))<1&&(w--,C*=2),(s+=w+k>=1?U/C:U*Math.pow(2,1-k))*C>=2&&(w++,C/=2),w+k>=O?(A=0,w=O):w+k>=1?(A=(s*C-1)*Math.pow(2,m),w+=k):(A=s*Math.pow(2,k-1)*Math.pow(2,m),w=0));m>=8;c[u+q]=255&A,q+=X,A/=256,m-=8);for(w=w<<m|A,M+=m;M>0;c[u+q]=255&w,q+=X,w/=256,M-=8);c[u+q-X]|=128*te};function fn(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}fn.Varint=0,fn.Fixed64=1,fn.Bytes=2,fn.Fixed32=5;var By=4294967296,tA=1/By,nA=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ea(c){return c.type===fn.Bytes?c.readVarint()+c.pos:c.pos+1}function Fu(c,s,u){return u?4294967296*s+(c>>>0):4294967296*(s>>>0)+(c>>>0)}function iA(c,s,u){var f=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));u.realloc(f);for(var m=u.pos-1;m>=c;m--)u.buf[m+f]=u.buf[m]}function nD(c,s){for(var u=0;u<c.length;u++)s.writeVarint(c[u])}function iD(c,s){for(var u=0;u<c.length;u++)s.writeSVarint(c[u])}function rD(c,s){for(var u=0;u<c.length;u++)s.writeFloat(c[u])}function sD(c,s){for(var u=0;u<c.length;u++)s.writeDouble(c[u])}function oD(c,s){for(var u=0;u<c.length;u++)s.writeBoolean(c[u])}function aD(c,s){for(var u=0;u<c.length;u++)s.writeFixed32(c[u])}function lD(c,s){for(var u=0;u<c.length;u++)s.writeSFixed32(c[u])}function cD(c,s){for(var u=0;u<c.length;u++)s.writeFixed64(c[u])}function uD(c,s){for(var u=0;u<c.length;u++)s.writeSFixed64(c[u])}function im(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+16777216*c[s+3]}function ku(c,s,u){c[u]=s,c[u+1]=s>>>8,c[u+2]=s>>>16,c[u+3]=s>>>24}function rA(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+(c[s+3]<<24)}fn.prototype={destroy:function(){this.buf=null},readFields:function(c,s,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),m=f>>3,b=this.pos;this.type=7&f,c(m,s,this),this.pos===b&&this.skip(f)}return s},readMessage:function(c,s){return this.readFields(c,s,this.readVarint()+this.pos)},readFixed32:function(){var c=im(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=rA(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=im(this.buf,this.pos)+im(this.buf,this.pos+4)*By;return this.pos+=8,c},readSFixed64:function(){var c=im(this.buf,this.pos)+rA(this.buf,this.pos+4)*By;return this.pos+=8,c},readFloat:function(){var c=Qw(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=Qw(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var s,u,f=this.buf;return s=127&(u=f[this.pos++]),u<128?s:(s|=(127&(u=f[this.pos++]))<<7,u<128?s:(s|=(127&(u=f[this.pos++]))<<14,u<128?s:(s|=(127&(u=f[this.pos++]))<<21,u<128?s:function(m,b,w){var A,C,M=w.buf;if(A=(112&(C=M[w.pos++]))>>4,C<128||(A|=(127&(C=M[w.pos++]))<<3,C<128)||(A|=(127&(C=M[w.pos++]))<<10,C<128)||(A|=(127&(C=M[w.pos++]))<<17,C<128)||(A|=(127&(C=M[w.pos++]))<<24,C<128)||(A|=(1&(C=M[w.pos++]))<<31,C<128))return Fu(m,A,b);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(u=f[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,s=this.pos;return this.pos=c,c-s>=12&&nA?function(u,f,m){return nA.decode(u.subarray(f,m))}(this.buf,s,c):function(u,f,m){for(var b="",w=f;w<m;){var A,C,M,O=u[w],k=null,U=O>239?4:O>223?3:O>191?2:1;if(w+U>m)break;U===1?O<128&&(k=O):U===2?(192&(A=u[w+1]))==128&&(k=(31&O)<<6|63&A)<=127&&(k=null):U===3?(C=u[w+2],(192&(A=u[w+1]))==128&&(192&C)==128&&((k=(15&O)<<12|(63&A)<<6|63&C)<=2047||k>=55296&&k<=57343)&&(k=null)):U===4&&(C=u[w+2],M=u[w+3],(192&(A=u[w+1]))==128&&(192&C)==128&&(192&M)==128&&((k=(15&O)<<18|(63&A)<<12|(63&C)<<6|63&M)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,U=1):k>65535&&(k-=65536,b+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),b+=String.fromCharCode(k),w+=U}return b}(this.buf,s,c)},readBytes:function(){var c=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,c);return this.pos=c,s},readPackedVarint:function(c,s){if(this.type!==fn.Bytes)return c.push(this.readVarint(s));var u=Ea(this);for(c=c||[];this.pos<u;)c.push(this.readVarint(s));return c},readPackedSVarint:function(c){if(this.type!==fn.Bytes)return c.push(this.readSVarint());var s=Ea(this);for(c=c||[];this.pos<s;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==fn.Bytes)return c.push(this.readBoolean());var s=Ea(this);for(c=c||[];this.pos<s;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==fn.Bytes)return c.push(this.readFloat());var s=Ea(this);for(c=c||[];this.pos<s;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==fn.Bytes)return c.push(this.readDouble());var s=Ea(this);for(c=c||[];this.pos<s;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==fn.Bytes)return c.push(this.readFixed32());var s=Ea(this);for(c=c||[];this.pos<s;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==fn.Bytes)return c.push(this.readSFixed32());var s=Ea(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==fn.Bytes)return c.push(this.readFixed64());var s=Ea(this);for(c=c||[];this.pos<s;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==fn.Bytes)return c.push(this.readSFixed64());var s=Ea(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed64());return c},skip:function(c){var s=7&c;if(s===fn.Varint)for(;this.buf[this.pos++]>127;);else if(s===fn.Bytes)this.pos=this.readVarint()+this.pos;else if(s===fn.Fixed32)this.pos+=4;else{if(s!==fn.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(c,s){this.writeVarint(c<<3|s)},realloc:function(c){for(var s=this.length||16;s<this.pos+c;)s*=2;if(s!==this.length){var u=new Uint8Array(s);u.set(this.buf),this.buf=u,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),ku(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),ku(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),ku(this.buf,-1&c,this.pos),ku(this.buf,Math.floor(c*tA),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),ku(this.buf,-1&c,this.pos),ku(this.buf,Math.floor(c*tA),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(s,u){var f,m;if(s>=0?(f=s%4294967296|0,m=s/4294967296|0):(m=~(-s/4294967296),4294967295^(f=~(-s%4294967296))?f=f+1|0:(f=0,m=m+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,w,A){A.buf[A.pos++]=127&b|128,b>>>=7,A.buf[A.pos++]=127&b|128,b>>>=7,A.buf[A.pos++]=127&b|128,b>>>=7,A.buf[A.pos++]=127&b|128,A.buf[A.pos]=127&(b>>>=7)}(f,0,u),function(b,w){var A=(7&b)<<4;w.buf[w.pos++]|=A|((b>>>=3)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b)))))}(m,u)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var s=this.pos;this.pos=function(f,m,b){for(var w,A,C=0;C<m.length;C++){if((w=m.charCodeAt(C))>55295&&w<57344){if(!A){w>56319||C+1===m.length?(f[b++]=239,f[b++]=191,f[b++]=189):A=w;continue}if(w<56320){f[b++]=239,f[b++]=191,f[b++]=189,A=w;continue}w=A-55296<<10|w-56320|65536,A=null}else A&&(f[b++]=239,f[b++]=191,f[b++]=189,A=null);w<128?f[b++]=w:(w<2048?f[b++]=w>>6|192:(w<65536?f[b++]=w>>12|224:(f[b++]=w>>18|240,f[b++]=w>>12&63|128),f[b++]=w>>6&63|128),f[b++]=63&w|128)}return b}(this.buf,c,this.pos);var u=this.pos-s;u>=128&&iA(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u},writeFloat:function(c){this.realloc(4),eA(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),eA(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var s=c.length;this.writeVarint(s),this.realloc(s);for(var u=0;u<s;u++)this.buf[this.pos++]=c[u]},writeRawMessage:function(c,s){this.pos++;var u=this.pos;c(s,this);var f=this.pos-u;f>=128&&iA(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(c,s,u){this.writeTag(c,fn.Bytes),this.writeRawMessage(s,u)},writePackedVarint:function(c,s){s.length&&this.writeMessage(c,nD,s)},writePackedSVarint:function(c,s){s.length&&this.writeMessage(c,iD,s)},writePackedBoolean:function(c,s){s.length&&this.writeMessage(c,oD,s)},writePackedFloat:function(c,s){s.length&&this.writeMessage(c,rD,s)},writePackedDouble:function(c,s){s.length&&this.writeMessage(c,sD,s)},writePackedFixed32:function(c,s){s.length&&this.writeMessage(c,aD,s)},writePackedSFixed32:function(c,s){s.length&&this.writeMessage(c,lD,s)},writePackedFixed64:function(c,s){s.length&&this.writeMessage(c,cD,s)},writePackedSFixed64:function(c,s){s.length&&this.writeMessage(c,uD,s)},writeBytesField:function(c,s){this.writeTag(c,fn.Bytes),this.writeBytes(s)},writeFixed32Field:function(c,s){this.writeTag(c,fn.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(c,s){this.writeTag(c,fn.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(c,s){this.writeTag(c,fn.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(c,s){this.writeTag(c,fn.Fixed64),this.writeSFixed64(s)},writeVarintField:function(c,s){this.writeTag(c,fn.Varint),this.writeVarint(s)},writeSVarintField:function(c,s){this.writeTag(c,fn.Varint),this.writeSVarint(s)},writeStringField:function(c,s){this.writeTag(c,fn.Bytes),this.writeString(s)},writeFloatField:function(c,s){this.writeTag(c,fn.Fixed32),this.writeFloat(s)},writeDoubleField:function(c,s){this.writeTag(c,fn.Fixed64),this.writeDouble(s)},writeBooleanField:function(c,s){this.writeVarintField(c,!!s)}};var Ly=_(Yw);const Ry=3;function hD(c,s,u){c===1&&u.readMessage(dD,s)}function dD(c,s,u){if(c===3){const{id:f,bitmap:m,width:b,height:w,left:A,top:C,advance:M}=u.readMessage(fD,{});s.push({id:f,bitmap:new Ld({width:b+2*Ry,height:w+2*Ry},m),metrics:{width:b,height:w,left:A,top:C,advance:M}})}}function fD(c,s,u){c===1?s.id=u.readVarint():c===2?s.bitmap=u.readBytes():c===3?s.width=u.readVarint():c===4?s.height=u.readVarint():c===5?s.left=u.readSVarint():c===6?s.top=u.readSVarint():c===7&&(s.advance=u.readVarint())}const sA=Ry;function oA(c){let s=0,u=0;for(const w of c)s+=w.w*w.h,u=Math.max(u,w.w);c.sort((w,A)=>A.h-w.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),u),h:1/0}];let m=0,b=0;for(const w of c)for(let A=f.length-1;A>=0;A--){const C=f[A];if(!(w.w>C.w||w.h>C.h)){if(w.x=C.x,w.y=C.y,b=Math.max(b,w.y+w.h),m=Math.max(m,w.x+w.w),w.w===C.w&&w.h===C.h){const M=f.pop();A<f.length&&(f[A]=M)}else w.h===C.h?(C.x+=w.w,C.w-=w.w):w.w===C.w?(C.y+=w.h,C.h-=w.h):(f.push({x:C.x+w.w,y:C.y,w:C.w-w.w,h:w.h}),C.y+=w.h,C.h-=w.h);break}}return{w:m,h:b,fill:s/(m*b)||0}}const Fr=1;class Dy{constructor(s,{pixelRatio:u,version:f,stretchX:m,stretchY:b,content:w}){this.paddedRect=s,this.pixelRatio=u,this.stretchX=m,this.stretchY=b,this.content=w,this.version=f}get tl(){return[this.paddedRect.x+Fr,this.paddedRect.y+Fr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Fr,this.paddedRect.y+this.paddedRect.h-Fr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Fr)/this.pixelRatio,(this.paddedRect.h-2*Fr)/this.pixelRatio]}}class aA{constructor(s,u){const f={},m={};this.haveRenderCallbacks=[];const b=[];this.addImages(s,f,b),this.addImages(u,m,b);const{w,h:A}=oA(b),C=new ys({width:w||1,height:A||1});for(const M in s){const O=s[M],k=f[M].paddedRect;ys.copy(O.data,C,{x:0,y:0},{x:k.x+Fr,y:k.y+Fr},O.data)}for(const M in u){const O=u[M],k=m[M].paddedRect,U=k.x+Fr,q=k.y+Fr,X=O.data.width,te=O.data.height;ys.copy(O.data,C,{x:0,y:0},{x:U,y:q},O.data),ys.copy(O.data,C,{x:0,y:te-1},{x:U,y:q-1},{width:X,height:1}),ys.copy(O.data,C,{x:0,y:0},{x:U,y:q+te},{width:X,height:1}),ys.copy(O.data,C,{x:X-1,y:0},{x:U-1,y:q},{width:1,height:te}),ys.copy(O.data,C,{x:0,y:0},{x:U+X,y:q},{width:1,height:te})}this.image=C,this.iconPositions=f,this.patternPositions=m}addImages(s,u,f){for(const m in s){const b=s[m],w={x:0,y:0,w:b.data.width+2*Fr,h:b.data.height+2*Fr};f.push(w),u[m]=new Dy(w,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(s,u){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in s.updatedImages)this.patchUpdatedImage(this.iconPositions[f],s.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],s.getImage(f),u)}patchUpdatedImage(s,u,f){if(!s||!u||s.version===u.version)return;s.version=u.version;const[m,b]=s.tl;f.update(u.data,void 0,{x:m,y:b})}}var dl;rt("ImagePosition",Dy),rt("ImageAtlas",aA),l.WritingMode=void 0,(dl=l.WritingMode||(l.WritingMode={}))[dl.none=0]="none",dl[dl.horizontal=1]="horizontal",dl[dl.vertical=2]="vertical",dl[dl.horizontalOnly=3]="horizontalOnly";const Ud=-17;class Gd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,u){const f=new Gd;return f.scale=s||1,f.fontStack=u,f}static forImage(s){const u=new Gd;return u.imageName=s,u}}class zu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,u){const f=new zu;for(let m=0;m<s.sections.length;m++){const b=s.sections[m];b.image?f.addImageSection(b):f.addTextSection(b,u)}return f}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let u="";for(let f=0;f<s.length;f++){const m=s.charCodeAt(f+1)||null,b=s.charCodeAt(f-1)||null;u+=m&&mc(m)&&!Nd[s[f+1]]||b&&mc(b)&&!Nd[s[f-1]]||!Nd[s[f]]?s[f]:Nd[s[f]]}return u}(this.text)}trim(){let s=0;for(let f=0;f<this.text.length&&sm[this.text.charCodeAt(f)];f++)s++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=s&&sm[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(s,u),this.sectionIndex=this.sectionIndex.slice(s,u)}substring(s,u){const f=new zu;return f.text=this.text.substring(s,u),f.sectionIndex=this.sectionIndex.slice(s,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,u)=>Math.max(s,this.sections[u].scale),0)}addTextSection(s,u){this.text+=s.text,this.sections.push(Gd.forText(s.scale,s.fontStack||u));const f=this.sections.length-1;for(let m=0;m<s.text.length;++m)this.sectionIndex.push(f)}addImageSection(s){const u=s.image?s.image.name:"";if(u.length===0)return void Ue("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Gd.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Ue("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function rm(c,s,u,f,m,b,w,A,C,M,O,k,U,q,X,te){const se=zu.fromFeature(c,m);let ce;k===l.WritingMode.vertical&&se.verticalizePunctuation();const{processBidirectionalText:xe,processStyledBidirectionalText:me}=Qr;if(xe&&se.sections.length===1){ce=[];const Fe=xe(se.toString(),Oy(se,M,b,s,f,q,X));for(const nt of Fe){const dt=new zu;dt.text=nt,dt.sections=se.sections;for(let et=0;et<nt.length;et++)dt.sectionIndex.push(0);ce.push(dt)}}else if(me){ce=[];const Fe=me(se.text,se.sectionIndex,Oy(se,M,b,s,f,q,X));for(const nt of Fe){const dt=new zu;dt.text=nt[0],dt.sectionIndex=nt[1],dt.sections=se.sections,ce.push(dt)}}else ce=function(Fe,nt){const dt=[],et=Fe.text;let Ye=0;for(const qe of nt)dt.push(Fe.substring(Ye,qe)),Ye=qe;return Ye<et.length&&dt.push(Fe.substring(Ye,et.length)),dt}(se,Oy(se,M,b,s,f,q,X));const we=[],Se={positionedLines:we,text:se.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:k,iconsInText:!1,verticalizable:!1};return function(Fe,nt,dt,et,Ye,qe,st,Je,Ve,bt,ft,Ot){let Tn=0,Mn=Ud,wi=0,ts=0;const _r=Je==="right"?1:Je==="left"?0:.5;let hi=0;for(const di of Ye){di.trim();const Ai=di.getMaxScale(),ir=(Ai-1)*bi,vr={positionedGlyphs:[],lineOffset:0};Fe.positionedLines[hi]=vr;const zr=vr.positionedGlyphs;let Nr=0;if(!di.length()){Mn+=qe,++hi;continue}for(let $i=0;$i<di.length();$i++){const Wt=di.getSection($i),ns=di.getSectionIndex($i),Zi=di.getCharCode($i);let xr=0,qs=null,vo=null,xo=null,Ta=bi;const Xs=!(Ve===l.WritingMode.horizontal||!ft&&!pc(Zi)||ft&&(sm[Zi]||(Ii=Zi,Qe.Arabic(Ii)||Qe["Arabic Supplement"](Ii)||Qe["Arabic Extended-A"](Ii)||Qe["Arabic Presentation Forms-A"](Ii)||Qe["Arabic Presentation Forms-B"](Ii))));if(Wt.imageName){const xs=et[Wt.imageName];if(!xs)continue;xo=Wt.imageName,Fe.iconsInText=Fe.iconsInText||!0,vo=xs.paddedRect;const Ur=xs.displaySize;Wt.scale=Wt.scale*bi/Ot,qs={width:Ur[0],height:Ur[1],left:Fr,top:-sA,advance:Xs?Ur[1]:Ur[0]},xr=ir+(bi-Ur[1]*Wt.scale),Ta=qs.advance;const Sa=Xs?Ur[0]*Wt.scale-bi*Ai:Ur[1]*Wt.scale-bi*Ai;Sa>0&&Sa>Nr&&(Nr=Sa)}else{const xs=dt[Wt.fontStack],Ur=xs&&xs[Zi];if(Ur&&Ur.rect)vo=Ur.rect,qs=Ur.metrics;else{const Sa=nt[Wt.fontStack],qd=Sa&&Sa[Zi];if(!qd)continue;qs=qd.metrics}xr=(Ai-Wt.scale)*bi}Xs?(Fe.verticalizable=!0,zr.push({glyph:Zi,imageName:xo,x:Tn,y:Mn+xr,vertical:Xs,scale:Wt.scale,fontStack:Wt.fontStack,sectionIndex:ns,metrics:qs,rect:vo}),Tn+=Ta*Wt.scale+bt):(zr.push({glyph:Zi,imageName:xo,x:Tn,y:Mn+xr,vertical:Xs,scale:Wt.scale,fontStack:Wt.fontStack,sectionIndex:ns,metrics:qs,rect:vo}),Tn+=qs.advance*Wt.scale+bt)}zr.length!==0&&(wi=Math.max(Tn-bt,wi),gD(zr,0,zr.length-1,_r,Nr)),Tn=0;const $n=qe*Ai+Nr;vr.lineOffset=Math.max(Nr,ir),Mn+=$n,ts=Math.max($n,ts),++hi}var Ii;const Xi=Mn-Ud,{horizontalAlign:kr,verticalAlign:yr}=Fy(st);(function(di,Ai,ir,vr,zr,Nr,$n,$i,Wt){const ns=(Ai-ir)*zr;let Zi=0;Zi=Nr!==$n?-$i*vr-Ud:(-vr*Wt+.5)*$n;for(const xr of di)for(const qs of xr.positionedGlyphs)qs.x+=ns,qs.y+=Zi})(Fe.positionedLines,_r,kr,yr,wi,ts,qe,Xi,Ye.length),Fe.top+=-yr*Xi,Fe.bottom=Fe.top+Xi,Fe.left+=-kr*wi,Fe.right=Fe.left+wi}(Se,s,u,f,ce,w,A,C,k,M,U,te),!function(Fe){for(const nt of Fe)if(nt.positionedGlyphs.length!==0)return!1;return!0}(we)&&Se}const sm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pD={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function lA(c,s,u,f,m,b){if(s.imageName){const w=f[s.imageName];return w?w.displaySize[0]*s.scale*bi/b+m:0}{const w=u[s.fontStack],A=w&&w[c];return A?A.metrics.advance*s.scale+m:0}}function cA(c,s,u,f){const m=Math.pow(c-s,2);return f?c<s?m/2:2*m:m+Math.abs(u)*u}function mD(c,s,u){let f=0;return c===10&&(f-=1e4),u&&(f+=150),c!==40&&c!==65288||(f+=50),s!==41&&s!==65289||(f+=50),f}function uA(c,s,u,f,m,b){let w=null,A=cA(s,u,m,b);for(const C of f){const M=cA(s-C.x,u,m,b)+C.badness;M<=A&&(w=C,A=M)}return{index:c,x:s,priorBreak:w,badness:A}}function hA(c){return c?hA(c.priorBreak).concat(c.index):[]}function Oy(c,s,u,f,m,b,w){if(b!=="point")return[];if(!c)return[];const A=[],C=function(U,q,X,te,se,ce){let xe=0;for(let me=0;me<U.length();me++){const we=U.getSection(me);xe+=lA(U.getCharCode(me),we,te,se,q,ce)}return xe/Math.max(1,Math.ceil(xe/X))}(c,s,u,f,m,w),M=c.text.indexOf("​")>=0;let O=0;for(let U=0;U<c.length();U++){const q=c.getSection(U),X=c.getCharCode(U);if(sm[X]||(O+=lA(X,q,f,m,s,w)),U<c.length()-1){const te=!((k=X)<11904||!(Qe["Bopomofo Extended"](k)||Qe.Bopomofo(k)||Qe["CJK Compatibility Forms"](k)||Qe["CJK Compatibility Ideographs"](k)||Qe["CJK Compatibility"](k)||Qe["CJK Radicals Supplement"](k)||Qe["CJK Strokes"](k)||Qe["CJK Symbols and Punctuation"](k)||Qe["CJK Unified Ideographs Extension A"](k)||Qe["CJK Unified Ideographs"](k)||Qe["Enclosed CJK Letters and Months"](k)||Qe["Halfwidth and Fullwidth Forms"](k)||Qe.Hiragana(k)||Qe["Ideographic Description Characters"](k)||Qe["Kangxi Radicals"](k)||Qe["Katakana Phonetic Extensions"](k)||Qe.Katakana(k)||Qe["Vertical Forms"](k)||Qe["Yi Radicals"](k)||Qe["Yi Syllables"](k)));(pD[X]||te||q.imageName)&&A.push(uA(U+1,O,C,A,mD(X,c.getCharCode(U+1),te&&M),!1))}}var k;return hA(uA(c.length(),O,C,A,0,!0))}function Fy(c){let s=.5,u=.5;switch(c){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:s,verticalAlign:u}}function gD(c,s,u,f,m){if(!f&&!m)return;const b=c[u],w=(c[u].x+b.metrics.advance*b.scale)*f;for(let A=s;A<=u;A++)c[A].x-=w,c[A].y+=m}function _D(c,s,u){const{horizontalAlign:f,verticalAlign:m}=Fy(u),b=s[0]-c.displaySize[0]*f,w=s[1]-c.displaySize[1]*m;return{image:c,top:w,bottom:w+c.displaySize[1],left:b,right:b+c.displaySize[0]}}function dA(c,s,u,f,m,b){const w=c.image;let A;if(w.content){const se=w.content,ce=w.pixelRatio||1;A=[se[0]/ce,se[1]/ce,w.displaySize[0]-se[2]/ce,w.displaySize[1]-se[3]/ce]}const C=s.left*b,M=s.right*b;let O,k,U,q;u==="width"||u==="both"?(q=m[0]+C-f[3],k=m[0]+M+f[1]):(q=m[0]+(C+M-w.displaySize[0])/2,k=q+w.displaySize[0]);const X=s.top*b,te=s.bottom*b;return u==="height"||u==="both"?(O=m[1]+X-f[0],U=m[1]+te+f[2]):(O=m[1]+(X+te-w.displaySize[1])/2,U=O+w.displaySize[1]),{image:w,top:O,right:k,bottom:U,left:q,collisionPadding:A}}const Vd=255,$o=128,fl=Vd*$o;function fA(c,s){const{expression:u}=s;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new In(c+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:m}=u;let b=0;for(;b<f.length&&f[b]<=c;)b++;b=Math.max(0,b-1);let w=b;for(;w<f.length&&f[w]<c+1;)w++;w=Math.min(f.length-1,w);const A=f[b],C=f[w];return u.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:C,interpolationType:m}:{kind:"camera",minZoom:A,maxZoom:C,minSize:u.evaluate(new In(A)),maxSize:u.evaluate(new In(C)),interpolationType:m}}}function ky(c,s,u){let f="never";const m=c.get(s);return m?f=m:c.get(u)&&(f="always"),f}const yD=hl.VectorTileFeature.types,vD=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function om(c,s,u,f,m,b,w,A,C,M,O,k,U){const q=A?Math.min(fl,Math.round(A[0])):0,X=A?Math.min(fl,Math.round(A[1])):0;c.emplaceBack(s,u,Math.round(32*f),Math.round(32*m),b,w,(q<<1)+(C?1:0),X,16*M,16*O,256*k,256*U)}function zy(c,s,u){c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u)}function xD(c){for(const s of c.sections)if(jp(s.text))return!0;return!1}class Ny{constructor(s){this.layoutVertexArray=new Ne,this.indexArray=new yt,this.programConfigurations=s,this.segments=new xt,this.dynamicLayoutVertexArray=new He,this.opacityVertexArray=new ht,this.hasVisibleVertices=!1,this.placedSymbolArray=new L}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,u,f,m){this.isEmpty()||(f&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,KR.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,YR.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,vD,!0),this.opacityVertexBuffer.itemSize=1),(f||m)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}rt("SymbolBuffers",Ny);class Uy{constructor(s,u,f){this.layoutVertexArray=new s,this.layoutAttributes=u,this.indexArray=new f,this.segments=new xt,this.collisionVertexArray=new Ke}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,QR.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}rt("CollisionBuffers",Uy);class Nu{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(w=>w.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_y([]),this.placementViewportMatrix=_y([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fA(this.zoom,u["text-size"]),this.iconSizeData=fA(this.zoom,u["icon-size"]);const f=this.layers[0].layout,m=f.get("symbol-sort-key"),b=f.get("symbol-z-order");this.canOverlap=ky(f,"text-overlap","text-allow-overlap")!=="never"||ky(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(w=>l.WritingMode[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=s.sourceID}createArrays(){this.text=new Ny(new wa(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new Ny(new wa(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new H,this.lineVertexArray=new ne,this.symbolInstances=new F,this.textAnchorOffsets=new re}calculateGlyphDependencies(s,u,f,m,b){for(let w=0;w<s.length;w++)if(u[s.charCodeAt(w)]=!0,(f||m)&&b){const A=Nd[s.charAt(w)];A&&(u[A.charCodeAt(0)]=!0)}}populate(s,u,f){const m=this.layers[0],b=m.layout,w=b.get("text-font"),A=b.get("text-field"),C=b.get("icon-image"),M=(A.value.kind!=="constant"||A.value.value instanceof xn&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),O=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,k=b.get("symbol-sort-key");if(this.features=[],!M&&!O)return;const U=u.iconDependencies,q=u.glyphDependencies,X=u.availableImages,te=new In(this.zoom);for(const{feature:se,id:ce,index:xe,sourceLayerIndex:me}of s){const we=m._featureFilter.needGeometry,Se=Xo(se,we);if(!m._featureFilter.filter(te,Se,f))continue;let Fe,nt;if(we||(Se.geometry=yo(se)),M){const et=m.getValueAndResolveTokens("text-field",Se,f,X),Ye=xn.factory(et);xD(Ye)&&(this.hasRTLText=!0),(!this.hasRTLText||wd()==="unavailable"||this.hasRTLText&&Qr.isParsed())&&(Fe=tD(Ye,m,Se))}if(O){const et=m.getValueAndResolveTokens("icon-image",Se,f,X);nt=et instanceof Hn?et:Hn.fromString(et)}if(!Fe&&!nt)continue;const dt=this.sortFeaturesByKey?k.evaluate(Se,{},f):void 0;if(this.features.push({id:ce,text:Fe,icon:nt,index:xe,sourceLayerIndex:me,geometry:Se.geometry,properties:se.properties,type:yD[se.type],sortKey:dt}),nt&&(U[nt.name]=!0),Fe){const et=w.evaluate(Se,{},f).join(","),Ye=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const qe of Fe.sections)if(qe.image)U[qe.image.name]=!0;else{const st=Au(Fe.toString()),Je=qe.fontStack||et,Ve=q[Je]=q[Je]||{};this.calculateGlyphDependencies(qe.text,Ve,Ye,this.allowVerticalPlacement,st)}}}b.get("symbol-placement")==="line"&&(this.features=function(se){const ce={},xe={},me=[];let we=0;function Se(et){me.push(se[et]),we++}function Fe(et,Ye,qe){const st=xe[et];return delete xe[et],xe[Ye]=st,me[st].geometry[0].pop(),me[st].geometry[0]=me[st].geometry[0].concat(qe[0]),st}function nt(et,Ye,qe){const st=ce[Ye];return delete ce[Ye],ce[et]=st,me[st].geometry[0].shift(),me[st].geometry[0]=qe[0].concat(me[st].geometry[0]),st}function dt(et,Ye,qe){const st=qe?Ye[0][Ye[0].length-1]:Ye[0][0];return`${et}:${st.x}:${st.y}`}for(let et=0;et<se.length;et++){const Ye=se[et],qe=Ye.geometry,st=Ye.text?Ye.text.toString():null;if(!st){Se(et);continue}const Je=dt(st,qe),Ve=dt(st,qe,!0);if(Je in xe&&Ve in ce&&xe[Je]!==ce[Ve]){const bt=nt(Je,Ve,qe),ft=Fe(Je,Ve,me[bt].geometry);delete ce[Je],delete xe[Ve],xe[dt(st,me[ft].geometry,!0)]=ft,me[bt].geometry=null}else Je in xe?Fe(Je,Ve,qe):Ve in ce?nt(Je,Ve,qe):(Se(et),ce[Je]=we-1,xe[Ve]=we-1)}return me.filter(et=>et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,ce)=>se.sortKey-ce.sortKey)}update(s,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(s,u,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,u){const f=this.lineVertexArray.length;if(s.segment!==void 0){let m=s.dist(u[s.segment+1]),b=s.dist(u[s.segment]);const w={};for(let A=s.segment+1;A<u.length;A++)w[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:m},A<u.length-1&&(m+=u[A+1].dist(u[A]));for(let A=s.segment||0;A>=0;A--)w[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:b},A>0&&(b+=u[A-1].dist(u[A]));for(let A=0;A<u.length;A++){const C=w[A];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(s,u,f,m,b,w,A,C,M,O,k,U){const q=s.indexArray,X=s.layoutVertexArray,te=s.segments.prepareSegment(4*u.length,X,q,this.canOverlap?w.sortKey:void 0),se=this.glyphOffsetArray.length,ce=te.vertexLength,xe=this.allowVerticalPlacement&&A===l.WritingMode.vertical?Math.PI/2:0,me=w.text&&w.text.sections;for(let we=0;we<u.length;we++){const{tl:Se,tr:Fe,bl:nt,br:dt,tex:et,pixelOffsetTL:Ye,pixelOffsetBR:qe,minFontScaleX:st,minFontScaleY:Je,glyphOffset:Ve,isSDF:bt,sectionIndex:ft}=u[we],Ot=te.vertexLength,Tn=Ve[1];om(X,C.x,C.y,Se.x,Tn+Se.y,et.x,et.y,f,bt,Ye.x,Ye.y,st,Je),om(X,C.x,C.y,Fe.x,Tn+Fe.y,et.x+et.w,et.y,f,bt,qe.x,Ye.y,st,Je),om(X,C.x,C.y,nt.x,Tn+nt.y,et.x,et.y+et.h,f,bt,Ye.x,qe.y,st,Je),om(X,C.x,C.y,dt.x,Tn+dt.y,et.x+et.w,et.y+et.h,f,bt,qe.x,qe.y,st,Je),zy(s.dynamicLayoutVertexArray,C,xe),q.emplaceBack(Ot,Ot+1,Ot+2),q.emplaceBack(Ot+1,Ot+2,Ot+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ve[0]),we!==u.length-1&&ft===u[we+1].sectionIndex||s.programConfigurations.populatePaintArrays(X.length,w,w.index,{},U,me&&me[ft])}s.placedSymbolArray.emplaceBack(C.x,C.y,se,this.glyphOffsetArray.length-se,ce,M,O,C.segment,f?f[0]:0,f?f[1]:0,m[0],m[1],A,0,!1,0,k)}_addCollisionDebugVertex(s,u,f,m,b,w){return u.emplaceBack(0,0),s.emplaceBack(f.x,f.y,m,b,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(s,u,f,m,b,w,A){const C=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),M=C.vertexLength,O=b.layoutVertexArray,k=b.collisionVertexArray,U=A.anchorX,q=A.anchorY;this._addCollisionDebugVertex(O,k,w,U,q,new I(s,u)),this._addCollisionDebugVertex(O,k,w,U,q,new I(f,u)),this._addCollisionDebugVertex(O,k,w,U,q,new I(f,m)),this._addCollisionDebugVertex(O,k,w,U,q,new I(s,m)),C.vertexLength+=4;const X=b.indexArray;X.emplaceBack(M,M+1),X.emplaceBack(M+1,M+2),X.emplaceBack(M+2,M+3),X.emplaceBack(M+3,M),C.primitiveLength+=4}addDebugCollisionBoxes(s,u,f,m){for(let b=s;b<u;b++){const w=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,m?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Uy(kt,Kw.members,ct),this.iconCollisionBox=new Uy(kt,Kw.members,ct);for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(s,u,f,m,b,w,A,C,M){const O={};for(let k=u;k<f;k++){const U=s.get(k);O.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},O.textFeatureIndex=U.featureIndex;break}for(let k=m;k<b;k++){const U=s.get(k);O.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},O.verticalTextFeatureIndex=U.featureIndex;break}for(let k=w;k<A;k++){const U=s.get(k);O.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},O.iconFeatureIndex=U.featureIndex;break}for(let k=C;k<M;k++){const U=s.get(k);O.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},O.verticalIconFeatureIndex=U.featureIndex;break}return O}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,u){const f=s.placedSymbolArray.get(u),m=f.vertexStartIndex+4*f.numGlyphs;for(let b=f.vertexStartIndex;b<m;b+=4)s.indexArray.emplaceBack(b,b+1,b+2),s.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(s),f=Math.cos(s),m=[],b=[],w=[];for(let A=0;A<this.symbolInstances.length;++A){w.push(A);const C=this.symbolInstances.get(A);m.push(0|Math.round(u*C.anchorX+f*C.anchorY)),b.push(C.featureIndex)}return w.sort((A,C)=>m[A]-m[C]||b[C]-b[A]),w}addToSortKeyRanges(s,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((m,b,w)=>{m>=0&&w.indexOf(m)===b&&this.addIndicesForPlacedSymbol(this.text,m)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let pA,mA;rt("SymbolBucket",Nu,{omit:["layers","collisionBoxArray","features","compareText"]}),Nu.MAX_GLYPHS=65535,Nu.addDynamicAttributes=zy;var Gy={get paint(){return mA=mA||new pr({"icon-opacity":new Tt(Be.paint_symbol["icon-opacity"]),"icon-color":new Tt(Be.paint_symbol["icon-color"]),"icon-halo-color":new Tt(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tt(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tt(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new mt(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new mt(Be.paint_symbol["icon-translate-anchor"]),"text-opacity":new Tt(Be.paint_symbol["text-opacity"]),"text-color":new Tt(Be.paint_symbol["text-color"],{runtimeType:Ti,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Tt(Be.paint_symbol["text-halo-color"]),"text-halo-width":new Tt(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new Tt(Be.paint_symbol["text-halo-blur"]),"text-translate":new mt(Be.paint_symbol["text-translate"]),"text-translate-anchor":new mt(Be.paint_symbol["text-translate-anchor"])})},get layout(){return pA=pA||new pr({"symbol-placement":new mt(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new mt(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mt(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tt(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mt(Be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new mt(Be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new mt(Be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new mt(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new mt(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mt(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tt(Be.layout_symbol["icon-size"]),"icon-text-fit":new mt(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mt(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tt(Be.layout_symbol["icon-image"]),"icon-rotate":new Tt(Be.layout_symbol["icon-rotate"]),"icon-padding":new Tt(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new mt(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new Tt(Be.layout_symbol["icon-offset"]),"icon-anchor":new Tt(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mt(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mt(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mt(Be.layout_symbol["text-rotation-alignment"]),"text-field":new Tt(Be.layout_symbol["text-field"]),"text-font":new Tt(Be.layout_symbol["text-font"]),"text-size":new Tt(Be.layout_symbol["text-size"]),"text-max-width":new Tt(Be.layout_symbol["text-max-width"]),"text-line-height":new mt(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new Tt(Be.layout_symbol["text-letter-spacing"]),"text-justify":new Tt(Be.layout_symbol["text-justify"]),"text-radial-offset":new Tt(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mt(Be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Tt(Be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Tt(Be.layout_symbol["text-anchor"]),"text-max-angle":new mt(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new mt(Be.layout_symbol["text-writing-mode"]),"text-rotate":new Tt(Be.layout_symbol["text-rotate"]),"text-padding":new mt(Be.layout_symbol["text-padding"]),"text-keep-upright":new mt(Be.layout_symbol["text-keep-upright"]),"text-transform":new Tt(Be.layout_symbol["text-transform"]),"text-offset":new Tt(Be.layout_symbol["text-offset"]),"text-allow-overlap":new mt(Be.layout_symbol["text-allow-overlap"]),"text-overlap":new mt(Be.layout_symbol["text-overlap"]),"text-ignore-placement":new mt(Be.layout_symbol["text-ignore-placement"]),"text-optional":new mt(Be.layout_symbol["text-optional"])})}};class gA{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:ds,this.defaultValue=s}evaluate(s){if(s.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(s.formattedSection))return u.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}rt("FormatSectionOverride",gA,{omit:["defaultValue"]});class am extends js{constructor(s){super(s,Gy)}recalculate(s,u){if(super.recalculate(s,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const m=[];for(const b of f)m.indexOf(b)<0&&m.push(b);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,u,f,m){const b=this.layout.get(s).evaluate(u,{},f,m),w=this._unevaluatedLayout._values[s];return w.isDataDriven()||fu(w.value)||!b?b:function(A,C){return C.replace(/{([^{}]+)}/g,(M,O)=>O in A?String(A[O]):"")}(u.properties,b)}createBucket(s){return new Nu(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of Gy.paint.overridableProperties){if(!am.hasPaintOverride(this.layout,s))continue;const u=this.paint.get(s),f=new gA(u),m=new zn(f,u.property.specification);let b=null;b=u.value.kind==="constant"||u.value.kind==="source"?new tc("source",m):new An("composite",m,u.value.zoomStops),this.paint._values[s]=new ms(u.property,b,u.parameters)}}_handleOverridablePaintPropertyUpdate(s,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&am.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,u){const f=s.get("text-field"),m=Gy.paint.properties[u];let b=!1;const w=A=>{for(const C of A)if(m.overrides&&m.overrides.hasOverride(C))return void(b=!0)};if(f.value.kind==="constant"&&f.value.value instanceof xn)w(f.value.value.sections);else if(f.value.kind==="source"){const A=M=>{b||(M instanceof Us&&sn(M.value)===Jr?w(M.value.sections):M instanceof hu?w(M.sections):M.eachChild(A))},C=f.value;C._styleExpression&&A(C._styleExpression.expression)}return b}}let _A;var bD={get paint(){return _A=_A||new pr({"background-color":new mt(Be.paint_background["background-color"]),"background-pattern":new Ad(Be.paint_background["background-pattern"]),"background-opacity":new mt(Be.paint_background["background-opacity"])})}};class wD extends js{constructor(s){super(s,bD)}}let yA;var AD={get paint(){return yA=yA||new pr({"raster-opacity":new mt(Be.paint_raster["raster-opacity"]),"raster-hue-rotate":new mt(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mt(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mt(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new mt(Be.paint_raster["raster-saturation"]),"raster-contrast":new mt(Be.paint_raster["raster-contrast"]),"raster-resampling":new mt(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new mt(Be.paint_raster["raster-fade-duration"])})}};class ED extends js{constructor(s){super(s,AD)}}class TD extends js{constructor(s){super(s,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class SD{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Vy=63710088e-1;class pl{constructor(s,u){if(isNaN(s)||isNaN(u))throw new Error(`Invalid LngLat object: (${s}, ${u})`);if(this.lng=+s,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new pl(W(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const u=Math.PI/180,f=this.lat*u,m=s.lat*u,b=Math.sin(f)*Math.sin(m)+Math.cos(f)*Math.cos(m)*Math.cos((s.lng-this.lng)*u);return Vy*Math.acos(Math.min(b,1))}static convert(s){if(s instanceof pl)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new pl(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new pl(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const vA=2*Math.PI*Vy;function xA(c){return vA*Math.cos(c*Math.PI/180)}function bA(c){return(180+c)/360}function wA(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function AA(c,s){return c/xA(s)}function jy(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class lm{constructor(s,u,f=0){this.x=+s,this.y=+u,this.z=+f}static fromLngLat(s,u=0){const f=pl.convert(s);return new lm(bA(f.lng),wA(f.lat),AA(u,f.lat))}toLngLat(){return new pl(360*this.x-180,jy(this.y))}toAltitude(){return this.z*xA(jy(this.y))}meterInMercatorCoordinateUnits(){return 1/vA*(s=jy(this.y),1/Math.cos(s*Math.PI/180));var s}}function EA(c,s,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[c*f-2*Math.PI*6378137/2,s*f-2*Math.PI*6378137/2]}class Hy{constructor(s,u,f){if(s<0||s>25||f<0||f>=Math.pow(2,s)||u<0||u>=Math.pow(2,s))throw new Error(`x=${u}, y=${f}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=u,this.y=f,this.key=jd(0,s,s,u,f)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,u,f){const m=(w=this.y,A=this.z,C=EA(256*(b=this.x),256*(w=Math.pow(2,A)-w-1),A),M=EA(256*(b+1),256*(w+1),A),C[0]+","+C[1]+","+M[0]+","+M[1]);var b,w,A,C,M;const O=function(k,U,q){let X,te="";for(let se=k;se>0;se--)X=1<<se-1,te+=(U&X?1:0)+(q&X?2:0);return te}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,m)}isChildOf(s){const u=this.z-s.z;return u>0&&s.x===this.x>>u&&s.y===this.y>>u}getTilePoint(s){const u=Math.pow(2,this.z);return new I((s.x*u-this.x)*Nn,(s.y*u-this.y)*Nn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class TA{constructor(s,u){this.wrap=s,this.canonical=u,this.key=jd(s,u.z,u.z,u.x,u.y)}}class vs{constructor(s,u,f,m,b){if(s<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${f}`);this.overscaledZ=s,this.wrap=u,this.canonical=new Hy(f,+m,+b),this.key=jd(u,s,f,m,b)}clone(){return new vs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-s;return s>this.canonical.z?new vs(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vs(s,this.wrap,s,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(s,u){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-s;return s>this.canonical.z?jd(this.wrap*+u,s,this.canonical.z,this.canonical.x,this.canonical.y):jd(this.wrap*+u,s,s,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const u=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>u&&s.canonical.y===this.canonical.y>>u}children(s){if(this.overscaledZ>=s)return[new vs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,m=2*this.canonical.y;return[new vs(u,this.wrap,u,f,m),new vs(u,this.wrap,u,f+1,m),new vs(u,this.wrap,u,f,m+1),new vs(u,this.wrap,u,f+1,m+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new vs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new vs(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new TA(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new lm(s.x-this.wrap,s.y))}}function jd(c,s,u,f,m){(c*=2)<0&&(c=-1*c-1);const b=1<<u;return(b*b*c+b*m+f).toString(36)+u.toString(36)+s.toString(36)}rt("CanonicalTileID",Hy),rt("OverscaledTileID",vs,{omit:["posMatrix"]});class SA{constructor(s,u,f,m=1,b=1,w=1,A=0){if(this.uid=s,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void Ue(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const C=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=b,this.blueFactor=w,this.baseShift=A;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<C;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(C,M)]=this.data[this._idx(C-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,C)]=this.data[this._idx(M,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<C;M++)for(let O=0;O<C;O++){const k=this.get(M,O);k>this.max&&(this.max=k),k<this.min&&(this.min=k)}}get(s,u){const f=new Uint8Array(this.data.buffer),m=4*this._idx(s,u);return this.unpack(f[m],f[m+1],f[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,u){if(s<-1||s>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(s+1)}unpack(s,u,f){return s*this.redFactor+u*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new ys({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,u,f){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let m=u*this.dim,b=u*this.dim+this.dim,w=f*this.dim,A=f*this.dim+this.dim;switch(u){case-1:m=b-1;break;case 1:b=m+1}switch(f){case-1:w=A-1;break;case 1:A=w+1}const C=-u*this.dim,M=-f*this.dim;for(let O=w;O<A;O++)for(let k=m;k<b;k++)this.data[this._idx(k,O)]=s.data[this._idx(k+C,O+M)]}}rt("DEMData",SA);class CA{constructor(s){this._stringToNumber={},this._numberToString=[];for(let u=0;u<s.length;u++){const f=s[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class IA{constructor(s,u,f,m,b){this.type="Feature",this._vectorTileFeature=s,s._z=u,s._x=f,s._y=m,this.properties=s.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(s[u]=this[u]);return s}}class PA{constructor(s,u){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new dc(Nn,16,0),this.grid3D=new dc(Nn,16,0),this.featureIndexArray=new ge,this.promoteId=u}insert(s,u,f,m,b,w){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,m,b);const C=w?this.grid3D:this.grid;for(let M=0;M<u.length;M++){const O=u[M],k=[1/0,1/0,-1/0,-1/0];for(let U=0;U<O.length;U++){const q=O[U];k[0]=Math.min(k[0],q.x),k[1]=Math.min(k[1],q.y),k[2]=Math.max(k[2],q.x),k[3]=Math.max(k[3],q.y)}k[0]<Nn&&k[1]<Nn&&k[2]>=0&&k[3]>=0&&C.insert(A,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new hl.VectorTile(new Ly(this.rawTileData)).layers,this.sourceLayerCoder=new CA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,u,f,m){this.loadVTLayers();const b=s.params||{},w=Nn/s.tileSize/s.scale,A=ld(b.filter),C=s.queryGeometry,M=s.queryPadding*w,O=BA(C),k=this.grid.query(O.minX-M,O.minY-M,O.maxX+M,O.maxY+M),U=BA(s.cameraQueryGeometry),q=this.grid3D.query(U.minX-M,U.minY-M,U.maxX+M,U.maxY+M,(se,ce,xe,me)=>function(we,Se,Fe,nt,dt){for(const Ye of we)if(Se<=Ye.x&&Fe<=Ye.y&&nt>=Ye.x&&dt>=Ye.y)return!0;const et=[new I(Se,Fe),new I(Se,dt),new I(nt,dt),new I(nt,Fe)];if(we.length>2){for(const Ye of et)if(Lu(we,Ye))return!0}for(let Ye=0;Ye<we.length-1;Ye++)if(rR(we[Ye],we[Ye+1],et))return!0;return!1}(s.cameraQueryGeometry,se-M,ce-M,xe+M,me+M));for(const se of q)k.push(se);k.sort(CD);const X={};let te;for(let se=0;se<k.length;se++){const ce=k[se];if(ce===te)continue;te=ce;const xe=this.featureIndexArray.get(ce);let me=null;this.loadMatchingFeature(X,xe.bucketIndex,xe.sourceLayerIndex,xe.featureIndex,A,b.layers,b.availableImages,u,f,m,(we,Se,Fe)=>(me||(me=yo(we)),Se.queryIntersectsFeature(C,we,Fe,me,this.z,s.transform,w,s.pixelPosMatrix)))}return X}loadMatchingFeature(s,u,f,m,b,w,A,C,M,O,k){const U=this.bucketLayerIDs[u];if(w&&!function(se,ce){for(let xe=0;xe<se.length;xe++)if(ce.indexOf(se[xe])>=0)return!0;return!1}(w,U))return;const q=this.sourceLayerCoder.decode(f),X=this.vtLayers[q].feature(m);if(b.needGeometry){const se=Xo(X,!0);if(!b.filter(new In(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!b.filter(new In(this.tileID.overscaledZ),X))return;const te=this.getId(X,q);for(let se=0;se<U.length;se++){const ce=U[se];if(w&&w.indexOf(ce)<0)continue;const xe=C[ce];if(!xe)continue;let me={};te&&O&&(me=O.getState(xe.sourceLayer||"_geojsonTileLayer",te));const we=Z({},M[ce]);we.paint=MA(we.paint,xe.paint,X,me,A),we.layout=MA(we.layout,xe.layout,X,me,A);const Se=!k||k(X,xe,me);if(!Se)continue;const Fe=new IA(X,this.z,this.x,this.y,te);Fe.layer=we;let nt=s[ce];nt===void 0&&(nt=s[ce]=[]),nt.push({featureIndex:m,feature:Fe,intersectionZ:Se})}}lookupSymbolFeatures(s,u,f,m,b,w,A,C){const M={};this.loadVTLayers();const O=ld(b);for(const k of s)this.loadMatchingFeature(M,f,m,k,O,w,A,C,u);return M}hasLayer(s){for(const u of this.bucketLayerIDs)for(const f of u)if(s===f)return!0;return!1}getId(s,u){let f=s.id;return this.promoteId&&(f=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof f=="boolean"&&(f=Number(f))),f}}function MA(c,s,u,f,m){return be(c,(b,w)=>{const A=s instanceof _c?s.get(w):null;return A&&A.evaluate?A.evaluate(u,f,m):A})}function BA(c){let s=1/0,u=1/0,f=-1/0,m=-1/0;for(const b of c)s=Math.min(s,b.x),u=Math.min(u,b.y),f=Math.max(f,b.x),m=Math.max(m,b.y);return{minX:s,minY:u,maxX:f,maxY:m}}function CD(c,s){return s-c}function LA(c,s,u,f,m){const b=[];for(let w=0;w<c.length;w++){const A=c[w];let C;for(let M=0;M<A.length-1;M++){let O=A[M],k=A[M+1];O.x<s&&k.x<s||(O.x<s?O=new I(s,O.y+(s-O.x)/(k.x-O.x)*(k.y-O.y))._round():k.x<s&&(k=new I(s,O.y+(s-O.x)/(k.x-O.x)*(k.y-O.y))._round()),O.y<u&&k.y<u||(O.y<u?O=new I(O.x+(u-O.y)/(k.y-O.y)*(k.x-O.x),u)._round():k.y<u&&(k=new I(O.x+(u-O.y)/(k.y-O.y)*(k.x-O.x),u)._round()),O.x>=f&&k.x>=f||(O.x>=f?O=new I(f,O.y+(f-O.x)/(k.x-O.x)*(k.y-O.y))._round():k.x>=f&&(k=new I(f,O.y+(f-O.x)/(k.x-O.x)*(k.y-O.y))._round()),O.y>=m&&k.y>=m||(O.y>=m?O=new I(O.x+(m-O.y)/(k.y-O.y)*(k.x-O.x),m)._round():k.y>=m&&(k=new I(O.x+(m-O.y)/(k.y-O.y)*(k.x-O.x),m)._round()),C&&O.equals(C[C.length-1])||(C=[O],b.push(C)),C.push(k)))))}}return b}rt("FeatureIndex",PA,{omit:["rawTileData","sourceLayerCoder"]});class ml extends I{constructor(s,u,f,m){super(s,u),this.angle=f,m!==void 0&&(this.segment=m)}clone(){return new ml(this.x,this.y,this.angle,this.segment)}}function RA(c,s,u,f,m){if(s.segment===void 0||u===0)return!0;let b=s,w=s.segment+1,A=0;for(;A>-u/2;){if(w--,w<0)return!1;A-=c[w].dist(b),b=c[w]}A+=c[w].dist(c[w+1]),w++;const C=[];let M=0;for(;A<u/2;){const O=c[w],k=c[w+1];if(!k)return!1;let U=c[w-1].angleTo(O)-O.angleTo(k);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:A,angleDelta:U}),M+=U;A-C[0].distance>f;)M-=C.shift().angleDelta;if(M>m)return!1;w++,A+=O.dist(k)}return!0}function DA(c){let s=0;for(let u=0;u<c.length-1;u++)s+=c[u].dist(c[u+1]);return s}function OA(c,s,u){return c?.6*s*u:0}function FA(c,s){return Math.max(c?c.right-c.left:0,s?s.right-s.left:0)}function ID(c,s,u,f,m,b){const w=OA(u,m,b),A=FA(u,f)*b;let C=0;const M=DA(c)/2;for(let O=0;O<c.length-1;O++){const k=c[O],U=c[O+1],q=k.dist(U);if(C+q>M){const X=(M-C)/q,te=Lr.number(k.x,U.x,X),se=Lr.number(k.y,U.y,X),ce=new ml(te,se,U.angleTo(k),O);return ce._round(),!w||RA(c,ce,A,w,s)?ce:void 0}C+=q}}function PD(c,s,u,f,m,b,w,A,C){const M=OA(f,b,w),O=FA(f,m),k=O*w,U=c[0].x===0||c[0].x===C||c[0].y===0||c[0].y===C;return s-k<s/4&&(s=k+s/4),kA(c,U?s/2*A%s:(O/2+2*b)*w*A%s,s,M,u,k,U,!1,C)}function kA(c,s,u,f,m,b,w,A,C){const M=b/2,O=DA(c);let k=0,U=s-u,q=[];for(let X=0;X<c.length-1;X++){const te=c[X],se=c[X+1],ce=te.dist(se),xe=se.angleTo(te);for(;U+u<k+ce;){U+=u;const me=(U-k)/ce,we=Lr.number(te.x,se.x,me),Se=Lr.number(te.y,se.y,me);if(we>=0&&we<C&&Se>=0&&Se<C&&U-M>=0&&U+M<=O){const Fe=new ml(we,Se,xe,X);Fe._round(),f&&!RA(c,Fe,b,f,m)||q.push(Fe)}}k+=ce}return A||q.length||w||(q=kA(c,k/2,u,f,m,b,w,!0,C)),q}rt("Anchor",ml);const Uu=Fr;function zA(c,s,u,f){const m=[],b=c.image,w=b.pixelRatio,A=b.paddedRect.w-2*Uu,C=b.paddedRect.h-2*Uu,M=c.right-c.left,O=c.bottom-c.top,k=b.stretchX||[[0,A]],U=b.stretchY||[[0,C]],q=(qe,st)=>qe+st[1]-st[0],X=k.reduce(q,0),te=U.reduce(q,0),se=A-X,ce=C-te;let xe=0,me=X,we=0,Se=te,Fe=0,nt=se,dt=0,et=ce;if(b.content&&f){const qe=b.content;xe=cm(k,0,qe[0]),we=cm(U,0,qe[1]),me=cm(k,qe[0],qe[2]),Se=cm(U,qe[1],qe[3]),Fe=qe[0]-xe,dt=qe[1]-we,nt=qe[2]-qe[0]-me,et=qe[3]-qe[1]-Se}const Ye=(qe,st,Je,Ve)=>{const bt=um(qe.stretch-xe,me,M,c.left),ft=hm(qe.fixed-Fe,nt,qe.stretch,X),Ot=um(st.stretch-we,Se,O,c.top),Tn=hm(st.fixed-dt,et,st.stretch,te),Mn=um(Je.stretch-xe,me,M,c.left),wi=hm(Je.fixed-Fe,nt,Je.stretch,X),ts=um(Ve.stretch-we,Se,O,c.top),_r=hm(Ve.fixed-dt,et,Ve.stretch,te),hi=new I(bt,Ot),Ii=new I(Mn,Ot),Xi=new I(Mn,ts),kr=new I(bt,ts),yr=new I(ft/w,Tn/w),di=new I(wi/w,_r/w),Ai=s*Math.PI/180;if(Ai){const zr=Math.sin(Ai),Nr=Math.cos(Ai),$n=[Nr,-zr,zr,Nr];hi._matMult($n),Ii._matMult($n),kr._matMult($n),Xi._matMult($n)}const ir=qe.stretch+qe.fixed,vr=st.stretch+st.fixed;return{tl:hi,tr:Ii,bl:kr,br:Xi,tex:{x:b.paddedRect.x+Uu+ir,y:b.paddedRect.y+Uu+vr,w:Je.stretch+Je.fixed-ir,h:Ve.stretch+Ve.fixed-vr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yr,pixelOffsetBR:di,minFontScaleX:nt/w/M,minFontScaleY:et/w/O,isSDF:u}};if(f&&(b.stretchX||b.stretchY)){const qe=NA(k,se,X),st=NA(U,ce,te);for(let Je=0;Je<qe.length-1;Je++){const Ve=qe[Je],bt=qe[Je+1];for(let ft=0;ft<st.length-1;ft++)m.push(Ye(Ve,st[ft],bt,st[ft+1]))}}else m.push(Ye({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:C+1}));return m}function cm(c,s,u){let f=0;for(const m of c)f+=Math.max(s,Math.min(u,m[1]))-Math.max(s,Math.min(u,m[0]));return f}function NA(c,s,u){const f=[{fixed:-Uu,stretch:0}];for(const[m,b]of c){const w=f[f.length-1];f.push({fixed:m-w.stretch,stretch:w.stretch}),f.push({fixed:m-w.stretch,stretch:w.stretch+(b-m)})}return f.push({fixed:s+Uu,stretch:u}),f}function um(c,s,u,f){return c/s*u+f}function hm(c,s,u,f){return c-s*u/f}class dm{constructor(s,u,f,m,b,w,A,C,M,O){if(this.boxStartIndex=s.length,M){let k=w.top,U=w.bottom;const q=w.collisionPadding;q&&(k-=q[1],U+=q[3]);let X=U-k;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{let k=w.top*A-C[0],U=w.bottom*A+C[2],q=w.left*A-C[3],X=w.right*A+C[1];const te=w.collisionPadding;if(te&&(q-=te[0]*A,k-=te[1]*A,X+=te[2]*A,U+=te[3]*A),O){const se=new I(q,k),ce=new I(X,k),xe=new I(q,U),me=new I(X,U),we=O*Math.PI/180;se._rotate(we),ce._rotate(we),xe._rotate(we),me._rotate(we),q=Math.min(se.x,ce.x,xe.x,me.x),X=Math.max(se.x,ce.x,xe.x,me.x),k=Math.min(se.y,ce.y,xe.y,me.y),U=Math.max(se.y,ce.y,xe.y,me.y)}s.emplaceBack(u.x,u.y,q,k,X,U,f,m,b)}this.boxEndIndex=s.length}}class MD{constructor(s=[],u=BD){if(this.data=s,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:u,compare:f}=this,m=u[s];for(;s>0;){const b=s-1>>1,w=u[b];if(f(m,w)>=0)break;u[s]=w,s=b}u[s]=m}_down(s){const{data:u,compare:f}=this,m=this.length>>1,b=u[s];for(;s<m;){let w=1+(s<<1),A=u[w];const C=w+1;if(C<this.length&&f(u[C],A)<0&&(w=C,A=u[C]),f(A,b)>=0)break;u[s]=A,s=w}u[s]=b}}function BD(c,s){return c<s?-1:c>s?1:0}function LD(c,s=1,u=!1){let f=1/0,m=1/0,b=-1/0,w=-1/0;const A=c[0];for(let q=0;q<A.length;q++){const X=A[q];(!q||X.x<f)&&(f=X.x),(!q||X.y<m)&&(m=X.y),(!q||X.x>b)&&(b=X.x),(!q||X.y>w)&&(w=X.y)}const C=Math.min(b-f,w-m);let M=C/2;const O=new MD([],RD);if(C===0)return new I(f,m);for(let q=f;q<b;q+=C)for(let X=m;X<w;X+=C)O.push(new Gu(q+M,X+M,M,c));let k=function(q){let X=0,te=0,se=0;const ce=q[0];for(let xe=0,me=ce.length,we=me-1;xe<me;we=xe++){const Se=ce[xe],Fe=ce[we],nt=Se.x*Fe.y-Fe.x*Se.y;te+=(Se.x+Fe.x)*nt,se+=(Se.y+Fe.y)*nt,X+=3*nt}return new Gu(te/X,se/X,0,q)}(c),U=O.length;for(;O.length;){const q=O.pop();(q.d>k.d||!k.d)&&(k=q,u&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,U)),q.max-k.d<=s||(M=q.h/2,O.push(new Gu(q.p.x-M,q.p.y-M,M,c)),O.push(new Gu(q.p.x+M,q.p.y-M,M,c)),O.push(new Gu(q.p.x-M,q.p.y+M,M,c)),O.push(new Gu(q.p.x+M,q.p.y+M,M,c)),U+=4)}return u&&(console.log(`num probes: ${U}`),console.log(`best distance: ${k.d}`)),k.p}function RD(c,s){return s.max-c.max}function Gu(c,s,u,f){this.p=new I(c,s),this.h=u,this.d=function(m,b){let w=!1,A=1/0;for(let C=0;C<b.length;C++){const M=b[C];for(let O=0,k=M.length,U=k-1;O<k;U=O++){const q=M[O],X=M[U];q.y>m.y!=X.y>m.y&&m.x<(X.x-q.x)*(m.y-q.y)/(X.y-q.y)+q.x&&(w=!w),A=Math.min(A,ww(m,q,X))}}return(w?1:-1)*Math.sqrt(A)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var qi;l.TextAnchorEnum=void 0,(qi=l.TextAnchorEnum||(l.TextAnchorEnum={}))[qi.center=1]="center",qi[qi.left=2]="left",qi[qi.right=3]="right",qi[qi.top=4]="top",qi[qi.bottom=5]="bottom",qi[qi["top-left"]=6]="top-left",qi[qi["top-right"]=7]="top-right",qi[qi["bottom-left"]=8]="bottom-left",qi[qi["bottom-right"]=9]="bottom-right";const gl=7,Wy=Number.POSITIVE_INFINITY;function UA(c,s){return s[1]!==Wy?function(u,f,m){let b=0,w=0;switch(f=Math.abs(f),m=Math.abs(m),u){case"top-right":case"top-left":case"top":w=m-gl;break;case"bottom-right":case"bottom-left":case"bottom":w=-m+gl}switch(u){case"top-right":case"bottom-right":case"right":b=-f;break;case"top-left":case"bottom-left":case"left":b=f}return[b,w]}(c,s[0],s[1]):function(u,f){let m=0,b=0;f<0&&(f=0);const w=f/Math.SQRT2;switch(u){case"top-right":case"top-left":b=w-gl;break;case"bottom-right":case"bottom-left":b=-w+gl;break;case"bottom":b=-f+gl;break;case"top":b=f-gl}switch(u){case"top-right":case"bottom-right":m=-w;break;case"top-left":case"bottom-left":m=w;break;case"left":m=f;break;case"right":m=-f}return[m,b]}(c,s[0])}function GA(c,s,u){var f;const m=c.layout,b=(f=m.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(s,{},u);if(b){const A=b.values,C=[];for(let M=0;M<A.length;M+=2){const O=C[M]=A[M],k=A[M+1].map(U=>U*bi);O.startsWith("top")?k[1]-=gl:O.startsWith("bottom")&&(k[1]+=gl),C[M+1]=k}return new Cn(C)}const w=m.get("text-variable-anchor");if(w){let A;A=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(s,{},u)*bi,Wy]:m.get("text-offset").evaluate(s,{},u).map(M=>M*bi);const C=[];for(const M of w)C.push(M,UA(M,A));return new Cn(C)}return null}function qy(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function DD(c,s,u,f,m,b,w,A,C,M,O){let k=b.textMaxSize.evaluate(s,{});k===void 0&&(k=w);const U=c.layers[0].layout,q=U.get("icon-offset").evaluate(s,{},O),X=jA(u.horizontal),te=w/24,se=c.tilePixelRatio*te,ce=c.tilePixelRatio*k/24,xe=c.tilePixelRatio*A,me=c.tilePixelRatio*U.get("symbol-spacing"),we=U.get("text-padding")*c.tilePixelRatio,Se=function(Ve,bt,ft,Ot=1){const Tn=Ve.get("icon-padding").evaluate(bt,{},ft),Mn=Tn&&Tn.values;return[Mn[0]*Ot,Mn[1]*Ot,Mn[2]*Ot,Mn[3]*Ot]}(U,s,O,c.tilePixelRatio),Fe=U.get("text-max-angle")/180*Math.PI,nt=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",dt=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",et=U.get("symbol-placement"),Ye=me/2,qe=U.get("icon-text-fit");let st;f&&qe!=="none"&&(c.allowVerticalPlacement&&u.vertical&&(st=dA(f,u.vertical,qe,U.get("icon-text-fit-padding"),q,te)),X&&(f=dA(f,X,qe,U.get("icon-text-fit-padding"),q,te)));const Je=(Ve,bt)=>{bt.x<0||bt.x>=Nn||bt.y<0||bt.y>=Nn||function(ft,Ot,Tn,Mn,wi,ts,_r,hi,Ii,Xi,kr,yr,di,Ai,ir,vr,zr,Nr,$n,$i,Wt,ns,Zi,xr,qs){const vo=ft.addToLineVertexArray(Ot,Tn);let xo,Ta,Xs,xs,Ur=0,Sa=0,qd=0,XA=0,e0=-1,t0=-1;const Ca={};let $A=gs("");if(ft.allowVerticalPlacement&&Mn.vertical){const rr=hi.layout.get("text-rotate").evaluate(Wt,{},xr)+90;Xs=new dm(Ii,Ot,Xi,kr,yr,Mn.vertical,di,Ai,ir,rr),_r&&(xs=new dm(Ii,Ot,Xi,kr,yr,_r,zr,Nr,ir,rr))}if(wi){const rr=hi.layout.get("icon-rotate").evaluate(Wt,{}),bs=hi.layout.get("icon-text-fit")!=="none",Ec=zA(wi,rr,Zi,bs),wo=_r?zA(_r,rr,Zi,bs):void 0;Ta=new dm(Ii,Ot,Xi,kr,yr,wi,zr,Nr,!1,rr),Ur=4*Ec.length;const Tc=ft.iconSizeData;let Zo=null;Tc.kind==="source"?(Zo=[$o*hi.layout.get("icon-size").evaluate(Wt,{})],Zo[0]>fl&&Ue(`${ft.layerIds[0]}: Value for "icon-size" is >= ${Vd}. Reduce your "icon-size".`)):Tc.kind==="composite"&&(Zo=[$o*ns.compositeIconSizes[0].evaluate(Wt,{},xr),$o*ns.compositeIconSizes[1].evaluate(Wt,{},xr)],(Zo[0]>fl||Zo[1]>fl)&&Ue(`${ft.layerIds[0]}: Value for "icon-size" is >= ${Vd}. Reduce your "icon-size".`)),ft.addSymbols(ft.icon,Ec,Zo,$i,$n,Wt,l.WritingMode.none,Ot,vo.lineStartIndex,vo.lineLength,-1,xr),e0=ft.icon.placedSymbolArray.length-1,wo&&(Sa=4*wo.length,ft.addSymbols(ft.icon,wo,Zo,$i,$n,Wt,l.WritingMode.vertical,Ot,vo.lineStartIndex,vo.lineLength,-1,xr),t0=ft.icon.placedSymbolArray.length-1)}const ZA=Object.keys(Mn.horizontal);for(const rr of ZA){const bs=Mn.horizontal[rr];if(!xo){$A=gs(bs.text);const wo=hi.layout.get("text-rotate").evaluate(Wt,{},xr);xo=new dm(Ii,Ot,Xi,kr,yr,bs,di,Ai,ir,wo)}const Ec=bs.positionedLines.length===1;if(qd+=VA(ft,Ot,bs,ts,hi,ir,Wt,vr,vo,Mn.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,Ec?ZA:[rr],Ca,e0,ns,xr),Ec)break}Mn.vertical&&(XA+=VA(ft,Ot,Mn.vertical,ts,hi,ir,Wt,vr,vo,l.WritingMode.vertical,["vertical"],Ca,t0,ns,xr));const kD=xo?xo.boxStartIndex:ft.collisionBoxArray.length,zD=xo?xo.boxEndIndex:ft.collisionBoxArray.length,ND=Xs?Xs.boxStartIndex:ft.collisionBoxArray.length,UD=Xs?Xs.boxEndIndex:ft.collisionBoxArray.length,GD=Ta?Ta.boxStartIndex:ft.collisionBoxArray.length,VD=Ta?Ta.boxEndIndex:ft.collisionBoxArray.length,jD=xs?xs.boxStartIndex:ft.collisionBoxArray.length,HD=xs?xs.boxEndIndex:ft.collisionBoxArray.length;let bo=-1;const pm=(rr,bs)=>rr&&rr.circleDiameter?Math.max(rr.circleDiameter,bs):bs;bo=pm(xo,bo),bo=pm(Xs,bo),bo=pm(Ta,bo),bo=pm(xs,bo);const JA=bo>-1?1:0;JA&&(bo*=qs/bi),ft.glyphOffsetArray.length>=Nu.MAX_GLYPHS&&Ue("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Wt.sortKey!==void 0&&ft.addToSortKeyRanges(ft.symbolInstances.length,Wt.sortKey);const WD=GA(hi,Wt,xr),[qD,XD]=function(rr,bs){const Ec=rr.length,wo=bs==null?void 0:bs.values;if((wo==null?void 0:wo.length)>0)for(let Tc=0;Tc<wo.length;Tc+=2){const Zo=wo[Tc+1];rr.emplaceBack(l.TextAnchorEnum[wo[Tc]],Zo[0],Zo[1])}return[Ec,rr.length]}(ft.textAnchorOffsets,WD);ft.symbolInstances.emplaceBack(Ot.x,Ot.y,Ca.right>=0?Ca.right:-1,Ca.center>=0?Ca.center:-1,Ca.left>=0?Ca.left:-1,Ca.vertical||-1,e0,t0,$A,kD,zD,ND,UD,GD,VD,jD,HD,Xi,qd,XA,Ur,Sa,JA,0,di,bo,qD,XD)}(c,bt,Ve,u,f,m,st,c.layers[0],c.collisionBoxArray,s.index,s.sourceLayerIndex,c.index,se,[we,we,we,we],nt,C,xe,Se,dt,q,s,b,M,O,w)};if(et==="line")for(const Ve of LA(s.geometry,0,0,Nn,Nn)){const bt=PD(Ve,me,Fe,u.vertical||X,f,24,ce,c.overscaling,Nn);for(const ft of bt)X&&OD(c,X.text,Ye,ft)||Je(Ve,ft)}else if(et==="line-center"){for(const Ve of s.geometry)if(Ve.length>1){const bt=ID(Ve,Fe,u.vertical||X,f,24,ce);bt&&Je(Ve,bt)}}else if(s.type==="Polygon")for(const Ve of Ey(s.geometry,0)){const bt=LD(Ve,16);Je(Ve[0],new ml(bt.x,bt.y,0))}else if(s.type==="LineString")for(const Ve of s.geometry)Je(Ve,new ml(Ve[0].x,Ve[0].y,0));else if(s.type==="Point")for(const Ve of s.geometry)for(const bt of Ve)Je([bt],new ml(bt.x,bt.y,0))}function VA(c,s,u,f,m,b,w,A,C,M,O,k,U,q,X){const te=function(xe,me,we,Se,Fe,nt,dt,et){const Ye=Se.layout.get("text-rotate").evaluate(nt,{})*Math.PI/180,qe=[];for(const st of me.positionedLines)for(const Je of st.positionedGlyphs){if(!Je.rect)continue;const Ve=Je.rect||{};let bt=sA+1,ft=!0,Ot=1,Tn=0;const Mn=(Fe||et)&&Je.vertical,wi=Je.metrics.advance*Je.scale/2;if(et&&me.verticalizable&&(Tn=st.lineOffset/2-(Je.imageName?-(bi-Je.metrics.width*Je.scale)/2:(Je.scale-1)*bi)),Je.imageName){const $n=dt[Je.imageName];ft=$n.sdf,Ot=$n.pixelRatio,bt=Fr/Ot}const ts=Fe?[Je.x+wi,Je.y]:[0,0];let _r=Fe?[0,0]:[Je.x+wi+we[0],Je.y+we[1]-Tn],hi=[0,0];Mn&&(hi=_r,_r=[0,0]);const Ii=(Je.metrics.left-bt)*Je.scale-wi+_r[0],Xi=(-Je.metrics.top-bt)*Je.scale+_r[1],kr=Ii+Ve.w*Je.scale/Ot,yr=Xi+Ve.h*Je.scale/Ot,di=new I(Ii,Xi),Ai=new I(kr,Xi),ir=new I(Ii,yr),vr=new I(kr,yr);if(Mn){const $n=new I(-wi,wi-Ud),$i=-Math.PI/2,Wt=bi/2-wi,ns=new I(5-Ud-Wt,-(Je.imageName?Wt:0)),Zi=new I(...hi);di._rotateAround($i,$n)._add(ns)._add(Zi),Ai._rotateAround($i,$n)._add(ns)._add(Zi),ir._rotateAround($i,$n)._add(ns)._add(Zi),vr._rotateAround($i,$n)._add(ns)._add(Zi)}if(Ye){const $n=Math.sin(Ye),$i=Math.cos(Ye),Wt=[$i,-$n,$n,$i];di._matMult(Wt),Ai._matMult(Wt),ir._matMult(Wt),vr._matMult(Wt)}const zr=new I(0,0),Nr=new I(0,0);qe.push({tl:di,tr:Ai,bl:ir,br:vr,tex:Ve,writingMode:me.writingMode,glyphOffset:ts,sectionIndex:Je.sectionIndex,isSDF:ft,pixelOffsetTL:zr,pixelOffsetBR:Nr,minFontScaleX:0,minFontScaleY:0})}return qe}(0,u,A,m,b,w,f,c.allowVerticalPlacement),se=c.textSizeData;let ce=null;se.kind==="source"?(ce=[$o*m.layout.get("text-size").evaluate(w,{})],ce[0]>fl&&Ue(`${c.layerIds[0]}: Value for "text-size" is >= ${Vd}. Reduce your "text-size".`)):se.kind==="composite"&&(ce=[$o*q.compositeTextSizes[0].evaluate(w,{},X),$o*q.compositeTextSizes[1].evaluate(w,{},X)],(ce[0]>fl||ce[1]>fl)&&Ue(`${c.layerIds[0]}: Value for "text-size" is >= ${Vd}. Reduce your "text-size".`)),c.addSymbols(c.text,te,ce,A,b,w,M,s,C.lineStartIndex,C.lineLength,U,X);for(const xe of O)k[xe]=c.text.placedSymbolArray.length-1;return 4*te.length}function jA(c){for(const s in c)return c[s];return null}function OD(c,s,u,f){const m=c.compareText;if(s in m){const b=m[s];for(let w=b.length-1;w>=0;w--)if(f.dist(b[w])<u)return!0}else m[s]=[];return m[s].push(f),!1}const HA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Xy{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,f]=new Uint8Array(s,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=f>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const b=HA[15&f];if(!b)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(s,2,1),[A]=new Uint32Array(s,4,1);return new Xy(A,w,b,s)}constructor(s,u=64,f=Float64Array,m){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=f,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const b=HA.indexOf(this.ArrayType),w=2*s*this.ArrayType.BYTES_PER_ELEMENT,A=s*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-A%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${f}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+A+C,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+w+A+C),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+A+C,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=s)}add(s,u){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=s,this.coords[this._pos++]=u,f}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return $y(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,u,f,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:w,nodeSize:A}=this,C=[0,b.length-1,0],M=[];for(;C.length;){const O=C.pop()||0,k=C.pop()||0,U=C.pop()||0;if(k-U<=A){for(let se=U;se<=k;se++){const ce=w[2*se],xe=w[2*se+1];ce>=s&&ce<=f&&xe>=u&&xe<=m&&M.push(b[se])}continue}const q=U+k>>1,X=w[2*q],te=w[2*q+1];X>=s&&X<=f&&te>=u&&te<=m&&M.push(b[q]),(O===0?s<=X:u<=te)&&(C.push(U),C.push(q-1),C.push(1-O)),(O===0?f>=X:m>=te)&&(C.push(q+1),C.push(k),C.push(1-O))}return M}within(s,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:b,nodeSize:w}=this,A=[0,m.length-1,0],C=[],M=f*f;for(;A.length;){const O=A.pop()||0,k=A.pop()||0,U=A.pop()||0;if(k-U<=w){for(let se=U;se<=k;se++)qA(b[2*se],b[2*se+1],s,u)<=M&&C.push(m[se]);continue}const q=U+k>>1,X=b[2*q],te=b[2*q+1];qA(X,te,s,u)<=M&&C.push(m[q]),(O===0?s-f<=X:u-f<=te)&&(A.push(U),A.push(q-1),A.push(1-O)),(O===0?s+f>=X:u+f>=te)&&(A.push(q+1),A.push(k),A.push(1-O))}return C}}function $y(c,s,u,f,m,b){if(m-f<=u)return;const w=f+m>>1;WA(c,s,w,f,m,b),$y(c,s,u,f,w-1,1-b),$y(c,s,u,w+1,m,1-b)}function WA(c,s,u,f,m,b){for(;m>f;){if(m-f>600){const M=m-f+1,O=u-f+1,k=Math.log(M),U=.5*Math.exp(2*k/3),q=.5*Math.sqrt(k*U*(M-U)/M)*(O-M/2<0?-1:1);WA(c,s,u,Math.max(f,Math.floor(u-O*U/M+q)),Math.min(m,Math.floor(u+(M-O)*U/M+q)),b)}const w=s[2*u+b];let A=f,C=m;for(Hd(c,s,f,u),s[2*m+b]>w&&Hd(c,s,f,m);A<C;){for(Hd(c,s,A,C),A++,C--;s[2*A+b]<w;)A++;for(;s[2*C+b]>w;)C--}s[2*f+b]===w?Hd(c,s,f,C):(C++,Hd(c,s,C,m)),C<=u&&(f=C+1),u<=C&&(m=C-1)}}function Hd(c,s,u,f){Zy(c,u,f),Zy(s,2*u,2*f),Zy(s,2*u+1,2*f+1)}function Zy(c,s,u){const f=c[s];c[s]=c[u],c[u]=f}function qA(c,s,u,f){const m=c-u,b=s-f;return m*m+b*b}var Jy;l.PerformanceMarkers=void 0,(Jy=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",Jy.load="load",Jy.fullLoad="fullLoad";let fm=null,Wd=[];const Ky=1e3/60,Yy="loadTime",Qy="fullLoadTime",FD={mark(c){performance.mark(c)},frame(c){const s=c;fm!=null&&Wd.push(s-fm),fm=s},clearMetrics(){fm=null,Wd=[],performance.clearMeasures(Yy),performance.clearMeasures(Qy);for(const c in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[c])},getPerformanceMetrics(){performance.measure(Yy,l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure(Qy,l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const c=performance.getEntriesByName(Yy)[0].duration,s=performance.getEntriesByName(Qy)[0].duration,u=Wd.length,f=1/(Wd.reduce((b,w)=>b+w,0)/u/1e3),m=Wd.filter(b=>b>Ky).reduce((b,w)=>b+(w-Ky)/Ky,0);return{loadTime:c,fullLoadTime:s,fps:f,percentDroppedFrames:m/(u+m)*100,totalFrames:u}}};l.AJAXError=tn,l.ARRAY_TYPE=Ru,l.Actor=class{constructor(c,s,u){this.receive=f=>{const m=f.data,b=m.id;if(b&&(!m.targetMapId||this.mapId===m.targetMapId))if(m.type==="<cancel>"){delete this.tasks[b];const w=this.cancelCallbacks[b];delete this.cancelCallbacks[b],w&&w()}else Lt()||m.mustQueue?(this.tasks[b]=m,this.taskQueue.push(b),this.invoker.trigger()):this.processTask(b,m)},this.process=()=>{if(!this.taskQueue.length)return;const f=this.taskQueue.shift(),m=this.tasks[f];delete this.tasks[f],this.taskQueue.length&&this.invoker.trigger(),m&&this.processTask(f,m)},this.target=c,this.parent=s,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new SD(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Lt()?c:window}send(c,s,u,f,m=!1){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[b]=u);const w=Rt(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:c,hasCallback:!!u,targetMapId:f,mustQueue:m,sourceMapId:this.mapId,data:fc(s,w)},w),{cancel:()=>{u&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}processTask(c,s){if(s.type==="<response>"){const u=this.callbacks[c];delete this.callbacks[c],u&&(s.error?u(ya(s.error)):u(null,ya(s.data)))}else{let u=!1;const f=Rt(this.globalScope)?void 0:[],m=s.hasCallback?(A,C)=>{u=!0,delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:A?fc(A):null,data:fc(C,f)},f)}:A=>{u=!0};let b=null;const w=ya(s.data);if(this.parent[s.type])b=this.parent[s.type](s.sourceMapId,w,m);else if(this.parent.getWorkerSource){const A=s.type.split(".");b=this.parent.getWorkerSource(s.sourceMapId,A[0],w.source)[A[1]](w,m)}else m(new Error(`Could not find function ${s.type}`));!u&&b&&b.cancel&&(this.cancelCallbacks[c]=b.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=Ld,l.CanonicalTileID=Hy,l.CollisionBoxArray=T,l.CollisionCircleLayoutArray=class extends Cd{},l.Color=wt,l.DEMData=SA,l.DataConstantProperty=mt,l.DictionaryCoder=CA,l.EXTENT=Nn,l.ErrorEvent=er,l.EvaluationParameters=In,l.Event=gn,l.Evented=ur,l.FeatureIndex=PA,l.FillBucket=Cy,l.FillExtrusionBucket=Py,l.GeoJSONFeature=IA,l.ImageAtlas=aA,l.ImagePosition=Dy,l.KDBush=Xy,l.LineBucket=My,l.LineStripIndexArray=class extends g{},l.LngLat=pl,l.MercatorCoordinate=lm,l.ONE_EM=bi,l.OverscaledTileID=vs,l.PerformanceUtils=FD,l.Point=I,l.Pos3dArray=class extends vc{},l.PosArray=Ae,l.Properties=pr,l.Protobuf=Ly,l.QuadTriangleArray=class extends Mu{},l.RGBAImage=ys,l.RasterBoundsArray=class extends xc{},l.RequestPerformance=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},l.SegmentVector=xt,l.SymbolBucket=Nu,l.Transitionable=Wp,l.TriangleIndexArray=yt,l.Uniform1f=vi,l.Uniform1i=class extends ti{constructor(c,s){super(c,s),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},l.Uniform2f=class extends ti{constructor(c,s){super(c,s),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},l.Uniform3f=class extends ti{constructor(c,s){super(c,s),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},l.Uniform4f=Hi,l.UniformColor=cl,l.UniformMatrix4f=class extends ti{constructor(c,s){super(c,s),this.current=xi}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let s=1;s<16;s++)if(c[s]!==this.current[s]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},l.UnwrappedTileID=TA,l.ValidationError=We,l.ZoomHistory=pd,l.addDynamicAttributes=zy,l.arrayBufferToImage=function(c,s){const u=new Image;u.onload=()=>{s(null,u),URL.revokeObjectURL(u.src),u.onload=null,window.requestAnimationFrame(()=>{u.src=ai})},u.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(c)],{type:"image/png"});u.src=c.byteLength?URL.createObjectURL(f):ai},l.arrayBufferToImageBitmap=function(c,s){const u=new Blob([new Uint8Array(c)],{type:"image/png"});createImageBitmap(u).then(f=>{s(null,f)}).catch(f=>{s(new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},l.asyncAll=function(c,s,u){if(!c.length)return u(null,[]);let f=c.length;const m=new Array(c.length);let b=null;c.forEach((w,A)=>{s(w,(C,M)=>{C&&(b=C),m[A]=M,--f==0&&u(b,m)})})},l.bezier=J,l.browser=At,l.clamp=j,l.clipLine=LA,l.clone=function(c){var s=new Ru(16);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],s},l.clone$1=Le,l.collisionCircleLayout=eD,l.config=Pt,l.copy=function(c,s){return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},l.create=function(){var c=new Ru(16);return Ru!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},l.createExpression=jt,l.createFilter=ld,l.createLayout=ei,l.createStyleLayer=function(c){if(c.type==="custom")return new TD(c);switch(c.type){case"background":return new wD(c);case"circle":return new aR(c);case"fill":return new CR(c);case"fill-extrusion":return new VR(c);case"heatmap":return new cR(c);case"hillshade":return new hR(c);case"line":return new JR(c);case"raster":return new ED(c);case"symbol":return new am(c)}},l.deepEqual=function c(s,u){if(Array.isArray(s)){if(!Array.isArray(u)||s.length!==u.length)return!1;for(let f=0;f<s.length;f++)if(!c(s[f],u[f]))return!1;return!0}if(typeof s=="object"&&s!==null&&u!==null){if(typeof u!="object"||Object.keys(s).length!==Object.keys(u).length)return!1;for(const f in s)if(!c(s[f],u[f]))return!1;return!0}return s===u},l.defaultEasing=ue,l.derefLayers=function(c){c=c.slice();const s=Object.create(null);for(let u=0;u<c.length;u++)s[c[u].id]=c[u];for(let u=0;u<c.length;u++)"ref"in c[u]&&(c[u]=Xr(c[u],s[c[u].ref]));return c},l.diffStyles=function(c,s){if(!c)return[{command:Gt.setStyle,args:[s]}];let u=[];try{if(!Ut(c.version,s.version))return[{command:Gt.setStyle,args:[s]}];Ut(c.center,s.center)||u.push({command:Gt.setCenter,args:[s.center]}),Ut(c.zoom,s.zoom)||u.push({command:Gt.setZoom,args:[s.zoom]}),Ut(c.bearing,s.bearing)||u.push({command:Gt.setBearing,args:[s.bearing]}),Ut(c.pitch,s.pitch)||u.push({command:Gt.setPitch,args:[s.pitch]}),Ut(c.sprite,s.sprite)||u.push({command:Gt.setSprite,args:[s.sprite]}),Ut(c.glyphs,s.glyphs)||u.push({command:Gt.setGlyphs,args:[s.glyphs]}),Ut(c.transition,s.transition)||u.push({command:Gt.setTransition,args:[s.transition]}),Ut(c.light,s.light)||u.push({command:Gt.setLight,args:[s.light]});const f={},m=[];(function(w,A,C,M){let O;for(O in A=A||{},w=w||{})Object.prototype.hasOwnProperty.call(w,O)&&(Object.prototype.hasOwnProperty.call(A,O)||zs(O,C,M));for(O in A)Object.prototype.hasOwnProperty.call(A,O)&&(Object.prototype.hasOwnProperty.call(w,O)?Ut(w[O],A[O])||(w[O].type==="geojson"&&A[O].type==="geojson"&&Li(w,A,O)?C.push({command:Gt.setGeoJSONSourceData,args:[O,A[O].data]}):lo(O,A,C,M)):ks(O,A,C))})(c.sources,s.sources,m,f);const b=[];c.layers&&c.layers.forEach(w=>{f[w.source]?u.push({command:Gt.removeLayer,args:[w.id]}):b.push(w)}),u=u.concat(m),function(w,A,C){A=A||[];const M=(w=w||[]).map(ha),O=A.map(ha),k=w.reduce(No,{}),U=A.reduce(No,{}),q=M.slice(),X=Object.create(null);let te,se,ce,xe,me,we,Se;for(te=0,se=0;te<M.length;te++)ce=M[te],Object.prototype.hasOwnProperty.call(U,ce)?se++:(C.push({command:Gt.removeLayer,args:[ce]}),q.splice(q.indexOf(ce,se),1));for(te=0,se=0;te<O.length;te++)ce=O[O.length-1-te],q[q.length-1-te]!==ce&&(Object.prototype.hasOwnProperty.call(k,ce)?(C.push({command:Gt.removeLayer,args:[ce]}),q.splice(q.lastIndexOf(ce,q.length-se),1)):se++,we=q[q.length-te],C.push({command:Gt.addLayer,args:[U[ce],we]}),q.splice(q.length-te,0,ce),X[ce]=!0);for(te=0;te<O.length;te++)if(ce=O[te],xe=k[ce],me=U[ce],!X[ce]&&!Ut(xe,me))if(Ut(xe.source,me.source)&&Ut(xe["source-layer"],me["source-layer"])&&Ut(xe.type,me.type)){for(Se in Sn(xe.layout,me.layout,C,ce,null,Gt.setLayoutProperty),Sn(xe.paint,me.paint,C,ce,null,Gt.setPaintProperty),Ut(xe.filter,me.filter)||C.push({command:Gt.setFilter,args:[ce,me.filter]}),Ut(xe.minzoom,me.minzoom)&&Ut(xe.maxzoom,me.maxzoom)||C.push({command:Gt.setLayerZoomRange,args:[ce,me.minzoom,me.maxzoom]}),xe)Object.prototype.hasOwnProperty.call(xe,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?Sn(xe[Se],me[Se],C,ce,Se.slice(6),Gt.setPaintProperty):Ut(xe[Se],me[Se])||C.push({command:Gt.setLayerProperty,args:[ce,Se,me[Se]]}));for(Se in me)Object.prototype.hasOwnProperty.call(me,Se)&&!Object.prototype.hasOwnProperty.call(xe,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?Sn(xe[Se],me[Se],C,ce,Se.slice(6),Gt.setPaintProperty):Ut(xe[Se],me[Se])||C.push({command:Gt.setLayerProperty,args:[ce,Se,me[Se]]}))}else C.push({command:Gt.removeLayer,args:[ce]}),we=q[q.lastIndexOf(ce)+1],C.push({command:Gt.addLayer,args:[me,we]})}(b,s.layers,u)}catch(f){console.warn("Unable to compute style diff:",f),u=[{command:Gt.setStyle,args:[s]}]}return u},l.dot=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]*s[3]},l.earthRadius=Vy,l.emitValidationErrors=wu,l.emptyStyle=function(){const c={},s=Be.$version;for(const u in Be.$root){const f=Be.$root[u];if(f.required){let m=null;m=u==="version"?s:f.type==="array"?[]:{},m!=null&&(c[u]=m)}}return c},l.equals=function(c,s){var u=c[0],f=c[1],m=c[2],b=c[3],w=c[4],A=c[5],C=c[6],M=c[7],O=c[8],k=c[9],U=c[10],q=c[11],X=c[12],te=c[13],se=c[14],ce=c[15],xe=s[0],me=s[1],we=s[2],Se=s[3],Fe=s[4],nt=s[5],dt=s[6],et=s[7],Ye=s[8],qe=s[9],st=s[10],Je=s[11],Ve=s[12],bt=s[13],ft=s[14],Ot=s[15];return Math.abs(u-xe)<=gr*Math.max(1,Math.abs(u),Math.abs(xe))&&Math.abs(f-me)<=gr*Math.max(1,Math.abs(f),Math.abs(me))&&Math.abs(m-we)<=gr*Math.max(1,Math.abs(m),Math.abs(we))&&Math.abs(b-Se)<=gr*Math.max(1,Math.abs(b),Math.abs(Se))&&Math.abs(w-Fe)<=gr*Math.max(1,Math.abs(w),Math.abs(Fe))&&Math.abs(A-nt)<=gr*Math.max(1,Math.abs(A),Math.abs(nt))&&Math.abs(C-dt)<=gr*Math.max(1,Math.abs(C),Math.abs(dt))&&Math.abs(M-et)<=gr*Math.max(1,Math.abs(M),Math.abs(et))&&Math.abs(O-Ye)<=gr*Math.max(1,Math.abs(O),Math.abs(Ye))&&Math.abs(k-qe)<=gr*Math.max(1,Math.abs(k),Math.abs(qe))&&Math.abs(U-st)<=gr*Math.max(1,Math.abs(U),Math.abs(st))&&Math.abs(q-Je)<=gr*Math.max(1,Math.abs(q),Math.abs(Je))&&Math.abs(X-Ve)<=gr*Math.max(1,Math.abs(X),Math.abs(Ve))&&Math.abs(te-bt)<=gr*Math.max(1,Math.abs(te),Math.abs(bt))&&Math.abs(se-ft)<=gr*Math.max(1,Math.abs(se),Math.abs(ft))&&Math.abs(ce-Ot)<=gr*Math.max(1,Math.abs(ce),Math.abs(Ot))},l.evaluateSizeForFeature=function(c,{uSize:s,uSizeT:u},{lowerSize:f,upperSize:m}){return c.kind==="source"?f/$o:c.kind==="composite"?Lr.number(f/$o,m/$o,u):s},l.evaluateSizeForZoom=function(c,s){let u=0,f=0;if(c.kind==="constant")f=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:m,minZoom:b,maxZoom:w}=c,A=m?j(Rr.interpolationFactor(m,s,b,w),0,1):0;c.kind==="camera"?f=Lr.number(c.minSize,c.maxSize,A):u=A}return{uSizeT:u,uSize:f}},l.evented=bd,l.extend=Z,l.filterObject=Ee,l.findLineIntersection=function(c,s,u,f){const m=s.y-c.y,b=s.x-c.x,w=f.y-u.y,A=f.x-u.x,C=w*b-A*m;if(C===0)return null;const M=(A*(c.y-u.y)-w*(c.x-u.x))/C;return new I(c.x+M*b,c.y+M*m)},l.fromScaling=function(c,s){return c[0]=s[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=s[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},l.getAnchorAlignment=Fy,l.getAnchorJustification=qy,l.getArrayBuffer=Qi,l.getDefaultExportFromCjs=_,l.getJSON=function(c,s){return Pr(Z(c,{type:"json"}),s)},l.getOverlapMode=ky,l.getProtocolAction=Kn,l.getRTLTextPluginStatus=wd,l.getReferrer=$t,l.getVideo=function(c,s){const u=window.document.createElement("video");u.muted=!0,u.onloadstart=function(){s(null,u)};for(let f=0;f<c.length;f++){const m=window.document.createElement("source");mn(c[f])||(u.crossOrigin="Anonymous"),m.src=c[f],u.appendChild(m)}return{cancel:()=>{}}},l.groupByLayout=function(c,s){const u={};for(let m=0;m<c.length;m++){const b=s&&s[c[m].id]||oy(c[m]);s&&(s[c[m].id]=b);let w=u[b];w||(w=u[b]=[]),w.push(c[m])}const f=[];for(const m in u)f.push(u[m]);return f},l.identity=_y,l.interpolate=Lr,l.invert=function(c,s){var u=s[0],f=s[1],m=s[2],b=s[3],w=s[4],A=s[5],C=s[6],M=s[7],O=s[8],k=s[9],U=s[10],q=s[11],X=s[12],te=s[13],se=s[14],ce=s[15],xe=u*A-f*w,me=u*C-m*w,we=u*M-b*w,Se=f*C-m*A,Fe=f*M-b*A,nt=m*M-b*C,dt=O*te-k*X,et=O*se-U*X,Ye=O*ce-q*X,qe=k*se-U*te,st=k*ce-q*te,Je=U*ce-q*se,Ve=xe*Je-me*st+we*qe+Se*Ye-Fe*et+nt*dt;return Ve?(c[0]=(A*Je-C*st+M*qe)*(Ve=1/Ve),c[1]=(m*st-f*Je-b*qe)*Ve,c[2]=(te*nt-se*Fe+ce*Se)*Ve,c[3]=(U*Fe-k*nt-q*Se)*Ve,c[4]=(C*Ye-w*Je-M*et)*Ve,c[5]=(u*Je-m*Ye+b*et)*Ve,c[6]=(se*we-X*nt-ce*me)*Ve,c[7]=(O*nt-U*we+q*me)*Ve,c[8]=(w*st-A*Ye+M*dt)*Ve,c[9]=(f*Ye-u*st-b*dt)*Ve,c[10]=(X*Fe-te*we+ce*xe)*Ve,c[11]=(k*we-O*Fe-q*xe)*Ve,c[12]=(A*et-w*qe-C*dt)*Ve,c[13]=(u*qe-f*et+m*dt)*Ve,c[14]=(te*me-X*Se-se*xe)*Ve,c[15]=(O*Se-k*me+U*xe)*Ve,c):null},l.isImageBitmap=Jn,l.isSafari=Rt,l.isWorker=Lt,l.keysDifference=function(c,s){const u=[];for(const f in c)f in s||u.push(f);return u},l.lazyLoadRTLTextPlugin=function(){Qr.isLoading()||Qr.isLoaded()||wd()!=="deferred"||Hp()},l.makeRequest=Pr,l.mapObject=be,l.mercatorXfromLng=bA,l.mercatorYfromLat=wA,l.mercatorZfromAltitude=AA,l.mul=oR,l.mul$1=function(c,s,u){return c[0]=s[0]*u[0],c[1]=s[1]*u[1],c[2]=s[2]*u[2],c[3]=s[3]*u[3],c},l.multiply=Sw,l.nextPowerOfTwo=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},l.operations=Gt,l.ortho=function(c,s,u,f,m,b,w){var A=1/(s-u),C=1/(f-m),M=1/(b-w);return c[0]=-2*A,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*C,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*M,c[11]=0,c[12]=(s+u)*A,c[13]=(m+f)*C,c[14]=(w+b)*M,c[15]=1,c},l.parseCacheControl=function(c){const s={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,m,b)=>{const w=m||b;return s[f]=!w||w.toLowerCase(),""}),s["max-age"]){const u=parseInt(s["max-age"],10);isNaN(u)?delete s["max-age"]:s["max-age"]=u}return s},l.parseGlyphPbf=function(c){return new Ly(c).readFields(hD,[])},l.pbf=Yw,l.performSymbolLayout=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=Nn/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const s=c.bucket.layers[0],u=s.layout,f=s._unevaluatedLayout._values,m={layoutIconSize:f["icon-size"].possiblyEvaluate(new In(c.bucket.zoom+1),c.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new In(c.bucket.zoom+1),c.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new In(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:O}=c.bucket.textSizeData;m.compositeTextSizes=[f["text-size"].possiblyEvaluate(new In(M),c.canonical),f["text-size"].possiblyEvaluate(new In(O),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:O}=c.bucket.iconSizeData;m.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new In(M),c.canonical),f["icon-size"].possiblyEvaluate(new In(O),c.canonical)]}const b=u.get("text-line-height")*bi,w=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",A=u.get("text-keep-upright"),C=u.get("text-size");for(const M of c.bucket.features){const O=u.get("text-font").evaluate(M,{},c.canonical).join(","),k=C.evaluate(M,{},c.canonical),U=m.layoutTextSize.evaluate(M,{},c.canonical),q=m.layoutIconSize.evaluate(M,{},c.canonical),X={horizontal:{},vertical:void 0},te=M.text;let se,ce=[0,0];if(te){const we=te.toString(),Se=u.get("text-letter-spacing").evaluate(M,{},c.canonical)*bi,Fe=Vp(we)?Se:0,nt=u.get("text-anchor").evaluate(M,{},c.canonical),dt=GA(s,M,c.canonical);if(!dt){const Je=u.get("text-radial-offset").evaluate(M,{},c.canonical);ce=Je?UA(nt,[Je*bi,Wy]):u.get("text-offset").evaluate(M,{},c.canonical).map(Ve=>Ve*bi)}let et=w?"center":u.get("text-justify").evaluate(M,{},c.canonical);const Ye=u.get("symbol-placement"),qe=Ye==="point"?u.get("text-max-width").evaluate(M,{},c.canonical)*bi:0,st=()=>{c.bucket.allowVerticalPlacement&&Au(we)&&(X.vertical=rm(te,c.glyphMap,c.glyphPositions,c.imagePositions,O,qe,b,nt,"left",Fe,ce,l.WritingMode.vertical,!0,Ye,U,k))};if(!w&&dt){const Je=new Set;if(et==="auto")for(let bt=0;bt<dt.values.length;bt+=2)Je.add(qy(dt.values[bt]));else Je.add(et);let Ve=!1;for(const bt of Je)if(!X.horizontal[bt])if(Ve)X.horizontal[bt]=X.horizontal[0];else{const ft=rm(te,c.glyphMap,c.glyphPositions,c.imagePositions,O,qe,b,"center",bt,Fe,ce,l.WritingMode.horizontal,!1,Ye,U,k);ft&&(X.horizontal[bt]=ft,Ve=ft.positionedLines.length===1)}st()}else{et==="auto"&&(et=qy(nt));const Je=rm(te,c.glyphMap,c.glyphPositions,c.imagePositions,O,qe,b,nt,et,Fe,ce,l.WritingMode.horizontal,!1,Ye,U,k);Je&&(X.horizontal[et]=Je),st(),Au(we)&&w&&A&&(X.vertical=rm(te,c.glyphMap,c.glyphPositions,c.imagePositions,O,qe,b,nt,et,Fe,ce,l.WritingMode.vertical,!1,Ye,U,k))}}let xe=!1;if(M.icon&&M.icon.name){const we=c.imageMap[M.icon.name];we&&(se=_D(c.imagePositions[M.icon.name],u.get("icon-offset").evaluate(M,{},c.canonical),u.get("icon-anchor").evaluate(M,{},c.canonical)),xe=!!we.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=xe:c.bucket.sdfIcons!==xe&&Ue("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(we.pixelRatio!==c.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const me=jA(X.horizontal)||X.vertical;c.bucket.iconsInText=!!me&&me.iconsInText,(me||se)&&DD(c.bucket,M,X,se,c.imageMap,m,U,q,ce,xe,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},l.perspective=function(c,s,u,f,m){var b,w=1/Math.tan(s/2);return c[0]=w/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=w,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,m!=null&&m!==1/0?(c[10]=(m+f)*(b=1/(f-m)),c[14]=2*m*f*b):(c[10]=-1,c[14]=-2*f),c},l.pick=function(c,s){const u={};for(let f=0;f<s.length;f++){const m=s[f];m in c&&(u[m]=c[m])}return u},l.plugin=Qr,l.pointGeometry=v,l.polygonIntersectsPolygon=xw,l.potpack=oA,l.register=rt,l.registerForPluginStateChange=function(c){return c({pluginStatus:fr,pluginURL:Ho}),bd.on("pluginStateChange",c),c},l.renderColorRamp=Bw,l.rotateX=function(c,s,u){var f=Math.sin(u),m=Math.cos(u),b=s[4],w=s[5],A=s[6],C=s[7],M=s[8],O=s[9],k=s[10],U=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=b*m+M*f,c[5]=w*m+O*f,c[6]=A*m+k*f,c[7]=C*m+U*f,c[8]=M*m-b*f,c[9]=O*m-w*f,c[10]=k*m-A*f,c[11]=U*m-C*f,c},l.rotateZ=function(c,s,u){var f=Math.sin(u),m=Math.cos(u),b=s[0],w=s[1],A=s[2],C=s[3],M=s[4],O=s[5],k=s[6],U=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=b*m+M*f,c[1]=w*m+O*f,c[2]=A*m+k*f,c[3]=C*m+U*f,c[4]=M*m-b*f,c[5]=O*m-w*f,c[6]=k*m-A*f,c[7]=U*m-C*f,c},l.sameOrigin=mn,l.scale=function(c,s,u){var f=u[0],m=u[1],b=u[2];return c[0]=s[0]*f,c[1]=s[1]*f,c[2]=s[2]*f,c[3]=s[3]*f,c[4]=s[4]*m,c[5]=s[5]*m,c[6]=s[6]*m,c[7]=s[7]*m,c[8]=s[8]*b,c[9]=s[9]*b,c[10]=s[10]*b,c[11]=s[11]*b,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},l.setRTLTextPlugin=function(c,s,u=!1){if(fr===gd||fr===gc||fr===_d)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ho=At.resolveURL(c),fr=gd,yd=s,xd(),u||Hp()},l.sphericalToCartesian=function([c,s,u]){return s+=90,s*=Math.PI/180,u*=Math.PI/180,{x:c*Math.cos(s)*Math.sin(u),y:c*Math.sin(s)*Math.sin(u),z:c*Math.cos(u)}},l.toEvaluationFeature=Xo,l.transformMat4=Kp,l.translate=function(c,s,u){var f,m,b,w,A,C,M,O,k,U,q,X,te=u[0],se=u[1],ce=u[2];return s===c?(c[12]=s[0]*te+s[4]*se+s[8]*ce+s[12],c[13]=s[1]*te+s[5]*se+s[9]*ce+s[13],c[14]=s[2]*te+s[6]*se+s[10]*ce+s[14],c[15]=s[3]*te+s[7]*se+s[11]*ce+s[15]):(m=s[1],b=s[2],w=s[3],A=s[4],C=s[5],M=s[6],O=s[7],k=s[8],U=s[9],q=s[10],X=s[11],c[0]=f=s[0],c[1]=m,c[2]=b,c[3]=w,c[4]=A,c[5]=C,c[6]=M,c[7]=O,c[8]=k,c[9]=U,c[10]=q,c[11]=X,c[12]=f*te+A*se+k*ce+s[12],c[13]=m*te+C*se+U*ce+s[13],c[14]=b*te+M*se+q*ce+s[14],c[15]=w*te+O*se+X*ce+s[15]),c},l.triggerPluginCompletionEvent=vd,l.unicodeBlockLookup=Qe,l.uniqueId=function(){return ae++},l.v8Spec=Be,l.validateCustomStyleLayer=function(c){const s=[],u=c.id;return u===void 0&&s.push({message:`layers.${u}: missing required property "id"`}),c.render===void 0&&s.push({message:`layers.${u}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&s.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),s},l.validateLight=ay,l.validateStyle=uc,l.vectorTile=hl,l.warnOnce=Ue,l.wrap=W}),a(["./shared"],function(l){class _{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,G){for(const oe of N){this._layerConfigs[oe.id]=oe;const he=this._layers[oe.id]=l.createStyleLayer(oe);he._featureFilter=l.createFilter(he.filter),this.keyCache[oe.id]&&delete this.keyCache[oe.id]}for(const oe of G)delete this.keyCache[oe],delete this._layerConfigs[oe],delete this._layers[oe];this.familiesBySource={};const K=l.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(const oe of K){const he=oe.map(De=>this._layers[De.id]),_e=he[0];if(_e.visibility==="none")continue;const fe=_e.source||"";let de=this.familiesBySource[fe];de||(de=this.familiesBySource[fe]={});const ve=_e.sourceLayer||"_geojsonTileLayer";let Re=de[ve];Re||(Re=de[ve]=[]),Re.push(he)}}}class v{constructor(N){const G={},K=[];for(const fe in N){const de=N[fe],ve=G[fe]={};for(const Re in de){const De=de[+Re];if(!De||De.bitmap.width===0||De.bitmap.height===0)continue;const ze={x:0,y:0,w:De.bitmap.width+2,h:De.bitmap.height+2};K.push(ze),ve[Re]={rect:ze,metrics:De.metrics}}}const{w:oe,h:he}=l.potpack(K),_e=new l.AlphaImage({width:oe||1,height:he||1});for(const fe in N){const de=N[fe];for(const ve in de){const Re=de[+ve];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const De=G[fe][ve].rect;l.AlphaImage.copy(Re.bitmap,_e,{x:0,y:0},{x:De.x+1,y:De.y+1},Re.bitmap)}}this.image=_e,this.positions=G}}l.register("GlyphAtlas",v);class S{constructor(N){this.tileID=new l.OverscaledTileID(N.tileID.overscaledZ,N.tileID.wrap,N.tileID.canonical.z,N.tileID.canonical.x,N.tileID.canonical.y),this.uid=N.uid,this.zoom=N.zoom,this.pixelRatio=N.pixelRatio,this.tileSize=N.tileSize,this.source=N.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=N.showCollisionBoxes,this.collectResourceTiming=!!N.collectResourceTiming,this.returnDependencies=!!N.returnDependencies,this.promoteId=N.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(N,G,K,oe,he){this.status="parsing",this.data=N,this.collisionBoxArray=new l.CollisionBoxArray;const _e=new l.DictionaryCoder(Object.keys(N.layers).sort()),fe=new l.FeatureIndex(this.tileID,this.promoteId);fe.bucketLayerIDs=[];const de={},ve={featureIndex:fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:K},Re=G.familiesBySource[this.source];for(const Bt in Re){const Dt=N.layers[Bt];if(!Dt)continue;Dt.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${Bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const _i=_e.encode(Bt),wt=[];for(let jn=0;jn<Dt.length;jn++){const yi=Dt.feature(jn),xn=fe.getId(yi,Bt);wt.push({feature:yi,id:xn,index:jn,sourceLayerIndex:_i})}for(const jn of Re[Bt]){const yi=jn[0];yi.source!==this.source&&l.warnOnce(`layer.source = ${yi.source} does not equal this.source = ${this.source}`),yi.minzoom&&this.zoom<Math.floor(yi.minzoom)||yi.maxzoom&&this.zoom>=yi.maxzoom||yi.visibility!=="none"&&(I(jn,this.zoom,K),(de[yi.id]=yi.createBucket({index:fe.bucketLayerIDs.length,layers:jn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_i,sourceID:this.source})).populate(wt,ve,this.tileID.canonical),fe.bucketLayerIDs.push(jn.map(xn=>xn.id)))}}let De,ze,vt,Ct;const lt=l.mapObject(ve.glyphDependencies,Bt=>Object.keys(Bt).map(Number));this.inFlightDependencies.forEach(Bt=>Bt==null?void 0:Bt.cancel()),this.inFlightDependencies=[];const pt=++this.dependencySentinel;Object.keys(lt).length?this.inFlightDependencies.push(oe.send("getGlyphs",{uid:this.uid,stacks:lt,source:this.source,tileID:this.tileID,type:"glyphs"},(Bt,Dt)=>{pt===this.dependencySentinel&&(De||(De=Bt,ze=Dt,qt.call(this)))})):ze={};const St=Object.keys(ve.iconDependencies);St.length?this.inFlightDependencies.push(oe.send("getImages",{icons:St,source:this.source,tileID:this.tileID,type:"icons"},(Bt,Dt)=>{pt===this.dependencySentinel&&(De||(De=Bt,vt=Dt,qt.call(this)))})):vt={};const Ht=Object.keys(ve.patternDependencies);function qt(){if(De)return he(De);if(ze&&vt&&Ct){const Bt=new v(ze),Dt=new l.ImageAtlas(vt,Ct);for(const _i in de){const wt=de[_i];wt instanceof l.SymbolBucket?(I(wt.layers,this.zoom,K),l.performSymbolLayout({bucket:wt,glyphMap:ze,glyphPositions:Bt.positions,imageMap:vt,imagePositions:Dt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):wt.hasPattern&&(wt instanceof l.LineBucket||wt instanceof l.FillBucket||wt instanceof l.FillExtrusionBucket)&&(I(wt.layers,this.zoom,K),wt.addFeatures(ve,this.tileID.canonical,Dt.patternPositions))}this.status="done",he(null,{buckets:Object.values(de).filter(_i=>!_i.isEmpty()),featureIndex:fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Bt.image,imageAtlas:Dt,glyphMap:this.returnDependencies?ze:null,iconMap:this.returnDependencies?vt:null,glyphPositions:this.returnDependencies?Bt.positions:null})}}Ht.length?this.inFlightDependencies.push(oe.send("getImages",{icons:Ht,source:this.source,tileID:this.tileID,type:"patterns"},(Bt,Dt)=>{pt===this.dependencySentinel&&(De||(De=Bt,Ct=Dt,qt.call(this)))})):Ct={},qt.call(this)}}function I(ie,N,G){const K=new l.EvaluationParameters(N);for(const oe of ie)oe.recalculate(K,G)}function B(ie,N){const G=l.getArrayBuffer(ie.request,(K,oe,he,_e)=>{if(K)N(K);else if(oe)try{const fe=new l.vectorTile.VectorTile(new l.Protobuf(oe));N(null,{vectorTile:fe,rawData:oe,cacheControl:he,expires:_e})}catch(fe){const de=new Uint8Array(oe);let ve=`Unable to parse the tile at ${ie.request.url}, `;ve+=de[0]===31&&de[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${fe.messge}`,N(new Error(ve))}});return()=>{G.cancel(),N()}}class z{constructor(N,G,K,oe){this.actor=N,this.layerIndex=G,this.availableImages=K,this.loadVectorData=oe||B,this.fetching={},this.loading={},this.loaded={}}loadTile(N,G){const K=N.uid;this.loading||(this.loading={});const oe=!!(N&&N.request&&N.request.collectResourceTiming)&&new l.RequestPerformance(N.request),he=this.loading[K]=new S(N);he.abort=this.loadVectorData(N,(_e,fe)=>{if(delete this.loading[K],_e||!fe)return he.status="done",this.loaded[K]=he,G(_e);const de=fe.rawData,ve={};fe.expires&&(ve.expires=fe.expires),fe.cacheControl&&(ve.cacheControl=fe.cacheControl);const Re={};if(oe){const De=oe.finish();De&&(Re.resourceTiming=JSON.parse(JSON.stringify(De)))}he.vectorTile=fe.vectorTile,he.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,(De,ze)=>{if(delete this.fetching[K],De||!ze)return G(De);G(null,l.extend({rawTileData:de.slice(0)},ze,ve,Re))}),this.loaded=this.loaded||{},this.loaded[K]=he,this.fetching[K]={rawTileData:de,cacheControl:ve,resourceTiming:Re}})}reloadTile(N,G){const K=this.loaded,oe=N.uid;if(K&&K[oe]){const he=K[oe];he.showCollisionBoxes=N.showCollisionBoxes,he.status==="parsing"?he.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,(_e,fe)=>{if(_e||!fe)return G(_e,fe);let de;if(this.fetching[oe]){const{rawTileData:ve,cacheControl:Re,resourceTiming:De}=this.fetching[oe];delete this.fetching[oe],de=l.extend({rawTileData:ve.slice(0)},fe,Re,De)}else de=fe;G(null,de)}):he.status==="done"&&(he.vectorTile?he.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,G):G())}}abortTile(N,G){const K=this.loading,oe=N.uid;K&&K[oe]&&K[oe].abort&&(K[oe].abort(),delete K[oe]),G()}removeTile(N,G){const K=this.loaded,oe=N.uid;K&&K[oe]&&delete K[oe],G()}}class V{constructor(){this.loaded={}}loadTile(N,G){const{uid:K,encoding:oe,rawImageData:he,redFactor:_e,greenFactor:fe,blueFactor:de,baseShift:ve}=N,Re=l.isImageBitmap(he)?this.getImageData(he):he,De=new l.DEMData(K,Re,oe,_e,fe,de,ve);this.loaded=this.loaded||{},this.loaded[K]=De,G(null,De)}getImageData(N){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);const G=this.offscreenCanvasContext.getImageData(-1,-1,N.width+2,N.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:G.width,height:G.height},G.data)}removeTile(N){const G=this.loaded,K=N.uid;G&&G[K]&&delete G[K]}}function J(ie,N){if(ie.length!==0){ue(ie[0],N);for(var G=1;G<ie.length;G++)ue(ie[G],!N)}}function ue(ie,N){for(var G=0,K=0,oe=0,he=ie.length,_e=he-1;oe<he;_e=oe++){var fe=(ie[oe][0]-ie[_e][0])*(ie[_e][1]+ie[oe][1]),de=G+fe;K+=Math.abs(G)>=Math.abs(fe)?G-de+fe:fe-de+G,G=de}G+K>=0!=!!N&&ie.reverse()}var j=l.getDefaultExportFromCjs(function ie(N,G){var K,oe=N&&N.type;if(oe==="FeatureCollection")for(K=0;K<N.features.length;K++)ie(N.features[K],G);else if(oe==="GeometryCollection")for(K=0;K<N.geometries.length;K++)ie(N.geometries[K],G);else if(oe==="Feature")ie(N.geometry,G);else if(oe==="Polygon")J(N.coordinates,G);else if(oe==="MultiPolygon")for(K=0;K<N.coordinates.length;K++)J(N.coordinates[K],G);return N});const W=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;var Z={exports:{}},ae=l.pointGeometry,be=l.vectorTile.VectorTileFeature,Ee=Le;function Le(ie,N){this.options=N||{},this.features=ie,this.length=ie.length}function ke(ie,N){this.id=typeof ie.id=="number"?ie.id:void 0,this.type=ie.type,this.rawGeometry=ie.type===1?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=N||4096}Le.prototype.feature=function(ie){return new ke(this.features[ie],this.options.extent)},ke.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var N=0;N<ie.length;N++){for(var G=ie[N],K=[],oe=0;oe<G.length;oe++)K.push(new ae(G[oe][0],G[oe][1]));this.geometry.push(K)}return this.geometry},ke.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,N=1/0,G=-1/0,K=1/0,oe=-1/0,he=0;he<ie.length;he++)for(var _e=ie[he],fe=0;fe<_e.length;fe++){var de=_e[fe];N=Math.min(N,de.x),G=Math.max(G,de.x),K=Math.min(K,de.y),oe=Math.max(oe,de.y)}return[N,K,G,oe]},ke.prototype.toGeoJSON=be.prototype.toGeoJSON;var Ue=l.pbf,Me=Ee;function ut(ie){var N=new Ue;return function(G,K){for(var oe in G.layers)K.writeMessage(3,Lt,G.layers[oe])}(ie,N),N.finish()}function Lt(ie,N){var G;N.writeVarintField(15,ie.version||1),N.writeStringField(1,ie.name||""),N.writeVarintField(5,ie.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for(G=0;G<ie.length;G++)K.feature=ie.feature(G),N.writeMessage(2,Ft,K);var oe=K.keys;for(G=0;G<oe.length;G++)N.writeStringField(3,oe[G]);var he=K.values;for(G=0;G<he.length;G++)N.writeMessage(4,tt,he[G])}function Ft(ie,N){var G=ie.feature;G.id!==void 0&&N.writeVarintField(1,G.id),N.writeMessage(2,Rt,ie),N.writeVarintField(3,G.type),N.writeMessage(4,Bi,G)}function Rt(ie,N){var G=ie.feature,K=ie.keys,oe=ie.values,he=ie.keycache,_e=ie.valuecache;for(var fe in G.properties){var de=G.properties[fe],ve=he[fe];if(de!==null){ve===void 0&&(K.push(fe),he[fe]=ve=K.length-1),N.writeVarint(ve);var Re=typeof de;Re!=="string"&&Re!=="boolean"&&Re!=="number"&&(de=JSON.stringify(de));var De=Re+":"+de,ze=_e[De];ze===void 0&&(oe.push(de),_e[De]=ze=oe.length-1),N.writeVarint(ze)}}}function Jn(ie,N){return(N<<3)+(7&ie)}function ai(ie){return ie<<1^ie>>31}function Bi(ie,N){for(var G=ie.loadGeometry(),K=ie.type,oe=0,he=0,_e=G.length,fe=0;fe<_e;fe++){var de=G[fe],ve=1;K===1&&(ve=de.length),N.writeVarint(Jn(1,ve));for(var Re=K===3?de.length-1:de.length,De=0;De<Re;De++){De===1&&K!==1&&N.writeVarint(Jn(2,Re-1));var ze=de[De].x-oe,vt=de[De].y-he;N.writeVarint(ai(ze)),N.writeVarint(ai(vt)),oe+=ze,he+=vt}K===3&&N.writeVarint(Jn(7,1))}}function tt(ie,N){var G=typeof ie;G==="string"?N.writeStringField(1,ie):G==="boolean"?N.writeBooleanField(7,ie):G==="number"&&(ie%1!=0?N.writeDoubleField(3,ie):ie<0?N.writeSVarintField(6,ie):N.writeVarintField(5,ie))}Z.exports=ut,Z.exports.fromVectorTileJs=ut,Z.exports.fromGeojsonVt=function(ie,N){N=N||{};var G={};for(var K in ie)G[K]=new Me(ie[K].features,N),G[K].name=K,G[K].version=N.version,G[K].extent=N.extent;return ut({layers:G})},Z.exports.GeoJSONWrapper=Me;var At=l.getDefaultExportFromCjs(Z.exports);const Pt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},tn=Math.fround||($t=new Float32Array(1),ie=>($t[0]=+ie,$t[0]));var $t;const Kn=3,Zt=5,Pr=6;class Qi{constructor(N){this.options=Object.assign(Object.create(Pt),N),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(N){const{log:G,minZoom:K,maxZoom:oe}=this.options;G&&console.time("total time");const he=`prepare ${N.length} points`;G&&console.time(he),this.points=N;const _e=[];for(let de=0;de<N.length;de++){const ve=N[de];if(!ve.geometry)continue;const[Re,De]=ve.geometry.coordinates,ze=tn(cn(Re)),vt=tn(gn(De));_e.push(ze,vt,1/0,de,-1,1),this.options.reduce&&_e.push(0)}let fe=this.trees[oe+1]=this._createTree(_e);G&&console.timeEnd(he);for(let de=oe;de>=K;de--){const ve=+Date.now();fe=this.trees[de]=this._createTree(this._cluster(fe,de)),G&&console.log("z%d: %d clusters in %dms",de,fe.numItems,+Date.now()-ve)}return G&&console.timeEnd("total time"),this}getClusters(N,G){let K=((N[0]+180)%360+360)%360-180;const oe=Math.max(-90,Math.min(90,N[1]));let he=N[2]===180?180:((N[2]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)K=-180,he=180;else if(K>he){const De=this.getClusters([K,oe,180,_e],G),ze=this.getClusters([-180,oe,he,_e],G);return De.concat(ze)}const fe=this.trees[this._limitZoom(G)],de=fe.range(cn(K),gn(_e),cn(he),gn(oe)),ve=fe.data,Re=[];for(const De of de){const ze=this.stride*De;Re.push(ve[ze+Zt]>1?mn(ve,ze,this.clusterProps):this.points[ve[ze+Kn]])}return Re}getChildren(N){const G=this._getOriginId(N),K=this._getOriginZoom(N),oe="No cluster with the specified id.",he=this.trees[K];if(!he)throw new Error(oe);const _e=he.data;if(G*this.stride>=_e.length)throw new Error(oe);const fe=this.options.radius/(this.options.extent*Math.pow(2,K-1)),de=he.within(_e[G*this.stride],_e[G*this.stride+1],fe),ve=[];for(const Re of de){const De=Re*this.stride;_e[De+4]===N&&ve.push(_e[De+Zt]>1?mn(_e,De,this.clusterProps):this.points[_e[De+Kn]])}if(ve.length===0)throw new Error(oe);return ve}getLeaves(N,G,K){const oe=[];return this._appendLeaves(oe,N,G=G||10,K=K||0,0),oe}getTile(N,G,K){const oe=this.trees[this._limitZoom(N)],he=Math.pow(2,N),{extent:_e,radius:fe}=this.options,de=fe/_e,ve=(K-de)/he,Re=(K+1+de)/he,De={features:[]};return this._addTileFeatures(oe.range((G-de)/he,ve,(G+1+de)/he,Re),oe.data,G,K,he,De),G===0&&this._addTileFeatures(oe.range(1-de/he,ve,1,Re),oe.data,he,K,he,De),G===he-1&&this._addTileFeatures(oe.range(0,ve,de/he,Re),oe.data,-1,K,he,De),De.features.length?De:null}getClusterExpansionZoom(N){let G=this._getOriginZoom(N)-1;for(;G<=this.options.maxZoom;){const K=this.getChildren(N);if(G++,K.length!==1)break;N=K[0].properties.cluster_id}return G}_appendLeaves(N,G,K,oe,he){const _e=this.getChildren(G);for(const fe of _e){const de=fe.properties;if(de&&de.cluster?he+de.point_count<=oe?he+=de.point_count:he=this._appendLeaves(N,de.cluster_id,K,oe,he):he<oe?he++:N.push(fe),N.length===K)break}return he}_createTree(N){const G=new l.KDBush(N.length/this.stride|0,this.options.nodeSize,Float32Array);for(let K=0;K<N.length;K+=this.stride)G.add(N[K],N[K+1]);return G.finish(),G.data=N,G}_addTileFeatures(N,G,K,oe,he,_e){for(const fe of N){const de=fe*this.stride,ve=G[de+Zt]>1;let Re,De,ze;if(ve)Re=cr(G,de,this.clusterProps),De=G[de],ze=G[de+1];else{const lt=this.points[G[de+Kn]];Re=lt.properties;const[pt,St]=lt.geometry.coordinates;De=cn(pt),ze=gn(St)}const vt={type:1,geometry:[[Math.round(this.options.extent*(De*he-K)),Math.round(this.options.extent*(ze*he-oe))]],tags:Re};let Ct;Ct=ve||this.options.generateId?G[de+Kn]:this.points[G[de+Kn]].id,Ct!==void 0&&(vt.id=Ct),_e.features.push(vt)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(Math.floor(+N),this.options.maxZoom+1))}_cluster(N,G){const{radius:K,extent:oe,reduce:he,minPoints:_e}=this.options,fe=K/(oe*Math.pow(2,G)),de=N.data,ve=[],Re=this.stride;for(let De=0;De<de.length;De+=Re){if(de[De+2]<=G)continue;de[De+2]=G;const ze=de[De],vt=de[De+1],Ct=N.within(de[De],de[De+1],fe),lt=de[De+Zt];let pt=lt;for(const St of Ct){const Ht=St*Re;de[Ht+2]>G&&(pt+=de[Ht+Zt])}if(pt>lt&&pt>=_e){let St,Ht=ze*lt,qt=vt*lt,Bt=-1;const Dt=((De/Re|0)<<5)+(G+1)+this.points.length;for(const _i of Ct){const wt=_i*Re;if(de[wt+2]<=G)continue;de[wt+2]=G;const jn=de[wt+Zt];Ht+=de[wt]*jn,qt+=de[wt+1]*jn,de[wt+4]=Dt,he&&(St||(St=this._map(de,De,!0),Bt=this.clusterProps.length,this.clusterProps.push(St)),he(St,this._map(de,wt)))}de[De+4]=Dt,ve.push(Ht/pt,qt/pt,1/0,Dt,-1,pt),he&&ve.push(Bt)}else{for(let St=0;St<Re;St++)ve.push(de[De+St]);if(pt>1)for(const St of Ct){const Ht=St*Re;if(!(de[Ht+2]<=G)){de[Ht+2]=G;for(let qt=0;qt<Re;qt++)ve.push(de[Ht+qt])}}}}return ve}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,G,K){if(N[G+Zt]>1){const _e=this.clusterProps[N[G+Pr]];return K?Object.assign({},_e):_e}const oe=this.points[N[G+Kn]].properties,he=this.options.map(oe);return K&&he===oe?Object.assign({},he):he}}function mn(ie,N,G){return{type:"Feature",id:ie[N+Kn],properties:cr(ie,N,G),geometry:{type:"Point",coordinates:[(K=ie[N],360*(K-.5)),er(ie[N+1])]}};var K}function cr(ie,N,G){const K=ie[N+Zt],oe=K>=1e4?`${Math.round(K/1e3)}k`:K>=1e3?Math.round(K/100)/10+"k":K,he=ie[N+Pr],_e=he===-1?{}:Object.assign({},G[he]);return Object.assign(_e,{cluster:!0,cluster_id:ie[N+Kn],point_count:K,point_count_abbreviated:oe})}function cn(ie){return ie/360+.5}function gn(ie){const N=Math.sin(ie*Math.PI/180),G=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return G<0?0:G>1?1:G}function er(ie){const N=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function ur(ie,N,G,K){for(var oe,he=K,_e=G-N>>1,fe=G-N,de=ie[N],ve=ie[N+1],Re=ie[G],De=ie[G+1],ze=N+3;ze<G;ze+=3){var vt=Be(ie[ze],ie[ze+1],de,ve,Re,De);if(vt>he)oe=ze,he=vt;else if(vt===he){var Ct=Math.abs(ze-_e);Ct<fe&&(oe=ze,fe=Ct)}}he>K&&(oe-N>3&&ur(ie,N,oe,K),ie[oe+2]=he,G-oe>3&&ur(ie,oe,G,K))}function Be(ie,N,G,K,oe,he){var _e=oe-G,fe=he-K;if(_e!==0||fe!==0){var de=((ie-G)*_e+(N-K)*fe)/(_e*_e+fe*fe);de>1?(G=oe,K=he):de>0&&(G+=_e*de,K+=fe*de)}return(_e=ie-G)*_e+(fe=N-K)*fe}function tr(ie,N,G,K){var oe={id:ie===void 0?null:ie,type:N,geometry:G,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(he){var _e=he.geometry,fe=he.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")Xr(he,_e);else if(fe==="Polygon"||fe==="MultiLineString")for(var de=0;de<_e.length;de++)Xr(he,_e[de]);else if(fe==="MultiPolygon")for(de=0;de<_e.length;de++)for(var ve=0;ve<_e[de].length;ve++)Xr(he,_e[de][ve])}(oe),oe}function Xr(ie,N){for(var G=0;G<N.length;G+=3)ie.minX=Math.min(ie.minX,N[G]),ie.minY=Math.min(ie.minY,N[G+1]),ie.maxX=Math.max(ie.maxX,N[G]),ie.maxY=Math.max(ie.maxY,N[G+1])}function Ut(ie,N,G,K){if(N.geometry){var oe=N.geometry.coordinates,he=N.geometry.type,_e=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),fe=[],de=N.id;if(G.promoteId?de=N.properties[G.promoteId]:G.generateId&&(de=K||0),he==="Point")Gt(oe,fe);else if(he==="MultiPoint")for(var ve=0;ve<oe.length;ve++)Gt(oe[ve],fe);else if(he==="LineString")ks(oe,fe,_e,!1);else if(he==="MultiLineString"){if(G.lineMetrics){for(ve=0;ve<oe.length;ve++)ks(oe[ve],fe=[],_e,!1),ie.push(tr(de,"LineString",fe,N.properties));return}zs(oe,fe,_e,!1)}else if(he==="Polygon")zs(oe,fe,_e,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(ve=0;ve<N.geometry.geometries.length;ve++)Ut(ie,{id:de,geometry:N.geometry.geometries[ve],properties:N.properties},G,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ve=0;ve<oe.length;ve++){var Re=[];zs(oe[ve],Re,_e,!0),fe.push(Re)}}ie.push(tr(de,he,fe,N.properties))}}function Gt(ie,N){N.push(lo(ie[0])),N.push(Li(ie[1])),N.push(0)}function ks(ie,N,G,K){for(var oe,he,_e=0,fe=0;fe<ie.length;fe++){var de=lo(ie[fe][0]),ve=Li(ie[fe][1]);N.push(de),N.push(ve),N.push(0),fe>0&&(_e+=K?(oe*ve-de*he)/2:Math.sqrt(Math.pow(de-oe,2)+Math.pow(ve-he,2))),oe=de,he=ve}var Re=N.length-3;N[2]=1,ur(N,0,Re,G),N[Re+2]=1,N.size=Math.abs(_e),N.start=0,N.end=N.size}function zs(ie,N,G,K){for(var oe=0;oe<ie.length;oe++){var he=[];ks(ie[oe],he,G,K),N.push(he)}}function lo(ie){return ie/360+.5}function Li(ie){var N=Math.sin(ie*Math.PI/180),G=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return G<0?0:G>1?1:G}function Sn(ie,N,G,K,oe,he,_e,fe){if(K/=N,he>=(G/=N)&&_e<K)return ie;if(_e<G||he>=K)return null;for(var de=[],ve=0;ve<ie.length;ve++){var Re=ie[ve],De=Re.geometry,ze=Re.type,vt=oe===0?Re.minX:Re.minY,Ct=oe===0?Re.maxX:Re.maxY;if(vt>=G&&Ct<K)de.push(Re);else if(!(Ct<G||vt>=K)){var lt=[];if(ze==="Point"||ze==="MultiPoint")ha(De,lt,G,K,oe);else if(ze==="LineString")No(De,lt,G,K,oe,!1,fe.lineMetrics);else if(ze==="MultiLineString")Ri(De,lt,G,K,oe,!1);else if(ze==="Polygon")Ri(De,lt,G,K,oe,!0);else if(ze==="MultiPolygon")for(var pt=0;pt<De.length;pt++){var St=[];Ri(De[pt],St,G,K,oe,!0),St.length&&lt.push(St)}if(lt.length){if(fe.lineMetrics&&ze==="LineString"){for(pt=0;pt<lt.length;pt++)de.push(tr(Re.id,ze,lt[pt],Re.tags));continue}ze!=="LineString"&&ze!=="MultiLineString"||(lt.length===1?(ze="LineString",lt=lt[0]):ze="MultiLineString"),ze!=="Point"&&ze!=="MultiPoint"||(ze=lt.length===3?"Point":"MultiPoint"),de.push(tr(Re.id,ze,lt,Re.tags))}}}return de.length?de:null}function ha(ie,N,G,K,oe){for(var he=0;he<ie.length;he+=3){var _e=ie[he+oe];_e>=G&&_e<=K&&(N.push(ie[he]),N.push(ie[he+1]),N.push(ie[he+2]))}}function No(ie,N,G,K,oe,he,_e){for(var fe,de,ve=We(ie),Re=oe===0?$r:ds,De=ie.start,ze=0;ze<ie.length-3;ze+=3){var vt=ie[ze],Ct=ie[ze+1],lt=ie[ze+2],pt=ie[ze+3],St=ie[ze+4],Ht=oe===0?vt:Ct,qt=oe===0?pt:St,Bt=!1;_e&&(fe=Math.sqrt(Math.pow(vt-pt,2)+Math.pow(Ct-St,2))),Ht<G?qt>G&&(de=Re(ve,vt,Ct,pt,St,G),_e&&(ve.start=De+fe*de)):Ht>K?qt<K&&(de=Re(ve,vt,Ct,pt,St,K),_e&&(ve.start=De+fe*de)):Di(ve,vt,Ct,lt),qt<G&&Ht>=G&&(de=Re(ve,vt,Ct,pt,St,G),Bt=!0),qt>K&&Ht<=K&&(de=Re(ve,vt,Ct,pt,St,K),Bt=!0),!he&&Bt&&(_e&&(ve.end=De+fe*de),N.push(ve),ve=We(ie)),_e&&(De+=fe)}var Dt=ie.length-3;vt=ie[Dt],Ct=ie[Dt+1],lt=ie[Dt+2],(Ht=oe===0?vt:Ct)>=G&&Ht<=K&&Di(ve,vt,Ct,lt),Dt=ve.length-3,he&&Dt>=3&&(ve[Dt]!==ve[0]||ve[Dt+1]!==ve[1])&&Di(ve,ve[0],ve[1],ve[2]),ve.length&&N.push(ve)}function We(ie){var N=[];return N.size=ie.size,N.start=ie.start,N.end=ie.end,N}function Ri(ie,N,G,K,oe,he){for(var _e=0;_e<ie.length;_e++)No(ie[_e],N,G,K,oe,he,!1)}function Di(ie,N,G,K){ie.push(N),ie.push(G),ie.push(K)}function $r(ie,N,G,K,oe,he){var _e=(he-N)/(K-N);return ie.push(he),ie.push(G+(oe-G)*_e),ie.push(1),_e}function ds(ie,N,G,K,oe,he){var _e=(he-G)/(oe-G);return ie.push(N+(K-N)*_e),ie.push(he),ie.push(1),_e}function $e(ie,N){for(var G=[],K=0;K<ie.length;K++){var oe,he=ie[K],_e=he.type;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")oe=It(he.geometry,N);else if(_e==="MultiLineString"||_e==="Polygon"){oe=[];for(var fe=0;fe<he.geometry.length;fe++)oe.push(It(he.geometry[fe],N))}else if(_e==="MultiPolygon")for(oe=[],fe=0;fe<he.geometry.length;fe++){for(var de=[],ve=0;ve<he.geometry[fe].length;ve++)de.push(It(he.geometry[fe][ve],N));oe.push(de)}G.push(tr(he.id,_e,oe,he.tags))}return G}function It(ie,N){var G=[];G.size=ie.size,ie.start!==void 0&&(G.start=ie.start,G.end=ie.end);for(var K=0;K<ie.length;K+=3)G.push(ie[K]+N,ie[K+1],ie[K+2]);return G}function Mt(ie,N){if(ie.transformed)return ie;var G,K,oe,he=1<<ie.z,_e=ie.x,fe=ie.y;for(G=0;G<ie.features.length;G++){var de=ie.features[G],ve=de.geometry,Re=de.type;if(de.geometry=[],Re===1)for(K=0;K<ve.length;K+=2)de.geometry.push(Ti(ve[K],ve[K+1],N,he,_e,fe));else for(K=0;K<ve.length;K++){var De=[];for(oe=0;oe<ve[K].length;oe+=2)De.push(Ti(ve[K][oe],ve[K][oe+1],N,he,_e,fe));de.geometry.push(De)}}return ie.transformed=!0,ie}function Ti(ie,N,G,K,oe,he){return[Math.round(G*(ie*K-oe)),Math.round(G*(N*K-he))]}function fs(ie,N,G,K,oe){for(var he=N===oe.maxZoom?0:oe.tolerance/((1<<N)*oe.extent),_e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:G,y:K,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<ie.length;fe++){_e.numFeatures++,Et(_e,ie[fe],he,oe);var de=ie[fe].minX,ve=ie[fe].minY,Re=ie[fe].maxX,De=ie[fe].maxY;de<_e.minX&&(_e.minX=de),ve<_e.minY&&(_e.minY=ve),Re>_e.maxX&&(_e.maxX=Re),De>_e.maxY&&(_e.maxY=De)}return _e}function Et(ie,N,G,K){var oe=N.geometry,he=N.type,_e=[];if(he==="Point"||he==="MultiPoint")for(var fe=0;fe<oe.length;fe+=3)_e.push(oe[fe]),_e.push(oe[fe+1]),ie.numPoints++,ie.numSimplified++;else if(he==="LineString")Zr(_e,oe,ie,G,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(fe=0;fe<oe.length;fe++)Zr(_e,oe[fe],ie,G,he==="Polygon",fe===0);else if(he==="MultiPolygon")for(var de=0;de<oe.length;de++){var ve=oe[de];for(fe=0;fe<ve.length;fe++)Zr(_e,ve[fe],ie,G,!0,fe===0)}if(_e.length){var Re=N.tags||null;if(he==="LineString"&&K.lineMetrics){for(var De in Re={},N.tags)Re[De]=N.tags[De];Re.mapbox_clip_start=oe.start/oe.size,Re.mapbox_clip_end=oe.end/oe.size}var ze={geometry:_e,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:Re};N.id!==null&&(ze.id=N.id),ie.features.push(ze)}}function Zr(ie,N,G,K,oe,he){var _e=K*K;if(K>0&&N.size<(oe?_e:K))G.numPoints+=N.length/3;else{for(var fe=[],de=0;de<N.length;de+=3)(K===0||N[de+2]>_e)&&(G.numSimplified++,fe.push(N[de]),fe.push(N[de+1])),G.numPoints++;oe&&function(ve,Re){for(var De=0,ze=0,vt=ve.length,Ct=vt-2;ze<vt;Ct=ze,ze+=2)De+=(ve[ze]-ve[Ct])*(ve[ze+1]+ve[Ct+1]);if(De>0===Re)for(ze=0,vt=ve.length;ze<vt/2;ze+=2){var lt=ve[ze],pt=ve[ze+1];ve[ze]=ve[vt-2-ze],ve[ze+1]=ve[vt-1-ze],ve[vt-2-ze]=lt,ve[vt-1-ze]=pt}}(fe,he),ie.push(fe)}}function Jr(ie,N){var G=(N=this.options=function(oe,he){for(var _e in he)oe[_e]=he[_e];return oe}(Object.create(this.options),N)).debug;if(G&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var K=function(oe,he){var _e=[];if(oe.type==="FeatureCollection")for(var fe=0;fe<oe.features.length;fe++)Ut(_e,oe.features[fe],he,fe);else Ut(_e,oe.type==="Feature"?oe:{geometry:oe},he);return _e}(ie,N);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),K=function(oe,he){var _e=he.buffer/he.extent,fe=oe,de=Sn(oe,1,-1-_e,_e,0,-1,2,he),ve=Sn(oe,1,1-_e,2+_e,0,-1,2,he);return(de||ve)&&(fe=Sn(oe,1,-_e,1+_e,0,-1,2,he)||[],de&&(fe=$e(de,1).concat(fe)),ve&&(fe=fe.concat($e(ve,-1)))),fe}(K,N),K.length&&this.splitTile(K,0,0,0),G&&(K.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Mr(ie,N,G){return 32*((1<<ie)*G+N)+ie}function hr(ie,N){return N?ie.properties[N]:ie.id}function Ns(ie,N){if(ie==null)return!0;if(ie.type==="Feature")return hr(ie,N)!=null;if(ie.type==="FeatureCollection"){const G=new Set;for(const K of ie.features){const oe=hr(K,N);if(oe==null||G.has(oe))return!1;G.add(oe)}return!0}return!1}function li(ie,N){const G=new Map;if(ie!=null)if(ie.type==="Feature")G.set(hr(ie,N),ie);else for(const K of ie.features)G.set(hr(K,N),K);return G}function un(ie,N){const G=ie.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);const K=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!K)return N(null,null);const oe=new class{constructor(_e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=_e.length,this._features=_e}feature(_e){return new class{constructor(fe){this._feature=fe,this.extent=l.EXTENT,this.type=fe.type,this.properties=fe.tags,"id"in fe&&!isNaN(fe.id)&&(this.id=parseInt(fe.id,10))}loadGeometry(){if(this._feature.type===1){const fe=[];for(const de of this._feature.geometry)fe.push([new l.Point(de[0],de[1])]);return fe}{const fe=[];for(const de of this._feature.geometry){const ve=[];for(const Re of de)ve.push(new l.Point(Re[0],Re[1]));fe.push(ve)}return fe}}toGeoJSON(fe,de,ve){return W.call(this,fe,de,ve)}}(this._features[_e])}}(K.features);let he=At(oe);he.byteOffset===0&&he.byteLength===he.buffer.byteLength||(he=new Uint8Array(he)),N(null,{vectorTile:oe,rawData:he.buffer})}Jr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Jr.prototype.splitTile=function(ie,N,G,K,oe,he,_e){for(var fe=[ie,N,G,K],de=this.options,ve=de.debug;fe.length;){K=fe.pop(),G=fe.pop(),N=fe.pop(),ie=fe.pop();var Re=1<<N,De=Mr(N,G,K),ze=this.tiles[De];if(!ze&&(ve>1&&console.time("creation"),ze=this.tiles[De]=fs(ie,N,G,K,de),this.tileCoords.push({z:N,x:G,y:K}),ve)){ve>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,G,K,ze.numFeatures,ze.numPoints,ze.numSimplified),console.timeEnd("creation"));var vt="z"+N;this.stats[vt]=(this.stats[vt]||0)+1,this.total++}if(ze.source=ie,oe){if(N===de.maxZoom||N===oe)continue;var Ct=1<<oe-N;if(G!==Math.floor(he/Ct)||K!==Math.floor(_e/Ct))continue}else if(N===de.indexMaxZoom||ze.numPoints<=de.indexMaxPoints)continue;if(ze.source=null,ie.length!==0){ve>1&&console.time("clipping");var lt,pt,St,Ht,qt,Bt,Dt=.5*de.buffer/de.extent,_i=.5-Dt,wt=.5+Dt,jn=1+Dt;lt=pt=St=Ht=null,qt=Sn(ie,Re,G-Dt,G+wt,0,ze.minX,ze.maxX,de),Bt=Sn(ie,Re,G+_i,G+jn,0,ze.minX,ze.maxX,de),ie=null,qt&&(lt=Sn(qt,Re,K-Dt,K+wt,1,ze.minY,ze.maxY,de),pt=Sn(qt,Re,K+_i,K+jn,1,ze.minY,ze.maxY,de),qt=null),Bt&&(St=Sn(Bt,Re,K-Dt,K+wt,1,ze.minY,ze.maxY,de),Ht=Sn(Bt,Re,K+_i,K+jn,1,ze.minY,ze.maxY,de),Bt=null),ve>1&&console.timeEnd("clipping"),fe.push(lt||[],N+1,2*G,2*K),fe.push(pt||[],N+1,2*G,2*K+1),fe.push(St||[],N+1,2*G+1,2*K),fe.push(Ht||[],N+1,2*G+1,2*K+1)}}},Jr.prototype.getTile=function(ie,N,G){var K=this.options,oe=K.extent,he=K.debug;if(ie<0||ie>24)return null;var _e=1<<ie,fe=Mr(ie,N=(N%_e+_e)%_e,G);if(this.tiles[fe])return Mt(this.tiles[fe],oe);he>1&&console.log("drilling down to z%d-%d-%d",ie,N,G);for(var de,ve=ie,Re=N,De=G;!de&&ve>0;)ve--,Re=Math.floor(Re/2),De=Math.floor(De/2),de=this.tiles[Mr(ve,Re,De)];return de&&de.source?(he>1&&console.log("found parent tile z%d-%d-%d",ve,Re,De),he>1&&console.time("drilling down"),this.splitTile(de.source,ve,Re,De,ie,N,G),he>1&&console.timeEnd("drilling down"),this.tiles[fe]?Mt(this.tiles[fe],oe):null):null};class co extends z{constructor(N,G,K,oe){super(N,G,K,un),this._dataUpdateable=new Map,this.loadGeoJSON=(he,_e)=>{const{promoteId:fe}=he;if(he.request)return l.getJSON(he.request,(de,ve,Re,De)=>{this._dataUpdateable=Ns(ve,fe)?li(ve,fe):void 0,_e(de,ve,Re,De)});if(typeof he.data=="string")try{const de=JSON.parse(he.data);this._dataUpdateable=Ns(de,fe)?li(de,fe):void 0,_e(null,de)}catch{_e(new Error(`Input data given to '${he.source}' is not a valid GeoJSON object.`))}else he.dataDiff?this._dataUpdateable?(function(de,ve,Re){var De,ze,vt,Ct;if(ve.removeAll&&de.clear(),ve.remove)for(const lt of ve.remove)de.delete(lt);if(ve.add)for(const lt of ve.add){const pt=hr(lt,Re);pt!=null&&de.set(pt,lt)}if(ve.update)for(const lt of ve.update){let pt=de.get(lt.id);if(pt==null)continue;const St=!lt.removeAllProperties&&(((De=lt.removeProperties)===null||De===void 0?void 0:De.length)>0||((ze=lt.addOrUpdateProperties)===null||ze===void 0?void 0:ze.length)>0);if((lt.newGeometry||lt.removeAllProperties||St)&&(pt={...pt},de.set(lt.id,pt),St&&(pt.properties={...pt.properties})),lt.newGeometry&&(pt.geometry=lt.newGeometry),lt.removeAllProperties)pt.properties={};else if(((vt=lt.removeProperties)===null||vt===void 0?void 0:vt.length)>0)for(const Ht of lt.removeProperties)Object.prototype.hasOwnProperty.call(pt.properties,Ht)&&delete pt.properties[Ht];if(((Ct=lt.addOrUpdateProperties)===null||Ct===void 0?void 0:Ct.length)>0)for(const{key:Ht,value:qt}of lt.addOrUpdateProperties)pt.properties[Ht]=qt}}(this._dataUpdateable,he.dataDiff,fe),_e(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):_e(new Error(`Cannot update existing geojson data in ${he.source}`)):_e(new Error(`Input data given to '${he.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},oe&&(this.loadGeoJSON=oe)}loadData(N,G){var K;(K=this._pendingRequest)===null||K===void 0||K.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const oe=!!(N&&N.request&&N.request.collectResourceTiming)&&new l.RequestPerformance(N.request);this._pendingCallback=G,this._pendingRequest=this.loadGeoJSON(N,(he,_e)=>{if(delete this._pendingCallback,delete this._pendingRequest,he||!_e)return G(he);if(typeof _e!="object")return G(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));{j(_e,!0);try{if(N.filter){const de=l.createExpression(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(de.result==="error")throw new Error(de.value.map(Re=>`${Re.key}: ${Re.message}`).join(", "));_e={type:"FeatureCollection",features:_e.features.filter(Re=>de.value.evaluate({zoom:0},Re))}}this._geoJSONIndex=N.cluster?new Qi(function({superclusterOptions:de,clusterProperties:ve}){if(!ve||!de)return de;const Re={},De={},ze={accumulated:null,zoom:0},vt={properties:null},Ct=Object.keys(ve);for(const lt of Ct){const[pt,St]=ve[lt],Ht=l.createExpression(St),qt=l.createExpression(typeof pt=="string"?[pt,["accumulated"],["get",lt]]:pt);Re[lt]=Ht.value,De[lt]=qt.value}return de.map=lt=>{vt.properties=lt;const pt={};for(const St of Ct)pt[St]=Re[St].evaluate(ze,vt);return pt},de.reduce=(lt,pt)=>{vt.properties=pt;for(const St of Ct)ze.accumulated=lt[St],lt[St]=De[St].evaluate(ze,vt)},de}(N)).load(_e.features):function(de,ve){return new Jr(de,ve)}(_e,N.geojsonVtOptions)}catch(de){return G(de)}this.loaded={};const fe={};if(oe){const de=oe.finish();de&&(fe.resourceTiming={},fe.resourceTiming[N.source]=JSON.parse(JSON.stringify(de)))}G(null,fe)}})}reloadTile(N,G){const K=this.loaded;return K&&K[N.uid]?super.reloadTile(N,G):this.loadTile(N,G)}removeSource(N,G){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),G()}getClusterExpansionZoom(N,G){try{G(null,this._geoJSONIndex.getClusterExpansionZoom(N.clusterId))}catch(K){G(K)}}getClusterChildren(N,G){try{G(null,this._geoJSONIndex.getChildren(N.clusterId))}catch(K){G(K)}}getClusterLeaves(N,G){try{G(null,this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset))}catch(K){G(K)}}}class Kr{constructor(N){this.self=N,this.actor=new l.Actor(N,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:z,geojson:co},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(G,K)=>{if(this.workerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.workerSourceTypes[G]=K},this.self.registerRTLTextPlugin=G=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=G.applyArabicShaping,l.plugin.processBidirectionalText=G.processBidirectionalText,l.plugin.processStyledBidirectionalText=G.processStyledBidirectionalText}}setReferrer(N,G){this.referrer=G}setImages(N,G,K){this.availableImages[N]=G;for(const oe in this.workerSources[N]){const he=this.workerSources[N][oe];for(const _e in he)he[_e].availableImages=G}K()}setLayers(N,G,K){this.getLayerIndex(N).replace(G),K()}updateLayers(N,G,K){this.getLayerIndex(N).update(G.layers,G.removedIds),K()}loadTile(N,G,K){this.getWorkerSource(N,G.type,G.source).loadTile(G,K)}loadDEMTile(N,G,K){this.getDEMWorkerSource(N,G.source).loadTile(G,K)}reloadTile(N,G,K){this.getWorkerSource(N,G.type,G.source).reloadTile(G,K)}abortTile(N,G,K){this.getWorkerSource(N,G.type,G.source).abortTile(G,K)}removeTile(N,G,K){this.getWorkerSource(N,G.type,G.source).removeTile(G,K)}removeDEMTile(N,G){this.getDEMWorkerSource(N,G.source).removeTile(G)}removeSource(N,G,K){if(!this.workerSources[N]||!this.workerSources[N][G.type]||!this.workerSources[N][G.type][G.source])return;const oe=this.workerSources[N][G.type][G.source];delete this.workerSources[N][G.type][G.source],oe.removeSource!==void 0?oe.removeSource(G,K):K()}loadWorkerSource(N,G,K){try{this.self.importScripts(G.url),K()}catch(oe){K(oe.toString())}}syncRTLPluginState(N,G,K){try{l.plugin.setState(G);const oe=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&oe!=null){this.self.importScripts(oe);const he=l.plugin.isParsed();K(he?void 0:new Error(`RTL Text Plugin failed to import scripts from ${oe}`),he)}}catch(oe){K(oe.toString())}}getAvailableImages(N){let G=this.availableImages[N];return G||(G=[]),G}getLayerIndex(N){let G=this.layerIndexes[N];return G||(G=this.layerIndexes[N]=new _),G}getWorkerSource(N,G,K){if(this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][G]||(this.workerSources[N][G]={}),!this.workerSources[N][G][K]){const oe={send:(he,_e,fe)=>{this.actor.send(he,_e,fe,N)}};this.workerSources[N][G][K]=new this.workerSourceTypes[G](oe,this.getLayerIndex(N),this.getAvailableImages(N))}return this.workerSources[N][G][K]}getDEMWorkerSource(N,G){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][G]||(this.demWorkerSources[N][G]=new V),this.demWorkerSources[N][G]}}return l.isWorker()&&(self.worker=new Kr(self)),Kr}),a(["./shared"],function(l){var _="3.4.0";class v{static testProp(o){if(!v.docStyle)return o[0];for(let d=0;d<o.length;d++)if(o[d]in v.docStyle)return o[d];return o[0]}static create(o,d,p){const g=window.document.createElement(o);return d!==void 0&&(g.className=d),p&&p.appendChild(g),g}static createNS(o,d){return window.document.createElementNS(o,d)}static disableDrag(){v.docStyle&&v.selectProp&&(v.userSelect=v.docStyle[v.selectProp],v.docStyle[v.selectProp]="none")}static enableDrag(){v.docStyle&&v.selectProp&&(v.docStyle[v.selectProp]=v.userSelect)}static setTransform(o,d){o.style[v.transformProp]=d}static addEventListener(o,d,p,g={}){o.addEventListener(d,p,"passive"in g?g:g.capture)}static removeEventListener(o,d,p,g={}){o.removeEventListener(d,p,"passive"in g?g:g.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",v.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",v.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",v.suppressClickInternal,!0)},0)}static mousePos(o,d){const p=o.getBoundingClientRect();return new l.Point(d.clientX-p.left-o.clientLeft,d.clientY-p.top-o.clientTop)}static touchPos(o,d){const p=o.getBoundingClientRect(),g=[];for(let x=0;x<d.length;x++)g.push(new l.Point(d[x].clientX-p.left-o.clientLeft,d[x].clientY-p.top-o.clientTop));return g}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}v.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,v.selectProp=v.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),v.transformProp=v.testProp(["transform","WebkitTransform"]);const S={supported:!1,testSupport:function(y){!z&&B&&(V?J(y):I=y)}};let I,B,z=!1,V=!1;function J(y){const o=y.createTexture();y.bindTexture(y.TEXTURE_2D,o);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,B),y.isContextLost())return;S.supported=!0}catch{}y.deleteTexture(o),z=!0}var ue,j;typeof document<"u"&&(B=document.createElement("img"),B.onload=function(){I&&J(I),I=null,V=!0},B.onerror=function(){z=!0,I=null},B.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let o,d,p,g;y.resetRequestQueue=()=>{o=[],d=0,p=0,g={}},y.addThrottleControl=L=>{const D=p++;return g[D]=L,D},y.removeThrottleControl=L=>{delete g[L],T()},y.getImage=(L,D,F=!0)=>{S.supported&&(L.headers||(L.headers={}),L.headers.accept="image/webp,*/*");const H={requestParameters:L,supportImageRefresh:F,callback:D,cancelled:!1,completed:!1,cancel:()=>{H.completed||H.cancelled||(H.cancelled=!0,H.innerRequest&&(H.innerRequest.cancel(),d--),T())}};return o.push(H),T(),H};const x=L=>{const{requestParameters:D,supportImageRefresh:F,callback:H}=L;return l.extend(D,{type:"image"}),(F!==!1||l.isWorker()||l.getProtocolAction(D.url)||D.headers&&!Object.keys(D.headers).reduce((ne,ee)=>ne&&ee==="accept",!0)?l.makeRequest:P)(D,(ne,ee,re,Q)=>{E(L,H,ne,ee,re,Q)})},E=(L,D,F,H,ne,ee)=>{F?D(F):H instanceof HTMLImageElement||l.isImageBitmap(H)?D(null,H):H&&((re,Q)=>{typeof createImageBitmap=="function"?l.arrayBufferToImageBitmap(re,Q):l.arrayBufferToImage(re,Q)})(H,(re,Q)=>{re!=null?D(re):Q!=null&&D(null,Q,{cacheControl:ne,expires:ee})}),L.cancelled||(L.completed=!0,d--,T())},T=()=>{const L=(()=>{const D=Object.keys(g);let F=!1;if(D.length>0){for(const H of D)if(F=g[H](),F)break}return F})()?l.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=d;D<L&&o.length>0;D++){const F=o.shift();if(F.cancelled){D--;continue}const H=x(F);d++,F.innerRequest=H}},P=(L,D)=>{const F=new Image,H=L.url;let ne=!1;const ee=L.credentials;return ee&&ee==="include"?F.crossOrigin="use-credentials":(ee&&ee==="same-origin"||!l.sameOrigin(H))&&(F.crossOrigin="anonymous"),F.fetchPriority="high",F.onload=()=>{D(null,F),F.onerror=F.onload=null},F.onerror=()=>{ne||D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),F.onerror=F.onload=null},F.src=H,{cancel:()=>{ne=!0,F.src=""}}}}(ue||(ue={})),ue.resetRequestQueue(),function(y){y.Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown"}(j||(j={}));class W{constructor(o){this._transformRequestFn=o}transformRequest(o,d){return this._transformRequestFn&&this._transformRequestFn(o,d)||{url:o}}normalizeSpriteURL(o,d,p){const g=function(x){const E=x.match(Z);if(!E)throw new Error(`Unable to parse URL "${x}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(o);return g.path+=`${d}${p}`,function(x){const E=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${E}`}(g)}setTransformRequest(o){this._transformRequestFn=o}}const Z=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ae(y){var o=new l.ARRAY_TYPE(3);return o[0]=y[0],o[1]=y[1],o[2]=y[2],o}var be,Ee=function(y,o,d){return y[0]=o[0]-d[0],y[1]=o[1]-d[1],y[2]=o[2]-d[2],y};be=new l.ARRAY_TYPE(3),l.ARRAY_TYPE!=Float32Array&&(be[0]=0,be[1]=0,be[2]=0);var Le=function(y){var o=y[0],d=y[1];return o*o+d*d};function ke(y){const o=[];if(typeof y=="string")o.push({id:"default",url:y});else if(y&&y.length>0){const d=[];for(const{id:p,url:g}of y){const x=`${p}${g}`;d.indexOf(x)===-1&&(d.push(x),o.push({id:p,url:g}))}}return o}function Ue(y,o,d,p,g){if(p)return void y(p);if(g!==Object.values(o).length||g!==Object.values(d).length)return;const x={};for(const E in o){x[E]={};const T=l.browser.getImageCanvasContext(d[E]),P=o[E];for(const L in P){const{width:D,height:F,x:H,y:ne,sdf:ee,pixelRatio:re,stretchX:Q,stretchY:ge,content:Ae}=P[L];x[E][L]={data:null,pixelRatio:re,sdf:ee,stretchX:Q,stretchY:ge,content:Ae,spriteData:{width:D,height:F,x:H,y:ne,context:T}}}}y(null,x)}(function(){var y=new l.ARRAY_TYPE(2);l.ARRAY_TYPE!=Float32Array&&(y[0]=0,y[1]=0)})();class Me{constructor(o,d,p,g){this.context=o,this.format=p,this.texture=o.gl.createTexture(),this.update(d,g)}update(o,d,p){const{width:g,height:x}=o,E=!(this.size&&this.size[0]===g&&this.size[1]===x||p),{context:T}=this,{gl:P}=T;if(this.useMipmap=!!(d&&d.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!d||d.premultiply!==!1)),E)this.size=[g,x],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.isImageBitmap(o)?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,o):P.texImage2D(P.TEXTURE_2D,0,this.format,g,x,0,this.format,P.UNSIGNED_BYTE,o.data);else{const{x:L,y:D}=p||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.isImageBitmap(o)?P.texSubImage2D(P.TEXTURE_2D,0,L,D,P.RGBA,P.UNSIGNED_BYTE,o):P.texSubImage2D(P.TEXTURE_2D,0,L,D,g,x,P.RGBA,P.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)}bind(o,d,p){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),p!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=x.LINEAR),o!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,o),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,p||o),this.filter=o),d!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,d),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function ut(y){const{userImage:o}=y;return!!(o&&o.render&&o.render())&&(y.data.replace(new Uint8Array(o.data.buffer)),!0)}class Lt extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:d,callback:p}of this.requestors)this._notify(d,p);this.requestors=[]}}getImage(o){const d=this.images[o];if(d&&!d.data&&d.spriteData){const p=d.spriteData;d.data=new l.RGBAImage({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),d.spriteData=null}return d}addImage(o,d){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,d)&&(this.images[o]=d)}_validate(o,d){let p=!0;const g=d.data||d.spriteData;return this._validateStretch(d.stretchX,g&&g.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(d.stretchY,g&&g.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(d.content,d)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,d){if(!o)return!0;let p=0;for(const g of o){if(g[0]<p||g[1]<g[0]||d<g[1])return!1;p=g[1]}return!0}_validateContent(o,d){if(!o)return!0;if(o.length!==4)return!1;const p=d.spriteData,g=p&&p.width||d.data.width,x=p&&p.height||d.data.height;return!(o[0]<0||g<o[0]||o[1]<0||x<o[1]||o[2]<0||g<o[2]||o[3]<0||x<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,d,p=!0){const g=this.getImage(o);if(p&&(g.data.width!==d.data.width||g.data.height!==d.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=g.version+1,this.images[o]=d,this.updatedImages[o]=!0}removeImage(o){const d=this.images[o];delete this.images[o],delete this.patterns[o],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,d){let p=!0;if(!this.isLoaded())for(const g of o)this.images[g]||(p=!1);this.isLoaded()||p?this._notify(o,d):this.requestors.push({ids:o,callback:d})}_notify(o,d){const p={};for(const g of o){let x=this.getImage(g);x||(this.fire(new l.Event("styleimagemissing",{id:g})),x=this.getImage(g)),x?p[g]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:l.warnOnce(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,p)}getPixelSize(){const{width:o,height:d}=this.atlasImage;return{width:o,height:d}}getPattern(o){const d=this.patterns[o],p=this.getImage(o);if(!p)return null;if(d&&d.position.version===p.version)return d.position;if(d)d.position.version=p.version;else{const g={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new l.ImagePosition(g,p);this.patterns[o]={bin:g,position:x}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const d=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Me(o,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const x in this.patterns)o.push(this.patterns[x].bin);const{w:d,h:p}=l.potpack(o),g=this.atlasImage;g.resize({width:d||1,height:p||1});for(const x in this.patterns){const{bin:E}=this.patterns[x],T=E.x+1,P=E.y+1,L=this.getImage(x).data,D=L.width,F=L.height;l.RGBAImage.copy(L,g,{x:0,y:0},{x:T,y:P},{width:D,height:F}),l.RGBAImage.copy(L,g,{x:0,y:F-1},{x:T,y:P-1},{width:D,height:1}),l.RGBAImage.copy(L,g,{x:0,y:0},{x:T,y:P+F},{width:D,height:1}),l.RGBAImage.copy(L,g,{x:D-1,y:0},{x:T-1,y:P},{width:1,height:F}),l.RGBAImage.copy(L,g,{x:0,y:0},{x:T+D,y:P},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const d of o){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const p=this.getImage(d);p||l.warnOnce(`Image with ID: "${d}" was not found`),ut(p)&&this.updateImage(d,p)}}}const Ft=1e20;function Rt(y,o,d,p,g,x,E,T,P){for(let L=o;L<o+p;L++)Jn(y,d*x+L,x,g,E,T,P);for(let L=d;L<d+g;L++)Jn(y,L*x+o,1,p,E,T,P)}function Jn(y,o,d,p,g,x,E){x[0]=0,E[0]=-Ft,E[1]=Ft,g[0]=y[o];for(let T=1,P=0,L=0;T<p;T++){g[T]=y[o+T*d];const D=T*T;do{const F=x[P];L=(g[T]-g[F]+D-F*F)/(T-F)/2}while(L<=E[P]&&--P>-1);P++,x[P]=T,E[P]=L,E[P+1]=Ft}for(let T=0,P=0;T<p;T++){for(;E[P+1]<T;)P++;const L=x[P],D=T-L;y[o+T*d]=g[L]+D*D}}class ai{constructor(o,d){this.requestManager=o,this.localIdeographFontFamily=d,this.entries={}}setURL(o){this.url=o}getGlyphs(o,d){const p=[];for(const g in o)for(const x of o[g])p.push({stack:g,id:x});l.asyncAll(p,({stack:g,id:x},E)=>{let T=this.entries[g];T||(T=this.entries[g]={glyphs:{},requests:{},ranges:{}});let P=T.glyphs[x];if(P!==void 0)return void E(null,{stack:g,id:x,glyph:P});if(P=this._tinySDF(T,g,x),P)return T.glyphs[x]=P,void E(null,{stack:g,id:x,glyph:P});const L=Math.floor(x/256);if(256*L>65535)return void E(new Error("glyphs > 65535 not supported"));if(T.ranges[L])return void E(null,{stack:g,id:x,glyph:P});if(!this.url)return void E(new Error("glyphsUrl is not set"));let D=T.requests[L];D||(D=T.requests[L]=[],ai.loadGlyphRange(g,L,this.url,this.requestManager,(F,H)=>{if(H){for(const ne in H)this._doesCharSupportLocalGlyph(+ne)||(T.glyphs[+ne]=H[+ne]);T.ranges[L]=!0}for(const ne of D)ne(F,H);delete T.requests[L]})),D.push((F,H)=>{F?E(F):H&&E(null,{stack:g,id:x,glyph:H[x]||null})})},(g,x)=>{if(g)d(g);else if(x){const E={};for(const{stack:T,id:P,glyph:L}of x)(E[T]||(E[T]={}))[P]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics};d(null,E)}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](o)||l.unicodeBlockLookup["Hangul Syllables"](o)||l.unicodeBlockLookup.Hiragana(o)||l.unicodeBlockLookup.Katakana(o))}_tinySDF(o,d,p){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(p))return;let x=o.tinySDF;if(!x){let T="400";/bold/i.test(d)?T="900":/medium/i.test(d)?T="500":/light/i.test(d)&&(T="200"),x=o.tinySDF=new ai.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:g,fontWeight:T})}const E=x.draw(String.fromCharCode(p));return{id:p,bitmap:new l.AlphaImage({width:E.width||30,height:E.height||30},E.data),metrics:{width:E.glyphWidth||24,height:E.glyphHeight||24,left:E.glyphLeft||0,top:E.glyphTop-27||-8,advance:E.glyphAdvance||24}}}}ai.loadGlyphRange=function(y,o,d,p,g){const x=256*o,E=x+255,T=p.transformRequest(d.replace("{fontstack}",y).replace("{range}",`${x}-${E}`),j.Glyphs);l.getArrayBuffer(T,(P,L)=>{if(P)g(P);else if(L){const D={};for(const F of l.parseGlyphPbf(L))D[F.id]=F;g(null,D)}})},ai.TinySDF=class{constructor({fontSize:y=24,buffer:o=3,radius:d=8,cutoff:p=.25,fontFamily:g="sans-serif",fontWeight:x="normal",fontStyle:E="normal"}={}){this.buffer=o,this.cutoff=p,this.radius=d;const T=this.size=y+4*o,P=this._createCanvas(T),L=this.ctx=P.getContext("2d",{willReadFrequently:!0});L.font=`${E} ${x} ${y}px ${g}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(y){const o=document.createElement("canvas");return o.width=o.height=y,o}draw(y){const{width:o,actualBoundingBoxAscent:d,actualBoundingBoxDescent:p,actualBoundingBoxLeft:g,actualBoundingBoxRight:x}=this.ctx.measureText(y),E=Math.ceil(d),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-g))),P=Math.min(this.size-this.buffer,E+Math.ceil(p)),L=T+2*this.buffer,D=P+2*this.buffer,F=Math.max(L*D,0),H=new Uint8ClampedArray(F),ne={data:H,width:L,height:D,glyphWidth:T,glyphHeight:P,glyphTop:E,glyphLeft:0,glyphAdvance:o};if(T===0||P===0)return ne;const{ctx:ee,buffer:re,gridInner:Q,gridOuter:ge}=this;ee.clearRect(re,re,T,P),ee.fillText(y,re,re+E);const Ae=ee.getImageData(re,re,T,P);ge.fill(Ft,0,F),Q.fill(0,0,F);for(let le=0;le<P;le++)for(let ye=0;ye<T;ye++){const Ce=Ae.data[4*(le*T+ye)+3]/255;if(Ce===0)continue;const Ie=(le+re)*L+ye+re;if(Ce===1)ge[Ie]=0,Q[Ie]=Ft;else{const Oe=.5-Ce;ge[Ie]=Oe>0?Oe*Oe:0,Q[Ie]=Oe<0?Oe*Oe:0}}Rt(ge,0,0,L,D,L,this.f,this.v,this.z),Rt(Q,re,re,T,P,L,this.f,this.v,this.z);for(let le=0;le<F;le++){const ye=Math.sqrt(ge[le])-Math.sqrt(Q[le]);H[le]=Math.round(255-255*(ye/this.radius+this.cutoff))}return ne}};class Bi{constructor(){this.specification=l.v8Spec.light.position}possiblyEvaluate(o,d){return l.sphericalToCartesian(o.expression.evaluate(d))}interpolate(o,d,p){return{x:l.interpolate.number(o.x,d.x,p),y:l.interpolate.number(o.y,d.y,p),z:l.interpolate.number(o.z,d.z,p)}}}let tt,At;class Pt extends l.Evented{constructor(o){super(),tt=tt||new l.Properties({anchor:new l.DataConstantProperty(l.v8Spec.light.anchor),position:new Bi,color:new l.DataConstantProperty(l.v8Spec.light.color),intensity:new l.DataConstantProperty(l.v8Spec.light.intensity)}),this._transitionable=new l.Transitionable(tt),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d={}){if(!this._validate(l.validateLight,o,d))for(const p in o){const g=o[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),g):this._transitionable.setValue(p,g)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,o.call(l.validateStyle,l.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.v8Spec})))}}class tn{constructor(o,d){this.width=o,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,d){const p=o.join(",")+String(d);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(o,d)),this.dashEntry[p]}getDashRanges(o,d,p){const g=[];let x=o.length%2==1?-o[o.length-1]*p:0,E=o[0]*p,T=!0;g.push({left:x,right:E,isDash:T,zeroLength:o[0]===0});let P=o[0];for(let L=1;L<o.length;L++){T=!T;const D=o[L];x=P*p,P+=D,E=P*p,g.push({left:x,right:E,isDash:T,zeroLength:D===0})}return g}addRoundDash(o,d,p){const g=d/2;for(let x=-p;x<=p;x++){const E=this.width*(this.nextRow+p+x);let T=0,P=o[T];for(let L=0;L<this.width;L++){L/P.right>1&&(P=o[++T]);const D=Math.abs(L-P.left),F=Math.abs(L-P.right),H=Math.min(D,F);let ne;const ee=x/p*(g+1);if(P.isDash){const re=g-Math.abs(ee);ne=Math.sqrt(H*H+re*re)}else ne=g-Math.sqrt(H*H+ee*ee);this.data[E+L]=Math.max(0,Math.min(255,ne+128))}}}addRegularDash(o){for(let T=o.length-1;T>=0;--T){const P=o[T],L=o[T+1];P.zeroLength?o.splice(T,1):L&&L.isDash===P.isDash&&(L.left=P.left,o.splice(T,1))}const d=o[0],p=o[o.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);const g=this.width*this.nextRow;let x=0,E=o[x];for(let T=0;T<this.width;T++){T/E.right>1&&(E=o[++x]);const P=Math.abs(T-E.left),L=Math.abs(T-E.right),D=Math.min(P,L);this.data[g+T]=Math.max(0,Math.min(255,(E.isDash?D:-D)+128))}}addDash(o,d){const p=d?7:0,g=2*p+1;if(this.nextRow+g>this.height)return l.warnOnce("LineAtlas out of space"),null;let x=0;for(let T=0;T<o.length;T++)x+=o[T];if(x!==0){const T=this.width/x,P=this.getDashRanges(o,this.width,T);d?this.addRoundDash(P,T,p):this.addRegularDash(P)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:x};return this.nextRow+=g,this.dirty=!0,E}bind(o){const d=o.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}class $t{constructor(o,d,p){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=p;const g=this.workerPool.acquire(p);for(let x=0;x<g.length;x++){const E=new $t.Actor(g[x],d,p);E.name=`Worker ${x}`,this.actors.push(E)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,d,p){l.asyncAll(this.actors,(g,x)=>{g.send(o,d,x)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}}function Kn(y,o,d){const p=function(g,x){if(g)return d(g);if(x){const E=l.pick(l.extend(x,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(E.vectorLayers=x.vector_layers,E.vectorLayerIds=E.vectorLayers.map(T=>T.id)),d(null,E)}};return y.url?l.getJSON(o.transformRequest(y.url,j.Source),p):l.browser.frame(()=>p(null,y))}$t.Actor=l.Actor;class Zt{constructor(o,d){o&&(d?this.setSouthWest(o).setNorthEast(d):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof l.LngLat?new l.LngLat(o.lng,o.lat):l.LngLat.convert(o),this}setSouthWest(o){return this._sw=o instanceof l.LngLat?new l.LngLat(o.lng,o.lat):l.LngLat.convert(o),this}extend(o){const d=this._sw,p=this._ne;let g,x;if(o instanceof l.LngLat)g=o,x=o;else{if(!(o instanceof Zt))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(Zt.convert(o)):this.extend(l.LngLat.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(l.LngLat.convert(o)):this;if(g=o._sw,x=o._ne,!g||!x)return this}return d||p?(d.lng=Math.min(g.lng,d.lng),d.lat=Math.min(g.lat,d.lat),p.lng=Math.max(x.lng,p.lng),p.lat=Math.max(x.lat,p.lat)):(this._sw=new l.LngLat(g.lng,g.lat),this._ne=new l.LngLat(x.lng,x.lat)),this}getCenter(){return new l.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new l.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:d,lat:p}=l.LngLat.convert(o);let g=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&g}static convert(o){return o instanceof Zt?o:o&&new Zt(o)}static fromLngLat(o,d=0){const p=360*d/40075017,g=p/Math.cos(Math.PI/180*o.lat);return new Zt(new l.LngLat(o.lng-g,o.lat-p),new l.LngLat(o.lng+g,o.lat+p))}}class Pr{constructor(o,d,p){this.bounds=Zt.convert(this.validateBounds(o)),this.minzoom=d||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const d=Math.pow(2,o.z),p=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*d),g=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*d),x=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*d),E=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*d);return o.x>=p&&o.x<x&&o.y>=g&&o.y<E}}class Qi extends l.Evented{constructor(o,d,p,g){if(super(),this.load=()=>{this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Kn(this._options,this.map._requestManager,(x,E)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),x?this.fire(new l.ErrorEvent(x)):E&&(l.extend(this,E),E.bounds&&(this.tileBounds=new Pr(E.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>l.extend({},this._options),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(d,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(o,d){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(p,j.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function x(E,T){return delete o.request,o.aborted?d(null):E&&E.status!==404?d(E):(T&&T.resourceTiming&&(o.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&o.setExpiryData(T),o.loadVectorData(T,this.map.painter),d(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}g.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=d:o.request=o.actor.send("reloadTile",g,x.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",g,x.bind(this)))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class mn extends l.Evented{constructor(o,d,p,g){super(),this.id=o,this.dispatcher=p,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},d),l.extend(this,l.pick(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Kn(this._options,this.map._requestManager,(o,d)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new l.ErrorEvent(o)):d&&(l.extend(this,d),d.bounds&&(this.tileBounds=new Pr(d.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,d){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.request=ue.getImage(this.map._requestManager.transformRequest(p,j.Tile),(g,x,E)=>{if(delete o.request,o.aborted)o.state="unloaded",d(null);else if(g)o.state="errored",d(g);else if(x){this.map._refreshExpiredTiles&&E&&o.setExpiryData(E);const T=this.map.painter.context,P=T.gl;o.texture=this.map.painter.getTileTexture(x.width),o.texture?o.texture.update(x,{useMipmap:!0}):(o.texture=new Me(T,x,P.RGBA,{useMipmap:!0}),o.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),T.extTextureFilterAnisotropic&&P.texParameterf(P.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax)),o.state="loaded",d(null)}},this.map._refreshExpiredTiles)}abortTile(o,d){o.request&&(o.request.cancel(),delete o.request),d()}unloadTile(o,d){o.texture&&this.map.painter.saveTileTexture(o.texture),d()}hasTransition(){return!1}}class cr extends mn{constructor(o,d,p,g){super(o,d,p,g),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(o,d){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function g(x,E){x&&(o.state="errored",d(x)),E&&(o.dem=E,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded",d(null))}o.request=ue.getImage(this.map._requestManager.transformRequest(p,j.Tile),(function(x,E){if(delete o.request,o.aborted)o.state="unloaded",d(null);else if(x)o.state="errored",d(x);else if(E){this.map._refreshExpiredTiles&&o.setExpiryData(E),delete E.cacheControl,delete E.expires;const T=l.isImageBitmap(E)&&(At==null&&(At=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),At)?E:l.browser.getImageData(E,1),P={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:T,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",P,g.bind(this)))}}).bind(this),this.map._refreshExpiredTiles),o.neighboringTiles=this._getNeighboringTiles(o.tileID)}_getNeighboringTiles(o){const d=o.canonical,p=Math.pow(2,d.z),g=(d.x-1+p)%p,x=d.x===0?o.wrap-1:o.wrap,E=(d.x+1+p)%p,T=d.x+1===p?o.wrap+1:o.wrap,P={};return P[new l.OverscaledTileID(o.overscaledZ,x,d.z,g,d.y).key]={backfilled:!1},P[new l.OverscaledTileID(o.overscaledZ,T,d.z,E,d.y).key]={backfilled:!1},d.y>0&&(P[new l.OverscaledTileID(o.overscaledZ,x,d.z,g,d.y-1).key]={backfilled:!1},P[new l.OverscaledTileID(o.overscaledZ,o.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},P[new l.OverscaledTileID(o.overscaledZ,T,d.z,E,d.y-1).key]={backfilled:!1}),d.y+1<p&&(P[new l.OverscaledTileID(o.overscaledZ,x,d.z,g,d.y+1).key]={backfilled:!1},P[new l.OverscaledTileID(o.overscaledZ,o.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},P[new l.OverscaledTileID(o.overscaledZ,T,d.z,E,d.y+1).key]={backfilled:!1}),P}unloadTile(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})}}class cn extends l.Evented{constructor(o,d,p,g){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>l.extend({},this._options,{type:this.type,data:this._data}),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(g),this._data=d.data,this._options=l.extend({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const x=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*x,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*x,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:l.EXTENT,radius:(d.clusterRadius||50)*x,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},d),this}getClusterChildren(o,d){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},d),this}getClusterLeaves(o,d,p,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:d,offset:p},g),this}_updateWorkerData(o){const d=l.extend({},this.workerOptions);o?d.dataDiff=o:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(l.browser.resolveURL(this._data),j.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,d,(p,g)=>{if(this._pendingLoads--,this._removed||g&&g.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source"}));let x=null;if(g&&g.resourceTiming&&g.resourceTiming[this.id]&&(x=g.resourceTiming[this.id].slice(0)),p)return void this.fire(new l.ErrorEvent(p));const E={dataType:"source"};this._collectResourceTiming&&x&&x.length>0&&l.extend(E,{resourceTiming:x}),this.fire(new l.Event("data",{...E,sourceDataType:"metadata"})),this.fire(new l.Event("data",{...E,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(o,d){const p=o.actor?"reloadTile":"loadTile";o.actor=this.actor;const g={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request=this.actor.send(p,g,(x,E)=>(delete o.request,o.unloadVectorData(),o.aborted?d(null):x?d(x):(o.loadVectorData(E,this.map.painter,p==="reloadTile"),d(null))))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0}unloadTile(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var gn=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class er extends l.Evented{constructor(o,d,p,g){super(),this.load=(x,E)=>{this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=ue.getImage(this.map._requestManager.transformRequest(this.url,j.Image),(T,P)=>{this._request=null,this._loaded=!0,T?this.fire(new l.ErrorEvent(T)):P&&(this.image=P,x&&(this.coordinates=x),E&&E(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const x=this.map.painter.context,E=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,gn.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Me(x,this.image,E.RGBA),this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE));let T=!1;for(const P in this.tiles){const L=this.tiles[P];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture,T=!0)}T&&this.fire(new l.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=o,this.dispatcher=p,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=d}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(o){this.coordinates=o;const d=o.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(g){let x=1/0,E=1/0,T=-1/0,P=-1/0;for(const H of g)x=Math.min(x,H.x),E=Math.min(E,H.y),T=Math.max(T,H.x),P=Math.max(P,H.y);const L=Math.max(T-x,P-E),D=Math.max(0,Math.floor(-Math.log(L)/Math.LN2)),F=Math.pow(2,D);return new l.CanonicalTileID(D,Math.floor((x+T)/2*F),Math.floor((E+P)/2*F))}(d),this.minzoom=this.maxzoom=this.tileID.z;const p=d.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(o,d){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},d(null)):(o.state="errored",d(null))}hasTransition(){return!1}}class ur extends er{constructor(o,d,p,g){super(o,d,p,g),this.load=()=>{this._loaded=!1;const x=this.options;this.urls=[];for(const E of x.urls)this.urls.push(this.map._requestManager.transformRequest(E,j.Source).url);l.getVideo(this.urls,(E,T)=>{this._loaded=!0,E?this.fire(new l.ErrorEvent(E)):T&&(this.video=T,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const x=this.map.painter.context,E=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,gn.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.texSubImage2D(E.TEXTURE_2D,0,0,0,E.RGBA,E.UNSIGNED_BYTE,this.video)):(this.texture=new Me(x,this.video,E.RGBA),this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE));let T=!1;for(const P in this.tiles){const L=this.tiles[P];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture,T=!0)}T&&this.fire(new l.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=d}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const d=this.video.seekable;o<d.start(0)||o>d.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Be extends er{constructor(o,d,p,g){super(o,d,p,g),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let x=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,x=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,x=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const E=this.map.painter.context,T=E.gl;this.boundsBuffer||(this.boundsBuffer=E.createVertexBuffer(this._boundsArray,gn.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(x||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Me(E,this.canvas,T.RGBA,{premultiply:!0});let P=!1;for(const L in this.tiles){const D=this.tiles[L];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture,P=!0)}P&&this.fire(new l.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(E=>typeof E!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const tr={},Xr=y=>{switch(y){case"geojson":return cn;case"image":return er;case"raster":return mn;case"raster-dem":return cr;case"vector":return Qi;case"video":return ur;case"canvas":return Be}return tr[y]};function Ut(y,o){const d=l.create();return l.translate(d,d,[1,1,0]),l.scale(d,d,[.5*y.width,.5*y.height,1]),l.multiply(d,d,y.calculatePosMatrix(o.toUnwrapped()))}function Gt(y,o,d,p,g,x){const E=function(F,H,ne){if(F)for(const ee of F){const re=H[ee];if(re&&re.source===ne&&re.type==="fill-extrusion")return!0}else for(const ee in H){const re=H[ee];if(re.source===ne&&re.type==="fill-extrusion")return!0}return!1}(g&&g.layers,o,y.id),T=x.maxPitchScaleFactor(),P=y.tilesIn(p,T,E);P.sort(ks);const L=[];for(const F of P)L.push({wrappedTileID:F.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(o,d,y._state,F.queryGeometry,F.cameraQueryGeometry,F.scale,g,x,T,Ut(y.transform,F.tileID))});const D=function(F){const H={},ne={};for(const ee of F){const re=ee.queryResults,Q=ee.wrappedTileID,ge=ne[Q]=ne[Q]||{};for(const Ae in re){const le=re[Ae],ye=ge[Ae]=ge[Ae]||{},Ce=H[Ae]=H[Ae]||[];for(const Ie of le)ye[Ie.featureIndex]||(ye[Ie.featureIndex]=!0,Ce.push(Ie))}}return H}(L);for(const F in D)D[F].forEach(H=>{const ne=H.feature,ee=y.getFeatureState(ne.layer["source-layer"],ne.id);ne.source=ne.layer.source,ne.layer["source-layer"]&&(ne.sourceLayer=ne.layer["source-layer"]),ne.state=ee});return D}function ks(y,o){const d=y.tileID,p=o.tileID;return d.overscaledZ-p.overscaledZ||d.canonical.y-p.canonical.y||d.wrap-p.wrap||d.canonical.x-p.canonical.x}class zs{constructor(o,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=l.uniqueId(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const d=o+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,d,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(g,x){const E={};if(!x)return E;for(const T of g){const P=T.layerIds.map(L=>x.getLayer(L)).filter(Boolean);if(P.length!==0){T.layers=P,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(L=>P.filter(D=>D.id===L)[0]));for(const L of P)E[L.id]=T}}return E}(o.buckets,d.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const x=this.buckets[g];if(x instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const x=this.buckets[g];if(x instanceof l.SymbolBucket&&x.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const g in this.buckets){const x=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(g).queryRadius(x))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const p in this.buckets){const g=this.buckets[p];g.uploadPending()&&g.upload(o)}const d=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Me(o,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Me(o,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,d,p,g,x,E,T,P,L,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:x,scale:E,tileSize:this.tileSize,pixelPosMatrix:D,transform:P,params:T,queryPadding:this.queryPadding*L},o,d,p):{}}querySourceFeatures(o,d){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const g=p.loadVTLayers(),x=d&&d.sourceLayer?d.sourceLayer:"",E=g._geojsonTileLayer||g[x];if(!E)return;const T=l.createFilter(d&&d.filter),{z:P,x:L,y:D}=this.tileID.canonical,F={z:P,x:L,y:D};for(let H=0;H<E.length;H++){const ne=E.feature(H);if(T.needGeometry){const Q=l.toEvaluationFeature(ne,!0);if(!T.filter(new l.EvaluationParameters(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!T.filter(new l.EvaluationParameters(this.tileID.overscaledZ),ne))continue;const ee=p.getId(ne,x),re=new l.GeoJSONFeature(ne,P,L,D,ee);re.tile=F,o.push(re)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const d=this.expirationTime;if(o.cacheControl){const p=l.parseCacheControl(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const p=Date.now();let g=!1;if(this.expirationTime>p)g=!1;else if(d)if(this.expirationTime<d)g=!0;else{const x=this.expirationTime-d;x?this.expirationTime=p+Math.max(x,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!d.style.hasLayer(g))continue;const x=this.buckets[g],E=x.layers[0].sourceLayer||"_geojsonTileLayer",T=p[E],P=o[E];if(!T||!P||Object.keys(P).length===0)continue;x.update(P,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const L=d&&d.style&&d.style.getLayer(g);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.browser.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=l.browser.now()+o}setDependencies(o,d){const p={};for(const g of d)p[g]=!0;this.dependencies[o]=p}hasDependency(o,d){for(const p of o){const g=this.dependencies[p];if(g){for(const x of d)if(g[x])return!0}}return!1}}class lo{constructor(o,d){this.max=o,this.onRemove=d,this.reset()}reset(){for(const o in this.data)for(const d of this.data[o])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(o,d,p){const g=o.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const x={value:d,timeout:void 0};if(p!==void 0&&(x.timeout=setTimeout(()=>{this.remove(o,x)},p)),this.data[g].push(x),this.order.push(g),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const d=this.data[o].shift();return d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),d.value}getByKey(o){const d=this.data[o];return d?d[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,d){if(!this.has(o))return this;const p=o.wrapped().key,g=d===void 0?0:this.data[p].indexOf(d),x=this.data[p][g];return this.data[p].splice(g,1),x.timeout&&clearTimeout(x.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(o){const d=[];for(const p in this.data)for(const g of this.data[p])o(g.value)||d.push(g);for(const p of d)this.remove(p.value.tileID,p)}}class Li{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,d,p){const g=String(d);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][g]=this.stateChanges[o][g]||{},l.extend(this.stateChanges[o][g],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(const x in this.state[o])x!==g&&(this.deletedStates[o][x]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][g]===null){this.deletedStates[o][g]={};for(const x in this.state[o][g])p[x]||(this.deletedStates[o][g][x]=null)}else for(const x in p)this.deletedStates[o]&&this.deletedStates[o][g]&&this.deletedStates[o][g][x]===null&&delete this.deletedStates[o][g][x]}removeFeatureState(o,d,p){if(this.deletedStates[o]===null)return;const g=String(d);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&d!==void 0)this.deletedStates[o][g]!==null&&(this.deletedStates[o][g]=this.deletedStates[o][g]||{},this.deletedStates[o][g][p]=null);else if(d!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][g])for(p in this.deletedStates[o][g]={},this.stateChanges[o][g])this.deletedStates[o][g][p]=null;else this.deletedStates[o][g]=null;else this.deletedStates[o]=null}getState(o,d){const p=String(d),g=l.extend({},(this.state[o]||{})[p],(this.stateChanges[o]||{})[p]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const x=this.deletedStates[o][d];if(x===null)return{};for(const E in x)delete g[E]}return g}initializeTileState(o,d){o.setFeatureState(this.state,d)}coalesceChanges(o,d){const p={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const x={};for(const E in this.stateChanges[g])this.state[g][E]||(this.state[g][E]={}),l.extend(this.state[g][E],this.stateChanges[g][E]),x[E]=this.state[g][E];p[g]=x}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const x={};if(this.deletedStates[g]===null)for(const E in this.state[g])x[E]={},this.state[g][E]={};else for(const E in this.deletedStates[g]){if(this.deletedStates[g][E]===null)this.state[g][E]={};else for(const T of Object.keys(this.deletedStates[g][E]))delete this.state[g][E][T];x[E]=this.state[g][E]}p[g]=p[g]||{},l.extend(p[g],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const g in o)o[g].setFeatureState(p,d)}}class Sn extends l.Evented{constructor(o,d,p){super(),this.id=o,this.dispatcher=p,this.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,x,E,T)=>{const P=new(Xr(x.type))(g,x,E,T);if(P.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${P.id}`);return P})(o,d,p,this),this._tiles={},this._cache=new lo(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Li,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const d=this._tiles[o];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,d){return this._source.loadTile(o,d)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){this._source.abortTile&&this._source.abortTile(o,()=>{}),this._source.fire(new l.Event("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const p=this._tiles[d];p.upload(o),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(ha).map(o=>o.key)}getRenderableIds(o){const d=[];for(const p in this._tiles)this._isIdRenderable(p,o)&&d.push(this._tiles[p]);return o?d.sort((p,g)=>{const x=p.tileID,E=g.tileID,T=new l.Point(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),P=new l.Point(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-E.overscaledZ||P.y-T.y||P.x-T.x}).map(p=>p.tileID.key):d.map(p=>p.tileID).sort(ha).map(p=>p.key)}hasRenderableParent(o){const d=this.findLoadedParent(o,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(o,d){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(d||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,d){const p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=d),this._loadTile(p,this._tileLoaded.bind(this,p,o,d)))}_tileLoaded(o,d,p,g){if(g)return o.state="errored",void(g.status!==404?this._source.fire(new l.ErrorEvent(g,{tile:o})):this.update(this.transform,this.terrain));o.timeAdded=l.browser.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(d,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const d=this.getRenderableIds();for(let g=0;g<d.length;g++){const x=d[g];if(o.neighboringTiles&&o.neighboringTiles[x]){const E=this.getTileByID(x);p(o,E),p(E,o)}}function p(g,x){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let E=x.tileID.canonical.x-g.tileID.canonical.x;const T=x.tileID.canonical.y-g.tileID.canonical.y,P=Math.pow(2,g.tileID.canonical.z),L=x.tileID.key;E===0&&T===0||Math.abs(T)>1||(Math.abs(E)>1&&(Math.abs(E+P)===1?E+=P:Math.abs(E-P)===1&&(E-=P)),x.dem&&g.dem&&(g.dem.backfillBorder(x.dem,E,T),g.neighboringTiles&&g.neighboringTiles[L]&&(g.neighboringTiles[L].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,d,p,g){for(const x in this._tiles){let E=this._tiles[x];if(g[x]||!E.hasData()||E.tileID.overscaledZ<=d||E.tileID.overscaledZ>p)continue;let T=E.tileID;for(;E&&E.tileID.overscaledZ>d+1;){const L=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[L.key],E&&E.hasData()&&(T=L)}let P=T;for(;P.overscaledZ>d;)if(P=P.scaledTo(P.overscaledZ-1),o[P.key]){g[T.key]=T;break}}}findLoadedParent(o,d){if(o.key in this._loadedParentTiles){const p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=d?p:null}for(let p=o.overscaledZ-1;p>=d;p--){const g=o.scaledTo(p),x=this._getLoadedTile(g);if(x)return x}}_getLoadedTile(o){const d=this._tiles[o.key];return d&&d.hasData()?d:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const d=Math.ceil(o.width/this._source.tileSize)+1,p=Math.ceil(o.height/this._source.tileSize)+1,g=Math.floor(d*p*(this._maxTileCacheZoomLevels===null?l.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(x)}handleWrapJump(o){const d=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,d){const p={};for(const g in this._tiles){const x=this._tiles[g];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+d),p[x.tileID.key]=x}this._tiles=p;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(o,d){if(this.transform=o,this.terrain=d,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new l.OverscaledTileID(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(p=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(p=p.filter(D=>this._source.hasTile(D)))):p=[];const g=o.coveringZoomLevel(this._source),x=Math.max(g-Sn.maxOverzooming,this._source.minzoom),E=Math.max(g+Sn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const D={};for(const F of p)if(F.canonical.z>this._source.minzoom){const H=F.scaledTo(F.canonical.z-1);D[H.key]=H;const ne=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));D[ne.key]=ne}p=p.concat(Object.values(D))}const T=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,T&&this.fire(new l.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const P=this._updateRetainedTiles(p,g);if(No(this._source.type)){const D={},F={},H=Object.keys(P),ne=l.browser.now();for(const ee of H){const re=P[ee],Q=this._tiles[ee];if(!Q||Q.fadeEndTime!==0&&Q.fadeEndTime<=ne)continue;const ge=this.findLoadedParent(re,x);ge&&(this._addTile(ge.tileID),D[ge.tileID.key]=ge.tileID),F[ee]=re}this._retainLoadedChildren(F,g,E,P);for(const ee in D)P[ee]||(this._coveredTiles[ee]=!0,P[ee]=D[ee]);if(d){const ee={},re={};for(const Q of p)this._tiles[Q.key].hasData()?ee[Q.key]=Q:re[Q.key]=Q;for(const Q in re){const ge=re[Q].children(this._source.maxzoom);this._tiles[ge[0].key]&&this._tiles[ge[1].key]&&this._tiles[ge[2].key]&&this._tiles[ge[3].key]&&(ee[ge[0].key]=P[ge[0].key]=ge[0],ee[ge[1].key]=P[ge[1].key]=ge[1],ee[ge[2].key]=P[ge[2].key]=ge[2],ee[ge[3].key]=P[ge[3].key]=ge[3],delete re[Q])}for(const Q in re){const ge=this.findLoadedParent(re[Q],this._source.minzoom);if(ge){ee[ge.tileID.key]=P[ge.tileID.key]=ge.tileID;for(const Ae in ee)ee[Ae].isChildOf(ge.tileID)&&delete ee[Ae]}}for(const Q in this._tiles)ee[Q]||(this._coveredTiles[Q]=!0)}}for(const D in P)this._tiles[D].clearFadeHold();const L=l.keysDifference(this._tiles,P);for(const D of L){const F=this._tiles[D];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,d){const p={},g={},x=Math.max(d-Sn.maxOverzooming,this._source.minzoom),E=Math.max(d+Sn.maxUnderzooming,this._source.minzoom),T={};for(const P of o){const L=this._addTile(P);p[P.key]=P,L.hasData()||d<this._source.maxzoom&&(T[P.key]=P)}this._retainLoadedChildren(T,d,E,p);for(const P of o){let L=this._tiles[P.key];if(L.hasData())continue;if(d+1>this._source.maxzoom){const F=P.children(this._source.maxzoom)[0],H=this.getTile(F);if(H&&H.hasData()){p[F.key]=F;continue}}else{const F=P.children(this._source.maxzoom);if(p[F[0].key]&&p[F[1].key]&&p[F[2].key]&&p[F[3].key])continue}let D=L.wasRequested();for(let F=P.overscaledZ-1;F>=x;--F){const H=P.scaledTo(F);if(g[H.key])break;if(g[H.key]=!0,L=this.getTile(H),!L&&D&&(L=this._addTile(H)),L){const ne=L.hasData();if((D||ne)&&(p[H.key]=H),D=L.wasRequested(),ne)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const d=[];let p,g=this._tiles[o].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){p=this._loadedParentTiles[g.key];break}d.push(g.key);const x=g.scaledTo(g.overscaledZ-1);if(p=this._getLoadedTile(x),p)break;g=x}for(const x of d)this._loadedParentTiles[x]=p}}_addTile(o){let d=this._tiles[o.key];if(d)return d;d=this._cache.getAndRemove(o),d&&(this._setTileReloadTimer(o.key,d),d.tileID=o,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,d)));const p=d;return d||(d=new zs(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,o.key,d.state))),d.uses++,this._tiles[o.key]=d,p||this._source.fire(new l.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(o,d){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const p=d.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){const d=this._tiles[o];d&&(d.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,d,p){const g=[],x=this.transform;if(!x)return g;const E=p?x.getCameraQueryGeometry(o):o,T=o.map(ee=>x.pointCoordinate(ee,this.terrain)),P=E.map(ee=>x.pointCoordinate(ee,this.terrain)),L=this.getIds();let D=1/0,F=1/0,H=-1/0,ne=-1/0;for(const ee of P)D=Math.min(D,ee.x),F=Math.min(F,ee.y),H=Math.max(H,ee.x),ne=Math.max(ne,ee.y);for(let ee=0;ee<L.length;ee++){const re=this._tiles[L[ee]];if(re.holdingForFade())continue;const Q=re.tileID,ge=Math.pow(2,x.zoom-re.tileID.overscaledZ),Ae=d*re.queryPadding*l.EXTENT/re.tileSize/ge,le=[Q.getTilePoint(new l.MercatorCoordinate(D,F)),Q.getTilePoint(new l.MercatorCoordinate(H,ne))];if(le[0].x-Ae<l.EXTENT&&le[0].y-Ae<l.EXTENT&&le[1].x+Ae>=0&&le[1].y+Ae>=0){const ye=T.map(Ie=>Q.getTilePoint(Ie)),Ce=P.map(Ie=>Q.getTilePoint(Ie));g.push({tile:re,tileID:Q,queryGeometry:ye,cameraQueryGeometry:Ce,scale:ge})}}return g}getVisibleCoordinates(o){const d=this.getRenderableIds(o).map(p=>this._tiles[p].tileID);for(const p of d)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(No(this._source.type)){const o=l.browser.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=o)return!0}return!1}setFeatureState(o,d,p){this._state.updateState(o=o||"_geojsonTileLayer",d,p)}removeFeatureState(o,d,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",d,p)}getFeatureState(o,d){return this._state.getState(o=o||"_geojsonTileLayer",d)}setDependencies(o,d,p){const g=this._tiles[o];g&&g.setDependencies(d,p)}reloadTilesForDependencies(o,d){for(const p in this._tiles)this._tiles[p].hasDependency(o,d)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(o,d))}}function ha(y,o){const d=Math.abs(2*y.wrap)-+(y.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return y.overscaledZ-o.overscaledZ||p-d||o.canonical.y-y.canonical.y||o.canonical.x-y.canonical.x}function No(y){return y==="raster"||y==="image"||y==="video"}Sn.maxOverzooming=10,Sn.maxUnderzooming=3;const We="mapboxgl_preloaded_worker_pool";class Ri{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Ri.workerCount;)this.workers.push(new Worker(l.config.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[We]}numActive(){return Object.keys(this.active).length}}const Di=Math.floor(l.browser.hardwareConcurrency/2);let $r;function ds(){return $r||($r=new Ri),$r}Ri.workerCount=l.isSafari(globalThis)?Math.max(Math.min(Di,3),1):1;class $e{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=l.clamp(o,0,1);let d=1,p=this._distances[d];const g=o*this.paddedLength+this.padding;for(;p<g&&d<this._distances.length;)p=this._distances[++d];const x=d-1,E=this._distances[x],T=p-E,P=T>0?(g-E)/T:0;return this.points[x].mult(1-P).add(this.points[d].mult(P))}}function It(y,o){let d=!0;return y==="always"||y!=="never"&&o!=="never"||(d=!1),d}class Mt{constructor(o,d,p){const g=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(d/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)g.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,p,g,x){this._forEachCell(d,p,g,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(x)}insertCircle(o,d,p,g){this._forEachCell(d-g,p-g,d+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(p),this.circles.push(g)}_insertBoxCell(o,d,p,g,x,E){this.boxCells[x].push(E)}_insertCircleCell(o,d,p,g,x,E){this.circleCells[x].push(E)}_query(o,d,p,g,x,E,T){if(p<0||o>this.width||g<0||d>this.height)return[];const P=[];if(o<=0&&d<=0&&this.width<=p&&this.height<=g){if(x)return[{key:null,x1:o,y1:d,x2:p,y2:g}];for(let L=0;L<this.boxKeys.length;L++)P.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const D=this.circles[3*L],F=this.circles[3*L+1],H=this.circles[3*L+2];P.push({key:this.circleKeys[L],x1:D-H,y1:F-H,x2:D+H,y2:F+H})}}else this._forEachCell(o,d,p,g,this._queryCell,P,{hitTest:x,overlapMode:E,seenUids:{box:{},circle:{}}},T);return P}query(o,d,p,g){return this._query(o,d,p,g,!1,null)}hitTest(o,d,p,g,x,E){return this._query(o,d,p,g,!0,x,E).length>0}hitTestCircle(o,d,p,g,x){const E=o-p,T=o+p,P=d-p,L=d+p;if(T<0||E>this.width||L<0||P>this.height)return!1;const D=[];return this._forEachCell(E,P,T,L,this._queryCellCircle,D,{hitTest:!0,overlapMode:g,circle:{x:o,y:d,radius:p},seenUids:{box:{},circle:{}}},x),D.length>0}_queryCell(o,d,p,g,x,E,T,P){const{seenUids:L,hitTest:D,overlapMode:F}=T,H=this.boxCells[x];if(H!==null){const ee=this.bboxes;for(const re of H)if(!L.box[re]){L.box[re]=!0;const Q=4*re,ge=this.boxKeys[re];if(o<=ee[Q+2]&&d<=ee[Q+3]&&p>=ee[Q+0]&&g>=ee[Q+1]&&(!P||P(ge))&&(!D||!It(F,ge.overlapMode))&&(E.push({key:ge,x1:ee[Q],y1:ee[Q+1],x2:ee[Q+2],y2:ee[Q+3]}),D))return!0}}const ne=this.circleCells[x];if(ne!==null){const ee=this.circles;for(const re of ne)if(!L.circle[re]){L.circle[re]=!0;const Q=3*re,ge=this.circleKeys[re];if(this._circleAndRectCollide(ee[Q],ee[Q+1],ee[Q+2],o,d,p,g)&&(!P||P(ge))&&(!D||!It(F,ge.overlapMode))){const Ae=ee[Q],le=ee[Q+1],ye=ee[Q+2];if(E.push({key:ge,x1:Ae-ye,y1:le-ye,x2:Ae+ye,y2:le+ye}),D)return!0}}}return!1}_queryCellCircle(o,d,p,g,x,E,T,P){const{circle:L,seenUids:D,overlapMode:F}=T,H=this.boxCells[x];if(H!==null){const ee=this.bboxes;for(const re of H)if(!D.box[re]){D.box[re]=!0;const Q=4*re,ge=this.boxKeys[re];if(this._circleAndRectCollide(L.x,L.y,L.radius,ee[Q+0],ee[Q+1],ee[Q+2],ee[Q+3])&&(!P||P(ge))&&!It(F,ge.overlapMode))return E.push(!0),!0}}const ne=this.circleCells[x];if(ne!==null){const ee=this.circles;for(const re of ne)if(!D.circle[re]){D.circle[re]=!0;const Q=3*re,ge=this.circleKeys[re];if(this._circlesCollide(ee[Q],ee[Q+1],ee[Q+2],L.x,L.y,L.radius)&&(!P||P(ge))&&!It(F,ge.overlapMode))return E.push(!0),!0}}}_forEachCell(o,d,p,g,x,E,T,P){const L=this._convertToXCellCoord(o),D=this._convertToYCellCoord(d),F=this._convertToXCellCoord(p),H=this._convertToYCellCoord(g);for(let ne=L;ne<=F;ne++)for(let ee=D;ee<=H;ee++)if(x.call(this,o,d,p,g,this.xCellCount*ee+ne,E,T,P))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,p,g,x,E){const T=g-o,P=x-d,L=p+E;return L*L>T*T+P*P}_circleAndRectCollide(o,d,p,g,x,E,T){const P=(E-g)/2,L=Math.abs(o-(g+P));if(L>P+p)return!1;const D=(T-x)/2,F=Math.abs(d-(x+D));if(F>D+p)return!1;if(L<=P||F<=D)return!0;const H=L-P,ne=F-D;return H*H+ne*ne<=p*p}}function Ti(y,o,d,p,g){const x=l.create();return o?(l.scale(x,x,[1/g,1/g,1]),d||l.rotateZ(x,x,p.angle)):l.multiply(x,p.labelPlaneMatrix,y),x}function fs(y,o,d,p,g){if(o){const x=l.clone(y);return l.scale(x,x,[g,g,1]),d||l.rotateZ(x,x,-p.angle),x}return p.glCoordMatrix}function Et(y,o,d){let p;d?(p=[y.x,y.y,d(y.x,y.y),1],l.transformMat4(p,p,o)):(p=[y.x,y.y,0,1],oe(p,p,o));const g=p[3];return{point:new l.Point(p[0]/g,p[1]/g),signedDistanceFromCamera:g}}function Zr(y,o){return .5+y/o*.5}function Jr(y,o){const d=y[0]/y[3],p=y[1]/y[3];return d>=-o[0]&&d<=o[0]&&p>=-o[1]&&p<=o[1]}function Mr(y,o,d,p,g,x,E,T,P,L){const D=p?y.textSizeData:y.iconSizeData,F=l.evaluateSizeForZoom(D,d.transform.zoom),H=[256/d.width*2+1,256/d.height*2+1],ne=p?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;ne.clear();const ee=y.lineVertexArray,re=p?y.text.placedSymbolArray:y.icon.placedSymbolArray,Q=d.transform.width/d.transform.height;let ge=!1;for(let Ae=0;Ae<re.length;Ae++){const le=re.get(Ae);if(le.hidden||le.writingMode===l.WritingMode.vertical&&!ge){K(le.numGlyphs,ne);continue}let ye;if(ge=!1,L?(ye=[le.anchorX,le.anchorY,L(le.anchorX,le.anchorY),1],l.transformMat4(ye,ye,o)):(ye=[le.anchorX,le.anchorY,0,1],oe(ye,ye,o)),!Jr(ye,H)){K(le.numGlyphs,ne);continue}const Ce=Zr(d.transform.cameraToCenterDistance,ye[3]),Ie=l.evaluateSizeForFeature(D,F,le),Oe=E?Ie/Ce:Ie*Ce,Ge=new l.Point(le.anchorX,le.anchorY),Ne=Et(Ge,g,L).point,He={projections:{},offsets:{}},ht=li(le,Oe,!1,T,o,g,x,y.glyphOffsetArray,ee,ne,Ne,Ge,He,Q,P,L);ge=ht.useVertical,(ht.notEnoughRoom||ge||ht.needsFlipping&&li(le,Oe,!0,T,o,g,x,y.glyphOffsetArray,ee,ne,Ne,Ge,He,Q,P,L).notEnoughRoom)&&K(le.numGlyphs,ne)}p?y.text.dynamicLayoutVertexBuffer.updateData(ne):y.icon.dynamicLayoutVertexBuffer.updateData(ne)}function hr(y,o,d,p,g,x,E,T,P,L,D,F,H){const ne=T.glyphStartIndex+T.numGlyphs,ee=T.lineStartIndex,re=T.lineStartIndex+T.lineLength,Q=o.getoffsetX(T.glyphStartIndex),ge=o.getoffsetX(ne-1),Ae=N(y*Q,d,p,g,x,E,T.segment,ee,re,P,L,D,F,H);if(!Ae)return null;const le=N(y*ge,d,p,g,x,E,T.segment,ee,re,P,L,D,F,H);return le?{first:Ae,last:le}:null}function Ns(y,o,d,p){return y===l.WritingMode.horizontal&&Math.abs(d.y-o.y)>Math.abs(d.x-o.x)*p?{useVertical:!0}:(y===l.WritingMode.vertical?o.y<d.y:o.x>d.x)?{needsFlipping:!0}:null}function li(y,o,d,p,g,x,E,T,P,L,D,F,H,ne,ee,re){const Q=o/24,ge=y.lineOffsetX*Q,Ae=y.lineOffsetY*Q;let le;if(y.numGlyphs>1){const ye=y.glyphStartIndex+y.numGlyphs,Ce=y.lineStartIndex,Ie=y.lineStartIndex+y.lineLength,Oe=hr(Q,T,ge,Ae,d,D,F,y,P,x,H,ee,re);if(!Oe)return{notEnoughRoom:!0};const Ge=Et(Oe.first.point,E,re).point,Ne=Et(Oe.last.point,E,re).point;if(p&&!d){const He=Ns(y.writingMode,Ge,Ne,ne);if(He)return He}le=[Oe.first];for(let He=y.glyphStartIndex+1;He<ye-1;He++)le.push(N(Q*T.getoffsetX(He),ge,Ae,d,D,F,y.segment,Ce,Ie,P,x,H,ee,re));le.push(Oe.last)}else{if(p&&!d){const Ce=Et(F,g,re).point,Ie=y.lineStartIndex+y.segment+1,Oe=new l.Point(P.getx(Ie),P.gety(Ie)),Ge=Et(Oe,g,re),Ne=Ge.signedDistanceFromCamera>0?Ge.point:un(F,Oe,Ce,1,g,re),He=Ns(y.writingMode,Ce,Ne,ne);if(He)return He}const ye=N(Q*T.getoffsetX(y.glyphStartIndex),ge,Ae,d,D,F,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,P,x,H,ee,re);if(!ye)return{notEnoughRoom:!0};le=[ye]}for(const ye of le)l.addDynamicAttributes(L,ye.point,ye.angle);return{}}function un(y,o,d,p,g,x){const E=Et(y.add(y.sub(o)._unit()),g,x).point,T=d.sub(E);return d.add(T._mult(p/T.mag()))}function co(y,o){const{projectionCache:d,lineVertexArray:p,labelPlaneMatrix:g,tileAnchorPoint:x,distanceFromAnchor:E,getElevation:T,previousVertex:P,direction:L,absOffsetX:D}=o;if(d.projections[y])return d.projections[y];const F=new l.Point(p.getx(y),p.gety(y)),H=Et(F,g,T);if(H.signedDistanceFromCamera>0)return d.projections[y]=H.point,H.point;const ne=y-L;return un(E===0?x:new l.Point(p.getx(ne),p.gety(ne)),F,P,D-E+1,g,T)}function Kr(y,o,d){return y._unit()._perp()._mult(o*d)}function ie(y,o,d,p,g,x,E,T){const{projectionCache:P,direction:L}=T;if(P.offsets[y])return P.offsets[y];const D=d.add(o);if(y+L<p||y+L>=g)return P.offsets[y]=D,D;const F=co(y+L,T),H=Kr(F.sub(d),E,L),ne=d.add(H),ee=F.add(H);return P.offsets[y]=l.findLineIntersection(x,D,ne,ee)||D,P.offsets[y]}function N(y,o,d,p,g,x,E,T,P,L,D,F,H,ne){const ee=p?y-o:y+o;let re=ee>0?1:-1,Q=0;p&&(re*=-1,Q=Math.PI),re<0&&(Q+=Math.PI);let ge,Ae,le=re>0?T+E:T+E+1,ye=g,Ce=g,Ie=0,Oe=0;const Ge=Math.abs(ee),Ne=[];let He;for(;Ie+Oe<=Ge;){if(le+=re,le<T||le>=P)return null;Ie+=Oe,Ce=ye,Ae=ge;const Ke={projectionCache:F,lineVertexArray:L,labelPlaneMatrix:D,tileAnchorPoint:x,distanceFromAnchor:Ie,getElevation:ne,previousVertex:Ce,direction:re,absOffsetX:Ge};if(ye=co(le,Ke),d===0)Ne.push(Ce),He=ye.sub(Ce);else{let yt;const ct=ye.sub(Ce);yt=ct.mag()===0?Kr(co(le+re,Ke).sub(ye),d,re):Kr(ct,d,re),Ae||(Ae=Ce.add(yt)),ge=ie(le,yt,ye,T,P,Ae,d,Ke),Ne.push(Ae),He=ge.sub(Ae)}Oe=He.mag()}const ht=He._mult((Ge-Ie)/Oe)._add(Ae||Ce),kt=Q+Math.atan2(ye.y-Ce.y,ye.x-Ce.x);return Ne.push(ht),{point:ht,angle:H?kt:0,path:Ne}}const G=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function K(y,o){for(let d=0;d<y;d++){const p=o.length;o.resize(p+4),o.float32.set(G,3*p)}}function oe(y,o,d){const p=o[0],g=o[1];return y[0]=d[0]*p+d[4]*g+d[12],y[1]=d[1]*p+d[5]*g+d[13],y[3]=d[3]*p+d[7]*g+d[15],y}const he=100;class _e{constructor(o,d=new Mt(o.width+200,o.height+200,25),p=new Mt(o.width+200,o.height+200,25)){this.transform=o,this.grid=d,this.ignoredGrid=p,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+he,this.screenBottomBoundary=o.height+he,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,d,p,g,x,E){const T=this.projectAndGetPerspectiveRatio(g,o.anchorPointX,o.anchorPointY,E),P=p*T.perspectiveRatio,L=o.x1*P+T.point.x,D=o.y1*P+T.point.y,F=o.x2*P+T.point.x,H=o.y2*P+T.point.y;return!this.isInsideGrid(L,D,F,H)||d!=="always"&&this.grid.hitTest(L,D,F,H,d,x)||T.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[L,D,F,H],offscreen:this.isOffscreen(L,D,F,H)}}placeCollisionCircles(o,d,p,g,x,E,T,P,L,D,F,H,ne,ee){const re=[],Q=new l.Point(d.anchorX,d.anchorY),ge=Et(Q,E,ee),Ae=Zr(this.transform.cameraToCenterDistance,ge.signedDistanceFromCamera),le=(D?x/Ae:x*Ae)/l.ONE_EM,ye=Et(Q,T,ee).point,Ce=hr(le,g,d.lineOffsetX*le,d.lineOffsetY*le,!1,ye,Q,d,p,T,{projections:{},offsets:{}},!1,ee);let Ie=!1,Oe=!1,Ge=!0;if(Ce){const Ne=.5*H*Ae+ne,He=new l.Point(-100,-100),ht=new l.Point(this.screenRightBoundary,this.screenBottomBoundary),kt=new $e,Ke=Ce.first,yt=Ce.last;let ct=[];for(let xt=Ke.path.length-1;xt>=1;xt--)ct.push(Ke.path[xt]);for(let xt=1;xt<yt.path.length;xt++)ct.push(yt.path[xt]);const Pn=2.5*Ne;if(P){const xt=ct.map(Nt=>Et(Nt,P,ee));ct=xt.some(Nt=>Nt.signedDistanceFromCamera<=0)?[]:xt.map(Nt=>Nt.point)}let zt=[];if(ct.length>0){const xt=ct[0].clone(),Nt=ct[0].clone();for(let Rn=1;Rn<ct.length;Rn++)xt.x=Math.min(xt.x,ct[Rn].x),xt.y=Math.min(xt.y,ct[Rn].y),Nt.x=Math.max(Nt.x,ct[Rn].x),Nt.y=Math.max(Nt.y,ct[Rn].y);zt=xt.x>=He.x&&Nt.x<=ht.x&&xt.y>=He.y&&Nt.y<=ht.y?[ct]:Nt.x<He.x||xt.x>ht.x||Nt.y<He.y||xt.y>ht.y?[]:l.clipLine([ct],He.x,He.y,ht.x,ht.y)}for(const xt of zt){kt.reset(xt,.25*Ne);let Nt=0;Nt=kt.length<=.5*Ne?1:Math.ceil(kt.paddedLength/Pn)+1;for(let Rn=0;Rn<Nt;Rn++){const hn=Rn/Math.max(Nt-1,1),Or=kt.lerp(hn),Oi=Or.x+he,Xn=Or.y+he;re.push(Oi,Xn,Ne,0);const mr=Oi-Ne,Hs=Xn-Ne,gs=Oi+Ne,Ws=Xn+Ne;if(Ge=Ge&&this.isOffscreen(mr,Hs,gs,Ws),Oe=Oe||this.isInsideGrid(mr,Hs,gs,Ws),o!=="always"&&this.grid.hitTestCircle(Oi,Xn,Ne,o,F)&&(Ie=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Ie}}}}return{circles:!L&&Ie||!Oe||Ae<this.perspectiveRatioCutoff?[]:re,offscreen:Ge,collisionDetected:Ie}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let p=1/0,g=1/0,x=-1/0,E=-1/0;for(const D of o){const F=new l.Point(D.x+he,D.y+he);p=Math.min(p,F.x),g=Math.min(g,F.y),x=Math.max(x,F.x),E=Math.max(E,F.y),d.push(F)}const T=this.grid.query(p,g,x,E).concat(this.ignoredGrid.query(p,g,x,E)),P={},L={};for(const D of T){const F=D.key;if(P[F.bucketInstanceId]===void 0&&(P[F.bucketInstanceId]={}),P[F.bucketInstanceId][F.featureIndex])continue;const H=[new l.Point(D.x1,D.y1),new l.Point(D.x2,D.y1),new l.Point(D.x2,D.y2),new l.Point(D.x1,D.y2)];l.polygonIntersectsPolygon(d,H)&&(P[F.bucketInstanceId][F.featureIndex]=!0,L[F.bucketInstanceId]===void 0&&(L[F.bucketInstanceId]=[]),L[F.bucketInstanceId].push(F.featureIndex))}return L}insertCollisionBox(o,d,p,g,x,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:E,overlapMode:d},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,p,g,x,E){const T=p?this.ignoredGrid:this.grid,P={bucketInstanceId:g,featureIndex:x,collisionGroupID:E,overlapMode:d};for(let L=0;L<o.length;L+=4)T.insertCircle(P,o[L],o[L+1],o[L+2])}projectAndGetPerspectiveRatio(o,d,p,g){let x;return g?(x=[d,p,g(d,p),1],l.transformMat4(x,x,o)):(x=[d,p,0,1],oe(x,x,o)),{point:new l.Point((x[0]/x[3]+1)/2*this.transform.width+he,(-x[1]/x[3]+1)/2*this.transform.height+he),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}}isOffscreen(o,d,p,g){return p<he||o>=this.screenRightBoundary||g<he||d>this.screenBottomBoundary}isInsideGrid(o,d,p,g){return p>=0&&o<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=l.identity([]);return l.translate(o,o,[-100,-100,0]),o}}function fe(y,o,d){return o*(l.EXTENT/(y.tileSize*Math.pow(2,d-y.tileID.overscaledZ)))}class de{constructor(o,d,p,g){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):g&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class ve{constructor(o,d,p,g,x){this.text=new de(o?o.text:null,d,p,x),this.icon=new de(o?o.icon:null,d,g,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Re{constructor(o,d,p){this.text=o,this.icon=d,this.skipFade=p}}class De{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class ze{constructor(o,d,p,g,x){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=x}}class vt{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:p=>p.collisionGroupID===d}}return this.collisionGroups[o]}}function Ct(y,o,d,p,g){const{horizontalAlign:x,verticalAlign:E}=l.getAnchorAlignment(y);return new l.Point(-(x-.5)*o+p[0]*g,-(E-.5)*d+p[1]*g)}function lt(y,o,d,p,g,x){const{x1:E,x2:T,y1:P,y2:L,anchorPointX:D,anchorPointY:F}=y,H=new l.Point(o,d);return p&&H._rotate(g?x:-x),{x1:E+H.x,y1:P+H.y,x2:T+H.x,y2:L+H.y,anchorPointX:D,anchorPointY:F}}class pt{constructor(o,d,p,g,x){this.transform=o.clone(),this.terrain=d,this.collisionIndex=new _e(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new vt(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,d,p,g){const x=p.getBucket(d),E=p.latestFeatureIndex;if(!x||!E||d.id!==x.layerIds[0])return;const T=p.collisionBoxArray,P=x.layers[0].layout,L=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),D=p.tileSize/l.EXTENT,F=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),H=P.get("text-pitch-alignment")==="map",ne=P.get("text-rotation-alignment")==="map",ee=fe(p,1,this.transform.zoom),re=Ti(F,H,ne,this.transform,ee);let Q=null;if(H){const Ae=fs(F,H,ne,this.transform,ee);Q=l.multiply([],this.transform.labelPlaneMatrix,Ae)}this.retainedQueryData[x.bucketInstanceId]=new ze(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,p.tileID);const ge={bucket:x,layout:P,posMatrix:F,textLabelPlaneMatrix:re,labelToScreenMatrix:Q,scale:L,textPixelRatio:D,holdingForFade:p.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(g)for(const Ae of x.sortKeyRanges){const{sortKey:le,symbolInstanceStart:ye,symbolInstanceEnd:Ce}=Ae;o.push({sortKey:le,symbolInstanceStart:ye,symbolInstanceEnd:Ce,parameters:ge})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(o,d,p,g,x,E,T,P,L,D,F,H,ne,ee,re,Q){const ge=l.TextAnchorEnum[o.textAnchor],Ae=[o.textOffset0,o.textOffset1],le=Ct(ge,p,g,Ae,x),ye=this.collisionIndex.placeCollisionBox(lt(d,le.x,le.y,E,T,this.transform.angle),F,P,L,D.predicate,Q);if((!re||this.collisionIndex.placeCollisionBox(lt(re,le.x,le.y,E,T,this.transform.angle),F,P,L,D.predicate,Q).box.length!==0)&&ye.box.length>0){let Ce;if(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(Ce=this.prevPlacement.variableOffsets[H.crossTileID].anchor),H.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[H.crossTileID]={textOffset:Ae,width:p,height:g,anchor:ge,textBoxScale:x,prevAnchor:Ce},this.markUsedJustification(ne,ge,H,ee),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,ee,H),this.placedOrientations[H.crossTileID]=ee),{shift:le,placedGlyphBoxes:ye}}}placeLayerBucketPart(o,d,p){const{bucket:g,layout:x,posMatrix:E,textLabelPlaneMatrix:T,labelToScreenMatrix:P,textPixelRatio:L,holdingForFade:D,collisionBoxArray:F,partiallyEvaluatedTextSize:H,collisionGroup:ne}=o.parameters,ee=x.get("text-optional"),re=x.get("icon-optional"),Q=l.getOverlapMode(x,"text-overlap","text-allow-overlap"),ge=Q==="always",Ae=l.getOverlapMode(x,"icon-overlap","icon-allow-overlap"),le=Ae==="always",ye=x.get("text-rotation-alignment")==="map",Ce=x.get("text-pitch-alignment")==="map",Ie=x.get("icon-text-fit")!=="none",Oe=x.get("symbol-z-order")==="viewport-y",Ge=ge&&(le||!g.hasIconData()||re),Ne=le&&(ge||!g.hasTextData()||ee);!g.collisionArrays&&F&&g.deserializeCollisionBoxes(F);const He=this.retainedQueryData[g.bucketInstanceId].tileID,ht=this.terrain?(Ke,yt)=>this.terrain.getElevation(He,Ke,yt):null,kt=(Ke,yt)=>{var ct,Pn;if(d[Ke.crossTileID])return;if(D)return void(this.placements[Ke.crossTileID]=new Re(!1,!1,!1));let zt=!1,xt=!1,Nt=!0,Rn=null,hn={box:null,offscreen:null},Or={box:null,offscreen:null},Oi=null,Xn=null,mr=null,Hs=0,gs=0,Ws=0;yt.textFeatureIndex?Hs=yt.textFeatureIndex:Ke.useRuntimeCollisionCircles&&(Hs=Ke.featureIndex),yt.verticalTextFeatureIndex&&(gs=yt.verticalTextFeatureIndex);const ll=yt.textBox;if(ll){const ti=xi=>{let ui=l.WritingMode.horizontal;if(g.allowVerticalPlacement&&!xi&&this.prevPlacement){const Wi=this.prevPlacement.placedOrientations[Ke.crossTileID];Wi&&(this.placedOrientations[Ke.crossTileID]=Wi,ui=Wi,this.markUsedOrientation(g,ui,Ke))}return ui},vi=(xi,ui)=>{if(g.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&yt.verticalTextBox){for(const Wi of g.writingModes)if(Wi===l.WritingMode.vertical?(hn=ui(),Or=hn):hn=xi(),hn&&hn.box&&hn.box.length)break}else hn=xi()},Hi=Ke.textAnchorOffsetStartIndex,cl=Ke.textAnchorOffsetEndIndex;if(cl===Hi){const xi=(ui,Wi)=>{const Dn=this.collisionIndex.placeCollisionBox(ui,Q,L,E,ne.predicate,ht);return Dn&&Dn.box&&Dn.box.length&&(this.markUsedOrientation(g,Wi,Ke),this.placedOrientations[Ke.crossTileID]=Wi),Dn};vi(()=>xi(ll,l.WritingMode.horizontal),()=>{const ui=yt.verticalTextBox;return g.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&ui?xi(ui,l.WritingMode.vertical):{box:null,offscreen:null}}),ti(hn&&hn.box&&hn.box.length)}else{let xi=l.TextAnchorEnum[(Pn=(ct=this.prevPlacement)===null||ct===void 0?void 0:ct.variableOffsets[Ke.crossTileID])===null||Pn===void 0?void 0:Pn.anchor];const ui=(Dn,_o,_s)=>{const qo=Dn.x2-Dn.x1,$p=Dn.y2-Dn.y1,wa=Ke.textBoxScale,fy=Ie&&Ae==="never"?_o:null;let Aa={box:[],offscreen:!1},Nn=Q==="never"?1:2,Bu="never";xi&&Nn++;for(let Pd=0;Pd<Nn;Pd++){for(let yo=Hi;yo<cl;yo++){const Xo=g.textAnchorOffsets.get(yo);if(xi&&Xo.textAnchor!==xi)continue;const ul=this.attemptAnchorPlacement(Xo,Dn,qo,$p,wa,ye,Ce,L,E,ne,Bu,Ke,g,_s,fy,ht);if(ul&&(Aa=ul.placedGlyphBoxes,Aa&&Aa.box&&Aa.box.length))return zt=!0,Rn=ul.shift,Aa}xi?xi=null:Bu=Q}return Aa};vi(()=>ui(ll,yt.iconBox,l.WritingMode.horizontal),()=>{const Dn=yt.verticalTextBox;return g.allowVerticalPlacement&&!(hn&&hn.box&&hn.box.length)&&Ke.numVerticalGlyphVertices>0&&Dn?ui(Dn,yt.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),hn&&(zt=hn.box,Nt=hn.offscreen);const Wi=ti(hn&&hn.box);if(!zt&&this.prevPlacement){const Dn=this.prevPlacement.variableOffsets[Ke.crossTileID];Dn&&(this.variableOffsets[Ke.crossTileID]=Dn,this.markUsedJustification(g,Dn.anchor,Ke,Wi))}}}if(Oi=hn,zt=Oi&&Oi.box&&Oi.box.length>0,Nt=Oi&&Oi.offscreen,Ke.useRuntimeCollisionCircles){const ti=g.text.placedSymbolArray.get(Ke.centerJustifiedTextSymbolIndex),vi=l.evaluateSizeForFeature(g.textSizeData,H,ti),Hi=x.get("text-padding");Xn=this.collisionIndex.placeCollisionCircles(Q,ti,g.lineVertexArray,g.glyphOffsetArray,vi,E,T,P,p,Ce,ne.predicate,Ke.collisionCircleDiameter,Hi,ht),Xn.circles.length&&Xn.collisionDetected&&!p&&l.warnOnce("Collisions detected, but collision boxes are not shown"),zt=ge||Xn.circles.length>0&&!Xn.collisionDetected,Nt=Nt&&Xn.offscreen}if(yt.iconFeatureIndex&&(Ws=yt.iconFeatureIndex),yt.iconBox){const ti=vi=>{const Hi=Ie&&Rn?lt(vi,Rn.x,Rn.y,ye,Ce,this.transform.angle):vi;return this.collisionIndex.placeCollisionBox(Hi,Ae,L,E,ne.predicate,ht)};Or&&Or.box&&Or.box.length&&yt.verticalIconBox?(mr=ti(yt.verticalIconBox),xt=mr.box.length>0):(mr=ti(yt.iconBox),xt=mr.box.length>0),Nt=Nt&&mr.offscreen}const Wo=ee||Ke.numHorizontalGlyphVertices===0&&Ke.numVerticalGlyphVertices===0,go=re||Ke.numIconVertices===0;if(Wo||go?go?Wo||(xt=xt&&zt):zt=xt&&zt:xt=zt=xt&&zt,zt&&Oi&&Oi.box&&this.collisionIndex.insertCollisionBox(Oi.box,Q,x.get("text-ignore-placement"),g.bucketInstanceId,Or&&Or.box&&gs?gs:Hs,ne.ID),xt&&mr&&this.collisionIndex.insertCollisionBox(mr.box,Ae,x.get("icon-ignore-placement"),g.bucketInstanceId,Ws,ne.ID),Xn&&(zt&&this.collisionIndex.insertCollisionCircles(Xn.circles,Q,x.get("text-ignore-placement"),g.bucketInstanceId,Hs,ne.ID),p)){const ti=g.bucketInstanceId;let vi=this.collisionCircleArrays[ti];vi===void 0&&(vi=this.collisionCircleArrays[ti]=new De);for(let Hi=0;Hi<Xn.circles.length;Hi+=4)vi.circles.push(Xn.circles[Hi+0]),vi.circles.push(Xn.circles[Hi+1]),vi.circles.push(Xn.circles[Hi+2]),vi.circles.push(Xn.collisionDetected?1:0)}if(Ke.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ke.crossTileID]=new Re(zt||Ge,xt||Ne,Nt||g.justReloaded),d[Ke.crossTileID]=!0};if(Oe){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ke=g.getSortedSymbolIndexes(this.transform.angle);for(let yt=Ke.length-1;yt>=0;--yt){const ct=Ke[yt];kt(g.symbolInstances.get(ct),g.collisionArrays[ct])}}else for(let Ke=o.symbolInstanceStart;Ke<o.symbolInstanceEnd;Ke++)kt(g.symbolInstances.get(Ke),g.collisionArrays[Ke]);if(p&&g.bucketInstanceId in this.collisionCircleArrays){const Ke=this.collisionCircleArrays[g.bucketInstanceId];l.invert(Ke.invProjMatrix,E),Ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(o,d,p,g){let x;x=g===l.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(d)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const T of E)T>=0&&(o.text.placedSymbolArray.get(T).crossTileID=x>=0&&T!==x?0:p.crossTileID)}markUsedOrientation(o,d,p){const g=d===l.WritingMode.horizontal||d===l.WritingMode.horizontalOnly?d:0,x=d===l.WritingMode.vertical?d:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const T of E)o.text.placedSymbolArray.get(T).placedOrientation=g;p.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let p=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const g=d?d.symbolFadeChange(o):1,x=d?d.opacities:{},E=d?d.variableOffsets:{},T=d?d.placedOrientations:{};for(const P in this.placements){const L=this.placements[P],D=x[P];D?(this.opacities[P]=new ve(D,g,L.text,L.icon),p=p||L.text!==D.text.placed||L.icon!==D.icon.placed):(this.opacities[P]=new ve(null,g,L.text,L.icon,L.skipFade),p=p||L.text||L.icon)}for(const P in x){const L=x[P];if(!this.opacities[P]){const D=new ve(L,g,!1,!1);D.isHidden()||(this.opacities[P]=D,p=p||L.text.placed||L.icon.placed)}}for(const P in E)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=E[P]);for(const P in T)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=T[P]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d){const p={};for(const g of d){const x=g.getBucket(o);x&&g.latestFeatureIndex&&o.id===x.layerIds[0]&&this.updateBucketOpacities(x,p,g.collisionBoxArray)}}updateBucketOpacities(o,d,p){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const g=o.layers[0],x=g.layout,E=new ve(null,0,!1,!1,!0),T=x.get("text-allow-overlap"),P=x.get("icon-allow-overlap"),L=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),D=x.get("text-rotation-alignment")==="map",F=x.get("text-pitch-alignment")==="map",H=x.get("icon-text-fit")!=="none",ne=new ve(null,0,T&&(P||!o.hasIconData()||x.get("icon-optional")),P&&(T||!o.hasTextData()||x.get("text-optional")),!0);!o.collisionArrays&&p&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(p);const ee=(re,Q,ge)=>{for(let Ae=0;Ae<Q/4;Ae++)re.opacityVertexArray.emplaceBack(ge);re.hasVisibleVertices=re.hasVisibleVertices||ge!==xn};for(let re=0;re<o.symbolInstances.length;re++){const Q=o.symbolInstances.get(re),{numHorizontalGlyphVertices:ge,numVerticalGlyphVertices:Ae,crossTileID:le}=Q;let ye=this.opacities[le];d[le]?ye=E:ye||(ye=ne,this.opacities[le]=ye),d[le]=!0;const Ce=Q.numIconVertices>0,Ie=this.placedOrientations[Q.crossTileID],Oe=Ie===l.WritingMode.vertical,Ge=Ie===l.WritingMode.horizontal||Ie===l.WritingMode.horizontalOnly;if(ge>0||Ae>0){const Ne=yi(ye.text);ee(o.text,ge,Oe?xn:Ne),ee(o.text,Ae,Ge?xn:Ne);const He=ye.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(Ke=>{Ke>=0&&(o.text.placedSymbolArray.get(Ke).hidden=He||Oe?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=He||Ge?1:0);const ht=this.variableOffsets[Q.crossTileID];ht&&this.markUsedJustification(o,ht.anchor,Q,Ie);const kt=this.placedOrientations[Q.crossTileID];kt&&(this.markUsedJustification(o,"left",Q,kt),this.markUsedOrientation(o,kt,Q))}if(Ce){const Ne=yi(ye.icon),He=!(H&&Q.verticalPlacedIconSymbolIndex&&Oe);Q.placedIconSymbolIndex>=0&&(ee(o.icon,Q.numIconVertices,He?Ne:xn),o.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=ye.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(ee(o.icon,Q.numVerticalIconVertices,He?xn:Ne),o.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=ye.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Ne=o.collisionArrays[re];if(Ne){let He=new l.Point(0,0);if(Ne.textBox||Ne.verticalTextBox){let kt=!0;if(L){const Ke=this.variableOffsets[le];Ke?(He=Ct(Ke.anchor,Ke.width,Ke.height,Ke.textOffset,Ke.textBoxScale),D&&He._rotate(F?this.transform.angle:-this.transform.angle)):kt=!1}Ne.textBox&&St(o.textCollisionBox.collisionVertexArray,ye.text.placed,!kt||Oe,He.x,He.y),Ne.verticalTextBox&&St(o.textCollisionBox.collisionVertexArray,ye.text.placed,!kt||Ge,He.x,He.y)}const ht=!!(!Ge&&Ne.verticalIconBox);Ne.iconBox&&St(o.iconCollisionBox.collisionVertexArray,ye.icon.placed,ht,H?He.x:0,H?He.y:0),Ne.verticalIconBox&&St(o.iconCollisionBox.collisionVertexArray,ye.icon.placed,!ht,H?He.x:0,H?He.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=re.invProjMatrix,o.placementViewportMatrix=re.viewportMatrix,o.collisionCircleArray=re.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const p=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function St(y,o,d,p,g){y.emplaceBack(o?1:0,d?1:0,p||0,g||0),y.emplaceBack(o?1:0,d?1:0,p||0,g||0),y.emplaceBack(o?1:0,d?1:0,p||0,g||0),y.emplaceBack(o?1:0,d?1:0,p||0,g||0)}const Ht=Math.pow(2,25),qt=Math.pow(2,24),Bt=Math.pow(2,17),Dt=Math.pow(2,16),_i=Math.pow(2,9),wt=Math.pow(2,8),jn=Math.pow(2,1);function yi(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const o=y.placed?1:0,d=Math.floor(127*y.opacity);return d*Ht+o*qt+d*Bt+o*Dt+d*_i+o*wt+d*jn+o}const xn=0;class bn{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,d,p,g,x){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(E,g,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((T,P)=>T.sortKey-P.sortKey));this._currentPartIndex<E.length;)if(d.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,x())return!0;return!1}}class Uo{constructor(o,d,p,g,x,E,T,P){this.placement=new pt(o,d,E,T,P),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(o,d,p){const g=l.browser.now(),x=()=>!this._forceFullPlacement&&l.browser.now()-g>2;for(;this._currentPlacementIndex>=0;){const E=d[o[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=T)&&(!E.maxzoom||E.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new bn(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Cn=512/l.EXTENT/2;class Hn{constructor(o,d,p){this.tileID=o,this.bucketInstanceId=p,this._symbolsByKey={};const g=new Map;for(let x=0;x<d.length;x++){const E=d.get(x),T=E.key,P=g.get(T);P?P.push(E):g.set(T,[E])}for(const[x,E]of g){const T={positions:E.map(P=>({x:Math.floor(P.anchorX*Cn),y:Math.floor(P.anchorY*Cn)})),crossTileIDs:E.map(P=>P.crossTileID)};if(T.positions.length>128){const P=new l.KDBush(T.positions.length,16,Uint16Array);for(const{x:L,y:D}of T.positions)P.add(L,D);P.finish(),delete T.positions,T.index=P}this._symbolsByKey[x]=T}}getScaledCoordinates(o,d){const{x:p,y:g,z:x}=this.tileID.canonical,{x:E,y:T,z:P}=d.canonical,L=Cn/Math.pow(2,P-x),D=(T*l.EXTENT+o.anchorY)*L,F=g*l.EXTENT*Cn;return{x:Math.floor((E*l.EXTENT+o.anchorX)*L-p*l.EXTENT*Cn),y:Math.floor(D-F)}}findMatches(o,d,p){const g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let x=0;x<o.length;x++){const E=o.get(x);if(E.crossTileID)continue;const T=this._symbolsByKey[E.key];if(!T)continue;const P=this.getScaledCoordinates(E,d);if(T.index){const L=T.index.range(P.x-g,P.y-g,P.x+g,P.y+g).sort();for(const D of L){const F=T.crossTileIDs[D];if(!p[F]){p[F]=!0,E.crossTileID=F;break}}}else if(T.positions)for(let L=0;L<T.positions.length;L++){const D=T.positions[L],F=T.crossTileIDs[L];if(Math.abs(D.x-P.x)<=g&&Math.abs(D.y-P.y)<=g&&!p[F]){p[F]=!0,E.crossTileID=F;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class Go{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class nr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(d!==0)for(const p in this.indexes){const g=this.indexes[p],x={};for(const E in g){const T=g[E];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+d),x[T.tileID.key]=T}this.indexes[p]=x}this.lng=o}addBucket(o,d,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let x=0;x<d.symbolInstances.length;x++)d.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const g=this.usedCrossTileIDs[o.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>o.overscaledZ)for(const T in E){const P=E[T];P.tileID.isChildOf(o)&&P.findMatches(d.symbolInstances,o,g)}else{const T=E[o.scaledTo(Number(x)).key];T&&T.findMatches(d.symbolInstances,o,g)}}for(let x=0;x<d.symbolInstances.length;x++){const E=d.symbolInstances.get(x);E.crossTileID||(E.crossTileID=p.generate(),g[E.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Hn(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const p of d.getCrossTileIDsLists())for(const g of p)delete this.usedCrossTileIDs[o][g]}removeStaleBuckets(o){let d=!1;for(const p in this.indexes){const g=this.indexes[p];for(const x in g)o[g[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[x]),delete g[x],d=!0)}return d}}class sn{constructor(){this.layerIndexes={},this.crossTileIDs=new Go,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,p){let g=this.layerIndexes[o.id];g===void 0&&(g=this.layerIndexes[o.id]=new nr);let x=!1;const E={};g.handleWrapJump(p);for(const T of d){const P=T.getBucket(o);P&&o.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(T.tileID,P,this.crossTileIDs)&&(x=!0),E[P.bucketInstanceId]=!0)}return g.removeStaleBuckets(E)&&(x=!0),x}pruneUnusedLayers(o){const d={};o.forEach(p=>{d[p]=!0});for(const p in this.layerIndexes)d[p]||delete this.layerIndexes[p]}}const ps=(y,o)=>l.emitValidationErrors(y,o&&o.filter(d=>d.identifier!=="source.canvas")),Us=l.pick(l.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),wn=l.pick(l.operations,["setCenter","setZoom","setBearing","setPitch"]),Vi=l.emptyStyle();class Yn extends l.Evented{constructor(o,d={}){super(),this.map=o,this.dispatcher=new $t(ds(),this,o._getMapId()),this.imageManager=new Lt,this.imageManager.setEventedParent(this),this.glyphManager=new ai(o._requestManager,d.localIdeographFontFamily),this.lineAtlas=new tn(256,512),this.crossTileSymbolIndex=new sn,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const p=this;this._rtlTextPluginCallback=Yn.registerForPluginStateChange(g=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(x,E)=>{if(l.triggerPluginCompletionEvent(x),E&&E.every(T=>T))for(const T in p.sourceCaches){const P=p.sourceCaches[T].getSource().type;P!=="vector"&&P!=="geojson"||p.sourceCaches[T].reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const x=this.sourceCaches[g.sourceId];if(!x)return;const E=x.getSource();if(E&&E.vectorLayerIds)for(const T in this._layers){const P=this._layers[T];P.source===E.id&&this._validateLayer(P)}})}loadURL(o,d={},p){this.fire(new l.Event("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const g=this.map._requestManager.transformRequest(o,j.Style);this._request=l.getJSON(g,(x,E)=>{this._request=null,x?this.fire(new l.ErrorEvent(x)):E&&this._load(E,d,p)})}loadJSON(o,d={},p){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.browser.frame(()=>{this._request=null,d.validate=d.validate!==!1,this._load(o,d,p)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(Vi,{validate:!1})}_load(o,d,p){var g;const x=d.transformStyle?d.transformStyle(p,o):o;if(!d.validate||!ps(this,l.validateStyle(x))){this._loaded=!0,this.stylesheet=x;for(const E in x.sources)this.addSource(E,x.sources[E],{validate:!1});x.sprite?this._loadSprite(x.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(x.glyphs),this._createLayers(),this.light=new Pt(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}}_createLayers(){const o=l.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",o),this._order=o.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of o){const p=l.createStyleLayer(d);p.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=p}}_loadSprite(o,d=!1,p=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(g,x,E,T){const P=ke(g),L=P.length,D=E>1?"@2x":"",F={},H={},ne={};for(const{id:ee,url:re}of P){const Q=x.transformRequest(x.normalizeSpriteURL(re,D,".json"),j.SpriteJSON),ge=`${ee}_${Q.url}`;F[ge]=l.getJSON(Q,(ye,Ce)=>{delete F[ge],H[ee]=Ce,Ue(T,H,ne,ye,L)});const Ae=x.transformRequest(x.normalizeSpriteURL(re,D,".png"),j.SpriteImage),le=`${ee}_${Ae.url}`;F[le]=ue.getImage(Ae,(ye,Ce)=>{delete F[le],ne[ee]=Ce,Ue(T,H,ne,ye,L)})}return{cancel(){for(const ee of Object.values(F))ee.cancel()}}}(o,this.map._requestManager,this.map.getPixelRatio(),(g,x)=>{if(this._spriteRequest=null,g)this.fire(new l.ErrorEvent(g));else if(x)for(const E in x){this._spritesImagesIds[E]=[];const T=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(P=>!(P in x)):[];for(const P of T)this.imageManager.removeImage(P),this._changedImages[P]=!0;for(const P in x[E]){const L=E==="default"?P:`${E}:${P}`;this._spritesImagesIds[E].push(L),L in this.imageManager.images?this.imageManager.updateImage(L,x[E][P],!1):this.imageManager.addImage(L,x[E][P]),d&&(this._changedImages[L]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"})),p&&p(g)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}_validateLayer(o){const d=this.sourceCaches[o.source];if(!d)return;const p=o.sourceLayer;if(!p)return;const g=d.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${g.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o){const d=this._serializedAllLayers();if(!o||o.length===0)return Object.values(d);const p=[];for(const g of o)d[g]&&p.push(d[g]);return p}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const d=Object.keys(this._layers);for(const p of d){const g=this._layers[p];g.type!=="custom"&&(o[p]=g.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const d=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(g.length||x.length)&&this._updateWorkerLayers(g,x);for(const E in this._updatedSources){const T=this._updatedSources[E];if(T==="reload")this._reloadSource(E);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const p={};for(const g in this.sourceCaches){const x=this.sourceCaches[g];p[g]=x.used,x.used=!1}for(const g of this._order){const x=this._layers[g];x.recalculate(o,this._availableImages),!x.isHidden(o.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const g in p){const x=this.sourceCaches[g];p[g]!==x.used&&x.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(o),this.z=o.zoom,d&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(o),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,d={}){this._checkLoaded();const p=this.serialize();if(o=d.transformStyle?d.transformStyle(p,o):o,ps(this,l.validateStyle(o)))return!1;(o=l.clone$1(o)).layers=l.derefLayers(o.layers);const g=l.diffStyles(p,o).filter(E=>!(E.command in wn));if(g.length===0)return!1;const x=g.filter(E=>!(E.command in Us));if(x.length>0)throw new Error(`Unimplemented: ${x.map(E=>E.command).join(", ")}.`);for(const E of g)E.command!=="setTransition"&&this[E.command].apply(this,E.args);return this.stylesheet=o,!0}addImage(o,d){if(this.getImage(o))return this.fire(new l.ErrorEvent(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,d),this._afterImageUpdated(o)}updateImage(o,d){this.imageManager.updateImage(o,d)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new l.ErrorEvent(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,d,p={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(l.validateStyle.source,`sources.${o}`,d,null,p))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const g=this.sourceCaches[o]=new Sn(o,d,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:o})),g.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===o)return this.fire(new l.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${p}" is using it.`)));const d=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],d.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,d){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const p=this.sourceCaches[o].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(d),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,d,p={}){this._checkLoaded();const g=o.id;if(this.getLayer(g))return void this.fire(new l.ErrorEvent(new Error(`Layer "${g}" already exists on this map.`)));let x;if(o.type==="custom"){if(ps(this,l.validateCustomStyleLayer(o)))return;x=l.createStyleLayer(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(g,o.source),o=l.clone$1(o),o=l.extend(o,{source:g})),this._validate(l.validateStyle.layer,`layers.${g}`,o,{arrayIndex:-1},p))return;x=l.createStyleLayer(o),this._validateLayer(x),x.setEventedParent(this,{layer:{id:g}})}const E=d?this._order.indexOf(d):this._order.length;if(d&&E===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${g}" before non-existing layer "${d}".`)));else{if(this._order.splice(E,0,g),this._layerOrderChanged=!0,this._layers[g]=x,this._removedLayers[g]&&x.source&&x.type!=="custom"){const T=this._removedLayers[g];delete this._removedLayers[g],T.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(o,d){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new l.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===d)return;const p=this._order.indexOf(o);this._order.splice(p,1);const g=d?this._order.indexOf(d):this._order.length;d&&g===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${o}" before non-existing layer "${d}".`))):(this._order.splice(g,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const d=this._layers[o];if(!d)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${o}".`)));d.setEventedParent(null);const p=this._order.indexOf(o);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=d,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],d.onRemove&&d.onRemove(this.map)}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,d,p){this._checkLoaded();const g=this.getLayer(o);g?g.minzoom===d&&g.maxzoom===p||(d!=null&&(g.minzoom=d),p!=null&&(g.maxzoom=p),this._updateLayer(g)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,d,p={}){this._checkLoaded();const g=this.getLayer(o);if(g){if(!l.deepEqual(g.filter,d))return d==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(l.validateStyle.filter,`layers.${g.id}.filter`,d,null,p)||(g.filter=l.clone$1(d),this._updateLayer(g)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return l.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,d,p,g={}){this._checkLoaded();const x=this.getLayer(o);x?l.deepEqual(x.getLayoutProperty(d),p)||(x.setLayoutProperty(d,p,g),this._updateLayer(x)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,d){const p=this.getLayer(o);if(p)return p.getLayoutProperty(d);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,d,p,g={}){this._checkLoaded();const x=this.getLayer(o);x?l.deepEqual(x.getPaintProperty(d),p)||(x.setPaintProperty(d,p,g)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,d){return this.getLayer(o).getPaintProperty(d)}setFeatureState(o,d){this._checkLoaded();const p=o.source,g=o.sourceLayer,x=this.sourceCaches[p];if(x===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const E=x.getSource().type;E==="geojson"&&g?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||g?(o.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),x.setFeatureState(g,o.id,d)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,d){this._checkLoaded();const p=o.source,g=this.sourceCaches[p];if(g===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const x=g.getSource().type,E=x==="vector"?o.sourceLayer:void 0;x!=="vector"||E?d&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(E,o.id,d):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const d=o.source,p=o.sourceLayer,g=this.sourceCaches[d];if(g!==void 0)return g.getSource().type!=="vector"||p?(o.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),g.getFeatureState(p,o.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=l.mapObject(this.sourceCaches,g=>g.serialize()),d=this._serializeByIds(this._order),p=this.stylesheet;return l.filterObject({version:p.version,name:p.name,metadata:p.metadata,light:p.light,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:o,layers:d},g=>g!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const d=E=>this._layers[E].type==="fill-extrusion",p={},g=[];for(let E=this._order.length-1;E>=0;E--){const T=this._order[E];if(d(T)){p[T]=E;for(const P of o){const L=P[T];if(L)for(const D of L)g.push(D)}}}g.sort((E,T)=>T.intersectionZ-E.intersectionZ);const x=[];for(let E=this._order.length-1;E>=0;E--){const T=this._order[E];if(d(T))for(let P=g.length-1;P>=0;P--){const L=g[P].feature;if(p[L.layer.id]<E)break;x.push(L),g.pop()}else for(const P of o){const L=P[T];if(L)for(const D of L)x.push(D.feature)}}return x}queryRenderedFeatures(o,d,p){d&&d.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);const g={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const T of d.layers){const P=this._layers[T];if(!P)return this.fire(new l.ErrorEvent(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];g[P.source]=!0}}const x=[];d.availableImages=this._availableImages;const E=this._serializedAllLayers();for(const T in this.sourceCaches)d.layers&&!g[T]||x.push(Gt(this.sourceCaches[T],this._layers,E,o,d,p));return this.placement&&x.push(function(T,P,L,D,F,H,ne){const ee={},re=H.queryRenderedSymbols(D),Q=[];for(const ge of Object.keys(re).map(Number))Q.push(ne[ge]);Q.sort(ks);for(const ge of Q){const Ae=ge.featureIndex.lookupSymbolFeatures(re[ge.bucketInstanceId],P,ge.bucketIndex,ge.sourceLayerIndex,F.filter,F.layers,F.availableImages,T);for(const le in Ae){const ye=ee[le]=ee[le]||[],Ce=Ae[le];Ce.sort((Ie,Oe)=>{const Ge=ge.featureSortOrder;if(Ge){const Ne=Ge.indexOf(Ie.featureIndex);return Ge.indexOf(Oe.featureIndex)-Ne}return Oe.featureIndex-Ie.featureIndex});for(const Ie of Ce)ye.push(Ie)}}for(const ge in ee)ee[ge].forEach(Ae=>{const le=Ae.feature,ye=L[T[ge].source].getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=ye});return ee}(this._layers,E,this.sourceCaches,o,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(o,d){d&&d.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);const p=this.sourceCaches[o];return p?function(g,x){const E=g.getRenderableIds().map(L=>g.getTileByID(L)),T=[],P={};for(let L=0;L<E.length;L++){const D=E[L],F=D.tileID.canonical.key;P[F]||(P[F]=!0,D.querySourceFeatures(T,x))}return T}(p,d):[]}addSourceType(o,d,p){return Xr(o)?p(new Error(`A source type called "${o}" already exists.`)):(((g,x)=>{tr[g]=x})(o,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:d.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(o,d={}){this._checkLoaded();const p=this.light.getLight();let g=!1;for(const E in o)if(!l.deepEqual(o[E],p[E])){g=!0;break}if(!g)return;const x={now:l.browser.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,d),this.light.updateTransitions(x)}_validate(o,d,p,g,x={}){return(!x||x.validate!==!1)&&ps(this,o.call(l.validateStyle,l.extend({key:d,style:this.serialize(),value:p,styleSpec:l.v8Spec},g)))}_remove(o=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const p=this.sourceCaches[d];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const d in this.sourceCaches)this.sourceCaches[d].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,d,p,g,x=!1){let E=!1,T=!1;const P={};for(const L of this._order){const D=this._layers[L];if(D.type!=="symbol")continue;if(!P[D.source]){const H=this.sourceCaches[D.source];P[D.source]=H.getRenderableIds(!0).map(ne=>H.getTileByID(ne)).sort((ne,ee)=>ee.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(ee.tileID)?-1:1))}const F=this.crossTileSymbolIndex.addLayer(D,P[D.source],o.center.lng);E=E||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.browser.now(),o.zoom))&&(this.pauseablePlacement=new Uo(o,this.map.terrain,this._order,x,d,p,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.browser.now()),T=!0),E&&this.pauseablePlacement.placement.setStale()),T||E)for(const L of this._order){const D=this._layers[L];D.type==="symbol"&&this.placement.updateLayerOpacities(D,P[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.browser.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,d,p){this.imageManager.getImages(d.icons,p),this._updateTilesForChangedImages();const g=this.sourceCaches[d.source];g&&g.setDependencies(d.tileID.key,d.type,d.icons)}getGlyphs(o,d,p){this.glyphManager.getGlyphs(d.stacks,p);const g=this.sourceCaches[d.source];g&&g.setDependencies(d.tileID.key,d.type,[""])}getResource(o,d,p){return l.makeRequest(d,p)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,d={}){this._checkLoaded(),o&&this._validate(l.validateStyle.glyphs,"glyphs",o,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,d,p={},g){this._checkLoaded();const x=[{id:o,url:d}],E=[...ke(this.stylesheet.sprite),...x];this._validate(l.validateStyle.sprite,"sprite",E,null,p)||(this.stylesheet.sprite=E,this._loadSprite(x,!0,g))}removeSprite(o){this._checkLoaded();const d=ke(this.stylesheet.sprite);if(d.find(p=>p.id===o)){if(this._spritesImagesIds[o])for(const p of this._spritesImagesIds[o])this.imageManager.removeImage(p),this._changedImages[p]=!0;d.splice(d.findIndex(p=>p.id===o),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}else this.fire(new l.ErrorEvent(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return ke(this.stylesheet.sprite)}setSprite(o,d={},p){this._checkLoaded(),o&&this._validate(l.validateStyle.sprite,"sprite",o,null,d)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,p):(this._unloadSprite(),p&&p(null)))}}Yn.registerForPluginStateChange=l.registerForPluginStateChange;var Vo=l.createLayout([{name:"a_pos",type:"Int16",components:2}]),dr="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const uo={prelude:Kt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Kt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Kt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Kt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Kt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Kt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Kt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Kt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Kt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Kt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Kt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Kt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Kt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Kt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Kt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Kt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Kt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Kt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Kt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Kt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Kt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",dr),terrainDepth:Kt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",dr),terrainCoords:Kt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",dr)};function Kt(y,o){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=o.match(/attribute ([\w]+) ([\w]+)/g),g=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=x?x.concat(g):g,T={};return{fragmentSource:y=y.replace(d,(P,L,D,F,H)=>(T[H]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${H}
varying ${D} ${F} ${H};
#else
uniform ${D} ${F} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${D} ${F} ${H} = u_${H};
#endif
`)),vertexSource:o=o.replace(d,(P,L,D,F,H)=>{const ne=F==="float"?"vec2":"vec4",ee=H.match(/color/)?"color":ne;return T[H]?L==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${D} ${ne} a_${H};
varying ${D} ${F} ${H};
#else
uniform ${D} ${F} u_${H};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${D} ${F} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${ee}(a_${H}, u_${H}_t);
#else
    ${D} ${F} ${H} = u_${H};
#endif
`:L==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${D} ${ne} a_${H};
#else
uniform ${D} ${F} u_${H};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${D} ${F} ${H} = a_${H};
#else
    ${D} ${F} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${D} ${F} ${H} = unpack_mix_${ee}(a_${H}, u_${H}_t);
#else
    ${D} ${F} ${H} = u_${H};
#endif
`}),staticAttributes:p,staticUniforms:E}}class ho{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,d,p,g,x,E,T,P,L){this.context=o;let D=this.boundPaintVertexBuffers.length!==g.length;for(let F=0;!D&&F<g.length;F++)this.boundPaintVertexBuffers[F]!==g[F]&&(D=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==p||D||this.boundIndexBuffer!==x||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==P||this.boundDynamicVertexBuffer3!==L?this.freshBind(d,p,g,x,E,T,P,L):(o.bindVertexArray.set(this.vao),T&&T.bind(),x&&x.dynamicDraw&&x.bind(),P&&P.bind(),L&&L.bind())}freshBind(o,d,p,g,x,E,T,P){const L=o.numAttributes,D=this.context,F=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=P,d.enableAttributes(F,o);for(const H of p)H.enableAttributes(F,o);E&&E.enableAttributes(F,o),T&&T.enableAttributes(F,o),P&&P.enableAttributes(F,o),d.bind(),d.setVertexAttribPointers(F,o,x);for(const H of p)H.bind(),H.setVertexAttribPointers(F,o,x);E&&(E.bind(),E.setVertexAttribPointers(F,o,x)),g&&g.bind(),T&&(T.bind(),T.setVertexAttribPointers(F,o,x)),P&&(P.bind(),P.setVertexAttribPointers(F,o,x)),D.currentNumAttributes=L}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ji(y){const o=[];for(let d=0;d<y.length;d++){if(y[d]===null)continue;const p=y[d].split(" ");o.push(p.pop())}return o}class Gs{constructor(o,d,p,g,x,E){const T=o.gl;this.program=T.createProgram();const P=ji(d.staticAttributes),L=p?p.getBinderAttributes():[],D=P.concat(L),F=uo.prelude.staticUniforms?ji(uo.prelude.staticUniforms):[],H=d.staticUniforms?ji(d.staticUniforms):[],ne=p?p.getBinderUniforms():[],ee=F.concat(H).concat(ne),re=[];for(const Ie of ee)re.indexOf(Ie)<0&&re.push(Ie);const Q=p?p.defines():[];x&&Q.push("#define OVERDRAW_INSPECTOR;"),E&&Q.push("#define TERRAIN3D;");const ge=Q.concat(uo.prelude.fragmentSource,d.fragmentSource).join(`
`),Ae=Q.concat(uo.prelude.vertexSource,d.vertexSource).join(`
`),le=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(le,ge),T.compileShader(le),!T.getShaderParameter(le,T.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${T.getShaderInfoLog(le)}`);T.attachShader(this.program,le);const ye=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(ye,Ae),T.compileShader(ye),!T.getShaderParameter(ye,T.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${T.getShaderInfoLog(ye)}`);T.attachShader(this.program,ye),this.attributes={};const Ce={};this.numAttributes=D.length;for(let Ie=0;Ie<this.numAttributes;Ie++)D[Ie]&&(T.bindAttribLocation(this.program,Ie,D[Ie]),this.attributes[D[Ie]]=Ie);if(T.linkProgram(this.program),!T.getProgramParameter(this.program,T.LINK_STATUS))throw new Error(`Program failed to link: ${T.getProgramInfoLog(this.program)}`);T.deleteShader(ye),T.deleteShader(le);for(let Ie=0;Ie<re.length;Ie++){const Oe=re[Ie];if(Oe&&!Ce[Oe]){const Ge=T.getUniformLocation(this.program,Oe);Ge&&(Ce[Oe]=Ge)}}this.fixedUniforms=g(o,Ce),this.terrainUniforms=((Ie,Oe)=>({u_depth:new l.Uniform1i(Ie,Oe.u_depth),u_terrain:new l.Uniform1i(Ie,Oe.u_terrain),u_terrain_dim:new l.Uniform1f(Ie,Oe.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(Ie,Oe.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(Ie,Oe.u_terrain_unpack),u_terrain_exaggeration:new l.Uniform1f(Ie,Oe.u_terrain_exaggeration)}))(o,Ce),this.binderUniforms=p?p.getUniforms(o,Ce):[]}draw(o,d,p,g,x,E,T,P,L,D,F,H,ne,ee,re,Q,ge,Ae){const le=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(p),o.setStencilMode(g),o.setColorMode(x),o.setCullFace(E),P){o.activeTexture.set(le.TEXTURE2),le.bindTexture(le.TEXTURE_2D,P.depthTexture),o.activeTexture.set(le.TEXTURE3),le.bindTexture(le.TEXTURE_2D,P.texture);for(const Ce in this.terrainUniforms)this.terrainUniforms[Ce].set(P[Ce])}for(const Ce in this.fixedUniforms)this.fixedUniforms[Ce].set(T[Ce]);re&&re.setUniforms(o,this.binderUniforms,ne,{zoom:ee});let ye=0;switch(d){case le.LINES:ye=2;break;case le.TRIANGLES:ye=3;break;case le.LINE_STRIP:ye=1}for(const Ce of H.get()){const Ie=Ce.vaos||(Ce.vaos={});(Ie[L]||(Ie[L]=new ho)).bind(o,this,D,re?re.getPaintVertexBuffers():[],F,Ce.vertexOffset,Q,ge,Ae),le.drawElements(d,Ce.primitiveLength*ye,le.UNSIGNED_SHORT,Ce.primitiveOffset*ye*2)}}}function da(y,o,d){const p=1/fe(d,1,o.transform.tileZoom),g=Math.pow(2,d.tileID.overscaledZ),x=d.tileSize*Math.pow(2,o.transform.tileZoom)/g,E=x*(d.tileID.canonical.x+d.tileID.wrap*g),T=x*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[p,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[E>>16,T>>16],u_pixel_coord_lower:[65535&E,65535&T]}}const fo=(y,o,d,p)=>{const g=o.style.light,x=g.properties.get("position"),E=[x.x,x.y,x.z],T=function(){var L=new l.ARRAY_TYPE(9);return l.ARRAY_TYPE!=Float32Array&&(L[1]=0,L[2]=0,L[3]=0,L[5]=0,L[6]=0,L[7]=0),L[0]=1,L[4]=1,L[8]=1,L}();g.properties.get("anchor")==="viewport"&&function(L,D){var F=Math.sin(D),H=Math.cos(D);L[0]=H,L[1]=F,L[2]=0,L[3]=-F,L[4]=H,L[5]=0,L[6]=0,L[7]=0,L[8]=1}(T,-o.transform.angle),function(L,D,F){var H=D[0],ne=D[1],ee=D[2];L[0]=H*F[0]+ne*F[3]+ee*F[6],L[1]=H*F[1]+ne*F[4]+ee*F[7],L[2]=H*F[2]+ne*F[5]+ee*F[8]}(E,E,T);const P=g.properties.get("color");return{u_matrix:y,u_lightpos:E,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+d,u_opacity:p}},iu=(y,o,d,p,g,x,E)=>l.extend(fo(y,o,d,p),da(x,o,E),{u_height_factor:-Math.pow(2,g.overscaledZ)/E.tileSize/8}),ru=y=>({u_matrix:y}),Ya=(y,o,d,p)=>l.extend(ru(y),da(d,o,p)),$=(y,o)=>({u_matrix:y,u_world:o}),Y=(y,o,d,p,g)=>l.extend(Ya(y,o,d,p),{u_world:g}),pe=(y,o,d,p)=>{const g=y.transform;let x,E;if(p.paint.get("circle-pitch-alignment")==="map"){const T=fe(d,1,g.zoom);x=!0,E=[T,T]}else x=!1,E=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(o.posMatrix,d,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:E}},Pe=(y,o,d)=>{const p=fe(d,1,o.zoom),g=Math.pow(2,o.zoom-d.tileID.overscaledZ),x=d.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[o.pixelsToGLUnits[0]/(p*g),o.pixelsToGLUnits[1]/(p*g)],u_overscale_factor:x}},je=(y,o,d=1)=>({u_matrix:y,u_color:o,u_overlay:0,u_overlay_scale:d}),ot=y=>({u_matrix:y}),Vt=(y,o,d,p)=>({u_matrix:y,u_extrude_scale:fe(o,1,d),u_intensity:p});function Qn(y,o){const d=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new l.MercatorCoordinate(0,p/d).toLngLat().lat,new l.MercatorCoordinate(0,(p+1)/d).toLngLat().lat]}const Wn=(y,o,d,p)=>{const g=y.transform;return{u_matrix:Jl(y,o,d,p),u_ratio:1/fe(o,1,g.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Si=(y,o,d,p,g)=>l.extend(Wn(y,o,d,g),{u_image:0,u_image_height:p}),Ci=(y,o,d,p,g)=>{const x=y.transform,E=Br(o,x);return{u_matrix:Jl(y,o,d,g),u_texsize:o.imageAtlasTexture.size,u_ratio:1/fe(o,1,x.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},su=(y,o,d,p,g,x)=>{const E=y.lineAtlas,T=Br(o,y.transform),P=d.layout.get("line-cap")==="round",L=E.getDash(p.from,P),D=E.getDash(p.to,P),F=L.width*g.fromScale,H=D.width*g.toScale;return l.extend(Wn(y,o,d,x),{u_patternscale_a:[T/F,-L.height/2],u_patternscale_b:[T/H,-D.height/2],u_sdfgamma:E.width/(256*Math.min(F,H)*y.pixelRatio)/2,u_image:0,u_tex_y_a:L.y,u_tex_y_b:D.y,u_mix:g.t})};function Br(y,o){return 1/fe(y,1,o.tileZoom)}function Jl(y,o,d,p){return y.translatePosMatrix(p?p.posMatrix:o.tileID.posMatrix,o,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const ou=(y,o,d,p,g)=>{return{u_matrix:y,u_tl_parent:o,u_scale_parent:d,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(E=g.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(x=g.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Kl(g.paint.get("raster-hue-rotate"))};var x,E};function Kl(y){y*=Math.PI/180;const o=Math.sin(y),d=Math.cos(y);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const Yl=(y,o,d,p,g,x,E,T,P,L)=>{const D=g.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:D.cameraToCenterDistance,u_pitch:D.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:D.width/D.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:T,u_is_text:+P,u_pitch_with_map:+p,u_texsize:L,u_texture:0}},Ql=(y,o,d,p,g,x,E,T,P,L,D)=>{const F=g.transform;return l.extend(Yl(y,o,d,p,g,x,E,T,P,L),{u_gamma_scale:p?Math.cos(F._pitch)*F.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+D})},ec=(y,o,d,p,g,x,E,T,P,L)=>l.extend(Ql(y,o,d,p,g,x,E,T,!0,P,!0),{u_texsize_icon:L,u_texture_icon:1}),fa=(y,o,d)=>({u_matrix:y,u_opacity:o,u_color:d}),au=(y,o,d,p,g,x)=>l.extend(function(E,T,P,L){const D=P.imageManager.getPattern(E.from.toString()),F=P.imageManager.getPattern(E.to.toString()),{width:H,height:ne}=P.imageManager.getPixelSize(),ee=Math.pow(2,L.tileID.overscaledZ),re=L.tileSize*Math.pow(2,P.transform.tileZoom)/ee,Q=re*(L.tileID.canonical.x+L.tileID.wrap*ee),ge=re*L.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:F.tl,u_pattern_br_b:F.br,u_texsize:[H,ne],u_mix:T.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:F.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/fe(L,1,P.transform.tileZoom),u_pixel_coord_upper:[Q>>16,ge>>16],u_pixel_coord_lower:[65535&Q,65535&ge]}}(p,x,d,g),{u_matrix:y,u_opacity:o}),Lr={fillExtrusion:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_lightpos:new l.Uniform3f(y,o.u_lightpos),u_lightintensity:new l.Uniform1f(y,o.u_lightintensity),u_lightcolor:new l.Uniform3f(y,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(y,o.u_vertical_gradient),u_opacity:new l.Uniform1f(y,o.u_opacity)}),fillExtrusionPattern:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_lightpos:new l.Uniform3f(y,o.u_lightpos),u_lightintensity:new l.Uniform1f(y,o.u_lightintensity),u_lightcolor:new l.Uniform3f(y,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(y,o.u_vertical_gradient),u_height_factor:new l.Uniform1f(y,o.u_height_factor),u_image:new l.Uniform1i(y,o.u_image),u_texsize:new l.Uniform2f(y,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(y,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(y,o.u_scale),u_fade:new l.Uniform1f(y,o.u_fade),u_opacity:new l.Uniform1f(y,o.u_opacity)}),fill:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix)}),fillPattern:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_image:new l.Uniform1i(y,o.u_image),u_texsize:new l.Uniform2f(y,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(y,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(y,o.u_scale),u_fade:new l.Uniform1f(y,o.u_fade)}),fillOutline:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_world:new l.Uniform2f(y,o.u_world)}),fillOutlinePattern:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_world:new l.Uniform2f(y,o.u_world),u_image:new l.Uniform1i(y,o.u_image),u_texsize:new l.Uniform2f(y,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(y,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(y,o.u_scale),u_fade:new l.Uniform1f(y,o.u_fade)}),circle:(y,o)=>({u_camera_to_center_distance:new l.Uniform1f(y,o.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(y,o.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(y,o.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(y,o.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(y,o.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(y,o.u_matrix)}),collisionBox:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_camera_to_center_distance:new l.Uniform1f(y,o.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(y,o.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(y,o.u_extrude_scale),u_overscale_factor:new l.Uniform1f(y,o.u_overscale_factor)}),collisionCircle:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_inv_matrix:new l.UniformMatrix4f(y,o.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(y,o.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(y,o.u_viewport_size)}),debug:(y,o)=>({u_color:new l.UniformColor(y,o.u_color),u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_overlay:new l.Uniform1i(y,o.u_overlay),u_overlay_scale:new l.Uniform1f(y,o.u_overlay_scale)}),clippingMask:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix)}),heatmap:(y,o)=>({u_extrude_scale:new l.Uniform1f(y,o.u_extrude_scale),u_intensity:new l.Uniform1f(y,o.u_intensity),u_matrix:new l.UniformMatrix4f(y,o.u_matrix)}),heatmapTexture:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_world:new l.Uniform2f(y,o.u_world),u_image:new l.Uniform1i(y,o.u_image),u_color_ramp:new l.Uniform1i(y,o.u_color_ramp),u_opacity:new l.Uniform1f(y,o.u_opacity)}),hillshade:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_image:new l.Uniform1i(y,o.u_image),u_latrange:new l.Uniform2f(y,o.u_latrange),u_light:new l.Uniform2f(y,o.u_light),u_shadow:new l.UniformColor(y,o.u_shadow),u_highlight:new l.UniformColor(y,o.u_highlight),u_accent:new l.UniformColor(y,o.u_accent)}),hillshadePrepare:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_image:new l.Uniform1i(y,o.u_image),u_dimension:new l.Uniform2f(y,o.u_dimension),u_zoom:new l.Uniform1f(y,o.u_zoom),u_unpack:new l.Uniform4f(y,o.u_unpack)}),line:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_ratio:new l.Uniform1f(y,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(y,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(y,o.u_units_to_pixels)}),lineGradient:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_ratio:new l.Uniform1f(y,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(y,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(y,o.u_units_to_pixels),u_image:new l.Uniform1i(y,o.u_image),u_image_height:new l.Uniform1f(y,o.u_image_height)}),linePattern:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_texsize:new l.Uniform2f(y,o.u_texsize),u_ratio:new l.Uniform1f(y,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(y,o.u_device_pixel_ratio),u_image:new l.Uniform1i(y,o.u_image),u_units_to_pixels:new l.Uniform2f(y,o.u_units_to_pixels),u_scale:new l.Uniform3f(y,o.u_scale),u_fade:new l.Uniform1f(y,o.u_fade)}),lineSDF:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_ratio:new l.Uniform1f(y,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(y,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(y,o.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(y,o.u_patternscale_a),u_patternscale_b:new l.Uniform2f(y,o.u_patternscale_b),u_sdfgamma:new l.Uniform1f(y,o.u_sdfgamma),u_image:new l.Uniform1i(y,o.u_image),u_tex_y_a:new l.Uniform1f(y,o.u_tex_y_a),u_tex_y_b:new l.Uniform1f(y,o.u_tex_y_b),u_mix:new l.Uniform1f(y,o.u_mix)}),raster:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_tl_parent:new l.Uniform2f(y,o.u_tl_parent),u_scale_parent:new l.Uniform1f(y,o.u_scale_parent),u_buffer_scale:new l.Uniform1f(y,o.u_buffer_scale),u_fade_t:new l.Uniform1f(y,o.u_fade_t),u_opacity:new l.Uniform1f(y,o.u_opacity),u_image0:new l.Uniform1i(y,o.u_image0),u_image1:new l.Uniform1i(y,o.u_image1),u_brightness_low:new l.Uniform1f(y,o.u_brightness_low),u_brightness_high:new l.Uniform1f(y,o.u_brightness_high),u_saturation_factor:new l.Uniform1f(y,o.u_saturation_factor),u_contrast_factor:new l.Uniform1f(y,o.u_contrast_factor),u_spin_weights:new l.Uniform3f(y,o.u_spin_weights)}),symbolIcon:(y,o)=>({u_is_size_zoom_constant:new l.Uniform1i(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(y,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(y,o.u_size_t),u_size:new l.Uniform1f(y,o.u_size),u_camera_to_center_distance:new l.Uniform1f(y,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(y,o.u_pitch),u_rotate_symbol:new l.Uniform1i(y,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(y,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(y,o.u_fade_change),u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(y,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(y,o.u_coord_matrix),u_is_text:new l.Uniform1i(y,o.u_is_text),u_pitch_with_map:new l.Uniform1i(y,o.u_pitch_with_map),u_texsize:new l.Uniform2f(y,o.u_texsize),u_texture:new l.Uniform1i(y,o.u_texture)}),symbolSDF:(y,o)=>({u_is_size_zoom_constant:new l.Uniform1i(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(y,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(y,o.u_size_t),u_size:new l.Uniform1f(y,o.u_size),u_camera_to_center_distance:new l.Uniform1f(y,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(y,o.u_pitch),u_rotate_symbol:new l.Uniform1i(y,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(y,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(y,o.u_fade_change),u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(y,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(y,o.u_coord_matrix),u_is_text:new l.Uniform1i(y,o.u_is_text),u_pitch_with_map:new l.Uniform1i(y,o.u_pitch_with_map),u_texsize:new l.Uniform2f(y,o.u_texsize),u_texture:new l.Uniform1i(y,o.u_texture),u_gamma_scale:new l.Uniform1f(y,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(y,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(y,o.u_is_halo)}),symbolTextAndIcon:(y,o)=>({u_is_size_zoom_constant:new l.Uniform1i(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(y,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(y,o.u_size_t),u_size:new l.Uniform1f(y,o.u_size),u_camera_to_center_distance:new l.Uniform1f(y,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(y,o.u_pitch),u_rotate_symbol:new l.Uniform1i(y,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(y,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(y,o.u_fade_change),u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(y,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(y,o.u_coord_matrix),u_is_text:new l.Uniform1i(y,o.u_is_text),u_pitch_with_map:new l.Uniform1i(y,o.u_pitch_with_map),u_texsize:new l.Uniform2f(y,o.u_texsize),u_texsize_icon:new l.Uniform2f(y,o.u_texsize_icon),u_texture:new l.Uniform1i(y,o.u_texture),u_texture_icon:new l.Uniform1i(y,o.u_texture_icon),u_gamma_scale:new l.Uniform1f(y,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(y,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(y,o.u_is_halo)}),background:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_opacity:new l.Uniform1f(y,o.u_opacity),u_color:new l.UniformColor(y,o.u_color)}),backgroundPattern:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_opacity:new l.Uniform1f(y,o.u_opacity),u_image:new l.Uniform1i(y,o.u_image),u_pattern_tl_a:new l.Uniform2f(y,o.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(y,o.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(y,o.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(y,o.u_pattern_br_b),u_texsize:new l.Uniform2f(y,o.u_texsize),u_mix:new l.Uniform1f(y,o.u_mix),u_pattern_size_a:new l.Uniform2f(y,o.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(y,o.u_pattern_size_b),u_scale_a:new l.Uniform1f(y,o.u_scale_a),u_scale_b:new l.Uniform1f(y,o.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(y,o.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(y,o.u_tile_units_to_pixels)}),terrain:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_texture:new l.Uniform1i(y,o.u_texture),u_ele_delta:new l.Uniform1f(y,o.u_ele_delta)}),terrainDepth:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_ele_delta:new l.Uniform1f(y,o.u_ele_delta)}),terrainCoords:(y,o)=>({u_matrix:new l.UniformMatrix4f(y,o.u_matrix),u_texture:new l.Uniform1i(y,o.u_texture),u_terrain_coords_id:new l.Uniform1f(y,o.u_terrain_coords_id),u_ele_delta:new l.Uniform1f(y,o.u_ele_delta)})};class Rr{constructor(o,d,p){this.context=o;const g=o.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Qh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class lu{constructor(o,d,p,g){this.length=d.length,this.attributes=p,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=o;const x=o.gl;this.buffer=x.createBuffer(),o.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let p=0;p<this.attributes.length;p++){const g=d.attributes[this.attributes[p].name];g!==void 0&&o.enableVertexAttribArray(g)}}setVertexAttribPointers(o,d,p){for(let g=0;g<this.attributes.length;g++){const x=this.attributes[g],E=d.attributes[x.name];E!==void 0&&o.vertexAttribPointer(E,x.components,o[Qh[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Qa=new WeakMap;function el(y){if(Qa.has(y))return Qa.get(y);{const o=y.getParameter(y.VERSION).startsWith("WebGL 2.0");return Qa.set(y,o),o}}class Yt{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class cu extends Yt{getDefault(){return l.Color.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ed extends Yt{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class td extends Yt{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class uu extends Yt{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Cp extends Yt{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Ip extends Yt{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class tl extends Yt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class $_ extends Yt{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Z_ extends Yt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class J_ extends Yt{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class K_ extends Yt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class Y_ extends Yt{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Q_ extends Yt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class nd extends Yt{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class hu extends Yt{getDefault(){return l.Color.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class id extends Yt{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class rd extends Yt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class nl extends Yt{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Pp extends Yt{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Mp extends Yt{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class sd extends Yt{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class pa extends Yt{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Bp extends Yt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class il extends Yt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class rl extends Yt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Lp extends Yt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class od extends Yt{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class nn extends Yt{getDefault(){return null}set(o){var d;if(o===this.current&&!this.dirty)return;const p=this.gl;el(p)?p.bindVertexArray(o):(d=p.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class du extends Yt{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class ey extends Yt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Rp extends Yt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class ma extends Yt{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class ty extends ma{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class ny extends ma{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Dp extends ma{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class iy{constructor(o,d,p,g,x){this.context=o,this.width=d,this.height=p;const E=o.gl,T=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new ty(o,T),g)this.depthAttachment=x?new Dp(o,T):new ny(o,T);else if(x)throw new Error("Stencil cannot be setted without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,d=this.colorAttachment.get();if(d&&o.deleteTexture(d),this.depthAttachment){const p=this.depthAttachment.get();p&&o.deleteRenderbuffer(p)}o.deleteFramebuffer(this.framebuffer)}}class zn{constructor(o,d,p){this.blendFunction=o,this.blendColor=d,this.mask=p}}zn.Replace=[1,0],zn.disabled=new zn(zn.Replace,l.Color.transparent,[!1,!1,!1,!1]),zn.unblended=new zn(zn.Replace,l.Color.transparent,[!0,!0,!0,!0]),zn.alphaBlended=new zn([1,771],l.Color.transparent,[!0,!0,!0,!0]);class fu{constructor(o){var d,p;if(this.gl=o,this.clearColor=new cu(this),this.clearDepth=new ed(this),this.clearStencil=new td(this),this.colorMask=new uu(this),this.depthMask=new Cp(this),this.stencilMask=new Ip(this),this.stencilFunc=new tl(this),this.stencilOp=new $_(this),this.stencilTest=new Z_(this),this.depthRange=new J_(this),this.depthTest=new K_(this),this.depthFunc=new Y_(this),this.blend=new Q_(this),this.blendFunc=new nd(this),this.blendColor=new hu(this),this.blendEquation=new id(this),this.cullFace=new rd(this),this.cullFaceSide=new nl(this),this.frontFace=new Pp(this),this.program=new Mp(this),this.activeTexture=new sd(this),this.viewport=new pa(this),this.bindFramebuffer=new Bp(this),this.bindRenderbuffer=new il(this),this.bindTexture=new rl(this),this.bindVertexBuffer=new Lp(this),this.bindElementBuffer=new od(this),this.bindVertexArray=new nn(this),this.pixelStoreUnpack=new du(this),this.pixelStoreUnpackPremultiplyAlpha=new ey(this),this.pixelStoreUnpackFlipY=new Rp(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),el(o)){this.HALF_FLOAT=o.HALF_FLOAT;const g=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=o.RGBA16F)!==null&&d!==void 0?d:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(p=o.RGB16F)!==null&&p!==void 0?p:g==null?void 0:g.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const g=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d){return new Rr(this,o,d)}createVertexBuffer(o,d,p){return new lu(this,o,d,p)}createRenderbuffer(o,d,p){const g=this.gl,x=g.createRenderbuffer();return this.bindRenderbuffer.set(x),g.renderbufferStorage(g.RENDERBUFFER,o,d,p),this.bindRenderbuffer.set(null),x}createFramebuffer(o,d,p,g){return new iy(this,o,d,p,g)}clear({color:o,depth:d,stencil:p}){const g=this.gl;let x=0;o&&(x|=g.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(x|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),p!==void 0&&(x|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),g.clear(x)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){l.deepEqual(o.blendFunction,zn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return el(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var d;return el(this.gl)?this.gl.deleteVertexArray(o):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class jt{constructor(o,d,p){this.func=o,this.mask=d,this.range=p}}jt.ReadOnly=!1,jt.ReadWrite=!0,jt.disabled=new jt(519,jt.ReadOnly,[0,1]);const tc=7680;class An{constructor(o,d,p,g,x,E){this.test=o,this.ref=d,this.mask=p,this.fail=g,this.depthFail=x,this.pass=E}}An.disabled=new An({func:519,mask:0},0,0,tc,tc,tc);class En{constructor(o,d,p){this.enable=o,this.mode=d,this.frontFace=p}}let ga;function nc(y,o,d,p,g,x,E){const T=y.context,P=T.gl,L=y.useProgram("collisionBox"),D=[];let F=0,H=0;for(let le=0;le<p.length;le++){const ye=p[le],Ce=o.getTile(ye),Ie=Ce.getBucket(d);if(!Ie)continue;let Oe=ye.posMatrix;g[0]===0&&g[1]===0||(Oe=y.translatePosMatrix(ye.posMatrix,Ce,g,x));const Ge=E?Ie.textCollisionBox:Ie.iconCollisionBox,Ne=Ie.collisionCircleArray;if(Ne.length>0){const He=l.create(),ht=Oe;l.mul(He,Ie.placementInvProjMatrix,y.transform.glCoordMatrix),l.mul(He,He,Ie.placementViewportMatrix),D.push({circleArray:Ne,circleOffset:H,transform:ht,invTransform:He,coord:ye}),F+=Ne.length/4,H=F}Ge&&L.draw(T,P.LINES,jt.disabled,An.disabled,y.colorModeForRenderPass(),En.disabled,Pe(Oe,y.transform,Ce),y.style.map.terrain&&y.style.map.terrain.getTerrainData(ye),d.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,null,y.transform.zoom,null,null,Ge.collisionVertexBuffer)}if(!E||!D.length)return;const ne=y.useProgram("collisionCircle"),ee=new l.CollisionCircleLayoutArray;ee.resize(4*F),ee._trim();let re=0;for(const le of D)for(let ye=0;ye<le.circleArray.length/4;ye++){const Ce=4*ye,Ie=le.circleArray[Ce+0],Oe=le.circleArray[Ce+1],Ge=le.circleArray[Ce+2],Ne=le.circleArray[Ce+3];ee.emplace(re++,Ie,Oe,Ge,Ne,0),ee.emplace(re++,Ie,Oe,Ge,Ne,1),ee.emplace(re++,Ie,Oe,Ge,Ne,2),ee.emplace(re++,Ie,Oe,Ge,Ne,3)}(!ga||ga.length<2*F)&&(ga=function(le){const ye=2*le,Ce=new l.QuadTriangleArray;Ce.resize(ye),Ce._trim();for(let Ie=0;Ie<ye;Ie++){const Oe=6*Ie;Ce.uint16[Oe+0]=4*Ie+0,Ce.uint16[Oe+1]=4*Ie+1,Ce.uint16[Oe+2]=4*Ie+2,Ce.uint16[Oe+3]=4*Ie+2,Ce.uint16[Oe+4]=4*Ie+3,Ce.uint16[Oe+5]=4*Ie+0}return Ce}(F));const Q=T.createIndexBuffer(ga,!0),ge=T.createVertexBuffer(ee,l.collisionCircleLayout.members,!0);for(const le of D){const ye={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(Ae=y.transform).cameraToCenterDistance,u_viewport_size:[Ae.width,Ae.height]};ne.draw(T,P.TRIANGLES,jt.disabled,An.disabled,y.colorModeForRenderPass(),En.disabled,ye,y.style.map.terrain&&y.style.map.terrain.getTerrainData(le.coord),d.id,ge,Q,l.SegmentVector.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Ae;ge.destroy(),Q.destroy()}En.disabled=new En(!1,1029,2305),En.backCCW=new En(!0,1029,2305);const ad=l.identity(new Float32Array(16));function ry(y,o,d,p,g,x){const{horizontalAlign:E,verticalAlign:T}=l.getAnchorAlignment(y);return new l.Point((-(E-.5)*o/g+p[0])*x,(-(T-.5)*d/g+p[1])*x)}function ld(y,o,d,p,g,x,E,T,P,L,D){const F=y.text.placedSymbolArray,H=y.text.dynamicLayoutVertexArray,ne=y.icon.dynamicLayoutVertexArray,ee={};H.clear();for(let re=0;re<F.length;re++){const Q=F.get(re),ge=Q.hidden||!Q.crossTileID||y.allowVerticalPlacement&&!Q.placedOrientation?null:p[Q.crossTileID];if(ge){const Ae=new l.Point(Q.anchorX,Q.anchorY),le=Et(Ae,d?E:x,D),ye=Zr(g.cameraToCenterDistance,le.signedDistanceFromCamera);let Ce=l.evaluateSizeForFeature(y.textSizeData,P,Q)*ye/l.ONE_EM;d&&(Ce*=y.tilePixelRatio/T);const{width:Ie,height:Oe,anchor:Ge,textOffset:Ne,textBoxScale:He}=ge,ht=ry(Ge,Ie,Oe,Ne,He,Ce),kt=d?Et(Ae.add(ht),x,D).point:le.point.add(o?ht.rotate(-g.angle):ht),Ke=y.allowVerticalPlacement&&Q.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let yt=0;yt<Q.numGlyphs;yt++)l.addDynamicAttributes(H,kt,Ke);L&&Q.associatedIconIndex>=0&&(ee[Q.associatedIconIndex]={shiftedAnchor:kt,angle:Ke})}else K(Q.numGlyphs,H)}if(L){ne.clear();const re=y.icon.placedSymbolArray;for(let Q=0;Q<re.length;Q++){const ge=re.get(Q);if(ge.hidden)K(ge.numGlyphs,ne);else{const Ae=ee[Q];if(Ae)for(let le=0;le<ge.numGlyphs;le++)l.addDynamicAttributes(ne,Ae.shiftedAnchor,Ae.angle);else K(ge.numGlyphs,ne)}}y.icon.dynamicLayoutVertexBuffer.updateData(ne)}y.text.dynamicLayoutVertexBuffer.updateData(H)}function sy(y,o,d){return d.iconsInText&&o?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function cd(y,o,d,p,g,x,E,T,P,L,D,F){const H=y.context,ne=H.gl,ee=y.transform,re=T==="map",Q=P==="map",ge=T!=="viewport"&&d.layout.get("symbol-placement")!=="point",Ae=re&&!Q&&!ge,le=!d.layout.get("symbol-sort-key").isConstant();let ye=!1;const Ce=y.depthModeForSublayer(0,jt.ReadOnly),Ie=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Oe=[];for(const Ge of p){const Ne=o.getTile(Ge),He=Ne.getBucket(d);if(!He)continue;const ht=g?He.text:He.icon;if(!ht||!ht.segments.get().length||!ht.hasVisibleVertices)continue;const kt=ht.programConfigurations.get(d.id),Ke=g||He.sdfIcons,yt=g?He.textSizeData:He.iconSizeData,ct=Q||ee.pitch!==0,Pn=y.useProgram(sy(Ke,g,He),kt),zt=l.evaluateSizeForZoom(yt,ee.zoom),xt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ge);let Nt,Rn,hn,Or,Oi=[0,0],Xn=null;if(g)Rn=Ne.glyphAtlasTexture,hn=ne.LINEAR,Nt=Ne.glyphAtlasTexture.size,He.iconsInText&&(Oi=Ne.imageAtlasTexture.size,Xn=Ne.imageAtlasTexture,Or=ct||y.options.rotating||y.options.zooming||yt.kind==="composite"||yt.kind==="camera"?ne.LINEAR:ne.NEAREST);else{const xi=d.layout.get("icon-size").constantOr(0)!==1||He.iconsNeedLinear;Rn=Ne.imageAtlasTexture,hn=Ke||y.options.rotating||y.options.zooming||xi||ct?ne.LINEAR:ne.NEAREST,Nt=Ne.imageAtlasTexture.size}const mr=fe(Ne,1,y.transform.zoom),Hs=Ti(Ge.posMatrix,Q,re,y.transform,mr),gs=fs(Ge.posMatrix,Q,re,y.transform,mr),Ws=Ie&&He.hasTextData(),ll=d.layout.get("icon-text-fit")!=="none"&&Ws&&He.hasIconData();if(ge){const xi=y.style.map.terrain?(Wi,Dn)=>y.style.map.terrain.getElevation(Ge,Wi,Dn):null,ui=d.layout.get("text-rotation-alignment")==="map";Mr(He,Ge.posMatrix,y,g,Hs,gs,Q,L,ui,xi)}const Wo=y.translatePosMatrix(Ge.posMatrix,Ne,x,E),go=ge||g&&Ie||ll?ad:Hs,ti=y.translatePosMatrix(gs,Ne,x,E,!0),vi=Ke&&d.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Hi;Hi=Ke?He.iconsInText?ec(yt.kind,zt,Ae,Q,y,Wo,go,ti,Nt,Oi):Ql(yt.kind,zt,Ae,Q,y,Wo,go,ti,g,Nt,!0):Yl(yt.kind,zt,Ae,Q,y,Wo,go,ti,g,Nt);const cl={program:Pn,buffers:ht,uniformValues:Hi,atlasTexture:Rn,atlasTextureIcon:Xn,atlasInterpolation:hn,atlasInterpolationIcon:Or,isSDF:Ke,hasHalo:vi};if(le&&He.canOverlap){ye=!0;const xi=ht.segments.get();for(const ui of xi)Oe.push({segments:new l.SegmentVector([ui]),sortKey:ui.sortKey,state:cl,terrainData:xt})}else Oe.push({segments:ht.segments,sortKey:0,state:cl,terrainData:xt})}ye&&Oe.sort((Ge,Ne)=>Ge.sortKey-Ne.sortKey);for(const Ge of Oe){const Ne=Ge.state;if(H.activeTexture.set(ne.TEXTURE0),Ne.atlasTexture.bind(Ne.atlasInterpolation,ne.CLAMP_TO_EDGE),Ne.atlasTextureIcon&&(H.activeTexture.set(ne.TEXTURE1),Ne.atlasTextureIcon&&Ne.atlasTextureIcon.bind(Ne.atlasInterpolationIcon,ne.CLAMP_TO_EDGE)),Ne.isSDF){const He=Ne.uniformValues;Ne.hasHalo&&(He.u_is_halo=1,ic(Ne.buffers,Ge.segments,d,y,Ne.program,Ce,D,F,He,Ge.terrainData)),He.u_is_halo=0}ic(Ne.buffers,Ge.segments,d,y,Ne.program,Ce,D,F,Ne.uniformValues,Ge.terrainData)}}function ic(y,o,d,p,g,x,E,T,P,L){const D=p.context;g.draw(D,D.gl.TRIANGLES,x,E,T,En.disabled,P,L,d.id,y.layoutVertexBuffer,y.indexBuffer,o,d.paint,p.transform.zoom,y.programConfigurations.get(d.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function pu(y,o,d,p,g){if(!d||!p||!p.imageAtlas)return;const x=p.imageAtlas.patternPositions;let E=x[d.to.toString()],T=x[d.from.toString()];if(!E||!T){const P=g.getPaintProperty(o);E=x[P],T=x[P]}E&&T&&y.setConstantPatternPositions(E,T)}function ud(y,o,d,p,g,x,E){const T=y.context.gl,P="fill-pattern",L=d.paint.get(P),D=L&&L.constantOr(1),F=d.getCrossfadeParameters();let H,ne,ee,re,Q;E?(ne=D&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=T.LINES):(ne=D?"fillPattern":"fill",H=T.TRIANGLES);const ge=L.constantOr(null);for(const Ae of p){const le=o.getTile(Ae);if(D&&!le.patternsLoaded())continue;const ye=le.getBucket(d);if(!ye)continue;const Ce=ye.programConfigurations.get(d.id),Ie=y.useProgram(ne,Ce),Oe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ae);D&&(y.context.activeTexture.set(T.TEXTURE0),le.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Ce.updatePaintBuffers(F)),pu(Ce,P,ge,le,d);const Ge=Oe?Ae:null,Ne=y.translatePosMatrix(Ge?Ge.posMatrix:Ae.posMatrix,le,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(E){re=ye.indexBuffer2,Q=ye.segments2;const He=[T.drawingBufferWidth,T.drawingBufferHeight];ee=ne==="fillOutlinePattern"&&D?Y(Ne,y,F,le,He):$(Ne,He)}else re=ye.indexBuffer,Q=ye.segments,ee=D?Ya(Ne,y,F,le):ru(Ne);Ie.draw(y.context,H,g,y.stencilModeForClipping(Ae),x,En.disabled,ee,Oe,d.id,ye.layoutVertexBuffer,re,Q,d.paint,y.transform.zoom,Ce)}}function mu(y,o,d,p,g,x,E){const T=y.context,P=T.gl,L="fill-extrusion-pattern",D=d.paint.get(L),F=D.constantOr(1),H=d.getCrossfadeParameters(),ne=d.paint.get("fill-extrusion-opacity"),ee=D.constantOr(null);for(const re of p){const Q=o.getTile(re),ge=Q.getBucket(d);if(!ge)continue;const Ae=y.style.map.terrain&&y.style.map.terrain.getTerrainData(re),le=ge.programConfigurations.get(d.id),ye=y.useProgram(F?"fillExtrusionPattern":"fillExtrusion",le);F&&(y.context.activeTexture.set(P.TEXTURE0),Q.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),le.updatePaintBuffers(H)),pu(le,L,ee,Q,d);const Ce=y.translatePosMatrix(re.posMatrix,Q,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Ie=d.paint.get("fill-extrusion-vertical-gradient"),Oe=F?iu(Ce,y,Ie,ne,re,H,Q):fo(Ce,y,Ie,ne);ye.draw(T,T.gl.TRIANGLES,g,x,E,En.backCCW,Oe,Ae,d.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,d.paint,y.transform.zoom,le,y.style.map.terrain&&ge.centroidVertexBuffer)}}function gu(y,o,d,p,g,x,E){const T=y.context,P=T.gl,L=d.fbo;if(!L)return;const D=y.useProgram("hillshade"),F=y.style.map.terrain&&y.style.map.terrain.getTerrainData(o);T.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,L.colorAttachment.get()),D.draw(T,P.TRIANGLES,g,x,E,En.disabled,((H,ne,ee,re)=>{const Q=ee.paint.get("hillshade-shadow-color"),ge=ee.paint.get("hillshade-highlight-color"),Ae=ee.paint.get("hillshade-accent-color");let le=ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);ee.paint.get("hillshade-illumination-anchor")==="viewport"&&(le-=H.transform.angle);const ye=!H.options.moving;return{u_matrix:re?re.posMatrix:H.transform.calculatePosMatrix(ne.tileID.toUnwrapped(),ye),u_image:0,u_latrange:Qn(0,ne.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),le],u_shadow:Q,u_highlight:ge,u_accent:Ae}})(y,d,p,F?o:null),F,p.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function hd(y,o,d,p,g,x){const E=y.context,T=E.gl,P=o.dem;if(P&&P.data){const L=P.dim,D=P.stride,F=P.getPixels();if(E.activeTexture.set(T.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||y.getTileTexture(D),o.demTexture){const ne=o.demTexture;ne.update(F,{premultiply:!1}),ne.bind(T.NEAREST,T.CLAMP_TO_EDGE)}else o.demTexture=new Me(E,F,T.RGBA,{premultiply:!1}),o.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);E.activeTexture.set(T.TEXTURE0);let H=o.fbo;if(!H){const ne=new Me(E,{width:L,height:L,data:null},T.RGBA);ne.bind(T.LINEAR,T.CLAMP_TO_EDGE),H=o.fbo=E.createFramebuffer(L,L,!0,!1),H.colorAttachment.set(ne.texture)}E.bindFramebuffer.set(H.framebuffer),E.viewport.set([0,0,L,L]),y.useProgram("hillshadePrepare").draw(E,T.TRIANGLES,p,g,x,En.disabled,((ne,ee)=>{const re=ee.stride,Q=l.create();return l.ortho(Q,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(Q,Q,[0,-l.EXTENT,0]),{u_matrix:Q,u_image:1,u_dimension:[re,re],u_zoom:ne.overscaledZ,u_unpack:ee.getUnpackVector()}})(o.tileID,P),null,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function oy(y,o,d,p,g,x){const E=p.paint.get("raster-fade-duration");if(!x&&E>0){const T=l.browser.now(),P=(T-y.timeAdded)/E,L=o?(T-o.timeAdded)/E:-1,D=d.getSource(),F=g.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),H=!o||Math.abs(o.tileID.overscaledZ-F)>Math.abs(y.tileID.overscaledZ-F),ne=H&&y.refreshedUponExpiration?1:l.clamp(H?P:1-L,0,1);return y.refreshedUponExpiration&&P>=1&&(y.refreshedUponExpiration=!1),o?{opacity:1,mix:1-ne}:{opacity:ne,mix:0}}return{opacity:1,mix:0}}const Op=new l.Color(1,0,0,1),qn=new l.Color(0,1,0,1),_a=new l.Color(0,0,1,1),Yr=new l.Color(1,0,1,1),dd=new l.Color(0,1,1,1);function _u(y,o,d,p){po(y,0,o+d/2,y.transform.width,d,p)}function fd(y,o,d,p){po(y,o-d/2,0,d,y.transform.height,p)}function po(y,o,d,p,g,x){const E=y.context,T=E.gl;T.enable(T.SCISSOR_TEST),T.scissor(o*y.pixelRatio,d*y.pixelRatio,p*y.pixelRatio,g*y.pixelRatio),E.clear({color:x}),T.disable(T.SCISSOR_TEST)}function rc(y,o,d){const p=y.context,g=p.gl,x=d.posMatrix,E=y.useProgram("debug"),T=jt.disabled,P=An.disabled,L=y.colorModeForRenderPass(),D="$debug",F=y.style.map.terrain&&y.style.map.terrain.getTerrainData(d);p.activeTexture.set(g.TEXTURE0);const H=o.getTileByID(d.key).latestRawTileData,ne=Math.floor((H&&H.byteLength||0)/1024),ee=o.getTile(d).tileSize,re=512/Math.min(ee,512)*(d.overscaledZ/y.transform.zoom)*.5;let Q=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Q+=` => ${d.overscaledZ}`),function(ge,Ae){ge.initDebugOverlayCanvas();const le=ge.debugOverlayCanvas,ye=ge.context.gl,Ce=ge.debugOverlayCanvas.getContext("2d");Ce.clearRect(0,0,le.width,le.height),Ce.shadowColor="white",Ce.shadowBlur=2,Ce.lineWidth=1.5,Ce.strokeStyle="white",Ce.textBaseline="top",Ce.font="bold 36px Open Sans, sans-serif",Ce.fillText(Ae,5,5),Ce.strokeText(Ae,5,5),ge.debugOverlayTexture.update(le),ge.debugOverlayTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}(y,`${Q} ${ne}kB`),E.draw(p,g.TRIANGLES,T,P,zn.alphaBlended,En.disabled,je(x,l.Color.transparent,re),null,D,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),E.draw(p,g.LINE_STRIP,T,P,L,En.disabled,je(x,l.Color.red),F,D,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function yu(y,o,d){const p=y.context,g=p.gl,x=y.colorModeForRenderPass(),E=new jt(g.LEQUAL,jt.ReadWrite,y.depthRangeFor3D),T=y.useProgram("terrain"),P=o.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,y.width,y.height]);for(const L of d){const D=y.renderToTexture.getTexture(L),F=o.getTerrainData(L.tileID);p.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,D.texture);const H={u_matrix:y.transform.calculatePosMatrix(L.tileID.toUnwrapped()),u_texture:0,u_ele_delta:o.getMeshFrameDelta(y.transform.zoom)};T.draw(p,g.TRIANGLES,E,An.disabled,x,En.backCCW,H,F,"terrain",P.vertexBuffer,P.indexBuffer,P.segments)}}class Fp{constructor(o,d){this.context=new fu(o),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=Sn.maxUnderzooming+Sn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new sn}resize(o,d,p){if(this.width=Math.floor(o*p),this.height=Math.floor(d*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const o=this.context,d=new l.PosArray;d.emplaceBack(0,0),d.emplaceBack(l.EXTENT,0),d.emplaceBack(0,l.EXTENT),d.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(d,Vo.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const p=new l.PosArray;p.emplaceBack(0,0),p.emplaceBack(l.EXTENT,0),p.emplaceBack(0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=o.createVertexBuffer(p,Vo.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const g=new l.RasterBoundsArray;g.emplaceBack(0,0,0,0),g.emplaceBack(l.EXTENT,0,l.EXTENT,0),g.emplaceBack(0,l.EXTENT,0,l.EXTENT),g.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=o.createVertexBuffer(g,gn.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const x=new l.PosArray;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(x,Vo.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const E=new l.LineStripIndexArray;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(E);const T=new l.TriangleIndexArray;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(T);const P=this.context.gl;this.stencilClearMode=new An({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO)}clearStencil(){const o=this.context,d=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=l.create();l.ortho(p,0,this.width,this.height,0,0,1),l.scale(p,p,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,d.TRIANGLES,jt.disabled,this.stencilClearMode,zn.disabled,En.disabled,ot(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,d){if(this.currentStencilSource===o.source||!o.isTileClipped()||!d||!d.length)return;this.currentStencilSource=o.source;const p=this.context,g=p.gl;this.nextStencilID+d.length>256&&this.clearStencil(),p.setColorMode(zn.disabled),p.setDepthMode(jt.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of d){const T=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E);x.draw(p,g.TRIANGLES,jt.disabled,new An({func:g.ALWAYS,mask:0},T,255,g.KEEP,g.KEEP,g.REPLACE),zn.disabled,En.disabled,ot(E.posMatrix),P,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new An({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){const d=this.context.gl;return new An({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(o){const d=this.context.gl,p=o.sort((E,T)=>T.overscaledZ-E.overscaledZ),g=p[p.length-1].overscaledZ,x=p[0].overscaledZ-g+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let T=0;T<x;T++)E[T+g]=new An({func:d.GEQUAL,mask:255},T+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=x,[E,p]}return[{[g]:An.disabled},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new zn([o.CONSTANT_COLOR,o.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?zn.unblended:zn.alphaBlended}depthModeForSublayer(o,d,p){if(!this.opaquePassEnabledForLayer())return jt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new jt(p||this.context.gl.LEQUAL,d,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,d){this.style=o,this.options=d,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(l.browser.now()),this.imageManager.beginFrame();const p=this.style._order,g=this.style.sourceCaches,x={},E={},T={};for(const P in g){const L=g[P];L.used&&L.prepare(this.context),x[P]=L.getVisibleCoordinates(),E[P]=x[P].slice().reverse(),T[P]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<p.length;P++)if(this.style._layers[p[P]].is3D()){this.opaquePassCutoff=P;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const P=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||P.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(L,D){const F=L.context,H=F.gl,ne=zn.unblended,ee=new jt(H.LEQUAL,jt.ReadWrite,[0,1]),re=D.getTerrainMesh(),Q=D.sourceCache.getRenderableTiles(),ge=L.useProgram("terrainDepth");F.bindFramebuffer.set(D.getFramebuffer("depth").framebuffer),F.viewport.set([0,0,L.width/devicePixelRatio,L.height/devicePixelRatio]),F.clear({color:l.Color.transparent,depth:1});for(const Ae of Q){const le=D.getTerrainData(Ae.tileID),ye={u_matrix:L.transform.calculatePosMatrix(Ae.tileID.toUnwrapped()),u_ele_delta:D.getMeshFrameDelta(L.transform.zoom)};ge.draw(F,H.TRIANGLES,ee,An.disabled,ne,En.backCCW,ye,le,"terrain",re.vertexBuffer,re.indexBuffer,re.segments)}F.bindFramebuffer.set(null),F.viewport.set([0,0,L.width,L.height])}(this,this.style.map.terrain),function(L,D){const F=L.context,H=F.gl,ne=zn.unblended,ee=new jt(H.LEQUAL,jt.ReadWrite,[0,1]),re=D.getTerrainMesh(),Q=D.getCoordsTexture(),ge=D.sourceCache.getRenderableTiles(),Ae=L.useProgram("terrainCoords");F.bindFramebuffer.set(D.getFramebuffer("coords").framebuffer),F.viewport.set([0,0,L.width/devicePixelRatio,L.height/devicePixelRatio]),F.clear({color:l.Color.transparent,depth:1}),D.coordsIndex=[];for(const le of ge){const ye=D.getTerrainData(le.tileID);F.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,Q.texture);const Ce={u_matrix:L.transform.calculatePosMatrix(le.tileID.toUnwrapped()),u_terrain_coords_id:(255-D.coordsIndex.length)/255,u_texture:0,u_ele_delta:D.getMeshFrameDelta(L.transform.zoom)};Ae.draw(F,H.TRIANGLES,ee,An.disabled,ne,En.backCCW,Ce,ye,"terrain",re.vertexBuffer,re.indexBuffer,re.segments),D.coordsIndex.push(le.tileID.key)}F.bindFramebuffer.set(null),F.viewport.set([0,0,L.width,L.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const P of p){const L=this.style._layers[P];if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const D=E[L.source];(L.type==="custom"||D.length)&&this.renderLayer(this,g[L.source],L,D)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[p[this.currentLayer]],L=g[P.source],D=x[P.source];this._renderTileClippingMasks(P,D),this.renderLayer(this,L,P,D)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const P=this.style._layers[p[this.currentLayer]],L=g[P.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(P))continue;const D=(P.type==="symbol"?T:E)[P.source];this._renderTileClippingMasks(P,x[P.source]),this.renderLayer(this,L,P,D)}if(this.options.showTileBoundaries){const P=function(L,D){let F=null;const H=Object.values(L._layers).flatMap(Q=>Q.source&&!Q.isHidden(D)?[L.sourceCaches[Q.source]]:[]),ne=H.filter(Q=>Q.getSource().type==="vector"),ee=H.filter(Q=>Q.getSource().type!=="vector"),re=Q=>{(!F||F.getSource().maxzoom<Q.getSource().maxzoom)&&(F=Q)};return ne.forEach(Q=>re(Q)),F||ee.forEach(Q=>re(Q)),F}(this.style,this.transform.zoom);P&&function(L,D,F){for(let H=0;H<F.length;H++)rc(L,D,F[H])}(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const L=P.transform.padding;_u(P,P.transform.height-(L.top||0),3,Op),_u(P,L.bottom||0,3,qn),fd(P,L.left||0,3,_a),fd(P,P.transform.width-(L.right||0),3,Yr);const D=P.transform.centerPoint;(function(F,H,ne,ee){po(F,H-1,ne-10,2,20,ee),po(F,H-10,ne-1,20,2,ee)})(P,D.x,P.transform.height-D.y,dd)}(this),this.context.setDefault()}renderLayer(o,d,p,g){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(g||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(x,E,T,P,L){if(x.renderPass!=="translucent")return;const D=An.disabled,F=x.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(H,ne,ee,re,Q,ge,Ae){const le=ne.transform,ye=Q==="map",Ce=ge==="map";for(const Ie of H){const Oe=re.getTile(Ie),Ge=Oe.getBucket(ee);if(!Ge||!Ge.text||!Ge.text.segments.get().length)continue;const Ne=l.evaluateSizeForZoom(Ge.textSizeData,le.zoom),He=fe(Oe,1,ne.transform.zoom),ht=Ti(Ie.posMatrix,Ce,ye,ne.transform,He),kt=ee.layout.get("icon-text-fit")!=="none"&&Ge.hasIconData();if(Ne){const Ke=Math.pow(2,le.zoom-Oe.tileID.overscaledZ);ld(Ge,ye,Ce,Ae,le,ht,Ie.posMatrix,Ke,Ne,kt,ne.style.map.terrain?(yt,ct)=>ne.style.map.terrain.getElevation(Ie,yt,ct):null)}}}(P,x,T,E,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),L),T.paint.get("icon-opacity").constantOr(1)!==0&&cd(x,E,T,P,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),D,F),T.paint.get("text-opacity").constantOr(1)!==0&&cd(x,E,T,P,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),D,F),E.map.showCollisionBoxes&&(nc(x,E,T,P,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),!0),nc(x,E,T,P,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),!1))})(o,d,p,g,this.style.placement.variableOffsets);break;case"circle":(function(x,E,T,P){if(x.renderPass!=="translucent")return;const L=T.paint.get("circle-opacity"),D=T.paint.get("circle-stroke-width"),F=T.paint.get("circle-stroke-opacity"),H=!T.layout.get("circle-sort-key").isConstant();if(L.constantOr(1)===0&&(D.constantOr(1)===0||F.constantOr(1)===0))return;const ne=x.context,ee=ne.gl,re=x.depthModeForSublayer(0,jt.ReadOnly),Q=An.disabled,ge=x.colorModeForRenderPass(),Ae=[];for(let le=0;le<P.length;le++){const ye=P[le],Ce=E.getTile(ye),Ie=Ce.getBucket(T);if(!Ie)continue;const Oe=Ie.programConfigurations.get(T.id),Ge=x.useProgram("circle",Oe),Ne=Ie.layoutVertexBuffer,He=Ie.indexBuffer,ht=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ye),kt={programConfiguration:Oe,program:Ge,layoutVertexBuffer:Ne,indexBuffer:He,uniformValues:pe(x,ye,Ce,T),terrainData:ht};if(H){const Ke=Ie.segments.get();for(const yt of Ke)Ae.push({segments:new l.SegmentVector([yt]),sortKey:yt.sortKey,state:kt})}else Ae.push({segments:Ie.segments,sortKey:0,state:kt})}H&&Ae.sort((le,ye)=>le.sortKey-ye.sortKey);for(const le of Ae){const{programConfiguration:ye,program:Ce,layoutVertexBuffer:Ie,indexBuffer:Oe,uniformValues:Ge,terrainData:Ne}=le.state;Ce.draw(ne,ee.TRIANGLES,re,Q,ge,En.disabled,Ge,Ne,T.id,Ie,Oe,le.segments,T.paint,x.transform.zoom,ye)}})(o,d,p,g);break;case"heatmap":(function(x,E,T,P){if(T.paint.get("heatmap-opacity")!==0)if(x.renderPass==="offscreen"){const L=x.context,D=L.gl,F=An.disabled,H=new zn([D.ONE,D.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(ne,ee,re){const Q=ne.gl;ne.activeTexture.set(Q.TEXTURE1),ne.viewport.set([0,0,ee.width/4,ee.height/4]);let ge=re.heatmapFbo;if(ge)Q.bindTexture(Q.TEXTURE_2D,ge.colorAttachment.get()),ne.bindFramebuffer.set(ge.framebuffer);else{const Ae=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,Ae),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),ge=re.heatmapFbo=ne.createFramebuffer(ee.width/4,ee.height/4,!1,!1),function(le,ye,Ce,Ie){var Oe,Ge;const Ne=le.gl,He=(Oe=le.HALF_FLOAT)!==null&&Oe!==void 0?Oe:Ne.UNSIGNED_BYTE,ht=(Ge=le.RGBA16F)!==null&&Ge!==void 0?Ge:Ne.RGBA;Ne.texImage2D(Ne.TEXTURE_2D,0,ht,ye.width/4,ye.height/4,0,Ne.RGBA,He,null),Ie.colorAttachment.set(Ce)}(ne,ee,Ae,ge)}})(L,x,T),L.clear({color:l.Color.transparent});for(let ne=0;ne<P.length;ne++){const ee=P[ne];if(E.hasRenderableParent(ee))continue;const re=E.getTile(ee),Q=re.getBucket(T);if(!Q)continue;const ge=Q.programConfigurations.get(T.id),Ae=x.useProgram("heatmap",ge),{zoom:le}=x.transform;Ae.draw(L,D.TRIANGLES,jt.disabled,F,H,En.disabled,Vt(ee.posMatrix,re,le,T.paint.get("heatmap-intensity")),null,T.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,T.paint,x.transform.zoom,ge)}L.viewport.set([0,0,x.width,x.height])}else x.renderPass==="translucent"&&(x.context.setColorMode(x.colorModeForRenderPass()),function(L,D){const F=L.context,H=F.gl,ne=D.heatmapFbo;if(!ne)return;F.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,ne.colorAttachment.get()),F.activeTexture.set(H.TEXTURE1);let ee=D.colorRampTexture;ee||(ee=D.colorRampTexture=new Me(F,D.colorRamp,H.RGBA)),ee.bind(H.LINEAR,H.CLAMP_TO_EDGE),L.useProgram("heatmapTexture").draw(F,H.TRIANGLES,jt.disabled,An.disabled,L.colorModeForRenderPass(),En.disabled,((re,Q,ge,Ae)=>{const le=l.create();l.ortho(le,0,re.width,re.height,0,0,1);const ye=re.context.gl;return{u_matrix:le,u_world:[ye.drawingBufferWidth,ye.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Q.paint.get("heatmap-opacity")}})(L,D),null,D.id,L.viewportBuffer,L.quadTriangleIndexBuffer,L.viewportSegments,D.paint,L.transform.zoom)}(x,T))})(o,d,p,g);break;case"line":(function(x,E,T,P){if(x.renderPass!=="translucent")return;const L=T.paint.get("line-opacity"),D=T.paint.get("line-width");if(L.constantOr(1)===0||D.constantOr(1)===0)return;const F=x.depthModeForSublayer(0,jt.ReadOnly),H=x.colorModeForRenderPass(),ne=T.paint.get("line-dasharray"),ee=T.paint.get("line-pattern"),re=ee.constantOr(1),Q=T.paint.get("line-gradient"),ge=T.getCrossfadeParameters(),Ae=re?"linePattern":ne?"lineSDF":Q?"lineGradient":"line",le=x.context,ye=le.gl;let Ce=!0;for(const Ie of P){const Oe=E.getTile(Ie);if(re&&!Oe.patternsLoaded())continue;const Ge=Oe.getBucket(T);if(!Ge)continue;const Ne=Ge.programConfigurations.get(T.id),He=x.context.program.get(),ht=x.useProgram(Ae,Ne),kt=Ce||ht.program!==He,Ke=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ie),yt=ee.constantOr(null);if(yt&&Oe.imageAtlas){const zt=Oe.imageAtlas,xt=zt.patternPositions[yt.to.toString()],Nt=zt.patternPositions[yt.from.toString()];xt&&Nt&&Ne.setConstantPatternPositions(xt,Nt)}const ct=Ke?Ie:null,Pn=re?Ci(x,Oe,T,ge,ct):ne?su(x,Oe,T,ne,ge,ct):Q?Si(x,Oe,T,Ge.lineClipsArray.length,ct):Wn(x,Oe,T,ct);if(re)le.activeTexture.set(ye.TEXTURE0),Oe.imageAtlasTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),Ne.updatePaintBuffers(ge);else if(ne&&(kt||x.lineAtlas.dirty))le.activeTexture.set(ye.TEXTURE0),x.lineAtlas.bind(le);else if(Q){const zt=Ge.gradients[T.id];let xt=zt.texture;if(T.gradientVersion!==zt.version){let Nt=256;if(T.stepInterpolant){const Rn=E.getSource().maxzoom,hn=Ie.canonical.z===Rn?Math.ceil(1<<x.transform.maxZoom-Ie.canonical.z):1;Nt=l.clamp(l.nextPowerOfTwo(Ge.maxLineLength/l.EXTENT*1024*hn),256,le.maxTextureSize)}zt.gradient=l.renderColorRamp({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:Nt,image:zt.gradient||void 0,clips:Ge.lineClipsArray}),zt.texture?zt.texture.update(zt.gradient):zt.texture=new Me(le,zt.gradient,ye.RGBA),zt.version=T.gradientVersion,xt=zt.texture}le.activeTexture.set(ye.TEXTURE0),xt.bind(T.stepInterpolant?ye.NEAREST:ye.LINEAR,ye.CLAMP_TO_EDGE)}ht.draw(le,ye.TRIANGLES,F,x.stencilModeForClipping(Ie),H,En.disabled,Pn,Ke,T.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,T.paint,x.transform.zoom,Ne,Ge.layoutVertexBuffer2),Ce=!1}})(o,d,p,g);break;case"fill":(function(x,E,T,P){const L=T.paint.get("fill-color"),D=T.paint.get("fill-opacity");if(D.constantOr(1)===0)return;const F=x.colorModeForRenderPass(),H=T.paint.get("fill-pattern"),ne=x.opaquePassEnabledForLayer()&&!H.constantOr(1)&&L.constantOr(l.Color.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===ne){const ee=x.depthModeForSublayer(1,x.renderPass==="opaque"?jt.ReadWrite:jt.ReadOnly);ud(x,E,T,P,ee,F,!1)}if(x.renderPass==="translucent"&&T.paint.get("fill-antialias")){const ee=x.depthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,jt.ReadOnly);ud(x,E,T,P,ee,F,!0)}})(o,d,p,g);break;case"fill-extrusion":(function(x,E,T,P){const L=T.paint.get("fill-extrusion-opacity");if(L!==0&&x.renderPass==="translucent"){const D=new jt(x.context.gl.LEQUAL,jt.ReadWrite,x.depthRangeFor3D);if(L!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))mu(x,E,T,P,D,An.disabled,zn.disabled),mu(x,E,T,P,D,x.stencilModeFor3D(),x.colorModeForRenderPass());else{const F=x.colorModeForRenderPass();mu(x,E,T,P,D,An.disabled,F)}}})(o,d,p,g);break;case"hillshade":(function(x,E,T,P){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const L=x.context,D=x.depthModeForSublayer(0,jt.ReadOnly),F=x.colorModeForRenderPass(),[H,ne]=x.renderPass==="translucent"?x.stencilConfigForOverlap(P):[{},P];for(const ee of ne){const re=E.getTile(ee);re.needsHillshadePrepare!==void 0&&re.needsHillshadePrepare&&x.renderPass==="offscreen"?hd(x,re,T,D,An.disabled,F):x.renderPass==="translucent"&&gu(x,ee,re,T,D,H[ee.overscaledZ],F)}L.viewport.set([0,0,x.width,x.height])})(o,d,p,g);break;case"raster":(function(x,E,T,P){if(x.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!P.length)return;const L=x.context,D=L.gl,F=E.getSource(),H=x.useProgram("raster"),ne=x.colorModeForRenderPass(),[ee,re]=F instanceof er?[{},P]:x.stencilConfigForOverlap(P),Q=re[re.length-1].overscaledZ,ge=!x.options.moving;for(const Ae of re){const le=x.depthModeForSublayer(Ae.overscaledZ-Q,T.paint.get("raster-opacity")===1?jt.ReadWrite:jt.ReadOnly,D.LESS),ye=E.getTile(Ae);ye.registerFadeDuration(T.paint.get("raster-fade-duration"));const Ce=E.findLoadedParent(Ae,0),Ie=oy(ye,Ce,E,T,x.transform,x.style.map.terrain);let Oe,Ge;const Ne=T.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;L.activeTexture.set(D.TEXTURE0),ye.texture.bind(Ne,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),L.activeTexture.set(D.TEXTURE1),Ce?(Ce.texture.bind(Ne,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),Oe=Math.pow(2,Ce.tileID.overscaledZ-ye.tileID.overscaledZ),Ge=[ye.tileID.canonical.x*Oe%1,ye.tileID.canonical.y*Oe%1]):ye.texture.bind(Ne,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const He=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ae),ht=He?Ae:null,kt=ht?ht.posMatrix:x.transform.calculatePosMatrix(Ae.toUnwrapped(),ge),Ke=ou(kt,Ge||[0,0],Oe||1,Ie,T);F instanceof er?H.draw(L,D.TRIANGLES,le,An.disabled,ne,En.disabled,Ke,He,T.id,F.boundsBuffer,x.quadTriangleIndexBuffer,F.boundsSegments):H.draw(L,D.TRIANGLES,le,ee[Ae.overscaledZ],ne,En.disabled,Ke,He,T.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments)}})(o,d,p,g);break;case"background":(function(x,E,T,P){const L=T.paint.get("background-color"),D=T.paint.get("background-opacity");if(D===0)return;const F=x.context,H=F.gl,ne=x.transform,ee=ne.tileSize,re=T.paint.get("background-pattern");if(x.isPatternMissing(re))return;const Q=!re&&L.a===1&&D===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==Q)return;const ge=An.disabled,Ae=x.depthModeForSublayer(0,Q==="opaque"?jt.ReadWrite:jt.ReadOnly),le=x.colorModeForRenderPass(),ye=x.useProgram(re?"backgroundPattern":"background"),Ce=P||ne.coveringTiles({tileSize:ee,terrain:x.style.map.terrain});re&&(F.activeTexture.set(H.TEXTURE0),x.imageManager.bind(x.context));const Ie=T.getCrossfadeParameters();for(const Oe of Ce){const Ge=P?Oe.posMatrix:x.transform.calculatePosMatrix(Oe.toUnwrapped()),Ne=re?au(Ge,D,x,re,{tileID:Oe,tileSize:ee},Ie):fa(Ge,D,L),He=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Oe);ye.draw(F,H.TRIANGLES,Ae,ge,le,En.disabled,Ne,He,T.id,x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}})(o,0,p,g);break;case"custom":(function(x,E,T){const P=x.context,L=T.implementation;if(x.renderPass==="offscreen"){const D=L.prerender;D&&(x.setCustomLayerDefaults(),P.setColorMode(x.colorModeForRenderPass()),D.call(L,P.gl,x.transform.customLayerMatrix()),P.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),P.setColorMode(x.colorModeForRenderPass()),P.setStencilMode(An.disabled);const D=L.renderingMode==="3d"?new jt(x.context.gl.LEQUAL,jt.ReadWrite,x.depthRangeFor3D):x.depthModeForSublayer(0,jt.ReadOnly);P.setDepthMode(D),L.render(P.gl,x.transform.customLayerMatrix()),P.setDirty(),x.setBaseState(),P.bindFramebuffer.set(null)}})(o,0,p)}}translatePosMatrix(o,d,p,g,x){if(!p[0]&&!p[1])return o;const E=x?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(E){const L=Math.sin(E),D=Math.cos(E);p=[p[0]*D-p[1]*L,p[0]*L+p[1]*D]}const T=[x?p[0]:fe(d,p[0],this.transform.zoom),x?p[1]:fe(d,p[1],this.transform.zoom),0],P=new Float32Array(16);return l.translate(P,o,T),P}saveTileTexture(o){const d=this._tileTextures[o.size[0]];d?d.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const d=this.imageManager.getPattern(o.from.toString()),p=this.imageManager.getPattern(o.to.toString());return!d||!p}useProgram(o,d){this.cache=this.cache||{};const p=o+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Gs(this.context,uo[o],d,Lr[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Me(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:d}=this.context.gl;return this.width!==o||this.height!==d}}class vu{constructor(o,d){this.points=o,this.planes=d}static fromInvProjectionMatrix(o,d,p){const g=Math.pow(2,p),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const P=1/(T=l.transformMat4([],T,o))[3]/d*g;return l.mul$1(T,T,[P,P,1/T[3],P])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const P=function(H,ne){var ee=ne[0],re=ne[1],Q=ne[2],ge=ee*ee+re*re+Q*Q;return ge>0&&(ge=1/Math.sqrt(ge)),H[0]=ne[0]*ge,H[1]=ne[1]*ge,H[2]=ne[2]*ge,H}([],function(H,ne,ee){var re=ne[0],Q=ne[1],ge=ne[2],Ae=ee[0],le=ee[1],ye=ee[2];return H[0]=Q*ye-ge*le,H[1]=ge*Ae-re*ye,H[2]=re*le-Q*Ae,H}([],Ee([],x[T[0]],x[T[1]]),Ee([],x[T[2]],x[T[1]]))),L=-((D=P)[0]*(F=x[T[1]])[0]+D[1]*F[1]+D[2]*F[2]);var D,F;return P.concat(L)});return new vu(x,E)}}class sc{constructor(o,d){this.min=o,this.max=d,this.center=function(p,g,x){return p[0]=.5*g[0],p[1]=.5*g[1],p[2]=.5*g[2],p}([],function(p,g,x){return p[0]=g[0]+x[0],p[1]=g[1]+x[1],p[2]=g[2]+x[2],p}([],this.min,this.max))}quadrant(o){const d=[o%2==0,o<2],p=ae(this.min),g=ae(this.max);for(let x=0;x<d.length;x++)p[x]=d[x]?this.min[x]:this.center[x],g[x]=d[x]?this.center[x]:this.max[x];return g[2]=this.max[2],new sc(p,g)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let g=0;g<o.planes.length;g++){const x=o.planes[g];let E=0;for(let T=0;T<d.length;T++)l.dot(x,d[T])>=0&&E++;if(E===0)return 0;E!==d.length&&(p=!1)}if(p)return 2;for(let g=0;g<3;g++){let x=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let T=0;T<o.points.length;T++){const P=o.points[T][g]-this.min[g];x=Math.min(x,P),E=Math.max(E,P)}if(E<0||x>this.max[g]-this.min[g])return 0}return 1}}class xu{constructor(o=0,d=0,p=0,g=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=p,this.right=g}interpolate(o,d,p){return d.top!=null&&o.top!=null&&(this.top=l.interpolate.number(o.top,d.top,p)),d.bottom!=null&&o.bottom!=null&&(this.bottom=l.interpolate.number(o.bottom,d.bottom,p)),d.left!=null&&o.left!=null&&(this.left=l.interpolate.number(o.left,d.left,p)),d.right!=null&&o.right!=null&&(this.right=l.interpolate.number(o.right,d.right,p)),this}getCenter(o,d){const p=l.clamp((this.left+o-this.right)/2,0,o),g=l.clamp((this.top+d-this.bottom)/2,0,d);return new l.Point(p,g)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new xu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class bu{constructor(o,d,p,g,x){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=x===void 0||!!x,this._minZoom=o||0,this._maxZoom=d||22,this._minPitch=p??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new xu,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const o=new bu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this._minEleveationForCurrentTile=o._minEleveationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const d=-l.wrap(o,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var p=new l.ARRAY_TYPE(4);return l.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,g,x){var E=g[0],T=g[1],P=g[2],L=g[3],D=Math.sin(x),F=Math.cos(x);p[0]=E*F+P*D,p[1]=T*F+L*D,p[2]=E*-D+P*F,p[3]=T*-D+L*F}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const d=l.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const d=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,p){this._unmodified=!1,this._edgeInsets.interpolate(o,d,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const d=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(o){const d=[new l.UnwrappedTileID(0,o)];if(this._renderWorldCopies){const p=this.pointCoordinate(new l.Point(0,0)),g=this.pointCoordinate(new l.Point(this.width,0)),x=this.pointCoordinate(new l.Point(this.width,this.height)),E=this.pointCoordinate(new l.Point(0,this.height)),T=Math.floor(Math.min(p.x,g.x,x.x,E.x)),P=Math.floor(Math.max(p.x,g.x,x.x,E.x)),L=1;for(let D=T-L;D<=P+L;D++)D!==0&&d.push(new l.UnwrappedTileID(D,o))}return d}coveringTiles(o){var d,p;let g=this.coveringZoomLevel(o);const x=g;if(o.minzoom!==void 0&&g<o.minzoom)return[];o.maxzoom!==void 0&&g>o.maxzoom&&(g=o.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),T=l.MercatorCoordinate.fromLngLat(this.center),P=Math.pow(2,g),L=[P*E.x,P*E.y,0],D=[P*T.x,P*T.y,0],F=vu.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let H=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(H=g);const ne=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,ee=le=>({aabb:new sc([le*P,0,0],[(le+1)*P,P,0]),zoom:0,x:0,y:0,wrap:le,fullyVisible:!1}),re=[],Q=[],ge=g,Ae=o.reparseOverscaled?x:g;if(this._renderWorldCopies)for(let le=1;le<=3;le++)re.push(ee(-le)),re.push(ee(le));for(re.push(ee(0));re.length>0;){const le=re.pop(),ye=le.x,Ce=le.y;let Ie=le.fullyVisible;if(!Ie){const ht=le.aabb.intersects(F);if(ht===0)continue;Ie=ht===2}const Oe=o.terrain?L:D,Ge=le.aabb.distanceX(Oe),Ne=le.aabb.distanceY(Oe),He=Math.max(Math.abs(Ge),Math.abs(Ne));if(le.zoom===ge||He>ne+(1<<ge-le.zoom)-2&&le.zoom>=H){const ht=ge-le.zoom,kt=L[0]-.5-(ye<<ht),Ke=L[1]-.5-(Ce<<ht);Q.push({tileID:new l.OverscaledTileID(le.zoom===ge?Ae:le.zoom,le.wrap,le.zoom,ye,Ce),distanceSq:Le([D[0]-.5-ye,D[1]-.5-Ce]),tileDistanceToCamera:Math.sqrt(kt*kt+Ke*Ke)})}else for(let ht=0;ht<4;ht++){const kt=(ye<<1)+ht%2,Ke=(Ce<<1)+(ht>>1),yt=le.zoom+1;let ct=le.aabb.quadrant(ht);if(o.terrain){const Pn=new l.OverscaledTileID(yt,le.wrap,yt,kt,Ke),zt=o.terrain.getMinMaxElevation(Pn),xt=(d=zt.minElevation)!==null&&d!==void 0?d:this.elevation,Nt=(p=zt.maxElevation)!==null&&p!==void 0?p:this.elevation;ct=new sc([ct.min[0],ct.min[1],xt],[ct.max[0],ct.max[1],Nt])}re.push({aabb:ct,zoom:yt,x:kt,y:Ke,wrap:le.wrap,fullyVisible:Ie})}}return Q.sort((le,ye)=>le.distanceSq-ye.distanceSq).map(le=>le.tileID)}resize(o,d){this.width=o,this.height=d,this.pixelsToGLUnits=[2/o,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const d=l.clamp(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.Point(l.mercatorXfromLng(o.lng)*this.worldSize,l.mercatorYfromLat(d)*this.worldSize)}unproject(o){return new l.MercatorCoordinate(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const d=this.pointLocation(this.centerPoint,o),p=o.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-p))return;const g=this.getCameraPosition(),x=l.MercatorCoordinate.fromLngLat(g.lngLat,g.altitude),E=l.MercatorCoordinate.fromLngLat(d,p),T=x.x-E.x,P=x.y-E.y,L=x.z-E.z,D=Math.sqrt(T*T+P*P+L*L),F=this.scaleZoom(this.cameraToCenterDistance/D/this.tileSize);this._elevation=p,this._center=d,this.zoom=F}setLocationAtPoint(o,d){const p=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(o),E=new l.MercatorCoordinate(x.x-(p.x-g.x),x.y-(p.y-g.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,d){return d?this.coordinatePoint(this.locationCoordinate(o),d.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,d){return this.coordinateLocation(this.pointCoordinate(o,d))}locationCoordinate(o){return l.MercatorCoordinate.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,d){if(d){const H=d.pointCoordinate(o);if(H!=null)return H}const p=[o.x,o.y,0,1],g=[o.x,o.y,1,1];l.transformMat4(p,p,this.pixelMatrixInverse),l.transformMat4(g,g,this.pixelMatrixInverse);const x=p[3],E=g[3],T=p[1]/x,P=g[1]/E,L=p[2]/x,D=g[2]/E,F=L===D?0:(0-L)/(D-L);return new l.MercatorCoordinate(l.interpolate.number(p[0]/x,g[0]/E,F)/this.worldSize,l.interpolate.number(T,P,F)/this.worldSize)}coordinatePoint(o,d=0,p=this.pixelMatrix){const g=[o.x*this.worldSize,o.y*this.worldSize,d,1];return l.transformMat4(g,g,p),new l.Point(g[0]/g[3],g[1]/g[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new Zt().extend(this.pointLocation(new l.Point(0,o))).extend(this.pointLocation(new l.Point(this.width,o))).extend(this.pointLocation(new l.Point(this.width,this.height))).extend(this.pointLocation(new l.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Zt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(o,d=!1){const p=o.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[p])return g[p];const x=o.canonical,E=this.worldSize/this.zoomScale(x.z),T=x.x+Math.pow(2,x.z)*o.wrap,P=l.identity(new Float64Array(16));return l.translate(P,P,[T*E,x.y*E,0]),l.scale(P,P,[E/l.EXTENT,E/l.EXTENT,1]),l.multiply(P,d?this.alignedProjMatrix:this.projMatrix,P),g[p]=new Float32Array(P),g[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,d,p,g,x=-90,E=90,T=-180,P=180;const L=this.size,D=this._unmodified;if(this.latRange){const ne=this.latRange;x=l.mercatorYfromLat(ne[1])*this.worldSize,E=l.mercatorYfromLat(ne[0])*this.worldSize,o=E-x<L.y?L.y/(E-x):0}if(this.lngRange){const ne=this.lngRange;T=l.wrap(l.mercatorXfromLng(ne[0])*this.worldSize,0,this.worldSize),P=l.wrap(l.mercatorXfromLng(ne[1])*this.worldSize,0,this.worldSize),P<T&&(P+=this.worldSize),d=P-T<L.x?L.x/(P-T):0}const F=this.point,H=Math.max(d||0,o||0);if(H)return this.center=this.unproject(new l.Point(d?(P+T)/2:F.x,o?(E+x)/2:F.y)),this.zoom+=this.scaleZoom(H),this._unmodified=D,void(this._constraining=!1);if(this.latRange){const ne=F.y,ee=L.y/2;ne-ee<x&&(g=x+ee),ne+ee>E&&(g=E-ee)}if(this.lngRange){const ne=(T+P)/2,ee=l.wrap(F.x,ne-this.worldSize/2,ne+this.worldSize/2),re=L.x/2;ee-re<T&&(p=T+re),ee+re>P&&(p=P-re)}p===void 0&&g===void 0||(this.center=this.unproject(new l.Point(p!==void 0?p:F.x,g!==void 0?g:F.y)).wrap()),this._unmodified=D,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,d=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let g=l.identity(new Float64Array(16));l.scale(g,g,[this.width/2,-this.height/2,1]),l.translate(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=l.identity(new Float64Array(16)),l.scale(g,g,[1,-1,1]),l.translate(g,g,[-1,-1,0]),l.scale(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const x=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),E=Math.min(this.elevation,this._minEleveationForCurrentTile),T=x-E*this._pixelPerMeter/Math.cos(this._pitch),P=E<0?T:x,L=Math.PI/2+this._pitch,D=this._fov*(.5+o.y/this.height),F=Math.sin(D)*P/Math.sin(l.clamp(Math.PI-L-D,.01,Math.PI-.01)),H=this.getHorizon(),ne=2*Math.atan(H/this.cameraToCenterDistance)*(.5+o.y/(2*H)),ee=Math.sin(ne)*P/Math.sin(l.clamp(Math.PI-L-ne,.01,Math.PI-.01)),re=Math.min(F,ee),Q=1.01*(Math.cos(Math.PI/2-this._pitch)*re+P),ge=this.height/50;g=new Float64Array(16),l.perspective(g,this._fov,this.width/this.height,ge,Q),g[8]=2*-o.x/this.width,g[9]=2*o.y/this.height,l.scale(g,g,[1,-1,1]),l.translate(g,g,[0,0,-this.cameraToCenterDistance]),l.rotateX(g,g,this._pitch),l.rotateZ(g,g,this.angle),l.translate(g,g,[-d,-p,0]),this.mercatorMatrix=l.scale([],g,[this.worldSize,this.worldSize,this.worldSize]),l.scale(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,g),l.translate(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=l.invert([],g),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,g);const Ae=this.width%2/2,le=this.height%2/2,ye=Math.cos(this.angle),Ce=Math.sin(this.angle),Ie=d-Math.round(d)+ye*Ae+Ce*le,Oe=p-Math.round(p)+ye*le+Ce*Ae,Ge=new Float64Array(g);if(l.translate(Ge,Ge,[Ie>.5?Ie-1:Ie,Oe>.5?Oe-1:Oe,0]),this.alignedProjMatrix=Ge,g=l.invert(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new l.Point(0,0)),d=[o.x*this.worldSize,o.y*this.worldSize,0,1];return l.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.Point(0,o))}getCameraQueryGeometry(o){const d=this.getCameraPoint();if(o.length===1)return[o[0],d];{let p=d.x,g=d.y,x=d.x,E=d.y;for(const T of o)p=Math.min(p,T.x),g=Math.min(g,T.y),x=Math.max(x,T.x),E=Math.max(E,T.y);return[new l.Point(p,g),new l.Point(x,g),new l.Point(x,E),new l.Point(p,E),new l.Point(p,g)]}}}function jo(y,o){let d,p=!1,g=null,x=null;const E=()=>{g=null,p&&(y.apply(x,d),g=setTimeout(E,o),p=!1)};return(...T)=>(p=!0,x=this,d=T,g||E(),g)}class kp{constructor(o){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let p;return d.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(p=g)}),(p&&p[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:p,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=jo(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const d=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,g),E=Math.round(d.lng*x)/x,T=Math.round(d.lat*x)/x,P=this._map.getBearing(),L=this._map.getPitch();let D="";if(D+=o?`/${E}/${T}/${p}`:`${p}/${T}/${E}`,(P||L)&&(D+="/"+Math.round(10*P)/10),L&&(D+=`/${Math.round(L)}`),this._hashName){const F=this._hashName;let H=!1;const ne=window.location.hash.slice(1).split("&").map(ee=>{const re=ee.split("=")[0];return re===F?(H=!0,`${re}=${D}`):ee}).filter(ee=>ee);return H||ne.push(`${F}=${D}`),`#${ne.join("&")}`}return`#${D}`}}const oc={linearity:.3,easing:l.bezier(0,0,.3,1)},zp=l.extend({deceleration:2500,maxSpeed:1400},oc),Np=l.extend({deceleration:20,maxSpeed:1400},oc),Up=l.extend({deceleration:1e3,maxSpeed:360},oc),Gp=l.extend({deceleration:1e3,maxSpeed:90},oc);class ac{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.browser.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=l.browser.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new l.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)d.zoom+=x.zoomDelta||0,d.bearing+=x.bearingDelta||0,d.pitch+=x.pitchDelta||0,x.panDelta&&d.pan._add(x.panDelta),x.around&&(d.around=x.around),x.pinchAround&&(d.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(d.pan.mag()){const x=Dr(d.pan.mag(),p,l.extend({},zp,o||{}));g.offset=d.pan.mult(x.amount/d.pan.mag()),g.center=this._map.transform.center,lc(g,x)}if(d.zoom){const x=Dr(d.zoom,p,Np);g.zoom=this._map.transform.zoom+x.amount,lc(g,x)}if(d.bearing){const x=Dr(d.bearing,p,Up);g.bearing=this._map.transform.bearing+l.clamp(x.amount,-179,179),lc(g,x)}if(d.pitch){const x=Dr(d.pitch,p,Gp);g.pitch=this._map.transform.pitch+x.amount,lc(g,x)}if(g.zoom||g.bearing){const x=d.pinchAround===void 0?d.around:d.pinchAround;g.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),l.extend(g,{noMoveStart:!0})}}function lc(y,o){(!y.duration||y.duration<o.duration)&&(y.duration=o.duration,y.easing=o.easing)}function Dr(y,o,d){const{maxSpeed:p,linearity:g,deceleration:x}=d,E=l.clamp(y*g/(o/1e3),-p,p),T=Math.abs(E)/(x*g);return{easing:d.easing,duration:1e3*T,amount:E*(T/2)}}class ci extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,p,g={}){const x=v.mousePos(d.getCanvasContainer(),p),E=d.unproject(x);super(o,l.extend({point:x,lngLat:E,originalEvent:p},g)),this._defaultPrevented=!1,this.target=d}}class cc extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,p){const g=o==="touchend"?p.changedTouches:p.touches,x=v.touchPos(d.getCanvasContainer(),g),E=x.map(P=>d.unproject(P)),T=x.reduce((P,L,D,F)=>P.add(L.div(F.length)),new l.Point(0,0));super(o,{points:x,point:T,lngLats:E,lngLat:d.unproject(T),originalEvent:p}),this._defaultPrevented=!1}}class mo extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}}class uc{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new mo(o.type,this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new ci(o.type,this._map,o))}mouseup(o){this._map.fire(new ci(o.type,this._map,o))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new ci(o.type,this._map,o))}dblclick(o){return this._firePreventable(new ci(o.type,this._map,o))}mouseover(o){this._map.fire(new ci(o.type,this._map,o))}mouseout(o){this._map.fire(new ci(o.type,this._map,o))}touchstart(o){return this._firePreventable(new cc(o.type,this._map,o))}touchmove(o){this._map.fire(new cc(o.type,this._map,o))}touchend(o){this._map.fire(new cc(o.type,this._map,o))}touchcancel(o){this._map.fire(new cc(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ay{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new ci(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ci("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new ci(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hc{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(l.Point.convert(o),this._map.terrain)}}class ly{constructor(o,d){this._map=o,this._tr=new hc(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&o.button===0&&(v.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const p=d;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=p,this._box||(this._box=v.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const x=Math.min(g.x,p.x),E=Math.max(g.x,p.x),T=Math.min(g.y,p.y),P=Math.max(g.y,p.y);v.setTransform(this._box,`translate(${x}px,${T}px)`),this._box.style.width=E-x+"px",this._box.style.height=P-T+"px"}mouseupWindow(o,d){if(!this._active||o.button!==0)return;const p=this._startPos,g=d;if(this.reset(),v.suppressClick(),p.x!==g.x||p.y!==g.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:x=>x.fitScreenCoordinates(p,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(v.remove(this._box),this._box=null),v.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new l.Event(o,{originalEvent:d}))}}function wu(y,o){if(y.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${o.length}`);const d={};for(let p=0;p<y.length;p++)d[y[p].identifier]=o[p];return d}class dc{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,d,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(g){const x=new l.Point(0,0);for(const E of g)x._add(E);return x.div(g.length)}(d),this.touches=wu(p,d)))}touchmove(o,d,p){if(this.aborted||!this.centroid)return;const g=wu(p,d);for(const x in this.touches){const E=g[x];(!E||E.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(o,d,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Vs{constructor(o){this.singleTap=new dc(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,d,p){this.singleTap.touchstart(o,d,p)}touchmove(o,d,p){this.singleTap.touchmove(o,d,p)}touchend(o,d,p){const g=this.singleTap.touchend(o,d,p);if(g){const x=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(g)<30;if(x&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class rt{constructor(o){this._tr=new hc(o),this._zoomIn=new Vs({numTouches:1,numTaps:2}),this._zoomOut=new Vs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,p){this._zoomIn.touchstart(o,d,p),this._zoomOut.touchstart(o,d,p)}touchmove(o,d,p){this._zoomIn.touchmove(o,d,p),this._zoomOut.touchmove(o,d,p)}touchend(o,d,p){const g=this._zoomIn.touchend(o,d,p),x=this._zoomOut.touchend(o,d,p),E=this._tr;return g?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(g)},{originalEvent:o})}):x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(x)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sl{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const d=this._moveFunction(...o);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(o,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,d){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const g=d.length?d[0]:d;return!this._moved&&g.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(p,g))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&v.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const fc={0:1,2:2};class ya{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const d=v.mouseButton(o);this._eventButton=d}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(d,p){const g=fc[p];return d.buttons===void 0||(d.buttons&g)!==g}(o,this._eventButton)}isValidEndEvent(o){return v.mouseButton(o)===this._eventButton}}class pd{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const Qe=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(o){o.preventDefault()}},Au=({enable:y,clickTolerance:o,bearingDegreesPerPixelMoved:d=.8})=>{const p=new ya({checkCorrectEvent:g=>v.mouseButton(g)===0&&g.ctrlKey||v.mouseButton(g)===2});return new sl({clickTolerance:o,move:(g,x)=>({bearingDelta:(x.x-g.x)*d}),moveStateManager:p,enable:y,assignEvents:Qe})},Vp=({enable:y,clickTolerance:o,pitchDegreesPerPixelMoved:d=-.5})=>{const p=new ya({checkCorrectEvent:g=>v.mouseButton(g)===0&&g.ctrlKey||v.mouseButton(g)===2});return new sl({clickTolerance:o,move:(g,x)=>({pitchDelta:(x.y-g.y)*d}),moveStateManager:p,enable:y,assignEvents:Qe})};class cy{constructor(o,d){this._minTouches=o.cooperativeGestures?2:1,this._clickTolerance=o.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(o,d,p){return this._calculateTransform(o,d,p)}touchmove(o,d,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(o,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,d,p)}touchend(o,d,p){this._calculateTransform(o,d,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,p){p.length>0&&(this._active=!0);const g=wu(p,d),x=new l.Point(0,0),E=new l.Point(0,0);let T=0;for(const L in g){const D=g[L],F=this._touches[L];F&&(x._add(D),E._add(D.sub(F)),T++,g[L]=D)}if(this._touches=g,T<this._minTouches||!E.mag())return;const P=E.div(T);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(T),panDelta:P}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,d,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,p){if(!this._firstTwoTouches)return;o.preventDefault();const[g,x]=this._firstTwoTouches,E=mc(p,d,g),T=mc(p,d,x);if(!E||!T)return;const P=this._aroundCenter?null:E.add(T).div(2);return this._move([E,T],P,o)}touchend(o,d,p){if(!this._firstTwoTouches)return;const[g,x]=this._firstTwoTouches,E=mc(p,d,g),T=mc(p,d,x);E&&T||(this._active&&v.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function mc(y,o,d){for(let p=0;p<y.length;p++)if(y[p].identifier===d)return o[p]}function md(y,o){return Math.log(y/o)/Math.LN2}class uy extends pc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(md(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:md(this._distance,p),pinchAround:d}}}function jp(y,o){return 180*y.angleWith(o)/Math.PI}class gd extends pc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d){const p=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:jp(this._vector,p),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,p=jp(o,this._startVector);return Math.abs(p)<d}}function gc(y){return Math.abs(y.y)>Math.abs(y.x)}class _d extends pc{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,d,p){super.touchstart(o,d,p),this._currentTouchCount=p.length}_start(o){this._lastPoints=o,gc(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const g=o[0].sub(this._lastPoints[0]),x=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,x,p.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(g.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(o,d,p){if(this._valid!==void 0)return this._valid;const g=o.mag()>=2,x=d.mag()>=2;if(!g&&!x)return;if(!g||!x)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=o.y>0==d.y>0;return gc(o)&&gc(d)&&E}}const yd={panStep:100,bearingStep:15,pitchStep:10};class fr{constructor(o){this._tr=new hc(o);const d=yd;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,p=0,g=0,x=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),x=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),x=1);break;case 38:o.shiftKey?g=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?g=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,g=0),{cameraAnimation:T=>{const P=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:Ho,zoom:d?Math.round(P.zoom)+d*(o.shiftKey?2:1):P.zoom,bearing:P.bearing+p*this._bearingStep,pitch:P.pitch+g*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:P.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ho(y){return y*(2-y)}const vd=4.000244140625;class xd{constructor(o,d){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=o,this._tr=new hc(o),this._el=o.getCanvasContainer(),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!o[this._map._metaKey])return;o.preventDefault()}let d=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=l.browser.now(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,d!==0&&d%vd==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=v.mousePos(this._el,o),p=this._tr;this._around=l.LngLat.convert(this._aroundCenter?p.center:p.unproject(d)),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>vd?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&P!==0&&(P=1/P);const L=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(L*P))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,p=this._startZoom,g=this._easing;let x,E=!1;if(this._type==="wheel"&&p&&g){const T=Math.min((l.browser.now()-this._lastWheelEventTime)/200,1),P=g(T);x=l.interpolate.number(p,d,P),T<1?this._frameId||(this._frameId=!0):E=!0}else x=d,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:x-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=l.defaultEasing;if(this._prevEase){const p=this._prevEase,g=(l.browser.now()-p.start)/p.duration,x=p.easing(g+.01)-p.easing(g),E=.27/Math.sqrt(x*x+1e-4)*.01,T=Math.sqrt(.0729-E*E);d=l.bezier(E,T,.25,1)}return this._prevEase={start:l.browser.now(),duration:o,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class bd{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class wd{constructor(o){this._tr=new hc(o),this.reset()}reset(){this._active=!1}dblclick(o,d){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hp{constructor(){this._tap=new Vs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,d,p){if(!this._swipePoint)if(this._tapTime){const g=d[0],x=o.timeStamp-this._tapTime<500,E=this._tapPoint.dist(g)<30;x&&E?p.length>0&&(this._swipePoint=g,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(o,d,p)}touchmove(o,d,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const g=d[0],x=g.y-this._swipePoint.y;return this._swipePoint=g,o.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(o,d,p)}touchend(o,d,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const g=this._tap.touchend(o,d,p);g&&(this._tapTime=o.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qr{constructor(o,d,p){this._el=o,this._mousePan=d,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class In{constructor(o,d,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=d,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Eu{constructor(o,d,p,g){this._el=o,this._touchZoom=d,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ol=y=>y.zoom||y.drag||y.pitch||y.rotate;class Wp extends l.Event{}function Tu(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class qp{constructor(o,d){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,x)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=g.type==="renderFrame"?void 0:g,T={needsRenderFrame:!1},P={},L={},D=g.touches,F=D?this._getMapTouches(D):void 0,H=F?v.touchPos(this._el,F):v.mousePos(this._el,g);for(const{handlerName:re,handler:Q,allowed:ge}of this._handlers){if(!Q.isEnabled())continue;let Ae;this._blockedByActive(L,ge,re)?Q.reset():Q[x||g.type]&&(Ae=Q[x||g.type](g,H,F),this.mergeHandlerResult(T,P,Ae,re,E),Ae&&Ae.needsRenderFrame&&this._triggerRenderFrame()),(Ae||Q.isActive())&&(L[re]=Q)}const ne={};for(const re in this._previousActiveHandlers)L[re]||(ne[re]=E);this._previousActiveHandlers=L,(Object.keys(ne).length||Tu(T))&&(this._changes.push([T,P,ne]),this._triggerRenderFrame()),(Object.keys(L).length||Tu(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=T;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ac(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,x,E]of this._listeners)v.addEventListener(g,x,g===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,d,p]of this._listeners)v.removeEventListener(o,d,o===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(o){const d=this._map,p=d.getCanvasContainer();this._add("mapEvent",new uc(d,o));const g=d.boxZoom=new ly(d,o);this._add("boxZoom",g),o.interactive&&o.boxZoom&&g.enable();const x=new rt(d),E=new wd(d);d.doubleClickZoom=new bd(E,x),this._add("tapZoom",x),this._add("clickZoom",E),o.interactive&&o.doubleClickZoom&&d.doubleClickZoom.enable();const T=new Hp;this._add("tapDragZoom",T);const P=d.touchPitch=new _d(d);this._add("touchPitch",P),o.interactive&&o.touchPitch&&d.touchPitch.enable(o.touchPitch);const L=Au(o),D=Vp(o);d.dragRotate=new In(o,L,D),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]),o.interactive&&o.dragRotate&&d.dragRotate.enable();const F=(({enable:ge,clickTolerance:Ae})=>{const le=new ya({checkCorrectEvent:ye=>v.mouseButton(ye)===0&&!ye.ctrlKey});return new sl({clickTolerance:Ae,move:(ye,Ce)=>({around:Ce,panDelta:Ce.sub(ye)}),activateOnStart:!0,moveStateManager:le,enable:ge,assignEvents:Qe})})(o),H=new cy(o,d);d.dragPan=new Qr(p,F,H),this._add("mousePan",F),this._add("touchPan",H,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&d.dragPan.enable(o.dragPan);const ne=new gd,ee=new uy;d.touchZoomRotate=new Eu(p,ee,ne,T),this._add("touchRotate",ne,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&d.touchZoomRotate.enable(o.touchZoomRotate);const re=d.scrollZoom=new xd(d,()=>this._triggerRenderFrame());this._add("scrollZoom",re,["mousePan"]),o.interactive&&o.scrollZoom&&d.scrollZoom.enable(o.scrollZoom);const Q=d.keyboard=new fr(d);this._add("keyboard",Q),o.interactive&&o.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new ay(d))}_add(o,d,p){this._handlers.push({handlerName:o,handler:d,allowed:p}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ol(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,d,p){for(const g in o)if(g!==p&&(!d||d.indexOf(g)<0))return!0;return!1}_getMapTouches(o){const d=[];for(const p of o)this._el.contains(p.target)&&d.push(p);return d}mergeHandlerResult(o,d,p,g,x){if(!p)return;l.extend(o,p);const E={handlerName:g,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(d.zoom=E),p.panDelta!==void 0&&(d.drag=E),p.pitchDelta!==void 0&&(d.pitch=E),p.bearingDelta!==void 0&&(d.rotate=E)}_applyChanges(){const o={},d={},p={};for(const[g,x,E]of this._changes)g.panDelta&&(o.panDelta=(o.panDelta||new l.Point(0,0))._add(g.panDelta)),g.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(o.around=g.around),g.pinchAround!==void 0&&(o.pinchAround=g.pinchAround),g.noInertia&&(o.noInertia=g.noInertia),l.extend(d,x),l.extend(p,E);this._updateMapTransform(o,d,p),this._changes=[]}_updateMapTransform(o,d,p){const g=this._map,x=g._getTransformForUpdate(),E=g.terrain;if(!(Tu(o)||E&&this._terrainMovement))return this._fireEvents(d,p,!0);let{panDelta:T,zoomDelta:P,bearingDelta:L,pitchDelta:D,around:F,pinchAround:H}=o;H!==void 0&&(F=H),g._stop(!0),F=F||g.transform.centerPoint;const ne=x.pointLocation(T?F.sub(T):F);L&&(x.bearing+=L),D&&(x.pitch+=D),P&&(x.zoom+=P),E?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?x.center=x.pointLocation(x.centerPoint.sub(T)):x.setLocationAtPoint(ne,F):(this._terrainMovement=!0,this._map._elevationFreeze=!0,x.setLocationAtPoint(ne,F),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,x.recalculateZoom(g.terrain)})):x.setLocationAtPoint(ne,F),g._applyUpdatedTransform(x),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,p,!0)}_fireEvents(o,d,p){const g=ol(this._eventsInProgress),x=ol(o),E={};for(const D in o){const{originalEvent:F}=o[D];this._eventsInProgress[D]||(E[`${D}start`]=F),this._eventsInProgress[D]=o[D]}!g&&x&&this._fireEvent("movestart",x.originalEvent);for(const D in E)this._fireEvent(D,E[D]);x&&this._fireEvent("move",x.originalEvent);for(const D in o){const{originalEvent:F}=o[D];this._fireEvent(D,F)}const T={};let P;for(const D in this._eventsInProgress){const{handlerName:F,originalEvent:H}=this._eventsInProgress[D];this._handlersById[F].isActive()||(delete this._eventsInProgress[D],P=d[F]||H,T[`${D}end`]=P)}for(const D in T)this._fireEvent(D,T[D]);const L=ol(this._eventsInProgress);if(p&&(g||x)&&!L){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;!D||!D.essential&&l.browser.prefersReducedMotion?(this._map.fire(new l.Event("moveend",{originalEvent:P})),F(this._map.getBearing())&&this._map.resetNorth()):(F(D.bearing||this._map.getBearing())&&(D.bearing=0),D.freezeElevation=!0,this._map.easeTo(D,{originalEvent:P})),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new l.Event(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Wp("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class hy extends l.Evented{constructor(o,d){super(),this._renderFrameCallback=()=>{const p=Math.min((l.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}panBy(o,d,p){return o=l.Point.convert(o).mult(-1),this.panTo(this.transform.center,l.extend({offset:o},d),p)}panTo(o,d,p){return this.easeTo(l.extend({center:o},d),p)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,p){return this.easeTo(l.extend({zoom:o},d),p)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,p){return this.easeTo(l.extend({bearing:o},d),p)}resetNorth(o,d){return this.rotateTo(0,l.extend({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}cameraForBounds(o,d){o=Zt.convert(o);const p=d&&d.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),p,d)}_cameraForBoxAndBearing(o,d,p,g){const x={top:0,bottom:0,right:0,left:0};if(typeof(g=l.extend({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const Ce=g.padding;g.padding={top:Ce,bottom:Ce,right:Ce,left:Ce}}g.padding=l.extend(x,g.padding);const E=this.transform,T=E.padding,P=E.project(l.LngLat.convert(o)),L=E.project(l.LngLat.convert(d)),D=P.rotate(-p*Math.PI/180),F=L.rotate(-p*Math.PI/180),H=new l.Point(Math.max(D.x,F.x),Math.max(D.y,F.y)),ne=new l.Point(Math.min(D.x,F.x),Math.min(D.y,F.y)),ee=H.sub(ne),re=(E.width-(T.left+T.right+g.padding.left+g.padding.right))/ee.x,Q=(E.height-(T.top+T.bottom+g.padding.top+g.padding.bottom))/ee.y;if(Q<0||re<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ge=Math.min(E.scaleZoom(E.scale*Math.min(re,Q)),g.maxZoom),Ae=l.Point.convert(g.offset),le=new l.Point((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(p*Math.PI/180),ye=Ae.add(le).mult(E.scale/E.zoomScale(ge));return{center:E.unproject(P.add(L).div(2).sub(ye)),zoom:ge,bearing:p}}fitBounds(o,d,p){return this._fitInternal(this.cameraForBounds(o,d),d,p)}fitScreenCoordinates(o,d,p,g,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.Point.convert(o)),this.transform.pointLocation(l.Point.convert(d)),p,g),g,x)}_fitInternal(o,d,p){return o?(delete(d=l.extend(o,d)).padding,d.linear?this.easeTo(d,p):this.flyTo(d,p)):this}jumpTo(o,d){this.stop();const p=this._getTransformForUpdate();let g=!1,x=!1,E=!1;return"zoom"in o&&p.zoom!==+o.zoom&&(g=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=l.LngLat.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(x=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(E=!0,p.pitch=+o.pitch),o.padding==null||p.isPaddingEqual(o.padding)||(p.padding=o.padding),this._applyUpdatedTransform(p),this.fire(new l.Event("movestart",d)).fire(new l.Event("move",d)),g&&this.fire(new l.Event("zoomstart",d)).fire(new l.Event("zoom",d)).fire(new l.Event("zoomend",d)),x&&this.fire(new l.Event("rotatestart",d)).fire(new l.Event("rotate",d)).fire(new l.Event("rotateend",d)),E&&this.fire(new l.Event("pitchstart",d)).fire(new l.Event("pitch",d)).fire(new l.Event("pitchend",d)),this.fire(new l.Event("moveend",d))}calculateCameraOptionsFromTo(o,d,p,g=0){const x=l.MercatorCoordinate.fromLngLat(o,d),E=l.MercatorCoordinate.fromLngLat(p,g),T=E.x-x.x,P=E.y-x.y,L=E.z-x.z,D=Math.hypot(T,P,L);if(D===0)throw new Error("Can't calculate camera options with same From and To");const F=Math.hypot(T,P),H=this.transform.scaleZoom(this.transform.cameraToCenterDistance/D/this.transform.tileSize),ne=180*Math.atan2(T,-P)/Math.PI;let ee=180*Math.acos(F/D)/Math.PI;return ee=L<0?90-ee:90+ee,{center:E.toLngLat(),zoom:H,pitch:ee,bearing:ne}}easeTo(o,d){this._stop(!1,o.easeId),((o=l.extend({offset:[0,0],duration:500,easing:l.defaultEasing},o)).animate===!1||!o.essential&&l.browser.prefersReducedMotion)&&(o.duration=0);const p=this._getTransformForUpdate(),g=this.getZoom(),x=this.getBearing(),E=this.getPitch(),T=this.getPadding(),P="zoom"in o?+o.zoom:g,L="bearing"in o?this._normalizeBearing(o.bearing,x):x,D="pitch"in o?+o.pitch:E,F="padding"in o?o.padding:p.padding,H=l.Point.convert(o.offset);let ne=p.centerPoint.add(H);const ee=p.pointLocation(ne),re=l.LngLat.convert(o.center||ee);this._normalizeCenter(re);const Q=p.project(ee),ge=p.project(re).sub(Q),Ae=p.zoomScale(P-g);let le,ye;o.around&&(le=l.LngLat.convert(o.around),ye=p.locationPoint(le));const Ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||P!==g,this._rotating=this._rotating||x!==L,this._pitching=this._pitching||D!==E,this._padding=!p.isPaddingEqual(F),this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,Ce),this.terrain&&this._prepareElevation(re),this._ease(Ie=>{if(this._zooming&&(p.zoom=l.interpolate.number(g,P,Ie)),this._rotating&&(p.bearing=l.interpolate.number(x,L,Ie)),this._pitching&&(p.pitch=l.interpolate.number(E,D,Ie)),this._padding&&(p.interpolatePadding(T,F,Ie),ne=p.centerPoint.add(H)),this.terrain&&!o.freezeElevation&&this._updateElevation(Ie),le)p.setLocationAtPoint(le,ye);else{const Oe=p.zoomScale(p.zoom-g),Ge=P>g?Math.min(2,Ae):Math.max(.5,Ae),Ne=Math.pow(Ge,1-Ie),He=p.unproject(Q.add(ge.mult(Ie*Ne)).mult(Oe));p.setLocationAtPoint(p.renderWorldCopies?He.wrap():He,ne)}this._applyUpdatedTransform(p),this._fireMoveEvents(d)},Ie=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,Ie)},o),this}_prepareEase(o,d,p={}){this._moving=!0,d||p.moving||this.fire(new l.Event("movestart",o)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&d!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(p-(d-(p*o+this._elevationStart))/(1-o)),this._elevationTarget=d}this.transform.elevation=l.interpolate.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(o){if(!this.transformCameraUpdate)return;const d=o.clone(),{center:p,zoom:g,pitch:x,bearing:E,elevation:T}=this.transformCameraUpdate(d);p&&(d.center=p),g!==void 0&&(d.zoom=g),x!==void 0&&(d.pitch=x),E!==void 0&&(d.bearing=E),T!==void 0&&(d.elevation=T),this.transform.apply(d)}_fireMoveEvents(o){this.fire(new l.Event("move",o)),this._zooming&&this.fire(new l.Event("zoom",o)),this._rotating&&this.fire(new l.Event("rotate",o)),this._pitching&&this.fire(new l.Event("pitch",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const p=this._zooming,g=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",o)),g&&this.fire(new l.Event("rotateend",o)),x&&this.fire(new l.Event("pitchend",o)),this.fire(new l.Event("moveend",o))}flyTo(o,d){if(!o.essential&&l.browser.prefersReducedMotion){const ct=l.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ct,d)}this.stop(),o=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.defaultEasing},o);const p=this._getTransformForUpdate(),g=this.getZoom(),x=this.getBearing(),E=this.getPitch(),T=this.getPadding(),P="zoom"in o?l.clamp(+o.zoom,p.minZoom,p.maxZoom):g,L="bearing"in o?this._normalizeBearing(o.bearing,x):x,D="pitch"in o?+o.pitch:E,F="padding"in o?o.padding:p.padding,H=p.zoomScale(P-g),ne=l.Point.convert(o.offset);let ee=p.centerPoint.add(ne);const re=p.pointLocation(ee),Q=l.LngLat.convert(o.center||re);this._normalizeCenter(Q);const ge=p.project(re),Ae=p.project(Q).sub(ge);let le=o.curve;const ye=Math.max(p.width,p.height),Ce=ye/H,Ie=Ae.mag();if("minZoom"in o){const ct=l.clamp(Math.min(o.minZoom,g,P),p.minZoom,p.maxZoom),Pn=ye/p.zoomScale(ct-g);le=Math.sqrt(Pn/Ie*2)}const Oe=le*le;function Ge(ct){const Pn=(Ce*Ce-ye*ye+(ct?-1:1)*Oe*Oe*Ie*Ie)/(2*(ct?Ce:ye)*Oe*Ie);return Math.log(Math.sqrt(Pn*Pn+1)-Pn)}function Ne(ct){return(Math.exp(ct)-Math.exp(-ct))/2}function He(ct){return(Math.exp(ct)+Math.exp(-ct))/2}const ht=Ge(!1);let kt=function(ct){return He(ht)/He(ht+le*ct)},Ke=function(ct){return ye*((He(ht)*(Ne(Pn=ht+le*ct)/He(Pn))-Ne(ht))/Oe)/Ie;var Pn},yt=(Ge(!0)-ht)/le;if(Math.abs(Ie)<1e-6||!isFinite(yt)){if(Math.abs(ye-Ce)<1e-6)return this.easeTo(o,d);const ct=Ce<ye?-1:1;yt=Math.abs(Math.log(Ce/ye))/le,Ke=function(){return 0},kt=function(Pn){return Math.exp(ct*le*Pn)}}return o.duration="duration"in o?+o.duration:1e3*yt/("screenSpeed"in o?+o.screenSpeed/le:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=x!==L,this._pitching=D!==E,this._padding=!p.isPaddingEqual(F),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(Q),this._ease(ct=>{const Pn=ct*yt,zt=1/kt(Pn);p.zoom=ct===1?P:g+p.scaleZoom(zt),this._rotating&&(p.bearing=l.interpolate.number(x,L,ct)),this._pitching&&(p.pitch=l.interpolate.number(E,D,ct)),this._padding&&(p.interpolatePadding(T,F,ct),ee=p.centerPoint.add(ne)),this.terrain&&!o.freezeElevation&&this._updateElevation(ct);const xt=ct===1?Q:p.unproject(ge.add(Ae.mult(Ke(Pn))).mult(zt));p.setLocationAtPoint(p.renderWorldCopies?xt.wrap():xt,ee),this._applyUpdatedTransform(p),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,d)}if(!o){const p=this.handlers;p&&p.stop(!1)}return this}_ease(o,d,p){p.animate===!1||p.duration===0?(o(1),d()):(this._easeStart=l.browser.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,d){o=l.wrap(o,-180,180);const p=Math.abs(o-d);return Math.abs(o-360-d)<p&&(o-=360),Math.abs(o+360-d)<p&&(o+=360),o}_normalizeCenter(o){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const p=o.lng-d.center.lng;o.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(l.LngLat.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}class ms{constructor(o={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options&&this.options.compact,this._container=v.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=v.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=v.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){v.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,d){const p=this._map._getUIString(`AttributionControl.${d}`);o.title=p,o.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const d=this._map.style.sourceCaches;for(const g in d){const x=d[g];if(x.used||x.usedForTerrain){const E=x.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o=o.filter(g=>String(g).trim()),o.sort((g,x)=>g.length-x.length),o=o.filter((g,x)=>{for(let E=x+1;E<o.length;E++)if(o[E].indexOf(g)>=0)return!1;return!0});const p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class _c{constructor(o={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const p=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=v.create("div","maplibregl-ctrl");const d=v.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){v.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class mt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,p=d?this._queue.concat(d):this._queue;for(const g of p)if(g.id===o)return void(g.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const p of d)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Tt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Su=l.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class Ad extends l.Evented{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,d){this.sourceCache.update(o,d),this._renderableTilesKeys=[];const p={};for(const g of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))p[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),l.ortho(g.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[g.key]=new zs(g,this.tileSize));for(const g in this._tiles)p[g]||delete this._tiles[g]}freeRtt(o){for(const d in this._tiles){const p=this._tiles[d];(!o||p.tileID.equals(o)||p.tileID.isChildOf(o)||o.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const d={};for(const p of this._renderableTilesKeys){const g=this._tiles[p].tileID;if(g.canonical.equals(o.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16),l.ortho(x.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),d[p]=x}else if(g.canonical.isChildOf(o.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16);const E=g.canonical.z-o.canonical.z,T=g.canonical.x-(g.canonical.x>>E<<E),P=g.canonical.y-(g.canonical.y>>E<<E),L=l.EXTENT>>E;l.ortho(x.posMatrix,0,L,0,L,0,1),l.translate(x.posMatrix,x.posMatrix,[-T*L,-P*L,0]),d[p]=x}else if(o.canonical.isChildOf(g.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16);const E=o.canonical.z-g.canonical.z,T=o.canonical.x-(o.canonical.x>>E<<E),P=o.canonical.y-(o.canonical.y>>E<<E),L=l.EXTENT>>E;l.ortho(x.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(x.posMatrix,x.posMatrix,[T*L,P*L,0]),l.scale(x.posMatrix,x.posMatrix,[1/2**E,1/2**E,0]),d[p]=x}}return d}getSourceTile(o,d){const p=this.sourceCache._source;let g=o.overscaledZ-this.deltaZoom;if(g>p.maxzoom&&(g=p.maxzoom),g<p.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(g).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!x||!x.dem)&&d)for(;g>=p.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(o.scaledTo(g--).key);return x}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=o)}}class Ed{constructor(o,d,p){this.painter=o,this.sourceCache=new Ad(d),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,d,p,g=l.EXTENT){var x;if(!(d>=0&&d<g&&p>=0&&p<g))return 0;const E=this.getTerrainData(o),T=(x=E.tile)===null||x===void 0?void 0:x.dem;if(!T)return 0;const P=function(ee,re,Q){var ge=re[0],Ae=re[1];return ee[0]=Q[0]*ge+Q[4]*Ae+Q[12],ee[1]=Q[1]*ge+Q[5]*Ae+Q[13],ee}([],[d/g*l.EXTENT,p/g*l.EXTENT],E.u_terrain_matrix),L=[P[0]*T.dim,P[1]*T.dim],D=Math.floor(L[0]),F=Math.floor(L[1]),H=L[0]-D,ne=L[1]-F;return T.get(D,F)*(1-H)*(1-ne)+T.get(D+1,F)*H*(1-ne)+T.get(D,F+1)*(1-H)*ne+T.get(D+1,F+1)*H*ne}getElevationForLngLatZoom(o,d){const{tileID:p,mercatorX:g,mercatorY:x}=this._getOverscaledTileIDFromLngLatZoom(o,d);return this.getElevation(p,g%l.EXTENT,x%l.EXTENT,l.EXTENT)}getElevation(o,d,p,g=l.EXTENT){return this.getDEMElevation(o,d,p,g)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const g=this.painter.context,x=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Me(g,x,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Me(g,new l.RGBAImage({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const d=this.sourceCache.getSourceTile(o,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const g=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new Me(g,d.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),d.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const p=d&&d+d.tileID.key+o.key;if(p&&!this._demMatrixCache[p]){const g=this.sourceCache.sourceCache._source.maxzoom;let x=o.canonical.z-d.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=g?x=o.canonical.z-g:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=o.canonical.x-(o.canonical.x>>x<<x),T=o.canonical.y-(o.canonical.y>>x<<x),P=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<x),1/(l.EXTENT<<x),0]);l.translate(P,P,[E*l.EXTENT,T*l.EXTENT,0]),this._demMatrixCache[o.key]={matrix:P,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(o){const d=this.painter,p=d.width/devicePixelRatio,g=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Me(d.context,{width:p,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Me(d.context,{width:p,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(p,g,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,p,g))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,E=0;x<this._coordsTextureSize;x++)for(let T=0;T<this._coordsTextureSize;T++,E+=4)d[E+0]=255&T,d[E+1]=255&x,d[E+2]=T>>8<<4|x>>8,d[E+3]=0;const p=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),g=new Me(o,p,o.gl.RGBA,{premultiply:!1});return g.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(o){const d=new Uint8Array(4),p=this.painter.context,g=p.gl;p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),p.bindFramebuffer.set(null);const x=d[0]+(d[2]>>4<<8),E=d[1]+((15&d[2])<<8),T=this.coordsIndex[255-d[3]],P=T&&this.sourceCache.getTileByID(T);if(!P)return null;const L=this._coordsTextureSize,D=(1<<P.tileID.canonical.z)*L;return new l.MercatorCoordinate((P.tileID.canonical.x*L+x)/D,(P.tileID.canonical.y*L+E)/D,this.getElevation(P.tileID,x,E,L))}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,d=new l.Pos3dArray,p=new l.TriangleIndexArray,g=this.meshSize,x=l.EXTENT/g,E=g*g;for(let F=0;F<=g;F++)for(let H=0;H<=g;H++)d.emplaceBack(H*x,F*x,0);for(let F=0;F<E;F+=g+1)for(let H=0;H<g;H++)p.emplaceBack(H+F,g+H+F+1,g+H+F+2),p.emplaceBack(H+F,g+H+F+2,H+F+1);const T=d.length,P=T+2*(g+1);for(const F of[0,1])for(let H=0;H<=g;H++)for(const ne of[0,1])d.emplaceBack(H*x,F*l.EXTENT,ne);for(let F=0;F<2*g;F+=2)p.emplaceBack(P+F,P+F+1,P+F+3),p.emplaceBack(P+F,P+F+3,P+F+2),p.emplaceBack(T+F,T+F+3,T+F+1),p.emplaceBack(T+F,T+F+2,T+F+3);const L=d.length,D=L+2*(g+1);for(const F of[0,1])for(let H=0;H<=g;H++)for(const ne of[0,1])d.emplaceBack(F*l.EXTENT,H*x,ne);for(let F=0;F<2*g;F+=2)p.emplaceBack(L+F,L+F+1,L+F+3),p.emplaceBack(L+F,L+F+3,L+F+2),p.emplaceBack(D+F,D+F+3,D+F+1),p.emplaceBack(D+F,D+F+2,D+F+3);return this._mesh={indexBuffer:o.createIndexBuffer(p),vertexBuffer:o.createVertexBuffer(d,Su.members),segments:l.SegmentVector.simpleSegment(0,0,d.length,p.length)},this._mesh}getMeshFrameDelta(o){return 2*Math.PI*l.earthRadius/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,d){var p;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(o,d);return(p=this.getMinMaxElevation(g).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(o){const d=this.getTerrainData(o).tile,p={minElevation:null,maxElevation:null};return d&&d.dem&&(p.minElevation=d.dem.min*this.exaggeration,p.maxElevation=d.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(o,d){const p=l.MercatorCoordinate.fromLngLat(o.wrap()),g=(1<<d)*l.EXTENT,x=p.x*g,E=p.y*g,T=Math.floor(x/l.EXTENT),P=Math.floor(E/l.EXTENT);return{tileID:new l.OverscaledTileID(d,0,d,T,P),mercatorX:x,mercatorY:E}}}class pr{constructor(o,d,p){this._context=o,this._size=d,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new Me(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(p.texture),{id:o,fbo:d,texture:p,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>o.id!==d),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}const va={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class js{constructor(o,d){this.painter=o,this.terrain=d,this.pool=new pr(o.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(p=>!o._layers[p].isHidden(d)),this._coordsDescendingInv={};for(const p in o.sourceCaches){this._coordsDescendingInv[p]={};const g=o.sourceCaches[p].getVisibleCoordinates();for(const x of g){const E=this.terrain.sourceCache.getTerrainCoords(x);for(const T in E)this._coordsDescendingInv[p][T]||(this._coordsDescendingInv[p][T]=[]),this._coordsDescendingInv[p][T].push(E[T])}}this._coordsDescendingInvStr={};for(const p of o._order){const g=o._layers[p],x=g.source;if(va[g.type]&&!this._coordsDescendingInvStr[x]){this._coordsDescendingInvStr[x]={};for(const E in this._coordsDescendingInv[x])this._coordsDescendingInvStr[x][E]=this._coordsDescendingInv[x][E].map(T=>T.key).sort().join()}}for(const p of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const x=this._coordsDescendingInvStr[g][p.tileID.key];x&&x!==p.rttCoords[g]&&(p.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const d=o.type,p=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(va[d]&&(this._prevType&&va[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(o.id),!g))return!0;if(va[this._prevType]||va[d]&&g){this._prevType=d;const x=this._stacks.length-1,E=this._stacks[x]||[];for(const T of this._renderableTiles){if(this.pool.isFull()&&(yu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(T),T.rtt[x]){const L=this.pool.getObjectForId(T.rtt[x].id);if(L.stamp===T.rtt[x].stamp){this.pool.useObject(L);continue}}const P=this.pool.getOrCreateFreeObject();this.pool.useObject(P),this.pool.stampObject(P),T.rtt[x]={id:P.id,stamp:P.stamp},p.context.bindFramebuffer.set(P.fbo.framebuffer),p.context.clear({color:l.Color.transparent,stencil:0}),p.currentStencilSource=void 0;for(let L=0;L<E.length;L++){const D=p.style._layers[E[L]],F=D.source?this._coordsDescendingInv[D.source][T.tileID.key]:[T.tileID];p.context.viewport.set([0,0,P.fbo.width,P.fbo.height]),p._renderTileClippingMasks(D,F),p.renderLayer(p,p.style.sourceCaches[D.source],D,F),D.source&&(T.rttCoords[D.source]=this._coordsDescendingInvStr[D.source][T.tileID.key])}}return yu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),va[d]}return!1}}const dy=_,yc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ln=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},ei={showCompass:!0,showZoom:!0,visualizePitch:!1};class Xp{constructor(o,d,p=!1){this.mousedown=E=>{this.startMouse(l.extend({},E,{ctrlKey:!0,preventDefault:()=>E.preventDefault()}),v.mousePos(this.element,E)),v.addEventListener(window,"mousemove",this.mousemove),v.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.moveMouse(E,v.mousePos(this.element,E))},this.mouseup=E=>{this.mouseRotate.dragEnd(E),this.mousePitch&&this.mousePitch.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=v.touchPos(this.element,E.targetTouches)[0],this.startTouch(E,this._startPos),v.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),v.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=v.touchPos(this.element,E.targetTouches)[0],this.moveTouch(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=o.dragRotate._mouseRotate.getClickTolerance(),x=o.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=Au({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:E,clickTolerance:T,bearingDegreesPerPixelMoved:P=.8})=>{const L=new pd;return new sl({clickTolerance:T,move:(D,F)=>({bearingDelta:(F.x-D.x)*P}),moveStateManager:L,enable:E,assignEvents:Ln})})({clickTolerance:g,enable:!0}),this.map=o,p&&(this.mousePitch=Vp({clickTolerance:x,enable:!0}),this.touchPitch=(({enable:E,clickTolerance:T,pitchDegreesPerPixelMoved:P=-.5})=>{const L=new pd;return new sl({clickTolerance:T,move:(D,F)=>({pitchDelta:(F.y-D.y)*P}),moveStateManager:L,enable:E,assignEvents:Ln})})({clickTolerance:x,enable:!0})),v.addEventListener(d,"mousedown",this.mousedown),v.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),v.addEventListener(d,"touchcancel",this.reset)}startMouse(o,d){this.mouseRotate.dragStart(o,d),this.mousePitch&&this.mousePitch.dragStart(o,d),v.disableDrag()}startTouch(o,d){this.touchRotate.dragStart(o,d),this.touchPitch&&this.touchPitch.dragStart(o,d),v.disableDrag()}moveMouse(o,d){const p=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(o,d)||{};if(g&&p.setBearing(p.getBearing()+g),this.mousePitch){const{pitchDelta:x}=this.mousePitch.dragMove(o,d)||{};x&&p.setPitch(p.getPitch()+x)}}moveTouch(o,d){const p=this.map,{bearingDelta:g}=this.touchRotate.dragMove(o,d)||{};if(g&&p.setBearing(p.getBearing()+g),this.touchPitch){const{pitchDelta:x}=this.touchPitch.dragMove(o,d)||{};x&&p.setPitch(p.getPitch()+x)}}off(){const o=this.element;v.removeEventListener(o,"mousedown",this.mousedown),v.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),v.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),v.removeEventListener(window,"touchend",this.touchend),v.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){v.enableDrag(),v.removeEventListener(window,"mousemove",this.mousemove),v.removeEventListener(window,"mouseup",this.mouseup),v.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),v.removeEventListener(window,"touchend",this.touchend)}}let es;function vc(y,o,d){if(y=new l.LngLat(y.lng,y.lat),o){const p=new l.LngLat(y.lng-360,y.lat),g=new l.LngLat(y.lng+360,y.lat),x=d.locationPoint(y).distSqr(o);d.locationPoint(p).distSqr(o)<x?y=p:d.locationPoint(g).distSqr(o)<x&&(y=g)}for(;Math.abs(y.lng-d.center.lng)>180;){const p=d.locationPoint(y);if(p.x>=0&&p.y>=0&&p.x<=d.width&&p.y<=d.height)break;y.lng>d.center.lng?y.lng-=360:y.lng+=360}return y}const xc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Cu(y,o,d){const p=y.classList;for(const g in xc)p.remove(`maplibregl-${d}-anchor-${g}`);p.add(`maplibregl-${d}-anchor-${o}`)}class bc extends l.Evented{constructor(o){if(super(),this._onKeyPress=d=>{const p=d.code,g=d.charCode||d.keyCode;p!=="Space"&&p!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=d=>{const p=d.originalEvent.target,g=this._element;this._popup&&(p===g||g.contains(p))&&this.togglePopup()},this._update=d=>{if(!this._map)return;const p=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!p)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=vc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),v.setTransform(this._element,`${xc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${g}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const E=this._map.unproject(this._pos),T=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=E.distanceTo(this._lngLat)>20*T?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=d=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=l.Point.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=v.create("div"),this._element.setAttribute("aria-label","Map marker");const d=v.createNS("http://www.w3.org/2000/svg","svg"),p=41,g=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${p}px`),d.setAttributeNS(null,"width",`${g}px`),d.setAttributeNS(null,"viewBox",`0 0 ${g} ${p}`);const x=v.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const E=v.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const T=v.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ge of P){const Ae=v.createNS("http://www.w3.org/2000/svg","ellipse");Ae.setAttributeNS(null,"opacity","0.04"),Ae.setAttributeNS(null,"cx","10.5"),Ae.setAttributeNS(null,"cy","5.80029008"),Ae.setAttributeNS(null,"rx",ge.rx),Ae.setAttributeNS(null,"ry",ge.ry),T.appendChild(Ae)}const L=v.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"fill",this._color);const D=v.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),L.appendChild(D);const F=v.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"opacity","0.25"),F.setAttributeNS(null,"fill","#000000");const H=v.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),F.appendChild(H);const ne=v.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ne.setAttributeNS(null,"fill","#FFFFFF");const ee=v.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");const re=v.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#000000"),re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962");const Q=v.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),ee.appendChild(re),ee.appendChild(Q),E.appendChild(T),E.appendChild(L),E.appendChild(F),E.appendChild(ne),E.appendChild(ee),d.appendChild(E),d.setAttributeNS(null,"height",p*this._scale+"px"),d.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(d),this._offset=l.Point.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),Cu(this._element,this._anchor,"marker"),o&&o.className)for(const d of o.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),v.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=l.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const g=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(o){return this._offset=l.Point.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const wc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let al=0,xa=!1;const Td={maxWidth:100,unit:"metric"};function Iu(y,o,d){const p=d&&d.maxWidth||100,g=y._container.clientHeight/2,x=y.unproject([0,g]),E=y.unproject([p,g]),T=x.distanceTo(E);if(d&&d.unit==="imperial"){const P=3.2808*T;P>5280?ba(o,p,P/5280,y._getUIString("ScaleControl.Miles")):ba(o,p,P,y._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?ba(o,p,T/1852,y._getUIString("ScaleControl.NauticalMiles")):T>=1e3?ba(o,p,T/1e3,y._getUIString("ScaleControl.Kilometers")):ba(o,p,T,y._getUIString("ScaleControl.Meters"))}function ba(y,o,d,p){const g=function(x){const E=Math.pow(10,`${Math.floor(x)}`.length-1);let T=x/E;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(P){const L=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*L)/L}(T),E*T}(d);y.style.width=o*(g/d)+"px",y.innerHTML=`${g}&nbsp;${p}`}const Sd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Cd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pu(y){if(y){if(typeof y=="number"){const o=Math.round(Math.abs(y)/Math.SQRT2);return{center:new l.Point(0,0),top:new l.Point(0,y),"top-left":new l.Point(o,o),"top-right":new l.Point(-o,o),bottom:new l.Point(0,-y),"bottom-left":new l.Point(o,-o),"bottom-right":new l.Point(-o,-o),left:new l.Point(y,0),right:new l.Point(-y,0)}}if(y instanceof l.Point||Array.isArray(y)){const o=l.Point.convert(y);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:l.Point.convert(y.center||[0,0]),top:l.Point.convert(y.top||[0,0]),"top-left":l.Point.convert(y["top-left"]||[0,0]),"top-right":l.Point.convert(y["top-right"]||[0,0]),bottom:l.Point.convert(y.bottom||[0,0]),"bottom-left":l.Point.convert(y["bottom-left"]||[0,0]),"bottom-right":l.Point.convert(y["bottom-right"]||[0,0]),left:l.Point.convert(y.left||[0,0]),right:l.Point.convert(y.right||[0,0])}}return Pu(new l.Point(0,0))}const Mu={extend:(y,...o)=>l.extend(y,...o),run(y){y()},logToElement(y,o=!1,d="log"){const p=window.document.getElementById(d);p&&(o&&(p.innerHTML=""),p.innerHTML+=`<br>${y}`)}},Id=_;class rn{static get version(){return Id}static get workerCount(){return Ri.workerCount}static set workerCount(o){Ri.workerCount=o}static get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(o){l.config.MAX_PARALLEL_IMAGE_REQUESTS=o}static get workerUrl(){return l.config.WORKER_URL}static set workerUrl(o){l.config.WORKER_URL=o}static addProtocol(o,d){l.config.REGISTERED_PROTOCOLS[o]=d}static removeProtocol(o){delete l.config.REGISTERED_PROTOCOLS[o]}}return rn.Map=class extends hy{constructor(y){if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(y=l.extend({},yc,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new bu(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._cooperativeGesturesOnWheel=o=>{this._onCooperativeGesture(o,o[this._metaKey],1)},this._contextLost=o=>{o.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._cooperativeGestures=y.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new mt,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},Tt,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=ue.addThrottleControl(()=>this.isMoving()),this._requestManager=new W(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const d=jo(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{o?d(p):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new qp(this,y),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=y.hash&&new kp(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,l.extend({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new ms({customAttribution:y.customAttribution})),y.maplibreLogo&&this.addControl(new _c,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new l.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new l.Event(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new l.Event("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(y,o){if(o===void 0&&(o=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=y.onAdd(this);this._controls.push(y);const p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(d,p.firstChild):p.appendChild(d),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(y);return o>-1&&this._controls.splice(o,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,o,d,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,o,d,p)}resize(y){var o;const d=this._containerDimensions(),p=d[0],g=d[1],x=this._getClampedPixelRatio(p,g);if(this._resizeCanvas(p,g,x),this.painter.resize(p,g,x),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const P=this._getClampedPixelRatio(p,g);this._resizeCanvas(p,g,P),this.painter.resize(p,g,P)}this.transform.resize(p,g),(o=this._requestedCameraState)===null||o===void 0||o.resize(p,g);const E=!this._moving;return E&&(this.stop(),this.fire(new l.Event("movestart",y)).fire(new l.Event("move",y))),this.fire(new l.Event("resize",y)),E&&this.fire(new l.Event("moveend",y)),this}_getClampedPixelRatio(y,o){const{0:d,1:p}=this._maxCanvasSize,g=this.getPixelRatio(),x=y*g,E=o*g;return Math.min(x>d?d/x:1,E>p?p/E:1)*g}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(Zt.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(y){return this._cooperativeGestures=y,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(y){return this.transform.locationPoint(l.LngLat.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(l.Point.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,o,d){if(y==="mouseenter"||y==="mouseover"){let p=!1;return{layer:o,listener:d,delegates:{mousemove:x=>{const E=this.getLayer(o)?this.queryRenderedFeatures(x.point,{layers:[o]}):[];E.length?p||(p=!0,d.call(this,new ci(y,this,x.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(y==="mouseleave"||y==="mouseout"){let p=!1;return{layer:o,listener:d,delegates:{mousemove:E=>{(this.getLayer(o)?this.queryRenderedFeatures(E.point,{layers:[o]}):[]).length?p=!0:p&&(p=!1,d.call(this,new ci(y,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,d.call(this,new ci(y,this,E.originalEvent)))}}}}{const p=g=>{const x=this.getLayer(o)?this.queryRenderedFeatures(g.point,{layers:[o]}):[];x.length&&(g.features=x,d.call(this,g),delete g.features)};return{layer:o,listener:d,delegates:{[y]:p}}}}on(y,o,d){if(d===void 0)return super.on(y,o);const p=this._createDelegatedListener(y,o,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(p);for(const g in p.delegates)this.on(g,p.delegates[g]);return this}once(y,o,d){if(d===void 0)return super.once(y,o);const p=this._createDelegatedListener(y,o,d);for(const g in p.delegates)this.once(g,p.delegates[g]);return this}off(y,o,d){return d===void 0?super.off(y,o):(this._delegatedListeners&&this._delegatedListeners[y]&&(p=>{const g=this._delegatedListeners[y];for(let x=0;x<g.length;x++){const E=g[x];if(E.layer===o&&E.listener===d){for(const T in E.delegates)this.off(T,E.delegates[T]);return g.splice(x,1),this}}})(),this)}queryRenderedFeatures(y,o){if(!this.style)return[];let d;const p=y instanceof l.Point||Array.isArray(y),g=p?y:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(p?{}:y)||{},g instanceof l.Point||typeof g[0]=="number")d=[l.Point.convert(g)];else{const x=l.Point.convert(g[0]),E=l.Point.convert(g[1]);d=[x,new l.Point(E.x,x.y),E,new l.Point(x.x,E.y),x]}return this.style.queryRenderedFeatures(d,o,this.transform)}querySourceFeatures(y,o){return this.style.querySourceFeatures(y,o)}setStyle(y,o){return(o=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(y,o))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const o=this._locale[y];if(o==null)throw new Error(`Missing UI string '${y}'`);return o}_updateStyle(y,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,o));const d=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Yn(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,o,d):this.style.loadJSON(y,o,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Yn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,o){if(typeof y=="string"){const d=this._requestManager.transformRequest(y,j.Style);l.getJSON(d,(p,g)=>{p?this.fire(new l.ErrorEvent(p)):g&&this._updateDiff(g,o)})}else typeof y=="object"&&this._updateDiff(y,o)}_updateDiff(y,o){try{this.style.setState(y,o)&&this._update(!0)}catch(d){l.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(y,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(y,o){return this._lazyInitEmptyStyle(),this.style.addSource(y,o),this._update(!0)}isSourceLoaded(y){const o=this.style&&this.style.sourceCaches[y];if(o!==void 0)return o.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const o=this.style.sourceCaches[y.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);for(const d in this.style._layers){const p=this.style._layers[d];p.type==="hillshade"&&p.source===y.source&&l.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ed(this.painter,o,y),this.painter.renderToTexture=new js(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==y.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.Event("terrain",{terrain:y})),this}getTerrain(){var y,o;return(o=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const o in y){const d=y[o]._tiles;for(const p in d){const g=d[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}addSourceType(y,o,d){return this._lazyInitEmptyStyle(),this.style.addSourceType(y,o,d)}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,o,d={}){const{pixelRatio:p=1,sdf:g=!1,stretchX:x,stretchY:E,content:T}=d;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||l.isImageBitmap(o))){if(o.width===void 0||o.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:P,height:L,data:D}=o,F=o;return this.style.addImage(y,{data:new l.RGBAImage({width:P,height:L},new Uint8Array(D)),pixelRatio:p,stretchX:x,stretchY:E,content:T,sdf:g,version:0,userImage:F}),F.onAdd&&F.onAdd(this,y),this}}{const{width:P,height:L,data:D}=l.browser.getImageData(o);this.style.addImage(y,{data:new l.RGBAImage({width:P,height:L},D),pixelRatio:p,stretchX:x,stretchY:E,content:T,sdf:g,version:0})}}updateImage(y,o){const d=this.style.getImage(y);if(!d)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=o instanceof HTMLImageElement||l.isImageBitmap(o)?l.browser.getImageData(o):o,{width:g,height:x,data:E}=p;if(g===void 0||x===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==d.data.width||x!==d.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(o instanceof HTMLImageElement||l.isImageBitmap(o));return d.data.replace(E,T),this.style.updateImage(y,d),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,o){ue.getImage(this._requestManager.transformRequest(y,j.Image),o)}listImages(){return this.style.listImages()}addLayer(y,o){return this._lazyInitEmptyStyle(),this.style.addLayer(y,o),this._update(!0)}moveLayer(y,o){return this.style.moveLayer(y,o),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}setLayerZoomRange(y,o,d){return this.style.setLayerZoomRange(y,o,d),this._update(!0)}setFilter(y,o,d={}){return this.style.setFilter(y,o,d),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,o,d,p={}){return this.style.setPaintProperty(y,o,d,p),this._update(!0)}getPaintProperty(y,o){return this.style.getPaintProperty(y,o)}setLayoutProperty(y,o,d,p={}){return this.style.setLayoutProperty(y,o,d,p),this._update(!0)}getLayoutProperty(y,o){return this.style.getLayoutProperty(y,o)}setGlyphs(y,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,o,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,o,d,p=>{p||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,o,d=>{d||this._update(!0)}),this}setLight(y,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,o){return this.style.setFeatureState(y,o),this._update()}removeFeatureState(y,o){return this.style.removeFeatureState(y,o),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,o=0;return this._container&&(y=this._container.clientWidth||400,o=this._container.clientHeight||300),[y,o]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const o=this._canvasContainer=v.create("div","maplibregl-canvas-container",y);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=v.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),p=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],p);const g=this._controlContainer=v.create("div","maplibregl-control-container",y),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{x[E]=v.create("div",`maplibregl-ctrl-${E} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=v.create("div","maplibregl-cooperative-gesture-screen",this._container);let y=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(y=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${y}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){v.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(y,o,d){this._canvas.width=Math.floor(d*y),this._canvas.height=Math.floor(d*o),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{o={requestedAttributes:y},p&&(o.statusMessage=p.statusMessage,o.type=p.type)},{once:!0});const d=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!d){const p="Failed to initialize WebGL";throw o?(o.message=p,new Error(JSON.stringify(o))):new Error(p)}this.painter=new Fp(d,this.transform),S.testSupport(d)}_onCooperativeGesture(y,o,d){return!o&&d<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,x=l.browser.now();this.style.zoomHistory.update(g,x);const E=new l.EvaluationParameters(g,{now:x,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),T=E.crossFadingFactor();T===1&&T===this._crossFadingFactor||(d=!0,this._crossFadingFactor=T),this.style.update(E)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ue.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),v.remove(this._canvasContainer),v.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.browser.frame(y=>{l.PerformanceUtils.frame(y),this._frame=null,this._render(y)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return dy}getCameraTargetElevation(){return this.transform.elevation}},rn.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const o=this._map.getZoom(),d=o===this._map.getMaxZoom(),p=o===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,d)=>{const p=this._map._getUIString(`NavigationControl.${d}`);o.title=p,o.setAttribute("aria-label",p)},this.options=l.extend({},ei,y),this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),v.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),v.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=v.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Xp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){v.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,o){const d=v.create("button",y,this._container);return d.type="button",d.addEventListener("click",o),d}},rn.GeolocateControl=class extends l.Evented{constructor(y){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.Event("geolocate",o)),this._finish()}},this._updateCamera=o=>{const d=new l.LngLat(o.coords.longitude,o.coords.latitude),p=o.coords.accuracy,g=this._map.getBearing(),x=l.extend({bearing:g},this.options.fitBoundsOptions),E=Zt.fromLngLat(d,p);this._map.fitBounds(E,x,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const d=new l.LngLat(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&xa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.Event("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=o=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=v.create("button","maplibregl-ctrl-geolocate",this._container),v.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",o===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=v.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new bc({element:this._dotElement}),this._circleElement=v.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}},this.options=l.extend({},wc,y)}onAdd(y){return this._map=y,this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(o,d=!1){es===void 0||d?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(p=>{es=p.state!=="denied",o(es)}).catch(()=>{es=!!window.navigator.geolocation,o(es)}):(es=!!window.navigator.geolocation,o(es)):o(es)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),v.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,al=0,xa=!1}_isOutOfMapMaxBounds(y){const o=this._map.getMaxBounds(),d=y.coords;return o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),o=y.getSouthEast(),d=y.getNorthEast(),p=o.distanceTo(d),g=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":al--,xa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),al++,al>1?(y={maximumAge:6e5,timeout:0},xa=!0):(y=this.options.positionOptions,xa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},rn.AttributionControl=ms,rn.LogoControl=_c,rn.ScaleControl=class{constructor(y){this._onMove=()=>{Iu(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Iu(this._map,this._container,this.options)},this.options=l.extend({},Td,y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){v.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},rn.FullscreenControl=class extends l.Evented{constructor(y={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){v.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=v.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);v.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new l.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},rn.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=y}onAdd(y){return this._map=y,this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=v.create("button","maplibregl-ctrl-terrain",this._container),v.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){v.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},rn.Popup=class extends l.Evented{constructor(y){super(),this.remove=()=>(this._content&&v.remove(this._content),this._container&&(v.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=v.create("div","maplibregl-popup",this._map.getContainer()),this._tip=v.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const E of this.options.className.split(" "))this._container.classList.add(E);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=vc(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!o)return;const d=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);let p=this.options.anchor;const g=Pu(this.options.offset);if(!p){const E=this._container.offsetWidth,T=this._container.offsetHeight;let P;P=d.y+g.bottom.y<T?["top"]:d.y>this._map.transform.height-T?["bottom"]:[],d.x<E/2?P.push("left"):d.x>this._map.transform.width-E/2&&P.push("right"),p=P.length===0?"bottom":P.join("-")}const x=d.add(g[p]).round();v.setTransform(this._container,`${xc[p]} translate(${x.x}px,${x.y}px)`),Cu(this._container,p,"popup")},this._onClose=()=>{this.remove()},this.options=l.extend(Object.create(Sd),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=l.LngLat.convert(y),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const o=document.createDocumentFragment(),d=document.createElement("body");let p;for(d.innerHTML=y;p=d.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=v.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}_createCloseButton(){this.options.closeButton&&(this._closeButton=v.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Cd);y&&y.focus()}},rn.Marker=bc,rn.Style=Yn,rn.LngLat=l.LngLat,rn.LngLatBounds=Zt,rn.Point=l.Point,rn.MercatorCoordinate=l.MercatorCoordinate,rn.Evented=l.Evented,rn.AJAXError=l.AJAXError,rn.config=l.config,rn.CanvasSource=Be,rn.GeoJSONSource=cn,rn.ImageSource=er,rn.RasterDEMTileSource=cr,rn.RasterTileSource=mn,rn.VectorTileSource=Qi,rn.VideoSource=ur,rn.setRTLTextPlugin=l.setRTLTextPlugin,rn.getRTLTextPluginStatus=l.getRTLTextPluginStatus,rn.prewarm=function(){ds().acquire(We)},rn.clearPrewarmedResources=function(){const y=$r;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(We),$r=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Mu.extend(rn,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),rn});var h=r;return h})})(JP);var $F=JP.exports;const ZF=dx($F);function Bn(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const D_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),mT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);mT&&parseFloat(mT[1]);const JF="3.4.14";function ua(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const P0={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},KF=P0.global||P0.self||P0.window||{},Ua=typeof process!="object"||String(process)!=="[object process]"||process.browser,lb=typeof importScripts=="function",YF=typeof window<"u"&&typeof window.orientation<"u",gT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);gT&&parseFloat(gT[1]);function ep(t){"@babel/helpers - typeof";return ep=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ep(t)}function QF(t,e){if(ep(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(ep(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ek(t){var e=QF(t,"string");return ep(e)==="symbol"?e:String(e)}function R(t,e,n){return e=ek(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class tk{constructor(e,n){R(this,"name",void 0),R(this,"workerThread",void 0),R(this,"isRunning",!0),R(this,"result",void 0),R(this,"_resolve",()=>{}),R(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){ua(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ua(this.isRunning),this.isRunning=!1,this._reject(e)}}let M0=class{terminate(){}};const B0=new Map;function nk(t){ua(t.source&&!t.url||!t.source&&t.url);let e=B0.get(t.source||t.url);return e||(t.url&&(e=ik(t.url),B0.set(t.url,e)),t.source&&(e=YP(t.source),B0.set(t.source,e))),ua(e),e}function ik(t){if(!t.startsWith("http"))return t;const e=rk(t);return YP(e)}function YP(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function rk(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function QP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(t){if(_T(t))i.add(t);else if(_T(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)QP(t[r],e,i)}}return n===void 0?Array.from(i):[]}function _T(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const L0=()=>{};class E1{static isSupported(){return typeof Worker<"u"&&Ua||typeof M0<"u"&&!Ua}constructor(e){R(this,"name",void 0),R(this,"source",void 0),R(this,"url",void 0),R(this,"terminated",!1),R(this,"worker",void 0),R(this,"onMessage",void 0),R(this,"onError",void 0),R(this,"_loadableURL","");const{name:n,source:i,url:r}=e;ua(i||r),this.name=n,this.source=i,this.url=r,this.onMessage=L0,this.onError=a=>console.log(a),this.worker=Ua?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=L0,this.onError=L0,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||QP(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=nk({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new M0(i,{eval:!1})}else if(this.source)e=new M0(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class sk{static isSupported(){return E1.isSupported()}constructor(e){R(this,"name","unnamed"),R(this,"source",void 0),R(this,"url",void 0),R(this,"maxConcurrency",1),R(this,"maxMobileConcurrency",1),R(this,"onDebug",()=>{}),R(this,"reuseWorkers",!0),R(this,"props",{}),R(this,"jobQueue",[]),R(this,"idleQueue",[]),R(this,"count",0),R(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(a,h,l)=>a.done(l),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(a,h)=>a.error(h);const r=new Promise(a=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:a}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new tk(n.name,e);e.onMessage=r=>n.onMessage(i,r.type,r.payload),e.onError=r=>n.onError(i,r),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new E1({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return YF?this.maxMobileConcurrency:this.maxConcurrency}}const ok={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Ra{static isSupported(){return E1.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ra._workerFarm=Ra._workerFarm||new Ra({}),Ra._workerFarm.setProps(e),Ra._workerFarm}constructor(e){R(this,"props",void 0),R(this,"workerPools",new Map),this.props={...ok},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:r}=e;let a=this.workerPools.get(n);return a||(a=new sk({name:n,source:i,url:r}),a.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,a)),a}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}R(Ra,"_workerFarm",void 0);const ak="latest";function lk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(r="modules/".concat(t.module,"/dist/").concat(i)),!r){let a=t.version;a==="latest"&&(a=ak);const h=a?"@".concat(a):"";r="https://unpkg.com/@loaders.gl/".concat(t.module).concat(h,"/dist/").concat(i)}return ua(r),r}function ck(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:JF;ua(t,"no worker provided");const n=t.version;return!(!e||!n)}const uk=null,hk=null,T1=null,eM=null,dk=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:uk,readFileAsText:hk,requireFromFile:T1,requireFromString:eM},Symbol.toStringTag,{value:"Module"})),fk="3.4.14",R0={};async function Uc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e&&(t=pk(t,e,n)),R0[t]=R0[t]||mk(t),await R0[t]}function pk(t,e,n){if(t.startsWith("http"))return t;const i=n.modules||{};return i[t]?i[t]:Ua?n.CDN?(ua(n.CDN.startsWith("http")),"".concat(n.CDN,"/").concat(e,"@").concat(fk,"/dist/libs/").concat(t)):lb?"../src/libs/".concat(t):"modules/".concat(e,"/src/libs/").concat(t):"modules/".concat(e,"/dist/libs/").concat(t)}async function mk(t){if(t.endsWith("wasm"))return await(await fetch(t)).arrayBuffer();if(!Ua)try{return dk&&T1&&await T1(t)}catch{return null}if(lb)return importScripts(t);const n=await(await fetch(t)).text();return gk(n,t)}function gk(t,e){if(!Ua)return eM;if(lb)return eval.call(KF,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch{n.text=t}return document.body.appendChild(n),null}function _k(t,e){return!Ra.isSupported()||!Ua&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function yk(t,e,n,i,r){const a=t.id,h=lk(t,n),_=Ra.getWorkerFarm(n).getWorkerPool({name:a,url:h});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const v=await _.startJob("process-on-worker",vk.bind(null,r));return v.postMessage("process",{input:e,options:n,context:i}),await(await v.result).result}async function vk(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:a,options:h}=i;try{const l=await t(a,h);e.postMessage("done",{id:r,result:l})}catch(l){const _=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:r,error:_})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function xk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?yT(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?yT(t,0,e):""}function yT(t,e,n){if(t.byteLength<=e+n)return"";const i=new DataView(t);let r="";for(let a=0;a<n;a++)r+=String.fromCharCode(i.getUint8(e+a));return r}function bk(t){try{return JSON.parse(t)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(xk(t),'"'))}}function wk(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let a=0;a<i.length;++a)if(i[a]!==r[a])return!1;return!0}function Ak(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),r=i.reduce((l,_)=>l+_.byteLength,0),a=new Uint8Array(r);let h=0;for(const l of i)a.set(l,h),h+=l.byteLength;return a.buffer}function cb(t,e,n){const i=n!==void 0?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(i).buffer}function pp(t,e){return Bn(t>=0),Bn(e>0),t+(e-1)&~(e-1)}function Ek(t,e,n){let i;if(t instanceof ArrayBuffer)i=new Uint8Array(t);else{const r=t.byteOffset,a=t.byteLength;i=new Uint8Array(t.buffer||t.arrayBuffer,r,a)}return e.set(i,n),n+pp(i.byteLength,4)}async function Tk(t){const e=[];for await(const n of t)e.push(n);return Ak(...e)}function vT(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let xT=class{constructor(e,n){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=vT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(vT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},Sk=class{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:i}=e;let r=this.stats[n];return r||(e instanceof xT?r=e:r=new xT(n,i),this.stats[n]=r),r}};const Ck="Queued Requests",Ik="Active Requests",Pk="Cancelled Requests",Mk="Queued Requests Ever",Bk="Active Requests Ever",Lk={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Rk{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};R(this,"props",void 0),R(this,"stats",void 0),R(this,"activeRequestCount",0),R(this,"requestQueue",[]),R(this,"requestMap",new Map),R(this,"deferredUpdate",null),this.props={...Lk,...e},this.stats=new Sk({id:this.props.id}),this.stats.get(Ck),this.stats.get(Ik),this.stats.get(Pk),this.stats.get(Mk),this.stats.get(Bk)}scheduleRequest(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:n},r=new Promise(a=>(i.resolve=a,i));return this.requestQueue.push(i),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){const{handle:n,resolve:i}=e;let r=!1;const a=()=>{r||(r=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:a}):Promise.resolve({done:a})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const i=e[n];this._updateRequest(i)||(e.splice(n,1),this.requestMap.delete(i.handle),n--)}e.sort((n,i)=>n.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let Dk="";const bT={};function Ok(t){for(const e in bT)if(t.startsWith(e)){const n=bT[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(Dk).concat(t)),t}function Fk(t){return t&&typeof t=="object"&&t.isBuffer}function tM(t){if(Fk(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function nM(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function ub(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const kk=t=>typeof t=="boolean",Bf=t=>typeof t=="function",mp=t=>t!==null&&typeof t=="object",wT=t=>mp(t)&&t.constructor==={}.constructor,zk=t=>t&&typeof t[Symbol.iterator]=="function",Nk=t=>t&&typeof t[Symbol.asyncIterator]=="function",Qc=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,eu=t=>typeof Blob<"u"&&t instanceof Blob,Uk=t=>t&&typeof t=="object"&&t.isBuffer,Gk=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||mp(t)&&Bf(t.tee)&&Bf(t.cancel)&&Bf(t.getReader),Vk=t=>mp(t)&&Bf(t.read)&&Bf(t.pipe)&&kk(t.readable),iM=t=>Gk(t)||Vk(t),jk=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Hk=/^([-\w.]+\/[-\w.+]+)/;function Wk(t){const e=Hk.exec(t);return e?e[1]:t}function AT(t){const e=jk.exec(t);return e?e[1]:""}const rM=/\?.*/;function qk(t){const e=t.match(rM);return e&&e[0]}function hb(t){return t.replace(rM,"")}function O_(t){return Qc(t)?t.url:eu(t)?t.name||"":typeof t=="string"?t:""}function db(t){if(Qc(t)){const e=t,n=e.headers.get("content-type")||"",i=hb(e.url);return Wk(n)||AT(i)}return eu(t)?t.type||"":typeof t=="string"?AT(t):""}function Xk(t){return Qc(t)?t.headers["content-length"]||-1:eu(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function sM(t){if(Qc(t))return t;const e={},n=Xk(t);n>=0&&(e["content-length"]=String(n));const i=O_(t),r=db(t);r&&(e["content-type"]=r);const a=await Jk(t);a&&(e["x-first-bytes"]=a),typeof t=="string"&&(t=new TextEncoder().encode(t));const h=new Response(t,{headers:e});return Object.defineProperty(h,"url",{value:i}),h}async function $k(t){if(!t.ok){const e=await Zk(t);throw new Error(e)}}async function Zk(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function Jk(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=a=>{var h;return i(a==null||(h=a.target)===null||h===void 0?void 0:h.result)},r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=Kk(n);return"data:base64,".concat(i)}return null}function Kk(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function ET(t,e){if(typeof t=="string"){t=Ok(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await sM(t)}function Yk(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function gp(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Yk()}const Lm=globalThis.window||globalThis.self||globalThis.global,tf=globalThis.process||{},oM=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";gp();function Qk(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}let ez=class{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=Qk(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}};function tz(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function nz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function D0(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const a=t.width*n,h=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(h/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(h,"px;"),"background:url(".concat(r,");"),"background-size:".concat(a,"px ").concat(h,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let Kg;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Kg||(Kg={}));const iz=10;function TT(t){return typeof t!="string"?t:(t=t.toUpperCase(),Kg[t]||Kg.WHITE)}function rz(t,e,n){if(!gp&&typeof t=="string"){if(e){const i=TT(e);t="\x1B[".concat(i,"m").concat(t,"\x1B[39m")}if(n){const i=TT(n);t="\x1B[".concat(i+iz,"m").concat(t,"\x1B[49m")}}return t}function sz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),r=t;for(const a of i){const h=r[a];typeof h=="function"&&(e.find(l=>a===l)||(r[a]=h.bind(t)))}}function Yg(t,e){if(!t)throw new Error(e||"Assertion failed")}function ju(){let t;if(gp()&&Lm.performance){var e,n;t=Lm==null||(e=Lm.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in tf){var i;const r=tf==null||(i=tf.hrtime)===null||i===void 0?void 0:i.call(tf);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const Hu={debug:gp()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},oz={enabled:!0,level:0};function Js(){}const ST={},CT={once:!0};let fb=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=oM,this._startTs=ju(),this._deltaTs=ju(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new ez("__probe-".concat(this.id,"__"),oz),this.timeStamp("".concat(this.id," started")),sz(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ju()-this._startTs).toPrecision(10))}getDelta(){return Number((ju()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Yg(e,n)}warn(e){return this._getLogFunction(0,e,Hu.warn,arguments,CT)}error(e){return this._getLogFunction(0,e,Hu.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Hu.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Hu.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Hu.debug||Hu.info,arguments,CT)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||Js,i&&[i],{tag:uz(n)}):Js}image(e){let{logLevel:n,priority:i,image:r,message:a="",scale:h=1}=e;return this._shouldLog(n||i)?gp()?cz({image:r,message:a,scale:h}):lz():Js}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Js)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=IT({logLevel:e,message:n,opts:i}),{collapsed:a}=i;return r.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Js)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=aM(e)}_getLogFunction(e,n,i,r,a){if(this._shouldLog(e)){a=IT({logLevel:e,message:n,args:r,opts:a}),i=i||a.method,Yg(i),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=ju();const h=a.tag||a.message;if(a.once&&h)if(!ST[h])ST[h]=ju();else return Js;return n=az(this.id,a.message,a),i.bind(console,n,...a.args)}return Js}};fb.VERSION=oM;function aM(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Yg(Number.isFinite(e)&&e>=0),e}function IT(t){const{logLevel:e,message:n}=t;t.logLevel=aM(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return Yg(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function az(t,e,n){if(typeof e=="string"){const i=n.time?nz(tz(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=rz(e,n.color,n.background)}return e}function lz(t){return console.warn("removed"),Js}function cz(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const a=new Image;return a.onload=()=>{const h=D0(a,n,i);console.log(...h)},a.src=e,Js}const r=e.nodeName||"";if(r.toLowerCase()==="img")return console.log(...D0(e,n,i)),Js;if(r.toLowerCase()==="canvas"){const a=new Image;return a.onload=()=>console.log(...D0(a,n,i)),a.src=e.toDataURL(),Js}return Js}function uz(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const PT=new fb({id:"loaders.gl"});class hz{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class dz{constructor(){R(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.error.bind(this.console,...n)}}const lM={fetch:null,mimeType:void 0,nothrow:!1,log:new dz,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:D_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},fz={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function cM(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const uM=()=>{const t=cM();return t.globalOptions=t.globalOptions||{...lM},t.globalOptions};function pz(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],mz(t,n),_z(e,t,i)}function mz(t,e){MT(t,null,lM,fz,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},a=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};MT(i,n.id,r,a,e)}}function MT(t,e,n,i,r){const a=e||"Top level",h=e?"".concat(e,"."):"";for(const l in t){const _=!e&&mp(t[l]),v=l==="baseUri"&&!e,S=l==="workerUrl"&&e;if(!(l in n)&&!v&&!S){if(l in i)PT.warn("".concat(a," loader option '").concat(h).concat(l,"' no longer supported, use '").concat(i[l],"'"))();else if(!_){const I=gz(l,r);PT.warn("".concat(a," loader option '").concat(h).concat(l,"' not recognized. ").concat(I))()}}}}function gz(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const a in r.options){if(t===a)return"Did you mean '".concat(r.id,".").concat(a,"'?");const h=a.toLowerCase();(n.startsWith(h)||h.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(a,"'?"))}return i}function _z(t,e,n){const r={...t.options||{}};return yz(r,n),r.log===null&&(r.log=new hz),BT(r,uM()),BT(r,e),r}function BT(t,e){for(const n in e)if(n in e){const i=e[n];wT(i)&&wT(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function yz(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function pb(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function mb(t){var e,n;Bn(t,"null loader"),Bn(pb(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const hM=()=>{const t=cM();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function vz(t){const e=hM();t=Array.isArray(t)?t:[t];for(const n of t){const i=mb(n);e.find(r=>i===r)||e.unshift(i)}}function xz(){return hM()}const bz=new fb({id:"loaders.gl"}),wz=/\.([^.]+)$/;async function Az(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!dM(t))return null;let r=LT(t,e,{...n,nothrow:!0},i);if(r)return r;if(eu(t)&&(t=await t.slice(0,10).arrayBuffer(),r=LT(t,e,n,i)),!r&&!(n!=null&&n.nothrow))throw new Error(fM(t));return r}function LT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!dM(t))return null;if(e&&!Array.isArray(e))return mb(e);let r=[];e&&(r=r.concat(e)),n!=null&&n.ignoreRegisteredLoaders||r.push(...xz()),Tz(r);const a=Ez(t,r,n,i);if(!a&&!(n!=null&&n.nothrow))throw new Error(fM(t));return a}function Ez(t,e,n,i){const r=O_(t),a=db(t),h=hb(r)||(i==null?void 0:i.url);let l=null,_="";if(n!=null&&n.mimeType&&(l=O0(e,n==null?void 0:n.mimeType),_="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),l=l||Sz(e,h),_=_||(l?"matched url ".concat(h):""),l=l||O0(e,a),_=_||(l?"matched MIME type ".concat(a):""),l=l||Iz(e,t),_=_||(l?"matched initial data ".concat(pM(t)):""),l=l||O0(e,n==null?void 0:n.fallbackMimeType),_=_||(l?"matched fallback MIME type ".concat(a):""),_){var v;bz.log(1,"selectLoader selected ".concat((v=l)===null||v===void 0?void 0:v.name,": ").concat(_,"."))}return l}function dM(t){return!(t instanceof Response&&t.status===204)}function fM(t){const e=O_(t),n=db(t);let i="No valid loader found (";i+=e?"".concat(nM(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=t?pM(t):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function Tz(t){for(const e of t)mb(e)}function Sz(t,e){const n=e&&wz.exec(e),i=n&&n[1];return i?Cz(t,i):null}function Cz(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function O0(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function Iz(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(Pz(e,n))return n}else if(ArrayBuffer.isView(e)){if(RT(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&RT(e,0,n))return n;return null}function Pz(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function RT(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>Mz(t,e,n,r))}function Mz(t,e,n,i){if(i instanceof ArrayBuffer)return wk(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const r=S1(t,e,i.length);return i===r;default:return!1}}function pM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?S1(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?S1(t,0,e):""}function S1(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let a=0;a<n;a++)r+=String.fromCharCode(i.getUint8(e+a));return r}const Bz=256*1024;function*Lz(t,e){const n=(e==null?void 0:e.chunkSize)||Bz;let i=0;const r=new TextEncoder;for(;i<t.length;){const a=Math.min(t.length-i,n),h=t.slice(i,i+a);i+=a,yield r.encode(h)}}const Rz=256*1024;function Dz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=Rz}=e;let i=0;for(;i<t.byteLength;){const r=Math.min(t.byteLength-i,n),a=new ArrayBuffer(r),h=new Uint8Array(t,i,r);new Uint8Array(a).set(h),i+=r,yield a}}()}const Oz=1024*1024;async function*Fz(t,e){const n=(e==null?void 0:e.chunkSize)||Oz;let i=0;for(;i<t.size;){const r=i+n,a=await t.slice(i,r).arrayBuffer();i=r,yield a}}function DT(t,e){return D_?kz(t,e):zz(t)}async function*kz(t,e){const n=t.getReader();let i;try{for(;;){const r=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:a,value:h}=await r;if(a)return;yield tM(h)}}catch{n.releaseLock()}}async function*zz(t,e){for await(const n of t)yield tM(n)}function Nz(t,e){if(typeof t=="string")return Lz(t,e);if(t instanceof ArrayBuffer)return Dz(t,e);if(eu(t))return Fz(t,e);if(iM(t))return DT(t,e);if(Qc(t))return DT(t.body,e);throw new Error("makeIterator")}const mM="Cannot convert supplied data type";function Uz(t,e,n){if(e.text&&typeof t=="string")return t;if(Uk(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error(mM)}async function Gz(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return Uz(t,e);if(eu(t)&&(t=await sM(t)),Qc(t)){const r=t;return await $k(r),e.binary?await r.arrayBuffer():await r.text()}if(iM(t)&&(t=Nz(t,n)),zk(t)||Nk(t))return Tk(t);throw new Error(mM)}function gM(t,e){const n=uM(),i=t||n;return typeof i.fetch=="function"?i.fetch:mp(i.fetch)?r=>ET(r,i):e!=null&&e.fetch?e==null?void 0:e.fetch:ET}function Vz(t,e,n){if(n)return n;const i={fetch:gM(e,t),...t};if(i.url){const r=hb(i.url);i.baseUrl=r,i.queryString=qk(i.url),i.filename=nM(r),i.baseUrl=ub(r)}return Array.isArray(i.loaders)||(i.loaders=null),i}function jz(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function gb(t,e,n,i){ua(!i||typeof i=="object"),e&&!Array.isArray(e)&&!pb(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const r=O_(t),h=jz(e,i),l=await Az(t,h,n);return l?(n=pz(n,l,h,r),i=Vz({url:r,parse:gb,loaders:h},n,i||null),await Hz(l,t,n,i)):null}async function Hz(t,e,n,i){if(ck(t),Qc(e)){const r=e,{ok:a,redirected:h,status:l,statusText:_,type:v,url:S}=r,I=Object.fromEntries(r.headers.entries());i.response={headers:I,ok:a,redirected:h,status:l,statusText:_,type:v,url:S}}if(e=await Gz(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(_k(t,n))return await yk(t,e,n,i,gb);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw ua(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function Hl(t,e,n,i){!Array.isArray(e)&&!pb(e)&&(n=e,e=void 0);const r=gM(n);let a=t;return typeof t=="string"&&(a=await r(t)),eu(t)&&(a=await r(t)),await gb(a,e,n)}const Wz="3.4.14",{_parseImageNode:qz}=globalThis,C1=typeof Image<"u",I1=typeof ImageBitmap<"u",Xz=!!qz,P1=D_?!0:Xz;function $z(t){switch(t){case"auto":return I1||C1||P1;case"imagebitmap":return I1;case"image":return C1;case"data":return P1;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function Zz(){if(I1)return"imagebitmap";if(C1)return"image";if(P1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Jz(t){const e=Yz(t);if(!e)throw new Error("Not an image");return e}function Kz(t){switch(Jz(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Yz(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const Qz=/^data:image\/svg\+xml/,eN=/\.svg((\?|#).*)?$/;function _b(t){return t&&(Qz.test(t)||eN.test(t))}function tN(t,e){if(_b(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(a){throw new Error(a.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return _M(t,e)}function _M(t,e){if(_b(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function yM(t,e,n){const i=tN(t,n),r=self.URL||self.webkitURL,a=typeof i!="string"&&r.createObjectURL(i);try{return await nN(a||i,e)}finally{a&&r.revokeObjectURL(a)}}async function nN(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,r)=>{try{n.onload=()=>i(n),n.onerror=a=>r(new Error("Could not load image ".concat(t,": ").concat(a)))}catch(a){r(a)}})}const iN={};let OT=!0;async function rN(t,e,n){let i;_b(n)?i=await yM(t,e,n):i=_M(t,n);const r=e&&e.imagebitmap;return await sN(i,r)}async function sN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((oN(e)||!OT)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),OT=!1}return await createImageBitmap(t)}function oN(t){for(const e in t||iN)return!1;return!0}function aN(t){return!hN(t,"ftyp",4)||!(t[8]&96)?null:lN(t)}function lN(t){switch(cN(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function cN(t,e,n){return String.fromCharCode(...t.slice(e,n))}function uN(t){return[...t].map(e=>e.charCodeAt(0))}function hN(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=uN(e);for(let r=0;r<i.length;++r)if(i[r]!==t[r+n])return!1;return!0}const ia=!1,Lf=!0;function yb(t){const e=_p(t);return fN(e)||gN(e)||pN(e)||mN(e)||dN(e)}function dN(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=aN(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function fN(t){const e=_p(t);return e.byteLength>=24&&e.getUint32(0,ia)===2303741511?{mimeType:"image/png",width:e.getUint32(16,ia),height:e.getUint32(20,ia)}:null}function pN(t){const e=_p(t);return e.byteLength>=10&&e.getUint32(0,ia)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Lf),height:e.getUint16(8,Lf)}:null}function mN(t){const e=_p(t);return e.byteLength>=14&&e.getUint16(0,ia)===16973&&e.getUint32(2,Lf)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Lf),height:e.getUint32(22,Lf)}:null}function gN(t){const e=_p(t);if(!(e.byteLength>=3&&e.getUint16(0,ia)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=_N();let a=2;for(;a+9<e.byteLength;){const h=e.getUint16(a,ia);if(r.has(h))return{mimeType:"image/jpeg",height:e.getUint16(a+5,ia),width:e.getUint16(a+7,ia)};if(!i.has(h))return null;a+=2,a+=e.getUint16(a,ia)}return null}function _N(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function _p(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function yN(t,e){const{mimeType:n}=yb(t)||{},i=globalThis._parseImageNode;return Bn(i),await i(t,n)}async function vN(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:a}=n||{},h=xN(r);let l;switch(h){case"imagebitmap":l=await rN(t,e,a);break;case"image":l=await yM(t,e,a);break;case"data":l=await yN(t);break;default:Bn(!1)}return r==="data"&&(l=Kz(l)),l}function xN(t){switch(t){case"auto":case"data":return Zz();default:return $z(t),t}}const bN=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],wN=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],AN={image:{type:"auto",decode:!0}},vM={id:"image",module:"images",name:"Images",version:Wz,mimeTypes:wN,extensions:bN,parse:vN,tests:[t=>!!yb(new DataView(t))],options:AN},F0={};function EN(t){if(F0[t]===void 0){const e=D_?SN(t):TN(t);F0[t]=e}return F0[t]}function TN(t){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:n,_imageFormatsNode:i=e}=globalThis;return!!n&&i.includes(t)}function SN(t){switch(t){case"image/avif":case"image/webp":return CN(t);default:return!0}}function CN(t){try{return document.createElement("canvas").toDataURL(t).indexOf("data:".concat(t))===0}catch{return!1}}function xM(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Ja(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||xM()}const _g={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Rm=_g.window||_g.self||_g.global,nf=_g.process||{},bM=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Ja();const k0=globalThis;function wM(t){if(!t&&!Ja())return"Node";if(xM(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r?"IE":k0.chrome?"Chrome":k0.safari?"Safari":k0.mozInnerScreenX?"Firefox":"Unknown"}function IN(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class PN{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";R(this,"storage",void 0),R(this,"id",void 0),R(this,"config",void 0),this.storage=IN(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function MN(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function BN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function z0(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const a=t.width*n,h=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(h/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(h,"px;"),"background:url(".concat(r,");"),"background-size:".concat(a,"px ").concat(h,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let Qg;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Qg||(Qg={}));function FT(t){return typeof t=="string"?Qg[t.toUpperCase()]||Qg.WHITE:t}function LN(t,e,n){return!Ja&&typeof t=="string"&&(e&&(e=FT(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=FT(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function RN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const r of i)typeof t[r]=="function"&&(e.find(a=>r===a)||(t[r]=t[r].bind(t)))}function e_(t,e){if(!t)throw new Error(e||"Assertion failed")}function Wu(){let t;if(Ja&&"performance"in Rm){var e,n;t=Rm==null||(e=Rm.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in nf){var i;const r=nf==null||(i=nf.hrtime)===null||i===void 0?void 0:i.call(nf);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const qu={debug:Ja&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},DN={enabled:!0,level:0};function Ks(){}const kT={},zT={once:!0};class vb{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};R(this,"id",void 0),R(this,"VERSION",bM),R(this,"_startTs",Wu()),R(this,"_deltaTs",Wu()),R(this,"_storage",void 0),R(this,"userData",{}),R(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new PN("__probe-".concat(this.id,"__"),DN),this.timeStamp("".concat(this.id," started")),RN(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Wu()-this._startTs).toPrecision(10))}getDelta(){return Number((Wu()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){e_(e,n)}warn(e){return this._getLogFunction(0,e,qu.warn,arguments,zT)}error(e){return this._getLogFunction(0,e,qu.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,qu.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,qu.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];return this._getLogFunction(e,n,qu.debug||qu.info,arguments,zT)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||Ks,i&&[i],{tag:zN(n)}):Ks}image(e){let{logLevel:n,priority:i,image:r,message:a="",scale:h=1}=e;return this._shouldLog(n||i)?Ja?kN({image:r,message:a,scale:h}):FN():Ks}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Ks)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=NT({logLevel:e,message:n,opts:i}),{collapsed:a}=i;return r.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ks)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=AM(e)}_getLogFunction(e,n,i,r,a){if(this._shouldLog(e)){a=NT({logLevel:e,message:n,args:r,opts:a}),i=i||a.method,e_(i),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=Wu();const h=a.tag||a.message;if(a.once)if(!kT[h])kT[h]=Wu();else return Ks;return n=ON(this.id,a.message,a),i.bind(console,n,...a.args)}return Ks}}R(vb,"VERSION",bM);function AM(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return e_(Number.isFinite(e)&&e>=0),e}function NT(t){const{logLevel:e,message:n}=t;t.logLevel=AM(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return e_(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function ON(t,e,n){if(typeof e=="string"){const i=n.time?BN(MN(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=LN(e,n.color,n.background)}return e}function FN(t){return console.warn("removed"),Ks}function kN(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const a=new Image;return a.onload=()=>{const h=z0(a,n,i);console.log(...h)},a.src=e,Ks}const r=e.nodeName||"";if(r.toLowerCase()==="img")return console.log(...z0(e,n,i)),Ks;if(r.toLowerCase()==="canvas"){const a=new Image;return a.onload=()=>console.log(...z0(a,n,i)),a.src=e.toDataURL(),Ks}return Ks}function zN(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const ln=new vb({id:"deck"});let M1={};function NN(t){M1=t}function Er(t,e,n,i){ln.level>0&&M1[t]&&M1[t].call(null,e,n,i)}function UN(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const GN={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:UN,parseTextSync:JSON.parse};function VN(){const t="8.9.31",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(ln.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:ln,_registerLoggers:NN},vz([GN,[vM,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const jN=VN(),Jt={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Jt,"IDENTITY",{get:()=>(ln.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const sa={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},t_={common:0,meters:1,pixels:2},UT={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},_t=new vb({id:"luma.gl"});function Vr(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const HN="Invalid WebGLRenderingContext",WN="Requires WebGL2";function F_(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function Xt(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function qN(t){return Xt(t)?t:null}function k_(t){return Vr(F_(t),HN),t}function jr(t){return Vr(Xt(t),WN),t}const vf={};function XN(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function $N(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function ZN(t,e){vf[t]=!0,e!==void 0&&XN(e)}function JN(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(vf[i]=!0);while(i!==0);for(i in vf)if(vf[i])return delete vf[i],parseInt(i,10);return 0}}const yp=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const r=new t.VertexAttrib(n);this.attribs[i]=r}this.maxAttrib=0};yp.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};yp.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const tu=function(e){const n=this;this.gl=e,JN(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(a){return a===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(a){const h=n.currentVertexArrayObject;h.maxAttrib=Math.max(h.maxAttrib,a);const l=h.attribs[a];return l.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(a){const h=n.currentVertexArrayObject;h.maxAttrib=Math.max(h.maxAttrib,a);const l=h.attribs[a];return l.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(a,h){switch(a){case 34962:n.currentArrayBuffer=h;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=h;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(a,h){const _=n.currentVertexArrayObject.attribs[a];switch(h){case 34975:return _.buffer;case 34338:return _.enabled;case 34339:return _.size;case 34340:return _.stride;case 34341:return _.type;case 34922:return _.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(a,h,l,_,v,S){const I=n.currentVertexArrayObject;I.maxAttrib=Math.max(I.maxAttrib,a);const B=I.attribs[a];return B.buffer=n.currentArrayBuffer,B.size=h,B.type=l,B.normalized=_,B.stride=v,B.offset=S,B.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{$N("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};tu.prototype.VERTEX_ARRAY_BINDING_OES=34229;tu.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new yp(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};tu.prototype.createVertexArrayOES=function(){const e=new yp(this);return this.vertexArrayObjects.push(e),e};tu.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};tu.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof yp&&e.hasBeenBound&&e.ext===this)};tu.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){ZN(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const a=this.currentVertexArrayObject;if(r===a)return;(!r||a.elementArrayBuffer!==r.elementArrayBuffer)&&i.bindBuffer.call(n,34963,a.elementArrayBuffer);let h=this.currentArrayBuffer;const l=Math.max(r?r.maxAttrib:0,a.maxAttrib);for(let _=0;_<=l;_++){const v=a.attribs[_],S=r?r.attribs[_]:null;if((!r||v.enabled!==S.enabled)&&(v.enabled?i.enableVertexAttribArray.call(n,_):i.disableVertexAttribArray.call(n,_)),v.enabled){let I=!1;(!r||v.buffer!==S.buffer)&&(h!==v.buffer&&(i.bindBuffer.call(n,34962,v.buffer),h=v.buffer),I=!0),(I||v.cached!==S.cached)&&i.vertexAttribPointer.call(n,_,v.size,v.type,v.normalized,v.stride,v.offset)}}this.currentArrayBuffer!==h&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function KN(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const r=e.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const n=t.getExtension;t.getExtension=function(r){const a=n.call(this,r);return a||(r!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new tu(this)),this.__OESVertexArrayObject))}}const GT="OES_element_index",VT="WEBGL_draw_buffers",YN="EXT_disjoint_timer_query",QN="EXT_disjoint_timer_query_webgl2",eU="EXT_texture_filter_anisotropic",jT="WEBGL_debug_renderer_info",tU=35723,nU=4352,iU=36795,rU=34047,sU=37445,oU=37446,On=t=>Xt(t)?void 0:0,aU={3074:t=>Xt(t)?void 0:36064,[tU]:t=>Xt(t)?void 0:nU,35977:On,32937:On,[iU]:(t,e)=>{const n=Xt(t)?t.getExtension(QN):t.getExtension(YN);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[sU]:(t,e)=>{const n=t.getExtension(jT);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[oU]:(t,e)=>{const n=t.getExtension(jT);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[rU]:(t,e)=>{const n=t.luma.extensions[eU];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:On,35071:On,37447:On,36063:(t,e)=>{if(!Xt(t)){const n=t.getExtension(VT);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:On,35374:On,35377:On,34852:t=>{if(!Xt(t)){const e=t.getExtension(VT);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(GT)?2147483647:65535,33001:t=>t.getExtension(GT)?16777216:65535,33e3:t=>16777216,37157:On,35373:On,35657:On,36183:On,37137:On,34045:On,35978:On,35979:On,35968:On,35376:On,35375:On,35659:On,37154:On,35371:On,35658:On,35076:On,35077:On,35380:On};function lU(t,e,n){const i=aU[n],r=typeof i=="function"?i(t,e,n):i;return r!==void 0?r:e(n)}const cU="OES_vertex_array_object",EM="ANGLE_instanced_arrays",uU="WEBGL_draw_buffers",hU="EXT_disjoint_timer_query",dU="EXT_texture_filter_anisotropic",fU="VertexArray requires WebGL2 or OES_vertex_array_object extension";function pU(t,e){return{webgl2:Xt(t),ext:t.getExtension(e)}}const TM={[cU]:{meta:{suffix:"OES"},createVertexArray:()=>{Vr(!1,fU)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[EM]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Vr(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[uU]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Vr(!1)}},[hU]:{meta:{suffix:"EXT"},createQuery:()=>{Vr(!1)},deleteQuery:()=>{Vr(!1)},beginQuery:()=>{Vr(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},N0={readBuffer:(t,e,n)=>{Xt(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:r,ext:a}=pU(t,EM);let h;switch(i){case 35069:h=r?void 0:!1;break;case 35070:h=!r&&!a?0:void 0;break}return h!==void 0?h:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Xt(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,r)=>{if(!Xt(t))switch(r){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,r)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:r}=t.luma,a=r[dU];i=a&&a.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:lU,hint(t,e,n,i){return e(n,i)}};function mU(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(KN(t),gU(t),yU(t,TM),_U(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=mU;function gU(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function _U(t,e){let{target:n,target2:i}=e;Object.keys(N0).forEach(r=>{if(typeof N0[r]=="function"){const a=t[r]?t[r].bind(t):()=>{},h=N0[r].bind(null,t,a);n[r]=h,i[r]=h}})}function yU(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&vU(t,{extension:n,target:t.luma,target2:t})}function vU(t,e){let{extension:n,target:i,target2:r}=e;const a=TM[n];Vr(a);const{meta:h={}}=a,{suffix:l=""}=h,_=t.getExtension(n);for(const v of Object.keys(a)){const S="".concat(v).concat(l);let I=null;v==="meta"||typeof t[v]=="function"||(_&&typeof _[S]=="function"?I=function(){return _[S](...arguments)}:typeof a[v]=="function"&&(I=a[v].bind(i))),I&&(i[v]=I,r[v]=I)}}const xb={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},yl=(t,e,n)=>e?t.enable(n):t.disable(n),HT=(t,e,n)=>t.hint(n,e),ws=(t,e,n)=>t.pixelStorei(n,e),xU=(t,e)=>{const n=Xt(t)?36009:36160;return t.bindFramebuffer(n,e)},bU=(t,e)=>t.bindFramebuffer(36008,e);function rf(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const wU={3042:yl,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:yl,2885:(t,e)=>t.cullFace(e),2929:yl,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:yl,35723:HT,36006:xU,2886:(t,e)=>t.frontFace(e),33170:HT,2849:(t,e)=>t.lineWidth(e),32823:yl,32824:"polygonOffset",10752:"polygonOffset",35977:yl,32938:"sampleCoverage",32939:"sampleCoverage",3089:yl,3088:(t,e)=>t.scissor(...e),2960:yl,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:ws,3317:ws,37440:ws,37441:ws,37443:ws,3330:ws,3332:ws,3331:ws,36010:bU,3314:ws,32878:ws,3316:ws,3315:ws,32877:ws,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=rf(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=rf(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=rf(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=rf(e)&&e.length===3?[...e,...e]:e;const[n,i,r,a,h,l]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,a,h,l)},stencilOp:(t,e)=>{e=rf(e)&&e.length===3?[...e,...e]:e;const[n,i,r,a,h,l]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,a,h,l)},viewport:(t,e)=>t.viewport(...e)};function fi(t,e,n){return e[t]!==void 0?e[t]:n[t]}const AU={blendEquation:(t,e,n)=>t.blendEquationSeparate(fi(32777,e,n),fi(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(fi(32969,e,n),fi(32968,e,n),fi(32971,e,n),fi(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(fi(32824,e,n),fi(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(fi(32938,e,n),fi(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,fi(2962,e,n),fi(2967,e,n),fi(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,fi(34816,e,n),fi(36003,e,n),fi(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,fi(2964,e,n),fi(2965,e,n),fi(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,fi(34817,e,n),fi(34818,e,n),fi(34819,e,n))},WT={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,i,r)=>t({32773:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,r)=>t({32969:e,32968:n,32971:i,32970:r}),clearColor:(t,e,n,i,r)=>t({3106:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,r)=>t({3107:[e,n,i,r]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,r)=>t({3088:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({2978:[e,n,i,r]})},Ko=(t,e)=>t.isEnabled(e),qT={3042:Ko,2884:Ko,2929:Ko,3024:Ko,32823:Ko,32926:Ko,32928:Ko,3089:Ko,2960:Ko,35977:Ko};function SM(t){for(const e in t)return!1;return!0}function EU(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}function XT(t,e){const n=t[e].bind(t);t[e]=function(){const r=arguments.length<=0?void 0:arguments[0];return r in t.state.cache?t.state.enable?t.state.cache[r]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function TU(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var a=arguments.length,h=new Array(a),l=0;l<a;l++)h[l]=arguments[l];const{valueChanged:_,oldValue:v}=n(t.state._updateCache,...h);return _&&i(...h),v},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function SU(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class CU{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?PU(e):Object.assign({},xb),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Vr(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];qa(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const a in e){Vr(a!==void 0);const h=e[a],l=this.cache[a];EU(h,l)||(n=!0,i=l,r&&!(a in r)&&(r[a]=l),this.cache[a]=h)}return{valueChanged:n,oldValue:i}}}function CM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(Vr(i!==void 0),!t.state){const{polyfillContext:r}=globalThis;r&&r(t),t.state=new CU(t,{copyState:i}),SU(t);for(const a in WT){const h=WT[a];TU(t,a,h)}XT(t,"getParameter"),XT(t,"isEnabled")}return t.state.enable=n,t}function IU(t){t.state||CM(t,{copyState:!1}),t.state.push()}function $T(t){Vr(t.state),t.state.pop()}function qa(t,e){if(Vr(F_(t),"setParameters requires a WebGL context"),SM(e))return;const n={};for(const r in e){const a=Number(r),h=wU[r];h&&(typeof h=="string"?n[h]=!0:h(t,e[r],a))}const i=t.state&&t.state.cache;if(i)for(const r in n){const a=AU[r];a(t,e,i)}}function PU(t,e){if(e=e||xb,typeof e=="number"){const r=e,a=qT[r];return a?a(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const a=qT[r];i[r]=a?a(t,Number(r)):t.getParameter(Number(r))}return i}function MU(t){qa(t,xb)}function Do(t,e,n){if(SM(e))return n(t);const{nocatch:i=!0}=e;IU(t),qa(t,e);let r;if(i)r=n(t),$T(t);else try{r=n(t)}finally{$T(t)}return r}function kh(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,i="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return i?t.drawingBufferWidth/i:1}return 1}function U0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=kh(t),r=t.drawingBufferWidth,a=t.drawingBufferHeight;return LU(e,i,r,a,n)}function BU(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function LU(t,e,n,i,r){const a=ZT(t[0],e,n);let h=JT(t[1],e,i,r),l=ZT(t[0]+1,e,n);const _=l===n-1?l:l-1;l=JT(t[1]+1,e,i,r);let v;return r?(l=l===0?l:l+1,v=h,h=l):v=l===i-1?l:l-1,{x:a,y:h,width:Math.max(_-a+1,1),height:Math.max(v-h+1,1)}}function ZT(t,e,n){return Math.min(Math.round(t*e),n-1)}function JT(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const bb=Ja(),RU=bb&&typeof document<"u",IM={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function PM(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Vr(bb,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},IM,t);const{width:e,height:n}=t;function i(l){if(t.throwOnError)throw new Error(l);return console.error(l),null}t.onError=i;let r;const{canvas:a}=t,h=kU({canvas:a,width:e,height:n,onError:i});return r=FU(h,t),r?(r=wb(r,t),zU(r),r):null}function wb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||NU(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},IM,e);const{manageState:n,debug:i}=e;return n&&CM(t,{copyState:!1,log:function(){for(var r=arguments.length,a=new Array(r),h=0;h<r;h++)a[h]=arguments[h];return _t.log(1,...a)()}}),bb&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),_t.level=Math.max(_t.level,1)):_t.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function DU(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),r=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),a=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||e,renderer:a||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function OU(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=BU(e.useDevicePixels);UU(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function FU(t,e){const{onError:n}=e;let i=null;const r=_=>i=_.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:a=!0,webgl2:h=!0}=e;let l=null;return h&&(l=l||t.getContext("webgl2",e),l=l||t.getContext("experimental-webgl2",e)),a&&(l=l||t.getContext("webgl",e),l=l||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",r,!1),l?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):n("Failed to create ".concat(h&&!a?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function kU(t){let{canvas:e,width:n=800,height:i=600,onError:r}=t,a;return typeof e=="string"?(RU&&document.readyState==="complete"||r("createGLContext called on canvas '".concat(e,"' before page was loaded")),a=document.getElementById(e)):e?a=e:(a=document.createElement("canvas"),a.id="lumagl-canvas",a.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",a.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(a,document.body.firstChild)),a}function zU(t){const e=Xt(t)?"WebGL2":"WebGL1",n=DU(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",r=t.debug?" debug":"";_t.info(1,"".concat(e).concat(r," context ").concat(i))()}function NU(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function UU(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,r="height"in n?n.height:t.canvas.clientHeight;(!i||!r)&&(_t.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,r=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const a=t.luma.canvasSizeInfo;if(a.clientWidth!==i||a.clientHeight!==r||a.devicePixelRatio!==e){let h=e;const l=Math.floor(i*h),_=Math.floor(r*h);t.canvas.width=l,t.canvas.height=_,(t.drawingBufferWidth!==l||t.drawingBufferHeight!==_)&&(_t.warn("Device pixel ratio clamped")(),h=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/r),t.canvas.width=Math.floor(i*h),t.canvas.height=Math.floor(r*h)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:e})}}function KT(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let YT=class{constructor(e,n){R(this,"name",void 0),R(this,"type",void 0),R(this,"sampleSize",1),R(this,"time",void 0),R(this,"count",void 0),R(this,"samples",void 0),R(this,"lastTiming",void 0),R(this,"lastSampleTime",void 0),R(this,"lastSampleCount",void 0),R(this,"_count",0),R(this,"_time",0),R(this,"_samples",0),R(this,"_startTime",0),R(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=KT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(KT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},Ab=class{constructor(e){R(this,"id",void 0),R(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof YT?this.stats[n]=e:this.stats[n]=new YT(n,i)),this.stats[n]}};const Rf="8.5.21",GU="set luma.log.level=1 (or higher) to trace rendering";class VU{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Ab({id:e})),this.stats.get(e)}}const Fc=new VU;if(globalThis.luma&&globalThis.luma.VERSION!==Rf)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Rf));globalThis.luma||(Ja()&&_t.log(1,"luma.gl ".concat(Rf," - ").concat(GU))(),globalThis.luma=globalThis.luma||{VERSION:Rf,version:Rf,log:_t,stats:Fc,globals:{modules:{},nodeIO:{}}});function jU(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function HU(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function at(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function G0(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return at(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function Ul(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const V0={};function Xa(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";V0[t]=V0[t]||1;const e=V0[t]++;return"".concat(t,"-").concat(e)}function QT(t){return at(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function zh(t){let e=!0;for(const n in t){e=!1;break}return e}function MM(t,e,n,i){const r="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),a=Object.getPrototypeOf(t);i.forEach(h=>{a.methodName||(a[h]=()=>{throw _t.removed("Calling removed method ".concat(e,".").concat(h,": "),r)(),new Error(h)})})}const Xu="Resource subclass must define virtual methods";let Ka=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};k_(e);const{id:i,userData:r={}}=n;this.gl=e,this.gl2=e,this.id=i||Xa(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=G0(this.gl,e),at(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const a=Xt(this.gl);if(!((!("webgl2"in r)||a)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const l=r.webgl1,_="webgl2"in r?r.webgl2:r.webgl1;return a?_:l}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,r=this.constructor.PARAMETERS||{},a=Xt(this.gl),h={},l=n||Object.keys(r);for(const _ of l){const v=r[_];if(v&&(!("webgl2"in v)||a)&&(!("extension"in v)||this.gl.getExtension(v.extension))){const I=i?Ul(this.gl,_):_;h[I]=this.getParameter(_,e),i&&v.type==="GLenum"&&(h[I]=Ul(this.gl,h[I]))}}return h}setParameter(e,n){e=G0(this.gl,e),at(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const a=Xt(this.gl);if(!((!("webgl2"in r)||a)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");r.type==="GLenum"&&(n=G0(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return MM(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(Xu)}_deleteHandle(){throw new Error(Xu)}_bindHandle(e){throw new Error(Xu)}_getOptsFromHandle(){throw new Error(Xu)}_getParameter(e,n){throw new Error(Xu)}_setParameter(e,n){throw new Error(Xu)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=Fc.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Fc.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const r=Fc.get("Memory Usage".concat(i));r.get("GPU Memory").addCount(e),r.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=Fc.get("Memory Usage".concat(n));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const WU="Failed to deduce GL constant from typed array";function B1(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(WU)}}function tp(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function qU(t){let{data:e,width:n,height:i,bytesPerPixel:r=4,temp:a}=t;const h=n*r;a=a||new Uint8Array(h);for(let l=0;l<i/2;++l){const _=l*h,v=(i-l-1)*h;a.set(e.subarray(_,_+h)),e.copyWithin(_,v,v+h),e.set(a,v)}}function XU(t){let{data:e,width:n,height:i}=t;const r=Math.round(n/2),a=Math.round(i/2),h=new Uint8Array(r*a*4);for(let l=0;l<a;l++)for(let _=0;_<r;_++)for(let v=0;v<4;v++)h[(l*r+_)*4+v]=e[(l*2*n+_*2)*4+v];return{data:h,width:r,height:a}}function L1(t,e,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:a={}}=n;for(const l in i)if(l in e){const v=i[l]?"".concat(t,".").concat(i[l]):"N/A";_t.removed("".concat(t,".").concat(l),v)()}for(const l in r)if(l in e){const _=r[l];_t.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(_))()}let h=null;for(const l in a)if(l in e){const _=a[l];_t.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(_))(),h=h||Object.assign({},e),h[_]=e[l],delete h[l]}return h||e}const $U={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},ZU={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ss{static getBytesPerElement(e){return tp(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return at(e.size),tp(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new ss($U,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ss.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ss.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=L1("Accessor",e,ZU),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const eS=10,BM={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},JU={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:BM},KU={removedProps:BM};class _n extends Ka{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ss.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ss.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=L1("Buffer",e,JU),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=L1("Buffer",e,KU),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new ss(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:r=0}=e,a=e.byteLength||e.length;at(n);const h=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(h,this.handle),r!==0||a!==void 0?(jr(this.gl),this.gl.bufferSubData(this.target,i,n,r,a)):this.gl.bufferSubData(h,i,n),this.gl.bindBuffer(h,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:r=0,size:a}=e;const{gl:h}=this;return jr(h),h.bindBuffer(36662,n.handle),h.bindBuffer(36663,this.handle),h.copyBufferSubData(36662,36663,i,r,a),h.bindBuffer(36662,null),h.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};jr(this.gl);const a=tp(this.accessor.type||5126,{clamped:!1}),h=this._getAvailableElementCount(n),l=i;let _,v;e?(v=e.length,_=v-l):(_=Math.min(h,r||h),v=l+_);const S=Math.min(h,_);return r=r||S,at(r<=S),e=e||new a(v),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,r),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?r!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,r):(at(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(eS,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;at(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.usage),this.gl.bufferSubData(r,n,e),this.gl.bindBuffer(r,null),this.debugData=e.slice(0,eS),this.bytesUsed=i,this._trackAllocatedMemory(i);const a=B1(e);return at(a),this.setAccessor(new ss(this.accessor,{type:a})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;at(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,n),this.gl.bindBuffer(r,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=tp(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new ss(this.accessor,{type:B1(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return _t.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return _t.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return _t.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return _t.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new ss(this.accessor,e),this}}const Eb={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},LM={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},RM={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function YU(t,e){const n=Eb[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=Xt(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function QU(t,e){const n=Eb[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const e4=[9729,9728],tS=globalThis.WebGLBuffer||function(){};class Nh extends Ka{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:r}=n;let a=!0;return i&&(a=a&&YU(e,i),a=a&&(!r||QU(e,i))),a}constructor(e,n){const{id:i=Xa("texture"),handle:r,target:a}=n;super(e,{id:i,handle:r}),this.target=a,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(W=>this.initialize(Object.assign({},e,{pixels:W,data:W}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:r=null,format:a=6408,border:h=0,recreate:l=!1,parameters:_={},pixelStore:v={},textureUnit:S=void 0}=e;n||(n=r);let{width:I,height:B,dataFormat:z,type:V,compressed:J=!1,mipmaps:ue=!0}=e;const{depth:j=0}=e;return{width:I,height:B,compressed:J,dataFormat:z,type:V}=this._deduceParameters({format:a,type:V,dataFormat:z,compressed:J,data:n,width:I,height:B}),this.width=I,this.height=B,this.depth=j,this.format=a,this.type=V,this.dataFormat=z,this.border=h,this.textureUnit=S,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),ue&&this._isNPOT()&&(_t.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),ue=!1,this._updateForNPOT(_)),this.mipmaps=ue,this.setImageData({data:n,width:I,height:B,depth:j,format:a,type:V,dataFormat:z,border:h,mipmaps:ue,parameters:v,compressed:J}),ue&&this.generateMipmap(),this.setParameters(_),l&&(this.data=n),i&&(this._video={video:n,parameters:_,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:r=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(_t.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Do(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:r=0,format:a=this.format,border:h=this.border,offset:l=0,parameters:_={}}=e;let{data:v=null,type:S=this.type,width:I=this.width,height:B=this.height,dataFormat:z=this.dataFormat,compressed:V=!1}=e;v||(v=i),{type:S,dataFormat:z,compressed:V,width:I,height:B}=this._deduceParameters({format:a,type:S,dataFormat:z,compressed:V,data:v,width:I,height:B});const{gl:J}=this;J.bindTexture(this.target,this.handle);let ue=null;({data:v,dataType:ue}=this._getDataType({data:v,compressed:V}));let j,W=0;if(Do(this.gl,_,()=>{switch(ue){case"null":J.texImage2D(n,r,a,I,B,h,z,S,v);break;case"typed-array":J.texImage2D(n,r,a,I,B,h,z,S,v,l);break;case"buffer":j=jr(J),j.bindBuffer(35052,v.handle||v),j.texImage2D(n,r,a,I,B,h,z,S,l),j.bindBuffer(35052,null);break;case"browser-object":Xt(J)?J.texImage2D(n,r,a,I,B,h,z,S,v):J.texImage2D(n,r,a,z,S,v);break;case"compressed":for(const[Z,ae]of v.entries())J.compressedTexImage2D(n,Z,ae.format,ae.width,ae.height,h,ae.data),W+=ae.levelSize;break;default:at(!1,"Unknown image data type")}}),ue==="compressed")this._trackAllocatedMemory(W,"Texture");else if(v&&v.byteLength)this._trackAllocatedMemory(v.byteLength,"Texture");else{const Z=LM[this.dataFormat]||4,ae=RM[this.type]||1;this._trackAllocatedMemory(this.width*this.height*Z*ae,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:r=null,x:a=0,y:h=0,width:l=this.width,height:_=this.height,level:v=0,format:S=this.format,type:I=this.type,dataFormat:B=this.dataFormat,compressed:z=!1,offset:V=0,border:J=this.border,parameters:ue={}}=e;if({type:I,dataFormat:B,compressed:z,width:l,height:_}=this._deduceParameters({format:S,type:I,dataFormat:B,compressed:z,data:r,width:l,height:_}),at(this.depth===0,"texSubImage not supported for 3D textures"),r||(r=i),r&&r.data){const j=r;r=j.data,l=j.shape[0],_=j.shape[1]}r instanceof _n&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),Do(this.gl,ue,()=>{if(z)this.gl.compressedTexSubImage2D(n,v,a,h,l,_,S,r);else if(r===null)this.gl.texSubImage2D(n,v,a,h,l,_,B,I,null);else if(ArrayBuffer.isView(r))this.gl.texSubImage2D(n,v,a,h,l,_,B,I,r,V);else if(r instanceof tS){const j=jr(this.gl);j.bindBuffer(35052,r),j.texSubImage2D(n,v,a,h,l,_,B,I,V),j.bindBuffer(35052,null)}else Xt(this.gl)?jr(this.gl).texSubImage2D(n,v,a,h,l,_,B,I,r):this.gl.texSubImage2D(n,v,a,h,B,I,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return _t.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof _n?{data:n.handle,dataType:"buffer"}:n instanceof tS?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:r,height:a,dataFormat:h,type:l,compressed:_}=e;const v=Eb[n];return h=h||v&&v.dataFormat,l=l||v&&v.types[0],_=_||v&&v.compressed,{width:r,height:a}=this._deduceImageSize(i,r,a),{dataFormat:h,type:l,compressed:_,width:r,height:a,format:n,data:i}}_deduceImageSize(e,n,i){let r;return typeof ImageData<"u"&&e instanceof ImageData?r={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?r={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?r={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?r={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?r={width:e.videoWidth,height:e.videoHeight}:e?r={width:n,height:i}:r={width:n>=0?n:1,height:i>=0?i:1},at(r,"Could not deduced texture size"),at(n===void 0||r.width===n,"Deduced texture width does not match supplied width"),at(i===void 0||r.height===i,"Deduced texture height does not match supplied height"),r}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:at(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Xt(this.gl)||!this.width||!this.height?!1:!QT(this.width)||!QT(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:e4.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let t4="";function n4(t,e){return at(typeof t=="string"),t=t4+t,new Promise((n,i)=>{try{const r=new Image;r.onload=()=>n(r),r.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),r.crossOrigin=e&&e.crossOrigin||"anonymous",r.src=t}catch(r){i(r)}})}class Ds extends Nh{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return Nh.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};k_(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:n4(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const R1=[34069,34070,34071,34072,34073,34074];class DM extends Nh{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};k_(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:r=0,y:a=0,mipmapLevel:h=0}=e;return this._subImage({target:n,data:i,x:r,y:a,mipmapLevel:h})}async setCubeMapImageData(e){let{width:n,height:i,pixels:r,data:a,border:h=0,format:l=6408,type:_=5121}=e;const{gl:v}=this,S=r||a,I=await Promise.all(R1.map(B=>{const z=S[B];return Promise.all(Array.isArray(z)?z:[z])}));this.bind(),R1.forEach((B,z)=>{I[z].length>1&&this.opts.mipmaps!==!1&&_t.warn("".concat(this.id," has mipmap and multiple LODs."))(),I[z].forEach((V,J)=>{n&&i?v.texImage2D(B,J,l,n,i,h,l,_,V):v.texImage2D(B,J,l,l,_,V)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:r,pixels:a,data:h,border:l=0,format:_=6408,type:v=5121}=e,{gl:S}=this,I=a||h;return this.bind(),I instanceof Promise?I.then(B=>this.setImageDataForFace(Object.assign({},e,{face:n,data:B,pixels:B}))):this.width||this.height?S.texImage2D(n,0,_,i,r,l,_,v,I):S.texImage2D(n,0,_,_,v,I),this}}DM.FACES=R1;class i4 extends Nh{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Xt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};jr(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:r,height:a,depth:h=1,border:l=0,format:_,type:v=5121,offset:S=0,data:I,parameters:B={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Do(this.gl,B,()=>{ArrayBuffer.isView(I)&&this.gl.texImage3D(this.target,n,i,r,a,h,l,_,v,I),I instanceof _n&&(this.gl.bindBuffer(35052,I.handle),this.gl.texImage3D(this.target,n,i,r,a,h,l,_,v,S))}),I&&I.byteLength)this._trackAllocatedMemory(I.byteLength,"Texture");else{const z=LM[this.dataFormat]||4,V=RM[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*z*V,"Texture")}return this.loaded=!0,this}}const Sc="EXT_color_buffer_float",nS={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:Sc,bpp:2},33327:{gl2:Sc,bpp:4},34842:{gl2:Sc,bpp:8},33326:{gl2:Sc,bpp:4},33328:{gl2:Sc,bpp:8},34836:{gl2:Sc,bpp:16},35898:{gl2:Sc,bpp:4}};function r4(t,e,n){const i=n[e];if(!i)return!1;const r=Xt(t)&&i.gl2||i.gl1;return typeof r=="string"?t.getExtension(r):r}class ph extends Ka{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||r4(e,n,nS)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:r=1,samples:a=0}=e;return at(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),a!==0&&Xt(this.gl)?this.gl.renderbufferStorageMultisample(36161,a,n,i,r):this.gl.renderbufferStorage(36161,n,i,r),this.format=n,this.width=i,this.height=r,this.samples=a,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*nS[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const s4=256,o4=1024,a4=16384,iS=6144,rS=6145,sS=6146,oS=34041,OM="clear: bad arguments";function Tb(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:r=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a={};e&&(a.framebuffer=e);let h=0;n&&(h|=a4,n!==!0&&(a.clearColor=n)),i&&(h|=s4,i!==!0&&(a.clearDepth=i)),r&&(h|=o4,i!==!0&&(a.clearStencil=i)),at(h!==0,OM),Do(t,a,()=>{t.clear(h)})}function l4(t){let{framebuffer:e=null,buffer:n=iS,drawBuffer:i=0,value:r=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};jr(t),Do(t,{framebuffer:e},()=>{switch(n){case iS:switch(r.constructor){case Int32Array:t.clearBufferiv(n,i,r);break;case Uint32Array:t.clearBufferuiv(n,i,r);break;case Float32Array:default:t.clearBufferfv(n,i,r)}break;case rS:t.clearBufferfv(rS,0,[r]);break;case sS:t.clearBufferiv(sS,0,[r]);break;case oS:const[a,h]=r;t.clearBufferfi(oS,0,a,h);break;default:at(!1,OM)}})}function c4(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return at(!1),0}}function z_(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=e;let{sourceAttachment:a=36064,target:h=null,sourceWidth:l,sourceHeight:_,sourceType:v}=e;const{framebuffer:S,deleteFramebuffer:I}=u4(t);at(S);const{gl:B,handle:z,attachments:V}=S;l=l||S.width,_=_||S.height,a===36064&&z===null&&(a=1028),at(V[a]),v=v||V[a].type,h=h4(h,v,r,l,_),v=v||B1(h);const J=B.bindFramebuffer(36160,z);return B.readPixels(n,i,l,_,r,v,h),B.bindFramebuffer(36160,J||null),I&&S.delete(),h}function aS(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=z_(t,{sourceAttachment:e}),{width:r,height:a}=t;for(;a>n;)({data:i,width:r,height:a}=XU({data:i,width:r,height:a}));qU({data:i,width:r,height:a});const h=document.createElement("canvas");h.width=r,h.height=a;const l=h.getContext("2d"),_=l.createImageData(r,a);return _.data.set(i),l.putImageData(_,0,0),h.toDataURL()}function u4(t){return t instanceof Gi?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:x4(t),deleteFramebuffer:!0}}function h4(t,e,n,i,r){if(t)return t;e=e||5121;const a=tp(e,{clamped:!1}),h=c4(n);return new a(i*r*h)}const Fn={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function d4(t){const e=new Ds(t,{format:6408,type:5126,dataFormat:6408}),n=new Gi(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const FM={[Fn.WEBGL2]:[!1,!0],[Fn.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Fn.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Fn.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Fn.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Fn.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Fn.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Fn.FLOAT_BLEND]:["EXT_float_blend"],[Fn.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Fn.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Fn.TEXTURE_FLOAT]:["OES_texture_float",!0],[Fn.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Fn.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Fn.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Fn.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Fn.COLOR_ATTACHMENT_RGBA32F]:[d4,"EXT_color_buffer_float"],[Fn.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Fn.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Fn.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Fn.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Fn.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Fn.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},f4=2;function Sb(t,e){return kM(t,e)}function kM(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>zM(t,n))}function p4(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in FM)t.luma.caps[e]===void 0&&(t.luma.caps[e]=zM(t,e));return t.luma.caps}function zM(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=m4(t,e)),t.luma.caps[e]||_t.log(f4,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function m4(t,e){const n=FM[e];at(n,e);let i;const r=Xt(t)&&n[1]||n[0];if(typeof r=="function")i=r(t);else if(Array.isArray(r)){i=!0;for(const a of r)i=i&&!!t.getExtension(a)}else typeof r=="string"?i=!!t.getExtension(r):typeof r=="boolean"?i=r:at(!1);return i}const lS="Multiple render targets not supported";class Gi extends Ka{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:r}=n;let a=!0;return i&&(a=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),r&&(a=a&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),a}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Gi(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=jr(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=jr(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:r=null,color:a=!0,depth:h=!0,stencil:l=!1,check:_=!0,readBuffer:v=void 0,drawBuffers:S=void 0}=e;if(at(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,r)for(const I in r){const B=r[I];(Array.isArray(B)?B[0]:B).resize({width:n,height:i})}else r=this._createDefaultAttachments(a,h,l,n,i);this.update({clearAttachments:!0,attachments:r,readBuffer:v,drawBuffers:S}),r&&_&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:r,clearAttachments:a=!1,resizeAttachments:h=!0}=e;this.attach(n,{clearAttachments:a,resizeAttachments:h});const{gl:l}=this,_=l.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),l.bindFramebuffer(36160,_||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return at(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&_t.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const r in this.attachments)this.attachments[r].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r={};n&&Object.keys(this.attachments).forEach(h=>{r[h]=null}),Object.assign(r,e);const a=this.gl.bindFramebuffer(36160,this.handle);for(const h in r){at(h!==void 0,"Misspelled framebuffer binding point?");const l=Number(h),_=r[l];let v=_;if(!v)this._unattach(l);else if(v instanceof ph)this._attachRenderbuffer({attachment:l,renderbuffer:v});else if(Array.isArray(_)){const[S,I=0,B=0]=_;v=S,this._attachTexture({attachment:l,texture:S,layer:I,level:B})}else this._attachTexture({attachment:l,texture:v,layer:0,level:0});i&&v&&v.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,a||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(h=>!this.attachments[h]).forEach(h=>{delete this.attachments[h]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(_4(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:r,drawBuffers:a=[]}=e,h=this.gl.bindFramebuffer(36160,this.handle);return(n||i||r)&&Tb(this.gl,{color:n,depth:i,stencil:r}),a.forEach((l,_)=>{l4(this.gl,{drawBuffer:_,value:l})}),this.gl.bindFramebuffer(36160,h||null),this}readPixels(){return _t.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return _t.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return _t.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return _t.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return _t.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return _t.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:r=0,width:a,height:h}=e;const l=jr(this.gl),_=l.bindFramebuffer(36008,this.handle);return i===0&&r===0&&a===void 0&&h===void 0?l.invalidateFramebuffer(36008,n):l.invalidateFramebuffer(36008,n,i,r,a,h),l.bindFramebuffer(36008,_),this}getAttachmentParameter(e,n,i){let r=this._getAttachmentParameterFallback(n);return r===null&&(this.gl.bindFramebuffer(36160,this.handle),r=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&r>1e3&&(r=Ul(this.gl,r)),r}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const r={};for(const a of i){const h=n?Ul(this.gl,a):a;r[h]=this.getAttachmentParameter(e,a,n)}return r}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const r of n){const a=Number(r),h=e?Ul(this.gl,a):a;i[h]=this.getAttachmentParameters(a,e)}return i}show(){return typeof window<"u"&&window.open(aS(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>_t.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=aS(this,{targetMaxHeight:100});return _t.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,r,a){let h=null;return e&&(h=h||{},h[36064]=new Ds(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:r,height:a,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(h[36064])),n&&i?(h=h||{},h[33306]=new ph(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:r,height:111}),this.ownResources.push(h[33306])):n?(h=h||{},h[36096]=new ph(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:r,height:a}),this.ownResources.push(h[36096])):i&&at(!1),h}_unattach(e){const n=this.attachments[e];n&&(n instanceof ph?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:r}=this;r.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:r,level:a}=e;const{gl:h}=this;switch(h.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:jr(h).framebufferTextureLayer(36160,n,i.target,a,r);break;case 34067:const _=g4(r);h.framebufferTexture2D(36160,n,_,i.handle,a);break;case 3553:h.framebufferTexture2D(36160,n,3553,i.handle,a);break;default:at(!1,"Illegal texture type")}h.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=qN(this.gl);n?n.readBuffer(e):at(e===36064||e===1029,lS),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=jr(n);if(i)i.drawBuffers(e);else{const r=n.getExtension("WEBGL_draw_buffers");r?r.drawBuffersWEBGL(e):at(e.length===1&&(e[0]===36064||e[0]===1029),lS)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=p4(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function g4(t){return t<34069?t+34069:t}function _4(t){return(Gi.STATUS||{})[t]||"Framebuffer error ".concat(t)}const y4=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Gi.ATTACHMENT_PARAMETERS=y4;function v4(t,e){at(t instanceof Ds||t instanceof DM||t instanceof i4);const n=t.constructor,{gl:i,width:r,height:a,format:h,type:l,dataFormat:_,border:v,mipmaps:S}=t,I=Object.assign({width:r,height:a,format:h,type:l,dataFormat:_,border:v,mipmaps:S},e);return new n(i,I)}function x4(t,e){const{gl:n,width:i,height:r,id:a}=t;return new Gi(n,Object.assign({},e,{id:"framebuffer-for-".concat(a),width:i,height:r,attachments:{36064:t}}))}function yg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const b4=35632,w4=35633;function A4(t){switch(t){case b4:return"fragment";case w4:return"vertex";default:return"unknown type"}}function E4(t,e,n,i){const r=t.split(/\r?\n/),a={},h={},l=i||yg(e)||"(unnamed)",_="".concat(A4(n)," shader ").concat(l);for(let S=0;S<r.length;S++){const I=r[S];if(I.length<=1)continue;const B=I.split(":"),z=B[0],V=parseInt(B[2],10);if(isNaN(V))throw new Error("GLSL compilation error in ".concat(_,": ").concat(t));z!=="WARNING"?a[V]=I:h[V]=I}const v=T4(e);return{shaderName:_,errors:cS(a,v),warnings:cS(h,v)}}function cS(t,e){let n="";for(let i=0;i<e.length;i++){const r=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(r,`
`),t[i+1])){const a=t[i+1],h=a.split(":",3),l=h[0],_=parseInt(h[1],10)||0,v=a.substring(h.join(":").length+1).trim();n+=NM("^^^ ".concat(l,": ").concat(v,`

`),_)}}return n}function T4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map((a,h)=>{const l=String(h+e),_=l.length;return NM(l,r-_)+n+a})}function NM(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function UM(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const S4="Shader: GLSL source code must be a JavaScript string";class np extends Ka{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return at(!1),"unknown"}}constructor(e,n){k_(e),at(typeof n.source=="string",S4);const i=yg(n.source,null)||n.id||Xa("unnamed ".concat(np.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=yg(n,null);i&&(this.id=Xa(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(np.getTypeName(this.shaderType),":").concat(this.id)}getName(){return yg(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:a,warnings:h}=E4(i,this.source,this.shaderType,this.id);throw _t.error("GLSL compilation errors in ".concat(r,`
`).concat(a))(),_t.warn("GLSL compilation warnings in ".concat(r,`
`).concat(h))(),new Error("GLSL compilation errors in ".concat(r))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class j0 extends np{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class H0 extends np{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const C4={5126:Un.bind(null,"uniform1fv",As,1,Ar),35664:Un.bind(null,"uniform2fv",As,2,Ar),35665:Un.bind(null,"uniform3fv",As,3,Ar),35666:Un.bind(null,"uniform4fv",As,4,Ar),5124:Un.bind(null,"uniform1iv",vl,1,Ar),35667:Un.bind(null,"uniform2iv",vl,2,Ar),35668:Un.bind(null,"uniform3iv",vl,3,Ar),35669:Un.bind(null,"uniform4iv",vl,4,Ar),35670:Un.bind(null,"uniform1iv",vl,1,Ar),35671:Un.bind(null,"uniform2iv",vl,2,Ar),35672:Un.bind(null,"uniform3iv",vl,3,Ar),35673:Un.bind(null,"uniform4iv",vl,4,Ar),35674:Un.bind(null,"uniformMatrix2fv",As,4,Ia),35675:Un.bind(null,"uniformMatrix3fv",As,9,Ia),35676:Un.bind(null,"uniformMatrix4fv",As,16,Ia),35678:sr,35680:sr,5125:Un.bind(null,"uniform1uiv",Dm,1,Ar),36294:Un.bind(null,"uniform2uiv",Dm,2,Ar),36295:Un.bind(null,"uniform3uiv",Dm,3,Ar),36296:Un.bind(null,"uniform4uiv",Dm,4,Ar),35685:Un.bind(null,"uniformMatrix2x3fv",As,6,Ia),35686:Un.bind(null,"uniformMatrix2x4fv",As,8,Ia),35687:Un.bind(null,"uniformMatrix3x2fv",As,6,Ia),35688:Un.bind(null,"uniformMatrix3x4fv",As,12,Ia),35689:Un.bind(null,"uniformMatrix4x2fv",As,8,Ia),35690:Un.bind(null,"uniformMatrix4x3fv",As,12,Ia),35678:sr,35680:sr,35679:sr,35682:sr,36289:sr,36292:sr,36293:sr,36298:sr,36299:sr,36300:sr,36303:sr,36306:sr,36307:sr,36308:sr,36311:sr},I4={},P4={},M4={},uS=[0];function Cb(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(uS[0]=t,t=uS);const r=t.length;if(r%e&&_t.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let a=i[r];a||(a=new n(r),i[r]=a);for(let h=0;h<r;h++)a[h]=t[h];return a}function As(t,e){return Cb(t,e,Float32Array,I4)}function vl(t,e){return Cb(t,e,Int32Array,P4)}function Dm(t,e){return Cb(t,e,Uint32Array,M4)}function hS(t,e,n){const i=C4[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function B4(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function L4(t,e,n){for(const i in t){const r=t[i];if((!n||!!n[i])&&!R4(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),r),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function R4(t){return Array.isArray(t)||ArrayBuffer.isView(t)?O4(t):isFinite(t)||t===!0||t===!1||t instanceof Nh||t instanceof ph?!0:t instanceof Gi?!!t.texture:!1}function D4(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let r=0,a=n.length;r<a;++r)i[r]=n[r]}else t[e]=n.slice();else t[e]=n}function O4(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function sr(){let t=null;return(e,n,i)=>{const r=t!==i;return r&&(e.uniform1i(n,i),t=i),r}}function Un(t,e,n,i){let r=null,a=null;return(h,l,_)=>{const v=e(_,n),S=v.length;let I=!1;if(r===null)r=new Float32Array(S),a=S,I=!0;else{at(a===S,"Uniform length cannot change.");for(let B=0;B<S;++B)if(v[B]!==r[B]){I=!0;break}}return I&&(i(h,t,l,v),r.set(v)),I}}function Ar(t,e,n,i){t[e](n,i)}function Ia(t,e,n,i){t[e](n,!1,i)}const F4=5120,k4=5121,z4=5122,N4=5123,dS=0,Om=1,U4=2,G4=3,Fm=4,V4=5,j4=6,Fi=5126,H4=35664,W4=35665,q4=35666,sf=5124,X4=35667,$4=35668,Z4=35669,of=5125,J4=36294,K4=36295,Y4=36296,Q4=35670,e6=35671,t6=35672,n6=35673,i6=35674,r6=35675,s6=35676,o6=35685,a6=35686,l6=35687,c6=35688,u6=35689,h6=35690,D1={[Fi]:[Fi,1,"float"],[H4]:[Fi,2,"vec2"],[W4]:[Fi,3,"vec3"],[q4]:[Fi,4,"vec4"],[sf]:[sf,1,"int"],[X4]:[sf,2,"ivec2"],[$4]:[sf,3,"ivec3"],[Z4]:[sf,4,"ivec4"],[of]:[of,1,"uint"],[J4]:[of,2,"uvec2"],[K4]:[of,3,"uvec3"],[Y4]:[of,4,"uvec4"],[Q4]:[Fi,1,"bool"],[e6]:[Fi,2,"bvec2"],[t6]:[Fi,3,"bvec3"],[n6]:[Fi,4,"bvec4"],[i6]:[Fi,8,"mat2"],[o6]:[Fi,8,"mat2x3"],[a6]:[Fi,8,"mat2x4"],[r6]:[Fi,12,"mat3"],[l6]:[Fi,12,"mat3x2"],[c6]:[Fi,12,"mat3x4"],[s6]:[Fi,16,"mat4"],[u6]:[Fi,16,"mat4x2"],[h6]:[Fi,16,"mat4x3"]};function d6(t){switch(t){case dS:return dS;case Om:return Om;case G4:return Om;case U4:return Om;case Fm:return Fm;case V4:return Fm;case j4:return Fm;default:return at(!1),0}}function fS(t){const e=D1[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function GM(t,e){switch(t){case F4:case k4:case z4:case N4:t=Fi;break}for(const n in D1){const[i,r,a]=D1[n];if(i===t&&r===e)return{glType:n,name:a}}return null}class f6{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let r=0;r<i;r++){const{name:a,type:h,size:l}=n.getActiveAttrib(e.handle,r),_=n.getAttribLocation(e.handle,a);_>=0&&this._addAttribute(_,a,h,l)}this.attributeInfos.sort((r,a)=>r.location-a.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Xt(n))return;const i=n.getProgramParameter(e.handle,35971);for(let r=0;r<i;r++){const{name:a,type:h,size:l}=n.getTransformFeedbackVarying(e.handle,r);this._addVarying(r,a,h,l)}this.varyingInfos.sort((r,a)=>r.location-a.location)}_addAttribute(e,n,i,r){const{type:a,components:h}=fS(i),l={type:a,size:r*h};this._inferProperties(e,n,l);const _={location:e,name:n,accessor:new ss(l)};this.attributeInfos.push(_),this.attributeInfosByLocation[e]=_,this.attributeInfosByName[_.name]=_}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,r){const{type:a,components:h}=fS(i),l=new ss({type:a,size:r*h}),_={location:e,name:n,accessor:l};this.varyingInfos.push(_),this.varyingInfosByName[_.name]=_}}const pS=4,p6=35981,m6=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class VM extends Ka{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",m6),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:r,varyings:a,bufferMode:h=p6}=e;return this.hash=n||"",this.vs=typeof i=="string"?new j0(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof r=="string"?new H0(this.gl,{id:"".concat(e.id,"-fs"),source:r}):r,at(this.vs instanceof j0),at(this.fs instanceof H0),this.uniforms={},this._textureUniforms={},a&&a.length>0&&(jr(this.gl),this.varyings=a,this.gl2.transformFeedbackVaryings(this.handle,a,h)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new f6(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:r,offset:a=0,start:h,end:l,isIndexed:_=!1,indexType:v=5123,instanceCount:S=0,isInstanced:I=S>0,vertexArray:B=null,transformFeedback:z,framebuffer:V,parameters:J={},uniforms:ue,samplers:j}=e;if((ue||j)&&(_t.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(ue||{})),_t.priority>=n){const W=V?V.id:"default",Z="mode=".concat(Ul(this.gl,i)," verts=").concat(r," ")+"instances=".concat(S," indexType=").concat(Ul(this.gl,v)," ")+"isInstanced=".concat(I," isIndexed=").concat(_," ")+"Framebuffer=".concat(W);_t.log(n,Z)()}return at(B),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||r===0||I&&S===0?!1:(B.bindForDraw(r,S,()=>{if(V!==void 0&&(J=Object.assign({},J,{framebuffer:V})),z){const W=d6(i);z.begin(W)}this._bindTextures(),Do(this.gl,J,()=>{_&&I?this.gl2.drawElementsInstanced(i,r,v,a,S):_&&Xt(this.gl)&&!isNaN(h)&&!isNaN(l)?this.gl2.drawRangeElements(i,h,l,r,v,a):_?this.gl.drawElements(i,r,v,a):I?this.gl2.drawArraysInstanced(i,a,r,S):this.gl.drawArrays(i,a,r)}),z&&z.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};_t.priority>=2&&L4(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],r=this._uniformSetters[n];if(r){let a=i,h=!1;if(a instanceof Gi&&(a=a.texture),a instanceof Nh)if(h=this.uniforms[n]!==i,h){r.textureIndex===void 0&&(r.textureIndex=this._textureIndexCounter++);const l=a,{textureIndex:_}=r;l.bind(_),a=_,this._textureUniforms[n]=l}else a=r.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(r(a)||h)&&D4(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const r of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new j0({handle:r});break;case 35632:i.fs=new H0({handle:r});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=Xa(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),_t.time(pS,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),_t.timeEnd(pS,"linkProgram for ".concat(this._getName()))(),e.debug||_t.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:r}=B4(i.name);let a=e.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=hS(e,a,i),i.size>1)for(let h=0;h<i.size;h++)a=e.getUniformLocation(this.handle,"".concat(r,"[").concat(h,"]")),this._uniformSetters["".concat(r,"[").concat(h,"]")]=hS(e,a,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const g6=34918,_6=34919,y6=35007,v6=36795,x6=35976,b6=35887,w6=36202;class n_ extends Ka{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=Xt(e),r=kM(e,Fn.TIMER_QUERY);let a=i||r;for(const h of n)switch(h){case"queries":a=a&&i;break;case"timers":a=a&&r;break;default:at(!1)}return a}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(y6)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?w6:b6)}beginTransformFeedbackQuery(){return this.begin(x6)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,_6);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(v6)}getResult(){return this.gl2.getQueryParameter(this.handle,g6)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,r)=>{const a=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(a)};requestAnimationFrame(a)}),this._pollingPromise}_createHandle(){return n_.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class jM extends Ka{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Xt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};jr(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,zh(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:r,byteSize:a,byteOffset:h}=this._getBufferParams(n);return i<0?(this.unused[e]=r,_t.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,r,h,a),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,r;return e instanceof _n?r=e:(r=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||r.byteLength-n),{buffer:r,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:r}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,r,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const a=n&&n.handle;return!a||r===void 0?this.gl.bindBufferBase(35982,e,a):this.gl.bindBufferRange(35982,e,a,i,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let km=null;function A6(t){return(!km||km.byteLength<t)&&(km=new ArrayBuffer(t)),km}function E6(t,e){const n=A6(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function T6(t){let{target:e,source:n,start:i=0,count:r=1}=t;const a=n.length,h=r*a;let l=0;for(let _=i;l<a;l++)e[_++]=n[l];for(;l<h;)l<h-l?(e.copyWithin(i+l,i,i+l),l*=2):(e.copyWithin(i+l,i,i+h-l),l=h);return e}const S6="elements must be GL.ELEMENT_ARRAY_BUFFER";class Ss extends Ka{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Xt(e)||wM()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Ss(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Ss.MAX_ATTRIBUTES=Ss.MAX_ATTRIBUTES||e.getParameter(34921),Ss.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:Ss._setConstantFloatArray(e,n,i);break;case Int32Array:Ss._setConstantIntArray(e,n,i);break;case Uint32Array:Ss._setConstantUintArray(e,n,i);break;default:at(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Ss.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return at(!e||e.target===34963,S6),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:r,type:a,stride:h,offset:l,normalized:_,integer:v,divisor:S}=i,{gl:I,gl2:B}=this;return e=Number(e),this.bind(()=>{I.bindBuffer(34962,n.handle),v?(at(Xt(I)),B.vertexAttribIPointer(e,r,a,h,l)):I.vertexAttribPointer(e,r,a,_,h,l),I.enableVertexAttribArray(e),B.vertexAttribDivisor(e,S||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!Ss.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),r=i.byteLength*e,a=i.length*e;let h=!this.buffer;if(this.buffer=this.buffer||new _n(this.gl,r),h=h||this.buffer.reallocate(r),h=h||!this._compareConstantArrayValues(i,this.bufferValue),h){const l=E6(n.constructor,a);T6({target:l,source:i,start:0,count:a}),this.buffer.subData(l),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:at(!1)}}static _setConstantIntArray(e,n,i){switch(at(Xt(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:at(!1)}}static _setConstantUintArray(e,n,i){switch(at(Xt(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:at(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return at(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const C6="VertexArray: attributes must be Buffers or constants (i.e. typed array)",I6=/^(.+)__LOCATION_([0-9]+)$/,P6=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class M6{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Ss(e),MM(this,"VertexArray","v6.0",P6),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:r,accessor:a}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return r>=0&&(this.values[r]=n,this.accessors[r]=a,this.clearDrawParams(),this.vertexArrayObject.setBuffer(r,n,a)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:r,accessor:a}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return r>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[r]=n,this.accessors[r]=a,this.clearDrawParams(),this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new _n(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof _n&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof _n&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let r;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),r=i()}),r}_resolveLocationAndAccessor(e,n,i,r){const a={location:-1,accessor:null},{location:h,name:l}=this._getAttributeIndex(e);if(!Number.isFinite(h)||h<0)return this.unused[e]=n,_t.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),a;const _=this._getAttributeInfo(l||h);if(!_)return a;const v=this.accessors[h]||{},S=ss.resolve(_.accessor,v,i,r),{size:I,type:B}=S;return at(Number.isFinite(I)&&Number.isFinite(B)),{location:h,accessor:S}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=I6.exec(e),r=i?i[1]:e,a=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+a,name:r}:{location:-1}}_setAttribute(e,n){if(n instanceof _n)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof _n){const i=n[0],r=n[1];this.setBuffer(e,i,r)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof _n){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(C6)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,i);for(let a=1;a<this.vertexArrayObject.MAX_ATTRIBUTES;a++)r=this.values[a],ArrayBuffer.isView(r)&&this._setConstantAttribute(a,r)}_setConstantAttributeZero(e,n){if(Ss.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){Ss.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],r=this.accessors[n];if(!i)return;const{divisor:a}=r,h=a>0;if(e.isInstanced=e.isInstanced||h,i instanceof _n){const l=i;if(h){const _=l.getVertexCount(r);e.instanceCount=Math.min(e.instanceCount,_)}else{const _=l.getVertexCount(r);e.vertexCount=Math.min(e.vertexCount,_)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return _t.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function B6(t,e){const{maxElts:n=16,size:i=1}=e;let r="[";for(let h=0;h<t.length&&h<n;++h)h>0&&(r+=",".concat(h%i===0?" ":"")),r+=ip(t[h],e);const a=t.length>n?"...":"]";return"".concat(r).concat(a)}function ip(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return B6(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const r=t.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function mS(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:r=!1}=t;at(n);const a=".*_.*",h=".*Matrix",l=n._uniformSetters,_={},v=Object.keys(l).sort();let S=0;for(const z of v)!z.match(a)&&!z.match(h)&&W0({table:_,header:e,uniforms:i,uniformName:z,undefinedOnly:r})&&S++;for(const z of v)z.match(h)&&W0({table:_,header:e,uniforms:i,uniformName:z,undefinedOnly:r})&&S++;for(const z of v)_[z]||W0({table:_,header:e,uniforms:i,uniformName:z,undefinedOnly:r})&&S++;let I=0;const B={};if(!r)for(const z in i){const V=i[z];_[z]||(I++,B[z]={Type:"NOT USED: ".concat(V),[e]:ip(V)})}return{table:_,count:S,unusedTable:B,unusedCount:I}}function W0(t){let{table:e,header:n,uniforms:i,uniformName:r,undefinedOnly:a}=t;const h=i[r],l=L6(h);return!a||!l?(e[r]={[n]:l?ip(h):"N/A","Uniform Type":l?h:"NOT PROVIDED"},!0):!1}function L6(t){return t!=null}function R6(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=gS(e,e.elements,null,n));const r=e.values;for(const a in r){const h=e._getAttributeInfo(a);if(h){let l="".concat(a,": ").concat(h.name);const _=e.accessors[h.location];_&&(l="".concat(a,": ").concat(D6(h.name,_))),i[l]=gS(e,r[a],_,n)}}return i}function gS(t,e,n,i){const{gl:r}=t;if(!e)return{[i]:"null","Format ":"N/A"};let a="NOT PROVIDED",h=1,l=0,_=0,v,S,I;if(n&&(a=n.type,h=n.size,a=String(a).replace("Array",""),v=a.indexOf("nt")!==-1),e instanceof _n){const B=e,{data:z,changed:V}=B.getDebugData();S=V?"*":"",I=z,_=B.byteLength,l=_/z.BYTES_PER_ELEMENT/h;let J;if(n){const ue=n.divisor>0;J="".concat(ue?"I ":"P "," ").concat(l," (x").concat(h,"=").concat(_," bytes ").concat(Ul(r,a),")")}else v=!0,J="".concat(_," bytes");return{[i]:"".concat(S).concat(ip(I,{size:h,isInteger:v})),"Format ":J}}return I=e,h=e.length,a=String(e.constructor.name).replace("Array",""),v=a.indexOf("nt")!==-1,{[i]:"".concat(ip(I,{size:h,isInteger:v})," (constant)"),"Format ":"".concat(h,"x").concat(a," (constant)")}}function D6(t,e){const{type:n,size:i}=e,r=GM(n,i);return r?"".concat(t," (").concat(r.name,")"):t}function O6(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const r=_S(i);e["in ".concat(r)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const r=_S(i);e["out ".concat(r)]={[n]:JSON.stringify(i.accessor)}}return e}function _S(t){const{type:e,size:n}=t.accessor,i=GM(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const yS=Ja()&&typeof document<"u";let F6=0;class k6{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=ue=>PM(ue),onAddHTML:i=null,onInitialize:r=()=>{},onRender:a=()=>{},onFinalize:h=()=>{},onError:l,gl:_=null,glOptions:v={},debug:S=!1,createFramebuffer:I=!1,autoResizeViewport:B=!0,autoResizeDrawingBuffer:z=!0,stats:V=Fc.get("animation-loop-".concat(F6++))}=e;let{useDevicePixels:J=!0}=e;"useDevicePixelRatio"in e&&(_t.deprecated("useDevicePixelRatio","useDevicePixels")(),J=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:r,onRender:a,onFinalize:h,onError:l,gl:_,glOptions:v,debug:S,createFramebuffer:I},this.gl=_,this.needsRedraw=null,this.timeline=null,this.stats=V,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:B,autoResizeDrawingBuffer:z,useDevicePixels:J}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return at(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=n_.isSupported(this.gl,["timers"])?new n_(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return _t.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=yS?new Promise((e,n)=>{if(yS&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):HU(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):jU(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?wb(this.props.gl,e):this.onCreateContext(e),!F_(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");MU(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:r}=this.gl;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&OU(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Gi(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const vp="vs",Ib="fs";function Ls(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const q0={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function z6(t){const e={};for(const n in t){const i=t[n],r=N6(i);e[n]=r}return e}function N6(t){let e=vS(t);return e==="object"?t?"type"in t?Object.assign({},t,q0[t.type]):"value"in t?(e=vS(t.value),Object.assign({type:e},t,q0[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},q0[e])}function vS(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const U6="vs",G6="fs";class xS{constructor(e){let{name:n,vs:i,fs:r,dependencies:a=[],uniforms:h,getUniforms:l,deprecations:_=[],defines:v={},inject:S={},vertexShader:I,fragmentShader:B}=e;Ls(typeof n=="string"),this.name=n,this.vs=i||I,this.fs=r||B,this.getModuleUniforms=l,this.dependencies=a,this.deprecations=this._parseDeprecationDefinitions(_),this.defines=v,this.injections=V6(S),h&&(this.uniforms=z6(h))}getModuleSource(e){let n;switch(e){case U6:n=this.vs||"";break;case G6:n=this.fs||"";break;default:Ls(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const r in i){const a=i[r];r in e&&!a.private?(a.validate&&Ls(a.validate(e[r],a),"".concat(this.name,": invalid ").concat(r)),n[r]=e[r]):n[r]=a.value}return n}}function V6(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const r=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[r][n]=i}return e}function j6(t){return H6(WM(t))}function H6(t){const e={},n={};return HM({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,r)=>n[r]-n[i]).map(i=>e[i])}function HM(t){let{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const a of e)i[a.name]=a,(r[a.name]===void 0||r[a.name]<n)&&(r[a.name]=n);for(const a of e)a.dependencies&&HM({modules:a.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function WM(t,e){return t.map(n=>(n instanceof xS||(Ls(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),Ls(n.name,"shader module has no name"),n=new xS(n),n.dependencies=WM(n.dependencies)),n))}function W6(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r}const q6=7936,X6=7937,$6=7938,Z6=35724,Pb={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Lc={};Object.keys(Pb).forEach(t=>{Lc[t]=t});function J6(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function K6(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||q6),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||X6);return{gpuVendor:Y6(n,i),vendor:n,renderer:i,version:t.getParameter($6),shadingLanguageVersion:t.getParameter(Z6)}}function Y6(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const X0={};function bS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=Pb[e];if(Ls(i,e),!W6(n))return!0;if(e in X0)return X0[e];const r=i[0],a=n.behavior||"enable",h="#extension GL_".concat(r," : ").concat(a,`
void main(void) {}`),l=t.createShader(35633);t.shaderSource(l,h),t.compileShader(l);const _=t.getShaderParameter(l,35713);return t.deleteShader(l),X0[e]=_,_}function Q6(t,e){const n=Pb[e];Ls(n,e);const i=J6(t)&&n[1]||n[0],r=typeof i=="string"?!!t.getExtension(i):i;return Ls(r===!1||r===!0),r}function zm(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>Q6(t,n))}function eG(t){switch(K6(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function tG(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return zm(t,Lc.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),zm(t,Lc.GLSL_DERIVATIVES)&&bS(t,Lc.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),zm(t,Lc.GLSL_FRAG_DATA)&&bS(t,Lc.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),zm(t,Lc.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const nG=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,iG=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,rG={[vp]:nG,[Ib]:iG},vg="__LUMA_INJECT_DECLARATIONS__",wS=/void\s+main\s*\([^)]*\)\s*\{\n?/,AS=/}\n?[^{}]*$/,$0=[];function ES(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=e===vp;for(const a in n){const h=n[a];h.sort((_,v)=>_.order-v.order),$0.length=h.length;for(let _=0,v=h.length;_<v;++_)$0[_]=h[_].injection;const l="".concat($0.join(`
`),`
`);switch(a){case"vs:#decl":r&&(t=t.replace(vg,l));break;case"vs:#main-start":r&&(t=t.replace(wS,_=>_+l));break;case"vs:#main-end":r&&(t=t.replace(AS,_=>l+_));break;case"fs:#decl":r||(t=t.replace(vg,l));break;case"fs:#main-start":r||(t=t.replace(wS,_=>_+l));break;case"fs:#main-end":r||(t=t.replace(AS,_=>l+_));break;default:t=t.replace(a,_=>_+l)}}return t=t.replace(vg,""),i&&(t=t.replace(/\}\s*$/,a=>a+rG[e])),t}function O1(t){const e={};return Ls(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function Uh(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const qM=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],sG=[...qM,[Uh("attribute"),"in $1"],[Uh("varying"),"out $1"]],oG=[...qM,[Uh("varying"),"in $1"]],XM=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],aG=[...XM,[Uh("in"),"attribute $1"],[Uh("out"),"varying $1"]],lG=[...XM,[Uh("in"),"varying $1"]],F1="gl_FragColor",k1=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,cG=/void\s+main\s*\([^)]*\)\s*\{\n?/;function uG(t,e,n){switch(e){case 300:return n?i_(t,sG):hG(t);case 100:return n?i_(t,aG):dG(t);default:throw new Error("unknown GLSL version ".concat(e))}}function i_(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function hG(t){t=i_(t,oG);const e=t.match(k1);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(F1,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(cG,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(F1,"\\b"),"g"),n)}return t}function dG(t){t=i_(t,lG);const e=t.match(k1);if(e){const n=e[1];t=t.replace(k1,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),F1)}return t}const fG=`

`.concat(vg,`

`),$M={[vp]:"vertex",[Ib]:"fragment"},pG=`precision highp float;

`;function mG(t,e){const{vs:n,fs:i}=e,r=j6(e.modules||[]);return{gl:t,vs:TS(t,Object.assign({},e,{source:n,type:vp,modules:r})),fs:TS(t,Object.assign({},e,{source:i,type:Ib,modules:r})),getUniforms:gG(r)}}function TS(t,e){let{id:n,source:i,type:r,modules:a,defines:h={},hookFunctions:l=[],inject:_={},transpileToGLSL100:v=!1,prologue:S=!0,log:I}=e;Ls(typeof i=="string","shader source must be a string");const B=r===vp,z=i.split(`
`);let V=100,J="",ue=i;z[0].indexOf("#version ")===0?(V=300,J=z[0],ue=z.slice(1).join(`
`)):J="#version ".concat(V);const j={};a.forEach(Le=>{Object.assign(j,Le.getDefines())}),Object.assign(j,h);let W=S?"".concat(J,`
`).concat(yG({id:n,source:i,type:r}),`
`).concat(_G({type:r}),`
`).concat(eG(t),`
`).concat(tG(t),`
`).concat(vG(j),`
`).concat(B?"":pG,`
`):"".concat(J,`
`);const Z=bG(l),ae={},be={},Ee={};for(const Le in _){const ke=typeof _[Le]=="string"?{injection:_[Le],order:0}:_[Le],Ue=Le.match(/^(v|f)s:(#)?([\w-]+)$/);if(Ue){const Me=Ue[2],ut=Ue[3];Me?ut==="decl"?be[Le]=[ke]:Ee[Le]=[ke]:ae[Le]=[ke]}else Ee[Le]=[ke]}for(const Le of a){I&&Le.checkDeprecations(ue,I);const ke=Le.getModuleSource(r,V);W+=ke;const Ue=Le.injections[r];for(const Me in Ue){const ut=Me.match(/^(v|f)s:#([\w-]+)$/);if(ut){const Ft=ut[2]==="decl"?be:Ee;Ft[Me]=Ft[Me]||[],Ft[Me].push(Ue[Me])}else ae[Me]=ae[Me]||[],ae[Me].push(Ue[Me])}}return W+=fG,W=ES(W,r,be),W+=xG(Z[r],ae),W+=ue,W=ES(W,r,Ee),W=uG(W,v?100:V,B),W}function gG(t){return function(n){const i={};for(const r of t){const a=r.getUniforms(n,i);Object.assign(i,a)}return i}}function _G(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat($M[e].toUpperCase(),`
`)}function yG(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat($M[i],`

`):""}function vG(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const r=t[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function xG(t,e){let n="";for(const i in t){const r=t[i];if(n+="void ".concat(r.signature,` {
`),r.header&&(n+="  ".concat(r.header)),e[i]){const a=e[i];a.sort((h,l)=>h.order-l.order);for(const h of a)n+="  ".concat(h.injection,`
`)}r.footer&&(n+="  ".concat(r.footer)),n+=`}
`}return n}function bG(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[r,a]=n.split(":"),h=n.replace(/\(.+/,"");e[r][h]=Object.assign(i,{signature:a})}),e}const wG="void main() {gl_FragColor = vec4(0);}",ZM=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,AG=`#version 300 es
`.concat(ZM);function JM(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,r,a]=n;if(!e.includes(i)||!r||!a)return null;const h=a.split(";")[0];return{qualifier:i,type:r,name:h}}function KM(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:r}=t;if(!n)return e===300?AG:e>300?"#version ".concat(e,`
`).concat(ZM):wG;const a=SG(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(r,`;
void main() {
  `).concat(r," = ").concat(a,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(a,`;
}`)}function EG(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Ls(!1),null}}function TG(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Ls(!1),null}}function SG(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Ls(!1),null}}const CG=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,IG={name:"fp32",vs:CG,fs:null};function Po(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const PG=1/Math.PI*180,MG=1/180*Math.PI,Ui={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function BG(t,{precision:e=Ui.precision}={}){return t=OG(t),"".concat(parseFloat(t.toPrecision(e)))}function Wl(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function LG(t){return DG(t)}function RG(t){return Fa(t)}function DG(t,e){return Mb(t,n=>n*MG,e)}function Fa(t,e){return Mb(t,n=>n*PG,e)}function ka(t,e,n){return Mb(t,i=>Math.max(e,Math.min(n,i)))}function r_(t,e,n){return Wl(t)?t.map((i,r)=>r_(i,e[r],n)):n*e+(1-n)*t}function Oo(t,e,n){const i=Ui.EPSILON;n&&(Ui.EPSILON=n);try{if(t===e)return!0;if(Wl(t)&&Wl(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!Oo(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Ui.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Ui.EPSILON=i}}function OG(t){return Math.round(t/Ui.EPSILON)*Ui.EPSILON}function FG(t){return t.clone?t.clone():new Array(t.length)}function Mb(t,e,n){if(Wl(t)){const i=t;n=n||FG(i);for(let r=0;r<n.length&&r<i.length;++r)n[r]=e(t[r],r,n);return n}return e(t)}function kG(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class Bb extends kG(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Wl(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ui)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+BG(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Oo(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const a=e[r];this[r]=a+i*(n[r]-a)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Ui.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function zG(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function pn(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Df(t,e,n=""){if(Ui.debug&&!zG(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class Lb extends Bb{get x(){return this[0]}set x(e){this[0]=pn(e)}get y(){return this[1]}set y(e){this[1]=pn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];n+=r*r}return pn(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return pn(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Po(e>=0&&e<this.ELEMENTS,"index is out of range"),pn(this[e])}setComponent(e,n){return Po(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Of=1e-6,ko=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function NG(){var t=new ko(2);return ko!=Float32Array&&(t[0]=0,t[1]=0),t}function SS(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function UG(t,e){return t[0]=-e[0],t[1]=-e[1],t}function YM(t,e,n,i){var r=e[0],a=e[1];return t[0]=r+i*(n[0]-r),t[1]=a+i*(n[1]-a),t}function GG(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t}function VG(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r+n[4],t[1]=n[1]*i+n[3]*r+n[5],t}function QM(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t}function eB(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}(function(){var t=NG();return function(e,n,i,r,a,h){var l,_;for(n||(n=2),i||(i=0),r?_=Math.min(r*n+i,e.length):_=e.length,l=i;l<_;l+=n)t[0]=e[l],t[1]=e[l+1],a(t,t,h),e[l]=t[0],e[l+1]=t[1];return e}})();function tB(t,e,n){const i=e[0],r=e[1],a=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/a,t[1]=(n[1]*i+n[5]*r)/a,t}function nB(t,e,n){const i=e[0],r=e[1],a=e[2],h=n[3]*i+n[7]*r+n[11]*a||1;return t[0]=(n[0]*i+n[4]*r+n[8]*a)/h,t[1]=(n[1]*i+n[5]*r+n[9]*a)/h,t[2]=(n[2]*i+n[6]*r+n[10]*a)/h,t}function jG(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function HG(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t[3]=e[3],t}function iB(t,e,n){const i=e[0],r=e[1],a=e[2];return t[0]=n[0]*i+n[3]*r+n[6]*a,t[1]=n[1]*i+n[4]*r+n[7]*a,t[2]=n[2]*i+n[5]*r+n[8]*a,t[3]=e[3],t}class Rb extends Lb{constructor(e=0,n=0){super(2),Wl(e)&&arguments.length===1?this.copy(e):(Ui.debug&&(pn(e),pn(n)),this[0]=e,this[1]=n)}set(e,n){return this[0]=e,this[1]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Ui.debug&&(pn(e.x),pn(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return eB(this,this,e),this.check()}transformAsVector(e){return tB(this,this,e),this.check()}transformByMatrix3(e){return QM(this,this,e),this.check()}transformByMatrix2x3(e){return VG(this,this,e),this.check()}transformByMatrix2(e){return GG(this,this,e),this.check()}}function rB(){var t=new ko(3);return ko!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function sB(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function CS(t,e,n){var i=new ko(3);return i[0]=t,i[1]=e,i[2]=n,i}function WG(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function qG(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function XG(t,e){var n=e[0],i=e[1],r=e[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function Db(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function xg(t,e,n){var i=e[0],r=e[1],a=e[2],h=n[0],l=n[1],_=n[2];return t[0]=r*_-a*l,t[1]=a*h-i*_,t[2]=i*l-r*h,t}function Ob(t,e,n){var i=e[0],r=e[1],a=e[2],h=n[3]*i+n[7]*r+n[11]*a+n[15];return h=h||1,t[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/h,t[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/h,t[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/h,t}function oB(t,e,n){var i=e[0],r=e[1],a=e[2];return t[0]=i*n[0]+r*n[3]+a*n[6],t[1]=i*n[1]+r*n[4]+a*n[7],t[2]=i*n[2]+r*n[5]+a*n[8],t}function aB(t,e,n){var i=n[0],r=n[1],a=n[2],h=n[3],l=e[0],_=e[1],v=e[2],S=r*v-a*_,I=a*l-i*v,B=i*_-r*l,z=r*B-a*I,V=a*S-i*B,J=i*I-r*S,ue=h*2;return S*=ue,I*=ue,B*=ue,z*=2,V*=2,J*=2,t[0]=l+S+z,t[1]=_+I+V,t[2]=v+B+J,t}function $G(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0],a[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),a[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function ZG(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),a[1]=r[1],a[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function JG(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),a[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),a[2]=r[2],t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function KG(t,e){var n=t[0],i=t[1],r=t[2],a=e[0],h=e[1],l=e[2],_=Math.sqrt(n*n+i*i+r*r),v=Math.sqrt(a*a+h*h+l*l),S=_*v,I=S&&Db(t,e)/S;return Math.acos(Math.min(Math.max(I,-1),1))}var YG=WG,QG=sB;(function(){var t=rB();return function(e,n,i,r,a,h){var l,_;for(n||(n=3),i||(i=0),r?_=Math.min(r*n+i,e.length):_=e.length,l=i;l<_;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],a(t,t,h),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const Z0=[0,0,0];let Nm;class Te extends Lb{static get ZERO(){return Nm||(Nm=new Te(0,0,0),Object.freeze(Nm)),Nm}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&Wl(e)?this.copy(e):(Ui.debug&&(pn(e),pn(n),pn(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ui.debug&&(pn(e.x),pn(e.y),pn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=pn(e)}angle(e){return KG(this,e)}cross(e){return xg(this,this,e),this.check()}rotateX({radians:e,origin:n=Z0}){return $G(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Z0}){return ZG(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Z0}){return JG(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Ob(this,this,e),this.check()}transformAsVector(e){return nB(this,this,e),this.check()}transformByMatrix3(e){return oB(this,this,e),this.check()}transformByMatrix2(e){return jG(this,this,e),this.check()}transformByQuaternion(e){return aB(this,this,e),this.check()}}let Um;class Fb extends Lb{static get ZERO(){return Um||(Um=new Fb(0,0,0,0),Object.freeze(Um)),Um}constructor(e=0,n=0,i=0,r=0){super(-0,-0,-0,-0),Wl(e)&&arguments.length===1?this.copy(e):(Ui.debug&&(pn(e),pn(n),pn(i),pn(r)),this[0]=e,this[1]=n,this[2]=i,this[3]=r)}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Ui.debug&&(pn(e.x),pn(e.y),pn(e.z),pn(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=pn(e)}get w(){return this[3]}set w(e){this[3]=pn(e)}transform(e){return Ob(this,this,e),this.check()}transformByMatrix3(e){return iB(this,this,e),this.check()}transformByMatrix2(e){return HG(this,this,e),this.check()}transformByQuaternion(e){return aB(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class lB extends Bb{toString(){let e="[";if(Ui.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=pn(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[i+r];return n}setColumn(e,n){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=n[r];return this}}function e5(){var t=new ko(9);return ko!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function t5(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function n5(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],h=e[4],l=e[5],_=e[6],v=e[7],S=e[8],I=S*h-l*v,B=-S*a+l*_,z=v*a-h*_,V=n*I+i*B+r*z;return V?(V=1/V,t[0]=I*V,t[1]=(-S*i+r*v)*V,t[2]=(l*i-r*h)*V,t[3]=B*V,t[4]=(S*n-r*_)*V,t[5]=(-l*n+r*a)*V,t[6]=z*V,t[7]=(-v*n+i*_)*V,t[8]=(h*n-i*a)*V,t):null}function i5(t){var e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],h=t[5],l=t[6],_=t[7],v=t[8];return e*(v*a-h*_)+n*(-v*r+h*l)+i*(_*r-a*l)}function IS(t,e,n){var i=e[0],r=e[1],a=e[2],h=e[3],l=e[4],_=e[5],v=e[6],S=e[7],I=e[8],B=n[0],z=n[1],V=n[2],J=n[3],ue=n[4],j=n[5],W=n[6],Z=n[7],ae=n[8];return t[0]=B*i+z*h+V*v,t[1]=B*r+z*l+V*S,t[2]=B*a+z*_+V*I,t[3]=J*i+ue*h+j*v,t[4]=J*r+ue*l+j*S,t[5]=J*a+ue*_+j*I,t[6]=W*i+Z*h+ae*v,t[7]=W*r+Z*l+ae*S,t[8]=W*a+Z*_+ae*I,t}function r5(t,e,n){var i=e[0],r=e[1],a=e[2],h=e[3],l=e[4],_=e[5],v=e[6],S=e[7],I=e[8],B=n[0],z=n[1];return t[0]=i,t[1]=r,t[2]=a,t[3]=h,t[4]=l,t[5]=_,t[6]=B*i+z*h+v,t[7]=B*r+z*l+S,t[8]=B*a+z*_+I,t}function s5(t,e,n){var i=e[0],r=e[1],a=e[2],h=e[3],l=e[4],_=e[5],v=e[6],S=e[7],I=e[8],B=Math.sin(n),z=Math.cos(n);return t[0]=z*i+B*h,t[1]=z*r+B*l,t[2]=z*a+B*_,t[3]=z*h-B*i,t[4]=z*l-B*r,t[5]=z*_-B*a,t[6]=v,t[7]=S,t[8]=I,t}function PS(t,e,n){var i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function o5(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],h=n+n,l=i+i,_=r+r,v=n*h,S=i*h,I=i*l,B=r*h,z=r*l,V=r*_,J=a*h,ue=a*l,j=a*_;return t[0]=1-I-V,t[3]=S-j,t[6]=B+ue,t[1]=S+j,t[4]=1-v-V,t[7]=z-J,t[2]=B-ue,t[5]=z+J,t[8]=1-v-I,t}var z1;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(z1||(z1={}));const a5=Object.freeze([1,0,0,0,1,0,0,0,1]);class gi extends lB{static get IDENTITY(){return c5()}static get ZERO(){return l5()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return z1}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(a5)}fromObject(e){return this.check()}fromQuaternion(e){return o5(this,e),this.check()}set(e,n,i,r,a,h,l,_,v){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=a,this[5]=h,this[6]=l,this[7]=_,this[8]=v,this.check()}setRowMajor(e,n,i,r,a,h,l,_,v){return this[0]=e,this[1]=r,this[2]=l,this[3]=n,this[4]=a,this[5]=_,this[6]=i,this[7]=h,this[8]=v,this.check()}determinant(){return i5(this)}transpose(){return t5(this,this),this.check()}invert(){return n5(this,this),this.check()}multiplyLeft(e){return IS(this,e,this),this.check()}multiplyRight(e){return IS(this,this,e),this.check()}rotate(e){return s5(this,this,e),this.check()}scale(e){return Array.isArray(e)?PS(this,this,e):PS(this,this,[e,e]),this.check()}translate(e){return r5(this,this,e),this.check()}transform(e,n){let i;switch(e.length){case 2:i=QM(n||[-0,-0],e,this);break;case 3:i=oB(n||[-0,-0,-0],e,this);break;case 4:i=iB(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Df(i,e.length),i}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let Gm,Vm;function l5(){return Gm||(Gm=new gi([0,0,0,0,0,0,0,0,0]),Object.freeze(Gm)),Gm}function c5(){return Vm||(Vm=new gi,Object.freeze(Vm)),Vm}function u5(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h5(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],a=e[6],h=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=a,t[11]=e[14],t[12]=r,t[13]=h,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function N1(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],h=e[4],l=e[5],_=e[6],v=e[7],S=e[8],I=e[9],B=e[10],z=e[11],V=e[12],J=e[13],ue=e[14],j=e[15],W=n*l-i*h,Z=n*_-r*h,ae=n*v-a*h,be=i*_-r*l,Ee=i*v-a*l,Le=r*v-a*_,ke=S*J-I*V,Ue=S*ue-B*V,Me=S*j-z*V,ut=I*ue-B*J,Lt=I*j-z*J,Ft=B*j-z*ue,Rt=W*Ft-Z*Lt+ae*ut+be*Me-Ee*Ue+Le*ke;return Rt?(Rt=1/Rt,t[0]=(l*Ft-_*Lt+v*ut)*Rt,t[1]=(r*Lt-i*Ft-a*ut)*Rt,t[2]=(J*Le-ue*Ee+j*be)*Rt,t[3]=(B*Ee-I*Le-z*be)*Rt,t[4]=(_*Me-h*Ft-v*Ue)*Rt,t[5]=(n*Ft-r*Me+a*Ue)*Rt,t[6]=(ue*ae-V*Le-j*Z)*Rt,t[7]=(S*Le-B*ae+z*Z)*Rt,t[8]=(h*Lt-l*Me+v*ke)*Rt,t[9]=(i*Me-n*Lt-a*ke)*Rt,t[10]=(V*Ee-J*ae+j*W)*Rt,t[11]=(I*ae-S*Ee-z*W)*Rt,t[12]=(l*Ue-h*ut-_*ke)*Rt,t[13]=(n*ut-i*Ue+r*ke)*Rt,t[14]=(J*Z-V*be-ue*W)*Rt,t[15]=(S*be-I*Z+B*W)*Rt,t):null}function d5(t){var e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],h=t[5],l=t[6],_=t[7],v=t[8],S=t[9],I=t[10],B=t[11],z=t[12],V=t[13],J=t[14],ue=t[15],j=e*h-n*a,W=e*l-i*a,Z=e*_-r*a,ae=n*l-i*h,be=n*_-r*h,Ee=i*_-r*l,Le=v*V-S*z,ke=v*J-I*z,Ue=v*ue-B*z,Me=S*J-I*V,ut=S*ue-B*V,Lt=I*ue-B*J;return j*Lt-W*ut+Z*Me+ae*Ue-be*ke+Ee*Le}function Gc(t,e,n){var i=e[0],r=e[1],a=e[2],h=e[3],l=e[4],_=e[5],v=e[6],S=e[7],I=e[8],B=e[9],z=e[10],V=e[11],J=e[12],ue=e[13],j=e[14],W=e[15],Z=n[0],ae=n[1],be=n[2],Ee=n[3];return t[0]=Z*i+ae*l+be*I+Ee*J,t[1]=Z*r+ae*_+be*B+Ee*ue,t[2]=Z*a+ae*v+be*z+Ee*j,t[3]=Z*h+ae*S+be*V+Ee*W,Z=n[4],ae=n[5],be=n[6],Ee=n[7],t[4]=Z*i+ae*l+be*I+Ee*J,t[5]=Z*r+ae*_+be*B+Ee*ue,t[6]=Z*a+ae*v+be*z+Ee*j,t[7]=Z*h+ae*S+be*V+Ee*W,Z=n[8],ae=n[9],be=n[10],Ee=n[11],t[8]=Z*i+ae*l+be*I+Ee*J,t[9]=Z*r+ae*_+be*B+Ee*ue,t[10]=Z*a+ae*v+be*z+Ee*j,t[11]=Z*h+ae*S+be*V+Ee*W,Z=n[12],ae=n[13],be=n[14],Ee=n[15],t[12]=Z*i+ae*l+be*I+Ee*J,t[13]=Z*r+ae*_+be*B+Ee*ue,t[14]=Z*a+ae*v+be*z+Ee*j,t[15]=Z*h+ae*S+be*V+Ee*W,t}function s_(t,e,n){var i=n[0],r=n[1],a=n[2],h,l,_,v,S,I,B,z,V,J,ue,j;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*a+e[12],t[13]=e[1]*i+e[5]*r+e[9]*a+e[13],t[14]=e[2]*i+e[6]*r+e[10]*a+e[14],t[15]=e[3]*i+e[7]*r+e[11]*a+e[15]):(h=e[0],l=e[1],_=e[2],v=e[3],S=e[4],I=e[5],B=e[6],z=e[7],V=e[8],J=e[9],ue=e[10],j=e[11],t[0]=h,t[1]=l,t[2]=_,t[3]=v,t[4]=S,t[5]=I,t[6]=B,t[7]=z,t[8]=V,t[9]=J,t[10]=ue,t[11]=j,t[12]=h*i+S*r+V*a+e[12],t[13]=l*i+I*r+J*a+e[13],t[14]=_*i+B*r+ue*a+e[14],t[15]=v*i+z*r+j*a+e[15]),t}function kb(t,e,n){var i=n[0],r=n[1],a=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function f5(t,e,n,i){var r=i[0],a=i[1],h=i[2],l=Math.hypot(r,a,h),_,v,S,I,B,z,V,J,ue,j,W,Z,ae,be,Ee,Le,ke,Ue,Me,ut,Lt,Ft,Rt,Jn;return l<Of?null:(l=1/l,r*=l,a*=l,h*=l,_=Math.sin(n),v=Math.cos(n),S=1-v,I=e[0],B=e[1],z=e[2],V=e[3],J=e[4],ue=e[5],j=e[6],W=e[7],Z=e[8],ae=e[9],be=e[10],Ee=e[11],Le=r*r*S+v,ke=a*r*S+h*_,Ue=h*r*S-a*_,Me=r*a*S-h*_,ut=a*a*S+v,Lt=h*a*S+r*_,Ft=r*h*S+a*_,Rt=a*h*S-r*_,Jn=h*h*S+v,t[0]=I*Le+J*ke+Z*Ue,t[1]=B*Le+ue*ke+ae*Ue,t[2]=z*Le+j*ke+be*Ue,t[3]=V*Le+W*ke+Ee*Ue,t[4]=I*Me+J*ut+Z*Lt,t[5]=B*Me+ue*ut+ae*Lt,t[6]=z*Me+j*ut+be*Lt,t[7]=V*Me+W*ut+Ee*Lt,t[8]=I*Ft+J*Rt+Z*Jn,t[9]=B*Ft+ue*Rt+ae*Jn,t[10]=z*Ft+j*Rt+be*Jn,t[11]=V*Ft+W*Rt+Ee*Jn,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function cB(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[4],h=e[5],l=e[6],_=e[7],v=e[8],S=e[9],I=e[10],B=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+v*i,t[5]=h*r+S*i,t[6]=l*r+I*i,t[7]=_*r+B*i,t[8]=v*r-a*i,t[9]=S*r-h*i,t[10]=I*r-l*i,t[11]=B*r-_*i,t}function p5(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],h=e[1],l=e[2],_=e[3],v=e[8],S=e[9],I=e[10],B=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r-v*i,t[1]=h*r-S*i,t[2]=l*r-I*i,t[3]=_*r-B*i,t[8]=a*i+v*r,t[9]=h*i+S*r,t[10]=l*i+I*r,t[11]=_*i+B*r,t}function uB(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],h=e[1],l=e[2],_=e[3],v=e[4],S=e[5],I=e[6],B=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+v*i,t[1]=h*r+S*i,t[2]=l*r+I*i,t[3]=_*r+B*i,t[4]=v*r-a*i,t[5]=S*r-h*i,t[6]=I*r-l*i,t[7]=B*r-_*i,t}function m5(t,e){var n=e[0],i=e[1],r=e[2],a=e[4],h=e[5],l=e[6],_=e[8],v=e[9],S=e[10];return t[0]=Math.hypot(n,i,r),t[1]=Math.hypot(a,h,l),t[2]=Math.hypot(_,v,S),t}function g5(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],h=n+n,l=i+i,_=r+r,v=n*h,S=i*h,I=i*l,B=r*h,z=r*l,V=r*_,J=a*h,ue=a*l,j=a*_;return t[0]=1-I-V,t[1]=S+j,t[2]=B-ue,t[3]=0,t[4]=S-j,t[5]=1-v-V,t[6]=z+J,t[7]=0,t[8]=B+ue,t[9]=z-J,t[10]=1-v-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _5(t,e,n,i,r,a,h){var l=1/(n-e),_=1/(r-i),v=1/(a-h);return t[0]=a*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*_,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(r+i)*_,t[10]=(h+a)*v,t[11]=-1,t[12]=0,t[13]=0,t[14]=h*a*2*v,t[15]=0,t}function y5(t,e,n,i,r){var a=1/Math.tan(e/2),h;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0?(h=1/(i-r),t[10]=(r+i)*h,t[14]=2*r*i*h):(t[10]=-1,t[14]=-2*i),t}var v5=y5;function x5(t,e,n,i,r,a,h){var l=1/(e-n),_=1/(i-r),v=1/(a-h);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*v,t[11]=0,t[12]=(e+n)*l,t[13]=(r+i)*_,t[14]=(h+a)*v,t[15]=1,t}var b5=x5;function w5(t,e,n,i){var r,a,h,l,_,v,S,I,B,z,V=e[0],J=e[1],ue=e[2],j=i[0],W=i[1],Z=i[2],ae=n[0],be=n[1],Ee=n[2];return Math.abs(V-ae)<Of&&Math.abs(J-be)<Of&&Math.abs(ue-Ee)<Of?u5(t):(S=V-ae,I=J-be,B=ue-Ee,z=1/Math.hypot(S,I,B),S*=z,I*=z,B*=z,r=W*B-Z*I,a=Z*S-j*B,h=j*I-W*S,z=Math.hypot(r,a,h),z?(z=1/z,r*=z,a*=z,h*=z):(r=0,a=0,h=0),l=I*h-B*a,_=B*r-S*h,v=S*a-I*r,z=Math.hypot(l,_,v),z?(z=1/z,l*=z,_*=z,v*=z):(l=0,_=0,v=0),t[0]=r,t[1]=l,t[2]=S,t[3]=0,t[4]=a,t[5]=_,t[6]=I,t[7]=0,t[8]=h,t[9]=v,t[10]=B,t[11]=0,t[12]=-(r*V+a*J+h*ue),t[13]=-(l*V+_*J+v*ue),t[14]=-(S*V+I*J+B*ue),t[15]=1,t)}function A5(){var t=new ko(4);return ko!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function E5(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function hB(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function T5(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.hypot(e,n,i,r)}function S5(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r}function C5(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],h=n*n+i*i+r*r+a*a;return h>0&&(h=1/Math.sqrt(h)),t[0]=n*h,t[1]=i*h,t[2]=r*h,t[3]=a*h,t}function I5(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function P5(t,e,n,i){var r=e[0],a=e[1],h=e[2],l=e[3];return t[0]=r+i*(n[0]-r),t[1]=a+i*(n[1]-a),t[2]=h+i*(n[2]-h),t[3]=l+i*(n[3]-l),t}function xp(t,e,n){var i=e[0],r=e[1],a=e[2],h=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*a+n[12]*h,t[1]=n[1]*i+n[5]*r+n[9]*a+n[13]*h,t[2]=n[2]*i+n[6]*r+n[10]*a+n[14]*h,t[3]=n[3]*i+n[7]*r+n[11]*a+n[15]*h,t}function M5(t,e,n){var i=e[0],r=e[1],a=e[2],h=n[0],l=n[1],_=n[2],v=n[3],S=v*i+l*a-_*r,I=v*r+_*i-h*a,B=v*a+h*r-l*i,z=-h*i-l*r-_*a;return t[0]=S*v+z*-h+I*-_-B*-l,t[1]=I*v+z*-l+B*-h-S*-_,t[2]=B*v+z*-_+S*-l-I*-h,t[3]=e[3],t}(function(){var t=A5();return function(e,n,i,r,a,h){var l,_;for(n||(n=4),i||(i=0),r?_=Math.min(r*n+i,e.length):_=e.length,l=i;l<_;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],a(t,t,h),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var U1;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(U1||(U1={}));const B5=45*Math.PI/180,L5=1,J0=.1,K0=500,R5=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Qt extends lB{static get IDENTITY(){return O5()}static get ZERO(){return D5()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return U1}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,r,a,h,l,_,v,S,I,B,z,V,J,ue){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=a,this[5]=h,this[6]=l,this[7]=_,this[8]=v,this[9]=S,this[10]=I,this[11]=B,this[12]=z,this[13]=V,this[14]=J,this[15]=ue,this.check()}setRowMajor(e,n,i,r,a,h,l,_,v,S,I,B,z,V,J,ue){return this[0]=e,this[1]=a,this[2]=v,this[3]=z,this[4]=n,this[5]=h,this[6]=S,this[7]=V,this[8]=i,this[9]=l,this[10]=I,this[11]=J,this[12]=r,this[13]=_,this[14]=B,this[15]=ue,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(R5)}fromObject(e){return this.check()}fromQuaternion(e){return g5(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:r,top:a,near:h=J0,far:l=K0}=e;return l===1/0?F5(this,n,i,r,a,h):_5(this,n,i,r,a,h,l),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:r=[0,1,0]}=e;return w5(this,n,i,r),this.check()}ortho(e){const{left:n,right:i,bottom:r,top:a,near:h=J0,far:l=K0}=e;return b5(this,n,i,r,a,h,l),this.check()}orthographic(e){const{fovy:n=B5,aspect:i=L5,focalDistance:r=1,near:a=J0,far:h=K0}=e;MS(n);const l=n/2,_=r*Math.tan(l),v=_*i;return this.ortho({left:-v,right:v,bottom:-_,top:_,near:a,far:h})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:r=.1,far:a=500}=e;return MS(n),v5(this,n,i,r,a),this.check()}determinant(){return d5(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],a=1/i[1],h=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*a,e[2]=this[2]*h,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*a,e[6]=this[6]*h,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*a,e[10]=this[10]*h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],a=1/i[1],h=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*a,e[2]=this[2]*h,e[3]=this[4]*r,e[4]=this[5]*a,e[5]=this[6]*h,e[6]=this[8]*r,e[7]=this[9]*a,e[8]=this[10]*h,e}transpose(){return h5(this,this),this.check()}invert(){return N1(this,this),this.check()}multiplyLeft(e){return Gc(this,e,this),this.check()}multiplyRight(e){return Gc(this,this,e),this.check()}rotateX(e){return cB(this,this,e),this.check()}rotateY(e){return p5(this,this,e),this.check()}rotateZ(e){return uB(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return f5(this,this,e,n),this.check()}scale(e){return kb(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return s_(this,this,e),this.check()}transform(e,n){return e.length===4?(n=xp(n||[-0,-0,-0,-0],e,this),Df(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let r;switch(i){case 2:r=eB(n||[-0,-0],e,this);break;case 3:r=Ob(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Df(r,e.length),r}transformAsVector(e,n){let i;switch(e.length){case 2:i=tB(n||[-0,-0],e,this);break;case 3:i=nB(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Df(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let jm,Hm;function D5(){return jm||(jm=new Qt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(jm)),jm}function O5(){return Hm||(Hm=new Qt,Object.freeze(Hm)),Hm}function MS(t){if(t>Math.PI*2)throw Error("expected radians")}function F5(t,e,n,i,r,a){const h=2*a/(n-e),l=2*a/(r-i),_=(n+e)/(n-e),v=(r+i)/(r-i),S=-1,I=-1,B=-2*a;return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=_,t[9]=v,t[10]=S,t[11]=I,t[12]=0,t[13]=0,t[14]=B,t[15]=0,t}function BS(){var t=new ko(4);return ko!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function k5(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function dB(t,e,n){n=n*.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function LS(t,e,n){var i=e[0],r=e[1],a=e[2],h=e[3],l=n[0],_=n[1],v=n[2],S=n[3];return t[0]=i*S+h*l+r*v-a*_,t[1]=r*S+h*_+a*l-i*v,t[2]=a*S+h*v+i*_-r*l,t[3]=h*S-i*l-r*_-a*v,t}function z5(t,e,n){n*=.5;var i=e[0],r=e[1],a=e[2],h=e[3],l=Math.sin(n),_=Math.cos(n);return t[0]=i*_+h*l,t[1]=r*_+a*l,t[2]=a*_-r*l,t[3]=h*_-i*l,t}function N5(t,e,n){n*=.5;var i=e[0],r=e[1],a=e[2],h=e[3],l=Math.sin(n),_=Math.cos(n);return t[0]=i*_-a*l,t[1]=r*_+h*l,t[2]=a*_+i*l,t[3]=h*_-r*l,t}function U5(t,e,n){n*=.5;var i=e[0],r=e[1],a=e[2],h=e[3],l=Math.sin(n),_=Math.cos(n);return t[0]=i*_+r*l,t[1]=r*_-i*l,t[2]=a*_+h*l,t[3]=h*_-a*l,t}function G5(t,e){var n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t}function bg(t,e,n,i){var r=e[0],a=e[1],h=e[2],l=e[3],_=n[0],v=n[1],S=n[2],I=n[3],B,z,V,J,ue;return z=r*_+a*v+h*S+l*I,z<0&&(z=-z,_=-_,v=-v,S=-S,I=-I),1-z>Of?(B=Math.acos(z),V=Math.sin(B),J=Math.sin((1-i)*B)/V,ue=Math.sin(i*B)/V):(J=1-i,ue=i),t[0]=J*r+ue*_,t[1]=J*a+ue*v,t[2]=J*h+ue*S,t[3]=J*l+ue*I,t}function V5(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],h=n*n+i*i+r*r+a*a,l=h?1/h:0;return t[0]=-n*l,t[1]=-i*l,t[2]=-r*l,t[3]=a*l,t}function j5(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function fB(t,e){var n=e[0]+e[4]+e[8],i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);var a=(r+1)%3,h=(r+2)%3;i=Math.sqrt(e[r*3+r]-e[a*3+a]-e[h*3+h]+1),t[r]=.5*i,i=.5/i,t[3]=(e[a*3+h]-e[h*3+a])*i,t[a]=(e[a*3+r]+e[r*3+a])*i,t[h]=(e[h*3+r]+e[r*3+h])*i}return t}var H5=E5,W5=hB,q5=I5,X5=P5,$5=T5,Z5=S5,pB=C5,J5=function(){var t=rB(),e=CS(1,0,0),n=CS(0,1,0);return function(i,r,a){var h=Db(r,a);return h<-.999999?(xg(t,e,r),QG(t)<1e-6&&xg(t,n,r),XG(t,t),dB(i,t,Math.PI),i):h>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(xg(t,r,a),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+h,pB(i,i))}}();(function(){var t=BS(),e=BS();return function(n,i,r,a,h,l){return bg(t,i,h,l),bg(e,r,a,l),bg(n,t,e,2*l*(1-l)),n}})();(function(){var t=e5();return function(e,n,i,r){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],pB(e,fB(e,t))}})();const K5=[0,0,0,1];class rp extends Bb{constructor(e=0,n=0,i=0,r=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,i,r)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return fB(this,e),this.check()}fromAxisRotation(e,n){return dB(this,e,n),this.check()}identity(){return k5(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=pn(e)}get y(){return this[1]}set y(e){this[1]=pn(e)}get z(){return this[2]}set z(e){this[2]=pn(e)}get w(){return this[3]}set w(e){this[3]=pn(e)}len(){return $5(this)}lengthSquared(){return Z5(this)}dot(e){return q5(this,e)}rotationTo(e,n){return J5(this,e,n),this.check()}add(e){return H5(this,this,e),this.check()}calculateW(){return G5(this,this),this.check()}conjugate(){return j5(this,this),this.check()}invert(){return V5(this,this),this.check()}lerp(e,n,i){return i===void 0?this.lerp(this,e,n):(X5(this,e,n,i),this.check())}multiplyRight(e){return LS(this,this,e),this.check()}multiplyLeft(e){return LS(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return z5(this,this,e),this.check()}rotateY(e){return N5(this,this,e),this.check()}rotateZ(e){return U5(this,this,e),this.check()}scale(e){return W5(this,this,e),this.check()}slerp(e,n,i){let r,a,h;switch(arguments.length){case 1:({start:r=K5,target:a,ratio:h}=e);break;case 2:r=this,a=e,h=n;break;default:r=e,a=n,h=i}return bg(this,r,a,h),this.check()}transformVector4(e,n=new Fb){return M5(n,e,this),Df(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const sp={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},RS=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,Y5={lightSources:{}};function Y0(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function Q5(t){let{ambientLight:e,pointLights:n=[],directionalLights:i=[]}=t;const r={};return e?r["lighting_uAmbientLight.color"]=Y0(e):r["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((a,h)=>{r["lighting_uPointLight[".concat(h,"].color")]=Y0(a),r["lighting_uPointLight[".concat(h,"].position")]=a.position,r["lighting_uPointLight[".concat(h,"].attenuation")]=a.attenuation||[1,0,0]}),r.lighting_uPointLightCount=n.length,i.forEach((a,h)=>{r["lighting_uDirectionalLight[".concat(h,"].color")]=Y0(a),r["lighting_uDirectionalLight[".concat(h,"].direction")]=a.direction}),r.lighting_uDirectionalLightCount=i.length,r}function mB(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Y5;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},Q5({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return mB({lightSources:e})}return{}}const zb={name:"lights",vs:RS,fs:RS,getUniforms:mB,defines:{MAX_LIGHTS:3}},eV=new Uint8Array([0,255,255,255]),tV={pickingSelectedColor:null,pickingHighlightColor:eV,pickingActive:!1,pickingAttribute:!1};function nV(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:tV;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const iV=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,rV=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,sV={name:"picking",vs:iV,fs:rV,getUniforms:nV},gB=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,oV={};function aV(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map(a=>a/255)}}function _B(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oV;if(!("material"in t))return{};const{material:e}=t;return e?aV(e):{lighting_uEnabled:!1}}const lV={name:"gouraud-lighting",dependencies:[zb],vs:gB,defines:{LIGHTING_VERTEX:1},getUniforms:_B},cV={name:"phong-lighting",dependencies:[zb],fs:gB,defines:{LIGHTING_FRAGMENT:1},getUniforms:_B},uV=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,hV=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,Nb={name:"pbr",vs:uV,fs:hV,defines:{LIGHTING_FRAGMENT:1},dependencies:[zb]},dV=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,fV={name:"transform",vs:dV,fs:null};class bp{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new bp(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:r={},inject:a={},varyings:h=[],bufferMode:l=35981,transpileToGLSL100:_=!1}=e,v=this._getModuleList(e.modules),S=this._getHash(n),I=this._getHash(i),B=v.map(Z=>this._getHash(Z.name)).sort(),z=h.map(Z=>this._getHash(Z)),V=Object.keys(r).sort(),J=Object.keys(a).sort(),ue=[],j=[];for(const Z of V)ue.push(this._getHash(Z)),ue.push(this._getHash(r[Z]));for(const Z of J)j.push(this._getHash(Z)),j.push(this._getHash(a[Z]));const W="".concat(S,"/").concat(I,"D").concat(ue.join("/"),"M").concat(B.join("/"),"I").concat(j.join("/"),"V").concat(z.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(_?"T":"");if(!this._programCache[W]){const Z=mG(this.gl,{vs:n,fs:i,modules:v,inject:a,defines:r,hookFunctions:this._hookFunctions,transpileToGLSL100:_});this._programCache[W]=new VM(this.gl,{hash:W,vs:Z.vs,fs:Z.fs,varyings:h,bufferMode:l}),this._getUniforms[W]=Z.getUniforms||(ae=>{}),this._useCounts[W]=0}return this._useCounts[W]++,this._programCache[W]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let a=0,h=this._defaultModules.length;a<h;++a){const l=this._defaultModules[a],_=l.name;n[r++]=l,i[_]=!0}for(let a=0,h=e.length;a<h;++a){const l=e[a],_=l.name;i[_]||(n[r++]=l,i[_]=!0)}return n.length=r,n}}const pV={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function mV(t,e,n){const i={};let r=e.indices;for(const a in e.attributes){const h=e.attributes[a],l=gV(a,n);if(a==="indices")r=h;else if(h.constant)i[l]=h.value;else{const _=h.value,v={...h};delete v.value,i[l]=[new _n(t,_),v],_V(a,v)}}if(r){const a=r.value||r;at(a instanceof Uint16Array||a instanceof Uint32Array,'attribute array for "indices" must be of integer type');const h={size:1,isIndexed:r.isIndexed===void 0?!0:r.isIndexed};i.indices=[new _n(t,{data:a,target:34963}),h]}return i}function gV(t,e){const{attributeMap:n=pV}=e||{};return n&&n[t]||t}function _V(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}at(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const $u=2,yV=1e4,vV="Model needs drawMode and vertexCount",DS=()=>{},xV={};class Xc{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=Xa("model")}=n;at(F_(e)),this.id=i,this.gl=e,this.id=n.id||Xa("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||bp.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:r,modules:a,defines:h,inject:l,varyings:_,bufferMode:v,transpileToGLSL100:S}=e;this.programProps={program:n,vs:i,fs:r,modules:a,defines:h,inject:l,varyings:_,bufferMode:v,transpileToGLSL100:S},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},at(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),vV)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:r,modules:a,defines:h,inject:l,varyings:_,bufferMode:v,transpileToGLSL100:S}=e;this.programProps={program:n,vs:i,fs:r,modules:a,defines:h,inject:l,varyings:_,bufferMode:v,transpileToGLSL100:S},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return at(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return at(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=mV(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(zh(e))return this;const n={};for(const i in e){const r=e[i];n[i]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return Tb(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:r={},attributes:a={},transformFeedback:h=this.transformFeedback,parameters:l={},vertexArray:_=this.vertexArray}=e;this.setAttributes(a),this.updateModuleSettings(n),this.setUniforms(r);let v;_t.priority>=$u&&(v=this._logDrawCallStart($u));const S=this.vertexArray.getDrawParams(),{isIndexed:I=S.isIndexed,indexType:B=S.indexType,indexOffset:z=S.indexOffset,vertexArrayInstanced:V=S.isInstanced}=this.props;V&&!this.isInstanced&&_t.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:J,instanceCount:ue}=this,{onBeforeRender:j=DS,onAfterRender:W=DS}=this.props;j(),this.program.setUniforms(this.uniforms);const Z=this.program.draw(Object.assign(xV,e,{logPriority:v,uniforms:null,framebuffer:i,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:_,transformFeedback:h,isIndexed:I,indexType:B,isInstanced:J,instanceCount:ue,offset:I?z:0}));return W(),_t.priority>=$u&&this._logDrawCallEnd(v,_,i),Z}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:r=[]}=e;let{parameters:a}=e;i&&this._setFeedbackBuffers(i),n&&(a=Object.assign({},a,{35977:n})),r.forEach(h=>h.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:a}))}finally{r.forEach(h=>h.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return _t.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:r,modules:a,inject:h,defines:l,varyings:_,bufferMode:v,transpileToGLSL100:S}=this.programProps;n=this.programManager.get({vs:i,fs:r,modules:a,inject:h,defines:l,varyings:_,bufferMode:v,transpileToGLSL100:S}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}at(n instanceof VM,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new M6(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof _n&&n.delete()}}_setAnimationProps(e){this.animated&&at(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(zh(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new jM(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:yV;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),_t.group($u,">>> DRAWING MODEL ".concat(this.id),{collapsed:_t.level<=2})(),e}_logDrawCallEnd(e,n,i,r){if(e===void 0)return;const a=R6({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:h,unusedTable:l,unusedCount:_}=mS({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:v,count:S}=mS({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});S>0&&_t.log("MISSING UNIFORMS",Object.keys(v))(),_>0&&_t.log("UNUSED UNIFORMS",Object.keys(l))();const I=O6(this.vertexArray.configuration);_t.table(e,a)(),_t.table(e,h)(),_t.table(e+1,I)(),r&&r.log({logLevel:$u,message:"Rendered to ".concat(r.id)}),_t.groupEnd($u)()}}class bV{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:r}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:r}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof _n?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&at(Xt(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const r in this.feedbackMap){const a=this.feedbackMap[r];r in n&&(i[a]=r)}Object.assign(i,e.feedbackBuffers);for(const r in i){const a=i[r];if(typeof a=="string"){const h=n[a],{byteLength:l,usage:_,accessor:v}=h;i[r]=this._createNewBuffer(r,{byteLength:l,usage:_,accessor:v})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:r}=i;e.transformFeedback=new jM(this.gl,{program:r,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const r in this.feedbackMap){const a=this.feedbackMap[r];n[r]=e.feedbackBuffers[a],i[a]=e.sourceBuffers[r],at(i[a]instanceof _n)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new _n(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const wV="transform_uSampler_",o_="transform_uSize_",OS="transform_position";function AV(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:r}=t,h=Object.keys(n).length,l=null;const _={};let v=e,S={};if(h>0||i){const I=v.split(`
`),B=I.slice();if(I.forEach((z,V,J)=>{if(h>0){const ue=IV(z,n);if(ue){const{updatedLine:j,inject:W}=ue;B[V]=j,S=O1([S,W]),Object.assign(_,ue.samplerTextureMap),h--}}i&&!l&&(l=CV(z,i))}),i){at(r);const z="".concat(o_).concat(i),V="uniform vec2 ".concat(z,`;
`),J="     vec2 ".concat(OS," = transform_getPos(").concat(z,`);
     gl_Position = vec4(`).concat(OS,`, 0, 1.);
`);S=O1([S,{"vs:#decl":V,"vs:#main-start":J}])}v=B.join(`
`)}return{vs:v,targetTextureType:l,inject:S,samplerTextureMap:_}}function EV(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const r={};let a,h;n&&({width:a,height:h}=i,r["".concat(o_).concat(n)]=[a,h]);for(const l in e)({width:a,height:h}=e[l]),r["".concat(o_).concat(l)]=[a,h];return r}function TV(t){return JM(t,["attribute","in"])}function SV(t){const e="".concat(wV).concat(t),n="".concat(o_).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function CV(t,e){const n=JM(t,["varying","out"]);return n&&n.name===e?n.type:null}function IV(t,e){const n={},i=TV(t);if(!i)return null;const{type:r,name:a}=i;if(a&&e[a]){const h="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:_,uniformDeclerations:v}=SV(a),S=EG(r),I="  ".concat(r," ").concat(a," = transform_getInput(").concat(l,", ").concat(_,").").concat(S,`;
`);return n[l]=a,{updatedLine:h,inject:{"vs:#decl":v,"vs:#main-start":I},samplerTextureMap:n}}return null}const PV={10241:9728,10240:9728,10242:33071,10243:33071},MV="transform_output";class BV{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:r,targetTexture:a}=this.bindings[this.currentIndex],h=Object.assign({},n,e.attributes),l=Object.assign({},e.uniforms),_=Object.assign({},e.parameters);let v=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){h.transform_elementID=this.elementIDBuffer;for(const I in this.samplerTextureMap){const B=this.samplerTextureMap[I];l[I]=i[B]}this._setSourceTextureParameters();const S=EV({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:a});Object.assign(l,S)}return this.hasTargetTexture&&(v=!1,_.viewport=[0,0,r.width,r.height]),{attributes:h,framebuffer:r,uniforms:l,discard:v,parameters:_}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=z_(n);if(!e)return i;const r=i.constructor,a=TG(this.targetTextureType),h=new r(i.length*a/4);let l=0;for(let _=0;_<i.length;_+=4)for(let v=0;v<a;v++)h[l++]=i[_+v];return h}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof Ds)return i;const r=n[i];return r?(this._targetRefTexName=i,this._createNewTexture(r)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:r}=e,a=this._createTargetTexture({sourceTextures:i,textureOrReference:r});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:a}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,r,a)=>{a[r]=r}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new _n(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:r,targetTexture:a}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),Object.assign(e.sourceBuffers,i),a){e.targetTexture=a;const{width:h,height:l}=a,{framebuffer:_}=e;_?(_.update({attachments:{36064:a},resizeAttachments:!1}),_.resize({width:h,height:l})):e.framebuffer=new Gi(this.gl,{id:"transform-framebuffer",width:h,height:l,attachments:{36064:a}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(PV)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=v4(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:r,uniforms:a,targetTextureType:h,inject:l,samplerTextureMap:_}=AV({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),v=O1([e.inject||{},l]);this.targetTextureType=h,this.samplerTextureMap=_;const S=e._fs||KM({version:UM(r),input:this.targetTextureVarying,inputType:h,output:MV}),I=this.hasSourceTextures||this.targetTextureVarying?[fV].concat(e.modules||[]):e.modules;return{vs:r,fs:S,modules:I,uniforms:a,inject:v}}}class Ub{static isSupported(e){return Xt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();at(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const r=i.getData(e);if(r)return r}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Xc(n,Object.assign({},e,{fs:e.fs||KM({version:UM(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=r.updateModelProps(n);return n}_buildResourceTransforms(e,n){LV(n)&&(this.bufferTransform=new bV(e,n)),RV(n)&&(this.textureTransform=new BV(e,n)),at(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=Object.assign(n,r.getDrawOptions(n));return n}}function LV(t){return!!(!zh(t.feedbackBuffers)||!zh(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function RV(t){return!!(!zh(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const FS={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Eh{static get DRAW_MODE(){return FS}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Xa("geometry"),drawMode:i=FS.TRIANGLES,attributes:r={},indices:a=null,vertexCount:h=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(r,a),this.vertexCount=h||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let r=e[i];r=ArrayBuffer.isView(r)?{value:r}:r,at(ArrayBuffer.isView(r.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!r.size&&(r.size=3),i==="indices"?(at(!this.indices),this.indices=r):this.attributes[i]=r}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const r in e){const a=e[r],{value:h,size:l,constant:_}=a;!_&&h&&l>=1&&(i=Math.min(i,h.length/l))}return at(Number.isFinite(i)),i}}let DV=1,OV=1;class yB{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:a=1}=e,h=DV++,l={time:0,delay:n,duration:i,rate:r,repeat:a};return this._setChannelTime(l,this.time),this.channels.set(h,l),h}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:a,channel:h}=r;a.setTime(this.getTime(h))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=OV++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,r=e.duration*e.repeat;i>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const FV=[255,255,255],kV=1;let zV=0;class vB{constructor(e={}){R(this,"id",void 0),R(this,"color",void 0),R(this,"intensity",void 0),R(this,"type","ambient");const{color:n=FV}=e,{intensity:i=kV}=e;this.id=e.id||"ambient-".concat(zV++),this.color=n,this.intensity=i}}const NV=[255,255,255],UV=1,GV=[0,0,-1];let VV=0;class G1{constructor(e={}){R(this,"id",void 0),R(this,"color",void 0),R(this,"intensity",void 0),R(this,"type","directional"),R(this,"direction",void 0),R(this,"shadow",void 0);const{color:n=NV}=e,{intensity:i=UV}=e,{direction:r=GV}=e,{_shadow:a=!1}=e;this.id=e.id||"directional-".concat(VV++),this.color=n,this.intensity=i,this.type="directional",this.direction=new Te(r).normalize().toArray(),this.shadow=a}getProjectedLight(e){return this}}class jV{constructor(e,n={id:"pass"}){R(this,"id",void 0),R(this,"gl",void 0),R(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Gb extends jV{constructor(...e){super(...e),R(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return qa(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:r,views:a,onViewportActive:h,clearStack:l=!0,clearCanvas:_=!0}=e;e.pass=e.pass||"unknown";const v=this.gl;_&&WV(v,n),l&&(this._lastRenderIndex=-1);const S=[];for(const I of r){const B=a&&a[I.id];h==null||h(I);const z=this._getDrawLayerParams(I,e),V=I.subViewports||[I];for(const J of V){const ue=this._drawLayersInViewport(v,{target:n,moduleParameters:i,viewport:J,view:B,pass:e.pass,layers:e.layers},z);S.push(ue)}}return S}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:r=!1,layerFilter:a,cullRect:h,effects:l,moduleParameters:_},v=!1){const S=[],I=xB(this._lastRenderIndex+1),B={layer:n[0],viewport:e,isPicking:r,renderPass:i,cullRect:h},z={};for(let V=0;V<n.length;V++){const J=n[V],ue=this._shouldDrawLayer(J,B,a,z),j={shouldDrawLayer:ue};ue&&!v&&(j.layerRenderIndex=I(J,ue),j.moduleParameters=this._getModuleParameters(J,l,i,_),j.layerParameters=this.getLayerParameters(J,V,e)),S[V]=j}return S}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:r,target:a,viewport:h,view:l},_){const v=HV(e,{moduleParameters:i,target:a,viewport:h});if(l&&l.props.clear){const I=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;Do(e,{scissorTest:!0,scissor:v},()=>Tb(e,I))}const S={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};qa(e,{viewport:v});for(let I=0;I<n.length;I++){const B=n[I],{shouldDrawLayer:z,layerRenderIndex:V,moduleParameters:J,layerParameters:ue}=_[I];if(z&&B.props.pickable&&S.pickableCount++,B.isComposite)S.compositeCount++;else if(z){S.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,V),J.viewport=h;try{B._drawLayer({moduleParameters:J,uniforms:{layerIndex:V},parameters:ue})}catch(j){B.raiseError(j,"drawing ".concat(B," to ").concat(r))}}}return S}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let h=e.parent;for(;h;){if(!h.props.visible||!h.filterSubLayer(n))return!1;n.layer=h,h=h.parent}if(i){const l=n.layer.id;if(l in r||(r[l]=i(n)),!r[l])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,r){var a;const h=Object.assign(Object.create(((a=e.internalState)===null||a===void 0?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:kh(this.gl)});if(n)for(const _ of n){var l;Object.assign(h,(l=_.getModuleParameters)===null||l===void 0?void 0:l.call(_,e))}return Object.assign(h,this.getModuleParameters(e,n),r)}}function xB(t=0,e={}){const n={},i=(r,a)=>{const h=r.props._offset,l=r.id,_=r.parent&&r.parent.id;let v;if(_&&!(_ in e)&&i(r.parent,!1),_ in n){const S=n[_]=n[_]||xB(e[_],e);v=S(r,a),n[l]=S}else Number.isFinite(h)?(v=h+(e[_]||0),n[l]=null):v=t;return a&&v>=t&&(t=v+1),e[l]=v,v};return i}function HV(t,{moduleParameters:e,target:n,viewport:i}){const r=n&&n.id!=="default-framebuffer",a=e&&e.devicePixelRatio||kh(t),h=r?n.height:t.drawingBufferHeight,l=i;return[l.x*a,h-(l.y+l.height)*a,l.width*a,l.height*a]}function WV(t,e){const n=e?e.width:t.drawingBufferWidth,i=e?e.height:t.drawingBufferHeight;qa(t,{viewport:[0,0,n,i]}),t.clear(16640)}class qV extends Gb{constructor(e,n){super(e,n),R(this,"shadowMap",void 0),R(this,"depthBuffer",void 0),R(this,"fbo",void 0),this.shadowMap=new Ds(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new ph(e,{format:33189,width:1,height:1}),this.fbo=new Gi(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const n=this.fbo;Do(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],r=kh(this.gl),a=i.width*r,h=i.height*r;(a!==n.width||h!==n.height)&&n.resize({width:a,height:h}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const bB="#define SMOOTH_EDGE_RADIUS 0.5",XV=`
`.concat(bB,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),$V=`
`.concat(bB,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),ZV={name:"geometry",vs:XV,fs:$V},JV=Object.keys(Jt).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(Jt[t],";")).join(""),KV=Object.keys(sa).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(sa[t],";")).join(""),YV=Object.keys(t_).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(t_[t],";")).join(""),QV="".concat(JV,`
`).concat(KV,`
`).concat(YV,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function e8(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function wp(t){let e={},n;return i=>{for(const r in i)if(!e8(i[r],e[r])){n=t(i),e=i;break}return n}}const kS=[0,0,0,0],t8=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],wB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n8=[0,0,0],AB=[0,0,0],i8=wp(o8);function EB(t,e,n=AB){n.length<3&&(n=[n[0],n[1],0]);let i=n,r,a=!0;switch(e===Jt.LNGLAT_OFFSETS||e===Jt.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case sa.WEB_MERCATOR:(e===Jt.LNGLAT||e===Jt.CARTESIAN)&&(r=[0,0,0],a=!1);break;case sa.WEB_MERCATOR_AUTO_OFFSET:e===Jt.LNGLAT?i=r:e===Jt.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case sa.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case sa.GLOBE:a=!1,r=null;break;default:a=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:a}}function r8(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:a,viewProjectionMatrix:h}=t,l=kS,_=kS,v=t.cameraPosition;const{geospatialOrigin:S,shaderCoordinateOrigin:I,offsetMode:B}=EB(t,e,n);return B&&(_=t.projectPosition(S||I),v=[v[0]-_[0],v[1]-_[1],v[2]-_[2]],_[3]=1,l=xp([],_,h),a=i||a,h=Gc([],r,a),h=Gc([],h,t8)),{viewMatrix:a,viewProjectionMatrix:h,projectionCenter:l,originCommon:_,cameraPosCommon:v,shaderCoordinateOrigin:I,geospatialOrigin:S}}function s8({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=Jt.DEFAULT,coordinateOrigin:r=AB,autoWrapLongitude:a=!1}){i===Jt.DEFAULT&&(i=t.isGeospatial?Jt.LNGLAT:Jt.CARTESIAN);const h=i8({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return h.project_uWrapLongitude=a,h.project_uModelMatrix=n||wB,h}function o8({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:a,originCommon:h,cameraPosCommon:l,shaderCoordinateOrigin:_,geospatialOrigin:v}=r8(t,n,i),S=t.getDistanceScales(),I=[t.width*e,t.height*e],B=xp([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,z={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:_,project_uCommonOrigin:h.slice(0,3),project_uCenter:r,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:I,project_uDevicePixelRatio:e,project_uFocalDistance:B,project_uCommonUnitsPerMeter:S.unitsPerMeter,project_uCommonUnitsPerWorldUnit:S.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:n8,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:a,project_uModelMatrix:wB,project_uCameraPosition:l};if(v){const V=t.getDistanceScales(v);switch(n){case Jt.METER_OFFSETS:z.project_uCommonUnitsPerWorldUnit=V.unitsPerMeter,z.project_uCommonUnitsPerWorldUnit2=V.unitsPerMeter2;break;case Jt.LNGLAT:case Jt.LNGLAT_OFFSETS:t._pseudoMeters||(z.project_uCommonUnitsPerMeter=V.unitsPerMeter),z.project_uCommonUnitsPerWorldUnit=V.unitsPerDegree,z.project_uCommonUnitsPerWorldUnit2=V.unitsPerDegree2;break;case Jt.CARTESIAN:z.project_uCommonUnitsPerWorldUnit=[1,1,V.unitsPerMeter[2]],z.project_uCommonUnitsPerWorldUnit2=[0,0,V.unitsPerMeter2[2]];break}}return z}const a8={};function l8(t=a8){return"viewport"in t?s8(t):{}}const Vb={name:"project",dependencies:[IG,ZV],vs:QV,getUniforms:l8};function c8(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Th(t,e){const n=xp([],e,t);return hB(n,n,1/n[3]),n}function zS(t,e){const n=t%e;return n<0?e+n:n}function V1(t,e,n){return t<e?e:t>n?n:t}function u8(t){return Math.log(t)*Math.LOG2E}const jb=Math.log2||u8;function $a(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Mo=Math.PI,TB=Mo/4,so=Mo/180,j1=180/Mo,Gh=512,a_=4003e4,Wm=85.051129,h8=1.5;function d8(t){return jb(t)}function l_(t){const[e,n]=t;$a(Number.isFinite(e)),$a(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*so,r=n*so,a=Gh*(i+Mo)/(2*Mo),h=Gh*(Mo+Math.log(Math.tan(TB+r*.5)))/(2*Mo);return[a,h]}function Vh(t){const[e,n]=t,i=e/Gh*(2*Mo)-Mo,r=2*(Math.atan(Math.exp(n/Gh*(2*Mo)-Mo))-TB);return[i*j1,r*j1]}function f8(t){const{latitude:e}=t;$a(Number.isFinite(e));const n=Math.cos(e*so);return d8(a_*n)-9}function Q0(t){const e=Math.cos(t*so);return Gh/a_/e}function H1(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;$a(Number.isFinite(e)&&Number.isFinite(n));const r=Gh,a=Math.cos(e*so),h=r/360,l=h/a,_=r/a_/a,v={unitsPerMeter:[_,_,_],metersPerUnit:[1/_,1/_,1/_],unitsPerDegree:[h,l,_],degreesPerUnit:[1/h,1/l,1/_]};if(i){const S=so*Math.tan(e*so)/a,I=h*S/2,B=r/a_*S,z=B/l*_;v.unitsPerDegree2=[0,I,B],v.unitsPerMeter2=[z,0,z]}return v}function SB(t,e){const[n,i,r]=t,[a,h,l]=e,{unitsPerMeter:_,unitsPerMeter2:v}=H1({longitude:n,latitude:i,highPrecision:!0}),S=l_(t);S[0]+=a*(_[0]+v[0]*h),S[1]+=h*(_[1]+v[1]*h);const I=Vh(S),B=(r||0)+(l||0);return Number.isFinite(r)||Number.isFinite(l)?[I[0],I[1],B]:I}function p8(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:a,center:h}=t,l=c8();s_(l,l,[0,0,-r]),cB(l,l,-n*so),uB(l,l,i*so);const _=a/e;return kb(l,l,[_,_,_]),h&&s_(l,l,qG([],h)),l}function m8(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:a,center:h,scale:l,nearZMultiplier:_=1,farZMultiplier:v=1}=t;let{fovy:S=c_(h8)}=t;i!==void 0&&(S=c_(i));const I=S*so,B=r*so,z=CB(S);let V=z;h&&(V+=h[2]*l/Math.cos(B)/n);const J=I*(.5+(a?a[1]:0)/n),ue=Math.sin(J)*V/Math.sin(V1(Math.PI/2-B-J,.01,Math.PI-.01)),j=Math.sin(B)*ue+V,W=V*10,Z=Math.min(j*v,W);return{fov:I,aspect:e/n,focalDistance:z,near:_,far:Z}}function c_(t){return 2*Math.atan(.5/t)*j1}function CB(t){return .5/Math.tan(.5*t*so)}function IB(t,e){const[n,i,r=0]=t;return $a(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),Th(e,[n,i,r,1])}function Hb(t,e,n=0){const[i,r,a]=t;if($a(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(a))return Th(e,[i,r,a,1]);const h=Th(e,[i,r,0,1]),l=Th(e,[i,r,1,1]),_=h[2],v=l[2],S=_===v?0:((n||0)-_)/(v-_);return YM([],h,l,S)}function g8(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:a=24,offset:h=[0,0]}=t,[[l,_],[v,S]]=i,I=_8(t.padding),B=l_([l,V1(S,-Wm,Wm)]),z=l_([v,V1(_,-Wm,Wm)]),V=[Math.max(Math.abs(z[0]-B[0]),r),Math.max(Math.abs(z[1]-B[1]),r)],J=[e-I.left-I.right-Math.abs(h[0])*2,n-I.top-I.bottom-Math.abs(h[1])*2];$a(J[0]>0&&J[1]>0);const ue=J[0]/V[0],j=J[1]/V[1],W=(I.right-I.left)/2/ue,Z=(I.top-I.bottom)/2/j,ae=[(z[0]+B[0])/2+W,(z[1]+B[1])/2+Z],be=Vh(ae),Ee=Math.min(a,jb(Math.abs(Math.min(ue,j))));return $a(Number.isFinite(Ee)),{longitude:be[0],latitude:be[1],zoom:Ee}}function _8(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:($a(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const NS=Math.PI/180;function y8(t,e=0){const{width:n,height:i,unproject:r}=t,a={targetZ:e},h=r([0,i],a),l=r([n,i],a);let _,v;const S=t.fovy?.5*t.fovy*NS:Math.atan(.5/t.altitude),I=(90-t.pitch)*NS;return S>I-.01?(_=US(t,0,e),v=US(t,n,e)):(_=r([0,0],a),v=r([n,0],a)),[h,l,v,_]}function US(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=Th(i,[e,0,1,1]),a=Th(i,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(a[2]-r[2]),_=YM([],r,a,l),v=Vh(_);return v.push(n),v}const GS=512;function v8(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:a,zoom:h,bearing:l=0}=t;(r<-180||r>180)&&(r=zS(r+180,360)-180),(l<-180||l>180)&&(l=zS(l+180,360)-180);const _=jb(n/GS);if(h<=_)h=_,a=0;else{const v=n/2/Math.pow(2,h),S=Vh([0,v])[1];if(a<S)a=S;else{const I=Vh([0,GS-v])[1];a>I&&(a=I)}}return{width:e,height:n,longitude:r,latitude:a,zoom:h,pitch:i,bearing:l}}const x8=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,b8=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,w8=wp(C8),A8=wp(I8),E8=[0,0,0,1],T8=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function S8(t,e){const[n,i,r]=t,a=Hb([n,i,r],e);return Number.isFinite(r)?a:[a[0],a[1],0]}function C8({viewport:t,center:e}){return new Qt(t.viewProjectionMatrix).invert().transform(e)}function I8({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,a=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(h=>S8(h,i));for(const h of e){const l=h.clone().translate(new Te(t.center).negate()),_=a.map(S=>l.transform(S)),v=new Qt().ortho({left:Math.min(..._.map(S=>S[0])),right:Math.max(..._.map(S=>S[0])),bottom:Math.min(..._.map(S=>S[1])),top:Math.max(..._.map(S=>S[1])),near:Math.min(..._.map(S=>-S[2])),far:Math.max(..._.map(S=>-S[2]))});n.push(v.multiplyRight(h))}return n}function P8(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||E8,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=w8({viewport:t.viewport,center:e.project_uCenter}),a=[],h=A8({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const _=h[l],v=_.clone().translate(new Te(t.viewport.center).negate());e.project_uCoordinateSystem===Jt.LNGLAT&&e.project_uProjectionMode===sa.WEB_MERCATOR?(h[l]=v,a[l]=r):(h[l]=_.clone().multiplyRight(T8),a[l]=v.transform(r))}for(let l=0;l<h.length;l++)i["shadow_uViewProjectionMatrices[".concat(l,"]")]=h[l],i["shadow_uProjectCenters[".concat(l,"]")]=a[l],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(l)]=t.shadowMaps[l]:i["shadow_uShadowMap".concat(l)]=t.dummyShadowMap;return i}const ev={name:"shadow",dependencies:[Vb],vs:x8,fs:b8,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?P8(t,e):{}},M8={color:[255,255,255],intensity:1},VS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],B8=[0,0,0,200/255];class Wb{constructor(e={}){R(this,"id","lighting-effect"),R(this,"props",void 0),R(this,"shadowColor",B8),R(this,"shadow",void 0),R(this,"ambientLight",void 0),R(this,"directionalLights",void 0),R(this,"pointLights",void 0),R(this,"shadowPasses",[]),R(this,"shadowMaps",[]),R(this,"dummyShadowMap",null),R(this,"programManager",void 0),R(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:a,views:h}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=bp.getDefaultProgramManager(e),ev&&this.programManager.addDefaultModule(ev)),this.dummyShadowMap||(this.dummyShadowMap=new Ds(e,{width:1,height:1}));for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:n,layerFilter:i,viewports:r,onViewportActive:a,views:h,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(ev),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new Qt().lookAt({eye:new Te(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new qV(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new vB(M8),this.directionalLights.push(new G1(VS[0]),new G1(VS[1])))}}class L8{constructor(e={}){R(this,"_pool",[]),R(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:r,padding:a=0,copy:h=!1,initialize:l=!1,maxCount:_}){const v=r||e&&e.constructor||Float32Array,S=n*i+a;if(ArrayBuffer.isView(e)){if(S<=e.length)return e;if(S*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new v(e.buffer,0,S)}let I=1/0;_&&(I=_*i+a);const B=this._allocate(v,S,l,I);return e&&h?B.set(e):l||B.fill(0,0,4),this._release(e),B}release(e){this._release(e)}_allocate(e,n,i,r){let a=Math.max(Math.ceil(n*this.opts.overAlloc),1);a>r&&(a=r);const h=this._pool,l=e.BYTES_PER_ELEMENT*a,_=h.findIndex(v=>v.byteLength>=l);if(_>=0){const v=new e(h.splice(_,1)[0],0,a);return i&&v.fill(0),v}return new e(a)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:r}=i,a=n.findIndex(h=>h.byteLength>=r);a<0?n.push(i):(a>0||n.length<this.opts.poolSize)&&n.splice(a,0,i),n.length>this.opts.poolSize&&n.shift()}}const jh=new L8;function xf(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function R8(t){return[t[12],t[13],t[14]]}function D8(t){return{left:Zu(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Zu(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Zu(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Zu(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Zu(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Zu(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const jS=new Te;function Zu(t,e,n,i){jS.set(t,e,n);const r=jS.len();return{distance:i/r,normal:new Te(-t/r,-e/r,-n/r)}}function O8(t){return t-Math.fround(t)}let af;function tv(t,e){const{size:n=1,startIndex:i=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,a=(r-i)/n;af=jh.allocate(af,a,{type:Float32Array,size:n*2});let h=i,l=0;for(;h<r;){for(let _=0;_<n;_++){const v=t[h++];af[l+_]=v,af[l+_+n]=O8(v)}l+=n*2}return af.subarray(0,a*n*2)}function F8(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const k8=Math.PI/180,z8=xf(),HS=[0,0,0],N8={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function U8({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:a,near:h,far:l}){const _=t/e,v=n?new Qt().orthographic({fovy:i,aspect:_,focalDistance:r,near:h,far:l}):new Qt().perspective({fovy:i,aspect:_,near:h,far:l});if(a){const{left:S=0,right:I=0,top:B=0,bottom:z=0}=a,V=ka((S+t-I)/2,0,t)-t/2,J=ka((B+e-z)/2,0,e)-e/2;v[8]-=V*2/t,v[9]+=J*2/e}return v}class Kh{constructor(e={}){R(this,"id",void 0),R(this,"x",void 0),R(this,"y",void 0),R(this,"width",void 0),R(this,"height",void 0),R(this,"padding",void 0),R(this,"isGeospatial",void 0),R(this,"zoom",void 0),R(this,"focalDistance",void 0),R(this,"position",void 0),R(this,"modelMatrix",void 0),R(this,"distanceScales",void 0),R(this,"scale",void 0),R(this,"center",void 0),R(this,"cameraPosition",void 0),R(this,"projectionMatrix",void 0),R(this,"viewMatrix",void 0),R(this,"viewMatrixUncentered",void 0),R(this,"viewMatrixInverse",void 0),R(this,"viewProjectionMatrix",void 0),R(this,"pixelProjectionMatrix",void 0),R(this,"pixelUnprojectionMatrix",void 0),R(this,"resolution",void 0),R(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||N8,this.focalDistance=e.focalDistance||1,this.position=e.position||HS,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?sa.WEB_MERCATOR:sa.WEB_MERCATOR_AUTO_OFFSET:sa.IDENTITY}equals(e){return e instanceof Kh?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Oo(e.projectionMatrix,this.projectionMatrix)&&Oo(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),r=IB(i,this.pixelProjectionMatrix),[a,h]=r,l=n?h:this.height-h;return e.length===2?[a,l]:[a,l,r[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,a,h]=e,l=n?a:this.height-a,_=i&&i*this.distanceScales.unitsPerMeter[2],v=Hb([r,l,h],this.pixelUnprojectionMatrix,_),[S,I,B]=this.unprojectPosition(v);return Number.isFinite(h)?[S,I,B]:Number.isFinite(i)?[S,I,i]:[S,I]}projectPosition(e){const[n,i]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,r]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,r]}projectFlat(e){if(this.isGeospatial){const n=l_(e);return n[1]=ka(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Vh(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),r=this.unproject([this.width,0],n),a=this.unproject([0,this.height],n),h=this.unproject([this.width,this.height],n);return[Math.min(i[0],r[0],a[0],h[0]),Math.min(i[1],r[1],a[1],h[1]),Math.max(i[0],r[0],a[0],h[0]),Math.max(i[1],r[1],a[1],h[1])]}getDistanceScales(e){return e?H1({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,D8(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=f8({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||H1({latitude:i,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:a,modelMatrix:h}=e;let l=HS;if(a&&(l=h?new Qt(h).transformAsVector(a,[]):a),this.isGeospatial){const _=this.projectPosition([n,i,0]);this.center=new Te(l).scale(this.distanceScales.unitsPerMeter).add(_)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=z8,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:a,fovy:h=75,near:l=.1,far:_=1e3,padding:v=null,focalDistance:S=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Qt().multiplyRight(n).translate(new Te(this.center).negate()),this.projectionMatrix=i||U8({width:this.width,height:this.height,orthographic:r,fovyRadians:a||h*k8,focalDistance:S,padding:v,near:l,far:_});const I=xf();Gc(I,I,this.projectionMatrix),Gc(I,I,this.viewMatrix),this.viewProjectionMatrix=I,this.viewMatrixInverse=N1([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=R8(this.viewMatrixInverse);const B=xf(),z=xf();kb(B,B,[this.width/2,-this.height/2,1]),s_(B,B,[1,-1,0]),Gc(z,B,this.viewProjectionMatrix),this.pixelProjectionMatrix=z,this.pixelUnprojectionMatrix=N1(xf(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ln.warn("Pixel project matrix not invertible")()}}R(Kh,"displayName","Viewport");class Hh extends Kh{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,pitch:a=0,bearing:h=0,nearZMultiplier:l=.1,farZMultiplier:_=1.01,nearZ:v,farZ:S,orthographic:I=!1,projectionMatrix:B,repeat:z=!1,worldOffset:V=0,position:J,padding:ue,legacyMeterSizes:j=!1}=e;let{width:W,height:Z,altitude:ae=1.5}=e;const be=Math.pow(2,r);W=W||1,Z=Z||1;let Ee,Le=null;if(B)ae=B[5]/2,Ee=c_(ae);else{e.fovy?(Ee=e.fovy,ae=CB(Ee)):Ee=c_(ae);let Ue;if(ue){const{top:Me=0,bottom:ut=0}=ue;Ue=[0,ka((Me+Z-ut)/2,0,Z)-Z/2]}Le=m8({width:W,height:Z,scale:be,center:J&&[0,0,J[2]*Q0(n)],offset:Ue,pitch:a,fovy:Ee,nearZMultiplier:l,farZMultiplier:_}),Number.isFinite(v)&&(Le.near=v),Number.isFinite(S)&&(Le.far=S)}let ke=p8({height:Z,pitch:a,bearing:h,scale:be,altitude:ae});V&&(ke=new Qt().translate([512*V,0,0]).multiplyLeft(ke)),super({...e,width:W,height:Z,viewMatrix:ke,longitude:i,latitude:n,zoom:r,...Le,fovy:Ee,focalDistance:ae}),R(this,"longitude",void 0),R(this,"latitude",void 0),R(this,"pitch",void 0),R(this,"bearing",void 0),R(this,"altitude",void 0),R(this,"fovy",void 0),R(this,"orthographic",void 0),R(this,"_subViewports",void 0),R(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=a,this.bearing=h,this.altitude=ae,this.fovy=Ee,this.orthographic=I,this._subViewports=z?[]:null,this._pseudoMeters=j,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=n;r<=i;r++){const a=r?new Hh({...this,worldOffset:r}):this;this._subViewports.push(a)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),r=(e[2]||0)*Q0(e[1]);return[n,i,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),r=(e[2]||0)/Q0(i);return[n,i,r]}addMetersToLngLat(e,n){return SB(e,n)}panByPosition(e,n){const i=Hb(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),a=SS([],r,UG([],i)),h=SS([],this.center,a),[l,_]=this.unprojectFlat(h);return{longitude:l,latitude:_}}getBounds(e={}){const n=y8(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:r}=this,{longitude:a,latitude:h,zoom:l}=g8({width:i,height:r,bounds:e,...n});return new Hh({width:i,height:r,longitude:a,latitude:h,zoom:l})}}R(Hh,"displayName","WebMercatorViewport");const WS=[0,0,0];function nv(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof Hh){const[r,a,h=0]=t,l=e.getDistanceScales([r,a]);i[2]=h*l.unitsPerMeter[2]}return i}function G8(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:a,fromCoordinateOrigin:h}=t;return r===Jt.DEFAULT&&(r=e.isGeospatial?Jt.LNGLAT:Jt.CARTESIAN),a===void 0&&(a=r),h===void 0&&(h=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:a,fromCoordinateOrigin:h}}function PB(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:a}){let[h,l,_=0]=t;switch(n&&([h,l,_]=xp([],[h,l,_,1],n)),i){case Jt.LNGLAT:return nv([h,l,_],e,a);case Jt.LNGLAT_OFFSETS:return nv([h+r[0],l+r[1],_+(r[2]||0)],e,a);case Jt.METER_OFFSETS:return nv(SB(r,[h,l,_]),e,a);case Jt.CARTESIAN:default:return e.isGeospatial?[h+r[0],l+r[1],_+r[2]]:e.projectPosition([h,l,_])}}function MB(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:a,fromCoordinateSystem:h,fromCoordinateOrigin:l}=G8(e),{autoOffset:_=!0}=e,{geospatialOrigin:v=WS,shaderCoordinateOrigin:S=WS,offsetMode:I=!1}=_?EB(n,i,r):{},B=PB(t,{viewport:n,modelMatrix:a,coordinateSystem:h,coordinateOrigin:l,offsetMode:I});if(I){const z=n.projectPosition(v||S);YG(B,B,z)}return B}const V8=[255,255,255],j8=1,H8=[0,0,1],W8=[0,0,1];let q8=0;class qS{constructor(e={}){R(this,"id",void 0),R(this,"color",void 0),R(this,"intensity",void 0),R(this,"type","point"),R(this,"position",void 0),R(this,"attenuation",void 0),R(this,"projectedLight",void 0);const{color:n=V8}=e,{intensity:i=j8}=e,{position:r=W8}=e;this.id=e.id||"point-".concat(q8++),this.color=n,this.intensity=i,this.type="point",this.position=r,this.attenuation=X8(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:n}=this,i=e.context.viewport,{coordinateSystem:r,coordinateOrigin:a}=e.props,h=MB(this.position,{viewport:i,coordinateSystem:r,coordinateOrigin:a,fromCoordinateSystem:i.isGeospatial?Jt.LNGLAT:Jt.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return n.color=this.color,n.intensity=this.intensity,n.position=h,n}}function X8(t){return t.attenuation?t.attenuation:"intensity"in t?[0,0,t.intensity||0]:H8}const XS={blendFunc:[1,0,32771,0],blendEquation:32774};class BB extends Gb{constructor(...e){super(...e),R(this,"pickZ",void 0),R(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:a,pickingFBO:h,deviceRect:{x:l,y:_,width:v,height:S},cullRect:I,effects:B,pass:z="picking",pickZ:V,moduleParameters:J}){const ue=this.gl;this.pickZ=V;const j=this._resetColorEncoder(V),W=Do(ue,{scissorTest:!0,scissor:[l,_,v,S],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...XS,blend:!V},()=>super.render({target:h,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:a,cullRect:I,effects:B==null?void 0:B.filter(ae=>ae.useInPicking),pass:z,isPicking:!0,moduleParameters:J}));return this._colorEncoderState=null,{decodePickingColor:j&&Z8.bind(null,j),stats:W}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const r={...e.props.parameters},{pickable:a,operation:h}=e.props;return this._colorEncoderState?a&&h.includes("draw")&&(Object.assign(r,XS),r.blend=!0,r.blendColor=$8(this._colorEncoderState,e,i)):r.blend=!1,h.includes("terrain")&&(r.blend=!1),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function $8(t,e,n){const{byLayer:i,byAlpha:r}=t;let a,h=i.get(e);return h?(h.viewports.push(n),a=h.a):(a=i.size+1,a<=255?(h={a,layer:e,viewports:[n]},i.set(e,h),r[a]=h):(ln.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function Z8(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const eh={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},u_=Symbol.for("component"),Gl=Symbol.for("propTypes"),iv=Symbol.for("deprecatedProps"),Sh=Symbol.for("asyncPropDefaults"),$c=Symbol.for("asyncPropOriginal"),Bl=Symbol.for("asyncPropResolved");function qb(t,e=()=>!0){return Array.isArray(t)?LB(t,e,[]):e(t)?[t]:[]}function LB(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?LB(r,e,n):e(r)&&n.push(r)}return n}function J8({target:t,source:e,start:n=0,count:i=1}){const r=e.length,a=i*r;let h=0;for(let l=n;h<r;h++)t[l++]=e[h];for(;h<a;)h<a-h?(t.copyWithin(n+h,n,n+h),h*=2):(t.copyWithin(n+h,n,n+a-h),h=a);return t}class K8{constructor(e,n,i){R(this,"id",void 0),R(this,"context",void 0),R(this,"isLoaded",void 0),R(this,"persistent",void 0),R(this,"_loadCount",0),R(this,"_subscribers",new Set),R(this,"_data",void 0),R(this,"_loader",void 0),R(this,"_error",void 0),R(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let r=e;typeof e=="string"&&(r=Hl(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=a)}).catch(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=a||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const a of this._subscribers)a.onChange(this.getData())}}class Y8{constructor({gl:e,protocol:n}){R(this,"protocol",void 0),R(this,"_context",void 0),R(this,"_resources",void 0),R(this,"_consumers",void 0),R(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}){let a=this._resources[e];a?a.setData(n,i):(a=new K8(e,n,this._context),this._resources[e]=a),a.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const r=n[i],a=this._resources[r.resourceId];a&&a.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:r="default"}){const{_resources:a,protocol:h}=this;e.startsWith(h)&&(e=e.replace(h,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=a[e];if(this._track(i,r,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,r){const a=this._consumers,h=a[e]=a[e]||{},l=h[n]||{},_=l.resourceId&&this._resources[l.resourceId];_&&(_.unsubscribe(l),this.prune()),i&&(h[n]=l,l.onChange=r,l.resourceId=i.id,i.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const Q8=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,N_={name:"project32",dependencies:[Vb],vs:Q8},U_={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...sV},e9=[Vb],t9=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function n9(t){const e=bp.getDefaultProgramManager(t);for(const n of e9)e.addDefaultModule(n);for(const n of t9)e.addShaderHook(n);return e}const i9="layerManager.setLayers",r9="layerManager.activateViewport";class s9{constructor(e,{deck:n,stats:i,viewport:r,timeline:a}={}){R(this,"layers",void 0),R(this,"context",void 0),R(this,"resourceManager",void 0),R(this,"_lastRenderedLayers",[]),R(this,"_needsRedraw",!1),R(this,"_needsUpdate",!1),R(this,"_nextLayers",null),R(this,"_debug",!1),R(this,"activateViewport",h=>{Er(r9,this,h),h&&(this.context.viewport=h)}),this.layers=[],this.resourceManager=new Y8({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&n9(e),stats:i||new Ab({id:"deck.gl"}),viewport:r||new Kh({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:a||new yB,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Er(i9,this,n,e),this._lastRenderedLayers=e;const i=qb(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const h of e)i[h.id]?ln.warn("Multiple old layers with same id ".concat(h.id))():i[h.id]=h;const r=[];this._updateSublayersRecursively(n,i,r),this._finalizeOldLayers(i);let a=!1;for(const h of r)if(h.hasUniformTransition()){a="Uniform transition in ".concat(h);break}this._needsUpdate=a,this.layers=r}_updateSublayersRecursively(e,n,i){for(const r of e){r.context=this.context;const a=n[r.id];a===null&&ln.warn("Multiple new layers with same id ".concat(r.id))(),n[r.id]=null;let h=null;try{this._debug&&a!==r&&r.validateProps(),a?(this._transferLayerState(a,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),h=r.isComposite?r.getSubLayers():null}catch(l){this._handleError("matching",l,r)}h&&this._updateSublayersRecursively(h,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=eh.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=eh.MATCHED,n!==e&&(e.lifecycle=eh.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=eh.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=eh.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function oa(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!oa(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(const a of i)if(!e.hasOwnProperty(a)||!oa(t[a],e[a],n-1))return!1;return!0}return!1}class o9{constructor(e){R(this,"width",void 0),R(this,"height",void 0),R(this,"views",void 0),R(this,"viewState",void 0),R(this,"controllers",void 0),R(this,"timeline",void 0),R(this,"_viewports",void 0),R(this,"_viewportMap",void 0),R(this,"_isUpdating",void 0),R(this,"_needsRedraw",void 0),R(this,"_needsUpdate",void 0),R(this,"_eventManager",void 0),R(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let a=i.length-1;a>=0;--a){const h=i[a];if(h.containsPixel(r)){const l=e.slice();return l[0]-=h.x,l[1]-=h.y,h.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=qb(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!oa(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ln.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:a=>{var h;return(h=this.getView(e.id))===null||h===void 0?void 0:h.makeViewport({viewState:a,width:this.width,height:this.height})}})}_updateController(e,n,i,r){const a=e.controller;if(a&&i){const h={...n,...a,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!r||r.constructor!==a.type)&&(r=this._createController(e,h)),r&&r.setProps(h),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const a=e[r],h=this.getViewState(a),l=a.makeViewport({viewState:h,width:this.width,height:this.height});let _=n[a.id];const v=!!a.controller;v&&!_&&(i=!0),(i||!v)&&_&&(_.finalize(),_=null),this.controllers[a.id]=this._updateController(a,h,l,_),l&&this._viewports.unshift(l)}for(const r in n){const a=n[r];a&&!this.controllers[r]&&a.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,r)=>!e[r].equals(n[r]))}}const a9=/([0-9]+\.?[0-9]*)(%|px)/;function xl(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=a9.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function bl(t,e){return t.relative?Math.round(t.position*e):t.position}function Ki(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Wh{constructor(e){R(this,"id",void 0),R(this,"viewportInstance",void 0),R(this,"_x",void 0),R(this,"_y",void 0),R(this,"_width",void 0),R(this,"_height",void 0),R(this,"_padding",void 0),R(this,"props",void 0);const{id:n,x:i=0,y:r=0,width:a="100%",height:h="100%",padding:l=null,viewportInstance:_}=e||{};Ki(!_||_ instanceof Kh),this.viewportInstance=_,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=xl(i),this._y=xl(r),this._width=xl(a),this._height=xl(h),this._padding=l&&{left:xl(l.left||0),right:xl(l.right||0),top:xl(l.top||0),bottom:xl(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&oa(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});return!r.height||!r.width?null:new this.ViewportType({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:bl(this._x,e),y:bl(this._y,n),width:bl(this._width,e),height:bl(this._height,n)};return this._padding&&(i.padding={left:bl(this._padding.left,e),top:bl(this._padding.top,n),right:bl(this._padding.right,e),bottom:bl(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Ap{constructor(e){R(this,"_inProgress",void 0),R(this,"_handle",void 0),R(this,"_timeline",void 0),R(this,"time",void 0),R(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:r}=this;this._handle=i.addChannel({delay:i.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const $S=()=>{},W1={BREAK:1,SNAP_TO_END:2,IGNORE:3},l9=t=>t,c9=W1.BREAK;class u9{constructor(e){R(this,"getControllerState",void 0),R(this,"props",void 0),R(this,"propsInTransition",void 0),R(this,"transition",void 0),R(this,"onViewStateChange",void 0),R(this,"onStateChange",void 0),R(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:r,startProps:a,endProps:h,duration:l,easing:_}}=n,v=_(i/l),S=r.interpolateProps(a,h,v);this.propsInTransition=this.getControllerState({...this.props,...S}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Ap(e.timeline),this.onViewStateChange=e.onViewStateChange||$S,this.onStateChange=e.onStateChange||$S}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:a,endProps:h}=this.transition.settings;r={...i,...a===W1.SNAP_TO_END?h:this.propsInTransition||i}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===W1.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(i),a=n.transitionInterpolator,h=a.getDuration?a.getDuration(e,n):n.transitionDuration;if(h===0)return;const l=a.initializeProps(e,r);this.propsInTransition={};const _={duration:h,easing:n.transitionEasing||l9,interpolator:a,interruption:n.transitionInterruption||c9,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(_),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class h9{constructor(e){R(this,"_propsToCompare",void 0),R(this,"_propsToExtract",void 0),R(this,"_requiredProps",void 0);const{compare:n,extract:i,required:r}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=r}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!Oo(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},r={};for(const a of this._propsToExtract)(a in e||a in n)&&(i[a]=e[a],r[a]=n[a]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];Ki(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const d9=["longitude","latitude","zoom","bearing","pitch"],f9=["longitude","latitude","zoom"];class RB extends h9{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:d9,required:f9},super(i.transitionProps),R(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:r,around:a}=this.opts;if(r&&a){const h=r(e),l=r(n),_=h.unproject(a);i.start.around=a,Object.assign(i.end,{around:l.project(_),aroundPosition:_,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const r={};for(const a of this._propsToExtract)r[a]=r_(e[a]||0,n[a]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const a=this.opts.makeViewport({...n,...r});Object.assign(r,a.panByPosition(n.aroundPosition,r_(e.around,n.around,i)))}return r}}const wl={transitionDuration:0},p9=300,qm=t=>1-(1-t)*(1-t),Ju={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Cc={};class m9{constructor(e){R(this,"props",void 0),R(this,"state",{}),R(this,"transitionManager",void 0),R(this,"eventManager",void 0),R(this,"onViewStateChange",void 0),R(this,"onStateChange",void 0),R(this,"makeViewport",void 0),R(this,"_controllerState",void 0),R(this,"_events",{}),R(this,"_interactionState",{isDragging:!1}),R(this,"_customEvents",[]),R(this,"_eventStartBlocked",null),R(this,"_panMove",!1),R(this,"invertPan",!1),R(this,"dragMode","rotate"),R(this,"inertia",0),R(this,"scrollZoom",!0),R(this,"dragPan",!0),R(this,"dragRotate",!0),R(this,"doubleClickZoom",!0),R(this,"touchZoom",!0),R(this,"touchRotate",!1),R(this,"keyboard",!0),this.transitionManager=new u9({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-i]}isPointInBounds(e,n){const{width:i,height:r}=this.props;if(n&&n.handled)return!1;const a=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return a&&n&&n.stopPropagation(),a}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?p9:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:a=!0,doubleClickZoom:h=!0,touchZoom:l=!0,touchRotate:_=!1,keyboard:v=!0}=e,S=!!this.onViewStateChange;this.toggleEvents(Ju.WHEEL,S&&i),this.toggleEvents(Ju.PAN,S),this.toggleEvents(Ju.PINCH,S&&(l||_)),this.toggleEvents(Ju.TRIPLE_PAN,S&&_),this.toggleEvents(Ju.DOUBLE_TAP,S&&h),this.toggleEvents(Ju.KEYBOARD,S&&v),this.scrollZoom=i,this.dragPan=r,this.dragRotate=a,this.doubleClickZoom=h,this.touchZoom=l,this.touchRotate=_,this.keyboard=v}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const r={...e.getViewportProps(),...n},a=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),a){const h=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:h})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(r,wl,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,wl,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],a=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:qm},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,wl,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],a=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:qm},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:a}=e;let h=2/(1+Math.exp(-Math.abs(a*i)));a<0&&h!==0&&(h=1/h);const l=this.controllerState.zoom({pos:n,scale:h});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,wl,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,wl,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],a=this.controllerState.rotate({pos:r});this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:qm},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Cc._startPinchRotation=e.rotation,Cc._lastPinchEvent=e,this.updateViewport(i,wl,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:Cc._startPinchRotation-i})}return this.updateViewport(n,wl,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Cc._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=Cc;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const r=this.getCenter(e);let a=this.controllerState.rotateEnd();const h=Math.log2(e.scale),l=(h-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),_=Math.pow(2,h+l*n/2);a=a.zoom({pos:r,scale:_}).zoomEnd(),this.updateViewport(a,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:qm},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Cc._startPinchRotation=null,Cc._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:a,rotateSpeedY:h}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let _;const v={};switch(e.srcEvent.code){case"Minus":_=n?l.zoomOut(i).zoomOut(i):l.zoomOut(i),v.isZooming=!0;break;case"Equal":_=n?l.zoomIn(i).zoomIn(i):l.zoomIn(i),v.isZooming=!0;break;case"ArrowLeft":n?(_=l.rotateLeft(a),v.isRotating=!0):(_=l.moveLeft(r),v.isPanning=!0);break;case"ArrowRight":n?(_=l.rotateRight(a),v.isRotating=!0):(_=l.moveRight(r),v.isPanning=!0);break;case"ArrowUp":n?(_=l.rotateUp(h),v.isRotating=!0):(_=l.moveUp(r),v.isPanning=!0);break;case"ArrowDown":n?(_=l.rotateDown(h),v.isRotating=!0):(_=l.moveDown(r),v.isPanning=!0);break;default:return!1}return this.updateViewport(_,this._getTransitionProps(),v),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?wl:e?{...n,transitionInterpolator:new RB({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class g9{constructor(e,n){R(this,"_viewportProps",void 0),R(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const ZS=5,_9=1.2;class y9 extends g9{constructor(e){const{width:n,height:i,latitude:r,longitude:a,zoom:h,bearing:l=0,pitch:_=0,altitude:v=1.5,position:S=[0,0,0],maxZoom:I=20,minZoom:B=0,maxPitch:z=60,minPitch:V=0,startPanLngLat:J,startZoomLngLat:ue,startRotatePos:j,startBearing:W,startPitch:Z,startZoom:ae,normalize:be=!0}=e;Ki(Number.isFinite(a)),Ki(Number.isFinite(r)),Ki(Number.isFinite(h)),super({width:n,height:i,latitude:r,longitude:a,zoom:h,bearing:l,pitch:_,altitude:v,maxZoom:I,minZoom:B,maxPitch:z,minPitch:V,normalize:be,position:S},{startPanLngLat:J,startZoomLngLat:ue,startRotatePos:j,startBearing:W,startPitch:Z,startZoom:ae}),R(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:a,startPitch:h}=this.getState();if(!r||a===void 0||h===void 0)return this;let l;return e?l=this._getNewRotation(e,r,h,a):l={bearing:a+n,pitch:h+i},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomLngLat:a}=this.getState();if(a||(r=this.getViewportProps().zoom,a=this._unproject(n)||this._unproject(e)),!a)return this;const{maxZoom:h,minZoom:l}=this.getViewportProps();let _=r+Math.log2(i);_=ka(_,l,h);const v=this.makeViewport({...this.getViewportProps(),zoom:_});return this._getUpdatedState({zoom:_,...v.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:a}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(a-n.longitude)>180&&(i.longitude=a<0?a+360:a-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=ka(r,i,n);const{maxPitch:a,minPitch:h,pitch:l}=e;e.pitch=ka(l,h,a);const{normalize:_=!0}=e;return _&&Object.assign(e,v8(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,r){const a=e[0]-n[0],h=e[1]-n[1],l=e[1],_=n[1],{width:v,height:S}=this.getViewportProps(),I=a/v;let B=0;h>0?Math.abs(S-_)>ZS&&(B=h/(_-S)*_9):h<0&&_>ZS&&(B=1-l/_),B=ka(B,-1,1);const{minPitch:z,maxPitch:V}=this.getViewportProps(),J=r+180*I;let ue=i;return B>0?ue=i+B*(V-i):B<0&&(ue=i-B*(z-i)),{pitch:ue,bearing:J}}}class v9 extends m9{constructor(...e){super(...e),R(this,"ControllerState",y9),R(this,"transition",{transitionDuration:300,transitionInterpolator:new RB({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),R(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class DB extends Wh{get ViewportType(){return Hh}get ControllerType(){return v9}}R(DB,"displayName","MapView");const x9=new Wb;function b9(t,e){var n,i;const r=(n=t.order)!==null&&n!==void 0?n:1/0,a=(i=e.order)!==null&&i!==void 0?i:1/0;return r-a}class w9{constructor(){R(this,"effects",void 0),R(this,"_resolvedEffects",[]),R(this,"_defaultEffects",[]),R(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(r=>b9(r,e)>0);i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(oa(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const r of this.effects)n[r.id]=r;const i=[];for(const r of e){const a=n[r.id];a&&a!==r?a.setProps?(a.setProps(r.props),i.push(a)):(a.cleanup(),i.push(r)):i.push(r),delete n[r.id]}for(const r in n)n[r].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(r=>r instanceof Wb)||this._resolvedEffects.push(x9),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class A9 extends Gb{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const E9="deckRenderer.renderLayers";class T9{constructor(e){R(this,"gl",void 0),R(this,"layerFilter",void 0),R(this,"drawPickingColors",void 0),R(this,"drawLayersPass",void 0),R(this,"pickLayersPass",void 0),R(this,"renderCount",void 0),R(this,"_needsRedraw",void 0),R(this,"renderBuffers",void 0),R(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new A9(e),this.pickLayersPass=new BB(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||Gi.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const r=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,a=n.render({...i,target:r});i.effects&&this._postRender(i.effects,i),this.renderCount++,Er(E9,this,a,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(this.gl,n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Gi(this.gl),new Gi(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,r={...n,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const a of e)if(a.postRender){if(a.id===this.lastPostProcessEffect){r.target=n.target,a.postRender(this.gl,r);break}const h=a.postRender(this.gl,r);r.inputBuffer=h,r.swapBuffer=h===i[0]?i[1]:i[0]}}}const S9={pickedColor:null,pickedObjectIndex:-1};function C9({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:a}){const{x:h,y:l,width:_,height:v}=a;let S=r*r,I=-1,B=0;for(let z=0;z<v;z++){const V=z+l-i,J=V*V;if(J>S)B+=4*_;else for(let ue=0;ue<_;ue++){if(t[B+3]-1>=0){const W=ue+h-n,Z=W*W+J;Z<=S&&(S=Z,I=B)}B+=4}}if(I>=0){const z=t.slice(I,I+4),V=e(z);if(V){const J=Math.floor(I/4/_),ue=I/4-J*_;return{...V,pickedColor:z,pickedX:h+ue,pickedY:l+J}}ln.error("Picked non-existent layer. Is picking buffer corrupt?")()}return S9}function I9({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const a=t.slice(i,i+4),h=a.join(",");if(!n.has(h)){const l=e(a);l?n.set(h,{...l,color:a}):ln.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function OB({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:a}){let h=e[0];e.length>1&&(h=M9((t==null?void 0:t.pickedViewports)||e,{x:i,y:r}));let l;if(h){const _=[i-h.x,r-h.y];a!==void 0&&(_[2]=a),l=h.unproject(_)}return{color:null,layer:null,viewport:h,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function P9(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:a,pickedLayer:h,pickedObjectIndex:l}=e,_=h?[h]:[];if(i==="hover"){const I=n.index,B=n.layerId,z=h?h.props.id:null;if(z!==B||l!==I){if(z!==B){const V=r.find(J=>J.props.id===B);V&&_.unshift(V)}n.layerId=z,n.index=l,n.info=null}}const v=OB(t),S=new Map;return S.set(null,v),_.forEach(I=>{let B={...v};I===h&&(B.color=a,B.index=l,B.picked=!0),B=FB({layer:I,info:B,mode:i});const z=B.layer;I===h&&i==="hover"&&(n.info=B),S.set(z.id,B),i==="hover"&&z.updateAutoHighlight(B)}),S}function FB({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function M9(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class B9{constructor(e){R(this,"gl",void 0),R(this,"pickingFBO",void 0),R(this,"depthFBO",void 0),R(this,"pickLayersPass",void 0),R(this,"layerFilter",void 0),R(this,"lastPickedInfo",void 0),R(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new BB(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:r},a=this.lastPickedInfo.info){const h=a&&a.layer&&a.layer.id,l=a&&a.viewport&&a.viewport.id,_=h?i.find(B=>B.id===h):null,v=l&&r.find(B=>B.id===l)||r[0],S=v&&v.unproject([e-v.x,n-v.y]);return{...a,...{x:e,y:n,viewport:v,coordinate:S,layer:_}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new Gi(i),Gi.isSupported(i,{colorBufferFloat:!0}))){const r=new Gi(i);r.attach({36064:new Ds(i,{format:Xt(i)?34836:6408,type:5126})}),this.depthFBO=r}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:r,y:a,radius:h=0,depth:l=1,mode:_="query",unproject3D:v,onViewportActive:S,effects:I}){const B=this._getPickable(e),z=kh(this.gl);if(!B)return{result:[],emptyInfo:OB({viewports:i,x:r,y:a,pixelRatio:z})};this._resizeBuffer();const V=U0(this.gl,[r,a],!0),J=[V.x+Math.floor(V.width/2),V.y+Math.floor(V.height/2)],ue=Math.round(h*z),{width:j,height:W}=this.pickingFBO,Z=this._getPickingRect({deviceX:J[0],deviceY:J[1],deviceRadius:ue,deviceWidth:j,deviceHeight:W}),ae={x:r-h,y:a-h,width:h*2+1,height:h*2+1};let be;const Ee=[],Le=new Set;for(let ke=0;ke<l;ke++){let Ue;if(Z){const ut=this._drawAndSample({layers:B,views:n,viewports:i,onViewportActive:S,deviceRect:Z,cullRect:ae,effects:I,pass:"picking:".concat(_)});Ue=C9({...ut,deviceX:J[0],deviceY:J[1],deviceRadius:ue,deviceRect:Z})}else Ue={pickedColor:null,pickedObjectIndex:-1};let Me;if(Ue.pickedLayer&&v&&this.depthFBO){const{pickedColors:ut}=this._drawAndSample({layers:[Ue.pickedLayer],views:n,viewports:i,onViewportActive:S,deviceRect:{x:Ue.pickedX,y:Ue.pickedY,width:1,height:1},cullRect:ae,effects:I,pass:"picking:".concat(_,":z")},!0);ut[3]&&(Me=ut[0])}Ue.pickedLayer&&ke+1<l&&(Le.add(Ue.pickedLayer),Ue.pickedLayer.disablePickingIndex(Ue.pickedObjectIndex)),be=P9({pickInfo:Ue,lastPickedInfo:this.lastPickedInfo,mode:_,layers:B,viewports:i,x:r,y:a,z:Me,pixelRatio:z});for(const ut of be.values())ut.layer&&Ee.push(ut);if(!Ue.pickedColor)break}for(const ke of Le)ke.restorePickingColors();return{result:Ee,emptyInfo:be.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:r,y:a,width:h=1,height:l=1,mode:_="query",maxObjects:v=null,onViewportActive:S,effects:I}){const B=this._getPickable(e);if(!B)return[];this._resizeBuffer();const z=kh(this.gl),V=U0(this.gl,[r,a],!0),J=V.x,ue=V.y+V.height,j=U0(this.gl,[r+h,a+l],!0),W=j.x+j.width,Z=j.y,ae={x:J,y:Z,width:W-J,height:ue-Z},be=this._drawAndSample({layers:B,views:n,viewports:i,onViewportActive:S,deviceRect:ae,cullRect:{x:r,y:a,width:h,height:l},effects:I,pass:"picking:".concat(_)}),Ee=I9(be),Le=new Map,ke=Number.isFinite(v);for(let Ue=0;Ue<Ee.length&&!(ke&&v&&Le.size>=v);Ue++){const Me=Ee[Ue];let ut={color:Me.pickedColor,layer:null,index:Me.pickedObjectIndex,picked:!0,x:r,y:a,pixelRatio:z};ut=FB({layer:Me.pickedLayer,info:ut,mode:_}),Le.has(ut.object)||Le.set(ut.object,ut)}return Array.from(Le.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:a,cullRect:h,effects:l,pass:_},v=!1){const S=v?this.depthFBO:this.pickingFBO,I={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:S,deviceRect:a,cullRect:h,effects:l,pass:_,pickZ:v,preRenderStats:{}};for(const W of l)W.useInPicking&&(I.preRenderStats[W.id]=W.preRender(this.gl,I));const{decodePickingColor:B}=this.pickLayersPass.render(I),{x:z,y:V,width:J,height:ue}=a,j=new(v?Float32Array:Uint8Array)(J*ue*4);return z_(S,{sourceX:z,sourceY:V,sourceWidth:J,sourceHeight:ue,target:j}),{pickedColors:j,decodePickingColor:B}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:a}){const h=Math.max(0,e-i),l=Math.max(0,n-i),_=Math.min(r,e+i+1)-h,v=Math.min(a,n+i+1)-l;return _<=0||v<=0?null:{x:h,y:l,width:_,height:v}}}const L9={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class R9{constructor(e){R(this,"el",null),R(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,L9),n.appendChild(this.el))}setTooltip(e,n,i){const r=this.el;if(r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform="translate(".concat(n,"px, ").concat(i,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(r.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var kB={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,r){var a=["","webkit","Moz","MS","ms","o"],h=n.createElement("div"),l="function",_=Math.round,v=Math.abs,S=Date.now;function I($,Y,pe){return setTimeout(Z($,pe),Y)}function B($,Y,pe){return Array.isArray($)?(z($,pe[Y],pe),!0):!1}function z($,Y,pe){var Pe;if($)if($.forEach)$.forEach(Y,pe);else if($.length!==r)for(Pe=0;Pe<$.length;)Y.call(pe,$[Pe],Pe,$),Pe++;else for(Pe in $)$.hasOwnProperty(Pe)&&Y.call(pe,$[Pe],Pe,$)}function V($,Y,pe){var Pe="DEPRECATED METHOD: "+Y+`
`+pe+` AT 
`;return function(){var je=new Error("get-stack-trace"),ot=je&&je.stack?je.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Vt=e.console&&(e.console.warn||e.console.log);return Vt&&Vt.call(e.console,Pe,ot),$.apply(this,arguments)}}var J;typeof Object.assign!="function"?J=function(Y){if(Y===r||Y===null)throw new TypeError("Cannot convert undefined or null to object");for(var pe=Object(Y),Pe=1;Pe<arguments.length;Pe++){var je=arguments[Pe];if(je!==r&&je!==null)for(var ot in je)je.hasOwnProperty(ot)&&(pe[ot]=je[ot])}return pe}:J=Object.assign;var ue=V(function(Y,pe,Pe){for(var je=Object.keys(pe),ot=0;ot<je.length;)(!Pe||Pe&&Y[je[ot]]===r)&&(Y[je[ot]]=pe[je[ot]]),ot++;return Y},"extend","Use `assign`."),j=V(function(Y,pe){return ue(Y,pe,!0)},"merge","Use `assign`.");function W($,Y,pe){var Pe=Y.prototype,je;je=$.prototype=Object.create(Pe),je.constructor=$,je._super=Pe,pe&&J(je,pe)}function Z($,Y){return function(){return $.apply(Y,arguments)}}function ae($,Y){return typeof $==l?$.apply(Y&&Y[0]||r,Y):$}function be($,Y){return $===r?Y:$}function Ee($,Y,pe){z(Me(Y),function(Pe){$.addEventListener(Pe,pe,!1)})}function Le($,Y,pe){z(Me(Y),function(Pe){$.removeEventListener(Pe,pe,!1)})}function ke($,Y){for(;$;){if($==Y)return!0;$=$.parentNode}return!1}function Ue($,Y){return $.indexOf(Y)>-1}function Me($){return $.trim().split(/\s+/g)}function ut($,Y,pe){if($.indexOf&&!pe)return $.indexOf(Y);for(var Pe=0;Pe<$.length;){if(pe&&$[Pe][pe]==Y||!pe&&$[Pe]===Y)return Pe;Pe++}return-1}function Lt($){return Array.prototype.slice.call($,0)}function Ft($,Y,pe){for(var Pe=[],je=[],ot=0;ot<$.length;){var Vt=Y?$[ot][Y]:$[ot];ut(je,Vt)<0&&Pe.push($[ot]),je[ot]=Vt,ot++}return pe&&(Y?Pe=Pe.sort(function(Wn,Si){return Wn[Y]>Si[Y]}):Pe=Pe.sort()),Pe}function Rt($,Y){for(var pe,Pe,je=Y[0].toUpperCase()+Y.slice(1),ot=0;ot<a.length;){if(pe=a[ot],Pe=pe?pe+je:Y,Pe in $)return Pe;ot++}return r}var Jn=1;function ai(){return Jn++}function Bi($){var Y=$.ownerDocument||$;return Y.defaultView||Y.parentWindow||e}var tt=/mobile|tablet|ip(ad|hone|od)|android/i,At="ontouchstart"in e,Pt=Rt(e,"PointerEvent")!==r,tn=At&&tt.test(navigator.userAgent),$t="touch",Kn="pen",Zt="mouse",Pr="kinect",Qi=25,mn=1,cr=2,cn=4,gn=8,er=1,ur=2,Be=4,tr=8,Xr=16,Ut=ur|Be,Gt=tr|Xr,ks=Ut|Gt,zs=["x","y"],lo=["clientX","clientY"];function Li($,Y){var pe=this;this.manager=$,this.callback=Y,this.element=$.element,this.target=$.options.inputTarget,this.domHandler=function(Pe){ae($.options.enable,[$])&&pe.handler(Pe)},this.init()}Li.prototype={handler:function(){},init:function(){this.evEl&&Ee(this.element,this.evEl,this.domHandler),this.evTarget&&Ee(this.target,this.evTarget,this.domHandler),this.evWin&&Ee(Bi(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Le(this.element,this.evEl,this.domHandler),this.evTarget&&Le(this.target,this.evTarget,this.domHandler),this.evWin&&Le(Bi(this.element),this.evWin,this.domHandler)}};function Sn($){var Y,pe=$.options.inputClass;return pe?Y=pe:Pt?Y=co:tn?Y=_e:At?Y=Re:Y=Mr,new Y($,ha)}function ha($,Y,pe){var Pe=pe.pointers.length,je=pe.changedPointers.length,ot=Y&mn&&Pe-je===0,Vt=Y&(cn|gn)&&Pe-je===0;pe.isFirst=!!ot,pe.isFinal=!!Vt,ot&&($.session={}),pe.eventType=Y,No($,pe),$.emit("hammer.input",pe),$.recognize(pe),$.session.prevInput=pe}function No($,Y){var pe=$.session,Pe=Y.pointers,je=Pe.length;pe.firstInput||(pe.firstInput=Di(Y)),je>1&&!pe.firstMultiple?pe.firstMultiple=Di(Y):je===1&&(pe.firstMultiple=!1);var ot=pe.firstInput,Vt=pe.firstMultiple,Qn=Vt?Vt.center:ot.center,Wn=Y.center=$r(Pe);Y.timeStamp=S(),Y.deltaTime=Y.timeStamp-ot.timeStamp,Y.angle=Mt(Qn,Wn),Y.distance=It(Qn,Wn),We(pe,Y),Y.offsetDirection=$e(Y.deltaX,Y.deltaY);var Si=ds(Y.deltaTime,Y.deltaX,Y.deltaY);Y.overallVelocityX=Si.x,Y.overallVelocityY=Si.y,Y.overallVelocity=v(Si.x)>v(Si.y)?Si.x:Si.y,Y.scale=Vt?fs(Vt.pointers,Pe):1,Y.rotation=Vt?Ti(Vt.pointers,Pe):0,Y.maxPointers=pe.prevInput?Y.pointers.length>pe.prevInput.maxPointers?Y.pointers.length:pe.prevInput.maxPointers:Y.pointers.length,Ri(pe,Y);var Ci=$.element;ke(Y.srcEvent.target,Ci)&&(Ci=Y.srcEvent.target),Y.target=Ci}function We($,Y){var pe=Y.center,Pe=$.offsetDelta||{},je=$.prevDelta||{},ot=$.prevInput||{};(Y.eventType===mn||ot.eventType===cn)&&(je=$.prevDelta={x:ot.deltaX||0,y:ot.deltaY||0},Pe=$.offsetDelta={x:pe.x,y:pe.y}),Y.deltaX=je.x+(pe.x-Pe.x),Y.deltaY=je.y+(pe.y-Pe.y)}function Ri($,Y){var pe=$.lastInterval||Y,Pe=Y.timeStamp-pe.timeStamp,je,ot,Vt,Qn;if(Y.eventType!=gn&&(Pe>Qi||pe.velocity===r)){var Wn=Y.deltaX-pe.deltaX,Si=Y.deltaY-pe.deltaY,Ci=ds(Pe,Wn,Si);ot=Ci.x,Vt=Ci.y,je=v(Ci.x)>v(Ci.y)?Ci.x:Ci.y,Qn=$e(Wn,Si),$.lastInterval=Y}else je=pe.velocity,ot=pe.velocityX,Vt=pe.velocityY,Qn=pe.direction;Y.velocity=je,Y.velocityX=ot,Y.velocityY=Vt,Y.direction=Qn}function Di($){for(var Y=[],pe=0;pe<$.pointers.length;)Y[pe]={clientX:_($.pointers[pe].clientX),clientY:_($.pointers[pe].clientY)},pe++;return{timeStamp:S(),pointers:Y,center:$r(Y),deltaX:$.deltaX,deltaY:$.deltaY}}function $r($){var Y=$.length;if(Y===1)return{x:_($[0].clientX),y:_($[0].clientY)};for(var pe=0,Pe=0,je=0;je<Y;)pe+=$[je].clientX,Pe+=$[je].clientY,je++;return{x:_(pe/Y),y:_(Pe/Y)}}function ds($,Y,pe){return{x:Y/$||0,y:pe/$||0}}function $e($,Y){return $===Y?er:v($)>=v(Y)?$<0?ur:Be:Y<0?tr:Xr}function It($,Y,pe){pe||(pe=zs);var Pe=Y[pe[0]]-$[pe[0]],je=Y[pe[1]]-$[pe[1]];return Math.sqrt(Pe*Pe+je*je)}function Mt($,Y,pe){pe||(pe=zs);var Pe=Y[pe[0]]-$[pe[0]],je=Y[pe[1]]-$[pe[1]];return Math.atan2(je,Pe)*180/Math.PI}function Ti($,Y){return Mt(Y[1],Y[0],lo)+Mt($[1],$[0],lo)}function fs($,Y){return It(Y[0],Y[1],lo)/It($[0],$[1],lo)}var Et={mousedown:mn,mousemove:cr,mouseup:cn},Zr="mousedown",Jr="mousemove mouseup";function Mr(){this.evEl=Zr,this.evWin=Jr,this.pressed=!1,Li.apply(this,arguments)}W(Mr,Li,{handler:function(Y){var pe=Et[Y.type];pe&mn&&Y.button===0&&(this.pressed=!0),pe&cr&&Y.which!==1&&(pe=cn),this.pressed&&(pe&cn&&(this.pressed=!1),this.callback(this.manager,pe,{pointers:[Y],changedPointers:[Y],pointerType:Zt,srcEvent:Y}))}});var hr={pointerdown:mn,pointermove:cr,pointerup:cn,pointercancel:gn,pointerout:gn},Ns={2:$t,3:Kn,4:Zt,5:Pr},li="pointerdown",un="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(li="MSPointerDown",un="MSPointerMove MSPointerUp MSPointerCancel");function co(){this.evEl=li,this.evWin=un,Li.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}W(co,Li,{handler:function(Y){var pe=this.store,Pe=!1,je=Y.type.toLowerCase().replace("ms",""),ot=hr[je],Vt=Ns[Y.pointerType]||Y.pointerType,Qn=Vt==$t,Wn=ut(pe,Y.pointerId,"pointerId");ot&mn&&(Y.button===0||Qn)?Wn<0&&(pe.push(Y),Wn=pe.length-1):ot&(cn|gn)&&(Pe=!0),!(Wn<0)&&(pe[Wn]=Y,this.callback(this.manager,ot,{pointers:pe,changedPointers:[Y],pointerType:Vt,srcEvent:Y}),Pe&&pe.splice(Wn,1))}});var Kr={touchstart:mn,touchmove:cr,touchend:cn,touchcancel:gn},ie="touchstart",N="touchstart touchmove touchend touchcancel";function G(){this.evTarget=ie,this.evWin=N,this.started=!1,Li.apply(this,arguments)}W(G,Li,{handler:function(Y){var pe=Kr[Y.type];if(pe===mn&&(this.started=!0),!!this.started){var Pe=K.call(this,Y,pe);pe&(cn|gn)&&Pe[0].length-Pe[1].length===0&&(this.started=!1),this.callback(this.manager,pe,{pointers:Pe[0],changedPointers:Pe[1],pointerType:$t,srcEvent:Y})}}});function K($,Y){var pe=Lt($.touches),Pe=Lt($.changedTouches);return Y&(cn|gn)&&(pe=Ft(pe.concat(Pe),"identifier",!0)),[pe,Pe]}var oe={touchstart:mn,touchmove:cr,touchend:cn,touchcancel:gn},he="touchstart touchmove touchend touchcancel";function _e(){this.evTarget=he,this.targetIds={},Li.apply(this,arguments)}W(_e,Li,{handler:function(Y){var pe=oe[Y.type],Pe=fe.call(this,Y,pe);Pe&&this.callback(this.manager,pe,{pointers:Pe[0],changedPointers:Pe[1],pointerType:$t,srcEvent:Y})}});function fe($,Y){var pe=Lt($.touches),Pe=this.targetIds;if(Y&(mn|cr)&&pe.length===1)return Pe[pe[0].identifier]=!0,[pe,pe];var je,ot,Vt=Lt($.changedTouches),Qn=[],Wn=this.target;if(ot=pe.filter(function(Si){return ke(Si.target,Wn)}),Y===mn)for(je=0;je<ot.length;)Pe[ot[je].identifier]=!0,je++;for(je=0;je<Vt.length;)Pe[Vt[je].identifier]&&Qn.push(Vt[je]),Y&(cn|gn)&&delete Pe[Vt[je].identifier],je++;if(Qn.length)return[Ft(ot.concat(Qn),"identifier",!0),Qn]}var de=2500,ve=25;function Re(){Li.apply(this,arguments);var $=Z(this.handler,this);this.touch=new _e(this.manager,$),this.mouse=new Mr(this.manager,$),this.primaryTouch=null,this.lastTouches=[]}W(Re,Li,{handler:function(Y,pe,Pe){var je=Pe.pointerType==$t,ot=Pe.pointerType==Zt;if(!(ot&&Pe.sourceCapabilities&&Pe.sourceCapabilities.firesTouchEvents)){if(je)De.call(this,pe,Pe);else if(ot&&vt.call(this,Pe))return;this.callback(Y,pe,Pe)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function De($,Y){$&mn?(this.primaryTouch=Y.changedPointers[0].identifier,ze.call(this,Y)):$&(cn|gn)&&ze.call(this,Y)}function ze($){var Y=$.changedPointers[0];if(Y.identifier===this.primaryTouch){var pe={x:Y.clientX,y:Y.clientY};this.lastTouches.push(pe);var Pe=this.lastTouches,je=function(){var ot=Pe.indexOf(pe);ot>-1&&Pe.splice(ot,1)};setTimeout(je,de)}}function vt($){for(var Y=$.srcEvent.clientX,pe=$.srcEvent.clientY,Pe=0;Pe<this.lastTouches.length;Pe++){var je=this.lastTouches[Pe],ot=Math.abs(Y-je.x),Vt=Math.abs(pe-je.y);if(ot<=ve&&Vt<=ve)return!0}return!1}var Ct=Rt(h.style,"touchAction"),lt=Ct!==r,pt="compute",St="auto",Ht="manipulation",qt="none",Bt="pan-x",Dt="pan-y",_i=yi();function wt($,Y){this.manager=$,this.set(Y)}wt.prototype={set:function($){$==pt&&($=this.compute()),lt&&this.manager.element.style&&_i[$]&&(this.manager.element.style[Ct]=$),this.actions=$.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var $=[];return z(this.manager.recognizers,function(Y){ae(Y.options.enable,[Y])&&($=$.concat(Y.getTouchAction()))}),jn($.join(" "))},preventDefaults:function($){var Y=$.srcEvent,pe=$.offsetDirection;if(this.manager.session.prevented){Y.preventDefault();return}var Pe=this.actions,je=Ue(Pe,qt)&&!_i[qt],ot=Ue(Pe,Dt)&&!_i[Dt],Vt=Ue(Pe,Bt)&&!_i[Bt];if(je){var Qn=$.pointers.length===1,Wn=$.distance<2,Si=$.deltaTime<250;if(Qn&&Wn&&Si)return}if(!(Vt&&ot)&&(je||ot&&pe&Ut||Vt&&pe&Gt))return this.preventSrc(Y)},preventSrc:function($){this.manager.session.prevented=!0,$.preventDefault()}};function jn($){if(Ue($,qt))return qt;var Y=Ue($,Bt),pe=Ue($,Dt);return Y&&pe?qt:Y||pe?Y?Bt:Dt:Ue($,Ht)?Ht:St}function yi(){if(!lt)return!1;var $={},Y=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(pe){$[pe]=Y?e.CSS.supports("touch-action",pe):!0}),$}var xn=1,bn=2,Uo=4,Cn=8,Hn=Cn,Go=16,nr=32;function sn($){this.options=J({},this.defaults,$||{}),this.id=ai(),this.manager=null,this.options.enable=be(this.options.enable,!0),this.state=xn,this.simultaneous={},this.requireFail=[]}sn.prototype={defaults:{},set:function($){return J(this.options,$),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function($){if(B($,"recognizeWith",this))return this;var Y=this.simultaneous;return $=wn($,this),Y[$.id]||(Y[$.id]=$,$.recognizeWith(this)),this},dropRecognizeWith:function($){return B($,"dropRecognizeWith",this)?this:($=wn($,this),delete this.simultaneous[$.id],this)},requireFailure:function($){if(B($,"requireFailure",this))return this;var Y=this.requireFail;return $=wn($,this),ut(Y,$)===-1&&(Y.push($),$.requireFailure(this)),this},dropRequireFailure:function($){if(B($,"dropRequireFailure",this))return this;$=wn($,this);var Y=ut(this.requireFail,$);return Y>-1&&this.requireFail.splice(Y,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function($){return!!this.simultaneous[$.id]},emit:function($){var Y=this,pe=this.state;function Pe(je){Y.manager.emit(je,$)}pe<Cn&&Pe(Y.options.event+ps(pe)),Pe(Y.options.event),$.additionalEvent&&Pe($.additionalEvent),pe>=Cn&&Pe(Y.options.event+ps(pe))},tryEmit:function($){if(this.canEmit())return this.emit($);this.state=nr},canEmit:function(){for(var $=0;$<this.requireFail.length;){if(!(this.requireFail[$].state&(nr|xn)))return!1;$++}return!0},recognize:function($){var Y=J({},$);if(!ae(this.options.enable,[this,Y])){this.reset(),this.state=nr;return}this.state&(Hn|Go|nr)&&(this.state=xn),this.state=this.process(Y),this.state&(bn|Uo|Cn|Go)&&this.tryEmit(Y)},process:function($){},getTouchAction:function(){},reset:function(){}};function ps($){return $&Go?"cancel":$&Cn?"end":$&Uo?"move":$&bn?"start":""}function Us($){return $==Xr?"down":$==tr?"up":$==ur?"left":$==Be?"right":""}function wn($,Y){var pe=Y.manager;return pe?pe.get($):$}function Vi(){sn.apply(this,arguments)}W(Vi,sn,{defaults:{pointers:1},attrTest:function($){var Y=this.options.pointers;return Y===0||$.pointers.length===Y},process:function($){var Y=this.state,pe=$.eventType,Pe=Y&(bn|Uo),je=this.attrTest($);return Pe&&(pe&gn||!je)?Y|Go:Pe||je?pe&cn?Y|Cn:Y&bn?Y|Uo:bn:nr}});function Yn(){Vi.apply(this,arguments),this.pX=null,this.pY=null}W(Yn,Vi,{defaults:{event:"pan",threshold:10,pointers:1,direction:ks},getTouchAction:function(){var $=this.options.direction,Y=[];return $&Ut&&Y.push(Dt),$&Gt&&Y.push(Bt),Y},directionTest:function($){var Y=this.options,pe=!0,Pe=$.distance,je=$.direction,ot=$.deltaX,Vt=$.deltaY;return je&Y.direction||(Y.direction&Ut?(je=ot===0?er:ot<0?ur:Be,pe=ot!=this.pX,Pe=Math.abs($.deltaX)):(je=Vt===0?er:Vt<0?tr:Xr,pe=Vt!=this.pY,Pe=Math.abs($.deltaY))),$.direction=je,pe&&Pe>Y.threshold&&je&Y.direction},attrTest:function($){return Vi.prototype.attrTest.call(this,$)&&(this.state&bn||!(this.state&bn)&&this.directionTest($))},emit:function($){this.pX=$.deltaX,this.pY=$.deltaY;var Y=Us($.direction);Y&&($.additionalEvent=this.options.event+Y),this._super.emit.call(this,$)}});function Vo(){Vi.apply(this,arguments)}W(Vo,Vi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[qt]},attrTest:function($){return this._super.attrTest.call(this,$)&&(Math.abs($.scale-1)>this.options.threshold||this.state&bn)},emit:function($){if($.scale!==1){var Y=$.scale<1?"in":"out";$.additionalEvent=this.options.event+Y}this._super.emit.call(this,$)}});function dr(){sn.apply(this,arguments),this._timer=null,this._input=null}W(dr,sn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[St]},process:function($){var Y=this.options,pe=$.pointers.length===Y.pointers,Pe=$.distance<Y.threshold,je=$.deltaTime>Y.time;if(this._input=$,!Pe||!pe||$.eventType&(cn|gn)&&!je)this.reset();else if($.eventType&mn)this.reset(),this._timer=I(function(){this.state=Hn,this.tryEmit()},Y.time,this);else if($.eventType&cn)return Hn;return nr},reset:function(){clearTimeout(this._timer)},emit:function($){this.state===Hn&&($&&$.eventType&cn?this.manager.emit(this.options.event+"up",$):(this._input.timeStamp=S(),this.manager.emit(this.options.event,this._input)))}});function uo(){Vi.apply(this,arguments)}W(uo,Vi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[qt]},attrTest:function($){return this._super.attrTest.call(this,$)&&(Math.abs($.rotation)>this.options.threshold||this.state&bn)}});function Kt(){Vi.apply(this,arguments)}W(Kt,Vi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ut|Gt,pointers:1},getTouchAction:function(){return Yn.prototype.getTouchAction.call(this)},attrTest:function($){var Y=this.options.direction,pe;return Y&(Ut|Gt)?pe=$.overallVelocity:Y&Ut?pe=$.overallVelocityX:Y&Gt&&(pe=$.overallVelocityY),this._super.attrTest.call(this,$)&&Y&$.offsetDirection&&$.distance>this.options.threshold&&$.maxPointers==this.options.pointers&&v(pe)>this.options.velocity&&$.eventType&cn},emit:function($){var Y=Us($.offsetDirection);Y&&this.manager.emit(this.options.event+Y,$),this.manager.emit(this.options.event,$)}});function ho(){sn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}W(ho,sn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ht]},process:function($){var Y=this.options,pe=$.pointers.length===Y.pointers,Pe=$.distance<Y.threshold,je=$.deltaTime<Y.time;if(this.reset(),$.eventType&mn&&this.count===0)return this.failTimeout();if(Pe&&je&&pe){if($.eventType!=cn)return this.failTimeout();var ot=this.pTime?$.timeStamp-this.pTime<Y.interval:!0,Vt=!this.pCenter||It(this.pCenter,$.center)<Y.posThreshold;this.pTime=$.timeStamp,this.pCenter=$.center,!Vt||!ot?this.count=1:this.count+=1,this._input=$;var Qn=this.count%Y.taps;if(Qn===0)return this.hasRequireFailures()?(this._timer=I(function(){this.state=Hn,this.tryEmit()},Y.interval,this),bn):Hn}return nr},failTimeout:function(){return this._timer=I(function(){this.state=nr},this.options.interval,this),nr},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Hn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ji($,Y){return Y=Y||{},Y.recognizers=be(Y.recognizers,ji.defaults.preset),new fo($,Y)}ji.VERSION="2.0.7",ji.defaults={domEvents:!1,touchAction:pt,enable:!0,inputTarget:null,inputClass:null,preset:[[uo,{enable:!1}],[Vo,{enable:!1},["rotate"]],[Kt,{direction:Ut}],[Yn,{direction:Ut},["swipe"]],[ho],[ho,{event:"doubletap",taps:2},["tap"]],[dr]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Gs=1,da=2;function fo($,Y){this.options=J({},ji.defaults,Y||{}),this.options.inputTarget=this.options.inputTarget||$,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=$,this.input=Sn(this),this.touchAction=new wt(this,this.options.touchAction),iu(this,!0),z(this.options.recognizers,function(pe){var Pe=this.add(new pe[0](pe[1]));pe[2]&&Pe.recognizeWith(pe[2]),pe[3]&&Pe.requireFailure(pe[3])},this)}fo.prototype={set:function($){return J(this.options,$),$.touchAction&&this.touchAction.update(),$.inputTarget&&(this.input.destroy(),this.input.target=$.inputTarget,this.input.init()),this},stop:function($){this.session.stopped=$?da:Gs},recognize:function($){var Y=this.session;if(!Y.stopped){this.touchAction.preventDefaults($);var pe,Pe=this.recognizers,je=Y.curRecognizer;(!je||je&&je.state&Hn)&&(je=Y.curRecognizer=null);for(var ot=0;ot<Pe.length;)pe=Pe[ot],Y.stopped!==da&&(!je||pe==je||pe.canRecognizeWith(je))?pe.recognize($):pe.reset(),!je&&pe.state&(bn|Uo|Cn)&&(je=Y.curRecognizer=pe),ot++}},get:function($){if($ instanceof sn)return $;for(var Y=this.recognizers,pe=0;pe<Y.length;pe++)if(Y[pe].options.event==$)return Y[pe];return null},add:function($){if(B($,"add",this))return this;var Y=this.get($.options.event);return Y&&this.remove(Y),this.recognizers.push($),$.manager=this,this.touchAction.update(),$},remove:function($){if(B($,"remove",this))return this;if($=this.get($),$){var Y=this.recognizers,pe=ut(Y,$);pe!==-1&&(Y.splice(pe,1),this.touchAction.update())}return this},on:function($,Y){if($!==r&&Y!==r){var pe=this.handlers;return z(Me($),function(Pe){pe[Pe]=pe[Pe]||[],pe[Pe].push(Y)}),this}},off:function($,Y){if($!==r){var pe=this.handlers;return z(Me($),function(Pe){Y?pe[Pe]&&pe[Pe].splice(ut(pe[Pe],Y),1):delete pe[Pe]}),this}},emit:function($,Y){this.options.domEvents&&ru($,Y);var pe=this.handlers[$]&&this.handlers[$].slice();if(!(!pe||!pe.length)){Y.type=$,Y.preventDefault=function(){Y.srcEvent.preventDefault()};for(var Pe=0;Pe<pe.length;)pe[Pe](Y),Pe++}},destroy:function(){this.element&&iu(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function iu($,Y){var pe=$.element;if(pe.style){var Pe;z($.options.cssProps,function(je,ot){Pe=Rt(pe.style,ot),Y?($.oldCssProps[Pe]=pe.style[Pe],pe.style[Pe]=je):pe.style[Pe]=$.oldCssProps[Pe]||""}),Y||($.oldCssProps={})}}function ru($,Y){var pe=n.createEvent("Event");pe.initEvent($,!0,!0),pe.gesture=Y,Y.target.dispatchEvent(pe)}J(ji,{INPUT_START:mn,INPUT_MOVE:cr,INPUT_END:cn,INPUT_CANCEL:gn,STATE_POSSIBLE:xn,STATE_BEGAN:bn,STATE_CHANGED:Uo,STATE_ENDED:Cn,STATE_RECOGNIZED:Hn,STATE_CANCELLED:Go,STATE_FAILED:nr,DIRECTION_NONE:er,DIRECTION_LEFT:ur,DIRECTION_RIGHT:Be,DIRECTION_UP:tr,DIRECTION_DOWN:Xr,DIRECTION_HORIZONTAL:Ut,DIRECTION_VERTICAL:Gt,DIRECTION_ALL:ks,Manager:fo,Input:Li,TouchAction:wt,TouchInput:_e,MouseInput:Mr,PointerEventInput:co,TouchMouseInput:Re,SingleTouchInput:G,Recognizer:sn,AttrRecognizer:Vi,Tap:ho,Pan:Yn,Swipe:Kt,Pinch:Vo,Rotate:uo,Press:dr,on:Ee,off:Le,each:z,merge:j,extend:ue,assign:J,inherit:W,bindFn:Z,prefixed:Rt});var Ya=typeof e<"u"?e:typeof self<"u"?self:{};Ya.Hammer=ji,typeof r=="function"&&r.amd?r(function(){return ji}):t.exports?t.exports=ji:e[i]=ji})(window,document,"Hammer")})(kB);var Ep=kB.exports;const D9=dx(Ep),Yo=$D({__proto__:null,default:D9},[Ep]),zB=1,NB=2,q1=4,O9={mousedown:zB,mousemove:NB,mouseup:q1};function F9(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function k9(t){const e=t.prototype.handler;t.prototype.handler=function(i){const r=this.store;i.button>0&&i.type==="pointerdown"&&(F9(r,a=>a.pointerId===i.pointerId)||r.push(i)),e.call(this,i)}}function z9(t){t.prototype.handler=function(n){let i=O9[n.type];i&zB&&n.button>=0&&(this.pressed=!0),i&NB&&n.which===0&&(i=q1),this.pressed&&(i&q1&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}k9(Ep.PointerEventInput);z9(Ep.MouseInput);const N9=Ep.Manager;class G_{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const U9=Yo?[[Yo.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Yo.Rotate,{enable:!1}],[Yo.Pinch,{enable:!1}],[Yo.Swipe,{enable:!1}],[Yo.Pan,{threshold:0,enable:!1}],[Yo.Press,{enable:!1}],[Yo.Tap,{event:"doubletap",taps:2,enable:!1}],[Yo.Tap,{event:"anytap",enable:!1}],[Yo.Tap,{enable:!1}]]:null,JS={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},G9={doubletap:["tap"]},V9={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Xb={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},j9={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},KS={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},H9=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",mh=typeof window<"u"?window:global;let X1=!1;try{const t={get passive(){return X1=!0,!0}};mh.addEventListener("test",null,t),mh.removeEventListener("test",null)}catch{X1=!1}const W9=H9.indexOf("firefox")!==-1,{WHEEL_EVENTS:q9}=Xb,YS="wheel",QS=4.000244140625,X9=40,$9=.25;class Z9 extends G_{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{if(!this.options.enable)return;let a=r.deltaY;mh.WheelEvent&&(W9&&r.deltaMode===mh.WheelEvent.DOM_DELTA_PIXEL&&(a/=mh.devicePixelRatio),r.deltaMode===mh.WheelEvent.DOM_DELTA_LINE&&(a*=X9)),a!==0&&a%QS===0&&(a=Math.floor(a/QS)),r.shiftKey&&a&&(a=a*$9),this.callback({type:YS,center:{x:r.clientX,y:r.clientY},delta:-a,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(q9),this.events.forEach(r=>e.addEventListener(r,this.handleEvent,X1?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===YS&&(this.options.enable=n)}}const{MOUSE_EVENTS:J9}=Xb,eC="pointermove",tC="pointerover",nC="pointerout",iC="pointerenter",rC="pointerleave";class K9 extends G_{constructor(e,n,i){super(e,n,i),this.handleEvent=a=>{this.handleOverEvent(a),this.handleOutEvent(a),this.handleEnterEvent(a),this.handleLeaveEvent(a),this.handleMoveEvent(a)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(J9),this.events.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===eC&&(this.enableMoveEvent=n),e===tC&&(this.enableOverEvent=n),e===nC&&(this.enableOutEvent=n),e===iC&&(this.enableEnterEvent=n),e===rC&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(tC,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(nC,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(iC,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(rC,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(eC,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:Y9}=Xb,sC="keydown",oC="keyup";class Q9 extends G_{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{const a=r.target||r.srcElement;a.tagName==="INPUT"&&a.type==="text"||a.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:sC,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:oC,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(Y9),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===sC&&(this.enableDownEvent=n),e===oC&&(this.enableUpEvent=n)}}const aC="contextmenu";class ej extends G_{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{this.options.enable&&this.callback({type:aC,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===aC&&(this.options.enable=n)}}const $1=1,h_=2,Z1=4,tj={pointerdown:$1,pointermove:h_,pointerup:Z1,mousedown:$1,mousemove:h_,mouseup:Z1},nj=1,ij=2,rj=3,sj=0,oj=1,aj=2,lj=1,cj=2,uj=4;function hj(t){const e=tj[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:r}=t.srcEvent;let a=!1,h=!1,l=!1;return e===Z1||e===h_&&!Number.isFinite(n)?(a=r===nj,h=r===ij,l=r===rj):e===h_?(a=!!(n&lj),h=!!(n&uj),l=!!(n&cj)):e===$1&&(a=i===sj,h=i===oj,l=i===aj),{leftButton:a,middleButton:h,rightButton:l}}function dj(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,a=i.height/e.offsetHeight||1,h={x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/a};return{center:n,offsetCenter:h}}const rv={srcElement:"root",priority:0};class fj{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let r=n.srcEvent.target;for(;r&&r!==i.rootElement;){if(this._emit(i,r),i.handled)return;r=r.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,r=!1,a=!1){const{handlers:h,handlersByElement:l}=this;let _=rv;typeof i=="string"||i&&i.addEventListener?_={...rv,srcElement:i}:i&&(_={...rv,...i});let v=l.get(_.srcElement);v||(v=[],l.set(_.srcElement,v));const S={type:e,handler:n,srcElement:_.srcElement,priority:_.priority};r&&(S.once=!0),a&&(S.passive=!0),h.push(S),this._active=this._active||!S.passive;let I=v.length-1;for(;I>=0&&!(v[I].priority>=S.priority);)I--;v.splice(I+1,0,S)}remove(e,n){const{handlers:i,handlersByElement:r}=this;for(let a=i.length-1;a>=0;a--){const h=i[a];if(h.type===e&&h.handler===n){i.splice(a,1);const l=r.get(h.srcElement);l.splice(l.indexOf(h),1),l.length===0&&r.delete(h.srcElement)}}this._active=i.some(a=>!a.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let r=!1;const a=()=>{e.handled=!0},h=()=>{e.handled=!0,r=!0},l=[];for(let _=0;_<i.length;_++){const{type:v,handler:S,once:I}=i[_];if(S({...e,type:v,stopPropagation:a,stopImmediatePropagation:h}),I&&l.push(i[_]),r)break}for(let _=0;_<l.length;_++){const{type:v,handler:S}=l[_];this.remove(v,S)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...hj(e),...dj(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const pj={events:null,recognizers:null,recognizerOptions:{},Manager:N9,touchAction:"none",tabIndex:0};class mj{constructor(e=null,n){this._onBasicInput=r=>{const{srcEvent:a}=r,h=V9[a.type];h&&this.manager.emit(h,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...pj,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||U9}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(JS).forEach(r=>{const a=this.manager.get(r);a&&JS[r].forEach(h=>{a.recognizeWith(h)})});for(const r in n.recognizerOptions){const a=this.manager.get(r);if(a){const h=n.recognizerOptions[r];delete h.enable,a.set(h)}}this.wheelInput=new Z9(e,this._onOtherEvent,{enable:!1}),this.moveInput=new K9(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Q9(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new ej(e,this._onOtherEvent,{enable:!1});for(const[r,a]of this.events)a.isEmpty()||(this._toggleRecognizer(a.recognizerName,!0),this.manager.on(r,a.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const r=i.get(e);if(r&&r.options.enable!==n){r.set({enable:n});const a=G9[e];a&&!this.options.recognizers&&a.forEach(h=>{const l=i.get(h);n?(l.requireFailure(e),r.dropRequireFailure(h)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,r,a){if(typeof e!="string"){i=n;for(const S in e)this._addEventHandler(S,e[S],i,r,a);return}const{manager:h,events:l}=this,_=KS[e]||e;let v=l.get(_);v||(v=new fj(this),l.set(_,v),v.recognizerName=j9[_]||_,h&&h.on(_,v.handleEvent)),v.add(e,n,i,r,a),v.isEmpty()||this._toggleRecognizer(v.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const h in e)this._removeEventHandler(h,e[h]);return}const{events:i}=this,r=KS[e]||e,a=i.get(r);if(a&&(a.remove(e,n),a.isEmpty())){const{recognizerName:h}=a;let l=!1;for(const _ of i.values())if(_.recognizerName===h&&!_.isEmpty()){l=!0;break}l||this._toggleRecognizer(h,!1)}}}function Ic(){}const gj=({isDragging:t})=>t?"grabbing":"grab",UB={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Ic,onResize:Ic,onViewStateChange:Ic,onInteractionStateChange:Ic,onBeforeRender:Ic,onAfterRender:Ic,onLoad:Ic,onError:t=>ln.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:gj,getTooltip:null,debug:!1,drawPickingColors:!1};class V_{constructor(e){R(this,"props",void 0),R(this,"width",0),R(this,"height",0),R(this,"userData",{}),R(this,"canvas",null),R(this,"viewManager",null),R(this,"layerManager",null),R(this,"effectManager",null),R(this,"deckRenderer",null),R(this,"deckPicker",null),R(this,"eventManager",null),R(this,"tooltip",null),R(this,"metrics",void 0),R(this,"animationLoop",void 0),R(this,"stats",void 0),R(this,"viewState",void 0),R(this,"cursorState",void 0),R(this,"_needsRedraw",void 0),R(this,"_pickRequest",void 0),R(this,"_lastPointerDownInfo",null),R(this,"_metricsCounter",void 0),R(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const r=n.offsetCenter;if(!r)return;i.x=r.x,i.y=r.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),R(this,"_onEvent",n=>{const i=UT[n.type],r=n.offsetCenter;if(!i||!r||!this.layerManager)return;const a=this.layerManager.getLayers(),h=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:a,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:l}=h,_=l&&(l[i.handler]||l.props[i.handler]),v=this.props[i.handler];let S=!1;_&&(S=_.call(l,h,n)),!S&&v&&v(h,n)}),R(this,"_onPointerDown",n=>{const i=n.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo}),this.props={...UB,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&ln.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),wM()==="IE"&&ln.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Ab({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&jh.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,r,a,h,l,_;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(r=this.effectManager)===null||r===void 0||r.finalize(),this.effectManager=null,(a=this.deckRenderer)===null||a===void 0||a.finalize(),this.deckRenderer=null,(h=this.deckPicker)===null||h===void 0||h.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(_=this.tooltip)===null||_===void 0||_.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var v;(v=this.canvas.parentElement)===null||v===void 0||v.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ln.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ln.removed("onLayerClick","onClick")(),e.initialViewState&&!oa(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),a=this.effectManager.needsRedraw(e),h=this.deckRenderer.needsRedraw(e);return n=n||i||r||a||h,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Ki(this.viewManager),this.viewManager.views}getViewports(e){return Ki(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,i){Ki(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const a=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(n).timeEnd(),a}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Ki(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const a=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=a}if(i||i===0){var r;const a=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((r=e.style)===null||r===void 0?void 0:r.position)||"absolute",this.canvas.style.height=a}}_updateCanvasSize(){var e,n;const{canvas:i}=this;if(!i)return;const r=(e=i.clientWidth)!==null&&e!==void 0?e:i.width,a=(n=i.clientHeight)!==null&&n!==void 0?n:i.height;if(r!==this.width||a!==this.height){var h,l;this.width=r,this.height=a,(h=this.viewManager)===null||h===void 0||h.setProps({width:r,height:a}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:a})}}_createAnimationLoop(e){const{width:n,height:i,gl:r,glOptions:a,debug:h,onError:l,onBeforeRender:_,onAfterRender:v,useDevicePixels:S}=e;return new k6({width:n,height:i,useDevicePixels:S,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,gl:r,onCreateContext:I=>PM({...a,...I,canvas:this.canvas,debug:h,onContextLost:()=>this._onContextLost()}),onInitialize:I=>this._setGLContext(I.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:_,onAfterRender:v,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new DB({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let a=r,h=!1;for(const l of i){var n;a=l,h=((n=l.layer)===null||n===void 0?void 0:n.onHover(l,e.event))||h}if(!h&&this.props.onHover&&this.props.onHover(a,e.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(a);this.tooltip.setTooltip(l,a.x,a.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,wb(e,{enable:!0,copyState:!0})),this.tooltip=new R9(this.canvas),qa(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new yB;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new mj(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in UT)this.eventManager.on(r,this._onEvent);this.viewManager=new o9({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new s9(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new w9,this.deckRenderer=new T9(e),this.deckPicker=new B9(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;qa(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ln.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=Fc.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}R(V_,"defaultProps",UB);R(V_,"VERSION",jN);class sv{constructor(e,n){R(this,"opts",void 0),R(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:r}=n;let a=i;if(i&&i.length!==r){a=new Float32Array(r);const h=n.elementOffset||0;for(let l=0;l<r;++l)a[l]=i[h+l]}return a}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function _j(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function wg(t){return t.stride||t.size*t.bytesPerElement}function GB(t,e){e.offset&&ln.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=wg(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,a=i*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:a,stride:n}}function yj(t,e){const n=GB(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class vj{constructor(e,n,i){R(this,"gl",void 0),R(this,"id",void 0),R(this,"size",void 0),R(this,"settings",void 0),R(this,"value",void 0),R(this,"doublePrecision",void 0),R(this,"_buffer",void 0),R(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,a=r===5130;let{defaultValue:h}=n;h=Number.isFinite(h)?[h]:h||new Array(this.size).fill(0);let l;a?l=5126:!r&&n.isIndexed?l=e&&Sb(e,Fn.ELEMENT_INDEX_UINT32)?5125:5123:l=r||5126;let _=_j(r||l||5126);this.doublePrecision=a,a&&n.fp64===!1&&(_=Float32Array),this.value=null,this.settings={...n,defaultType:_,defaultValue:h,logicalType:r,type:l,size:this.size,bytesPerElement:_.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new _n(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*wg(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),jh.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},r=this.value instanceof Float64Array,a=yj(this.getAccessor(),n||{});return i[e]=new sv(this,a.high),i["".concat(e,"64Low")]=r?new sv(this,a.low):new Float32Array(this.size),i}if(n){const i=GB(this.getAccessor(),n);return{[e]:new sv(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:r}=this,a=i*r;if(n&&a&&n.length>=a){const h=new Array(r).fill(1/0),l=new Array(r).fill(-1/0);for(let _=0;_<a;)for(let v=0;v<r;v++){const S=n[_++];S<h[v]&&(h[v]=S),S>l[v]&&(l[v]=S)}e=[h,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof _n?i={buffer:e}:i=e;const r={...this.settings,...i};if(n.bufferAccessor=r,n.bounds=null,i.constant){let a=i.value;if(a=this._normalizeValue(a,[],0),this.settings.normalized&&(a=this.normalizeConstant(a)),!(!n.constant||!this._areValuesEqual(a,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=a}else if(i.buffer){const a=i.buffer;n.externalBuffer=a,n.constant=!1,this.value=i.value||null;const h=i.value instanceof Float64Array;r.type=i.type||a.accessor.type,r.bytesPerElement=a.accessor.BYTES_PER_ELEMENT*(h?2:1),r.stride=wg(r)}else if(i.value){this._checkExternalBuffer(i);let a=i.value;n.externalBuffer=null,n.constant=!1,this.value=a,r.bytesPerElement=a.BYTES_PER_ELEMENT,r.stride=wg(r);const{buffer:h,byteOffset:l}=this;this.doublePrecision&&a instanceof Float64Array&&(a=tv(a,r));const _=a.byteLength+l+r.stride*2;h.byteLength<_&&h.reallocate(_),h.setAccessor(null),h.subData({data:a,offset:l}),r.type=i.type||h.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?tv(n,{size:this.size,startIndex:i,endIndex:r}):n.subarray(i,r),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,r=i.allocatedValue,a=jh.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=a;const{buffer:h,byteOffset:l}=this;return h.byteLength<a.byteLength+l&&(h.reallocate(a.byteLength+l),n&&r&&h.subData({data:r instanceof Float64Array?tv(r,this):r,offset:l})),i.allocatedValue=a,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&ln.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:r,size:a}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let h=a;for(;--h>=0;)n[i+h]=r[h];return n}switch(a){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let h=a;for(;--h>=0;)n[i+h]=Number.isFinite(e[h])?e[h]:r[h]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==n[r])return!1;return!0}}const lC=[],cC=[];function $b(t,e=0,n=1/0){let i=lC;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(cC.length=t.length,i=cC):i=lC,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function VB(t){return t&&t[Symbol.asyncIterator]}function jB(t,e){const{size:n,stride:i,offset:r,startIndices:a,nested:h}=e,l=t.BYTES_PER_ELEMENT,_=i?i/l:n,v=r?r/l:0,S=Math.floor((t.length-v)/_);return(I,{index:B,target:z})=>{if(!a){const j=B*_+v;for(let W=0;W<n;W++)z[W]=t[j+W];return z}const V=a[B],J=a[B+1]||S;let ue;if(h){ue=new Array(J-V);for(let j=V;j<J;j++){const W=j*_+v;z=new Array(n);for(let Z=0;Z<n;Z++)z[Z]=t[W+Z];ue[j-V]=z}}else if(_===n)ue=t.subarray(V*n+v,J*n+v);else{ue=new t.constructor((J-V)*n);let j=0;for(let W=V;W<J;W++){const Z=W*_+v;for(let ae=0;ae<n;ae++)ue[j++]=t[Z+ae]}}return ue}}const xj=[],Ag=[[0,1/0]];function bj(t,e){if(t===Ag||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let r=0;for(let a=0;a<i;a++){const h=t[a];h[1]<e[0]?(n.push(h),r=a+1):h[0]>e[1]?n.push(h):e=[Math.min(h[0],e[0]),Math.max(h[1],e[1])]}return n.splice(r,0,e),n}function ov(t){const{source:e,target:n,start:i=0,size:r,getData:a}=t,h=t.end||n.length,l=e.length,_=h-i;if(l>_){n.set(e.subarray(0,_),i);return}if(n.set(e,i),!a)return;let v=l;for(;v<_;){const S=a(v,e);for(let I=0;I<r;I++)n[i+v]=S[I]||0,v++}}function wj({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:a}){if(!Array.isArray(a))return ov({source:t,target:e,size:n,getData:i}),e;let h=0,l=0;const _=i&&((S,I)=>i(S+l,I)),v=Math.min(r.length,a.length);for(let S=1;S<v;S++){const I=r[S]*n,B=a[S]*n;ov({source:t.subarray(h,I),target:e,start:l,end:B,size:n,getData:_}),h=I,l=B}return l<e.length&&ov({source:[],target:e,start:l,size:n,getData:_}),e}const Aj={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function HB(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...Aj[n],...e,...t,type:n}}function WB(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function qB(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function XB(t){t.push(t.shift())}function Zb(t,e){const{doublePrecision:n,settings:i,value:r,size:a}=t,h=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*a)*h}function $B({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:r,getData:a=h=>h}){const h=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*h,_=n.byteOffset,v=n.startIndices,S=r&&v,I=Zb(n,e),B=n.isConstant;if(!S&&i>=I)return;const z=B?n.value:n.getBuffer().getData({srcByteOffset:_});if(n.settings.normalized&&!B){const j=a;a=(W,Z)=>n.normalizeConstant(j(W,Z))}const V=B?(j,W)=>a(z,W):(j,W)=>a(z.subarray(j,j+l),W),J=t.getData({length:i}),ue=new Float32Array(I);wj({source:J,target:ue,sourceStartIndices:r,targetStartIndices:v,size:l,getData:V}),t.byteLength<ue.byteLength+_&&t.reallocate(ue.byteLength+_),t.subData({data:ue,offset:_})}class Jb extends vj{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Ag}),R(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,r=Array.isArray(n)?e[n.find(a=>e[a])]:e[n];return HB(r,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:r=1/0}=n;this.state.updateRanges=bj(this.state.updateRanges,[i,r])}else this.state.updateRanges=Ag}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=xj}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==Ag),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:h,noAlloc:l}}=this;let _=!0;if(h){for(const[v,S]of a)h.call(r,this,{data:n,startRow:v,endRow:S,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[v,S]of a){const I=Number.isFinite(v)?this.getVertexOffset(v):0,B=Number.isFinite(S)?this.getVertexOffset(S):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:I,endOffset:B})}this._checkAttributeArray()}else _=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),_}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const h=e;Ki(ArrayBuffer.isView(h.value),"invalid ".concat(r.accessor));const l=!!h.size&&h.size!==this.size;return i.binaryAccessor=jB(h.value,{size:h.size||this.size,stride:h.stride,offset:h.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:r,props:a,numInstances:h}){if(e.constant)return;const{settings:l,state:_,value:v,size:S,startIndices:I}=e,{accessor:B,transform:z}=l,V=_.binaryAccessor||(typeof B=="function"?B:a[B]);Ki(typeof V=="function",'accessor "'.concat(B,'" is not a function'));let J=e.getVertexOffset(i);const{iterable:ue,objectInfo:j}=$b(n,i,r);for(const W of ue){j.index++;let Z=V(W,j);if(z&&(Z=z.call(this,Z)),I){const ae=(j.index<I.length-1?I[j.index+1]:h)-I[j.index];if(Z&&Array.isArray(Z[0])){let be=J;for(const Ee of Z)e._normalizeValue(Ee,v,be),be+=S}else Z&&Z.length>S?v.set(Z,J):(e._normalizeValue(Z,j.target,0),J8({target:v,source:j.target,start:J,count:ae}));J+=ae*S}else e._normalizeValue(Z,v,J),J+=S}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class Ej{constructor({gl:e,attribute:n,timeline:i}){R(this,"gl",void 0),R(this,"type","interpolation"),R(this,"attributeInTransition",void 0),R(this,"settings",void 0),R(this,"attribute",void 0),R(this,"transition",void 0),R(this,"currentStartIndices",void 0),R(this,"currentLength",void 0),R(this,"transform",void 0),R(this,"buffers",void 0),this.gl=e,this.transition=new Ap(i),this.attribute=n,this.attributeInTransition=new Jb(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=Sj(e,n);const r={byteLength:0,usage:35050};this.buffers=[new _n(e,r),new _n(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:r,attribute:a}=this;XB(r);const h={numInstances:n,attribute:a,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of r)$B({buffer:l,...h});this.currentStartIndices=a.startIndices,this.currentLength=Zb(a,n),this.attributeInTransition.setData({buffer:r[1],value:a.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/a.size),sourceBuffers:{aFrom:r[0],aTo:WB(i,a)},feedbackBuffers:{vCurrent:r[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:r}=this.transition;let a=r/n;i&&(a=i(a)),this.transform.run({uniforms:{time:a}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const Tj=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function Sj(t,e){const n=qB(e.size);return new Ub(t,{vs:Tj,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class Cj{constructor({gl:e,attribute:n,timeline:i}){R(this,"gl",void 0),R(this,"type","spring"),R(this,"attributeInTransition",void 0),R(this,"settings",void 0),R(this,"attribute",void 0),R(this,"transition",void 0),R(this,"currentStartIndices",void 0),R(this,"currentLength",void 0),R(this,"texture",void 0),R(this,"framebuffer",void 0),R(this,"transform",void 0),R(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Ap(i),this.attribute=n,this.attributeInTransition=new Jb(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=Pj(e),this.framebuffer=Mj(e,this.texture),this.transform=Ij(e,n,this.framebuffer);const r={byteLength:0,usage:35050};this.buffers=[new _n(e,r),new _n(e,r),new _n(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:r,attribute:a}=this,h={numInstances:n,attribute:a,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of r)$B({buffer:l,...h});this.settings=e,this.currentStartIndices=a.startIndices,this.currentLength=Zb(a,n),this.attributeInTransition.setData({buffer:r[1],value:a.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/a.size),sourceBuffers:{aTo:WB(i,a)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:r}=this;if(!r.update())return!1;const h=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:h.stiffness,damping:h.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),XB(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),z_(i)[0]>0||r.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function Ij(t,e,n){const i=qB(e.size);return new Ub(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function Pj(t){return new Ds(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function Mj(t,e){return new Gi(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const Bj={interpolation:Ej,spring:Cj};class Lj{constructor(e,{id:n,timeline:i}){R(this,"id",void 0),R(this,"isSupported",void 0),R(this,"gl",void 0),R(this,"timeline",void 0),R(this,"transitions",void 0),R(this,"needsRedraw",void 0),R(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Ub.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const r in e){const a=e[r],h=a.getTransitionSetting(n);h&&this._updateAttribute(r,a,h)}for(const r in this.transitions){const a=e[r];(!a||!a.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const r=this.transitions[e];let a=!r||r.type!==i.type;if(a){if(!this.isSupported){ln.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}r&&this._removeTransition(e);const h=Bj[i.type];h?this.transitions[e]=new h({attribute:n,timeline:this.timeline,gl:this.gl}):(ln.error("unsupported transition type '".concat(i.type,"'"))(),a=!1)}(a||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const uC="attributeManager.invalidate",Rj="attributeManager.updateStart",Dj="attributeManager.updateEnd",Oj="attribute.updateStart",Fj="attribute.allocate",kj="attribute.updateEnd";class zj{constructor(e,{id:n="attribute-manager",stats:i,timeline:r}={}){R(this,"id",void 0),R(this,"gl",void 0),R(this,"attributes",void 0),R(this,"updateTriggers",void 0),R(this,"needsRedraw",void 0),R(this,"userData",void 0),R(this,"stats",void 0),R(this,"attributeTransitionManager",void 0),R(this,"mergeBoundsMemoized",wp(F8)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new Lj(e,{id:"".concat(n,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);Er(uC,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Er(uC,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:r,props:a={},buffers:h={},context:l={}}){let _=!1;Er(Rj,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const v in this.attributes){const S=this.attributes[v],I=S.settings.accessor;S.startIndices=i,S.numInstances=n,a[v]&&ln.removed("props.".concat(v),"data.attributes.".concat(v))(),S.setExternalBuffer(h[v])||S.setBinaryValue(typeof I=="string"?h[I]:void 0,e.startIndices)||typeof I=="string"&&!h[I]&&S.setConstantValue(a[I])||S.needsUpdate()&&(_=!0,this._updateAttribute({attribute:S,numInstances:n,data:e,props:a,context:l})),this.needsRedraw=this.needsRedraw||S.needsRedraw()}_&&Er(Dj,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(i=>{var r;return(r=this.attributes[i])===null||r===void 0?void 0:r.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const a in n){const h=n[a];h.needsRedraw(e)&&!i.hasAttribute(a)&&(r[a]=h)}return r}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const r in e)n[r]||Object.assign(i,e[r].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const r=e[i];this.attributes[i]=this._createAttribute(i,r,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const r={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new Jb(this.gl,r)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:r}=this,a=r[e];return a&&a.forEach(h=>{const l=i[h];l&&l.setNeedsUpdate(l.id,n)}),a}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(Er(Oj,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Er(Fj,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,Er(kj,n,i))}}class Nj extends Ap{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:r,easing:a}}=this,h=a(e/r);this._value=r_(n,i,h)}}const hC=1e-5;function dC(t,e,n,i,r){const a=e-t,l=(n-e)*r,_=-a*i;return l+_+a+e}function Uj(t,e,n,i,r){if(Array.isArray(n)){const a=[];for(let h=0;h<n.length;h++)a[h]=dC(t[h],e[h],n[h],i,r);return a}return dC(t,e,n,i,r)}function fC(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class Gj extends Ap{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:r}=this.settings,{_prevValue:a=e,_currValue:h=e}=this;let l=Uj(a,h,n,i,r);const _=fC(l,n),v=fC(l,h);_<hC&&v<hC&&(l=n,this.end()),this._prevValue=h,this._currValue=l}}const Vj={interpolation:Nj,spring:Gj};class jj{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,r){const{transitions:a}=this;if(a.has(e)){const _=a.get(e),{value:v=_.settings.fromValue}=_;n=v,this.remove(e)}if(r=HB(r),!r)return;const h=Vj[r.type];if(!h){ln.error("unsupported transition type '".concat(r.type,"'"))();return}const l=new h(this.timeline);l.start({...r,fromValue:n,toValue:i}),a.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Hj(t){const e=t[Gl];for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function Wj(t,e){const n=ZB({newProps:t,oldProps:e,propTypes:t[Gl],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=Xj(t,e);let r=!1;return i||(r=$j(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:Zj(t,e),transitionsChanged:qj(t,e)}}function qj(t,e){if(!t.transitions)return!1;const n={},i=t[Gl];let r=!1;for(const a in t.transitions){const h=i[a],l=h&&h.type;(l==="number"||l==="color"||l==="array")&&J1(t[a],e[a],h)&&(n[a]=!0,r=!0)}return r?n:!1}function ZB({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(r," changed shallowly");for(const a of Object.keys(t))if(!(a in n)){if(!(a in e))return"".concat(r,".").concat(a," added");const h=J1(t[a],e[a],i[a]);if(h)return"".concat(r,".").concat(a," ").concat(h)}for(const a of Object.keys(e))if(!(a in n)){if(!(a in t))return"".concat(r,".").concat(a," dropped");if(!Object.hasOwnProperty.call(t,a)){const h=J1(t[a],e[a],i[a]);if(h)return"".concat(r,".").concat(a," ").concat(h)}}return!1}function J1(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function Xj(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function $j(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&pC(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)r!=="all"&&pC(t,e,r)&&(n[r]=!0,i=!0);return i?n:!1}function Zj(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function pC(t,e,n){let i=t.updateTriggers[n];i=i??{};let r=e.updateTriggers[n];return r=r??{},ZB({oldProps:r,newProps:i,triggerName:n})}const Jj="count(): argument not an object",Kj="count(): argument not a container";function Yj(t){if(!eH(t))throw new Error(Jj);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(Qj(t))return Object.keys(t).length;throw new Error(Kj)}function Qj(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function eH(t){return t!==null&&typeof t=="object"}function tH(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(r=>r.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];n.inject=i}return n}const nH={10241:9987,10240:9729,10242:33071,10243:33071},K1={};function iH(t,e,n,i){if(n instanceof Ds)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let r=null;n.compressed&&(r={10241:n.data.length>1?9985:9729});const a=new Ds(e,{...n,parameters:{...nH,...r,...i}});return K1[a.id]=t,a}function rH(t,e){!e||!(e instanceof Ds)||K1[e.id]===t&&(e.delete(),delete K1[e.id])}const sH={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Y1(t)&&(t.length===3||t.length===4)},equal(t,e,n){return oa(t,e,1)}},accessor:{validate(t,e){const n=d_(t);return n==="function"||n===d_(e.value)},equal(t,e,n){return typeof e=="function"?!0:oa(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Y1(t)},equal(t,e,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?oa(t,e,r):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?oa(t,e,r):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.gl?null:iH(n.id,i.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{rH(n.id,t)}}};function oH(t){const e={},n={},i={};for(const[r,a]of Object.entries(t)){const h=a==null?void 0:a.deprecatedFor;if(h)i[r]=Array.isArray(h)?h:[h];else{const l=aH(r,a);e[r]=l,n[r]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function aH(t,e){switch(d_(e)){case"object":return lf(t,e);case"array":return lf(t,{type:"array",value:e,compare:!1});case"boolean":return lf(t,{type:"boolean",value:e});case"number":return lf(t,{type:"number",value:e});case"function":return lf(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function lf(t,e){return"type"in e?{name:t,...sH[e.type],...e}:"value"in e?{name:t,type:d_(e.value),...e}:{name:t,type:"object",value:e}}function Y1(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function d_(t){return Y1(t)?"array":t===null?"null":typeof t}function lH(t,e){let n;for(let a=e.length-1;a>=0;a--){const h=e[a];"extensions"in h&&(n=h.extensions)}const i=Q1(t.constructor,n),r=Object.create(i);r[u_]=t,r[$c]={},r[Bl]={};for(let a=0;a<e.length;++a){const h=e[a];for(const l in h)r[l]=h[l]}return Object.freeze(r),r}const cH="_mergedDefaultProps";function Q1(t,e){let n=cH;if(e)for(const r of e){const a=r.constructor;a&&(n+=":".concat(a.extensionName||a.name))}const i=JB(t,n);return i||(t[n]=uH(t,e||[]))}function uH(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),r=Q1(i),a=JB(t,"defaultProps")||{},h=oH(a),l=Object.assign(Object.create(null),r,h.defaultProps),_=Object.assign(Object.create(null),r==null?void 0:r[Gl],h.propTypes),v=Object.assign(Object.create(null),r==null?void 0:r[iv],h.deprecatedProps);for(const S of e){const I=Q1(S.constructor);I&&(Object.assign(l,I),Object.assign(_,I[Gl]),Object.assign(v,I[iv]))}return hH(l,t),fH(l,_),dH(l,v),l[Gl]=_,l[iv]=v,e.length===0&&!Kb(t,"_propTypes")&&(t._propTypes=_),l}function hH(t,e){const n=mH(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function dH(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const r="".concat(this.id,": ").concat(n);for(const a of e[n])Kb(this,a)||(this[a]=i);ln.deprecated(r,e[n].join("/"))()}})}function fH(t,e){const n={},i={};for(const r in e){const a=e[r],{name:h,value:l}=a;a.async&&(n[h]=l,i[h]=pH(h))}t[Sh]=n,t[$c]={},Object.defineProperties(t,i)}function pH(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||VB(e)?this[$c][t]=e:this[Bl][t]=e},get(){if(this[Bl]){if(t in this[Bl])return this[Bl][t]||this[Sh][t];if(t in this[$c]){const e=this[u_]&&this[u_].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Sh][t]}}return this[Sh][t]}}}function Kb(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function JB(t,e){return Kb(t,e)&&t[e]}function mH(t){const e=t.componentName;return e||ln.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let gH=0;class Yb{constructor(...e){R(this,"id",void 0),R(this,"props",void 0),R(this,"count",void 0),this.props=lH(this,e),this.id=this.props.id,this.count=gH++}clone(e){const{props:n}=this,i={};for(const r in n[Sh])r in n[Bl]?i[r]=n[Bl][r]:r in n[$c]&&(i[r]=n[$c][r]);return new this.constructor({...n,...i,...e})}}R(Yb,"componentName","Component");R(Yb,"defaultProps",{});const _H=Object.freeze({});class yH{constructor(e){R(this,"component",void 0),R(this,"onAsyncPropUpdated",void 0),R(this,"asyncProps",void 0),R(this,"oldProps",void 0),R(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||_H}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[u_]||this.component;const n=e[Bl]||{},i=e[$c]||e,r=e[Sh]||{};for(const a in n){const h=n[a];this._createAsyncPropData(a,r[a]),this._updateAsyncProp(a,h),n[a]=this.getAsyncProp(a)}for(const a in i){const h=i[a];this._createAsyncPropData(a,r[a]),this._updateAsyncProp(a,h)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(VB(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;n.then(a=>{this.component&&(a=this._postProcessValue(i,a),this._setAsyncPropValue(e,a,r),this._onResolve(e,a))}).catch(a=>{this._onError(e,a)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let a=[],h=0;for await(const l of n){if(!this.component)return;const{dataTransform:_}=this.component.props;_?a=_(l,a):a=a.concat(l),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:h,endRow:a.length}]}),h=a.length,this._setAsyncPropValue(e,a,r)}this._onResolve(e,a)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.props[Gl];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class vH extends yH{constructor({attributeManager:e,layer:n}){super(n),R(this,"attributeManager",void 0),R(this,"needsRedraw",void 0),R(this,"needsUpdate",void 0),R(this,"subLayers",void 0),R(this,"usesPickingColorCache",void 0),R(this,"hasPickingBuffer",void 0),R(this,"changeFlags",void 0),R(this,"viewport",void 0),R(this,"uniformTransitions",void 0),R(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,r=i==null?void 0:i.props.fetch;return r?r(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const r=i.props.onDataLoad;e==="data"&&r&&r(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const xH="layer.changeFlag",bH="layer.initialize",wH="layer.update",AH="layer.finalize",EH="layer.matched",mC=2**24-1,TH=Object.freeze([]),SH=wp(({oldViewport:t,viewport:e})=>t.equals(e));let Qo=new Uint8ClampedArray(0);const CH={data:{type:"data",value:TH,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:a})=>{const{resourceManager:h}=n.context;if(r=r||n.getLoadOptions(),i=i||n.props.loaders,a){var l;r={...r,fetch:{...(l=r)===null||l===void 0?void 0:l.fetch,signal:a}}}let _=h.contains(t);return!_&&!r&&(h.add({resourceId:t,data:Hl(t,i),persistent:!1}),_=!0),_?h.subscribe({resourceId:t,onChange:v=>{var S;return(S=n.internalState)===null||S===void 0?void 0:S.reloadAsyncProp(e,v)},consumerId:n.id,requestId:e}):Hl(t,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Jt.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Zl extends Yb{constructor(...e){super(...e),R(this,"internalState",null),R(this,"lifecycle",eh.NO_STATE),R(this,"context",void 0),R(this,"state",void 0),R(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Ki(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=PB(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,a,h]=IB(i,n.pixelProjectionMatrix);return e.length===2?[r,a]:[r,a,h]}unproject(e){return Ki(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Ki(this.internalState);const i=this.internalState.viewport||this.context.viewport;return MB(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Jt.DEFAULT||e===Jt.LNGLAT||e===Jt.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Ki(e instanceof Uint8Array);const[n,i,r]=e;return n+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Yj(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=tH(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const r of i)n.invalidateAll(r);else n.invalidateAll();if(n){const{props:r}=e,a=this.internalState.hasPickingBuffer,h=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(a!==h){this.internalState.hasPickingBuffer=h;const{pickingColors:l,instancePickingColors:_}=n.attributes,v=l||_;v&&(h&&v.constant&&(v.constant=!1,n.invalidate(v.id)),!v.value&&!h&&(v.constant=!0,v.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){var i,r;if(n&&(e=new Error("".concat(n,": ").concat(e.message),{cause:e})),!((i=(r=this.props).onError)!==null&&i!==void 0&&i.call(r,e))){var a,h;(a=this.context)===null||a===void 0||(h=a.onError)===null||h===void 0||h.call(a,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!SH({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const a=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(a)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const r in n)Object.defineProperty(i,r,{value:n[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(Qo.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>mC&&ln.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Qo=jh.allocate(Qo,n,{size:3,copy:!0,maxCount:Math.max(n,mC)});const r=Math.floor(Qo.length/3),a=[];for(let h=i;h<r;h++)this.encodePickingColor(h,a),Qo[h*3+0]=a[0],Qo[h*3+1]=a[1],Qo[h*3+2]=a[2]}e.value=Qo.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),r=e.userData.excludeAttributes||{},a=i.getShaderAttributes(n,r);e.setAttributes(a)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,a=i||r,h=a&&n.attributes&&n.attributes[a.id];if(h&&h.value){const l=h.value,_=this.encodePickingColor(e);for(let v=0;v<n.length;v++){const S=a.getVertexOffset(v);l[S]===_[0]&&l[S+1]===_[1]&&l[S+2]===_[2]&&this._disablePickingIndex(v)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i;if(!r)return;const a=r.getVertexOffset(e),h=r.getVertexOffset(e+1);r.buffer.subData({data:new Uint8Array(h-a),offset:a})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Qo.buffer&&(i.value=Qo.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Ki(!this.internalState),Ki(Number.isFinite(this.props.coordinateSystem)),Er(bH,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new vH({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ln.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new jj(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Er(EH,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Er(wH,this,e),!e)return;const n=this.props,i=this.context,r=this.internalState,a=i.viewport,h=this._updateUniformTransition();r.propsInTransition=h,i.viewport=r.viewport||a,this.props=h;try{const l=this._getUpdateParams(),_=this.getModels();if(i.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const S of this.props.extensions)S.updateState.call(this,l,S);const v=this.getModels()[0]!==_[0];this._postUpdate(l,v)}finally{i.viewport=a,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){Er(AH,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,a=this.context;this.props=this.internalState.propsInTransition||r;const h=this.props.opacity;n.opacity=Math.pow(h,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:l}=this.props,_=l&&l(n)||[0,0];qa(a.gl,{polygonOffset:_}),Do(a.gl,i,()=>{const v={moduleParameters:e,uniforms:n,parameters:i,context:a};for(const S of this.props.extensions)S.draw.call(this,v,S);this.draw(v)})}finally{this.props=r}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let a=!1;switch(r){case"dataChanged":const h=e[r],l=n[r];h&&Array.isArray(l)&&(n.dataChanged=Array.isArray(h)?l.concat(h):h,a=!0);default:n[r]||(n[r]=e[r],a=!0)}a&&Er(xH,this,r,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=Wj(e,n);if(i.updateTriggersChanged)for(const a in i.updateTriggersChanged)i.updateTriggersChanged[a]&&this.invalidateAttribute(a);if(i.transitionsChanged)for(const a in i.transitionsChanged){var r;this.internalState.uniformTransitions.add(a,n[a],e[a],(r=e.transitions)===null||r===void 0?void 0:r[a])}return this.setChangeFlags(i)}validateProps(){Hj(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new zj(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:a}=this.state;a==null||a.setInstanceCount(this.getNumInstances());const{autoHighlight:h,highlightedObjectIndex:l,highlightColor:_}=i;if(n||r.autoHighlight!==h||r.highlightedObjectIndex!==l||r.highlightColor!==_){const v={};h||(v.pickingSelectedColor=null),Array.isArray(_)&&(v.pickingHighlightColor=_),(n||l!==r.highlightedObjectIndex)&&(v.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(v)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(e):!1;if(n=n||r,n)for(const a of this.props.extensions)a.onNeedsRedraw.call(this,a);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}R(Zl,"defaultProps",CH);R(Zl,"layerName","Layer");const IH="compositeLayer.renderLayers";class KB extends Zl{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,r)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:r,visible:a,parameters:h,getPolygonOffset:l,highlightedObjectIndex:_,autoHighlight:v,highlightColor:S,coordinateSystem:I,coordinateOrigin:B,wrapLongitude:z,positionFormat:V,modelMatrix:J,extensions:ue,fetch:j,operation:W,_subLayerProps:Z}=this.props,ae={id:"",updateTriggers:{},opacity:i,pickable:r,visible:a,parameters:h,getPolygonOffset:l,highlightedObjectIndex:_,autoHighlight:v,highlightColor:S,coordinateSystem:I,coordinateOrigin:B,wrapLongitude:z,positionFormat:V,modelMatrix:J,extensions:ue,fetch:j,operation:W},be=Z&&e.id&&Z[e.id],Ee=be&&be.updateTriggers,Le=e.id||"sublayer";if(be){const ke=this.props[Gl],Ue=e.type?e.type._propTypes:{};for(const Me in be){const ut=Ue[Me]||ke[Me];ut&&ut.type==="accessor"&&(be[Me]=this.getSubLayerAccessor(be[Me]))}}Object.assign(ae,e,be),ae.id="".concat(this.props.id,"-").concat(Le),ae.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...Ee};for(const ke of ue){const Ue=ke.getSubLayerProps.call(this,ke);Ue&&Object.assign(ae,Ue,{updateTriggers:Object.assign(ae.updateTriggers,Ue.updateTriggers)})}return ae}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();if(r){const a=this.renderLayers();i=qb(a,Boolean),this.internalState.subLayers=i}Er(IH,this,r,i);for(const a of i)a.parent=this}}R(KB,"layerName","CompositeLayer");class PH{constructor(e){R(this,"opts",void 0),R(this,"typedArrayManager",void 0),R(this,"indexStarts",[0]),R(this,"vertexStarts",[0]),R(this,"vertexCount",0),R(this,"instanceCount",0),R(this,"attributes",void 0),R(this,"_attributeDefs",void 0),R(this,"data",void 0),R(this,"getGeometry",void 0),R(this,"geometryBuffer",void 0),R(this,"buffers",void 0),R(this,"positionSize",void 0),R(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=jh,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:r,geometryBuffer:a,positionFormat:h,dataChanged:l,normalize:_=!0}=this.opts;if(this.data=n,this.getGeometry=r,this.positionSize=a&&a.size||(h==="XY"?2:3),this.buffers=i,this.normalize=_,a&&(Ki(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(a),_||(i.positions=a)),this.geometryBuffer=i.positions,Array.isArray(l))for(const v of l)this._rebuildGeometry(v);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?jB(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:r,_attributeDefs:a,typedArrayManager:h}=this;for(const l in a)if(l in r)h.release(i[l]),i[l]=null;else{const _=a[l];_.copy=n,i[l]=h.allocate(i[l],e,_)}}_forEachGeometry(e,n,i){const{data:r,getGeometry:a}=this,{iterable:h,objectInfo:l}=$b(r,n,i);for(const _ of h){l.index++;const v=a?a(_,l):null;e(v,l.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:r}=this;const{data:a,geometryBuffer:h}=this,{startRow:l=0,endRow:_=1/0}=e||{},v={};if(e||(n=[0],i=[0]),this.normalize||!h)this._forEachGeometry((I,B)=>{const z=I&&this.normalizeGeometry(I);v[B]=z,i[B+1]=i[B]+(z?this.getGeometrySize(z):0)},l,_),r=i[i.length-1];else if(i=a.startIndices,r=i[a.length]||0,ArrayBuffer.isView(h))r=r||h.length/this.positionSize;else if(h instanceof _n){const I=h.accessor.stride||this.positionSize*4;r=r||h.byteLength/I}else if(h.buffer){const I=h.stride||this.positionSize*4;r=r||h.buffer.byteLength/I}else if(h.value){const I=h.value,B=h.stride/I.BYTES_PER_ELEMENT||this.positionSize;r=r||I.length/B}this._allocate(r,!!e),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=r;const S={};this._forEachGeometry((I,B)=>{const z=v[B]||I;S.vertexStart=i[B],S.indexStart=n[B];const V=B<i.length-1?i[B+1]:r;S.geometrySize=V-i[B],S.geometryIndex=B,this.updateGeometryAttributes(z,S)},l,_),this.vertexCount=n[n.length-1]}}const MH=typeof window<"u"?it.useLayoutEffect:it.useEffect,BH=MH;function f_(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const LH={position:"absolute",zIndex:-1};function YB(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>YB(n,e));if(j_(t)){if(RH(t))return e.style=LH,it.cloneElement(t,e);if(DH(t))return it.cloneElement(t,e)}return t}function j_(t){return t&&typeof t=="object"&&"type"in t||!1}function RH(t){var e;return(e=t.props)===null||e===void 0?void 0:e.mapStyle}function DH(t){const e=t.type;return e&&e.deckGLViewProps}function ex(t){if(typeof t=="function")return it.createElement(Wh,{},t);if(Array.isArray(t))return t.map(ex);if(j_(t)){if(t.type===it.Fragment)return ex(t.props.children);if(f_(t.type,Wh))return t}return t}function OH({children:t,layers:e=[],views:n=null}){const i=[],r=[],a={};return it.Children.forEach(ex(t),h=>{if(j_(h)){const l=h.type;if(f_(l,Zl)){const _=FH(l,h.props);r.push(_)}else i.push(h);if(f_(l,Wh)&&l!==Wh&&h.props.id){const _=new l(h.props);a[_.id]=_}}else h&&i.push(h)}),Object.keys(a).length>0&&(Array.isArray(n)?n.forEach(h=>{a[h.id]=h}):n&&(a[n.id]=n),n=Object.values(a)),e=r.length>0?[...r,...e]:e,{layers:e,children:i,views:n}}function FH(t,e){const n={},i=t.defaultProps||{};for(const r in e)i[r]!==e[r]&&(n[r]=e[r]);return new t(n)}function kH({children:t,deck:e,ContextProvider:n}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const r={},a=i.views[0].id;for(const h of t){let l=a,_=h;j_(h)&&f_(h.type,Wh)&&(l=h.props.id||a,_=h.props.children);const v=i.getViewport(l),S=i.getViewState(l);if(v){S.padding=v.padding;const{x:I,y:B,width:z,height:V}=v;_=YB(_,{x:I,y:B,width:z,height:V,viewport:v,viewState:S}),r[l]||(r[l]={viewport:v,children:[]}),r[l].children.push(_)}}return Object.keys(r).map(h=>{const{viewport:l,children:_}=r[h],{x:v,y:S,width:I,height:B}=l,z={position:"absolute",left:v,top:S,width:I,height:B},V="view-".concat(h),J=it.createElement("div",{key:V,id:V,style:z},..._);if(n){const ue={viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:j=>{j.viewId=h,e._onViewStateChange(j)}};return it.createElement(n,{key:V,value:ue},J)}return J})}const zH={mixBlendMode:null};function NH({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},r={left:0,top:0};if(n)for(const a in n)a in zH?r[a]=n[a]:i[a]=n[a];return{containerStyle:i,canvasStyle:r}}function UH(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function QB(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function GH(t,e,n){const i=new e({...n,_customRender:r=>{t.redrawReason=r;const a=i.getViewports();t.lastRenderedViewports!==a?t.forceUpdate():QB(t)}});return i}const eL=it.forwardRef((t,e)=>{const[n,i]=it.useState(0),a=it.useRef({control:null,version:n,forceUpdate:()=>i(be=>be+1)}).current,h=it.useRef(null),l=it.useRef(null),_=it.useMemo(()=>OH(t),[t.layers,t.views,t.children]);let v=!0;const S=be=>{var Ee;return v&&t.viewState?(a.viewStateUpdateRequested=be,null):(a.viewStateUpdateRequested=null,(Ee=t.onViewStateChange)===null||Ee===void 0?void 0:Ee.call(t,be))},I=be=>{if(v)a.interactionStateUpdateRequested=be;else{var Ee;a.interactionStateUpdateRequested=null,(Ee=t.onInteractionStateChange)===null||Ee===void 0||Ee.call(t,be)}},B=it.useMemo(()=>{const be={...t,style:null,width:"100%",height:"100%",parent:h.current,canvas:l.current,layers:_.layers,views:_.views,onViewStateChange:S,onInteractionStateChange:I};return delete be._customRender,a.deck&&a.deck.setProps(be),be},[t]);it.useEffect(()=>{const be=t.Deck||V_;return a.deck=GH(a,be,{...B,parent:h.current,canvas:l.current}),()=>{var Ee;return(Ee=a.deck)===null||Ee===void 0?void 0:Ee.finalize()}},[]),BH(()=>{QB(a);const{viewStateUpdateRequested:be,interactionStateUpdateRequested:Ee}=a;be&&S(be),Ee&&I(Ee)}),it.useImperativeHandle(e,()=>UH(a),[]);const z=a.deck&&a.deck.isInitialized?a.deck.getViewports():void 0,{ContextProvider:V,width:J,height:ue,id:j,style:W}=t,{containerStyle:Z,canvasStyle:ae}=it.useMemo(()=>NH({width:J,height:ue,style:W}),[J,ue,W]);if(!a.viewStateUpdateRequested&&a.lastRenderedViewports===z||a.version!==n){a.lastRenderedViewports=z,a.version=n;const be=kH({children:_.children,deck:a.deck,ContextProvider:V}),Ee=it.createElement("canvas",{key:"canvas",id:j||"deckgl-overlay",ref:l,style:ae});a.control=it.createElement("div",{id:"".concat(j||"deckgl","-wrapper"),ref:h,style:Z},[Ee,be])}return v=!1,a.control});eL.defaultProps=V_.defaultProps;const VH=eL,jH=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,HH=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,tL=[0,0,0,255],nL=[0,0,1],WH={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:nL},getColor:{type:"accessor",value:tL},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function qH(t){const{header:e,attributes:n}=t;!e||!n||(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}class Qb extends Zl{getShaders(){return super.getShaders({vs:jH,fs:HH,modules:[N_,lV,U_]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:nL},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:tL}})}updateState(e){const{changeFlags:n,props:i}=e;if(super.updateState(e),n.extensionsChanged){var r;const{gl:a}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}n.dataChanged&&qH(i.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:i}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:t_[i],radiusPixels:n}).draw()}_getModel(e){const n=[];for(let i=0;i<3;i++){const r=i/3*Math.PI*2;n.push(Math.cos(r)*2,Math.sin(r)*2,0)}return new Xc(e,{...this.getShaders(),id:this.props.id,geometry:new Eh({drawMode:4,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}R(Qb,"layerName","PointCloudLayer");R(Qb,"defaultProps",WH);function Xm(t,e){const n=e.length,i=t.length;if(i>0){let r=!0;for(let a=0;a<n;a++)if(t[i-n+a]!==e[a]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[i+r]=e[r];return!0}function gC(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function _C(t,e,n,i,r=[]){const a=i+e*n;for(let h=0;h<n;h++)r[h]=t[a+h];return r}function yC(t,e,n,i,r=[]){let a,h;if(n&8)a=(i[3]-t[1])/(e[1]-t[1]),h=3;else if(n&4)a=(i[1]-t[1])/(e[1]-t[1]),h=1;else if(n&2)a=(i[2]-t[0])/(e[0]-t[0]),h=2;else if(n&1)a=(i[0]-t[0])/(e[0]-t[0]),h=0;else return null;for(let l=0;l<t.length;l++)r[l]=(h&1)===l?i[h]:a*(e[l]-t[l])+t[l];return r}function av(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function iL(t,e){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:a=[0,0],startIndex:h=0,endIndex:l=t.length}=e||{},_=(l-h)/n;let v=[];const S=[v],I=_C(t,0,n,h);let B,z;const V=XH(I,r,a,[]),J=[];Xm(v,I);for(let ue=1;ue<_;ue++){for(B=_C(t,ue,n,h,B),z=av(B,V);z;){yC(I,B,z,V,J);const j=av(J,V);j&&(yC(I,J,j,V,J),z=j),Xm(v,J),gC(I,J),$H(V,r,z),i&&v.length>n&&(v=[],S.push(v),Xm(v,I)),z=av(B,V)}Xm(v,B),gC(I,B)}return i?S:S[0]}function XH(t,e,n,i){const r=Math.floor((t[0]-n[0])/e)*e+n[0],a=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=a,i[2]=r+e,i[3]=a+e,i}function $H(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function ZH(t,e){const{size:n=2,startIndex:i=0,endIndex:r=t.length,normalize:a=!0}=e||{},h=t.slice(i,r);JH(h,n,0,r-i);const l=iL(h,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(a)for(const _ of l)KH(_,n);return l}function JH(t,e,n,i){let r=t[0],a;for(let h=n;h<i;h+=e){a=t[h];const l=a-r;(l>180||l<-180)&&(a-=Math.round(l/360)*360),t[h]=r=a}}function KH(t,e){let n;const i=t.length/e;for(let a=0;a<i&&(n=t[a*e],(n+180)%360===0);a++);const r=-Math.round(n/360)*360;if(r!==0)for(let a=0;a<i;a++)t[a*e]+=r}function YH(t,e,n,i){let r;if(Array.isArray(t[0])){const a=t.length*e;r=new Array(a);for(let h=0;h<t.length;h++)for(let l=0;l<e;l++)r[h*e+l]=t[h][l]||0}else r=t;return n?iL(r,{size:e,gridResolution:n}):i?ZH(r,{size:e}):r}const QH=1,e7=2,lv=4;class t7 extends PH{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?YH(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(vC(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&vC(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:a,geometrySize:h}=n;i.fill(0,a,a+h),r?(i[a]=lv,i[a+h-2]=lv):(i[a]+=QH,i[a+h-2]+=e7),i[a+h-1]=lv}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:r,geometrySize:a}=n,h=new Array(3);for(let l=r,_=0;_<a;l++,_++)this.getPointOnPath(e,_,h),i[l*3]=h[0],i[l*3+1]=h[1],i[l*3+2]=h[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:r}=this;n*r>=e.length&&(n+=1-e.length/r);const a=n*r;return i[0]=e[a],i[1]=e[a+1],i[2]=r===3&&e[a+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function vC(t){return Array.isArray(t[0])}const n7=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,i7=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,rL=[0,0,0,255],r7={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:rL},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},cv={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class ew extends Zl{constructor(...e){super(...e),R(this,"state",void 0)}getShaders(){return super.getShaders({vs:n7,fs:i7,modules:[N_,U_]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:cv,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:cv,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:cv,defaultValue:rL},instancePickingColors:{size:3,type:5121,accessor:(i,{index:r,target:a})=>this.encodePickingColor(i&&i.__source?i.__source.index:r,a)}}),this.setState({pathTesselator:new t7({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,_=n.data.attributes||{};l.updateGeometry({data:n.data,geometryBuffer:_.getPath,buffers:_,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),i.dataChanged||r.invalidateAll()}if(i.extensionsChanged){var h;const{gl:l}=this.context;(h=this.state.model)===null||h===void 0||h.delete(),this.state.model=this._getModel(l),r.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(a=>a.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:r,miterLimit:a,widthUnits:h,widthScale:l,widthMinPixels:_,widthMaxPixels:v}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:r,widthUnits:t_[h],widthScale:l,miterLimit:a,widthMinPixels:_,widthMaxPixels:v}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Xc(e,{...this.getShaders(),id:this.props.id,geometry:new Eh({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}R(ew,"defaultProps",r7);R(ew,"layerName","PathLayer");const Is={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Te;new Te;const cf=new Te,xC=new Te;class Tp{constructor(e=[0,0,0],n=0){R(this,"center",void 0),R(this,"radius",void 0),this.radius=-0,this.center=new Te,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=cf.from(n),this.center=new Te().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Tp(this.center,this.radius)}union(e){const n=this.center,i=this.radius,r=e.center,a=e.radius,h=cf.copy(r).subtract(n),l=h.magnitude();if(i>=l+a)return this.clone();if(a>=l+i)return e.clone();const _=(i+l+a)*.5;return xC.copy(h).scale((-i+_)/l).add(n),this.center.copy(xC),this.radius=_,this}expand(e){const i=cf.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const n=m5(cf,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const i=cf.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const n=this.center,i=this.radius,a=e.normal.dot(n)+e.distance;return a<-i?Is.OUTSIDE:a<i?Is.INTERSECTING:Is.INSIDE}}const s7=new Te,o7=new Te,$m=new Te,Zm=new Te,Jm=new Te,a7=new Te,l7=new Te,Pa={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Sp{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){R(this,"center",void 0),R(this,"halfAxes",void 0),this.center=new Te().from(e),this.halfAxes=new gi(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new Te(e).len(),new Te(n).len(),new Te(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),r=new Te(e).normalize(),a=new Te(n).normalize(),h=new Te(i).normalize();return new rp().fromMatrix3(new gi([...r,...a,...h]))}fromCenterHalfSizeQuaternion(e,n,i){const r=new rp(i),a=new gi().fromQuaternion(r);return a[0]=a[0]*n[0],a[1]=a[1]*n[0],a[2]=a[2]*n[0],a[3]=a[3]*n[1],a[4]=a[4]*n[1],a[5]=a[5]*n[1],a[6]=a[6]*n[2],a[7]=a[7]*n[2],a[8]=a[8]*n[2],this.center=new Te().from(e),this.halfAxes=a,this}clone(){return new Sp(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Tp){const n=this.halfAxes,i=n.getColumn(0,$m),r=n.getColumn(1,Zm),a=n.getColumn(2,Jm),h=s7.copy(i).add(r).add(a);return e.center.copy(this.center),e.radius=h.magnitude(),e}intersectPlane(e){const n=this.center,i=e.normal,r=this.halfAxes,a=i.x,h=i.y,l=i.z,_=Math.abs(a*r[Pa.COLUMN0ROW0]+h*r[Pa.COLUMN0ROW1]+l*r[Pa.COLUMN0ROW2])+Math.abs(a*r[Pa.COLUMN1ROW0]+h*r[Pa.COLUMN1ROW1]+l*r[Pa.COLUMN1ROW2])+Math.abs(a*r[Pa.COLUMN2ROW0]+h*r[Pa.COLUMN2ROW1]+l*r[Pa.COLUMN2ROW2]),v=i.dot(n)+e.distance;return v<=-_?Is.OUTSIDE:v>=_?Is.INSIDE:Is.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=o7.from(e).subtract(this.center),i=this.halfAxes,r=i.getColumn(0,$m),a=i.getColumn(1,Zm),h=i.getColumn(2,Jm),l=r.magnitude(),_=a.magnitude(),v=h.magnitude();r.normalize(),a.normalize(),h.normalize();let S=0,I;return I=Math.abs(n.dot(r))-l,I>0&&(S+=I*I),I=Math.abs(n.dot(a))-_,I>0&&(S+=I*I),I=Math.abs(n.dot(h))-v,I>0&&(S+=I*I),S}computePlaneDistances(e,n,i=[-0,-0]){let r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;const h=this.center,l=this.halfAxes,_=l.getColumn(0,$m),v=l.getColumn(1,Zm),S=l.getColumn(2,Jm),I=a7.copy(_).add(v).add(S).add(h),B=l7.copy(I).subtract(e);let z=n.dot(B);return r=Math.min(z,r),a=Math.max(z,a),I.copy(h).add(_).add(v).subtract(S),B.copy(I).subtract(e),z=n.dot(B),r=Math.min(z,r),a=Math.max(z,a),I.copy(h).add(_).subtract(v).add(S),B.copy(I).subtract(e),z=n.dot(B),r=Math.min(z,r),a=Math.max(z,a),I.copy(h).add(_).subtract(v).subtract(S),B.copy(I).subtract(e),z=n.dot(B),r=Math.min(z,r),a=Math.max(z,a),h.copy(I).subtract(_).add(v).add(S),B.copy(I).subtract(e),z=n.dot(B),r=Math.min(z,r),a=Math.max(z,a),h.copy(I).subtract(_).add(v).subtract(S),B.copy(I).subtract(e),z=n.dot(B),r=Math.min(z,r),a=Math.max(z,a),h.copy(I).subtract(_).subtract(v).add(S),B.copy(I).subtract(e),z=n.dot(B),r=Math.min(z,r),a=Math.max(z,a),h.copy(I).subtract(_).subtract(v).subtract(S),B.copy(I).subtract(e),z=n.dot(B),r=Math.min(z,r),a=Math.max(z,a),i[0]=r,i[1]=a,i}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,$m);n.transformAsPoint(e);const i=this.halfAxes.getColumn(1,Zm);i.transformAsPoint(e);const r=this.halfAxes.getColumn(2,Jm);return r.transformAsPoint(e),this.halfAxes=new gi([...n,...i,...r]),this}getTransform(){throw new Error("not implemented")}}const bC=new Te,wC=new Te;class Io{constructor(e=[0,0,1],n=0){R(this,"normal",void 0),R(this,"distance",void 0),this.normal=new Te,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return Po(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=bC.from(e),this.normal.from(n).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,n,i,r){return this.normal.set(e,n,i),Po(Oo(this.normal.len(),1)),this.distance=r,this}clone(){return new Io(this.normal,this.distance)}equals(e){return Oo(this.distance,e.distance)&&Oo(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=wC.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,n)}projectPointOntoPlane(e,n=[0,0,0]){e=bC.from(e);const i=this.getPointDistance(e),r=wC.copy(this.normal).scale(i);return e.subtract(r).to(n)}}const AC=[new Te([1,0,0]),new Te([0,1,0]),new Te([0,0,1])],EC=new Te,c7=new Te;new Io(new Te(1,0,0),0);class to{constructor(e=[]){R(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*AC.length;const n=e.center,i=e.radius;let r=0;for(const a of AC){let h=this.planes[r],l=this.planes[r+1];h||(h=this.planes[r]=new Io),l||(l=this.planes[r+1]=new Io);const _=EC.copy(a).scale(-i).add(n);-a.dot(_),h.fromPointNormal(_,a);const v=EC.copy(a).scale(i).add(n),S=c7.copy(a).negate();-S.dot(v),l.fromPointNormal(v,S),r+=2}return this}computeVisibility(e){let n=Is.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case Is.OUTSIDE:return Is.OUTSIDE;case Is.INTERSECTING:n=Is.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(Po(Number.isFinite(n),"parentPlaneMask is required."),n===to.MASK_OUTSIDE||n===to.MASK_INSIDE)return n;let i=to.MASK_INSIDE;const r=this.planes;for(let a=0;a<this.planes.length;++a){const h=a<31?1<<a:0;if(a<31&&!(n&h))continue;const l=r[a],_=e.intersectPlane(l);if(_===Is.OUTSIDE)return to.MASK_OUTSIDE;_===Is.INTERSECTING&&(i|=h)}return i}}R(to,"MASK_OUTSIDE",4294967295);R(to,"MASK_INSIDE",0);R(to,"MASK_INDETERMINATE",2147483647);new Te;new Te;new Te;new Te;new Te;new Te;new Te;new Te;new Te;new Te;new Te;new Te;new Te;new Te;new Te;new Te;new Te;const ea=new gi,u7=new gi,h7=new gi,Km=new gi,TC=new gi;function d7(t,e={}){const n=sp.EPSILON20,i=10;let r=0,a=0;const h=u7,l=h7;h.identity(),l.copy(t);const _=n*f7(l);for(;a<i&&p7(l)>_;)m7(l,Km),TC.copy(Km).transpose(),l.multiplyRight(Km),l.multiplyLeft(TC),h.multiplyRight(Km),++r>2&&(++a,r=0);return e.unitary=h.toTarget(e.unitary),e.diagonal=l.toTarget(e.diagonal),e}function f7(t){let e=0;for(let n=0;n<9;++n){const i=t[n];e+=i*i}return Math.sqrt(e)}const tx=[1,0,0],nx=[2,2,1];function p7(t){let e=0;for(let n=0;n<3;++n){const i=t[ea.getElementIndex(nx[n],tx[n])];e+=2*i*i}return Math.sqrt(e)}function m7(t,e){const n=sp.EPSILON15;let i=0,r=1;for(let v=0;v<3;++v){const S=Math.abs(t[ea.getElementIndex(nx[v],tx[v])]);S>i&&(r=v,i=S)}const a=tx[r],h=nx[r];let l=1,_=0;if(Math.abs(t[ea.getElementIndex(h,a)])>n){const v=t[ea.getElementIndex(h,h)],S=t[ea.getElementIndex(a,a)],I=t[ea.getElementIndex(h,a)],B=(v-S)/2/I;let z;B<0?z=-1/(-B+Math.sqrt(1+B*B)):z=1/(B+Math.sqrt(1+B*B)),l=1/Math.sqrt(1+z*z),_=z*l}return gi.IDENTITY.to(e),e[ea.getElementIndex(a,a)]=e[ea.getElementIndex(h,h)]=l,e[ea.getElementIndex(h,a)]=_,e[ea.getElementIndex(a,h)]=-_,e}const Al=new Te,g7=new Te,_7=new Te,y7=new Te,v7=new Te,x7=new gi,b7={diagonal:new gi,unitary:new gi};function w7(t,e=new Sp){if(!t||t.length===0)return e.halfAxes=new gi([0,0,0,0,0,0,0,0,0]),e.center=new Te,e;const n=t.length,i=new Te(0,0,0);for(const Ue of t)i.add(Ue);const r=1/n;i.multiplyByScalar(r);let a=0,h=0,l=0,_=0,v=0,S=0;for(const Ue of t){const Me=Al.copy(Ue).subtract(i);a+=Me.x*Me.x,h+=Me.x*Me.y,l+=Me.x*Me.z,_+=Me.y*Me.y,v+=Me.y*Me.z,S+=Me.z*Me.z}a*=r,h*=r,l*=r,_*=r,v*=r,S*=r;const I=x7;I[0]=a,I[1]=h,I[2]=l,I[3]=h,I[4]=_,I[5]=v,I[6]=l,I[7]=v,I[8]=S;const{unitary:B}=d7(I,b7),z=e.halfAxes.copy(B);let V=z.getColumn(0,_7),J=z.getColumn(1,y7),ue=z.getColumn(2,v7),j=-Number.MAX_VALUE,W=-Number.MAX_VALUE,Z=-Number.MAX_VALUE,ae=Number.MAX_VALUE,be=Number.MAX_VALUE,Ee=Number.MAX_VALUE;for(const Ue of t)Al.copy(Ue),j=Math.max(Al.dot(V),j),W=Math.max(Al.dot(J),W),Z=Math.max(Al.dot(ue),Z),ae=Math.min(Al.dot(V),ae),be=Math.min(Al.dot(J),be),Ee=Math.min(Al.dot(ue),Ee);V=V.multiplyByScalar(.5*(ae+j)),J=J.multiplyByScalar(.5*(be+W)),ue=ue.multiplyByScalar(.5*(Ee+Z)),e.center.copy(V).add(J).add(ue);const Le=g7.set(j-ae,W-be,Z-Ee).multiplyByScalar(.5),ke=new gi([Le[0],0,0,0,Le[1],0,0,0,Le[2]]);return e.halfAxes.multiplyRight(ke),e}const A7={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}};class tw extends ew{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`uniform float trailLength;
attribute float instanceTimestamps;
attribute float instanceNextTimestamps;
varying float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
varying float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:n,trailLength:i,currentTime:r}=this.props;e.uniforms={...e.uniforms,fadeTrail:n,trailLength:i,currentTime:r},super.draw(e)}}R(tw,"layerName","TripsLayer");R(tw,"defaultProps",A7);const uv=Math.PI/180,Ym=new Float32Array(16),SC=new Float32Array(12);function CC(t,e,n){const i=e[0]*uv,r=e[1]*uv,a=e[2]*uv,h=Math.sin(a),l=Math.sin(i),_=Math.sin(r),v=Math.cos(a),S=Math.cos(i),I=Math.cos(r),B=n[0],z=n[1],V=n[2];t[0]=B*I*S,t[1]=B*_*S,t[2]=B*-l,t[3]=z*(-_*v+I*l*h),t[4]=z*(I*v+_*l*h),t[5]=z*S*h,t[6]=V*(_*h+I*l*v),t[7]=V*(-I*h+_*l*v),t[8]=V*S*v}function IC(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const sL={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:i,getOrientation:r,getScale:a,getTranslation:h,getTransformMatrix:l}=this.props,_=Array.isArray(l),v=_&&l.length===16,S=Array.isArray(a),I=Array.isArray(r),B=Array.isArray(h),z=v||!_&&!!l(i[0]);z?t.constant=v:t.constant=I&&S&&B;const V=t.value;if(t.constant){let J;z?(Ym.set(l),J=IC(Ym)):(J=SC,CC(J,r,a),J.set(h,9)),t.value=new Float32Array(J)}else{let J=e*t.size;const{iterable:ue,objectInfo:j}=$b(i,e,n);for(const W of ue){j.index++;let Z;if(z)Ym.set(v?l:l(W,j)),Z=IC(Ym);else{Z=SC;const ae=I?r:r(W,j),be=S?a:a(W,j);CC(Z,ae,be),Z.set(B?h:h(W,j),9)}V[J++]=Z[0],V[J++]=Z[1],V[J++]=Z[2],V[J++]=Z[3],V[J++]=Z[4],V[J++]=Z[5],V[J++]=Z[6],V[J++]=Z[7],V[J++]=Z[8],V[J++]=Z[9],V[J++]=Z[10],V[J++]=Z[11]}}}};function oL(t,e){return e===Jt.CARTESIAN||e===Jt.METER_OFFSETS||e===Jt.DEFAULT&&!t.isGeospatial}const E7=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,T7=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function aL(t){let e=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,h=-1/0;const l=t.POSITION?t.POSITION.value:[],_=l&&l.length;for(let v=0;v<_;v+=3){const S=l[v],I=l[v+1],B=l[v+2];e=S<e?S:e,n=I<n?I:n,i=B<i?B:i,r=S>r?S:r,a=I>a?I:a,h=B>h?B:h}return[[e,n,i],[r,a,h]]}function S7(t,e){if(!t)throw new Error(e||"loader assertion failed.")}class gh{constructor(e,n){R(this,"fields",void 0),R(this,"metadata",void 0),S7(Array.isArray(e)),C7(e),this.fields=e,this.metadata=n||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let n=0;n<this.fields.length;++n)if(!this.fields[n].compareTo(e.fields[n]))return!1;return!0}select(){const e=Object.create(null);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];for(const h of i)e[h]=!0;const a=this.fields.filter(h=>e[h.name]);return new gh(a,this.metadata)}selectAt(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const r=n.map(a=>this.fields[a]).filter(Boolean);return new gh(r,this.metadata)}assign(e){let n,i=this.metadata;if(e instanceof gh){const h=e;n=h.fields,i=PC(PC(new Map,this.metadata),h.metadata)}else n=e;const r=Object.create(null);for(const h of this.fields)r[h.name]=h;for(const h of n)r[h.name]=h;const a=Object.values(r);return new gh(a,i)}}function C7(t){const e={};for(const n of t)e[n.name]&&console.warn("Schema: duplicated field name",n.name,n),e[n.name]=!0}function PC(t,e){return new Map([...t||new Map,...e||new Map])}class p_{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;R(this,"name",void 0),R(this,"type",void 0),R(this,"nullable",void 0),R(this,"metadata",void 0),this.name=e,this.type=n,this.nullable=i,this.metadata=r}get typeId(){return this.type&&this.type.typeId}clone(){return new p_(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let pi=function(t){return t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth",t}({}),lL,cL,uL;class nw{static isNull(e){return e&&e.typeId===pi.Null}static isInt(e){return e&&e.typeId===pi.Int}static isFloat(e){return e&&e.typeId===pi.Float}static isBinary(e){return e&&e.typeId===pi.Binary}static isUtf8(e){return e&&e.typeId===pi.Utf8}static isBool(e){return e&&e.typeId===pi.Bool}static isDecimal(e){return e&&e.typeId===pi.Decimal}static isDate(e){return e&&e.typeId===pi.Date}static isTime(e){return e&&e.typeId===pi.Time}static isTimestamp(e){return e&&e.typeId===pi.Timestamp}static isInterval(e){return e&&e.typeId===pi.Interval}static isList(e){return e&&e.typeId===pi.List}static isStruct(e){return e&&e.typeId===pi.Struct}static isUnion(e){return e&&e.typeId===pi.Union}static isFixedSizeBinary(e){return e&&e.typeId===pi.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===pi.FixedSizeList}static isMap(e){return e&&e.typeId===pi.Map}static isDictionary(e){return e&&e.typeId===pi.Dictionary}get typeId(){return pi.NONE}compareTo(e){return this===e}}lL=Symbol.toStringTag;class Yh extends nw{constructor(e,n){super(),R(this,"isSigned",void 0),R(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=n}get typeId(){return pi.Int}get[lL](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class I7 extends Yh{constructor(){super(!0,8)}}class P7 extends Yh{constructor(){super(!0,16)}}class M7 extends Yh{constructor(){super(!0,32)}}class B7 extends Yh{constructor(){super(!1,8)}}class L7 extends Yh{constructor(){super(!1,16)}}class R7 extends Yh{constructor(){super(!1,32)}}const hL={HALF:16,SINGLE:32,DOUBLE:64};cL=Symbol.toStringTag;class dL extends nw{constructor(e){super(),R(this,"precision",void 0),this.precision=e}get typeId(){return pi.Float}get[cL](){return"Float"}toString(){return"Float".concat(this.precision)}}class D7 extends dL{constructor(){super(hL.SINGLE)}}class O7 extends dL{constructor(){super(hL.DOUBLE)}}uL=Symbol.toStringTag;class F7 extends nw{constructor(e,n){super(),R(this,"listSize",void 0),R(this,"children",void 0),this.listSize=e,this.children=[n]}get typeId(){return pi.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[uL](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function k7(t){switch(t.constructor){case Int8Array:return new I7;case Uint8Array:return new B7;case Int16Array:return new P7;case Uint16Array:return new L7;case Int32Array:return new M7;case Uint32Array:return new R7;case Float32Array:return new D7;case Float64Array:return new O7;default:throw new Error("array type not supported")}}function z7(t,e,n){const i=k7(e.value),r=n||N7(e);return new p_(t,new F7(e.size,new p_("value",i)),!1,r)}function N7(t){const e=new Map;return"byteOffset"in t&&e.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&e.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&e.set("normalized",t.normalized.toString()),e}function MC(t,e){(t.COLOR_0||t.colors)&&e||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),ln.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function BC(t,e){if(t.attributes)return MC(t.attributes,e),t instanceof Eh?t:new Eh(t);if(t.positions||t.POSITION)return MC(t,e),new Eh({attributes:t});throw Error("Invalid mesh")}const U7=[0,0,0,255],G7={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:U7},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class iw extends Zl{constructor(...e){super(...e),R(this,"state",void 0)}getShaders(){const e=!Xt(this.context.gl),n={};return Sb(this.context.gl,Fn.GLSL_DERIVATIVES)&&(n.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:E7,fs:T7,modules:[N_,cV,U_],transpileToGLSL100:e,defines:n})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let n=this.state.positionBounds;if(n)return n;const{mesh:i}=this.props;if(!i)return null;if(n=(e=i.header)===null||e===void 0?void 0:e.boundingBox,!n){const{attributes:r}=BC(i,this.props._useMeshColors);r.POSITION=r.POSITION||r.positions,n=aL(r)}return this.state.positionBounds=n,n}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:sL}),this.setState({emptyTexture:new Ds(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e;if(n.mesh!==i.mesh||r.extensionsChanged){var a;if(this.state.positionBounds=null,(a=this.state.model)===null||a===void 0||a.delete(),n.mesh){this.state.model=this.getModel(n.mesh);const h=n.mesh.attributes||n.mesh;this.setState({hasNormals:!!(h.NORMAL||h.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==i.texture&&this.setTexture(n.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){if(!this.state.model)return;const{viewport:n}=this.context,{sizeScale:i,coordinateSystem:r,_instanced:a}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:i,composeModelMatrix:!a||oL(n,r),flatShading:!this.state.hasNormals}).draw()}getModel(e){const n=new Xc(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:BC(e,this.props._useMeshColors),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:r}=this.state;return n.setUniforms({sampler:i||r,hasTexture:!!i}),n}setTexture(e){const{emptyTexture:n,model:i}=this.state;i&&i.setUniforms({sampler:e||n,hasTexture:!!e})}}R(iw,"defaultProps",G7);R(iw,"layerName","SimpleMeshLayer");class Ch{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n}=e;this.id=n||Xa(this.constructor.name),this.display=!0,this.position=new Te,this.rotation=new Te,this.scale=new Te(1,1,1),this.matrix=new Qt,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(e){return at(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return at(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return at(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:n,rotation:i,scale:r,update:a=!0}=e;return n&&this.setPosition(n),i&&this.setRotation(i),r&&this.setScale(r),a&&this.updateMatrix(),this}updateMatrix(){const e=this.position,n=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(n),this.matrix.scale(i),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:n,rotation:i,scale:r}=e;return n&&this.setPosition(n),i&&this.setRotation(i),r&&this.setScale(r),this.updateMatrix(),this}getCoordinateUniforms(e,n){at(e),n=n||this.matrix;const i=new Qt(e).multiplyRight(n),r=i.invert(),a=r.transpose();return{viewMatrix:e,modelMatrix:n,objectMatrix:n,worldMatrix:i,worldInverseMatrix:r,worldInverseTransposeMatrix:a}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Ff extends Ch{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:n=[]}=e;_t.assert(n.every(i=>i instanceof Ch),"every child must an instance of ScenegraphNode"),super(e),this.children=n}add(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(const r of n)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(e){const n=this.children,i=n.indexOf(e);return i>-1&&n.splice(i,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((n,i)=>{let{worldMatrix:r}=i;const a=n.getBounds();if(!a)return;const[h,l]=a,_=new Te(h).add(l).divide([2,2,2]);r.transformAsPoint(_,_);const v=new Te(l).subtract(h).divide([2,2,2]);r.transformAsVector(v,v);for(let S=0;S<8;S++){const I=new Te(S&1?-1:1,S&2?-1:1,S&4?-1:1).multiply(v).add(_);for(let B=0;B<3;B++)e[0][B]=Math.min(e[0][B],I[B]),e[1][B]=Math.max(e[1][B],I[B])}}),Number.isFinite(e[0][0])?e:null}traverse(e){let{worldMatrix:n=new Qt}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new Qt(n).multiplyRight(this.matrix);for(const r of this.children)r instanceof Ff?r.traverse(e,{worldMatrix:i}):e(r,{worldMatrix:i})}}const V7={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},j7={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function LC(t){if(!t._animation){const e=j7[t.componentType],n=V7[t.type],i=n*t.count,{buffer:r,byteOffset:a}=t.bufferView.data,h=new e(r,a+(t.byteOffset||0),i);if(n===1)t._animation=Array.from(h);else{const l=[];for(let _=0;_<h.length;_+=n)l.push(Array.from(h.slice(_,_+n)));t._animation=l}}return t._animation}const H7=new Qt;function W7(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const n=H7.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}const hv=new rp;function q7(t,e,n,i,r){if(e==="rotation"){hv.slerp({start:n,target:i,ratio:r});for(let a=0;a<hv.length;a++)t[e][a]=hv[a]}else for(let a=0;a<n.length;a++)t[e][a]=r*i[a]+(1-r)*n[a]}function X7(t,e,n){let{p0:i,outTangent0:r,inTangent1:a,p1:h,tDiff:l,ratio:_}=n;for(let v=0;v<t[e].length;v++){const S=r[v]*l,I=a[v]*l;t[e][v]=(2*Math.pow(_,3)-3*Math.pow(_,2)+1)*i[v]+(Math.pow(_,3)-2*Math.pow(_,2)+_)*S+(-2*Math.pow(_,3)+3*Math.pow(_,2))*h[v]+(Math.pow(_,3)-Math.pow(_,2))*I}}function $7(t,e,n){for(let i=0;i<n.length;i++)t[e][i]=n[i]}function Z7(t,e,n,i){let{input:r,interpolation:a,output:h}=e;const l=r[r.length-1],_=t%l,v=r.findIndex(z=>z>=_),S=Math.max(0,v-1);if(!Array.isArray(n[i]))switch(i){case"translation":n[i]=[0,0,0];break;case"rotation":n[i]=[0,0,0,1];break;case"scale":n[i]=[1,1,1];break;default:_t.warn("Bad animation path ".concat(i))()}at(n[i].length===h[S].length);const I=r[S],B=r[v];switch(a){case"STEP":$7(n,i,h[S]);break;case"LINEAR":if(B>I){const z=(_-I)/(B-I);q7(n,i,h[S],h[v],z)}break;case"CUBICSPLINE":if(B>I){const z=(_-I)/(B-I),V=B-I,J=h[3*S+1],ue=h[3*S+2],j=h[3*v+0],W=h[3*v+1];X7(n,i,{p0:J,outTangent0:ue,inTangent1:j,p1:W,tDiff:V,ratio:z})}break;default:_t.warn("Interpolation ".concat(a," not supported"))();break}}class J7{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const i=(e/1e3-this.startTime)*this.speed;this.channels.forEach(r=>{let{sampler:a,target:h,path:l}=r;Z7(i,a,h,l),W7(h,h._node)})}}class K7{constructor(e){this.animations=e.animations.map((n,i)=>{const r=n.name||"Animation-".concat(i),a=n.samplers.map(l=>{let{input:_,interpolation:v="LINEAR",output:S}=l;return{input:LC(e.accessors[_]),interpolation:v,output:LC(e.accessors[S])}}),h=n.channels.map(l=>{let{sampler:_,target:v}=l;return{sampler:a[_],target:e.nodes[v.node],path:v.path}});return new J7({name:r,channels:h})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(n=>n.animate(e))}getAnimations(){return this.animations}}class Y7 extends Ch{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(n),this.onBeforeRender=null,this.AfterRender=null,e instanceof Xc?(this.model=e,this._setModelNodeProps(n)):this.model=new Xc(e,n),this.bounds=null,this.managedResources=n.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class fL{constructor(e,n){let{attributes:i,material:r,pbrDebug:a,imageBasedLightingEnvironment:h,lights:l,useTangents:_}=n;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},Sb(e,Fn.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],h&&(this.uniforms.u_DiffuseEnvSampler=h.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=h.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=h.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),a&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(i.NORMAL,"HAS_NORMALS"),this.defineIfPresent(i.TANGENT&&_,"HAS_TANGENTS"),this.defineIfPresent(i.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(h,"USE_IBL"),this.defineIfPresent(l,"USE_LIGHTS"),this.defineIfPresent(a,"PBR_DEBUG"),r&&this.parseMaterial(r)}defineIfPresent(e,n){e&&(this.defines[n]=1)}parseTexture(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const r=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},a=e.texture.source.image;let h,l={};a.compressed?(h=a,l={[this.gl.TEXTURE_MIN_FILTER]:a.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):h={data:a};const _=new Ds(this.gl,{id:e.name||e.id,parameters:{...r,...l},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...h});this.uniforms[n]=_,this.defineIfPresent(i,i),this.generatedTextures.push(_)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:n=1,roughnessFactor:i=1}=e;this.uniforms.u_MetallicRoughnessValues=[n,i]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:n=1}=e.normalTexture;this.uniforms.u_NormalScale=n}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:n=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=n}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:n=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=n}else e.alphaMode==="BLEND"&&(_t.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const Q7=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,eW=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function RC(t,e){return Xt(t)?`#version 300 es
`.concat(e):e}function tW(t,e){const{id:n,drawMode:i,vertexCount:r,attributes:a,modelOptions:h}=e,l=new fL(t,e);_t.info(4,"createGLTFModel defines: ",l.defines)();const _=[];_.push(...l.generatedTextures),_.push(...Object.values(a).map(S=>S.buffer));const v=new Y7(t,{id:n,drawMode:i,vertexCount:r,modules:[Nb],parameters:l.parameters,vs:RC(t,Q7),fs:RC(t,eW),managedResources:_,...h,defines:{...l.defines,...h.defines}});return v.setProps({attributes:a}),v.setUniforms(l.uniforms),v}const nW={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},iW={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class rW{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},iW,n)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new K7(this.gltf):null}createScene(e){const i=(e.nodes||[]).map(a=>this.createNode(a));return new Ff({id:e.name||e.id,children:i})}createNode(e){if(!e._node){const i=(e.children||[]).map(a=>this.createNode(a));e.mesh&&i.push(this.createMesh(e.mesh));const r=new Ff({id:e.name||e.id,children:i});if(e.matrix)r.setMatrix(e.matrix);else{if(r.matrix.identity(),e.translation&&r.matrix.translate(e.translation),e.rotation){const a=new Qt().fromQuaternion(e.rotation);r.matrix.multiplyRight(a)}e.scale&&r.matrix.scale(e.scale)}e._node=r}return e._node}createMesh(e){if(!e._mesh){const i=(e.primitives||[]).map((a,h)=>this.createPrimitive(a,h,e)),r=new Ff({id:e.name||e.id,children:i});e._mesh=r}return e._mesh}getVertexCount(e){_t.warn("getVertexCount() not found")()}createPrimitive(e,n,i){const r=tW(this.gl,Object.assign({id:e.name||"".concat(i.name||i.id,"-primitive-").concat(n),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return r.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],r}createAttributes(e,n){const i={};return Object.keys(e).forEach(r=>{i[r]=this.createAccessor(e[r],this.createBuffer(e[r],this.gl.ARRAY_BUFFER))}),n&&(i.indices=this.createAccessor(n,this.createBuffer(n,this.gl.ELEMENT_ARRAY_BUFFER))),_t.info(4,"glTF Attributes",{attributes:e,indices:n,generated:i})(),i}createBuffer(e,n){e.bufferView||(e.bufferView={});const{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[n]||(i.lumaBuffers[n]=new _n(this.gl,{id:"from-".concat(i.id),data:i.data||e.value,target:n})),i.lumaBuffers[n]}createAccessor(e,n){return new ss({buffer:n,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:nW[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function sW(t,e,n){const i=new rW(t,n),r=i.instantiate(e),a=i.createAnimator();return{scenes:r,animator:a}}const oW="3.4.14",aW="3.4.14",pL="3.4.14",lW="https://unpkg.com/@loaders.gl/textures@".concat(pL,"/dist/libs/basis_encoder.wasm"),cW="https://unpkg.com/@loaders.gl/textures@".concat(pL,"/dist/libs/basis_encoder.js");let dv;async function DC(t){const e=t.modules||{};return e.basis?e.basis:(dv=dv||uW(t),await dv)}async function uW(t){let e=null,n=null;return[e,n]=await Promise.all([await Uc("basis_transcoder.js","textures",t),await Uc("basis_transcoder.wasm","textures",t)]),e=e||globalThis.BASIS,await hW(e,n)}function hW(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(i=>{t(n).then(r=>{const{BasisFile:a,initializeBasis:h}=r;h(),i({BasisFile:a})})})}let fv;async function OC(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(fv=fv||dW(t),await fv)}async function dW(t){let e=null,n=null;return[e,n]=await Promise.all([await Uc(cW,"textures",t),await Uc(lW,"textures",t)]),e=e||globalThis.BASIS,await fW(e,n)}function fW(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(i=>{t(n).then(r=>{const{BasisFile:a,KTX2File:h,initializeBasis:l,BasisEncoder:_}=r;l(),i({BasisFile:a,KTX2File:h,BasisEncoder:_})})})}const Ku={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},pW=["","WEBKIT_","MOZ_"],FC={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Qm=null;function mW(t){if(!Qm){t=t||gW()||void 0,Qm=new Set;for(const e of pW)for(const n in FC)if(t&&t.getExtension("".concat(e).concat(n))){const i=FC[n];Qm.add(i)}}return Qm}function gW(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var kC,zC,NC,UC,GC,VC,jC,HC;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(kC||(kC={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(zC||(zC={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(NC||(NC={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(UC||(UC={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(GC||(GC={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(VC||(VC={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(jC||(jC={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(HC||(HC={}));const Es=[171,75,84,88,32,50,48,187,13,10,26,10];function _W(t){const e=new Uint8Array(t);return!(e.byteLength<Es.length||e[0]!==Es[0]||e[1]!==Es[1]||e[2]!==Es[2]||e[3]!==Es[3]||e[4]!==Es[4]||e[5]!==Es[5]||e[6]!==Es[6]||e[7]!==Es[7]||e[8]!==Es[8]||e[9]!==Es[9]||e[10]!==Es[10]||e[11]!==Es[11])}const yW={etc1:{basisFormat:0,compressed:!0,format:Ku.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Ku.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Ku.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Ku.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Ku.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Ku.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function vW(t,e){if(e.basis.containerFormat==="auto"){if(_W(t)){const i=await OC(e);return WC(i.KTX2File,t,e)}const{BasisFile:n}=await DC(e);return pv(n,t,e)}switch(e.basis.module){case"encoder":const n=await OC(e);switch(e.basis.containerFormat){case"ktx2":return WC(n.KTX2File,t,e);case"basis":default:return pv(n.BasisFile,t,e)}case"transcoder":default:const{BasisFile:i}=await DC(e);return pv(i,t,e)}}function pv(t,e,n){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const r=i.getNumImages(),a=[];for(let h=0;h<r;h++){const l=i.getNumLevels(h),_=[];for(let v=0;v<l;v++)_.push(xW(i,h,v,n));a.push(_)}return a}finally{i.close(),i.delete()}}function xW(t,e,n,i){const r=t.getImageWidth(e,n),a=t.getImageHeight(e,n),h=t.getHasAlpha(),{compressed:l,format:_,basisFormat:v}=mL(i,h),S=t.getImageTranscodedSizeInBytes(e,n,v),I=new Uint8Array(S);if(!t.transcodeImage(I,e,n,v,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:a,data:I,compressed:l,format:_,hasAlpha:h}}function WC(t,e,n){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=i.getLevels(),a=[];for(let h=0;h<r;h++){a.push(bW(i,h,n));break}return[a]}finally{i.close(),i.delete()}}function bW(t,e,n){const{alphaFlag:i,height:r,width:a}=t.getImageLevelInfo(e,0,0),{compressed:h,format:l,basisFormat:_}=mL(n,i),v=t.getImageTranscodedSizeInBytes(e,0,0,_),S=new Uint8Array(v);if(!t.transcodeImage(S,e,0,0,_,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:a,height:r,data:S,compressed:h,levelSize:v,hasAlpha:i,format:l}}function mL(t,e){let n=t&&t.basis&&t.basis.format;return n==="auto"&&(n=gL()),typeof n=="object"&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),yW[n]}function gL(){const t=mW();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const wW={name:"Basis",id:Ua?"basis":"basis-nodejs",module:"textures",version:aW,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},AW={...wW,parse:vW};function Ms(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function _L(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const i=e.baseUri||e.uri;if(!i)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return i.substr(0,i.lastIndexOf("/")+1)+t}function EW(t,e,n){const i=t.bufferViews[n];Ms(i);const r=i.buffer,a=e[r];Ms(a);const h=(i.byteOffset||0)+a.byteOffset;return new Uint8Array(a.arrayBuffer,h,i.byteLength)}const qC=["SCALAR","VEC2","VEC3","VEC4"],TW=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],SW=new Map(TW),CW={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},IW={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},PW={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function yL(t){return qC[t-1]||qC[0]}function vL(t){const e=SW.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function rw(t,e){const n=PW[t.componentType],i=CW[t.type],r=IW[t.componentType],a=t.count*i,h=t.count*i*r;return Ms(h>=0&&h<=e.byteLength),{ArrayType:n,length:a,byteLength:h}}function xL(t){let{images:e,bufferViews:n}=t;e=e||[],n=n||[];const i=e.map(h=>h.bufferView);n=n.filter(h=>!i.includes(h));const r=n.reduce((h,l)=>h+l.byteLength,0),a=e.reduce((h,l)=>{const{width:_,height:v}=l.image;return h+_*v},0);return r+Math.ceil(4*a*1.33)}const MW={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class hs{constructor(e){R(this,"gltf",void 0),R(this,"sourceBuffers",void 0),R(this,"byteLength",void 0),this.gltf=e||{json:{...MW},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const n=this.getUsedExtensions().find(r=>r===e),i=this.json.extensions||{};return n?i[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(i=>i===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,n){return(e.extensions||{})[n]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,n){if(typeof n=="object")return n;const i=this.json[e]&&this.json[e][n];if(!i)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(n,"]"));return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const n=e.buffer,i=this.gltf.buffers[n];Ms(i);const r=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,r,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),r=this.getBuffer(n.buffer).data,{ArrayType:a,length:h}=rw(e,n),l=n.byteOffset+e.byteOffset;return new a(r,l,h)}getTypedArrayForImageData(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),r=this.getBuffer(n.buffer).data,a=n.byteOffset||0;return new Uint8Array(r,a,n.byteLength)}addApplicationData(e,n){return this.json[e]=n,this}addExtraData(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}addObjectExtension(e,n,i){return e.extensions=e.extensions||{},e.extensions[n]=i,this.registerUsedExtension(n),this}setObjectExtension(e,n,i){const r=e.extensions||{};r[n]=i}removeObjectExtension(e,n){const i=e.extensions||{},r=i[n];return delete i[n],r}addExtension(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ms(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}addRequiredExtension(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ms(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:n}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(e){const{meshIndex:n,matrix:i}=e;this.json.nodes=this.json.nodes||[];const r={mesh:n};return i&&(r.matrix=i),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(e){const{attributes:n,indices:i,material:r,mode:a=4}=e,l={primitives:[{attributes:this._addAttributes(n),mode:a}]};if(i){const _=this._addIndices(i);l.primitives[0].indices=_}return Number.isFinite(r)&&(l.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(l),this.json.meshes.length-1}addPointCloud(e){const i={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(e,n){const i=yb(e),r=n||(i==null?void 0:i.mimeType),h={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(h),this.json.images.length-1}addBufferView(e){const n=e.byteLength;Ms(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const i={buffer:0,byteOffset:this.byteLength,byteLength:n};return this.byteLength+=pp(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(e,n){const i={bufferView:e,type:yL(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const i=this.addBufferView(e);let r={min:n.min,max:n.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(e,n.size));const a={size:n.size,componentType:vL(e),count:Math.round(e.length/n.size),min:r.min,max:r.max};return this.addAccessor(i,Object.assign(a,n))}addTexture(e){const{imageIndex:n}=e,i={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,n;this.gltf.buffers=[];const i=this.byteLength,r=new ArrayBuffer(i),a=new Uint8Array(r);let h=0;for(const l of this.sourceBuffers||[])h=Ek(l,a,h);(e=this.json)!==null&&e!==void 0&&(n=e.buffers)!==null&&n!==void 0&&n[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(e,n){let i=!0;for(;i;){const r=e.indexOf(n);r>-1?e.splice(r,1):i=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={};for(const i in e){const r=e[i],a=this._getGltfAttributeName(i),h=this.addBinaryBuffer(r.value,r);n[a]=h}return n}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,n){const i={min:null,max:null};if(e.length<n)return i;i.min=[],i.max=[];const r=e.subarray(0,n);for(const a of r)i.min.push(a),i.max.push(a);for(let a=n;a<e.length;a+=n)for(let h=0;h<n;h++)i.min[0+h]=Math.min(i.min[0+h],e[a+h]),i.max[0+h]=Math.max(i.max[0+h],e[a+h]);return i}}const BW="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",LW="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",RW=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),DW=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),OW={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},FW={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function kW(t,e,n,i,r){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const h=await zW();GW(h,h.exports[FW[r]],t,e,n,i,h.exports[OW[a||"NONE"]])}let mv;async function zW(){return mv||(mv=NW()),mv}async function NW(){let t=BW;WebAssembly.validate(RW)&&(t=LW,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(UW(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function UW(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;++i){const r=t.charCodeAt(i);e[i]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let n=0;for(let i=0;i<t.length;++i)e[n++]=e[i]<60?DW[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,n)}function GW(t,e,n,i,r,a,h){const l=t.exports.sbrk,_=i+3&-4,v=l(_*r),S=l(a.length),I=new Uint8Array(t.exports.memory.buffer);I.set(a,S);const B=e(v,i,r,S,a.length);if(B===0&&h&&h(v,_,r),n.set(I.subarray(v,v+i*r)),l(v-l(0)),B!==0)throw new Error("Malformed buffer data: ".concat(B))}const sw="EXT_meshopt_compression",VW=sw;async function jW(t,e){var n;const i=new hs(t);if(!(e!=null&&(n=e.gltf)!==null&&n!==void 0&&n.decompressMeshes))return;const r=[];for(const a of t.json.bufferViews||[])r.push(HW(i,a));await Promise.all(r),i.removeExtension(sw)}async function HW(t,e){const n=t.getObjectExtension(e,sw);if(n){const{byteOffset:i=0,byteLength:r=0,byteStride:a,count:h,mode:l,filter:_="NONE",buffer:v}=n,S=t.gltf.buffers[v],I=new Uint8Array(S.arrayBuffer,S.byteOffset+i,r),B=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await kW(B,h,a,I,l,_),B}return null}const WW=Object.freeze(Object.defineProperty({__proto__:null,decode:jW,name:VW},Symbol.toStringTag,{value:"Module"})),th="EXT_texture_webp",qW=th;function XW(t,e){const n=new hs(t);if(!EN("image/webp")){if(n.getRequiredExtensions().includes(th))throw new Error("gltf: Required extension ".concat(th," not supported by browser"));return}const{json:i}=n;for(const r of i.textures||[]){const a=n.getObjectExtension(r,th);a&&(r.source=a.source),n.removeObjectExtension(r,th)}n.removeExtension(th)}const $W=Object.freeze(Object.defineProperty({__proto__:null,name:qW,preprocess:XW},Symbol.toStringTag,{value:"Module"})),Eg="KHR_texture_basisu",ZW=Eg;function JW(t,e){const n=new hs(t),{json:i}=n;for(const r of i.textures||[]){const a=n.getObjectExtension(r,Eg);a&&(r.source=a.source),n.removeObjectExtension(r,Eg)}n.removeExtension(Eg)}const KW=Object.freeze(Object.defineProperty({__proto__:null,name:ZW,preprocess:JW},Symbol.toStringTag,{value:"Module"})),YW="3.4.14",QW={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},eq={name:"Draco",id:Ua?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:YW,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:QW};function tq(t,e,n){const i=bL(e.metadata),r=[],a=nq(e.attributes);for(const h in t){const l=t[h],_=XC(h,l,a[h]);r.push(_)}if(n){const h=XC("indices",n);r.push(h)}return new gh(r,i)}function nq(t){const e={};for(const n in t){const i=t[n];e[i.name||"undefined"]=i}return e}function XC(t,e,n){const i=n?bL(n.metadata):void 0;return z7(t,e,i)}function bL(t){const e=new Map;for(const n in t)e.set("".concat(n,".string"),JSON.stringify(t[n]));return e}const $C={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},iq={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},rq=4;class sq{constructor(e){R(this,"draco",void 0),R(this,"decoder",void 0),R(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);const r=this.decoder.GetEncodedGeometryType(i),a=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let h;switch(r){case this.draco.TRIANGULAR_MESH:h=this.decoder.DecodeBufferToMesh(i,a);break;case this.draco.POINT_CLOUD:h=this.decoder.DecodeBufferToPointCloud(i,a);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!h.ok()||!a.ptr){const B="DRACO decompression failed: ".concat(h.error_msg());throw new Error(B)}const l=this._getDracoLoaderData(a,r,n),_=this._getMeshData(a,l,n),v=aL(_.attributes),S=tq(_.attributes,l,_.indices);return{loader:"draco",loaderData:l,header:{vertexCount:a.num_points(),boundingBox:v},..._,schema:S}}finally{this.draco.destroy(i),a&&this.draco.destroy(a)}}_getDracoLoaderData(e,n,i){const r=this._getTopLevelMetadata(e),a=this._getDracoAttributes(e,i);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:r,attributes:a}}_getDracoAttributes(e,n){const i={};for(let r=0;r<e.num_attributes();r++){const a=this.decoder.GetAttribute(e,r),h=this._getAttributeMetadata(e,r);i[a.unique_id()]={unique_id:a.unique_id(),attribute_type:a.attribute_type(),data_type:a.data_type(),num_components:a.num_components(),byte_offset:a.byte_offset(),byte_stride:a.byte_stride(),normalized:a.normalized(),attribute_index:r,metadata:h};const l=this._getQuantizationTransform(a,n);l&&(i[a.unique_id()].quantization_transform=l);const _=this._getOctahedronTransform(a,n);_&&(i[a.unique_id()].octahedron_transform=_)}return i}_getMeshData(e,n,i){const r=this._getMeshAttributes(n,e,i);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(e,n,i){const r={};for(const a of Object.values(e.attributes)){const h=this._deduceAttributeName(a,i);a.name=h;const{value:l,size:_}=this._getAttributeValues(n,a);r[h]={value:l,size:_,byteOffset:a.byte_offset,byteStride:a.byte_stride,normalized:a.normalized}}return r}_getTriangleListIndices(e){const i=e.num_faces()*3,r=i*rq,a=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,a),new Uint32Array(this.draco.HEAPF32.buffer,a,i).slice()}finally{this.draco._free(a)}}_getTriangleStripIndices(e){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),lq(n)}finally{this.draco.destroy(n)}}_getAttributeValues(e,n){const i=iq[n.data_type],r=n.num_components,h=e.num_points()*r,l=h*i.BYTES_PER_ELEMENT,_=oq(this.draco,i);let v;const S=this.draco._malloc(l);try{const I=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,I,_,l,S),v=new i(this.draco.HEAPF32.buffer,S,h).slice()}finally{this.draco._free(S)}return{value:v,size:r}}_deduceAttributeName(e,n){const i=e.unique_id;for(const[h,l]of Object.entries(n.extraAttributes||{}))if(l===i)return h;const r=e.attribute_type;for(const h in $C)if(this.draco[h]===r)return $C[h];const a=n.attributeNameEntry||"name";return e.metadata[a]?e.metadata[a].string:"CUSTOM_ATTRIBUTE_".concat(i)}_getTopLevelMetadata(e){const n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}_getAttributeMetadata(e,n){const i=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const n={},i=this.metadataQuerier.NumEntries(e);for(let r=0;r<i;r++){const a=this.metadataQuerier.GetEntryName(e,r);n[a]=this._getDracoMetadataField(e,a)}return n}_getDracoMetadataField(e,n){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,i);const r=aq(i);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:r}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){const{quantizedAttributes:n=[],octahedronAttributes:i=[]}=e,r=[...n,...i];for(const a of r)this.decoder.SkipAttributeTransform(this.draco[a])}_getQuantizationTransform(e,n){const{quantizedAttributes:i=[]}=n,r=e.attribute_type();if(i.map(h=>this.decoder[h]).includes(r)){const h=new this.draco.AttributeQuantizationTransform;try{if(h.InitFromAttribute(e))return{quantization_bits:h.quantization_bits(),range:h.range(),min_values:new Float32Array([1,2,3]).map(l=>h.min_value(l))}}finally{this.draco.destroy(h)}}return null}_getOctahedronTransform(e,n){const{octahedronAttributes:i=[]}=n,r=e.attribute_type();if(i.map(h=>this.decoder[h]).includes(r)){const h=new this.draco.AttributeQuantizationTransform;try{if(h.InitFromAttribute(e))return{quantization_bits:h.quantization_bits()}}finally{this.draco.destroy(h)}}return null}}function oq(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function aq(t){const e=t.size(),n=new Int32Array(e);for(let i=0;i<e;i++)n[i]=t.GetValue(i);return n}function lq(t){const e=t.size(),n=new Int32Array(e);for(let i=0;i<e;i++)n[i]=t.GetValue(i);return n}const cq="1.5.5",ow="https://www.gstatic.com/draco/versioned/decoders/".concat(cq),uq="".concat(ow,"/draco_decoder.js"),hq="".concat(ow,"/draco_wasm_wrapper.js"),dq="".concat(ow,"/draco_decoder.wasm");let uf;async function fq(t){const e=t.modules||{};return e.draco3d?uf=uf||e.draco3d.createDecoderModule({}).then(n=>({draco:n})):uf=uf||pq(t),await uf}async function pq(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await Uc(uq,"draco",t);break;case"wasm":default:[e,n]=await Promise.all([await Uc(hq,"draco",t),await Uc(dq,"draco",t)])}return e=e||globalThis.DracoDecoderModule,await mq(e,n)}function mq(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(i=>{t({...n,onModuleLoaded:r=>i({draco:r})})})}const wL={...eq,parse:gq};async function gq(t,e){const{draco:n}=await fq(e),i=new sq(n);try{return i.parseSync(t,e==null?void 0:e.draco)}finally{i.destroy()}}function _q(t){const e={};for(const n in t){const i=t[n];if(n!=="indices"){const r=AL(i);e[n]=r}}return e}function AL(t){const{buffer:e,size:n,count:i}=yq(t);return{value:e,size:n,byteOffset:0,count:i,type:yL(n),componentType:vL(e)}}function yq(t){let e=t,n=1,i=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=vq(e,Float32Array)),i=e.length/n),{buffer:e,size:n,count:i}}function vq(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return t?Array.isArray(t)?new e(t):n&&!(t instanceof e)?new e(t):t:null}const Zc="KHR_draco_mesh_compression",xq=Zc;function bq(t,e,n){const i=new hs(t);for(const r of EL(i))i.getObjectExtension(r,Zc)}async function wq(t,e,n){var i;if(!(e!=null&&(i=e.gltf)!==null&&i!==void 0&&i.decompressMeshes))return;const r=new hs(t),a=[];for(const h of EL(r))r.getObjectExtension(h,Zc)&&a.push(Eq(r,h,e,n));await Promise.all(a),r.removeExtension(Zc)}function Aq(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new hs(t);for(const i of n.json.meshes||[])Tq(i,e),n.addRequiredExtension(Zc)}async function Eq(t,e,n,i){const r=t.getObjectExtension(e,Zc);if(!r)return;const a=t.getTypedArrayForBufferView(r.bufferView),h=cb(a.buffer,a.byteOffset),{parse:l}=i,_={...n};delete _["3d-tiles"];const v=await l(h,wL,_,i),S=_q(v.attributes);for(const[I,B]of Object.entries(S))if(I in e.attributes){const z=e.attributes[I],V=t.getAccessor(z);V!=null&&V.min&&V!==null&&V!==void 0&&V.max&&(B.min=V.min,B.max=V.max)}e.attributes=S,v.indices&&(e.indices=AL(v.indices)),Sq(e)}function Tq(t,e){var n;let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const h=r.DracoWriter.encodeSync({attributes:t}),l=a==null||(n=a.parseSync)===null||n===void 0?void 0:n.call(a,{attributes:t}),_=r._addFauxAttributes(l.attributes),v=r.addBufferView(h);return{primitives:[{attributes:_,mode:i,extensions:{[Zc]:{bufferView:v,attributes:_}}}]}}function Sq(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*EL(t){for(const e of t.json.meshes||[])for(const n of e.primitives)yield n}const Cq=Object.freeze(Object.defineProperty({__proto__:null,decode:wq,encode:Aq,name:xq,preprocess:bq},Symbol.toStringTag,{value:"Module"})),Iq={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Pq={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},aw="KHR_texture_transform",Mq=aw,eg=new Te,Bq=new gi,Lq=new gi;async function Rq(t,e){if(!new hs(t).getExtension(aw))return;const r=t.json.materials||[];for(let a=0;a<r.length;a++)Dq(a,t)}function Dq(t,e){var n,i,r;const a=[],h=(n=e.json.materials)===null||n===void 0?void 0:n[t],l=h==null||(i=h.pbrMetallicRoughness)===null||i===void 0?void 0:i.baseColorTexture;l&&hf(e,t,l,a);const _=h==null?void 0:h.emissiveTexture;_&&hf(e,t,_,a);const v=h==null?void 0:h.normalTexture;v&&hf(e,t,v,a);const S=h==null?void 0:h.occlusionTexture;S&&hf(e,t,S,a);const I=h==null||(r=h.pbrMetallicRoughness)===null||r===void 0?void 0:r.metallicRoughnessTexture;I&&hf(e,t,I,a)}function hf(t,e,n,i){const r=Oq(n,i);if(!r)return;const a=t.json.meshes||[];for(const h of a)for(const l of h.primitives){const _=l.material;Number.isFinite(_)&&e===_&&Fq(t,l,r)}}function Oq(t,e){var n;const i=(n=t.extensions)===null||n===void 0?void 0:n[aw],{texCoord:r=0}=t,{texCoord:a=r}=i;if(!(e.findIndex(l=>{let[_,v]=l;return _===r&&v===a})!==-1)){const l=Nq(i);return r!==a&&(t.texCoord=a),e.push([r,a]),{originalTexCoord:r,texCoord:a,matrix:l}}return null}function Fq(t,e,n){const{originalTexCoord:i,texCoord:r,matrix:a}=n,h=e.attributes["TEXCOORD_".concat(i)];if(Number.isFinite(h)){var l;const v=(l=t.json.accessors)===null||l===void 0?void 0:l[h];if(v&&v.bufferView){var _;const S=(_=t.json.bufferViews)===null||_===void 0?void 0:_[v.bufferView];if(S){const{arrayBuffer:I,byteOffset:B}=t.buffers[S.buffer],z=(B||0)+(v.byteOffset||0)+(S.byteOffset||0),{ArrayType:V,length:J}=rw(v,S),ue=Pq[v.componentType],j=Iq[v.type],W=S.byteStride||ue*j,Z=new Float32Array(J);for(let ae=0;ae<v.count;ae++){const be=new V(I,z+ae*W,2);eg.set(be[0],be[1],1),eg.transformByMatrix3(a),Z.set([eg[0],eg[1]],ae*j)}i===r?kq(v,S,t.buffers,Z):zq(r,v,e,t,Z)}}}}function kq(t,e,n,i){t.componentType=5126,n.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),e.buffer=n.length-1,e.byteLength=i.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function zq(t,e,n,i,r){i.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const a=i.json.bufferViews;if(!a)return;a.push({buffer:i.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const h=i.json.accessors;h&&(h.push({bufferView:(a==null?void 0:a.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),n.attributes["TEXCOORD_".concat(t)]=h.length-1)}function Nq(t){const{offset:e=[0,0],rotation:n=0,scale:i=[1,1]}=t,r=new gi().set(1,0,0,0,1,0,e[0],e[1],1),a=Bq.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),h=Lq.set(i[0],0,0,0,i[1],0,0,0,1);return r.multiplyRight(a).multiplyRight(h)}const Uq=Object.freeze(Object.defineProperty({__proto__:null,decode:Rq,name:Mq},Symbol.toStringTag,{value:"Module"})),kc="KHR_lights_punctual",Gq=kc;async function Vq(t){const e=new hs(t),{json:n}=e,i=e.getExtension(kc);i&&(e.json.lights=i.lights,e.removeExtension(kc));for(const r of n.nodes||[]){const a=e.getObjectExtension(r,kc);a&&(r.light=a.light),e.removeObjectExtension(r,kc)}}async function jq(t){const e=new hs(t),{json:n}=e;if(n.lights){const i=e.addExtension(kc);Ms(!i.lights),i.lights=n.lights,delete n.lights}if(e.json.lights){for(const i of e.json.lights){const r=i.node;e.addObjectExtension(r,kc,i)}delete e.json.lights}}const Hq=Object.freeze(Object.defineProperty({__proto__:null,decode:Vq,encode:jq,name:Gq},Symbol.toStringTag,{value:"Module"})),op="KHR_materials_unlit",Wq=op;async function qq(t){const e=new hs(t),{json:n}=e;for(const i of n.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,op);e.removeExtension(op)}function Xq(t){const e=new hs(t),{json:n}=e;if(e.materials)for(const i of n.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,op,{}),e.addExtension(op))}const $q=Object.freeze(Object.defineProperty({__proto__:null,decode:qq,encode:Xq,name:Wq},Symbol.toStringTag,{value:"Module"})),bf="KHR_techniques_webgl",Zq=bf;async function Jq(t){const e=new hs(t),{json:n}=e,i=e.getExtension(bf);if(i){const r=Yq(i,e);for(const a of n.materials||[]){const h=e.getObjectExtension(a,bf);h&&(a.technique=Object.assign({},h,r[h.technique]),a.technique.values=Qq(a.technique,e)),e.removeObjectExtension(a,bf)}e.removeExtension(bf)}}async function Kq(t,e){}function Yq(t,e){const{programs:n=[],shaders:i=[],techniques:r=[]}=t,a=new TextDecoder;return i.forEach(h=>{if(Number.isFinite(h.bufferView))h.code=a.decode(e.getTypedArrayForBufferView(h.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(h=>{h.fragmentShader=i[h.fragmentShader],h.vertexShader=i[h.vertexShader]}),r.forEach(h=>{h.program=n[h.program]}),r}function Qq(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(i=>{t.uniforms[i].value&&!(i in n)&&(n[i]=t.uniforms[i].value)}),Object.keys(n).forEach(i=>{typeof n[i]=="object"&&n[i].index!==void 0&&(n[i].texture=e.getTexture(n[i].index))}),n}const eX=Object.freeze(Object.defineProperty({__proto__:null,decode:Jq,encode:Kq,name:Zq},Symbol.toStringTag,{value:"Module"})),TL="EXT_feature_metadata",tX=TL;async function nX(t){const e=new hs(t);iX(e)}function iX(t){var e;const n=t.getExtension(TL),i=n==null||(e=n.schema)===null||e===void 0?void 0:e.classes,r=n==null?void 0:n.featureTables;if((n==null?void 0:n.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),i&&r)for(const h in i){const l=i[h],_=oX(r,h);_&&rX(t,_,l)}}function rX(t,e,n){for(const r in n.properties){var i;const a=n.properties[r],h=e==null||(i=e.properties)===null||i===void 0?void 0:i[r],l=e.count;if(h){const _=sX(t,a,l,h);h.data=_}}}function sX(t,e,n,i){const r=i.bufferView;let a=t.getTypedArrayForBufferView(r);switch(e.type){case"STRING":{const h=i.stringOffsetBufferView,l=t.getTypedArrayForBufferView(h);a=aX(a,l,n);break}}return a}function oX(t,e){for(const n in t){const i=t[n];if(i.class===e)return i}return null}function aX(t,e,n){const i=[],r=new TextDecoder("utf8");let a=0;const h=4;for(let l=0;l<n;l++){const _=e[(l+1)*h]-e[l*h],v=t.subarray(a,_+a),S=r.decode(v);i.push(S),a+=_}return i}const lX=Object.freeze(Object.defineProperty({__proto__:null,decode:nX,name:tX},Symbol.toStringTag,{value:"Module"})),SL=[WW,$W,KW,Cq,Hq,$q,eX,Uq,lX];function cX(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const i=SL.filter(a=>CL(a.name,e));for(const a of i){var r;(r=a.preprocess)===null||r===void 0||r.call(a,t,e,n)}}async function uX(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const i=SL.filter(a=>CL(a.name,e));for(const a of i){var r;await((r=a.decode)===null||r===void 0?void 0:r.call(a,t,e,n))}}function CL(t,e){var n;const i=(e==null||(n=e.gltf)===null||n===void 0?void 0:n.excludeExtensions)||{};return!(t in i&&!i[t])}const gv="KHR_binary_glTF";function hX(t){const e=new hs(t),{json:n}=e;for(const i of n.images||[]){const r=e.getObjectExtension(i,gv);r&&Object.assign(i,r),e.removeObjectExtension(i,gv)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(gv)}const ZC={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},dX={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class fX{constructor(){R(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),R(this,"json",void 0)}normalize(e,n){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(i.asset.version));return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),hX(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const n in ZC)this._convertTopLevelObjectToArray(e,n)}_convertTopLevelObjectToArray(e,n){const i=e[n];if(!(!i||Array.isArray(i))){e[n]=[];for(const r in i){const a=i[r];a.id=a.id||r;const h=e[n].length;e[n].push(a),this.idToIndexMap[n][r]=h}}}_convertObjectIdsToArrayIndices(e){for(const n in ZC)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const n of e.textures)this._convertTextureIds(n);for(const n of e.meshes)this._convertMeshIds(n);for(const n of e.nodes)this._convertNodeIds(n);for(const n of e.scenes)this._convertSceneIds(n)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const n of e.primitives){const{attributes:i,indices:r,material:a}=n;for(const h in i)i[h]=this._convertIdToIndex(i[h],"accessor");r&&(n.indices=this._convertIdToIndex(r,"accessor")),a&&(n.material=this._convertIdToIndex(a,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(n=>this._convertIdToIndex(n,"node"))),e.meshes&&(e.meshes=e.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(e,n){e[n]||(console.warn("gltf v1: json doesn't contain attribute ".concat(n)),e[n]=[]);for(const i of e[n])for(const r in i){const a=i[r],h=this._convertIdToIndex(a,r);i[r]=h}}_convertIdToIndex(e,n){const i=dX[n];if(i in this.idToIndexMap){const r=this.idToIndexMap[i][e];if(!Number.isFinite(r))throw new Error("gltf v1: failed to resolve ".concat(n," with id ").concat(e));return r}return e}_updateObjects(e){for(const n of this.json.buffers)delete n.type}_updateMaterial(e){for(const a of e.materials){var n,i,r;a.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const h=((n=a.values)===null||n===void 0?void 0:n.tex)||((i=a.values)===null||i===void 0?void 0:i.texture2d_0)||((r=a.values)===null||r===void 0?void 0:r.diffuseTex),l=e.textures.findIndex(_=>_.id===h);l!==-1&&(a.pbrMetallicRoughness.baseColorTexture={index:l})}}}function pX(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new fX().normalize(t,e)}const mX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gX={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Zs={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},_X={magFilter:Zs.TEXTURE_MAG_FILTER,minFilter:Zs.TEXTURE_MIN_FILTER,wrapS:Zs.TEXTURE_WRAP_S,wrapT:Zs.TEXTURE_WRAP_T},yX={[Zs.TEXTURE_MAG_FILTER]:Zs.LINEAR,[Zs.TEXTURE_MIN_FILTER]:Zs.NEAREST_MIPMAP_LINEAR,[Zs.TEXTURE_WRAP_S]:Zs.REPEAT,[Zs.TEXTURE_WRAP_T]:Zs.REPEAT};function vX(t){return gX[t]}function xX(t){return mX[t]}class bX{constructor(){R(this,"baseUri",""),R(this,"json",{}),R(this,"buffers",[]),R(this,"images",[])}postProcess(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:i,buffers:r=[],images:a=[],baseUri:h=""}=e;return Ms(i),this.baseUri=h,this.json=i,this.buffers=r,this.images=a,this._resolveTree(this.json,n),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map((n,i)=>this._resolveBufferView(n,i))),e.images&&(e.images=e.images.map((n,i)=>this._resolveImage(n,i))),e.samplers&&(e.samplers=e.samplers.map((n,i)=>this._resolveSampler(n,i))),e.textures&&(e.textures=e.textures.map((n,i)=>this._resolveTexture(n,i))),e.accessors&&(e.accessors=e.accessors.map((n,i)=>this._resolveAccessor(n,i))),e.materials&&(e.materials=e.materials.map((n,i)=>this._resolveMaterial(n,i))),e.meshes&&(e.meshes=e.meshes.map((n,i)=>this._resolveMesh(n,i))),e.nodes&&(e.nodes=e.nodes.map((n,i)=>this._resolveNode(n,i))),e.skins&&(e.skins=e.skins.map((n,i)=>this._resolveSkin(n,i))),e.scenes&&(e.scenes=e.scenes.map((n,i)=>this._resolveScene(n,i))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,n){if(typeof n=="object")return n;const i=this.json[e]&&this.json[e][n];return i||console.warn("glTF file error: Could not find ".concat(e,"[").concat(n,"]")),i}_resolveScene(e,n){return e.id=e.id||"scene-".concat(n),e.nodes=(e.nodes||[]).map(i=>this.getNode(i)),e}_resolveNode(e,n){return e.id=e.id||"node-".concat(n),e.children&&(e.children=e.children.map(i=>this.getNode(i))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((i,r)=>{const a=this.getMesh(r);return i.id=a.id,i.primitives=i.primitives.concat(a.primitives),i},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,n){return e.id=e.id||"skin-".concat(n),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,n){return e.id=e.id||"mesh-".concat(n),e.primitives&&(e.primitives=e.primitives.map(i=>{i={...i};const r=i.attributes;i.attributes={};for(const a in r)i.attributes[a]=this.getAccessor(r[a]);return i.indices!==void 0&&(i.indices=this.getAccessor(i.indices)),i.material!==void 0&&(i.material=this.getMaterial(i.material)),i})),e}_resolveMaterial(e,n){if(e.id=e.id||"material-".concat(n),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const i=e.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,n){if(e.id=e.id||"accessor-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=vX(e.componentType),e.components=xX(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const i=e.bufferView.buffer,{ArrayType:r,byteLength:a}=rw(e,e.bufferView),h=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+i.byteOffset;let l=i.arrayBuffer.slice(h,h+a);e.bufferView.byteStride&&(l=this._getValueFromInterleavedBuffer(i,h,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new r(l)}return e}_getValueFromInterleavedBuffer(e,n,i,r,a){const h=new Uint8Array(a*r);for(let l=0;l<a;l++){const _=n+l*i;h.set(new Uint8Array(e.arrayBuffer.slice(_,_+r)),l*r)}return h.buffer}_resolveTexture(e,n){return e.id=e.id||"texture-".concat(n),e.sampler="sampler"in e?this.getSampler(e.sampler):yX,e.source=this.getImage(e.source),e}_resolveSampler(e,n){e.id=e.id||"sampler-".concat(n),e.parameters={};for(const i in e){const r=this._enumSamplerParameter(i);r!==void 0&&(e.parameters[r]=e[i])}return e}_enumSamplerParameter(e){return _X[e]}_resolveImage(e,n){e.id=e.id||"image-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const i=this.images[n];return i&&(e.image=i),e}_resolveBufferView(e,n){const i=e.buffer,r={id:"bufferView-".concat(n),...e,buffer:this.buffers[i]},a=this.buffers[i].arrayBuffer;let h=this.buffers[i].byteOffset||0;return"byteOffset"in e&&(h+=e.byteOffset),r.data=new Uint8Array(a,h,e.byteLength),r}_resolveCamera(e,n){return e.id=e.id||"camera-".concat(n),e.perspective,e.orthographic,e}}function wX(t,e){return new bX().postProcess(t,e)}const JC=1735152710,lw=12,m_=8,AX=1313821514,EX=5130562,TX=0,SX=1,CX=0,qh=!0;function IX(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}function PX(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=new DataView(t),{magic:r=JC}=n,a=i.getUint32(e,!1);return a===r||a===JC}function MX(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=new DataView(e),r=IX(i,n+0),a=i.getUint32(n+4,qh),h=i.getUint32(n+8,qh);switch(Object.assign(t,{header:{byteOffset:n,byteLength:h,hasBinChunk:!1},type:r,version:a,json:{},binChunks:[]}),n+=lw,t.version){case 1:return BX(t,i,n);case 2:return LX(t,i,n,{});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}function BX(t,e,n){Bn(t.header.byteLength>lw+m_);const i=e.getUint32(n+0,qh),r=e.getUint32(n+4,qh);return n+=m_,Bn(r===CX),ix(t,e,n,i),n+=i,n+=rx(t,e,n,t.header.byteLength),n}function LX(t,e,n,i){return Bn(t.header.byteLength>lw+m_),RX(t,e,n,i),n+t.header.byteLength}function RX(t,e,n,i){for(;n+8<=t.header.byteLength;){const r=e.getUint32(n+0,qh),a=e.getUint32(n+4,qh);switch(n+=m_,a){case AX:ix(t,e,n,r);break;case EX:rx(t,e,n,r);break;case TX:i.strict||ix(t,e,n,r);break;case SX:i.strict||rx(t,e,n,r);break}n+=pp(r,4)}return n}function ix(t,e,n,i){const r=new Uint8Array(e.buffer,n,i),h=new TextDecoder("utf8").decode(r);return t.json=JSON.parse(h),pp(i,4)}function rx(t,e,n,i){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:i,arrayBuffer:e.buffer}),pp(i,4)}async function DX(t,e){var n,i,r,a;let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,l=arguments.length>3?arguments[3]:void 0,_=arguments.length>4?arguments[4]:void 0;OX(t,e,h,l),pX(t,{normalize:l==null||(n=l.gltf)===null||n===void 0?void 0:n.normalize}),cX(t,l,_);const v=[];if(l!=null&&(i=l.gltf)!==null&&i!==void 0&&i.loadBuffers&&t.json.buffers&&await FX(t,l,_),l!=null&&(r=l.gltf)!==null&&r!==void 0&&r.loadImages){const I=kX(t,l,_);v.push(I)}const S=uX(t,l,_);return v.push(S),await Promise.all(v),l!=null&&(a=l.gltf)!==null&&a!==void 0&&a.postProcess?wX(t,l):t}function OX(t,e,n,i){if(i.uri&&(t.baseUri=i.uri),e instanceof ArrayBuffer&&!PX(e,n,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=bk(e);else if(e instanceof ArrayBuffer){const h={};n=MX(h,e,n,i.glb),Ms(h.type==="glTF","Invalid GLB magic string ".concat(h.type)),t._glb=h,t.json=h.json}else Ms(!1,"GLTF: must be ArrayBuffer or string");const r=t.json.buffers||[];if(t.buffers=new Array(r.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:h}=t._glb;t.buffers[0]={arrayBuffer:h[0].arrayBuffer,byteOffset:h[0].byteOffset,byteLength:h[0].byteLength}}const a=t.json.images||[];t.images=new Array(a.length).fill({})}async function FX(t,e,n){const i=t.json.buffers||[];for(let h=0;h<i.length;++h){const l=i[h];if(l.uri){var r,a;const{fetch:_}=n;Ms(_);const v=_L(l.uri,e),S=await(n==null||(r=n.fetch)===null||r===void 0?void 0:r.call(n,v)),I=await(S==null||(a=S.arrayBuffer)===null||a===void 0?void 0:a.call(S));t.buffers[h]={arrayBuffer:I,byteOffset:0,byteLength:I.byteLength},delete l.uri}else t.buffers[h]===null&&(t.buffers[h]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function kX(t,e,n){const i=zX(t),r=t.json.images||[],a=[];for(const h of i)a.push(NX(t,r[h],h,e,n));return await Promise.all(a)}function zX(t){const e=new Set,n=t.json.textures||[];for(const i of n)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function NX(t,e,n,i,r){const{fetch:a,parse:h}=r;let l;if(e.uri&&!e.hasOwnProperty("bufferView")){const v=_L(e.uri,i);l=await(await a(v)).arrayBuffer(),e.bufferView={data:l}}if(Number.isFinite(e.bufferView)){const v=EW(t.json,t.buffers,e.bufferView);l=cb(v.buffer,v.byteOffset,v.byteLength)}Ms(l,"glTF image has no data");let _=await h(l,[vM,AW],{mimeType:e.mimeType,basis:i.basis||{format:gL()}},r);_&&_[0]&&(_={compressed:!0,mipmaps:!1,width:_[0].width,height:_[0].height,data:_[0]}),t.images=t.images||[],t.images[n]=_}const ap={name:"glTF",id:"gltf",module:"gltf",version:oW,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:UX,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function UX(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;e={...ap.options,...e},e.gltf={...ap.options.gltf,...e.gltf};const{byteOffset:i=0}=e;return await DX({},t,i,e,n)}async function GX(t){const e=[];return t.scenes.forEach(n=>{n.traverse(i=>{Object.values(i.model.getUniforms()).forEach(r=>{r.loaded===!1&&e.push(r)})})}),await VX(()=>e.some(n=>!n.loaded))}async function VX(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const jX=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,HX=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,IL=[255,255,255,255],WX={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:IL},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[ap]};class cw extends Zl{constructor(...e){super(...e),R(this,"state",void 0)}getShaders(){const e=[N_,U_];return this.props._lighting==="pbr"&&e.push(Nb),super.getShaders({vs:jX,fs:HX,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:IL,transition:!0},instanceModelMatrix:sL})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;n.scenegraph!==i.scenegraph?this._updateScenegraph():n._animations!==i._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,n._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}_updateScenegraph(){const e=this.props,{gl:n}=this.context;let i=null;if(e.scenegraph instanceof Ch)i={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const l=e.scenegraph,_=sW(n,l,this._getModelOptions());i={gltf:l,..._},GX(_).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(ln.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),i=e.scenegraph);const r={layer:this,gl:n},a=e.getScene(i,r),h=e.getAnimator(i,r);a instanceof Ch?(this._deleteScenegraph(),this._applyAllAttributes(a),this._applyAnimationsProp(a,h,e._animations),this.setState({scenegraph:a,animator:h})):a!==null&&ln.warn("invalid scenegraph:",a)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const n=this.getAttributeManager().getAttributes();e.traverse(i=>{this._setModelAttributes(i.model,n)})}}_applyAnimationsProp(e,n,i){if(!e||!n||!i)return;const r=n.getAnimations();Object.keys(i).sort().forEach(a=>{const h=i[a];if(a==="*")r.forEach(l=>{Object.assign(l,h)});else if(Number.isFinite(Number(a))){const l=Number(a);l>=0&&l<r.length?Object.assign(r[l],h):ln.warn("animation ".concat(a," not found"))()}else{const l=r.find(({name:_})=>_===a);l?Object.assign(l,h):ln.warn("animation ".concat(a," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof Ch&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let n=null;return e&&(typeof e=="function"?n=e({gl:this.context.gl,layer:this}):n=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:n,modelOptions:{isInstanced:!0,transpileToGLSL100:!Xt(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(n=>{this._setModelAttributes(n.model,e)})}draw({moduleParameters:e=null,parameters:n={},context:i}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(i.timeline.getTime()),this.setNeedsRedraw());const{viewport:r}=this.context,{sizeScale:a,sizeMinPixels:h,sizeMaxPixels:l,opacity:_,coordinateSystem:v}=this.props,S=this.getNumInstances();this.state.scenegraph.traverse((I,{worldMatrix:B})=>{I.model.setInstanceCount(S),I.updateModuleSettings(e),I.draw({parameters:n,uniforms:{sizeScale:a,opacity:_,sizeMinPixels:h,sizeMaxPixels:l,composeModelMatrix:oL(r,v),sceneModelMatrix:B,u_Camera:I.model.getUniforms().project_uCameraPosition}})})}}R(cw,"defaultProps",WX);R(cw,"layerName","ScenegraphLayer");const qX=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,XX=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function $X(t){t.COLOR_0||t.colors||(t.colors={constant:!0,value:new Float32Array([1,1,1])})}const ZX={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class uw extends iw{getShaders(){const e=super.getShaders();return e.modules.push(Nb),{...e,vs:qX,fs:XX}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const n=this.getAttributeManager();e&&n.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;n.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(n.pbrMaterial)}draw(e){const{featureIds:n}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!n}),super.draw(e))}getModel(e){const{id:n,pbrMaterial:i}=this.props,r=this.parseMaterial(i,e);this.setState({materialParser:r});const a=this.getShaders();return $X(e.attributes),new Xc(this.context.gl,{...this.getShaders(),id:n,geometry:e,defines:{...a.defines,...r==null?void 0:r.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:r==null?void 0:r.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:n}=this.state;if(n){const{mesh:i}=this.props,r=this.parseMaterial(e,i);this.setState({materialParser:r}),n.setUniforms(r.uniforms)}}parseMaterial(e,n){var i;const r=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(i=this.state.materialParser)===null||i===void 0||i.delete(),new fL(this.context.gl,{attributes:{NORMAL:n.attributes.normals,TEXCOORD_0:n.attributes.texCoords},material:{unlit:r,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const n=this.props.featureIds,i=new Uint8ClampedArray(n.length*e.size),r=[];for(let a=0;a<n.length;a++)this.encodePickingColor(n[a],r),i[a*3]=r[0],i[a*3+1]=r[1],i[a*3+2]=r[2];e.value=i}finalizeState(e){var n;super.finalizeState(e),(n=this.state.materialParser)===null||n===void 0||n.delete(),this.setState({materialParser:null})}}R(uw,"layerName","MeshLayer");R(uw,"defaultProps",ZX);const JX=6378137,KX=6378137,YX=6356752314245179e-9;function H_(t){return t}new Te;function QX(t,e=[],n=H_){return"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):"x"in t?(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function e$(t,e=[]){return QX(t,e,Ui._cartographicRadians?H_:LG)}function t$(t,e,n=H_){return"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):"x"in e?(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function n$(t,e){return t$(t,e,Ui._cartographicRadians?H_:RG)}const Yu=new Te,i$=new Te,r$=new Te;function s$(t,e,n=[]){const{oneOverRadii:i,oneOverRadiiSquared:r,centerToleranceSquared:a}=e;Yu.from(t);const h=Yu.x,l=Yu.y,_=Yu.z,v=i.x,S=i.y,I=i.z,B=h*h*v*v,z=l*l*S*S,V=_*_*I*I,J=B+z+V,ue=Math.sqrt(1/J);if(!Number.isFinite(ue))return;const j=i$;if(j.copy(t).scale(ue),J<a)return j.to(n);const W=r.x,Z=r.y,ae=r.z,be=r$;be.set(j.x*W*2,j.y*Z*2,j.z*ae*2);let Ee=(1-ue)*Yu.len()/(.5*be.len()),Le=0,ke,Ue,Me,ut;do{Ee-=Le,ke=1/(1+Ee*W),Ue=1/(1+Ee*Z),Me=1/(1+Ee*ae);const Lt=ke*ke,Ft=Ue*Ue,Rt=Me*Me,Jn=Lt*ke,ai=Ft*Ue,Bi=Rt*Me;ut=B*Lt+z*Ft+V*Rt-1;const At=-2*(B*Jn*W+z*ai*Z+V*Bi*ae);Le=ut/At}while(Math.abs(ut)>sp.EPSILON12);return Yu.scale([ke,Ue,Me]).to(n)}const KC=1e-14,o$=new Te,YC={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},_v={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},df={east:new Te,north:new Te,up:new Te,west:new Te,south:new Te,down:new Te},a$=new Te,l$=new Te,c$=new Te;function QC(t,e,n,i,r,a){const h=YC[e]&&YC[e][n];Po(h&&(!i||i===h));let l,_,v;const S=o$.copy(r);if(Oo(S.x,0,KC)&&Oo(S.y,0,KC)){const B=Math.sign(S.z);l=a$.fromArray(_v[e]),e!=="east"&&e!=="west"&&l.scale(B),_=l$.fromArray(_v[n]),n!=="east"&&n!=="west"&&_.scale(B),v=c$.fromArray(_v[i]),i!=="east"&&i!=="west"&&v.scale(B)}else{const{up:B,east:z,north:V}=df;z.set(-S.y,S.x,0).normalize(),t.geodeticSurfaceNormal(S,B),V.copy(B).cross(z);const{down:J,west:ue,south:j}=df;J.copy(B).scale(-1),ue.copy(z).scale(-1),j.copy(V).scale(-1),l=df[e],_=df[n],v=df[i]}return a[0]=l.x,a[1]=l.y,a[2]=l.z,a[3]=0,a[4]=_.x,a[5]=_.y,a[6]=_.z,a[7]=0,a[8]=v.x,a[9]=v.y,a[10]=v.z,a[11]=0,a[12]=S.x,a[13]=S.y,a[14]=S.z,a[15]=1,a}const tg=new Te,e2=new Te,u$=new Te,Eo=new Te,h$=new Te,ng=new Te;class ri{constructor(e=0,n=0,i=0){R(this,"radii",void 0),R(this,"radiiSquared",void 0),R(this,"radiiToTheFourth",void 0),R(this,"oneOverRadii",void 0),R(this,"oneOverRadiiSquared",void 0),R(this,"minimumRadius",void 0),R(this,"maximumRadius",void 0),R(this,"centerToleranceSquared",sp.EPSILON1),R(this,"squaredXOverSquaredZ",void 0),Po(e>=0),Po(n>=0),Po(i>=0),this.radii=new Te(e,n,i),this.radiiSquared=new Te(e*e,n*n,i*i),this.radiiToTheFourth=new Te(e*e*e*e,n*n*n*n,i*i*i*i),this.oneOverRadii=new Te(e===0?0:1/e,n===0?0:1/n,i===0?0:1/i),this.oneOverRadiiSquared=new Te(e===0?0:1/(e*e),n===0?0:1/(n*n),i===0?0:1/(i*i)),this.minimumRadius=Math.min(e,n,i),this.maximumRadius=Math.max(e,n,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,n=[0,0,0]){const i=e2,r=u$,[,,a]=e;this.geodeticSurfaceNormalCartographic(e,i),r.copy(this.radiiSquared).scale(i);const h=Math.sqrt(i.dot(r));return r.scale(1/h),i.scale(a),r.add(i),r.to(n)}cartesianToCartographic(e,n=[0,0,0]){ng.from(e);const i=this.scaleToGeodeticSurface(ng,Eo);if(!i)return;const r=this.geodeticSurfaceNormal(i,e2),a=h$;a.copy(ng).subtract(i);const h=Math.atan2(r.y,r.x),l=Math.asin(r.z),_=Math.sign(Db(a,ng))*sB(a);return n$([h,l,_],n)}eastNorthUpToFixedFrame(e,n=new Qt){return QC(this,"east","north","up",e,n)}localFrameToFixedFrame(e,n,i,r,a=new Qt){return QC(this,e,n,i,r,a)}geocentricSurfaceNormal(e,n=[0,0,0]){return tg.from(e).normalize().to(n)}geodeticSurfaceNormalCartographic(e,n=[0,0,0]){const i=e$(e),r=i[0],a=i[1],h=Math.cos(a);return tg.set(h*Math.cos(r),h*Math.sin(r),Math.sin(a)).normalize(),tg.to(n)}geodeticSurfaceNormal(e,n=[0,0,0]){return tg.from(e).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(e,n){return s$(e,this,n)}scaleToGeocentricSurface(e,n=[0,0,0]){Eo.from(e);const i=Eo.x,r=Eo.y,a=Eo.z,h=this.oneOverRadiiSquared,l=1/Math.sqrt(i*i*h.x+r*r*h.y+a*a*h.z);return Eo.multiplyScalar(l).to(n)}transformPositionToScaledSpace(e,n=[0,0,0]){return Eo.from(e).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(e,n=[0,0,0]){return Eo.from(e).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(e,n=0,i=[0,0,0]){Po(Oo(this.radii.x,this.radii.y,sp.EPSILON15)),Po(this.radii.z>0),Eo.from(e);const r=Eo.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-n))return Eo.set(0,0,r).to(i)}}R(ri,"WGS84",new ri(JX,KX,YX));function t2(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class n2{constructor(e,n){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=t2(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(t2()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class d${constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:i}=e;let r=this.stats[n];return r||(e instanceof n2?r=e:r=new n2(n,i),this.stats[n]=r),r}}class f${constructor(e,n,i){R(this,"item",void 0),R(this,"previous",void 0),R(this,"next",void 0),this.item=e,this.previous=n,this.next=i}}class p${constructor(){R(this,"head",null),R(this,"tail",null),R(this,"_length",0)}get length(){return this._length}add(e){const n=new f$(e,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,n){e!==n&&(this.remove(n),this._insert(e,n))}_insert(e,n){const i=e.next;e.next=n,this.tail===e?this.tail=n:i.previous=n,n.next=i,n.previous=e,++this._length}}class m${constructor(){R(this,"_list",void 0),R(this,"_sentinel",void 0),R(this,"_trimTiles",void 0),this._list=new p$,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const n=e._cacheNode;n&&this._list.splice(this._sentinel,n)}add(e,n,i){n._cacheNode||(n._cacheNode=this._list.add(n),i&&i(e,n))}unloadTile(e,n,i){const r=n._cacheNode;r&&(this._list.remove(r),n._cacheNode=null,i&&i(e,n))}unloadTiles(e,n){const i=this._trimTiles;this._trimTiles=!1;const r=this._list,a=e.maximumMemoryUsage*1024*1024,h=this._sentinel;let l=r.head;for(;l!==h&&(e.gpuMemoryUsageInBytes>a||i);){const _=l.item;l=l.next,this.unloadTile(e,_,n)}}trim(){this._trimTiles=!0}}function g$(t,e){Bn(t),Bn(e);const{rtcCenter:n,gltfUpAxis:i}=e,{computedTransform:r,boundingVolume:{center:a}}=t;let h=new Qt(r);switch(n&&h.translate(n),i){case"Z":break;case"Y":const I=new Qt().rotateX(Math.PI/2);h=h.multiplyRight(I);break;case"X":const B=new Qt().rotateY(-Math.PI/2);h=h.multiplyRight(B);break}e.isQuantized&&h.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const l=new Te(a);e.cartesianModelMatrix=h,e.cartesianOrigin=l;const _=ri.WGS84.cartesianToCartographic(l,new Te),S=ri.WGS84.eastNorthUpToFixedFrame(l).invert();e.cartographicModelMatrix=S.multiplyRight(h),e.cartographicOrigin=_,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const i2=new Te,yv=new Te,sx=new to([new Io,new Io,new Io,new Io,new Io,new Io]);function _$(t,e){const{cameraDirection:n,cameraUp:i,height:r}=t,{metersPerUnit:a}=t.distanceScales,h=Tg(t,t.center),l=ri.WGS84.eastNorthUpToFixedFrame(h),_=t.unprojectPosition(t.cameraPosition),v=ri.WGS84.cartographicToCartesian(_,new Te),S=new Te(l.transformAsVector(new Te(n).scale(a))).normalize(),I=new Te(l.transformAsVector(new Te(i).scale(a))).normalize();v$(t);const B=t.constructor,{longitude:z,latitude:V,width:J,bearing:ue,zoom:j}=t,W=new B({longitude:z,latitude:V,height:r,width:J,bearing:ue,zoom:j,pitch:0});return{camera:{position:v,direction:S,up:I},viewport:t,topDownViewport:W,height:r,cullingVolume:sx,frameNumber:e,sseDenominator:1.15}}function y$(t,e,n){if(n===0||t.length<=n)return[t,[]];const i=[],{longitude:r,latitude:a}=e.viewport;for(const[v,S]of t.entries()){const[I,B]=S.header.mbs,z=Math.abs(r-I),V=Math.abs(a-B),J=Math.sqrt(V*V+z*z);i.push([v,J])}const h=i.sort((v,S)=>v[1]-S[1]),l=[];for(let v=0;v<n;v++)l.push(t[h[v][0]]);const _=[];for(let v=n;v<h.length;v++)_.push(t[h[v][0]]);return[l,_]}function v$(t){const e=t.getFrustumPlanes(),n=r2(e.near,t.cameraPosition),i=Tg(t,n),r=Tg(t,t.cameraPosition,yv);let a=0;sx.planes[a++].fromPointNormal(i,i2.copy(i).subtract(r));for(const h in e){if(h==="near")continue;const l=e[h],_=r2(l,n,yv),v=Tg(t,_,yv);sx.planes[a++].fromPointNormal(v,i2.copy(i).subtract(v))}}function r2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Te;const i=t.normal.dot(e);return n.copy(t.normal).scale(t.distance-i).add(e),n}function Tg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Te;const i=t.unprojectPosition(e);return ri.WGS84.cartographicToCartesian(i,n)}const x$=6378137,b$=6378137,ox=6356752314245179e-9,s2=new Te;function w$(t,e){if(t instanceof Sp){const{halfAxes:n}=t,i=E$(n);return Math.log2(ox/(i+e[2]))}else if(t instanceof Tp){const{radius:n}=t;return Math.log2(ox/(n+e[2]))}else if(t.width&&t.height){const{width:n,height:i}=t,r=Math.log2(x$/n),a=Math.log2(b$/i);return(r+a)/2}return 1}function PL(t,e,n){const i=ri.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],new Te),r=Math.sqrt(Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2)+Math.pow(i[2]-n[2],2));return Math.log2(ox/(r+e[2]))}function A$(t,e,n){const[i,r,a,h]=t;return PL({xmin:i,xmax:a,ymin:r,ymax:h,zmin:0,zmax:0},e,n)}function E$(t){t.getColumn(0,s2);const e=t.getColumn(1),n=t.getColumn(2);return s2.add(e).add(n).len()}const Ts={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Ga={ADD:1,REPLACE:2},Ih={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},$s={I3S:"I3S",TILES3D:"TILES3D"},W_={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},T$={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function ML(t){return t!=null}const Tr=new Te,Sg=new Te,S$=new Te,C$=new Te;function vv(t,e,n){if(Bn(t,"3D Tile: boundingVolume must be defined"),t.box)return P$(t.box,e,n);if(t.region){const[i,r,a,h,l,_]=t.region,v=ri.WGS84.cartographicToCartesian([Fa(i),Fa(h),l],S$),S=ri.WGS84.cartographicToCartesian([Fa(a),Fa(r),_],C$),I=new Te().addVectors(v,S).multiplyScalar(.5),B=new Te().subVectors(v,S).len()/2;return o2([I[0],I[1],I[2],B],new Qt)}if(t.sphere)return o2(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function I$(t,e){if(t.box)return M$(e);if(t.region){const[n,i,r,a,h,l]=t.region;return[[Fa(n),Fa(i),h],[Fa(r),Fa(a),l]]}if(t.sphere)return B$(e);throw new Error("Unkown boundingVolume type")}function P$(t,e,n){const i=new Te(t[0],t[1],t[2]);e.transform(i,i);let r=[];if(t.length===10){const v=t.slice(3,6),S=new rp;S.fromArray(t,6);const I=new Te([1,0,0]),B=new Te([0,1,0]),z=new Te([0,0,1]);I.transformByQuaternion(S),I.scale(v[0]),B.transformByQuaternion(S),B.scale(v[1]),z.transformByQuaternion(S),z.scale(v[2]),r=[...I.toArray(),...B.toArray(),...z.toArray()]}else r=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const a=e.transformAsVector(r.slice(0,3)),h=e.transformAsVector(r.slice(3,6)),l=e.transformAsVector(r.slice(6,9)),_=new gi([a[0],a[1],a[2],h[0],h[1],h[2],l[0],l[1],l[2]]);return ML(n)?(n.center=i,n.halfAxes=_,n):new Sp(i,_)}function o2(t,e,n){const i=new Te(t[0],t[1],t[2]);e.transform(i,i);const r=e.getScale(Sg),a=Math.max(Math.max(r[0],r[1]),r[2]),h=t[3]*a;return ML(n)?(n.center=i,n.radius=h,n):new Tp(i,h)}function M$(t){const e=BL(),{halfAxes:n}=t,i=new Te(n.getColumn(0)),r=new Te(n.getColumn(1)),a=new Te(n.getColumn(2));for(let h=0;h<2;h++){for(let l=0;l<2;l++){for(let _=0;_<2;_++)Tr.copy(t.center),Tr.add(i),Tr.add(r),Tr.add(a),LL(e,Tr),a.negate();r.negate()}i.negate()}return e}function B$(t){const e=BL(),{center:n,radius:i}=t,r=ri.WGS84.scaleToGeodeticSurface(n,Tr);let a;r?a=ri.WGS84.geodeticSurfaceNormal(r):a=new Te(0,0,1);let h=new Te(a[2],-a[1],0);h.len()>0?h.normalize():h=new Te(0,1,0);const l=h.clone().cross(a);for(const _ of[h,l,a]){Sg.copy(_).scale(i);for(let v=0;v<2;v++)Tr.copy(n),Tr.add(Sg),LL(e,Tr),Sg.negate()}return e}function BL(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function LL(t,e){ri.WGS84.cartesianToCartographic(e,Tr),t[0][0]=Math.min(t[0][0],Tr[0]),t[0][1]=Math.min(t[0][1],Tr[1]),t[0][2]=Math.min(t[0][2],Tr[2]),t[1][0]=Math.max(t[1][0],Tr[0]),t[1][1]=Math.max(t[1][1],Tr[1]),t[1][2]=Math.max(t[1][2],Tr[2])}new Te;new Te;new Qt;new Te;new Te;new Te;function L$(t,e){const n=t*e;return 1-Math.exp(-(n*n))}function R$(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const n=t.dynamicScreenSpaceErrorComputedDensity,i=t.dynamicScreenSpaceErrorFactor;return L$(e,n)*i}return 0}function D$(t,e,n){const i=t.tileset,r=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,a=n?r:t.lodMetricValue;if(a===0)return 0;const h=Math.max(t._distanceToCamera,1e-7),{height:l,sseDenominator:_}=e,{viewDistanceScale:v}=i.options;let S=a*l*(v||1)/(h*_);return S-=R$(i,h),S}const xv=new Te,a2=new Te,El=new Te,l2=new Te,O$=new Te,bv=new Qt,c2=new Qt;function F$(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const n=2*RL(t,e);return n<2?"OUT":!t.header.children||n<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function RL(t,e){const{topDownViewport:n}=e,i=t.header.mbs[1],r=t.header.mbs[0],a=t.header.mbs[2],h=t.header.mbs[3],l=[...t.boundingVolume.center],_=n.unprojectPosition(n.cameraPosition);ri.WGS84.cartographicToCartesian(_,xv),a2.copy(xv).subtract(l).normalize(),ri.WGS84.eastNorthUpToFixedFrame(l,bv),c2.copy(bv).invert(),El.copy(xv).transform(c2);const v=Math.sqrt(El[0]*El[0]+El[1]*El[1]),S=v*v/El[2];l2.copy([El[0],El[1],S]);const B=l2.transform(bv).subtract(l).normalize(),V=a2.cross(B).normalize().scale(h).add(l),J=ri.WGS84.cartesianToCartographic(V),ue=n.project([r,i,a]),j=n.project(J);return O$.copy(ue).subtract(j).magnitude()}function k$(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class u2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;R(this,"_map",new Map),R(this,"_array",void 0),R(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Bn(e<this._array.length),this._array[e]}set(e,n){Bn(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=n,this._map.set(n,e)}delete(e){const n=this._map.get(e);n>=0&&(this._array.splice(n,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const n=this.length++;this._array[n]=e,this._map.set(e,n)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Bn(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Bn(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const z$={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class q_{traversalFinished(e){return!0}constructor(e){R(this,"options",void 0),R(this,"root",null),R(this,"selectedTiles",{}),R(this,"requestedTiles",{}),R(this,"emptyTiles",{}),R(this,"lastUpdate",new Date().getTime()),R(this,"updateDebounceTime",1e3),R(this,"_traversalStack",new u2),R(this,"_emptyTraversalStack",new u2),R(this,"_frameNumber",null),this.options={...z$,...e}}traverse(e,n,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,n),this._frameNumber=n.frameNumber,this.executeTraversal(e,n)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,n){const i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){const a=i.pop();let h=!1;this.canTraverse(a,n)&&(this.updateChildTiles(a,n),h=this.updateAndPushChildren(a,n,i,a.hasRenderContent?a._selectionDepth+1:a._selectionDepth));const l=a.parent,_=!!(!l||l._shouldRefine),v=!h;a.hasRenderContent?a.refine===Ga.ADD?(this.loadTile(a,n),this.selectTile(a,n)):a.refine===Ga.REPLACE&&(this.loadTile(a,n),v&&this.selectTile(a,n)):(this.emptyTiles[a.id]=a,this.loadTile(a,n),v&&this.selectTile(a,n)),this.touchTile(a,n),a._shouldRefine=h&&_}const r=new Date().getTime();(this.traversalFinished(n)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(n))}updateChildTiles(e,n){const i=e.children;for(const r of i)this.updateTile(r,n)}updateAndPushChildren(e,n,i,r){const{loadSiblings:a,skipLevelOfDetail:h}=this.options,l=e.children;l.sort(this.compareDistanceToCamera.bind(this));const _=e.refine===Ga.REPLACE&&e.hasRenderContent&&!h;let v=!1,S=!0;for(const I of l)if(I._selectionDepth=r,I.isVisibleAndInRequestVolume?(i.find(I)&&i.delete(I),i.push(I),v=!0):(_||a)&&(this.loadTile(I,n),this.touchTile(I,n)),_){let B;if(I._inRequestVolume?I.hasRenderContent?B=I.contentAvailable:B=this.executeEmptyTraversal(I,n):B=!1,S=S&&B,!S)return!1}return v||(S=!1),S}updateTile(e,n){this.updateTileVisibility(e,n)}selectTile(e,n){this.shouldSelectTile(e)&&(e._selectedFrame=n.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,n){this.shouldLoadTile(e)&&(e._requestedFrame=n.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,n){e.tileset._cache.touch(e),e._touchedFrame=n.frameNumber}canTraverse(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!r&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,n,i):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=e._screenSpaceError;return i&&(r=e.getScreenSpaceError(n,!0)),r>this.options.maximumScreenSpaceError}updateTileVisibility(e,n){const i=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap)this.options.viewportTraversersMap[r]===n.viewport.id&&i.push(r);else i.push(n.viewport.id);e.updateVisibility(n,i)}compareDistanceToCamera(e,n){return e._distanceToCamera-n._distanceToCamera}anyChildrenVisible(e,n){let i=!1;for(const r of e.children)r.updateVisibility(n),i=i||r.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,n){let i=!0;const r=this._emptyTraversalStack;for(r.push(e);r.length>0&&i;){const a=r.pop();if(this.updateTile(a,n),a.isVisibleAndInRequestVolume||this.loadTile(a,n),this.touchTile(a,n),!a.hasRenderContent&&this.canTraverse(a,n,!1,!0)){const l=a.children;for(const _ of l)r.find(_)&&r.delete(_),r.push(_)}else!a.contentAvailable&&!a.hasEmptyContent&&(i=!1)}return i}}const h2=new Te;function N$(t){return t!=null}class ax{constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";R(this,"tileset",void 0),R(this,"header",void 0),R(this,"id",void 0),R(this,"url",void 0),R(this,"parent",void 0),R(this,"refine",void 0),R(this,"type",void 0),R(this,"contentUrl",void 0),R(this,"lodMetricType","geometricError"),R(this,"lodMetricValue",0),R(this,"boundingVolume",null),R(this,"content",null),R(this,"contentState",Ts.UNLOADED),R(this,"gpuMemoryUsageInBytes",0),R(this,"children",[]),R(this,"depth",0),R(this,"viewportIds",[]),R(this,"transform",new Qt),R(this,"extensions",null),R(this,"implicitTiling",null),R(this,"userData",{}),R(this,"computedTransform",void 0),R(this,"hasEmptyContent",!1),R(this,"hasTilesetContent",!1),R(this,"traverser",new q_({})),R(this,"_cacheNode",null),R(this,"_frameNumber",null),R(this,"_expireDate",null),R(this,"_expiredContent",null),R(this,"_boundingBox",void 0),R(this,"_distanceToCamera",0),R(this,"_screenSpaceError",0),R(this,"_visibilityPlaneMask",void 0),R(this,"_visible",void 0),R(this,"_contentBoundingVolume",void 0),R(this,"_viewerRequestVolume",void 0),R(this,"_initialTransform",new Qt),R(this,"_priority",0),R(this,"_selectedFrame",0),R(this,"_requestedFrame",0),R(this,"_selectionDepth",0),R(this,"_touchedFrame",0),R(this,"_centerZDepth",0),R(this,"_shouldRefine",!1),R(this,"_stackLength",0),R(this,"_visitedFrame",0),R(this,"_inRequestVolume",!1),R(this,"_lodJudge",null),this.header=n,this.tileset=e,this.id=r||n.id,this.url=n.url,this.parent=i,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Ts.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Ts.UNLOADED}get contentExpired(){return this.contentState===Ts.EXPIRED}get contentFailed(){return this.contentState===Ts.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=I$(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,n){switch(this.tileset.type){case $s.I3S:return RL(this,e);case $s.TILES3D:return D$(this,e,n);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:n}=e.options,i=this.refine===Ga.ADD||n;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Ts.UNLOADED)return-1;const r=this.parent,h=r&&(!i||this._screenSpaceError===0||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,l=e.root?e.root._screenSpaceError:0;return Math.max(l-h,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Ts.LOADING;const n=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!n)return this.contentState=Ts.UNLOADED,!1;try{const i=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,a={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await Hl(i,r,a),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Ts.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=Ts.FAILED,i}finally{n.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Ts.UNLOADED,!0}updateVisibility(e,n){if(this._frameNumber===e.frameNumber)return;const i=this.parent,r=i?i._visibilityPlaneMask:to.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const a=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(a)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==to.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=n}visibility(e,n){const{cullingVolume:i}=e,{boundingVolume:r}=this;return i.computeVisibilityWithPlaneMask(r,n)}contentVisibility(){return!0}distanceToTile(e){const n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:n}=e;const i=this.boundingVolume;return h2.subVectors(i.center,n.position),n.direction.dot(h2)}insideViewerRequestVolume(e){const n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(N$(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Ts.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Qt(e.transform):new Qt;const n=this.parent,i=this.tileset,r=n&&n.computedTransform?n.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new Qt(r).multiplyRight(this.transform);const a=n&&n._initialTransform?n._initialTransform.clone():new Qt;this._initialTransform=new Qt(a).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Ts.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=to.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Ga.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=vv(e.boundingVolume,this.computedTransform,this.boundingVolume);const n=e.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=vv(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=vv(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const n=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Qt).clone().multiplyRight(this.transform);n.equals(this.computedTransform)||(this.computedTransform=n,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return k$(this.tileset.tileset)}}}class U$ extends q_{compareDistanceToCamera(e,n){return n._distanceToCamera===0&&e._distanceToCamera===0?n._centerZDepth-e._centerZDepth:n._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,n){if(super.updateTileVisibility(e,n),!e.isVisibleAndInRequestVolume)return;const i=e.children.length>0;if(e.hasTilesetContent&&i){const h=e.children[0];this.updateTileVisibility(h,n),e._visible=h._visible;return}if(this.meetsScreenSpaceErrorEarly(e,n)){e._visible=!1;return}const r=e.refine===Ga.REPLACE,a=e._optimChildrenWithinParent===T$.USE_OPTIMIZATION;if(r&&a&&i&&!this.anyChildrenVisible(e,n)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,n){const{parent:i}=e;return!i||i.hasTilesetContent||i.refine!==Ga.ADD?!1:!this.shouldRefine(e,n,!0)}}class G${constructor(){R(this,"frameNumberMap",new Map)}register(e,n){const i=this.frameNumberMap.get(e)||new Map,r=i.get(n)||0;i.set(n,r+1),this.frameNumberMap.set(e,i)}deregister(e,n){const i=this.frameNumberMap.get(e);if(!i)return;const r=i.get(n)||1;i.set(n,r-1)}isZero(e,n){var i;return(((i=this.frameNumberMap.get(e))===null||i===void 0?void 0:i.get(n))||0)===0}}const wv={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class V${constructor(){R(this,"_statusMap",void 0),R(this,"pendingTilesRegister",new G$),this._statusMap={}}add(e,n,i,r){if(!this._statusMap[n]){const{frameNumber:a,viewport:{id:h}}=r;this._statusMap[n]={request:e,callback:i,key:n,frameState:r,status:wv.REQUESTED},this.pendingTilesRegister.register(h,a),e().then(l=>{this._statusMap[n].status=wv.COMPLETED;const{frameNumber:_,viewport:{id:v}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(v,_),this._statusMap[n].callback(l,r)}).catch(l=>{this._statusMap[n].status=wv.ERROR;const{frameNumber:_,viewport:{id:v}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(v,_),i(l)})}}update(e,n){if(this._statusMap[e]){const{frameNumber:i,viewport:{id:r}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(r,i);const{frameNumber:a,viewport:{id:h}}=n;this.pendingTilesRegister.register(h,a),this._statusMap[e].frameState=n}}find(e){return this._statusMap[e]}hasPendingTiles(e,n){return!this.pendingTilesRegister.isZero(e,n)}}class j$ extends q_{constructor(e){super(e),R(this,"_tileManager",void 0),this._tileManager=new V$}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,n){return e._lodJudge=F$(e,n),e._lodJudge==="DIG"}updateChildTiles(e,n){const i=e.header.children||[],r=e.children,a=e.tileset;for(const h of i){const l="".concat(h.id,"-").concat(n.viewport.id),_=r&&r.find(v=>v.id===l);if(_)_&&this.updateTile(_,n);else{let v=()=>this._loadTile(h.id,a);this._tileManager.find(l)?this._tileManager.update(l,n):(a.tileset.nodePages&&(v=()=>a.tileset.nodePagesTile.formTileFromNodePages(h.id)),this._tileManager.add(v,l,I=>this._onTileLoad(I,e,l),n))}}return!1}async _loadTile(e,n){const{loader:i}=n,r=n.getTileUrl("".concat(n.url,"/nodes/").concat(e)),a={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await Hl(r,i,a)}_onTileLoad(e,n,i){const r=new ax(n.tileset,e,n,i);n.children.push(r);const a=this._tileManager.find(r.id).frameState;this.updateTile(r,a),this._frameNumber===a.frameNumber&&(this.traversalFinished(a)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,a)}}const H$={description:"",ellipsoid:ri.WGS84,modelMatrix:new Qt,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},ig="Tiles In Tileset(s)",Av="Tiles In Memory",d2="Tiles In View",f2="Tiles To Render",p2="Tiles Loaded",Ev="Tiles Loading",m2="Tiles Unloaded",g2="Failed Tile Loads",_2="Points/Vertices",Tv="Tile Memory Use";class W${constructor(e,n){R(this,"options",void 0),R(this,"loadOptions",void 0),R(this,"type",void 0),R(this,"tileset",void 0),R(this,"loader",void 0),R(this,"url",void 0),R(this,"basePath",void 0),R(this,"modelMatrix",void 0),R(this,"ellipsoid",void 0),R(this,"lodMetricType",void 0),R(this,"lodMetricValue",void 0),R(this,"refine",void 0),R(this,"root",null),R(this,"roots",{}),R(this,"asset",{}),R(this,"description",""),R(this,"properties",void 0),R(this,"extras",null),R(this,"attributions",{}),R(this,"credits",{}),R(this,"stats",void 0),R(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),R(this,"cartographicCenter",null),R(this,"cartesianCenter",null),R(this,"zoom",1),R(this,"boundingVolume",null),R(this,"dynamicScreenSpaceErrorComputedDensity",0),R(this,"maximumMemoryUsage",32),R(this,"gpuMemoryUsageInBytes",0),R(this,"_frameNumber",0),R(this,"_queryParams",{}),R(this,"_extensionsUsed",[]),R(this,"_tiles",{}),R(this,"_pendingCount",0),R(this,"selectedTiles",[]),R(this,"traverseCounter",0),R(this,"geometricError",0),R(this,"lastUpdatedVieports",null),R(this,"_requestedTiles",[]),R(this,"_emptyTiles",[]),R(this,"frameStateData",{}),R(this,"_traverser",void 0),R(this,"_cache",new m$),R(this,"_requestScheduler",void 0),R(this,"updatePromise",null),R(this,"tilesetInitializationPromise",void 0),this.options={...H$,...n},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||ub(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Rk({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new d$({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(n=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),n(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const n=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;const i=[];for(const r of n){const a=r.id;this._needTraverse(a)?i.push(a):this.traverseCounter--}for(const r of n){const a=r.id;if(this.roots[a]||(this.roots[a]=this._initializeTileHeaders(this.tileset,null)),!i.includes(a))continue;const h=_$(r,this._frameNumber);this._traverser.traverse(this.roots[a],h,this.options)}}_needTraverse(e){let n=e;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[e]),n===e}_onTraversalEnd(e){const n=e.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[n],r=Object.values(this._traverser.selectedTiles),[a,h]=y$(r,e,this.options.maximumTilesSelected);i.selectedTiles=a;for(const l of h)l.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const n=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,n){if(e.length!==n.length)return!0;const i=new Set(e.map(h=>h.id)),r=new Set(n.map(h=>h.id));let a=e.filter(h=>!r.has(h.id)).length>0;return a=a||n.filter(h=>!i.has(h.id)).length>0,a}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,n)=>e._unloadTile(n))}_updateStats(){let e=0,n=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?n+=i.content.pointCount:n+=i.content.vertexCount);this.stats.get(d2).count=this.selectedTiles.length,this.stats.get(f2).count=e,this.stats.get(_2).count=n}async _initializeTileSet(e){this.type===$s.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===$s.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===$s.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const n=this.tileset.fullExtent;if(n){const{xmin:r,xmax:a,ymin:h,ymax:l,zmin:_,zmax:v}=n;this.cartographicCenter=new Te(r+(a-r)/2,h+(l-h)/2,_+(v-_)/2),this.cartesianCenter=ri.WGS84.cartographicToCartesian(this.cartographicCenter,new Te),this.zoom=PL(n,this.cartographicCenter,this.cartesianCenter);return}const i=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(i){const[r,a,h,l]=i;this.cartographicCenter=new Te(r+(h-r)/2,a+(l-a)/2,0),this.cartesianCenter=ri.WGS84.cartographicToCartesian(this.cartographicCenter,new Te),this.zoom=A$(i,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Te,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:n}=e.boundingVolume;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Te,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?this.cartographicCenter=ri.WGS84.cartesianToCartographic(n,new Te):this.cartographicCenter=new Te(0,0,-ri.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=w$(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(ig),this.stats.get(Ev),this.stats.get(Av),this.stats.get(d2),this.stats.get(f2),this.stats.get(p2),this.stats.get(m2),this.stats.get(g2),this.stats.get(_2),this.stats.get(Tv,"memory")}_initializeTileHeaders(e,n){const i=new ax(this,e.root,n);if(n&&(n.children.push(i),i.depth=n.depth+1),this.type===$s.TILES3D){const a=[];for(a.push(i);a.length>0;){const h=a.pop();this.stats.get(ig).incrementCount();const l=h.header.children||[];for(const _ of l){var r;const v=new ax(this,_,h);if((r=v.contentUrl)!==null&&r!==void 0&&r.includes("?session=")){const I=new URL(v.contentUrl).searchParams.get("session");I&&(this._queryParams.session=I)}h.children.push(v),v.depth=h.depth+1,a.push(v)}}}return i}_initializeTraverser(){let e;switch(this.type){case $s.TILES3D:e=U$;break;case $s.I3S:e=j$;break;default:e=q_}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let n;try{this._onStartTileLoading(),n=await e.loadContent()}catch(i){this._onTileLoadError(e,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,n)}}_onTileLoadError(e,n){this.stats.get(g2).incrementCount();const i=n.message||n.toString(),r=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(i)),this.options.onTileError(e,i,r)}_onTileLoad(e,n){if(n){if(this.type===$s.I3S){var i,r;const a=((i=this.tileset)===null||i===void 0||(r=i.nodePagesTile)===null||r===void 0?void 0:r.nodesInNodePages)||0;this.stats.get(ig).reset(),this.stats.get(ig).addCount(a)}e&&e.content&&g$(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===$s.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===$s.TILES3D){var n;const{extensionsRemoved:i=[]}=((n=e.content)===null||n===void 0?void 0:n.gltf)||{};i.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),i.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),i.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Ev).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Ev).decrementCount()}_addTileToCache(e){this._cache.add(this,e,n=>n._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(p2).incrementCount(),this.stats.get(Av).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(Tv).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(Av).decrementCount(),this.stats.get(m2).incrementCount(),this.stats.get(Tv).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const n=e.pop();for(const i of n.children)e.push(i);this._destroyTile(n)}this.root=null}_destroySubtree(e){const n=e,i=[];for(i.push(n);i.length>0;){e=i.pop();for(const r of e.children)i.push(r);e!==n&&this._destroyTile(e)}n.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const n=new URLSearchParams(e.queryString),i=Object.fromEntries(n.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const DL="3.4.14",ff={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function OL(t,e,n){Bn(t instanceof ArrayBuffer);const i=new TextDecoder("utf8"),r=new Uint8Array(t,e,n);return i.decode(r)}function q$(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=new DataView(t);return"".concat(String.fromCharCode(n.getUint8(e+0))).concat(String.fromCharCode(n.getUint8(e+1))).concat(String.fromCharCode(n.getUint8(e+2))).concat(String.fromCharCode(n.getUint8(e+3)))}const X$={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Pi={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},on={...X$,...Pi},Sv={[Pi.DOUBLE]:Float64Array,[Pi.FLOAT]:Float32Array,[Pi.UNSIGNED_SHORT]:Uint16Array,[Pi.UNSIGNED_INT]:Uint32Array,[Pi.UNSIGNED_BYTE]:Uint8Array,[Pi.BYTE]:Int8Array,[Pi.SHORT]:Int16Array,[Pi.INT]:Int32Array},$$={DOUBLE:Pi.DOUBLE,FLOAT:Pi.FLOAT,UNSIGNED_SHORT:Pi.UNSIGNED_SHORT,UNSIGNED_INT:Pi.UNSIGNED_INT,UNSIGNED_BYTE:Pi.UNSIGNED_BYTE,BYTE:Pi.BYTE,SHORT:Pi.SHORT,INT:Pi.INT},Cv="Failed to convert GL type";class aa{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const n in Sv)if(Sv[n]===e)return n;throw new Error(Cv)}static fromName(e){const n=$$[e];if(!n)throw new Error(Cv);return n}static getArrayType(e){switch(e){case Pi.UNSIGNED_SHORT_5_6_5:case Pi.UNSIGNED_SHORT_4_4_4_4:case Pi.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const n=Sv[e];if(!n)throw new Error(Cv);return n}}static getByteSize(e){return aa.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!aa.getArrayType(e)}static createTypedArray(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;r===void 0&&(r=(n.byteLength-i)/aa.getByteSize(e));const a=aa.getArrayType(e);return new a(n,i,r)}}function Z$(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(e))}function J$(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=t>>11&31,i=t>>5&63,r=t&31;return e[0]=n<<3,e[1]=i<<2,e[2]=r<<3,e}new Rb;new Te;new Rb;new Rb;function y2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return ka(t,0,e)/e*2-1}function v2(t){return t<0?-1:1}function K$(t,e,n,i){if(Z$(i),t<0||t>n||e<0||e>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(i.x=y2(t,n),i.y=y2(e,n),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const r=i.x;i.x=(1-Math.abs(i.y))*v2(r),i.y=(1-Math.abs(r))*v2(i.y)}return i.normalize()}function Y$(t,e,n){return K$(t,e,255,n)}class hw{constructor(e,n){R(this,"json",void 0),R(this,"buffer",void 0),R(this,"featuresLength",0),R(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=n}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:on.UNSIGNED_INT,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,n,i,1,r.byteOffset):r}getPropertyArray(e,n,i){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(n=aa.fromName(r.componentType)),this._getTypedArrayFromBinary(e,n,i,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,n,r)}getProperty(e,n,i,r,a){const h=this.json[e];if(!h)return h;const l=this.getPropertyArray(e,n,i);if(i===1)return l[r];for(let _=0;_<i;++_)a[_]=l[i*r+_];return a}_getTypedArrayFromBinary(e,n,i,r,a){const h=this._cachedTypedArrays;let l=h[e];return l||(l=aa.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+a,r*i),h[e]=l),l}_getTypedArrayFromArray(e,n,i){const r=this._cachedTypedArrays;let a=r[e];return a||(a=aa.createTypedArray(n,i),r[e]=a),a}}const Q$={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},eZ={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},tZ={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}};function nZ(t,e,n,i){const{componentType:r}=t;Bn(t.componentType);const a=typeof r=="string"?aa.fromName(r):r,h=Q$[t.type],l=eZ[t.type],_=tZ[t.type];return n+=t.byteOffset,{values:aa.createTypedArray(a,e,n,h*i),type:a,size:h,unpacker:l,packer:_}}const ra=t=>t!==void 0;function iZ(t,e,n){if(!e)return null;let i=t.getExtension("3DTILES_batch_table_hierarchy");const r=e.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=r,i=r),i?rZ(i,n):null}function rZ(t,e){let n,i,r;const a=t.instancesLength,h=t.classes;let l=t.classIds,_=t.parentCounts,v=t.parentIds,S=a;ra(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,a));let I;if(ra(_))for(ra(_.byteOffset)&&(_.componentType=defaultValue(_.componentType,GL.UNSIGNED_SHORT),_.type=AttributeType.SCALAR,r=getBinaryAccessor(_),_=r.createArrayBufferView(e.buffer,e.byteOffset+_.byteOffset,a)),I=new Uint16Array(a),S=0,n=0;n<a;++n)I[n]=S,S+=_[n];ra(v)&&ra(v.byteOffset)&&(v.componentType=defaultValue(v.componentType,GL.UNSIGNED_SHORT),v.type=AttributeType.SCALAR,r=getBinaryAccessor(v),v=r.createArrayBufferView(e.buffer,e.byteOffset+v.byteOffset,S));const B=h.length;for(n=0;n<B;++n){const ue=h[n].length,j=h[n].instances,W=getBinaryProperties(ue,j,e);h[n].instances=combine(W,j)}const z=new Array(B).fill(0),V=new Uint16Array(a);for(n=0;n<a;++n)i=l[n],V[n]=z[i],++z[i];const J={classes:h,classIds:l,classIndexes:V,parentCounts:_,parentIndexes:I,parentIds:v};return aZ(J),J}function pf(t,e,n){if(!t)return;const i=t.parentCounts;return t.parentIds?n(t,e):i>0?sZ(t,e,n):oZ(t,e,n)}function sZ(t,e,n){const i=t.classIds,r=t.parentCounts,a=t.parentIds,h=t.parentIndexes,l=i.length,_=scratchVisited;_.length=Math.max(_.length,l);const v=++marker,S=scratchStack;for(S.length=0,S.push(e);S.length>0;){if(e=S.pop(),_[e]===v)continue;_[e]=v;const I=n(t,e);if(ra(I))return I;const B=r[e],z=h[e];for(let V=0;V<B;++V){const J=a[z+V];J!==e&&S.push(J)}}return null}function oZ(t,e,n){let i=!0;for(;i;){const r=n(t,e);if(ra(r))return r;const a=t.parentIds[e];i=a!==e,e=a}throw new Error("traverseHierarchySingleParent")}function aZ(t){const n=t.classIds.length;for(let i=0;i<n;++i)FL(t,i,stack)}function FL(t,e,n){const i=t.parentCounts,r=t.parentIds,a=t.parentIndexes,l=t.classIds.length;if(!ra(r))return;assert(e<l,"Parent index ".concat(e," exceeds the total number of instances: ").concat(l)),assert(n.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),n.push(e);const _=ra(i)?i[e]:1,v=ra(i)?a[e]:e;for(let S=0;S<_;++S){const I=r[v+S];I!==e&&FL(t,I,n)}n.pop(e)}function is(t){return t!=null}const rg=(t,e)=>t,lZ={HIERARCHY:!0,extensions:!0,extras:!0};class kL{constructor(e,n,i){var r;let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};R(this,"json",void 0),R(this,"binary",void 0),R(this,"featureCount",void 0),R(this,"_extensions",void 0),R(this,"_properties",void 0),R(this,"_binaryProperties",void 0),R(this,"_hierarchy",void 0),Bn(i>=0),this.json=e||{},this.binary=n,this.featureCount=i,this._extensions=((r=this.json)===null||r===void 0?void 0:r.extensions)||{},this._properties={};for(const h in this.json)lZ[h]||(this._properties[h]=this.json[h]);this._binaryProperties=this._initializeBinaryProperties(),a["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=iZ(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,n){if(this._checkBatchId(e),Bn(typeof n=="string",n),this._hierarchy){const i=pf(this._hierarchy,e,(r,a)=>{const h=r.classIds[a];return r.classes[h].name===n});return is(i)}return!1}isExactClass(e,n){return Bn(typeof n=="string",n),this.getExactClassName(e)===n}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const n=this._hierarchy.classIds[e];return this._hierarchy.classes[n].name}}hasProperty(e,n){return this._checkBatchId(e),Bn(typeof n=="string",n),is(this._properties[n])||this._hasPropertyInHierarchy(e,n)}getPropertyNames(e,n){this._checkBatchId(e),n=is(n)?n:[],n.length=0;const i=Object.keys(this._properties);return n.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,n),n}getProperty(e,n){if(this._checkBatchId(e),Bn(typeof n=="string",n),this._binaryProperties){const r=this._binaryProperties[n];if(is(r))return this._getBinaryProperty(r,e)}const i=this._properties[n];if(is(i))return rg(i[e]);if(this._hierarchy){const r=this._getHierarchyProperty(e,n);if(is(r))return r}}setProperty(e,n,i){const r=this.featureCount;if(this._checkBatchId(e),Bn(typeof n=="string",n),this._binaryProperties){const h=this._binaryProperties[n];if(h){this._setBinaryProperty(h,e,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,n,i))return;let a=this._properties[n];is(a)||(this._properties[n]=new Array(r),a=this._properties[n]),a[e]=rg(i)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,n){return e.unpack(e.typedArray,n)}_setBinaryProperty(e,n,i){e.pack(i,e.typedArray,n)}_initializeBinaryProperties(){let e=null;for(const n in this._properties){const i=this._properties[n],r=this._initializeBinaryProperty(n,i);r&&(e=e||{},e[n]=r)}return e}_initializeBinaryProperty(e,n){if("byteOffset"in n){const i=n;Bn(this.binary,"Property ".concat(e," requires a batch table binary.")),Bn(i.type,"Property ".concat(e," requires a type."));const r=nZ(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(e,n){if(!this._hierarchy)return!1;const i=pf(this._hierarchy,e,(r,a)=>{const h=r.classIds[a],l=r.classes[h].instances;return is(l[n])});return is(i)}_getPropertyNamesInHierarchy(e,n){pf(this._hierarchy,e,(i,r)=>{const a=i.classIds[r],h=i.classes[a].instances;for(const l in h)h.hasOwnProperty(l)&&n.indexOf(l)===-1&&n.push(l)})}_getHierarchyProperty(e,n){return pf(this._hierarchy,e,(i,r)=>{const a=i.classIds[r],h=i.classes[a],l=i.classIndexes[r],_=h.instances[n];return is(_)?is(_.typedArray)?this._getBinaryProperty(_,l):rg(_[l]):null})}_setHierarchyProperty(e,n,i,r){const a=pf(this._hierarchy,n,(h,l)=>{const _=h.classIds[l],v=h.classes[_],S=h.classIndexes[l],I=v.instances[i];return is(I)?(Bn(l===n,'Inherited property "'.concat(i,'" is read-only.')),is(I.typedArray)?this._setBinaryProperty(I,S,r):I[S]=rg(r),!0):!1});return is(a)}}const Iv=4;function X_(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=new DataView(e);if(t.magic=i.getUint32(n,!0),n+=Iv,t.version=i.getUint32(n,!0),n+=Iv,t.byteLength=i.getUint32(n,!0),n+=Iv,t.version!==1)throw new Error("3D Tile Version ".concat(t.version," not supported"));return n}const Qu=4,x2="b3dm tile in legacy format.";function dw(t,e,n){const i=new DataView(e);let r;t.header=t.header||{};let a=i.getUint32(n,!0);n+=Qu;let h=i.getUint32(n,!0);n+=Qu;let l=i.getUint32(n,!0);n+=Qu;let _=i.getUint32(n,!0);return n+=Qu,l>=570425344?(n-=Qu*2,r=a,l=h,_=0,a=0,h=0,console.warn(x2)):_>=570425344&&(n-=Qu,r=l,l=a,_=h,a=0,h=0,console.warn(x2)),t.header.featureTableJsonByteLength=a,t.header.featureTableBinaryByteLength=h,t.header.batchTableJsonByteLength=l,t.header.batchTableBinaryByteLength=_,t.header.batchLength=r,n}function fw(t,e,n,i){return n=cZ(t,e,n),n=uZ(t,e,n),n}function cZ(t,e,n,i){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:a,batchLength:h}=t.header;if(t.featureTableJson={BATCH_LENGTH:h||0},r>0){const l=OL(e,n,r);t.featureTableJson=JSON.parse(l)}return n+=r,t.featureTableBinary=new Uint8Array(e,n,a),n+=a,n}function uZ(t,e,n,i){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:a}=t.header;if(r>0){const h=OL(e,n,r);t.batchTableJson=JSON.parse(h),n+=r,a>0&&(t.batchTableBinary=new Uint8Array(e,n,a),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=a)}return n}function zL(t,e,n){if(!e&&(!t||!t.batchIds||!n))return null;const{batchIds:i,isRGB565:r,pointCount:a}=t;if(i&&n){const h=new Uint8ClampedArray(a*3);for(let l=0;l<a;l++){const _=i[l],S=n.getProperty(_,"dimensions").map(I=>I*255);h[l*3]=S[0],h[l*3+1]=S[1],h[l*3+2]=S[2]}return{type:on.UNSIGNED_BYTE,value:h,size:3,normalized:!0}}if(r){const h=new Uint8ClampedArray(a*3);for(let l=0;l<a;l++){const _=J$(e[l]);h[l*3]=_[0],h[l*3+1]=_[1],h[l*3+2]=_[2]}return{type:on.UNSIGNED_BYTE,value:h,size:3,normalized:!0}}return e&&e.length===a*3?{type:on.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:on.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const b2=new Te;function hZ(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array(t.pointsLength*3);for(let i=0;i<t.pointsLength;i++)Y$(e[i*2],e[i*2+1],b2),b2.toArray(n,i*3);return{type:on.FLOAT,size:2,value:n}}return{type:on.FLOAT,size:2,value:e}}function dZ(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,fZ(t,e)):{type:on.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function fZ(t,e){const n=new Te,i=new Float32Array(t.pointCount*3);for(let r=0;r<t.pointCount;r++)n.set(e[r*3],e[r*3+1],e[r*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,r*3);return i}async function pZ(t,e,n,i,r){n=X_(t,e,n),n=dw(t,e,n),n=fw(t,e,n),mZ(t);const{featureTable:a,batchTable:h}=gZ(t);return await bZ(t,a,h,i,r),_Z(t,a,i),yZ(t,a,h),vZ(t,a),n}function mZ(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function gZ(t){const e=new hw(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",on.FLOAT,3);const i=xZ(t,e);return{featureTable:e,batchTable:i}}function _Z(t,e,n){if(!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",on.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const i=e.getPropertyArray("POSITION_QUANTIZED",on.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65536-1,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",on.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",on.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=dZ(t,i,n)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function yZ(t,e,n){if(!t.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",on.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",on.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",on.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=zL(t,i,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",on.UNSIGNED_BYTE,4))}function vZ(t,e){if(!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",on.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",on.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=hZ(t,n)}}function xZ(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",on.UNSIGNED_SHORT,1),t.batchIds)){const i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:a}=t;n=new kL(r,a,i)}return n}async function bZ(t,e,n,i,r){let a,h,l;const _=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];_&&(l=_.properties);const v=e.getExtension("3DTILES_draco_point_compression");if(v){h=v.properties;const I=v.byteOffset,B=v.byteLength;if(!h||!Number.isFinite(I)||!B)throw new Error("Draco properties, byteOffset, and byteLength must be defined");a=t.featureTableBinary.slice(I,I+B),t.hasPositions=Number.isFinite(h.POSITION),t.hasColors=Number.isFinite(h.RGB)||Number.isFinite(h.RGBA),t.hasNormals=Number.isFinite(h.NORMAL),t.hasBatchIds=Number.isFinite(h.BATCH_ID),t.isTranslucent=Number.isFinite(h.RGBA)}if(!a)return!0;const S={buffer:a,properties:{...h,...l},featureTableProperties:h,batchTableProperties:l,dequantizeInShader:!1};return await wZ(t,S,i,r)}async function wZ(t,e,n,i){const{parse:r}=i,a={...n,draco:{...n.draco,extraAttributes:e.batchTableProperties||{}}};delete a["3d-tiles"];const h=await r(e.buffer,wL,a),l=h.attributes.POSITION&&h.attributes.POSITION.value,_=h.attributes.COLOR_0&&h.attributes.COLOR_0.value,v=h.attributes.NORMAL&&h.attributes.NORMAL.value,S=h.attributes.BATCH_ID&&h.attributes.BATCH_ID.value,I=l&&h.attributes.POSITION.value.quantization,B=v&&h.attributes.NORMAL.value.quantization;if(I){const V=h.POSITION.data.quantization,J=V.range;t.quantizedVolumeScale=new Te(J,J,J),t.quantizedVolumeOffset=new Te(V.minValues),t.quantizedRange=(1<<V.quantizationBits)-1,t.isQuantizedDraco=!0}B&&(t.octEncodedRange=(1<<h.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const z={};if(e.batchTableProperties)for(const V of Object.keys(e.batchTableProperties))h.attributes[V]&&h.attributes[V].value&&(z[V.toLowerCase()]=h.attributes[V].value);t.attributes={positions:l,colors:zL(t,_,void 0),normals:v,batchIds:S,...z}}const lx={URI:0,EMBEDDED:1};function NL(t,e,n,i){t.rotateYtoZ=!0;const r=t.byteOffset+t.byteLength-n;if(r===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=cb(e,n,r),t.gltfByteOffset=0,t.gltfByteLength=r,n%4===0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}async function UL(t,e,n,i){const r=n["3d-tiles"]||{};if(AZ(t,e),r.loadGLTF){const{parse:a,fetch:h}=i;t.gltfUrl&&(t.gltfArrayBuffer=await h(t.gltfUrl,n),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await a(t.gltfArrayBuffer,ap,n,i),t.gpuMemoryUsageInBytes=xL(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}function AZ(t,e,n){switch(e){case lx.URI:const i=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),a=new TextDecoder().decode(i);t.gltfUrl=a.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case lx.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function EZ(t,e,n,i,r){var a;n=TZ(t,e,n,i),await UL(t,lx.EMBEDDED,i,r);const h=t==null||(a=t.gltf)===null||a===void 0?void 0:a.extensions;return h&&h.CESIUM_RTC&&(t.rtcCenter=h.CESIUM_RTC.center),n}function TZ(t,e,n,i,r){n=X_(t,e,n),n=dw(t,e,n),n=fw(t,e,n),n=NL(t,e,n,i);const a=new hw(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=a.getGlobalProperty("RTC_CENTER",on.FLOAT,3),n}async function SZ(t,e,n,i,r){return n=CZ(t,e,n,i),await UL(t,t.gltfFormat,i,r),n}function CZ(t,e,n,i,r){if(n=X_(t,e,n),t.version!==1)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));n=dw(t,e,n);const a=new DataView(e);if(t.gltfFormat=a.getUint32(n,!0),n+=4,n=fw(t,e,n),n=NL(t,e,n,i),t.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const h=new hw(t.featureTableJson,t.featureTableBinary),l=h.getGlobalProperty("INSTANCES_LENGTH");if(h.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=h.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=h.getGlobalProperty("RTC_CENTER",on.FLOAT,3);const _=new kL(t.batchTableJson,t.batchTableBinary,l);return IZ(t,h,_,l),n}function IZ(t,e,n,i){const a={instances:new Array(i),batchTable:t._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,h=new Te;new Te,new Te,new Te;const l=new gi,_=new rp,v=new Te,S={},I=new Qt,B=[],z=[],V=new Te,J=new Te;for(let ue=0;ue<i;ue++){let j;if(e.hasProperty("POSITION"))j=e.getProperty("POSITION",on.FLOAT,3,ue,h);else if(e.hasProperty("POSITION_QUANTIZED")){j=e.getProperty("POSITION_QUANTIZED",on.UNSIGNED_SHORT,3,ue,h);const Le=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",on.FLOAT,3,V);if(!Le)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const ke=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",on.FLOAT,3,J);if(!ke)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const Ue=65535;for(let Me=0;Me<3;Me++)j[Me]=j[Me]/Ue*ke[Me]+Le[Me]}if(!j)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(h.copy(j),S.translation=h,t.normalUp=e.getProperty("NORMAL_UP",on.FLOAT,3,ue,B),t.normalRight=e.getProperty("NORMAL_RIGHT",on.FLOAT,3,ue,z),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",on.UNSIGNED_SHORT,2,B),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",on.UNSIGNED_SHORT,2,z),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(ri.WGS84.eastNorthUpToFixedFrame(h,I),I.getRotationMatrix3(l)):l.identity()}_.fromMatrix3(l),S.rotation=_,v.set(1,1,1);const W=e.getProperty("SCALE",on.FLOAT,1,ue);Number.isFinite(W)&&v.multiplyByScalar(W);const Z=e.getProperty("SCALE_NON_UNIFORM",on.FLOAT,3,ue,B);Z&&v.scale(Z),S.scale=v;let ae=e.getProperty("BATCH_ID",on.UNSIGNED_SHORT,1,ue);ae===void 0&&(ae=ue);const be=new Qt().fromQuaternion(S.rotation);I.identity(),I.translate(S.translation),I.multiplyRight(be),I.scale(S.scale);const Ee=I.clone();a[ue]={modelMatrix:Ee,batchId:ae}}t.instances=a}async function PZ(t,e,n,i,r,a){n=X_(t,e,n);const h=new DataView(e);for(t.tilesLength=h.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-n>12;){const l={};t.tiles.push(l),n=await a(e,n,i,r,l)}return n}async function MZ(t,e,n,i){t.rotateYtoZ=!0,t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y";const{parse:r}=i;t.gltf=await r(e,ap,n,i),t.gpuMemoryUsageInBytes=xL(t.gltf)}async function VL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(r.byteOffset=e,r.type=q$(t,e),r.type){case ff.COMPOSITE:return await PZ(r,t,e,n,i,VL);case ff.BATCHED_3D_MODEL:return await EZ(r,t,e,n,i);case ff.GLTF:return await MZ(r,t,n,i);case ff.INSTANCED_3D_MODEL:return await SZ(r,t,e,n,i);case ff.POINT_CLOUD:return await pZ(r,t,e,n,i);default:throw new Error("3DTileLoader: unknown type ".concat(r.type))}}const BZ=1952609651,LZ=1;async function RZ(t,e,n){if(new Uint32Array(t.slice(0,4))[0]!==BZ)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==LZ)throw new Error("Wrong subtree file verson, must be 1");const a=w2(t.slice(8,16)),h=new Uint8Array(t,24,a),_=new TextDecoder("utf8").decode(h),v=JSON.parse(_),S=w2(t.slice(16,24));let I=new ArrayBuffer(0);return S&&(I=t.slice(24+a)),"bufferView"in v.tileAvailability&&(v.tileAvailability.explicitBitstream=await Pv(v,"tileAvailability",I,n)),"bufferView"in v.contentAvailability&&(v.contentAvailability.explicitBitstream=await Pv(v,"contentAvailability",I,n)),"bufferView"in v.childSubtreeAvailability&&(v.childSubtreeAvailability.explicitBitstream=await Pv(v,"childSubtreeAvailability",I,n)),v}function DZ(t,e){if(e.startsWith("http")){const a=new URL(t,e);return decodeURI(a.toString())}const i="http://".concat(e),r=new URL(t,i);return"/".concat(r.host).concat(r.pathname)}async function Pv(t,e,n,i){const r=t[e].bufferView,a=t.bufferViews[r],h=t.buffers[a.buffer];if(!(i!=null&&i.url)||!i.fetch)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(h.uri){const l=DZ(h.uri,i==null?void 0:i.url),v=await(await i.fetch(l)).arrayBuffer();return new Uint8Array(v,a.byteOffset,a.byteLength)}return new Uint8Array(n,a.byteOffset,a.byteLength)}function w2(t){const e=new DataView(t),n=e.getUint32(0,!0),i=e.getUint32(4,!0);return n+2**32*i}const jL={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:DL,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:RZ,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var no=null;try{no=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function vn(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}vn.prototype.__isLong__;Object.defineProperty(vn.prototype,"__isLong__",{value:!0});function Ir(t){return(t&&t.__isLong__)===!0}function A2(t){var e=Math.clz32(t&-t);return t?31-e:e}vn.isLong=Ir;var E2={},T2={};function nu(t,e){var n,i,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(i=T2[t],i)?i:(n=dn(t,0,!0),r&&(T2[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(i=E2[t],i)?i:(n=dn(t,t<0?-1:0,!1),r&&(E2[t]=n),n))}vn.fromInt=nu;function io(t,e){if(isNaN(t))return e?za:Bo;if(e){if(t<0)return za;if(t>=HL)return XL}else{if(t<=-C2)return as;if(t+1>=C2)return qL}return t<0?io(-t,e).neg():dn(t%Xh|0,t/Xh|0,e)}vn.fromNumber=io;function dn(t,e,n){return new vn(t,e,n)}vn.fromBits=dn;var g_=Math.pow;function pw(t,e,n){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(n=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?za:Bo;if(n=n||10,n<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return pw(t.substring(1),e,n).neg();for(var r=io(g_(n,8)),a=Bo,h=0;h<t.length;h+=8){var l=Math.min(8,t.length-h),_=parseInt(t.substring(h,h+l),n);if(l<8){var v=io(g_(n,l));a=a.mul(v).add(io(_))}else a=a.mul(r),a=a.add(io(_))}return a.unsigned=e,a}vn.fromString=pw;function zo(t,e){return typeof t=="number"?io(t,e):typeof t=="string"?pw(t,e):dn(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}vn.fromValue=zo;var S2=65536,OZ=1<<24,Xh=S2*S2,HL=Xh*Xh,C2=HL/2,I2=nu(OZ),Bo=nu(0);vn.ZERO=Bo;var za=nu(0,!0);vn.UZERO=za;var _h=nu(1);vn.ONE=_h;var WL=nu(1,!0);vn.UONE=WL;var cx=nu(-1);vn.NEG_ONE=cx;var qL=dn(-1,2147483647,!1);vn.MAX_VALUE=qL;var XL=dn(-1,-1,!0);vn.MAX_UNSIGNED_VALUE=XL;var as=dn(0,-2147483648,!1);vn.MIN_VALUE=as;var Ze=vn.prototype;Ze.toInt=function(){return this.unsigned?this.low>>>0:this.low};Ze.toNumber=function(){return this.unsigned?(this.high>>>0)*Xh+(this.low>>>0):this.high*Xh+(this.low>>>0)};Ze.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(as)){var n=io(e),i=this.div(n),r=i.mul(n).sub(this);return i.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var a=io(g_(e,6),this.unsigned),h=this,l="";;){var _=h.div(a),v=h.sub(_.mul(a)).toInt()>>>0,S=v.toString(e);if(h=_,h.isZero())return S+l;for(;S.length<6;)S="0"+S;l=""+S+l}};Ze.getHighBits=function(){return this.high};Ze.getHighBitsUnsigned=function(){return this.high>>>0};Ze.getLowBits=function(){return this.low};Ze.getLowBitsUnsigned=function(){return this.low>>>0};Ze.getNumBitsAbs=function(){if(this.isNegative())return this.eq(as)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};Ze.isZero=function(){return this.high===0&&this.low===0};Ze.eqz=Ze.isZero;Ze.isNegative=function(){return!this.unsigned&&this.high<0};Ze.isPositive=function(){return this.unsigned||this.high>=0};Ze.isOdd=function(){return(this.low&1)===1};Ze.isEven=function(){return(this.low&1)===0};Ze.equals=function(e){return Ir(e)||(e=zo(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Ze.eq=Ze.equals;Ze.notEquals=function(e){return!this.eq(e)};Ze.neq=Ze.notEquals;Ze.ne=Ze.notEquals;Ze.lessThan=function(e){return this.comp(e)<0};Ze.lt=Ze.lessThan;Ze.lessThanOrEqual=function(e){return this.comp(e)<=0};Ze.lte=Ze.lessThanOrEqual;Ze.le=Ze.lessThanOrEqual;Ze.greaterThan=function(e){return this.comp(e)>0};Ze.gt=Ze.greaterThan;Ze.greaterThanOrEqual=function(e){return this.comp(e)>=0};Ze.gte=Ze.greaterThanOrEqual;Ze.ge=Ze.greaterThanOrEqual;Ze.compare=function(e){if(Ir(e)||(e=zo(e)),this.eq(e))return 0;var n=this.isNegative(),i=e.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Ze.comp=Ze.compare;Ze.negate=function(){return!this.unsigned&&this.eq(as)?as:this.not().add(_h)};Ze.neg=Ze.negate;Ze.add=function(e){Ir(e)||(e=zo(e));var n=this.high>>>16,i=this.high&65535,r=this.low>>>16,a=this.low&65535,h=e.high>>>16,l=e.high&65535,_=e.low>>>16,v=e.low&65535,S=0,I=0,B=0,z=0;return z+=a+v,B+=z>>>16,z&=65535,B+=r+_,I+=B>>>16,B&=65535,I+=i+l,S+=I>>>16,I&=65535,S+=n+h,S&=65535,dn(B<<16|z,S<<16|I,this.unsigned)};Ze.subtract=function(e){return Ir(e)||(e=zo(e)),this.add(e.neg())};Ze.sub=Ze.subtract;Ze.multiply=function(e){if(this.isZero())return this;if(Ir(e)||(e=zo(e)),no){var n=no.mul(this.low,this.high,e.low,e.high);return dn(n,no.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?za:Bo;if(this.eq(as))return e.isOdd()?as:Bo;if(e.eq(as))return this.isOdd()?as:Bo;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(I2)&&e.lt(I2))return io(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,r=this.high&65535,a=this.low>>>16,h=this.low&65535,l=e.high>>>16,_=e.high&65535,v=e.low>>>16,S=e.low&65535,I=0,B=0,z=0,V=0;return V+=h*S,z+=V>>>16,V&=65535,z+=a*S,B+=z>>>16,z&=65535,z+=h*v,B+=z>>>16,z&=65535,B+=r*S,I+=B>>>16,B&=65535,B+=a*v,I+=B>>>16,B&=65535,B+=h*_,I+=B>>>16,B&=65535,I+=i*S+r*v+a*_+h*l,I&=65535,dn(z<<16|V,I<<16|B,this.unsigned)};Ze.mul=Ze.multiply;Ze.divide=function(e){if(Ir(e)||(e=zo(e)),e.isZero())throw Error("division by zero");if(no){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?no.div_u:no.div_s)(this.low,this.high,e.low,e.high);return dn(n,no.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?za:Bo;var i,r,a;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return za;if(e.gt(this.shru(1)))return WL;a=za}else{if(this.eq(as)){if(e.eq(_h)||e.eq(cx))return as;if(e.eq(as))return _h;var h=this.shr(1);return i=h.div(e).shl(1),i.eq(Bo)?e.isNegative()?_h:cx:(r=this.sub(e.mul(i)),a=i.add(r.div(e)),a)}else if(e.eq(as))return this.unsigned?za:Bo;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();a=Bo}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var l=Math.ceil(Math.log(i)/Math.LN2),_=l<=48?1:g_(2,l-48),v=io(i),S=v.mul(e);S.isNegative()||S.gt(r);)i-=_,v=io(i,this.unsigned),S=v.mul(e);v.isZero()&&(v=_h),a=a.add(v),r=r.sub(S)}return a};Ze.div=Ze.divide;Ze.modulo=function(e){if(Ir(e)||(e=zo(e)),no){var n=(this.unsigned?no.rem_u:no.rem_s)(this.low,this.high,e.low,e.high);return dn(n,no.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Ze.mod=Ze.modulo;Ze.rem=Ze.modulo;Ze.not=function(){return dn(~this.low,~this.high,this.unsigned)};Ze.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Ze.clz=Ze.countLeadingZeros;Ze.countTrailingZeros=function(){return this.low?A2(this.low):A2(this.high)+32};Ze.ctz=Ze.countTrailingZeros;Ze.and=function(e){return Ir(e)||(e=zo(e)),dn(this.low&e.low,this.high&e.high,this.unsigned)};Ze.or=function(e){return Ir(e)||(e=zo(e)),dn(this.low|e.low,this.high|e.high,this.unsigned)};Ze.xor=function(e){return Ir(e)||(e=zo(e)),dn(this.low^e.low,this.high^e.high,this.unsigned)};Ze.shiftLeft=function(e){return Ir(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?dn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):dn(0,this.low<<e-32,this.unsigned)};Ze.shl=Ze.shiftLeft;Ze.shiftRight=function(e){return Ir(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?dn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):dn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Ze.shr=Ze.shiftRight;Ze.shiftRightUnsigned=function(e){return Ir(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?dn(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?dn(this.high,0,this.unsigned):dn(this.high>>>e-32,0,this.unsigned)};Ze.shru=Ze.shiftRightUnsigned;Ze.shr_u=Ze.shiftRightUnsigned;Ze.rotateLeft=function(e){var n;return Ir(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?dn(this.high,this.low,this.unsigned):e<32?(n=32-e,dn(this.low<<e|this.high>>>n,this.high<<e|this.low>>>n,this.unsigned)):(e-=32,n=32-e,dn(this.high<<e|this.low>>>n,this.low<<e|this.high>>>n,this.unsigned))};Ze.rotl=Ze.rotateLeft;Ze.rotateRight=function(e){var n;return Ir(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?dn(this.high,this.low,this.unsigned):e<32?(n=32-e,dn(this.high<<n|this.low>>>e,this.low<<n|this.high>>>e,this.unsigned)):(e-=32,n=32-e,dn(this.low<<n|this.high>>>e,this.high<<n|this.low>>>e,this.unsigned))};Ze.rotr=Ze.rotateRight;Ze.toSigned=function(){return this.unsigned?dn(this.low,this.high,!1):this};Ze.toUnsigned=function(){return this.unsigned?this:dn(this.low,this.high,!0)};Ze.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Ze.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Ze.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};vn.fromBytes=function(e,n,i){return i?vn.fromBytesLE(e,n):vn.fromBytesBE(e,n)};vn.fromBytesLE=function(e,n){return new vn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};vn.fromBytesBE=function(e,n){return new vn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const FZ=16;function $L(t){t==="X"&&(t="");const e=t.padEnd(FZ,"0");return vn.fromString(e,!0,16)}function kZ(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const n=e%4;e=(e-n)/4;const i=e;e*=4;const a=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-i-a.length).join("0")+a}function zZ(t,e){const n=NZ(t).shiftRightUnsigned(2);return t.add(vn.fromNumber(2*e+1-4).multiply(n))}function NZ(t){return t.and(t.not().add(1))}const UZ=3,GZ=30,VZ=2*GZ+1,P2=180/Math.PI;function jZ(t){if(t.length===0)throw new Error("Invalid Hilbert quad key ".concat(t));const e=t.split("/"),n=parseInt(e[0],10),i=e[1],r=i.length;let a=0;const h=[0,0];for(let l=r-1;l>=0;l--){a=r-l;const _=i[l];let v=0,S=0;_==="1"?S=1:_==="2"?(v=1,S=1):_==="3"&&(v=1);const I=Math.pow(2,a-1);WZ(I,h,v,S),h[0]+=I*v,h[1]+=I*S}if(n%2===1){const l=h[0];h[0]=h[1],h[1]=l}return{face:n,ij:h,level:a}}function HZ(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<UZ+VZ;)e="0"+e;const n=e.lastIndexOf("1"),i=e.substring(0,3),r=e.substring(3,n),a=r.length/2,h=vn.fromString(i,!0,2).toString(10);let l="";if(a!==0)for(l=vn.fromString(r,!0,2).toString(4);l.length<a;)l="0"+l;return"".concat(h,"/").concat(l)}function ZL(t,e,n){const i=1<<e;return[(t[0]+n[0])/i,(t[1]+n[1])/i]}function M2(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function JL(t){return[M2(t[0]),M2(t[1])]}function KL(t,e){let[n,i]=e;switch(t){case 0:return[1,n,i];case 1:return[-n,1,i];case 2:return[-n,-i,1];case 3:return[-1,-i,-n];case 4:return[i,-1,-n];case 5:return[i,n,-1];default:throw new Error("Invalid face")}}function YL(t){let[e,n,i]=t;const r=Math.atan2(i,Math.sqrt(e*e+n*n));return[Math.atan2(n,e)*P2,r*P2]}function WZ(t,e,n,i){if(i===0){n===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}function qZ(t){const e=ZL(t.ij,t.level,[.5,.5]),n=JL(e),i=KL(t.face,n);return YL(i)}const XZ=100;function B2(t){const{face:e,ij:n,level:i}=t,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],a=Math.max(1,Math.ceil(XZ*Math.pow(2,-i))),h=new Float64Array(4*a*2+2);let l=0,_=0;for(let v=0;v<4;v++){const S=r[v].slice(0),I=r[v+1],B=(I[0]-S[0])/a,z=(I[1]-S[1])/a;for(let V=0;V<a;V++){S[0]+=B,S[1]+=z;const J=ZL(n,i,S),ue=JL(J),j=KL(e,ue),W=YL(j);Math.abs(W[1])>89.999&&(W[0]=_);const Z=W[0]-_;W[0]+=Z>180?-360:Z<-180?360:0,h[l++]=W[0],h[l++]=W[1],_=W[0]}}return h[l++]=h[0],h[l++]=h[1],h}function mw(t){const e=$Z(t);return jZ(e)}function $Z(t){if(t.indexOf("/")>0)return t;const e=$L(t);return HZ(e)}function ZZ(t){const e=mw(t);return qZ(e)}function JZ(t){let e;if(t.face===2||t.face===5){let n=null,i=0;for(let r=0;r<4;r++){const a="".concat(t.face,"/").concat(r),h=mw(a),l=B2(h);(typeof n>"u"||n===null)&&(n=new Float64Array(4*l.length)),n.set(l,i),i+=l.length}e=L2(n)}else{const n=B2(t);e=L2(n)}return e}function L2(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],n=[];for(let i=0;i<t.length;i+=2)e.push(t[i]),n.push(t[i+1]);return e.sort((i,r)=>i-r),n.sort((i,r)=>i-r),{west:e[0],east:e[e.length-1],north:n[n.length-1],south:n[0]}}function KZ(t,e){const n=(e==null?void 0:e.minimumHeight)||0,i=(e==null?void 0:e.maximumHeight)||0,r=mw(t),a=JZ(r),h=a.west,l=a.south,_=a.east,v=a.north,S=[];return S.push(new Te(h,v,n)),S.push(new Te(_,v,n)),S.push(new Te(_,l,n)),S.push(new Te(h,l,n)),S.push(new Te(h,v,i)),S.push(new Te(_,v,i)),S.push(new Te(_,l,i)),S.push(new Te(h,l,i)),S}function QL(t){const e=t.token,n={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},i=KZ(e,n),r=ZZ(e),a=r[0],h=r[1],l=ri.WGS84.cartographicToCartesian([a,h,n.maximumHeight]),_=new Te(l[0],l[1],l[2]);i.push(_);const v=w7(i);return[...v.center,...v.halfAxes]}const YZ=4,QZ=8,eJ={QUADTREE:YZ,OCTREE:QZ};function tJ(t,e,n){if(t!=null&&t.box){const i=$L(t.s2VolumeInfo.token),r=zZ(i,e),a=kZ(r),h={...t.s2VolumeInfo};switch(h.token=a,n){case"OCTREE":const v=t.s2VolumeInfo,S=v.maximumHeight-v.minimumHeight,I=S/2,B=v.minimumHeight+S/2;v.minimumHeight=B-I,v.maximumHeight=B+I;break}return{box:QL(h),s2VolumeInfo:h}}}async function eR(t){const{options:e,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:i=0,globalData:r={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:a}=t;let{subtree:h,level:l=0}=t;const{subdivisionScheme:_,subtreeLevels:v,maximumLevel:S,contentUrlTemplate:I,subtreesUriTemplate:B,basePath:z}=e,V={children:[],lodMetricValue:0,contentUrl:""},J=eJ[_],ue=i&1,j=i>>1&1,W=i>>2&1,Z=(J**l-1)/(J-1);let ae=Pc(n.mortonIndex,i),be=Z+ae,Ee=Pc(n.x,ue),Le=Pc(n.y,j),ke=Pc(n.z,W),Ue=!1;l+1>v&&(Ue=Mv(h.childSubtreeAvailability,ae));const Me=Pc(r.x,Ee),ut=Pc(r.y,Le),Lt=Pc(r.z,ke),Ft=l+r.level;if(Ue){const tt="".concat(z,"/").concat(B),At=ux(tt,Ft,Me,ut,Lt);h=await Hl(At,jL),r.mortonIndex=ae,r.x=Ee,r.y=Le,r.z=ke,r.level=l,ae=0,be=0,Ee=0,Le=0,ke=0,l=0}if(!Mv(h.tileAvailability,be)||l>S)return V;Mv(h.contentAvailability,be)&&(V.contentUrl=ux(I,Ft,Me,ut,Lt));const ai=l+1,Bi={mortonIndex:ae,x:Ee,y:Le,z:ke};for(let tt=0;tt<J;tt++){const At=tJ(a,tt,_),Pt=await eR({subtree:h,options:e,parentData:Bi,childIndex:tt,level:ai,globalData:r,s2VolumeBox:At});if(Pt.contentUrl||Pt.children.length){const tn=Ft+1,Kn=nJ(Pt,tn,{childTileX:Ee,childTileY:Le,childTileZ:ke},e,a);V.children.push(Kn)}}return V}function Mv(t,e){return"constant"in t?!!t.constant:t.explicitBitstream?sJ(e,t.explicitBitstream):!1}function nJ(t,e,n,i,r){const{basePath:a,refine:h,getRefine:l,lodMetricType:_,getTileType:v,rootLodMetricValue:S,rootBoundingVolume:I}=i,B=t.contentUrl&&t.contentUrl.replace("".concat(a,"/"),""),z=S/2**e,V=r!=null&&r.box?{box:r.box}:I,J=iJ(e,V,n);return{children:t.children,contentUrl:t.contentUrl,content:{uri:B},id:t.contentUrl,refine:l(h),type:v(t),lodMetricType:_,lodMetricValue:z,geometricError:z,transform:t.transform,boundingVolume:J}}function iJ(t,e,n){if(e.region){const{childTileX:i,childTileY:r,childTileZ:a}=n,[h,l,_,v,S,I]=e.region,B=2**t,z=(_-h)/B,V=(v-l)/B,J=(I-S)/B,[ue,j]=[h+z*i,h+z*(i+1)],[W,Z]=[l+V*r,l+V*(r+1)],[ae,be]=[S+J*a,S+J*(a+1)];return{region:[ue,W,j,Z,ae,be]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}function Pc(t,e){return parseInt(t.toString(2)+e.toString(2),2)}function ux(t,e,n,i,r){const a=rJ({level:e,x:n,y:i,z:r});return t.replace(/{level}|{x}|{y}|{z}/gi,h=>a[h])}function rJ(t){const e={};for(const n in t)e["{".concat(n,"}")]=t[n];return e}function sJ(t,e){const n=Math.floor(t/8),i=t%8;return(e[n]>>i&1)===1}function gw(t){if(!t.contentUrl)return Ih.EMPTY;const n=t.contentUrl.split("?")[0].split(".").pop();switch(n){case"pnts":return Ih.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Ih.SCENEGRAPH;default:return n}}function _w(t){switch(t){case"REPLACE":case"replace":return Ga.REPLACE;case"ADD":case"add":return Ga.ADD;default:return t}}function hx(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const i=new URL(t,"".concat(e,"/"));return decodeURI(i.toString())}else if(t.startsWith("/"))return t;return"".concat(e,"/").concat(t)}function R2(t,e){if(!t)return null;if(t.content){const n=t.content.uri||t.content.url;t.contentUrl=hx(n,e.basePath)}return t.id=t.contentUrl,t.lodMetricType=W_.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=gw(t),t.refine=_w(t.refine),t}async function oJ(t,e){const n=t.basePath;let i;const r=O2(t==null?void 0:t.root);r&&t.root?i=await D2(t.root,t,r,e):i=R2(t.root,t);const a=[];for(a.push(i);a.length>0;){const l=(a.pop()||{}).children||[];for(let _ of l){const v=O2(_);v?_=await D2(_,t,v,e):R2(_,{basePath:n}),a.push(_)}}return i}async function D2(t,e,n,i){var r,a;const h=e.basePath,{subdivisionScheme:l,maximumLevel:_,subtreeLevels:v,subtrees:{uri:S}}=n,I=ux(S,0,0,0,0),B=hx(I,h),z=await Hl(B,jL,i),V=hx(t.content.uri,h),J=e==null||(r=e.root)===null||r===void 0?void 0:r.refine,ue=t.geometricError,j=(a=t.boundingVolume.extensions)===null||a===void 0?void 0:a["3DTILES_bounding_volume_S2"];if(j){const be={box:QL(j),s2VolumeInfo:j};t.boundingVolume=be}const W=t.boundingVolume,Z={contentUrlTemplate:V,subtreesUriTemplate:S,subdivisionScheme:l,subtreeLevels:v,maximumLevel:_,refine:J,basePath:h,lodMetricType:W_.GEOMETRIC_ERROR,rootLodMetricValue:ue,rootBoundingVolume:W,getTileType:gw,getRefine:_w};return await aJ(t,z,Z)}async function aJ(t,e,n){if(!t)return null;t.lodMetricType=W_.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform;const{children:i,contentUrl:r}=await eR({subtree:e,options:n,s2VolumeBox:t});return r&&(t.contentUrl=r,t.content={uri:r.replace("".concat(n.basePath,"/"),"")}),t.refine=_w(t.refine),t.type=gw(t),t.children=i,t.id=t.contentUrl,t}function O2(t){var e;return(t==null||(e=t.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(t==null?void 0:t.implicitTiling)}const yw={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:DL,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:hJ,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function lJ(t){return ub(t.url)}async function cJ(t,e,n){const i={content:{featureIds:null}};return await VL(t,0,e,n,i.content),i.content}async function uJ(t,e,n){var i;const r=JSON.parse(new TextDecoder().decode(t));return r.loader=e.loader||yw,r.url=n.url,r.queryString=n.queryString,r.basePath=lJ(r),r.root=await oJ(r,e),r.type=$s.TILES3D,r.lodMetricType=W_.GEOMETRIC_ERROR,r.lodMetricValue=((i=r.root)===null||i===void 0?void 0:i.lodMetricValue)||0,r}async function hJ(t,e,n){const i=e["3d-tiles"]||{};let r;return i.isTileset==="auto"?r=n.url&&n.url.indexOf(".json")!==-1:r=i.isTileset,r?t=await uJ(t,e,n):t=await cJ(t,e,n),t}const F2=[0],dJ={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:yw,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,n)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class vw extends KB{constructor(...e){super(...e),R(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&ln.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){const{tileset3d:e}=this.state;return e!==null&&e.isLoaded()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:n,changeFlags:i}){if(e.data&&e.data!==n.data&&this._loadTileset(e.data),i.viewportChanged){const{activeViewports:r}=this.state;Object.keys(r).length&&(this._updateTileset(r),this.state.lastUpdatedViewports=r,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:r}=this.state;for(const a in r)r[a].needsUpdate=!0}}activateViewport(e){const{activeViewports:n,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,n[e.id]=e;const r=i==null?void 0:i[e.id];(!r||!e.equals(r))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:n}){const i=n&&n.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer({layer:e,viewport:n}){const{tile:i}=e.props,{id:r}=n;return i.selected&&i.viewportIds.includes(r)}_updateAutoHighlight(e){const n=e.sourceTile,i=this.state.layerMap[n==null?void 0:n.id];i&&i.layer&&i.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:n={}}=this.props;let i=this.props.loader||this.props.loaders;Array.isArray(i)&&(i=i[0]);const r={loadOptions:{...n}};let a=e;if(i.preload){const _=await i.preload(e,n);_.url&&(a=_.url),_.headers&&(r.loadOptions.fetch={...r.loadOptions.fetch,headers:_.headers}),Object.assign(r,_)}const h=await Hl(a,i,r.loadOptions),l=new W$(h,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...r});this.setState({tileset3d:l,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(l)}_onTileLoad(e){const{lastUpdatedViewports:n}=this.state;this.props.onTileLoad(e),this._updateTileset(n),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:n}=this.state,{timeline:i}=this.context,r=Object.keys(e).length;!i||!r||!n||n.selectTiles(Object.values(e)).then(a=>{this.state.frameNumber!==a&&this.setState({frameNumber:a})})}_getSubLayer(e,n){if(!e.content)return null;switch(e.type){case Ih.POINTCLOUD:return this._makePointCloudLayer(e,n);case Ih.SCENEGRAPH:return this._make3DModelLayer(e);case Ih.MESH:return this._makeSimpleMeshLayer(e,n);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,n){const{attributes:i,pointCount:r,constantRGBA:a,cartographicOrigin:h,modelMatrix:l}=e.content,{positions:_,normals:v,colors:S}=i;if(!_)return null;const I=n&&n.props.data||{header:{vertexCount:r},attributes:{POSITION:_,NORMAL:v,COLOR_0:S}},{pointSize:B,getPointColor:z}=this.props,V=this.getSubLayerClass("pointcloud",Qb);return new V({pointSize:B},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:I,coordinateSystem:Jt.METER_OFFSETS,coordinateOrigin:h,modelMatrix:l,getColor:a||z,_offset:0})}_make3DModelLayer(e){const{gltf:n,instances:i,cartographicOrigin:r,modelMatrix:a}=e.content,h=this.getSubLayerClass("scenegraph",cw);return new h({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:i||F2,scenegraph:n,coordinateSystem:Jt.METER_OFFSETS,coordinateOrigin:r,modelMatrix:a,getTransformMatrix:l=>l.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,n){const i=e.content,{attributes:r,indices:a,modelMatrix:h,cartographicOrigin:l,coordinateSystem:_=Jt.METER_OFFSETS,material:v,featureIds:S}=i,{_getMeshColor:I}=this.props,B=n&&n.props.mesh||new Eh({drawMode:4,attributes:fJ(r),indices:a}),z=this.getSubLayerClass("mesh",uw);return new z(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:B,data:F2,getColor:I(e),pbrMaterial:v,modelMatrix:h,coordinateOrigin:l,coordinateSystem:_,featureIds:S,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:n}=this.state;return e?e.tiles.map(i=>{const r=n[i.id]=n[i.id]||{tile:i};let{layer:a}=r;return i.selected&&(a?r.needsUpdate&&(a=this._getSubLayer(i,a),r.needsUpdate=!1):a=this._getSubLayer(i)),r.layer=a,a}).filter(Boolean):null}}R(vw,"defaultProps",dJ);R(vw,"layerName","Tile3DLayer");function fJ(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}const pJ=new Wb({ambientLight:new vB({color:[255,182,193],intensity:.6}),pointLight1:new qS({color:[255,255,255],intensity:.8,position:[-.144528,49.739968,8e4]}),pointLight2:new qS({color:[255,255,255],intensity:.8,position:[-3.807751,54.104682,8e3]}),directionalLight:new G1({color:[255,255,255],intensity:.8,direction:[-3,-9,-1]})}),mJ={ambient:.8,diffuse:.6,shininess:300,specularColor:[255,255,255]},gJ=-80,_J={trailColor0:[253,128,93],trailColor1:[23,184,190]},yJ={longitude:139.7089732914856,latitude:35.695,zoom:14.5,pitch:45,bearing:0};function vJ({initialViewState:t=yJ,trips:e="./trips.json",mapStyle:n="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json",theme:i=_J,loopLength:r=4,animationSpeed:a=.01,initialTrailLength:h=3,initialWidthMinPixels:l=2,initialBuildingOpacity:_=.8}){const[v,S]=it.useState(0),[I]=it.useState({}),B=()=>{S(ae=>(ae+a)%r),I.id=window.requestAnimationFrame(B)};it.useEffect(()=>(I.id=window.requestAnimationFrame(B),()=>window.cancelAnimationFrame(I.id)),[I]);const[z,V]=it.useState(h),[J,ue]=it.useState(l),[j,W]=it.useState(_),Z=[new vw({id:"3d-tiles",data:"https://assets.cms.plateau.reearth.io/assets/4a/878097-66f2-4a39-b9fc-85ffee93dbdc/13100_tokyo23-ku_2022_3dtiles_1_1_op_bldg_13104_shinjuku-ku_lod2_no_texture/tileset.json",loader:yw,opacity:j,MATERIAL:mJ,onTileLoad:ae=>{ae.content.cartographicOrigin=new Te(ae.content.cartographicOrigin.x,ae.content.cartographicOrigin.y,ae.content.cartographicOrigin.z+gJ)}}),new tw({id:"trips",data:e,getPath:ae=>ae.waypoints,getTimestamps:ae=>ae.timestamps,getColor:ae=>Math.random()<.5?i.trailColor0:i.trailColor1,currentTime:v,fadeTrail:!0,trailLength:z,opacity:.95,widthMinPixels:J,capRounded:!0,jointRounded:!0})];return ki.jsxs(ki.Fragment,{children:[ki.jsxs("div",{class:"absolute left-5 top-5 z-10 bg-neutral-900/80 text-white p-3 flex flex-col gap-2",children:[ki.jsx("h1",{className:"font-bold text-lg",children:"deck.gl - TripsLayer"}),ki.jsx("div",{className:"text-xs",children:"OpenStreetMapからランダム生成した経路"}),ki.jsxs("div",{className:"flex flex-col gap-1.5",children:[ki.jsxs("div",{className:"flex gap-3",children:[ki.jsx("input",{type:"range",min:"1",max:"15",value:J,onChange:ae=>ue(ae.target.valueAsNumber)}),ki.jsx("label",{className:"block text-xs",children:"軌跡の幅"})]}),ki.jsxs("div",{className:"flex gap-3",children:[ki.jsx("input",{type:"range",min:"0.5",max:"20",step:"0.5",value:z,onChange:ae=>V(ae.target.valueAsNumber)}),ki.jsx("label",{className:"block text-xs",children:"軌跡の長さ"})]}),ki.jsxs("div",{className:"flex gap-3",children:[ki.jsx("input",{type:"range",min:"0",max:"1.0",step:"0.1",value:j,onChange:ae=>W(ae.target.valueAsNumber)}),ki.jsx("label",{className:"block text-xs",children:"建物透過度"})]})]})]}),ki.jsx(VH,{layers:Z,initialViewState:t,controller:!0,effects:[pJ],children:ki.jsx(XF,{reuseMaps:!0,mapLib:ZF,mapStyle:n,preventStyleDiffing:!0,attributionControl:!0})})]})}Bv.createRoot(document.getElementById("root")).render(ki.jsx(h3.StrictMode,{children:ki.jsx(vJ,{})}));
