function hw(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var f8=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var oE={exports:{}},uu={},aE={exports:{}},$={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ea=Symbol.for("react.element"),fw=Symbol.for("react.portal"),dw=Symbol.for("react.fragment"),gw=Symbol.for("react.strict_mode"),pw=Symbol.for("react.profiler"),mw=Symbol.for("react.provider"),_w=Symbol.for("react.context"),yw=Symbol.for("react.forward_ref"),vw=Symbol.for("react.suspense"),Aw=Symbol.for("react.memo"),Ew=Symbol.for("react.lazy"),$m=Symbol.iterator;function Tw(t){return t===null||typeof t!="object"?null:(t=$m&&t[$m]||t["@@iterator"],typeof t=="function"?t:null)}var lE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},cE=Object.assign,uE={};function Us(t,e,n){this.props=t,this.context=e,this.refs=uE,this.updater=n||lE}Us.prototype.isReactComponent={};Us.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Us.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function hE(){}hE.prototype=Us.prototype;function Ag(t,e,n){this.props=t,this.context=e,this.refs=uE,this.updater=n||lE}var Eg=Ag.prototype=new hE;Eg.constructor=Ag;cE(Eg,Us.prototype);Eg.isPureReactComponent=!0;var e0=Array.isArray,fE=Object.prototype.hasOwnProperty,Tg={current:null},dE={key:!0,ref:!0,__self:!0,__source:!0};function gE(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)fE.call(e,r)&&!dE.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ea,type:t,key:s,ref:o,props:i,_owner:Tg.current}}function bw(t,e){return{$$typeof:Ea,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function bg(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ea}function Cw(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var t0=/\/+/g;function $u(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Cw(""+t.key):e.toString(36)}function Jl(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Ea:case fw:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+$u(o,0):r,e0(i)?(n="",t!=null&&(n=t.replace(t0,"$&/")+"/"),Jl(i,e,n,"",function(c){return c})):i!=null&&(bg(i)&&(i=bw(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(t0,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",e0(t))for(var a=0;a<t.length;a++){s=t[a];var l=r+$u(s,a);o+=Jl(s,e,n,l,i)}else if(l=Tw(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=r+$u(s,a++),o+=Jl(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function qa(t,e,n){if(t==null)return t;var r=[],i=0;return Jl(t,r,"","",function(s){return e.call(n,s,i++)}),r}function Sw(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ot={current:null},Xl={transition:null},ww={ReactCurrentDispatcher:ot,ReactCurrentBatchConfig:Xl,ReactCurrentOwner:Tg};$.Children={map:qa,forEach:function(t,e,n){qa(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return qa(t,function(){e++}),e},toArray:function(t){return qa(t,function(e){return e})||[]},only:function(t){if(!bg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};$.Component=Us;$.Fragment=dw;$.Profiler=pw;$.PureComponent=Ag;$.StrictMode=gw;$.Suspense=vw;$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ww;$.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=cE({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Tg.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)fE.call(e,l)&&!dE.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:Ea,type:t.type,key:i,ref:s,props:r,_owner:o}};$.createContext=function(t){return t={$$typeof:_w,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:mw,_context:t},t.Consumer=t};$.createElement=gE;$.createFactory=function(t){var e=gE.bind(null,t);return e.type=t,e};$.createRef=function(){return{current:null}};$.forwardRef=function(t){return{$$typeof:yw,render:t}};$.isValidElement=bg;$.lazy=function(t){return{$$typeof:Ew,_payload:{_status:-1,_result:t},_init:Sw}};$.memo=function(t,e){return{$$typeof:Aw,type:t,compare:e===void 0?null:e}};$.startTransition=function(t){var e=Xl.transition;Xl.transition={};try{t()}finally{Xl.transition=e}};$.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};$.useCallback=function(t,e){return ot.current.useCallback(t,e)};$.useContext=function(t){return ot.current.useContext(t)};$.useDebugValue=function(){};$.useDeferredValue=function(t){return ot.current.useDeferredValue(t)};$.useEffect=function(t,e){return ot.current.useEffect(t,e)};$.useId=function(){return ot.current.useId()};$.useImperativeHandle=function(t,e,n){return ot.current.useImperativeHandle(t,e,n)};$.useInsertionEffect=function(t,e){return ot.current.useInsertionEffect(t,e)};$.useLayoutEffect=function(t,e){return ot.current.useLayoutEffect(t,e)};$.useMemo=function(t,e){return ot.current.useMemo(t,e)};$.useReducer=function(t,e,n){return ot.current.useReducer(t,e,n)};$.useRef=function(t){return ot.current.useRef(t)};$.useState=function(t){return ot.current.useState(t)};$.useSyncExternalStore=function(t,e,n){return ot.current.useSyncExternalStore(t,e,n)};$.useTransition=function(){return ot.current.useTransition()};$.version="18.2.0";aE.exports=$;var D=aE.exports;const xw=vg(D);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pw=D,Iw=Symbol.for("react.element"),Lw=Symbol.for("react.fragment"),Mw=Object.prototype.hasOwnProperty,Bw=Pw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Rw={key:!0,ref:!0,__self:!0,__source:!0};function pE(t,e,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)Mw.call(e,r)&&!Rw.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:Iw,type:t,key:s,ref:o,props:i,_owner:Bw.current}}uu.Fragment=Lw;uu.jsx=pE;uu.jsxs=pE;oE.exports=uu;var Ne=oE.exports,Bf={},mE={exports:{}},Bt={},_E={exports:{}},yE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(U,H){var J=U.length;U.push(H);e:for(;0<J;){var he=J-1>>>1,fe=U[he];if(0<i(fe,H))U[he]=H,U[J]=fe,J=he;else break e}}function n(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var H=U[0],J=U.pop();if(J!==H){U[0]=J;e:for(var he=0,fe=U.length,mr=fe>>>1;he<mr;){var qt=2*(he+1)-1,js=U[qt],Un=qt+1,xe=U[Un];if(0>i(js,J))Un<fe&&0>i(xe,js)?(U[he]=xe,U[Un]=J,he=Un):(U[he]=js,U[qt]=J,he=qt);else if(Un<fe&&0>i(xe,J))U[he]=xe,U[Un]=J,he=Un;else break e}}return H}function i(U,H){var J=U.sortIndex-H.sortIndex;return J!==0?J:U.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,g=!1,p=!1,v=!1,T=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(U){for(var H=n(c);H!==null;){if(H.callback===null)r(c);else if(H.startTime<=U)r(c),H.sortIndex=H.expirationTime,e(l,H);else break;H=n(c)}}function b(U){if(v=!1,y(U),!p)if(n(l)!==null)p=!0,Nn(S);else{var H=n(c);H!==null&&yn(b,H.startTime-U)}}function S(U,H){p=!1,v&&(v=!1,m(L),L=-1),g=!0;var J=f;try{for(y(H),h=n(l);h!==null&&(!(h.expirationTime>H)||U&&!G());){var he=h.callback;if(typeof he=="function"){h.callback=null,f=h.priorityLevel;var fe=he(h.expirationTime<=H);H=t.unstable_now(),typeof fe=="function"?h.callback=fe:h===n(l)&&r(l),y(H)}else r(l);h=n(l)}if(h!==null)var mr=!0;else{var qt=n(c);qt!==null&&yn(b,qt.startTime-H),mr=!1}return mr}finally{h=null,f=J,g=!1}}var w=!1,I=null,L=-1,B=5,M=-1;function G(){return!(t.unstable_now()-M<B)}function W(){if(I!==null){var U=t.unstable_now();M=U;var H=!0;try{H=I(!0,U)}finally{H?j():(w=!1,I=null)}}else w=!1}var j;if(typeof _=="function")j=function(){_(W)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,lt=Y.port2;Y.port1.onmessage=W,j=function(){lt.postMessage(null)}}else j=function(){T(W,0)};function Nn(U){I=U,w||(w=!0,j())}function yn(U,H){L=T(function(){U(t.unstable_now())},H)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_continueExecution=function(){p||g||(p=!0,Nn(S))},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(U){switch(f){case 1:case 2:case 3:var H=3;break;default:H=f}var J=f;f=H;try{return U()}finally{f=J}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(U,H){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var J=f;f=U;try{return H()}finally{f=J}},t.unstable_scheduleCallback=function(U,H,J){var he=t.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?he+J:he):J=he,U){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=J+fe,U={id:u++,callback:H,priorityLevel:U,startTime:J,expirationTime:fe,sortIndex:-1},J>he?(U.sortIndex=J,e(c,U),n(l)===null&&U===n(c)&&(v?(m(L),L=-1):v=!0,yn(b,J-he))):(U.sortIndex=fe,e(l,U),p||g||(p=!0,Nn(S))),U},t.unstable_shouldYield=G,t.unstable_wrapCallback=function(U){var H=f;return function(){var J=f;f=H;try{return U.apply(this,arguments)}finally{f=J}}}})(yE);_E.exports=yE;var Ow=_E.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vE=D,Lt=Ow;function O(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var AE=new Set,Wo={};function Ci(t,e){As(t,e),As(t+"Capture",e)}function As(t,e){for(Wo[t]=e,t=0;t<e.length;t++)AE.add(e[t])}var nr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Rf=Object.prototype.hasOwnProperty,Fw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,n0={},r0={};function Dw(t){return Rf.call(r0,t)?!0:Rf.call(n0,t)?!1:Fw.test(t)?r0[t]=!0:(n0[t]=!0,!1)}function Nw(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Uw(t,e,n,r){if(e===null||typeof e>"u"||Nw(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function at(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var We={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){We[t]=new at(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];We[e]=new at(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){We[t]=new at(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){We[t]=new at(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){We[t]=new at(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){We[t]=new at(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){We[t]=new at(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){We[t]=new at(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){We[t]=new at(t,5,!1,t.toLowerCase(),null,!1,!1)});var Cg=/[\-:]([a-z])/g;function Sg(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Cg,Sg);We[e]=new at(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Cg,Sg);We[e]=new at(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Cg,Sg);We[e]=new at(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){We[t]=new at(t,1,!1,t.toLowerCase(),null,!1,!1)});We.xlinkHref=new at("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){We[t]=new at(t,1,!1,t.toLowerCase(),null,!0,!0)});function wg(t,e,n,r){var i=We.hasOwnProperty(e)?We[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Uw(e,n,i,r)&&(n=null),r||i===null?Dw(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var hr=vE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Za=Symbol.for("react.element"),Ji=Symbol.for("react.portal"),Xi=Symbol.for("react.fragment"),xg=Symbol.for("react.strict_mode"),Of=Symbol.for("react.profiler"),EE=Symbol.for("react.provider"),TE=Symbol.for("react.context"),Pg=Symbol.for("react.forward_ref"),Ff=Symbol.for("react.suspense"),Df=Symbol.for("react.suspense_list"),Ig=Symbol.for("react.memo"),wr=Symbol.for("react.lazy"),bE=Symbol.for("react.offscreen"),i0=Symbol.iterator;function qs(t){return t===null||typeof t!="object"?null:(t=i0&&t[i0]||t["@@iterator"],typeof t=="function"?t:null)}var Ee=Object.assign,eh;function Eo(t){if(eh===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);eh=e&&e[1]||""}return`
`+eh+t}var th=!1;function nh(t,e){if(!t||th)return"";th=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{th=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Eo(t):""}function kw(t){switch(t.tag){case 5:return Eo(t.type);case 16:return Eo("Lazy");case 13:return Eo("Suspense");case 19:return Eo("SuspenseList");case 0:case 2:case 15:return t=nh(t.type,!1),t;case 11:return t=nh(t.type.render,!1),t;case 1:return t=nh(t.type,!0),t;default:return""}}function Nf(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Xi:return"Fragment";case Ji:return"Portal";case Of:return"Profiler";case xg:return"StrictMode";case Ff:return"Suspense";case Df:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case TE:return(t.displayName||"Context")+".Consumer";case EE:return(t._context.displayName||"Context")+".Provider";case Pg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Ig:return e=t.displayName||null,e!==null?e:Nf(t.type)||"Memo";case wr:e=t._payload,t=t._init;try{return Nf(t(e))}catch{}}return null}function Gw(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Nf(e);case 8:return e===xg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Hr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function CE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function zw(t){var e=CE(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function $a(t){t._valueTracker||(t._valueTracker=zw(t))}function SE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=CE(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function yc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Uf(t,e){var n=e.checked;return Ee({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function s0(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Hr(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function wE(t,e){e=e.checked,e!=null&&wg(t,"checked",e,!1)}function kf(t,e){wE(t,e);var n=Hr(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Gf(t,e.type,n):e.hasOwnProperty("defaultValue")&&Gf(t,e.type,Hr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function o0(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Gf(t,e,n){(e!=="number"||yc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var To=Array.isArray;function cs(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Hr(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function zf(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(O(91));return Ee({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function a0(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(O(92));if(To(n)){if(1<n.length)throw Error(O(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Hr(n)}}function xE(t,e){var n=Hr(e.value),r=Hr(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function l0(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function PE(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Vf(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?PE(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var el,IE=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(el=el||document.createElement("div"),el.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=el.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Jo(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Io={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Vw=["Webkit","ms","Moz","O"];Object.keys(Io).forEach(function(t){Vw.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Io[e]=Io[t]})});function LE(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Io.hasOwnProperty(t)&&Io[t]?(""+e).trim():e+"px"}function ME(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=LE(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var jw=Ee({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function jf(t,e){if(e){if(jw[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(O(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(O(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(O(61))}if(e.style!=null&&typeof e.style!="object")throw Error(O(62))}}function Hf(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wf=null;function Lg(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Jf=null,us=null,hs=null;function c0(t){if(t=Ca(t)){if(typeof Jf!="function")throw Error(O(280));var e=t.stateNode;e&&(e=pu(e),Jf(t.stateNode,t.type,e))}}function BE(t){us?hs?hs.push(t):hs=[t]:us=t}function RE(){if(us){var t=us,e=hs;if(hs=us=null,c0(t),e)for(t=0;t<e.length;t++)c0(e[t])}}function OE(t,e){return t(e)}function FE(){}var rh=!1;function DE(t,e,n){if(rh)return t(e,n);rh=!0;try{return OE(t,e,n)}finally{rh=!1,(us!==null||hs!==null)&&(FE(),RE())}}function Xo(t,e){var n=t.stateNode;if(n===null)return null;var r=pu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(O(231,e,typeof n));return n}var Xf=!1;if(nr)try{var Zs={};Object.defineProperty(Zs,"passive",{get:function(){Xf=!0}}),window.addEventListener("test",Zs,Zs),window.removeEventListener("test",Zs,Zs)}catch{Xf=!1}function Hw(t,e,n,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Lo=!1,vc=null,Ac=!1,Kf=null,Ww={onError:function(t){Lo=!0,vc=t}};function Jw(t,e,n,r,i,s,o,a,l){Lo=!1,vc=null,Hw.apply(Ww,arguments)}function Xw(t,e,n,r,i,s,o,a,l){if(Jw.apply(this,arguments),Lo){if(Lo){var c=vc;Lo=!1,vc=null}else throw Error(O(198));Ac||(Ac=!0,Kf=c)}}function Si(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function NE(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function u0(t){if(Si(t)!==t)throw Error(O(188))}function Kw(t){var e=t.alternate;if(!e){if(e=Si(t),e===null)throw Error(O(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return u0(i),t;if(s===r)return u0(i),e;s=s.sibling}throw Error(O(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(O(189))}}if(n.alternate!==r)throw Error(O(190))}if(n.tag!==3)throw Error(O(188));return n.stateNode.current===n?t:e}function UE(t){return t=Kw(t),t!==null?kE(t):null}function kE(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=kE(t);if(e!==null)return e;t=t.sibling}return null}var GE=Lt.unstable_scheduleCallback,h0=Lt.unstable_cancelCallback,Yw=Lt.unstable_shouldYield,Qw=Lt.unstable_requestPaint,we=Lt.unstable_now,qw=Lt.unstable_getCurrentPriorityLevel,Mg=Lt.unstable_ImmediatePriority,zE=Lt.unstable_UserBlockingPriority,Ec=Lt.unstable_NormalPriority,Zw=Lt.unstable_LowPriority,VE=Lt.unstable_IdlePriority,hu=null,On=null;function $w(t){if(On&&typeof On.onCommitFiberRoot=="function")try{On.onCommitFiberRoot(hu,t,void 0,(t.current.flags&128)===128)}catch{}}var un=Math.clz32?Math.clz32:nx,ex=Math.log,tx=Math.LN2;function nx(t){return t>>>=0,t===0?32:31-(ex(t)/tx|0)|0}var tl=64,nl=4194304;function bo(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Tc(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=bo(a):(s&=o,s!==0&&(r=bo(s)))}else o=n&~i,o!==0?r=bo(o):s!==0&&(r=bo(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-un(e),i=1<<n,r|=t[n],e&=~i;return r}function rx(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ix(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-un(s),a=1<<o,l=i[o];l===-1?(!(a&n)||a&r)&&(i[o]=rx(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function Yf(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function jE(){var t=tl;return tl<<=1,!(tl&4194240)&&(tl=64),t}function ih(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ta(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-un(e),t[e]=n}function sx(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-un(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Bg(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-un(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var se=0;function HE(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var WE,Rg,JE,XE,KE,Qf=!1,rl=[],Or=null,Fr=null,Dr=null,Ko=new Map,Yo=new Map,Pr=[],ox="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function f0(t,e){switch(t){case"focusin":case"focusout":Or=null;break;case"dragenter":case"dragleave":Fr=null;break;case"mouseover":case"mouseout":Dr=null;break;case"pointerover":case"pointerout":Ko.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Yo.delete(e.pointerId)}}function $s(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Ca(e),e!==null&&Rg(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function ax(t,e,n,r,i){switch(e){case"focusin":return Or=$s(Or,t,e,n,r,i),!0;case"dragenter":return Fr=$s(Fr,t,e,n,r,i),!0;case"mouseover":return Dr=$s(Dr,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return Ko.set(s,$s(Ko.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Yo.set(s,$s(Yo.get(s)||null,t,e,n,r,i)),!0}return!1}function YE(t){var e=oi(t.target);if(e!==null){var n=Si(e);if(n!==null){if(e=n.tag,e===13){if(e=NE(n),e!==null){t.blockedOn=e,KE(t.priority,function(){JE(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Kl(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=qf(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Wf=r,n.target.dispatchEvent(r),Wf=null}else return e=Ca(n),e!==null&&Rg(e),t.blockedOn=n,!1;e.shift()}return!0}function d0(t,e,n){Kl(t)&&n.delete(e)}function lx(){Qf=!1,Or!==null&&Kl(Or)&&(Or=null),Fr!==null&&Kl(Fr)&&(Fr=null),Dr!==null&&Kl(Dr)&&(Dr=null),Ko.forEach(d0),Yo.forEach(d0)}function eo(t,e){t.blockedOn===e&&(t.blockedOn=null,Qf||(Qf=!0,Lt.unstable_scheduleCallback(Lt.unstable_NormalPriority,lx)))}function Qo(t){function e(i){return eo(i,t)}if(0<rl.length){eo(rl[0],t);for(var n=1;n<rl.length;n++){var r=rl[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Or!==null&&eo(Or,t),Fr!==null&&eo(Fr,t),Dr!==null&&eo(Dr,t),Ko.forEach(e),Yo.forEach(e),n=0;n<Pr.length;n++)r=Pr[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Pr.length&&(n=Pr[0],n.blockedOn===null);)YE(n),n.blockedOn===null&&Pr.shift()}var fs=hr.ReactCurrentBatchConfig,bc=!0;function cx(t,e,n,r){var i=se,s=fs.transition;fs.transition=null;try{se=1,Og(t,e,n,r)}finally{se=i,fs.transition=s}}function ux(t,e,n,r){var i=se,s=fs.transition;fs.transition=null;try{se=4,Og(t,e,n,r)}finally{se=i,fs.transition=s}}function Og(t,e,n,r){if(bc){var i=qf(t,e,n,r);if(i===null)gh(t,e,r,Cc,n),f0(t,r);else if(ax(i,t,e,n,r))r.stopPropagation();else if(f0(t,r),e&4&&-1<ox.indexOf(t)){for(;i!==null;){var s=Ca(i);if(s!==null&&WE(s),s=qf(t,e,n,r),s===null&&gh(t,e,r,Cc,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else gh(t,e,r,null,n)}}var Cc=null;function qf(t,e,n,r){if(Cc=null,t=Lg(r),t=oi(t),t!==null)if(e=Si(t),e===null)t=null;else if(n=e.tag,n===13){if(t=NE(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Cc=t,null}function QE(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qw()){case Mg:return 1;case zE:return 4;case Ec:case Zw:return 16;case VE:return 536870912;default:return 16}default:return 16}}var Lr=null,Fg=null,Yl=null;function qE(){if(Yl)return Yl;var t,e=Fg,n=e.length,r,i="value"in Lr?Lr.value:Lr.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return Yl=i.slice(t,1<r?1-r:void 0)}function Ql(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function il(){return!0}function g0(){return!1}function Rt(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?il:g0,this.isPropagationStopped=g0,this}return Ee(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=il)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=il)},persist:function(){},isPersistent:il}),e}var ks={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Dg=Rt(ks),ba=Ee({},ks,{view:0,detail:0}),hx=Rt(ba),sh,oh,to,fu=Ee({},ba,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ng,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==to&&(to&&t.type==="mousemove"?(sh=t.screenX-to.screenX,oh=t.screenY-to.screenY):oh=sh=0,to=t),sh)},movementY:function(t){return"movementY"in t?t.movementY:oh}}),p0=Rt(fu),fx=Ee({},fu,{dataTransfer:0}),dx=Rt(fx),gx=Ee({},ba,{relatedTarget:0}),ah=Rt(gx),px=Ee({},ks,{animationName:0,elapsedTime:0,pseudoElement:0}),mx=Rt(px),_x=Ee({},ks,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),yx=Rt(_x),vx=Ee({},ks,{data:0}),m0=Rt(vx),Ax={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ex={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bx(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Tx[t])?!!e[t]:!1}function Ng(){return bx}var Cx=Ee({},ba,{key:function(t){if(t.key){var e=Ax[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Ql(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Ex[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ng,charCode:function(t){return t.type==="keypress"?Ql(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ql(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Sx=Rt(Cx),wx=Ee({},fu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_0=Rt(wx),xx=Ee({},ba,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ng}),Px=Rt(xx),Ix=Ee({},ks,{propertyName:0,elapsedTime:0,pseudoElement:0}),Lx=Rt(Ix),Mx=Ee({},fu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Bx=Rt(Mx),Rx=[9,13,27,32],Ug=nr&&"CompositionEvent"in window,Mo=null;nr&&"documentMode"in document&&(Mo=document.documentMode);var Ox=nr&&"TextEvent"in window&&!Mo,ZE=nr&&(!Ug||Mo&&8<Mo&&11>=Mo),y0=String.fromCharCode(32),v0=!1;function $E(t,e){switch(t){case"keyup":return Rx.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function e1(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ki=!1;function Fx(t,e){switch(t){case"compositionend":return e1(e);case"keypress":return e.which!==32?null:(v0=!0,y0);case"textInput":return t=e.data,t===y0&&v0?null:t;default:return null}}function Dx(t,e){if(Ki)return t==="compositionend"||!Ug&&$E(t,e)?(t=qE(),Yl=Fg=Lr=null,Ki=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return ZE&&e.locale!=="ko"?null:e.data;default:return null}}var Nx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function A0(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Nx[t.type]:e==="textarea"}function t1(t,e,n,r){BE(r),e=Sc(e,"onChange"),0<e.length&&(n=new Dg("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Bo=null,qo=null;function Ux(t){f1(t,0)}function du(t){var e=qi(t);if(SE(e))return t}function kx(t,e){if(t==="change")return e}var n1=!1;if(nr){var lh;if(nr){var ch="oninput"in document;if(!ch){var E0=document.createElement("div");E0.setAttribute("oninput","return;"),ch=typeof E0.oninput=="function"}lh=ch}else lh=!1;n1=lh&&(!document.documentMode||9<document.documentMode)}function T0(){Bo&&(Bo.detachEvent("onpropertychange",r1),qo=Bo=null)}function r1(t){if(t.propertyName==="value"&&du(qo)){var e=[];t1(e,qo,t,Lg(t)),DE(Ux,e)}}function Gx(t,e,n){t==="focusin"?(T0(),Bo=e,qo=n,Bo.attachEvent("onpropertychange",r1)):t==="focusout"&&T0()}function zx(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return du(qo)}function Vx(t,e){if(t==="click")return du(e)}function jx(t,e){if(t==="input"||t==="change")return du(e)}function Hx(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var pn=typeof Object.is=="function"?Object.is:Hx;function Zo(t,e){if(pn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Rf.call(e,i)||!pn(t[i],e[i]))return!1}return!0}function b0(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function C0(t,e){var n=b0(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=b0(n)}}function i1(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?i1(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function s1(){for(var t=window,e=yc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=yc(t.document)}return e}function kg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Wx(t){var e=s1(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&i1(n.ownerDocument.documentElement,n)){if(r!==null&&kg(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=C0(n,s);var o=C0(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Jx=nr&&"documentMode"in document&&11>=document.documentMode,Yi=null,Zf=null,Ro=null,$f=!1;function S0(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;$f||Yi==null||Yi!==yc(r)||(r=Yi,"selectionStart"in r&&kg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ro&&Zo(Ro,r)||(Ro=r,r=Sc(Zf,"onSelect"),0<r.length&&(e=new Dg("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Yi)))}function sl(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Qi={animationend:sl("Animation","AnimationEnd"),animationiteration:sl("Animation","AnimationIteration"),animationstart:sl("Animation","AnimationStart"),transitionend:sl("Transition","TransitionEnd")},uh={},o1={};nr&&(o1=document.createElement("div").style,"AnimationEvent"in window||(delete Qi.animationend.animation,delete Qi.animationiteration.animation,delete Qi.animationstart.animation),"TransitionEvent"in window||delete Qi.transitionend.transition);function gu(t){if(uh[t])return uh[t];if(!Qi[t])return t;var e=Qi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in o1)return uh[t]=e[n];return t}var a1=gu("animationend"),l1=gu("animationiteration"),c1=gu("animationstart"),u1=gu("transitionend"),h1=new Map,w0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xr(t,e){h1.set(t,e),Ci(e,[t])}for(var hh=0;hh<w0.length;hh++){var fh=w0[hh],Xx=fh.toLowerCase(),Kx=fh[0].toUpperCase()+fh.slice(1);Xr(Xx,"on"+Kx)}Xr(a1,"onAnimationEnd");Xr(l1,"onAnimationIteration");Xr(c1,"onAnimationStart");Xr("dblclick","onDoubleClick");Xr("focusin","onFocus");Xr("focusout","onBlur");Xr(u1,"onTransitionEnd");As("onMouseEnter",["mouseout","mouseover"]);As("onMouseLeave",["mouseout","mouseover"]);As("onPointerEnter",["pointerout","pointerover"]);As("onPointerLeave",["pointerout","pointerover"]);Ci("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ci("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ci("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ci("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ci("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ci("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Co="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yx=new Set("cancel close invalid load scroll toggle".split(" ").concat(Co));function x0(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Xw(r,e,void 0,t),t.currentTarget=null}function f1(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;x0(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;x0(i,a,c),s=l}}}if(Ac)throw t=Kf,Ac=!1,Kf=null,t}function ge(t,e){var n=e[id];n===void 0&&(n=e[id]=new Set);var r=t+"__bubble";n.has(r)||(d1(e,t,2,!1),n.add(r))}function dh(t,e,n){var r=0;e&&(r|=4),d1(n,t,r,e)}var ol="_reactListening"+Math.random().toString(36).slice(2);function $o(t){if(!t[ol]){t[ol]=!0,AE.forEach(function(n){n!=="selectionchange"&&(Yx.has(n)||dh(n,!1,t),dh(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ol]||(e[ol]=!0,dh("selectionchange",!1,e))}}function d1(t,e,n,r){switch(QE(e)){case 1:var i=cx;break;case 4:i=ux;break;default:i=Og}n=i.bind(null,e,n,t),i=void 0,!Xf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function gh(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=oi(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}DE(function(){var c=s,u=Lg(n),h=[];e:{var f=h1.get(t);if(f!==void 0){var g=Dg,p=t;switch(t){case"keypress":if(Ql(n)===0)break e;case"keydown":case"keyup":g=Sx;break;case"focusin":p="focus",g=ah;break;case"focusout":p="blur",g=ah;break;case"beforeblur":case"afterblur":g=ah;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=p0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=dx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=Px;break;case a1:case l1:case c1:g=mx;break;case u1:g=Lx;break;case"scroll":g=hx;break;case"wheel":g=Bx;break;case"copy":case"cut":case"paste":g=yx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=_0}var v=(e&4)!==0,T=!v&&t==="scroll",m=v?f!==null?f+"Capture":null:f;v=[];for(var _=c,y;_!==null;){y=_;var b=y.stateNode;if(y.tag===5&&b!==null&&(y=b,m!==null&&(b=Xo(_,m),b!=null&&v.push(ea(_,b,y)))),T)break;_=_.return}0<v.length&&(f=new g(f,p,null,n,u),h.push({event:f,listeners:v}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",g=t==="mouseout"||t==="pointerout",f&&n!==Wf&&(p=n.relatedTarget||n.fromElement)&&(oi(p)||p[rr]))break e;if((g||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,g?(p=n.relatedTarget||n.toElement,g=c,p=p?oi(p):null,p!==null&&(T=Si(p),p!==T||p.tag!==5&&p.tag!==6)&&(p=null)):(g=null,p=c),g!==p)){if(v=p0,b="onMouseLeave",m="onMouseEnter",_="mouse",(t==="pointerout"||t==="pointerover")&&(v=_0,b="onPointerLeave",m="onPointerEnter",_="pointer"),T=g==null?f:qi(g),y=p==null?f:qi(p),f=new v(b,_+"leave",g,n,u),f.target=T,f.relatedTarget=y,b=null,oi(u)===c&&(v=new v(m,_+"enter",p,n,u),v.target=y,v.relatedTarget=T,b=v),T=b,g&&p)t:{for(v=g,m=p,_=0,y=v;y;y=Bi(y))_++;for(y=0,b=m;b;b=Bi(b))y++;for(;0<_-y;)v=Bi(v),_--;for(;0<y-_;)m=Bi(m),y--;for(;_--;){if(v===m||m!==null&&v===m.alternate)break t;v=Bi(v),m=Bi(m)}v=null}else v=null;g!==null&&P0(h,f,g,v,!1),p!==null&&T!==null&&P0(h,T,p,v,!0)}}e:{if(f=c?qi(c):window,g=f.nodeName&&f.nodeName.toLowerCase(),g==="select"||g==="input"&&f.type==="file")var S=kx;else if(A0(f))if(n1)S=jx;else{S=zx;var w=Gx}else(g=f.nodeName)&&g.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(S=Vx);if(S&&(S=S(t,c))){t1(h,S,n,u);break e}w&&w(t,f,c),t==="focusout"&&(w=f._wrapperState)&&w.controlled&&f.type==="number"&&Gf(f,"number",f.value)}switch(w=c?qi(c):window,t){case"focusin":(A0(w)||w.contentEditable==="true")&&(Yi=w,Zf=c,Ro=null);break;case"focusout":Ro=Zf=Yi=null;break;case"mousedown":$f=!0;break;case"contextmenu":case"mouseup":case"dragend":$f=!1,S0(h,n,u);break;case"selectionchange":if(Jx)break;case"keydown":case"keyup":S0(h,n,u)}var I;if(Ug)e:{switch(t){case"compositionstart":var L="onCompositionStart";break e;case"compositionend":L="onCompositionEnd";break e;case"compositionupdate":L="onCompositionUpdate";break e}L=void 0}else Ki?$E(t,n)&&(L="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(L="onCompositionStart");L&&(ZE&&n.locale!=="ko"&&(Ki||L!=="onCompositionStart"?L==="onCompositionEnd"&&Ki&&(I=qE()):(Lr=u,Fg="value"in Lr?Lr.value:Lr.textContent,Ki=!0)),w=Sc(c,L),0<w.length&&(L=new m0(L,t,null,n,u),h.push({event:L,listeners:w}),I?L.data=I:(I=e1(n),I!==null&&(L.data=I)))),(I=Ox?Fx(t,n):Dx(t,n))&&(c=Sc(c,"onBeforeInput"),0<c.length&&(u=new m0("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:c}),u.data=I))}f1(h,e)})}function ea(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Sc(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Xo(t,n),s!=null&&r.unshift(ea(t,s,i)),s=Xo(t,e),s!=null&&r.push(ea(t,s,i))),t=t.return}return r}function Bi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function P0(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=Xo(n,s),l!=null&&o.unshift(ea(n,l,a))):i||(l=Xo(n,s),l!=null&&o.push(ea(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var Qx=/\r\n?/g,qx=/\u0000|\uFFFD/g;function I0(t){return(typeof t=="string"?t:""+t).replace(Qx,`
`).replace(qx,"")}function al(t,e,n){if(e=I0(e),I0(t)!==e&&n)throw Error(O(425))}function wc(){}var ed=null,td=null;function nd(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var rd=typeof setTimeout=="function"?setTimeout:void 0,Zx=typeof clearTimeout=="function"?clearTimeout:void 0,L0=typeof Promise=="function"?Promise:void 0,$x=typeof queueMicrotask=="function"?queueMicrotask:typeof L0<"u"?function(t){return L0.resolve(null).then(t).catch(eP)}:rd;function eP(t){setTimeout(function(){throw t})}function ph(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Qo(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Qo(e)}function Nr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function M0(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Gs=Math.random().toString(36).slice(2),Pn="__reactFiber$"+Gs,ta="__reactProps$"+Gs,rr="__reactContainer$"+Gs,id="__reactEvents$"+Gs,tP="__reactListeners$"+Gs,nP="__reactHandles$"+Gs;function oi(t){var e=t[Pn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[rr]||n[Pn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=M0(t);t!==null;){if(n=t[Pn])return n;t=M0(t)}return e}t=n,n=t.parentNode}return null}function Ca(t){return t=t[Pn]||t[rr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function qi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(O(33))}function pu(t){return t[ta]||null}var sd=[],Zi=-1;function Kr(t){return{current:t}}function pe(t){0>Zi||(t.current=sd[Zi],sd[Zi]=null,Zi--)}function ue(t,e){Zi++,sd[Zi]=t.current,t.current=e}var Wr={},$e=Kr(Wr),pt=Kr(!1),pi=Wr;function Es(t,e){var n=t.type.contextTypes;if(!n)return Wr;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function mt(t){return t=t.childContextTypes,t!=null}function xc(){pe(pt),pe($e)}function B0(t,e,n){if($e.current!==Wr)throw Error(O(168));ue($e,e),ue(pt,n)}function g1(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(O(108,Gw(t)||"Unknown",i));return Ee({},n,r)}function Pc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Wr,pi=$e.current,ue($e,t),ue(pt,pt.current),!0}function R0(t,e,n){var r=t.stateNode;if(!r)throw Error(O(169));n?(t=g1(t,e,pi),r.__reactInternalMemoizedMergedChildContext=t,pe(pt),pe($e),ue($e,t)):pe(pt),ue(pt,n)}var Wn=null,mu=!1,mh=!1;function p1(t){Wn===null?Wn=[t]:Wn.push(t)}function rP(t){mu=!0,p1(t)}function Yr(){if(!mh&&Wn!==null){mh=!0;var t=0,e=se;try{var n=Wn;for(se=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Wn=null,mu=!1}catch(i){throw Wn!==null&&(Wn=Wn.slice(t+1)),GE(Mg,Yr),i}finally{se=e,mh=!1}}return null}var $i=[],es=0,Ic=null,Lc=0,zt=[],Vt=0,mi=null,Kn=1,Yn="";function ri(t,e){$i[es++]=Lc,$i[es++]=Ic,Ic=t,Lc=e}function m1(t,e,n){zt[Vt++]=Kn,zt[Vt++]=Yn,zt[Vt++]=mi,mi=t;var r=Kn;t=Yn;var i=32-un(r)-1;r&=~(1<<i),n+=1;var s=32-un(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Kn=1<<32-un(e)+i|n<<i|r,Yn=s+t}else Kn=1<<s|n<<i|r,Yn=t}function Gg(t){t.return!==null&&(ri(t,1),m1(t,1,0))}function zg(t){for(;t===Ic;)Ic=$i[--es],$i[es]=null,Lc=$i[--es],$i[es]=null;for(;t===mi;)mi=zt[--Vt],zt[Vt]=null,Yn=zt[--Vt],zt[Vt]=null,Kn=zt[--Vt],zt[Vt]=null}var Pt=null,wt=null,me=!1,rn=null;function _1(t,e){var n=jt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function O0(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Pt=t,wt=Nr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Pt=t,wt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=mi!==null?{id:Kn,overflow:Yn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=jt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Pt=t,wt=null,!0):!1;default:return!1}}function od(t){return(t.mode&1)!==0&&(t.flags&128)===0}function ad(t){if(me){var e=wt;if(e){var n=e;if(!O0(t,e)){if(od(t))throw Error(O(418));e=Nr(n.nextSibling);var r=Pt;e&&O0(t,e)?_1(r,n):(t.flags=t.flags&-4097|2,me=!1,Pt=t)}}else{if(od(t))throw Error(O(418));t.flags=t.flags&-4097|2,me=!1,Pt=t}}}function F0(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Pt=t}function ll(t){if(t!==Pt)return!1;if(!me)return F0(t),me=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!nd(t.type,t.memoizedProps)),e&&(e=wt)){if(od(t))throw y1(),Error(O(418));for(;e;)_1(t,e),e=Nr(e.nextSibling)}if(F0(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(O(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){wt=Nr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}wt=null}}else wt=Pt?Nr(t.stateNode.nextSibling):null;return!0}function y1(){for(var t=wt;t;)t=Nr(t.nextSibling)}function Ts(){wt=Pt=null,me=!1}function Vg(t){rn===null?rn=[t]:rn.push(t)}var iP=hr.ReactCurrentBatchConfig;function tn(t,e){if(t&&t.defaultProps){e=Ee({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Mc=Kr(null),Bc=null,ts=null,jg=null;function Hg(){jg=ts=Bc=null}function Wg(t){var e=Mc.current;pe(Mc),t._currentValue=e}function ld(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function ds(t,e){Bc=t,jg=ts=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(dt=!0),t.firstContext=null)}function Yt(t){var e=t._currentValue;if(jg!==t)if(t={context:t,memoizedValue:e,next:null},ts===null){if(Bc===null)throw Error(O(308));ts=t,Bc.dependencies={lanes:0,firstContext:t}}else ts=ts.next=t;return e}var ai=null;function Jg(t){ai===null?ai=[t]:ai.push(t)}function v1(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,Jg(e)):(n.next=i.next,i.next=n),e.interleaved=n,ir(t,r)}function ir(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var xr=!1;function Xg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function A1(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function $n(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ur(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,te&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,ir(t,n)}return i=r.interleaved,i===null?(e.next=e,Jg(r)):(e.next=i.next,i.next=e),r.interleaved=e,ir(t,n)}function ql(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Bg(t,n)}}function D0(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Rc(t,e,n,r){var i=t.updateQueue;xr=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=i.baseState;o=0,u=c=l=null,a=s;do{var f=a.lane,g=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:g,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,v=a;switch(f=e,g=n,v.tag){case 1:if(p=v.payload,typeof p=="function"){h=p.call(g,h,f);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=v.payload,f=typeof p=="function"?p.call(g,h,f):p,f==null)break e;h=Ee({},h,f);break e;case 2:xr=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else g={eventTime:g,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=g,l=h):u=u.next=g,o|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(1);if(u===null&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);yi|=o,t.lanes=o,t.memoizedState=h}}function N0(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(O(191,i));i.call(r)}}}var E1=new vE.Component().refs;function cd(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ee({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var _u={isMounted:function(t){return(t=t._reactInternals)?Si(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=it(),i=Gr(t),s=$n(r,i);s.payload=e,n!=null&&(s.callback=n),e=Ur(t,s,i),e!==null&&(hn(e,t,i,r),ql(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=it(),i=Gr(t),s=$n(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Ur(t,s,i),e!==null&&(hn(e,t,i,r),ql(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=it(),r=Gr(t),i=$n(n,r);i.tag=2,e!=null&&(i.callback=e),e=Ur(t,i,r),e!==null&&(hn(e,t,r,n),ql(e,t,r))}};function U0(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Zo(n,r)||!Zo(i,s):!0}function T1(t,e,n){var r=!1,i=Wr,s=e.contextType;return typeof s=="object"&&s!==null?s=Yt(s):(i=mt(e)?pi:$e.current,r=e.contextTypes,s=(r=r!=null)?Es(t,i):Wr),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=_u,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function k0(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&_u.enqueueReplaceState(e,e.state,null)}function ud(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs=E1,Xg(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Yt(s):(s=mt(e)?pi:$e.current,i.context=Es(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(cd(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&_u.enqueueReplaceState(i,i.state,null),Rc(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function no(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(O(309));var r=n.stateNode}if(!r)throw Error(O(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;a===E1&&(a=i.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(O(284));if(!n._owner)throw Error(O(290,t))}return t}function cl(t,e){throw t=Object.prototype.toString.call(e),Error(O(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function G0(t){var e=t._init;return e(t._payload)}function b1(t){function e(m,_){if(t){var y=m.deletions;y===null?(m.deletions=[_],m.flags|=16):y.push(_)}}function n(m,_){if(!t)return null;for(;_!==null;)e(m,_),_=_.sibling;return null}function r(m,_){for(m=new Map;_!==null;)_.key!==null?m.set(_.key,_):m.set(_.index,_),_=_.sibling;return m}function i(m,_){return m=zr(m,_),m.index=0,m.sibling=null,m}function s(m,_,y){return m.index=y,t?(y=m.alternate,y!==null?(y=y.index,y<_?(m.flags|=2,_):y):(m.flags|=2,_)):(m.flags|=1048576,_)}function o(m){return t&&m.alternate===null&&(m.flags|=2),m}function a(m,_,y,b){return _===null||_.tag!==6?(_=bh(y,m.mode,b),_.return=m,_):(_=i(_,y),_.return=m,_)}function l(m,_,y,b){var S=y.type;return S===Xi?u(m,_,y.props.children,b,y.key):_!==null&&(_.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===wr&&G0(S)===_.type)?(b=i(_,y.props),b.ref=no(m,_,y),b.return=m,b):(b=rc(y.type,y.key,y.props,null,m.mode,b),b.ref=no(m,_,y),b.return=m,b)}function c(m,_,y,b){return _===null||_.tag!==4||_.stateNode.containerInfo!==y.containerInfo||_.stateNode.implementation!==y.implementation?(_=Ch(y,m.mode,b),_.return=m,_):(_=i(_,y.children||[]),_.return=m,_)}function u(m,_,y,b,S){return _===null||_.tag!==7?(_=fi(y,m.mode,b,S),_.return=m,_):(_=i(_,y),_.return=m,_)}function h(m,_,y){if(typeof _=="string"&&_!==""||typeof _=="number")return _=bh(""+_,m.mode,y),_.return=m,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Za:return y=rc(_.type,_.key,_.props,null,m.mode,y),y.ref=no(m,null,_),y.return=m,y;case Ji:return _=Ch(_,m.mode,y),_.return=m,_;case wr:var b=_._init;return h(m,b(_._payload),y)}if(To(_)||qs(_))return _=fi(_,m.mode,y,null),_.return=m,_;cl(m,_)}return null}function f(m,_,y,b){var S=_!==null?_.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return S!==null?null:a(m,_,""+y,b);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Za:return y.key===S?l(m,_,y,b):null;case Ji:return y.key===S?c(m,_,y,b):null;case wr:return S=y._init,f(m,_,S(y._payload),b)}if(To(y)||qs(y))return S!==null?null:u(m,_,y,b,null);cl(m,y)}return null}function g(m,_,y,b,S){if(typeof b=="string"&&b!==""||typeof b=="number")return m=m.get(y)||null,a(_,m,""+b,S);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Za:return m=m.get(b.key===null?y:b.key)||null,l(_,m,b,S);case Ji:return m=m.get(b.key===null?y:b.key)||null,c(_,m,b,S);case wr:var w=b._init;return g(m,_,y,w(b._payload),S)}if(To(b)||qs(b))return m=m.get(y)||null,u(_,m,b,S,null);cl(_,b)}return null}function p(m,_,y,b){for(var S=null,w=null,I=_,L=_=0,B=null;I!==null&&L<y.length;L++){I.index>L?(B=I,I=null):B=I.sibling;var M=f(m,I,y[L],b);if(M===null){I===null&&(I=B);break}t&&I&&M.alternate===null&&e(m,I),_=s(M,_,L),w===null?S=M:w.sibling=M,w=M,I=B}if(L===y.length)return n(m,I),me&&ri(m,L),S;if(I===null){for(;L<y.length;L++)I=h(m,y[L],b),I!==null&&(_=s(I,_,L),w===null?S=I:w.sibling=I,w=I);return me&&ri(m,L),S}for(I=r(m,I);L<y.length;L++)B=g(I,m,L,y[L],b),B!==null&&(t&&B.alternate!==null&&I.delete(B.key===null?L:B.key),_=s(B,_,L),w===null?S=B:w.sibling=B,w=B);return t&&I.forEach(function(G){return e(m,G)}),me&&ri(m,L),S}function v(m,_,y,b){var S=qs(y);if(typeof S!="function")throw Error(O(150));if(y=S.call(y),y==null)throw Error(O(151));for(var w=S=null,I=_,L=_=0,B=null,M=y.next();I!==null&&!M.done;L++,M=y.next()){I.index>L?(B=I,I=null):B=I.sibling;var G=f(m,I,M.value,b);if(G===null){I===null&&(I=B);break}t&&I&&G.alternate===null&&e(m,I),_=s(G,_,L),w===null?S=G:w.sibling=G,w=G,I=B}if(M.done)return n(m,I),me&&ri(m,L),S;if(I===null){for(;!M.done;L++,M=y.next())M=h(m,M.value,b),M!==null&&(_=s(M,_,L),w===null?S=M:w.sibling=M,w=M);return me&&ri(m,L),S}for(I=r(m,I);!M.done;L++,M=y.next())M=g(I,m,L,M.value,b),M!==null&&(t&&M.alternate!==null&&I.delete(M.key===null?L:M.key),_=s(M,_,L),w===null?S=M:w.sibling=M,w=M);return t&&I.forEach(function(W){return e(m,W)}),me&&ri(m,L),S}function T(m,_,y,b){if(typeof y=="object"&&y!==null&&y.type===Xi&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Za:e:{for(var S=y.key,w=_;w!==null;){if(w.key===S){if(S=y.type,S===Xi){if(w.tag===7){n(m,w.sibling),_=i(w,y.props.children),_.return=m,m=_;break e}}else if(w.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===wr&&G0(S)===w.type){n(m,w.sibling),_=i(w,y.props),_.ref=no(m,w,y),_.return=m,m=_;break e}n(m,w);break}else e(m,w);w=w.sibling}y.type===Xi?(_=fi(y.props.children,m.mode,b,y.key),_.return=m,m=_):(b=rc(y.type,y.key,y.props,null,m.mode,b),b.ref=no(m,_,y),b.return=m,m=b)}return o(m);case Ji:e:{for(w=y.key;_!==null;){if(_.key===w)if(_.tag===4&&_.stateNode.containerInfo===y.containerInfo&&_.stateNode.implementation===y.implementation){n(m,_.sibling),_=i(_,y.children||[]),_.return=m,m=_;break e}else{n(m,_);break}else e(m,_);_=_.sibling}_=Ch(y,m.mode,b),_.return=m,m=_}return o(m);case wr:return w=y._init,T(m,_,w(y._payload),b)}if(To(y))return p(m,_,y,b);if(qs(y))return v(m,_,y,b);cl(m,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,_!==null&&_.tag===6?(n(m,_.sibling),_=i(_,y),_.return=m,m=_):(n(m,_),_=bh(y,m.mode,b),_.return=m,m=_),o(m)):n(m,_)}return T}var bs=b1(!0),C1=b1(!1),Sa={},Fn=Kr(Sa),na=Kr(Sa),ra=Kr(Sa);function li(t){if(t===Sa)throw Error(O(174));return t}function Kg(t,e){switch(ue(ra,e),ue(na,t),ue(Fn,Sa),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Vf(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Vf(e,t)}pe(Fn),ue(Fn,e)}function Cs(){pe(Fn),pe(na),pe(ra)}function S1(t){li(ra.current);var e=li(Fn.current),n=Vf(e,t.type);e!==n&&(ue(na,t),ue(Fn,n))}function Yg(t){na.current===t&&(pe(Fn),pe(na))}var _e=Kr(0);function Oc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var _h=[];function Qg(){for(var t=0;t<_h.length;t++)_h[t]._workInProgressVersionPrimary=null;_h.length=0}var Zl=hr.ReactCurrentDispatcher,yh=hr.ReactCurrentBatchConfig,_i=0,Ae=null,Be=null,Ue=null,Fc=!1,Oo=!1,ia=0,sP=0;function Je(){throw Error(O(321))}function qg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!pn(t[n],e[n]))return!1;return!0}function Zg(t,e,n,r,i,s){if(_i=s,Ae=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Zl.current=t===null||t.memoizedState===null?cP:uP,t=n(r,i),Oo){s=0;do{if(Oo=!1,ia=0,25<=s)throw Error(O(301));s+=1,Ue=Be=null,e.updateQueue=null,Zl.current=hP,t=n(r,i)}while(Oo)}if(Zl.current=Dc,e=Be!==null&&Be.next!==null,_i=0,Ue=Be=Ae=null,Fc=!1,e)throw Error(O(300));return t}function $g(){var t=ia!==0;return ia=0,t}function xn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ue===null?Ae.memoizedState=Ue=t:Ue=Ue.next=t,Ue}function Qt(){if(Be===null){var t=Ae.alternate;t=t!==null?t.memoizedState:null}else t=Be.next;var e=Ue===null?Ae.memoizedState:Ue.next;if(e!==null)Ue=e,Be=t;else{if(t===null)throw Error(O(310));Be=t,t={memoizedState:Be.memoizedState,baseState:Be.baseState,baseQueue:Be.baseQueue,queue:Be.queue,next:null},Ue===null?Ae.memoizedState=Ue=t:Ue=Ue.next=t}return Ue}function sa(t,e){return typeof e=="function"?e(t):e}function vh(t){var e=Qt(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var r=Be,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((_i&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=r):l=l.next=h,Ae.lanes|=u,yi|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,pn(r,e.memoizedState)||(dt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,Ae.lanes|=s,yi|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ah(t){var e=Qt(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);pn(s,e.memoizedState)||(dt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function w1(){}function x1(t,e){var n=Ae,r=Qt(),i=e(),s=!pn(r.memoizedState,i);if(s&&(r.memoizedState=i,dt=!0),r=r.queue,ep(L1.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Ue!==null&&Ue.memoizedState.tag&1){if(n.flags|=2048,oa(9,I1.bind(null,n,r,i,e),void 0,null),Ge===null)throw Error(O(349));_i&30||P1(n,e,i)}return i}function P1(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Ae.updateQueue,e===null?(e={lastEffect:null,stores:null},Ae.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function I1(t,e,n,r){e.value=n,e.getSnapshot=r,M1(e)&&B1(t)}function L1(t,e,n){return n(function(){M1(e)&&B1(t)})}function M1(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!pn(t,n)}catch{return!0}}function B1(t){var e=ir(t,1);e!==null&&hn(e,t,1,-1)}function z0(t){var e=xn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sa,lastRenderedState:t},e.queue=t,t=t.dispatch=lP.bind(null,Ae,t),[e.memoizedState,t]}function oa(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Ae.updateQueue,e===null?(e={lastEffect:null,stores:null},Ae.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function R1(){return Qt().memoizedState}function $l(t,e,n,r){var i=xn();Ae.flags|=t,i.memoizedState=oa(1|e,n,void 0,r===void 0?null:r)}function yu(t,e,n,r){var i=Qt();r=r===void 0?null:r;var s=void 0;if(Be!==null){var o=Be.memoizedState;if(s=o.destroy,r!==null&&qg(r,o.deps)){i.memoizedState=oa(e,n,s,r);return}}Ae.flags|=t,i.memoizedState=oa(1|e,n,s,r)}function V0(t,e){return $l(8390656,8,t,e)}function ep(t,e){return yu(2048,8,t,e)}function O1(t,e){return yu(4,2,t,e)}function F1(t,e){return yu(4,4,t,e)}function D1(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function N1(t,e,n){return n=n!=null?n.concat([t]):null,yu(4,4,D1.bind(null,e,t),n)}function tp(){}function U1(t,e){var n=Qt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&qg(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function k1(t,e){var n=Qt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&qg(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function G1(t,e,n){return _i&21?(pn(n,e)||(n=jE(),Ae.lanes|=n,yi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,dt=!0),t.memoizedState=n)}function oP(t,e){var n=se;se=n!==0&&4>n?n:4,t(!0);var r=yh.transition;yh.transition={};try{t(!1),e()}finally{se=n,yh.transition=r}}function z1(){return Qt().memoizedState}function aP(t,e,n){var r=Gr(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},V1(t))j1(e,n);else if(n=v1(t,e,n,r),n!==null){var i=it();hn(n,t,r,i),H1(n,e,r)}}function lP(t,e,n){var r=Gr(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(V1(t))j1(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,pn(a,o)){var l=e.interleaved;l===null?(i.next=i,Jg(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=v1(t,e,i,r),n!==null&&(i=it(),hn(n,t,r,i),H1(n,e,r))}}function V1(t){var e=t.alternate;return t===Ae||e!==null&&e===Ae}function j1(t,e){Oo=Fc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function H1(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Bg(t,n)}}var Dc={readContext:Yt,useCallback:Je,useContext:Je,useEffect:Je,useImperativeHandle:Je,useInsertionEffect:Je,useLayoutEffect:Je,useMemo:Je,useReducer:Je,useRef:Je,useState:Je,useDebugValue:Je,useDeferredValue:Je,useTransition:Je,useMutableSource:Je,useSyncExternalStore:Je,useId:Je,unstable_isNewReconciler:!1},cP={readContext:Yt,useCallback:function(t,e){return xn().memoizedState=[t,e===void 0?null:e],t},useContext:Yt,useEffect:V0,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,$l(4194308,4,D1.bind(null,e,t),n)},useLayoutEffect:function(t,e){return $l(4194308,4,t,e)},useInsertionEffect:function(t,e){return $l(4,2,t,e)},useMemo:function(t,e){var n=xn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=xn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=aP.bind(null,Ae,t),[r.memoizedState,t]},useRef:function(t){var e=xn();return t={current:t},e.memoizedState=t},useState:z0,useDebugValue:tp,useDeferredValue:function(t){return xn().memoizedState=t},useTransition:function(){var t=z0(!1),e=t[0];return t=oP.bind(null,t[1]),xn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Ae,i=xn();if(me){if(n===void 0)throw Error(O(407));n=n()}else{if(n=e(),Ge===null)throw Error(O(349));_i&30||P1(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,V0(L1.bind(null,r,s,t),[t]),r.flags|=2048,oa(9,I1.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=xn(),e=Ge.identifierPrefix;if(me){var n=Yn,r=Kn;n=(r&~(1<<32-un(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ia++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=sP++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},uP={readContext:Yt,useCallback:U1,useContext:Yt,useEffect:ep,useImperativeHandle:N1,useInsertionEffect:O1,useLayoutEffect:F1,useMemo:k1,useReducer:vh,useRef:R1,useState:function(){return vh(sa)},useDebugValue:tp,useDeferredValue:function(t){var e=Qt();return G1(e,Be.memoizedState,t)},useTransition:function(){var t=vh(sa)[0],e=Qt().memoizedState;return[t,e]},useMutableSource:w1,useSyncExternalStore:x1,useId:z1,unstable_isNewReconciler:!1},hP={readContext:Yt,useCallback:U1,useContext:Yt,useEffect:ep,useImperativeHandle:N1,useInsertionEffect:O1,useLayoutEffect:F1,useMemo:k1,useReducer:Ah,useRef:R1,useState:function(){return Ah(sa)},useDebugValue:tp,useDeferredValue:function(t){var e=Qt();return Be===null?e.memoizedState=t:G1(e,Be.memoizedState,t)},useTransition:function(){var t=Ah(sa)[0],e=Qt().memoizedState;return[t,e]},useMutableSource:w1,useSyncExternalStore:x1,useId:z1,unstable_isNewReconciler:!1};function Ss(t,e){try{var n="",r=e;do n+=kw(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function Eh(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function hd(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var fP=typeof WeakMap=="function"?WeakMap:Map;function W1(t,e,n){n=$n(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Uc||(Uc=!0,Ed=r),hd(t,e)},n}function J1(t,e,n){n=$n(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){hd(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){hd(t,e),typeof r!="function"&&(kr===null?kr=new Set([this]):kr.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function j0(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new fP;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=wP.bind(null,t,e,n),e.then(t,t))}function H0(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function W0(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=$n(-1,1),e.tag=2,Ur(n,e,1))),n.lanes|=1),t)}var dP=hr.ReactCurrentOwner,dt=!1;function nt(t,e,n,r){e.child=t===null?C1(e,null,n,r):bs(e,t.child,n,r)}function J0(t,e,n,r,i){n=n.render;var s=e.ref;return ds(e,i),r=Zg(t,e,n,r,s,i),n=$g(),t!==null&&!dt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,sr(t,e,i)):(me&&n&&Gg(e),e.flags|=1,nt(t,e,r,i),e.child)}function X0(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!cp(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,X1(t,e,s,r,i)):(t=rc(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Zo,n(o,r)&&t.ref===e.ref)return sr(t,e,i)}return e.flags|=1,t=zr(s,r),t.ref=e.ref,t.return=e,e.child=t}function X1(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Zo(s,r)&&t.ref===e.ref)if(dt=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(dt=!0);else return e.lanes=t.lanes,sr(t,e,i)}return fd(t,e,n,r,i)}function K1(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ue(rs,Ct),Ct|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ue(rs,Ct),Ct|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,ue(rs,Ct),Ct|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,ue(rs,Ct),Ct|=r;return nt(t,e,i,n),e.child}function Y1(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function fd(t,e,n,r,i){var s=mt(n)?pi:$e.current;return s=Es(e,s),ds(e,i),n=Zg(t,e,n,r,s,i),r=$g(),t!==null&&!dt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,sr(t,e,i)):(me&&r&&Gg(e),e.flags|=1,nt(t,e,n,i),e.child)}function K0(t,e,n,r,i){if(mt(n)){var s=!0;Pc(e)}else s=!1;if(ds(e,i),e.stateNode===null)ec(t,e),T1(e,n,r),ud(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=Yt(c):(c=mt(n)?pi:$e.current,c=Es(e,c));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&k0(e,o,r,c),xr=!1;var f=e.memoizedState;o.state=f,Rc(e,r,o,i),l=e.memoizedState,a!==r||f!==l||pt.current||xr?(typeof u=="function"&&(cd(e,n,u,r),l=e.memoizedState),(a=xr||U0(e,n,a,r,f,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,A1(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:tn(e.type,a),o.props=c,h=e.pendingProps,f=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Yt(l):(l=mt(n)?pi:$e.current,l=Es(e,l));var g=n.getDerivedStateFromProps;(u=typeof g=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==l)&&k0(e,o,r,l),xr=!1,f=e.memoizedState,o.state=f,Rc(e,r,o,i);var p=e.memoizedState;a!==h||f!==p||pt.current||xr?(typeof g=="function"&&(cd(e,n,g,r),p=e.memoizedState),(c=xr||U0(e,n,c,r,f,p,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),o.props=r,o.state=p,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return dd(t,e,n,r,s,i)}function dd(t,e,n,r,i,s){Y1(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&R0(e,n,!1),sr(t,e,s);r=e.stateNode,dP.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=bs(e,t.child,null,s),e.child=bs(e,null,a,s)):nt(t,e,a,s),e.memoizedState=r.state,i&&R0(e,n,!0),e.child}function Q1(t){var e=t.stateNode;e.pendingContext?B0(t,e.pendingContext,e.pendingContext!==e.context):e.context&&B0(t,e.context,!1),Kg(t,e.containerInfo)}function Y0(t,e,n,r,i){return Ts(),Vg(i),e.flags|=256,nt(t,e,n,r),e.child}var gd={dehydrated:null,treeContext:null,retryLane:0};function pd(t){return{baseLanes:t,cachePool:null,transitions:null}}function q1(t,e,n){var r=e.pendingProps,i=_e.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),ue(_e,i&1),t===null)return ad(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Eu(o,r,0,null),t=fi(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=pd(n),e.memoizedState=gd,t):np(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return gP(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=zr(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=zr(a,s):(s=fi(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?pd(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=gd,r}return s=t.child,t=s.sibling,r=zr(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function np(t,e){return e=Eu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ul(t,e,n,r){return r!==null&&Vg(r),bs(e,t.child,null,n),t=np(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function gP(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=Eh(Error(O(422))),ul(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Eu({mode:"visible",children:r.children},i,0,null),s=fi(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&bs(e,t.child,null,o),e.child.memoizedState=pd(o),e.memoizedState=gd,s);if(!(e.mode&1))return ul(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(O(419)),r=Eh(s,r,void 0),ul(t,e,o,r)}if(a=(o&t.childLanes)!==0,dt||a){if(r=Ge,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,ir(t,i),hn(r,t,i,-1))}return lp(),r=Eh(Error(O(421))),ul(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=xP.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,wt=Nr(i.nextSibling),Pt=e,me=!0,rn=null,t!==null&&(zt[Vt++]=Kn,zt[Vt++]=Yn,zt[Vt++]=mi,Kn=t.id,Yn=t.overflow,mi=e),e=np(e,r.children),e.flags|=4096,e)}function Q0(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),ld(t.return,e,n)}function Th(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function Z1(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(nt(t,e,r.children,n),r=_e.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Q0(t,n,e);else if(t.tag===19)Q0(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ue(_e,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&Oc(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Th(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Oc(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Th(e,!0,n,null,s);break;case"together":Th(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ec(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function sr(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),yi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(O(153));if(e.child!==null){for(t=e.child,n=zr(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=zr(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function pP(t,e,n){switch(e.tag){case 3:Q1(e),Ts();break;case 5:S1(e);break;case 1:mt(e.type)&&Pc(e);break;case 4:Kg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ue(Mc,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ue(_e,_e.current&1),e.flags|=128,null):n&e.child.childLanes?q1(t,e,n):(ue(_e,_e.current&1),t=sr(t,e,n),t!==null?t.sibling:null);ue(_e,_e.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return Z1(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ue(_e,_e.current),r)break;return null;case 22:case 23:return e.lanes=0,K1(t,e,n)}return sr(t,e,n)}var $1,md,eT,tT;$1=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};md=function(){};eT=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,li(Fn.current);var s=null;switch(n){case"input":i=Uf(t,i),r=Uf(t,r),s=[];break;case"select":i=Ee({},i,{value:void 0}),r=Ee({},r,{value:void 0}),s=[];break;case"textarea":i=zf(t,i),r=zf(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=wc)}jf(n,r);var o;n=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Wo.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Wo.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ge("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};tT=function(t,e,n,r){n!==r&&(e.flags|=4)};function ro(t,e){if(!me)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Xe(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function mP(t,e,n){var r=e.pendingProps;switch(zg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xe(e),null;case 1:return mt(e.type)&&xc(),Xe(e),null;case 3:return r=e.stateNode,Cs(),pe(pt),pe($e),Qg(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ll(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,rn!==null&&(Cd(rn),rn=null))),md(t,e),Xe(e),null;case 5:Yg(e);var i=li(ra.current);if(n=e.type,t!==null&&e.stateNode!=null)eT(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(O(166));return Xe(e),null}if(t=li(Fn.current),ll(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[Pn]=e,r[ta]=s,t=(e.mode&1)!==0,n){case"dialog":ge("cancel",r),ge("close",r);break;case"iframe":case"object":case"embed":ge("load",r);break;case"video":case"audio":for(i=0;i<Co.length;i++)ge(Co[i],r);break;case"source":ge("error",r);break;case"img":case"image":case"link":ge("error",r),ge("load",r);break;case"details":ge("toggle",r);break;case"input":s0(r,s),ge("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},ge("invalid",r);break;case"textarea":a0(r,s),ge("invalid",r)}jf(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&al(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&al(r.textContent,a,t),i=["children",""+a]):Wo.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ge("scroll",r)}switch(n){case"input":$a(r),o0(r,s,!0);break;case"textarea":$a(r),l0(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=wc)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=PE(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Pn]=e,t[ta]=r,$1(t,e,!1,!1),e.stateNode=t;e:{switch(o=Hf(n,r),n){case"dialog":ge("cancel",t),ge("close",t),i=r;break;case"iframe":case"object":case"embed":ge("load",t),i=r;break;case"video":case"audio":for(i=0;i<Co.length;i++)ge(Co[i],t);i=r;break;case"source":ge("error",t),i=r;break;case"img":case"image":case"link":ge("error",t),ge("load",t),i=r;break;case"details":ge("toggle",t),i=r;break;case"input":s0(t,r),i=Uf(t,r),ge("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Ee({},r,{value:void 0}),ge("invalid",t);break;case"textarea":a0(t,r),i=zf(t,r),ge("invalid",t);break;default:i=r}jf(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?ME(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&IE(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Jo(t,l):typeof l=="number"&&Jo(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Wo.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ge("scroll",t):l!=null&&wg(t,s,l,o))}switch(n){case"input":$a(t),o0(t,r,!1);break;case"textarea":$a(t),l0(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Hr(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?cs(t,!!r.multiple,s,!1):r.defaultValue!=null&&cs(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=wc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Xe(e),null;case 6:if(t&&e.stateNode!=null)tT(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(O(166));if(n=li(ra.current),li(Fn.current),ll(e)){if(r=e.stateNode,n=e.memoizedProps,r[Pn]=e,(s=r.nodeValue!==n)&&(t=Pt,t!==null))switch(t.tag){case 3:al(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&al(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Pn]=e,e.stateNode=r}return Xe(e),null;case 13:if(pe(_e),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(me&&wt!==null&&e.mode&1&&!(e.flags&128))y1(),Ts(),e.flags|=98560,s=!1;else if(s=ll(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(O(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(O(317));s[Pn]=e}else Ts(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Xe(e),s=!1}else rn!==null&&(Cd(rn),rn=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||_e.current&1?Re===0&&(Re=3):lp())),e.updateQueue!==null&&(e.flags|=4),Xe(e),null);case 4:return Cs(),md(t,e),t===null&&$o(e.stateNode.containerInfo),Xe(e),null;case 10:return Wg(e.type._context),Xe(e),null;case 17:return mt(e.type)&&xc(),Xe(e),null;case 19:if(pe(_e),s=e.memoizedState,s===null)return Xe(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)ro(s,!1);else{if(Re!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Oc(t),o!==null){for(e.flags|=128,ro(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ue(_e,_e.current&1|2),e.child}t=t.sibling}s.tail!==null&&we()>ws&&(e.flags|=128,r=!0,ro(s,!1),e.lanes=4194304)}else{if(!r)if(t=Oc(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ro(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!me)return Xe(e),null}else 2*we()-s.renderingStartTime>ws&&n!==1073741824&&(e.flags|=128,r=!0,ro(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=we(),e.sibling=null,n=_e.current,ue(_e,r?n&1|2:n&1),e):(Xe(e),null);case 22:case 23:return ap(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Ct&1073741824&&(Xe(e),e.subtreeFlags&6&&(e.flags|=8192)):Xe(e),null;case 24:return null;case 25:return null}throw Error(O(156,e.tag))}function _P(t,e){switch(zg(e),e.tag){case 1:return mt(e.type)&&xc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Cs(),pe(pt),pe($e),Qg(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Yg(e),null;case 13:if(pe(_e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(O(340));Ts()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return pe(_e),null;case 4:return Cs(),null;case 10:return Wg(e.type._context),null;case 22:case 23:return ap(),null;case 24:return null;default:return null}}var hl=!1,qe=!1,yP=typeof WeakSet=="function"?WeakSet:Set,z=null;function ns(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Ce(t,e,r)}else n.current=null}function _d(t,e,n){try{n()}catch(r){Ce(t,e,r)}}var q0=!1;function vP(t,e){if(ed=bc,t=s1(),kg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=t,f=null;t:for(;;){for(var g;h!==n||i!==0&&h.nodeType!==3||(a=o+i),h!==s||r!==0&&h.nodeType!==3||(l=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(g=h.firstChild)!==null;)f=h,h=g;for(;;){if(h===t)break t;if(f===n&&++c===i&&(a=o),f===s&&++u===r&&(l=o),(g=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=g}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(td={focusedElem:t,selectionRange:n},bc=!1,z=e;z!==null;)if(e=z,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,z=t;else for(;z!==null;){e=z;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var v=p.memoizedProps,T=p.memoizedState,m=e.stateNode,_=m.getSnapshotBeforeUpdate(e.elementType===e.type?v:tn(e.type,v),T);m.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(O(163))}}catch(b){Ce(e,e.return,b)}if(t=e.sibling,t!==null){t.return=e.return,z=t;break}z=e.return}return p=q0,q0=!1,p}function Fo(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&_d(e,n,s)}i=i.next}while(i!==r)}}function vu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function yd(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function nT(t){var e=t.alternate;e!==null&&(t.alternate=null,nT(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Pn],delete e[ta],delete e[id],delete e[tP],delete e[nP])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function rT(t){return t.tag===5||t.tag===3||t.tag===4}function Z0(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||rT(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function vd(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=wc));else if(r!==4&&(t=t.child,t!==null))for(vd(t,e,n),t=t.sibling;t!==null;)vd(t,e,n),t=t.sibling}function Ad(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Ad(t,e,n),t=t.sibling;t!==null;)Ad(t,e,n),t=t.sibling}var je=null,nn=!1;function yr(t,e,n){for(n=n.child;n!==null;)iT(t,e,n),n=n.sibling}function iT(t,e,n){if(On&&typeof On.onCommitFiberUnmount=="function")try{On.onCommitFiberUnmount(hu,n)}catch{}switch(n.tag){case 5:qe||ns(n,e);case 6:var r=je,i=nn;je=null,yr(t,e,n),je=r,nn=i,je!==null&&(nn?(t=je,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):je.removeChild(n.stateNode));break;case 18:je!==null&&(nn?(t=je,n=n.stateNode,t.nodeType===8?ph(t.parentNode,n):t.nodeType===1&&ph(t,n),Qo(t)):ph(je,n.stateNode));break;case 4:r=je,i=nn,je=n.stateNode.containerInfo,nn=!0,yr(t,e,n),je=r,nn=i;break;case 0:case 11:case 14:case 15:if(!qe&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&_d(n,e,o),i=i.next}while(i!==r)}yr(t,e,n);break;case 1:if(!qe&&(ns(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Ce(n,e,a)}yr(t,e,n);break;case 21:yr(t,e,n);break;case 22:n.mode&1?(qe=(r=qe)||n.memoizedState!==null,yr(t,e,n),qe=r):yr(t,e,n);break;default:yr(t,e,n)}}function $0(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new yP),e.forEach(function(r){var i=PP.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function $t(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:je=a.stateNode,nn=!1;break e;case 3:je=a.stateNode.containerInfo,nn=!0;break e;case 4:je=a.stateNode.containerInfo,nn=!0;break e}a=a.return}if(je===null)throw Error(O(160));iT(s,o,i),je=null,nn=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){Ce(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)sT(e,t),e=e.sibling}function sT(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if($t(e,t),Tn(t),r&4){try{Fo(3,t,t.return),vu(3,t)}catch(v){Ce(t,t.return,v)}try{Fo(5,t,t.return)}catch(v){Ce(t,t.return,v)}}break;case 1:$t(e,t),Tn(t),r&512&&n!==null&&ns(n,n.return);break;case 5:if($t(e,t),Tn(t),r&512&&n!==null&&ns(n,n.return),t.flags&32){var i=t.stateNode;try{Jo(i,"")}catch(v){Ce(t,t.return,v)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&wE(i,s),Hf(a,o);var c=Hf(a,s);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?ME(i,h):u==="dangerouslySetInnerHTML"?IE(i,h):u==="children"?Jo(i,h):wg(i,u,h,c)}switch(a){case"input":kf(i,s);break;case"textarea":xE(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var g=s.value;g!=null?cs(i,!!s.multiple,g,!1):f!==!!s.multiple&&(s.defaultValue!=null?cs(i,!!s.multiple,s.defaultValue,!0):cs(i,!!s.multiple,s.multiple?[]:"",!1))}i[ta]=s}catch(v){Ce(t,t.return,v)}}break;case 6:if($t(e,t),Tn(t),r&4){if(t.stateNode===null)throw Error(O(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(v){Ce(t,t.return,v)}}break;case 3:if($t(e,t),Tn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Qo(e.containerInfo)}catch(v){Ce(t,t.return,v)}break;case 4:$t(e,t),Tn(t);break;case 13:$t(e,t),Tn(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(sp=we())),r&4&&$0(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(qe=(c=qe)||u,$t(e,t),qe=c):$t(e,t),Tn(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(z=t,u=t.child;u!==null;){for(h=z=u;z!==null;){switch(f=z,g=f.child,f.tag){case 0:case 11:case 14:case 15:Fo(4,f,f.return);break;case 1:ns(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(v){Ce(r,n,v)}}break;case 5:ns(f,f.return);break;case 22:if(f.memoizedState!==null){t_(h);continue}}g!==null?(g.return=f,z=g):t_(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{i=h.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=LE("display",o))}catch(v){Ce(t,t.return,v)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(v){Ce(t,t.return,v)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:$t(e,t),Tn(t),r&4&&$0(t);break;case 21:break;default:$t(e,t),Tn(t)}}function Tn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(rT(n)){var r=n;break e}n=n.return}throw Error(O(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Jo(i,""),r.flags&=-33);var s=Z0(t);Ad(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Z0(t);vd(t,a,o);break;default:throw Error(O(161))}}catch(l){Ce(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function AP(t,e,n){z=t,oT(t)}function oT(t,e,n){for(var r=(t.mode&1)!==0;z!==null;){var i=z,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||hl;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||qe;a=hl;var c=qe;if(hl=o,(qe=l)&&!c)for(z=i;z!==null;)o=z,l=o.child,o.tag===22&&o.memoizedState!==null?n_(i):l!==null?(l.return=o,z=l):n_(i);for(;s!==null;)z=s,oT(s),s=s.sibling;z=i,hl=a,qe=c}e_(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,z=s):e_(t)}}function e_(t){for(;z!==null;){var e=z;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:qe||vu(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!qe)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:tn(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&N0(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}N0(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Qo(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(O(163))}qe||e.flags&512&&yd(e)}catch(f){Ce(e,e.return,f)}}if(e===t){z=null;break}if(n=e.sibling,n!==null){n.return=e.return,z=n;break}z=e.return}}function t_(t){for(;z!==null;){var e=z;if(e===t){z=null;break}var n=e.sibling;if(n!==null){n.return=e.return,z=n;break}z=e.return}}function n_(t){for(;z!==null;){var e=z;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{vu(4,e)}catch(l){Ce(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){Ce(e,i,l)}}var s=e.return;try{yd(e)}catch(l){Ce(e,s,l)}break;case 5:var o=e.return;try{yd(e)}catch(l){Ce(e,o,l)}}}catch(l){Ce(e,e.return,l)}if(e===t){z=null;break}var a=e.sibling;if(a!==null){a.return=e.return,z=a;break}z=e.return}}var EP=Math.ceil,Nc=hr.ReactCurrentDispatcher,rp=hr.ReactCurrentOwner,Xt=hr.ReactCurrentBatchConfig,te=0,Ge=null,Le=null,He=0,Ct=0,rs=Kr(0),Re=0,aa=null,yi=0,Au=0,ip=0,Do=null,ht=null,sp=0,ws=1/0,Hn=null,Uc=!1,Ed=null,kr=null,fl=!1,Mr=null,kc=0,No=0,Td=null,tc=-1,nc=0;function it(){return te&6?we():tc!==-1?tc:tc=we()}function Gr(t){return t.mode&1?te&2&&He!==0?He&-He:iP.transition!==null?(nc===0&&(nc=jE()),nc):(t=se,t!==0||(t=window.event,t=t===void 0?16:QE(t.type)),t):1}function hn(t,e,n,r){if(50<No)throw No=0,Td=null,Error(O(185));Ta(t,n,r),(!(te&2)||t!==Ge)&&(t===Ge&&(!(te&2)&&(Au|=n),Re===4&&Ir(t,He)),_t(t,r),n===1&&te===0&&!(e.mode&1)&&(ws=we()+500,mu&&Yr()))}function _t(t,e){var n=t.callbackNode;ix(t,e);var r=Tc(t,t===Ge?He:0);if(r===0)n!==null&&h0(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&h0(n),e===1)t.tag===0?rP(r_.bind(null,t)):p1(r_.bind(null,t)),$x(function(){!(te&6)&&Yr()}),n=null;else{switch(HE(r)){case 1:n=Mg;break;case 4:n=zE;break;case 16:n=Ec;break;case 536870912:n=VE;break;default:n=Ec}n=gT(n,aT.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function aT(t,e){if(tc=-1,nc=0,te&6)throw Error(O(327));var n=t.callbackNode;if(gs()&&t.callbackNode!==n)return null;var r=Tc(t,t===Ge?He:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Gc(t,r);else{e=r;var i=te;te|=2;var s=cT();(Ge!==t||He!==e)&&(Hn=null,ws=we()+500,hi(t,e));do try{CP();break}catch(a){lT(t,a)}while(1);Hg(),Nc.current=s,te=i,Le!==null?e=0:(Ge=null,He=0,e=Re)}if(e!==0){if(e===2&&(i=Yf(t),i!==0&&(r=i,e=bd(t,i))),e===1)throw n=aa,hi(t,0),Ir(t,r),_t(t,we()),n;if(e===6)Ir(t,r);else{if(i=t.current.alternate,!(r&30)&&!TP(i)&&(e=Gc(t,r),e===2&&(s=Yf(t),s!==0&&(r=s,e=bd(t,s))),e===1))throw n=aa,hi(t,0),Ir(t,r),_t(t,we()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(O(345));case 2:ii(t,ht,Hn);break;case 3:if(Ir(t,r),(r&130023424)===r&&(e=sp+500-we(),10<e)){if(Tc(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){it(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=rd(ii.bind(null,t,ht,Hn),e);break}ii(t,ht,Hn);break;case 4:if(Ir(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-un(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=we()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*EP(r/1960))-r,10<r){t.timeoutHandle=rd(ii.bind(null,t,ht,Hn),r);break}ii(t,ht,Hn);break;case 5:ii(t,ht,Hn);break;default:throw Error(O(329))}}}return _t(t,we()),t.callbackNode===n?aT.bind(null,t):null}function bd(t,e){var n=Do;return t.current.memoizedState.isDehydrated&&(hi(t,e).flags|=256),t=Gc(t,e),t!==2&&(e=ht,ht=n,e!==null&&Cd(e)),t}function Cd(t){ht===null?ht=t:ht.push.apply(ht,t)}function TP(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!pn(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ir(t,e){for(e&=~ip,e&=~Au,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-un(e),r=1<<n;t[n]=-1,e&=~r}}function r_(t){if(te&6)throw Error(O(327));gs();var e=Tc(t,0);if(!(e&1))return _t(t,we()),null;var n=Gc(t,e);if(t.tag!==0&&n===2){var r=Yf(t);r!==0&&(e=r,n=bd(t,r))}if(n===1)throw n=aa,hi(t,0),Ir(t,e),_t(t,we()),n;if(n===6)throw Error(O(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ii(t,ht,Hn),_t(t,we()),null}function op(t,e){var n=te;te|=1;try{return t(e)}finally{te=n,te===0&&(ws=we()+500,mu&&Yr())}}function vi(t){Mr!==null&&Mr.tag===0&&!(te&6)&&gs();var e=te;te|=1;var n=Xt.transition,r=se;try{if(Xt.transition=null,se=1,t)return t()}finally{se=r,Xt.transition=n,te=e,!(te&6)&&Yr()}}function ap(){Ct=rs.current,pe(rs)}function hi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Zx(n)),Le!==null)for(n=Le.return;n!==null;){var r=n;switch(zg(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&xc();break;case 3:Cs(),pe(pt),pe($e),Qg();break;case 5:Yg(r);break;case 4:Cs();break;case 13:pe(_e);break;case 19:pe(_e);break;case 10:Wg(r.type._context);break;case 22:case 23:ap()}n=n.return}if(Ge=t,Le=t=zr(t.current,null),He=Ct=e,Re=0,aa=null,ip=Au=yi=0,ht=Do=null,ai!==null){for(e=0;e<ai.length;e++)if(n=ai[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}ai=null}return t}function lT(t,e){do{var n=Le;try{if(Hg(),Zl.current=Dc,Fc){for(var r=Ae.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Fc=!1}if(_i=0,Ue=Be=Ae=null,Oo=!1,ia=0,rp.current=null,n===null||n.return===null){Re=1,aa=e,Le=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=He,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var g=H0(o);if(g!==null){g.flags&=-257,W0(g,o,a,s,e),g.mode&1&&j0(s,c,e),e=g,l=c;var p=e.updateQueue;if(p===null){var v=new Set;v.add(l),e.updateQueue=v}else p.add(l);break e}else{if(!(e&1)){j0(s,c,e),lp();break e}l=Error(O(426))}}else if(me&&a.mode&1){var T=H0(o);if(T!==null){!(T.flags&65536)&&(T.flags|=256),W0(T,o,a,s,e),Vg(Ss(l,a));break e}}s=l=Ss(l,a),Re!==4&&(Re=2),Do===null?Do=[s]:Do.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var m=W1(s,l,e);D0(s,m);break e;case 1:a=l;var _=s.type,y=s.stateNode;if(!(s.flags&128)&&(typeof _.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(kr===null||!kr.has(y)))){s.flags|=65536,e&=-e,s.lanes|=e;var b=J1(s,a,e);D0(s,b);break e}}s=s.return}while(s!==null)}hT(n)}catch(S){e=S,Le===n&&n!==null&&(Le=n=n.return);continue}break}while(1)}function cT(){var t=Nc.current;return Nc.current=Dc,t===null?Dc:t}function lp(){(Re===0||Re===3||Re===2)&&(Re=4),Ge===null||!(yi&268435455)&&!(Au&268435455)||Ir(Ge,He)}function Gc(t,e){var n=te;te|=2;var r=cT();(Ge!==t||He!==e)&&(Hn=null,hi(t,e));do try{bP();break}catch(i){lT(t,i)}while(1);if(Hg(),te=n,Nc.current=r,Le!==null)throw Error(O(261));return Ge=null,He=0,Re}function bP(){for(;Le!==null;)uT(Le)}function CP(){for(;Le!==null&&!Yw();)uT(Le)}function uT(t){var e=dT(t.alternate,t,Ct);t.memoizedProps=t.pendingProps,e===null?hT(t):Le=e,rp.current=null}function hT(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=_P(n,e),n!==null){n.flags&=32767,Le=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Re=6,Le=null;return}}else if(n=mP(n,e,Ct),n!==null){Le=n;return}if(e=e.sibling,e!==null){Le=e;return}Le=e=t}while(e!==null);Re===0&&(Re=5)}function ii(t,e,n){var r=se,i=Xt.transition;try{Xt.transition=null,se=1,SP(t,e,n,r)}finally{Xt.transition=i,se=r}return null}function SP(t,e,n,r){do gs();while(Mr!==null);if(te&6)throw Error(O(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(O(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(sx(t,s),t===Ge&&(Le=Ge=null,He=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||fl||(fl=!0,gT(Ec,function(){return gs(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Xt.transition,Xt.transition=null;var o=se;se=1;var a=te;te|=4,rp.current=null,vP(t,n),sT(n,t),Wx(td),bc=!!ed,td=ed=null,t.current=n,AP(n),Qw(),te=a,se=o,Xt.transition=s}else t.current=n;if(fl&&(fl=!1,Mr=t,kc=i),s=t.pendingLanes,s===0&&(kr=null),$w(n.stateNode),_t(t,we()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Uc)throw Uc=!1,t=Ed,Ed=null,t;return kc&1&&t.tag!==0&&gs(),s=t.pendingLanes,s&1?t===Td?No++:(No=0,Td=t):No=0,Yr(),null}function gs(){if(Mr!==null){var t=HE(kc),e=Xt.transition,n=se;try{if(Xt.transition=null,se=16>t?16:t,Mr===null)var r=!1;else{if(t=Mr,Mr=null,kc=0,te&6)throw Error(O(331));var i=te;for(te|=4,z=t.current;z!==null;){var s=z,o=s.child;if(z.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(z=c;z!==null;){var u=z;switch(u.tag){case 0:case 11:case 15:Fo(8,u,s)}var h=u.child;if(h!==null)h.return=u,z=h;else for(;z!==null;){u=z;var f=u.sibling,g=u.return;if(nT(u),u===c){z=null;break}if(f!==null){f.return=g,z=f;break}z=g}}}var p=s.alternate;if(p!==null){var v=p.child;if(v!==null){p.child=null;do{var T=v.sibling;v.sibling=null,v=T}while(v!==null)}}z=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,z=o;else e:for(;z!==null;){if(s=z,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Fo(9,s,s.return)}var m=s.sibling;if(m!==null){m.return=s.return,z=m;break e}z=s.return}}var _=t.current;for(z=_;z!==null;){o=z;var y=o.child;if(o.subtreeFlags&2064&&y!==null)y.return=o,z=y;else e:for(o=_;z!==null;){if(a=z,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:vu(9,a)}}catch(S){Ce(a,a.return,S)}if(a===o){z=null;break e}var b=a.sibling;if(b!==null){b.return=a.return,z=b;break e}z=a.return}}if(te=i,Yr(),On&&typeof On.onPostCommitFiberRoot=="function")try{On.onPostCommitFiberRoot(hu,t)}catch{}r=!0}return r}finally{se=n,Xt.transition=e}}return!1}function i_(t,e,n){e=Ss(n,e),e=W1(t,e,1),t=Ur(t,e,1),e=it(),t!==null&&(Ta(t,1,e),_t(t,e))}function Ce(t,e,n){if(t.tag===3)i_(t,t,n);else for(;e!==null;){if(e.tag===3){i_(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(kr===null||!kr.has(r))){t=Ss(n,t),t=J1(e,t,1),e=Ur(e,t,1),t=it(),e!==null&&(Ta(e,1,t),_t(e,t));break}}e=e.return}}function wP(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=it(),t.pingedLanes|=t.suspendedLanes&n,Ge===t&&(He&n)===n&&(Re===4||Re===3&&(He&130023424)===He&&500>we()-sp?hi(t,0):ip|=n),_t(t,e)}function fT(t,e){e===0&&(t.mode&1?(e=nl,nl<<=1,!(nl&130023424)&&(nl=4194304)):e=1);var n=it();t=ir(t,e),t!==null&&(Ta(t,e,n),_t(t,n))}function xP(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),fT(t,n)}function PP(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(O(314))}r!==null&&r.delete(e),fT(t,n)}var dT;dT=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||pt.current)dt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return dt=!1,pP(t,e,n);dt=!!(t.flags&131072)}else dt=!1,me&&e.flags&1048576&&m1(e,Lc,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;ec(t,e),t=e.pendingProps;var i=Es(e,$e.current);ds(e,n),i=Zg(null,e,r,t,i,n);var s=$g();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,mt(r)?(s=!0,Pc(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Xg(e),i.updater=_u,e.stateNode=i,i._reactInternals=e,ud(e,r,t,n),e=dd(null,e,r,!0,s,n)):(e.tag=0,me&&s&&Gg(e),nt(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(ec(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=LP(r),t=tn(r,t),i){case 0:e=fd(null,e,r,t,n);break e;case 1:e=K0(null,e,r,t,n);break e;case 11:e=J0(null,e,r,t,n);break e;case 14:e=X0(null,e,r,tn(r.type,t),n);break e}throw Error(O(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:tn(r,i),fd(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:tn(r,i),K0(t,e,r,i,n);case 3:e:{if(Q1(e),t===null)throw Error(O(387));r=e.pendingProps,s=e.memoizedState,i=s.element,A1(t,e),Rc(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Ss(Error(O(423)),e),e=Y0(t,e,r,n,i);break e}else if(r!==i){i=Ss(Error(O(424)),e),e=Y0(t,e,r,n,i);break e}else for(wt=Nr(e.stateNode.containerInfo.firstChild),Pt=e,me=!0,rn=null,n=C1(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ts(),r===i){e=sr(t,e,n);break e}nt(t,e,r,n)}e=e.child}return e;case 5:return S1(e),t===null&&ad(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,nd(r,i)?o=null:s!==null&&nd(r,s)&&(e.flags|=32),Y1(t,e),nt(t,e,o,n),e.child;case 6:return t===null&&ad(e),null;case 13:return q1(t,e,n);case 4:return Kg(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=bs(e,null,r,n):nt(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:tn(r,i),J0(t,e,r,i,n);case 7:return nt(t,e,e.pendingProps,n),e.child;case 8:return nt(t,e,e.pendingProps.children,n),e.child;case 12:return nt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,ue(Mc,r._currentValue),r._currentValue=o,s!==null)if(pn(s.value,o)){if(s.children===i.children&&!pt.current){e=sr(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=$n(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),ld(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(O(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),ld(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}nt(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,ds(e,n),i=Yt(i),r=r(i),e.flags|=1,nt(t,e,r,n),e.child;case 14:return r=e.type,i=tn(r,e.pendingProps),i=tn(r.type,i),X0(t,e,r,i,n);case 15:return X1(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:tn(r,i),ec(t,e),e.tag=1,mt(r)?(t=!0,Pc(e)):t=!1,ds(e,n),T1(e,r,i),ud(e,r,i,n),dd(null,e,r,!0,t,n);case 19:return Z1(t,e,n);case 22:return K1(t,e,n)}throw Error(O(156,e.tag))};function gT(t,e){return GE(t,e)}function IP(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jt(t,e,n,r){return new IP(t,e,n,r)}function cp(t){return t=t.prototype,!(!t||!t.isReactComponent)}function LP(t){if(typeof t=="function")return cp(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Pg)return 11;if(t===Ig)return 14}return 2}function zr(t,e){var n=t.alternate;return n===null?(n=jt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function rc(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")cp(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Xi:return fi(n.children,i,s,e);case xg:o=8,i|=8;break;case Of:return t=jt(12,n,e,i|2),t.elementType=Of,t.lanes=s,t;case Ff:return t=jt(13,n,e,i),t.elementType=Ff,t.lanes=s,t;case Df:return t=jt(19,n,e,i),t.elementType=Df,t.lanes=s,t;case bE:return Eu(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case EE:o=10;break e;case TE:o=9;break e;case Pg:o=11;break e;case Ig:o=14;break e;case wr:o=16,r=null;break e}throw Error(O(130,t==null?t:typeof t,""))}return e=jt(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function fi(t,e,n,r){return t=jt(7,t,r,e),t.lanes=n,t}function Eu(t,e,n,r){return t=jt(22,t,r,e),t.elementType=bE,t.lanes=n,t.stateNode={isHidden:!1},t}function bh(t,e,n){return t=jt(6,t,null,e),t.lanes=n,t}function Ch(t,e,n){return e=jt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function MP(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ih(0),this.expirationTimes=ih(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ih(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function up(t,e,n,r,i,s,o,a,l){return t=new MP(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=jt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Xg(s),t}function BP(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ji,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function pT(t){if(!t)return Wr;t=t._reactInternals;e:{if(Si(t)!==t||t.tag!==1)throw Error(O(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(mt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(O(171))}if(t.tag===1){var n=t.type;if(mt(n))return g1(t,n,e)}return e}function mT(t,e,n,r,i,s,o,a,l){return t=up(n,r,!0,t,i,s,o,a,l),t.context=pT(null),n=t.current,r=it(),i=Gr(n),s=$n(r,i),s.callback=e??null,Ur(n,s,i),t.current.lanes=i,Ta(t,i,r),_t(t,r),t}function Tu(t,e,n,r){var i=e.current,s=it(),o=Gr(i);return n=pT(n),e.context===null?e.context=n:e.pendingContext=n,e=$n(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Ur(i,e,o),t!==null&&(hn(t,i,o,s),ql(t,i,o)),o}function zc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function s_(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function hp(t,e){s_(t,e),(t=t.alternate)&&s_(t,e)}function RP(){return null}var _T=typeof reportError=="function"?reportError:function(t){console.error(t)};function fp(t){this._internalRoot=t}bu.prototype.render=fp.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(O(409));Tu(t,e,null,null)};bu.prototype.unmount=fp.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;vi(function(){Tu(null,t,null,null)}),e[rr]=null}};function bu(t){this._internalRoot=t}bu.prototype.unstable_scheduleHydration=function(t){if(t){var e=XE();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Pr.length&&e!==0&&e<Pr[n].priority;n++);Pr.splice(n,0,t),n===0&&YE(t)}};function dp(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Cu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function o_(){}function OP(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=zc(o);s.call(c)}}var o=mT(e,r,t,0,null,!1,!1,"",o_);return t._reactRootContainer=o,t[rr]=o.current,$o(t.nodeType===8?t.parentNode:t),vi(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=zc(l);a.call(c)}}var l=up(t,0,!1,null,null,!1,!1,"",o_);return t._reactRootContainer=l,t[rr]=l.current,$o(t.nodeType===8?t.parentNode:t),vi(function(){Tu(e,l,n,r)}),l}function Su(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=zc(o);a.call(l)}}Tu(e,o,t,i)}else o=OP(n,e,t,i,r);return zc(o)}WE=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=bo(e.pendingLanes);n!==0&&(Bg(e,n|1),_t(e,we()),!(te&6)&&(ws=we()+500,Yr()))}break;case 13:vi(function(){var r=ir(t,1);if(r!==null){var i=it();hn(r,t,1,i)}}),hp(t,1)}};Rg=function(t){if(t.tag===13){var e=ir(t,134217728);if(e!==null){var n=it();hn(e,t,134217728,n)}hp(t,134217728)}};JE=function(t){if(t.tag===13){var e=Gr(t),n=ir(t,e);if(n!==null){var r=it();hn(n,t,e,r)}hp(t,e)}};XE=function(){return se};KE=function(t,e){var n=se;try{return se=t,e()}finally{se=n}};Jf=function(t,e,n){switch(e){case"input":if(kf(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=pu(r);if(!i)throw Error(O(90));SE(r),kf(r,i)}}}break;case"textarea":xE(t,n);break;case"select":e=n.value,e!=null&&cs(t,!!n.multiple,e,!1)}};OE=op;FE=vi;var FP={usingClientEntryPoint:!1,Events:[Ca,qi,pu,BE,RE,op]},io={findFiberByHostInstance:oi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},DP={bundleType:io.bundleType,version:io.version,rendererPackageName:io.rendererPackageName,rendererConfig:io.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:hr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=UE(t),t===null?null:t.stateNode},findFiberByHostInstance:io.findFiberByHostInstance||RP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dl.isDisabled&&dl.supportsFiber)try{hu=dl.inject(DP),On=dl}catch{}}Bt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=FP;Bt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!dp(e))throw Error(O(200));return BP(t,e,null,n)};Bt.createRoot=function(t,e){if(!dp(t))throw Error(O(299));var n=!1,r="",i=_T;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=up(t,1,!1,null,null,n,!1,r,i),t[rr]=e.current,$o(t.nodeType===8?t.parentNode:t),new fp(e)};Bt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(O(188)):(t=Object.keys(t).join(","),Error(O(268,t)));return t=UE(e),t=t===null?null:t.stateNode,t};Bt.flushSync=function(t){return vi(t)};Bt.hydrate=function(t,e,n){if(!Cu(e))throw Error(O(200));return Su(null,t,e,!0,n)};Bt.hydrateRoot=function(t,e,n){if(!dp(t))throw Error(O(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=_T;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=mT(e,null,t,1,n??null,i,!1,s,o),t[rr]=e.current,$o(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new bu(e)};Bt.render=function(t,e,n){if(!Cu(e))throw Error(O(200));return Su(null,t,e,!1,n)};Bt.unmountComponentAtNode=function(t){if(!Cu(t))throw Error(O(40));return t._reactRootContainer?(vi(function(){Su(null,null,t,!1,function(){t._reactRootContainer=null,t[rr]=null})}),!0):!1};Bt.unstable_batchedUpdates=op;Bt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Cu(n))throw Error(O(200));if(t==null||t._reactInternals===void 0)throw Error(O(38));return Su(t,e,n,!1,r)};Bt.version="18.2.0-next-9e3b772b8-20220608";function yT(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(yT)}catch(t){console.error(t)}}yT(),mE.exports=Bt;var gp=mE.exports,a_=gp;Bf.createRoot=a_.createRoot,Bf.hydrateRoot=a_.hydrateRoot;function le(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const wu=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),l_=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);l_&&parseFloat(l_[1]);const NP="3.4.14";function Dn(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Sh={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},UP=Sh.global||Sh.self||Sh.window||{},er=typeof process!="object"||String(process)!=="[object process]"||process.browser,pp=typeof importScripts=="function",kP=typeof window<"u"&&typeof window.orientation<"u",c_=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);c_&&parseFloat(c_[1]);function la(t){"@babel/helpers - typeof";return la=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},la(t)}function GP(t,e){if(la(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(la(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function zP(t){var e=GP(t,"string");return la(e)==="symbol"?e:String(e)}function d(t,e,n){return e=zP(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class VP{constructor(e,n){d(this,"name",void 0),d(this,"workerThread",void 0),d(this,"isRunning",!0),d(this,"result",void 0),d(this,"_resolve",()=>{}),d(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Dn(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Dn(this.isRunning),this.isRunning=!1,this._reject(e)}}let wh=class{terminate(){}};const xh=new Map;function jP(t){Dn(t.source&&!t.url||!t.source&&t.url);let e=xh.get(t.source||t.url);return e||(t.url&&(e=HP(t.url),xh.set(t.url,e)),t.source&&(e=vT(t.source),xh.set(t.source,e))),Dn(e),e}function HP(t){if(!t.startsWith("http"))return t;const e=WP(t);return vT(e)}function vT(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function WP(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function AT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const r=n||new Set;if(t){if(u_(t))r.add(t);else if(u_(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)AT(t[i],e,r)}}return n===void 0?Array.from(r):[]}function u_(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Ph=()=>{};class Sd{static isSupported(){return typeof Worker<"u"&&er||typeof wh<"u"&&!er}constructor(e){d(this,"name",void 0),d(this,"source",void 0),d(this,"url",void 0),d(this,"terminated",!1),d(this,"worker",void 0),d(this,"onMessage",void 0),d(this,"onError",void 0),d(this,"_loadableURL","");const{name:n,source:r,url:i}=e;Dn(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=Ph,this.onError=s=>console.log(s),this.worker=er?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Ph,this.onError=Ph,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||AT(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=jP({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new wh(r,{eval:!1})}else if(this.source)e=new wh(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class JP{static isSupported(){return Sd.isSupported()}constructor(e){d(this,"name","unnamed"),d(this,"source",void 0),d(this,"url",void 0),d(this,"maxConcurrency",1),d(this,"maxMobileConcurrency",1),d(this,"onDebug",()=>{}),d(this,"reuseWorkers",!0),d(this,"props",{}),d(this,"jobQueue",[]),d(this,"idleQueue",[]),d(this,"count",0),d(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,o,a)=>s.done(a),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,o)=>s.error(o);const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new VP(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Sd({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return kP?this.maxMobileConcurrency:this.maxConcurrency}}const XP={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Jn{static isSupported(){return Sd.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Jn._workerFarm=Jn._workerFarm||new Jn({}),Jn._workerFarm.setProps(e),Jn._workerFarm}constructor(e){d(this,"props",void 0),d(this,"workerPools",new Map),this.props={...XP},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new JP({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}d(Jn,"_workerFarm",void 0);const KP="latest";function YP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},r="".concat(t.id,"-worker.js");let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(i="modules/".concat(t.module,"/dist/").concat(r)),!i){let s=t.version;s==="latest"&&(s=KP);const o=s?"@".concat(s):"";i="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(r)}return Dn(i),i}function QP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:NP;Dn(t,"no worker provided");const n=t.version;return!(!e||!n)}const qP=null,ZP=null,wd=null,ET=null,$P=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:qP,readFileAsText:ZP,requireFromFile:wd,requireFromString:ET},Symbol.toStringTag,{value:"Module"})),eI="3.4.14",Ih={};async function di(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e&&(t=tI(t,e,n)),Ih[t]=Ih[t]||nI(t),await Ih[t]}function tI(t,e,n){if(t.startsWith("http"))return t;const r=n.modules||{};return r[t]?r[t]:er?n.CDN?(Dn(n.CDN.startsWith("http")),"".concat(n.CDN,"/").concat(e,"@").concat(eI,"/dist/libs/").concat(t)):pp?"../src/libs/".concat(t):"modules/".concat(e,"/src/libs/").concat(t):"modules/".concat(e,"/dist/libs/").concat(t)}async function nI(t){if(t.endsWith("wasm"))return await(await fetch(t)).arrayBuffer();if(!er)try{return $P&&wd&&await wd(t)}catch{return null}if(pp)return importScripts(t);const n=await(await fetch(t)).text();return rI(n,t)}function rI(t,e){if(!er)return ET;if(pp)return eval.call(UP,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch{n.text=t}return document.body.appendChild(n),null}function iI(t,e){return!Jn.isSupported()||!er&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function sI(t,e,n,r,i){const s=t.id,o=YP(t,n),l=Jn.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const c=await l.startJob("process-on-worker",oI.bind(null,i));return c.postMessage("process",{input:e,options:n,context:r}),await(await c.result).result}async function oI(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await t(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:l})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function aI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?h_(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?h_(t,0,e):""}function h_(t,e,n){if(t.byteLength<=e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}function lI(t){try{return JSON.parse(t)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(aI(t),'"'))}}function cI(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function uI(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=e.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),i=r.reduce((a,l)=>a+l.byteLength,0),s=new Uint8Array(i);let o=0;for(const a of r)s.set(a,o),o+=a.byteLength;return s.buffer}function mp(t,e,n){const r=n!==void 0?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(r).buffer}function wa(t,e){return le(t>=0),le(e>0),t+(e-1)&~(e-1)}function hI(t,e,n){let r;if(t instanceof ArrayBuffer)r=new Uint8Array(t);else{const i=t.byteOffset,s=t.byteLength;r=new Uint8Array(t.buffer||t.arrayBuffer,i,s)}return e.set(r,n),n+wa(r.byteLength,4)}async function fI(t){const e=[];for await(const n of t)e.push(n);return uI(...e)}function f_(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let d_=class{constructor(e,n){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=f_(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(f_()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},dI=class{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof d_?i=e:i=new d_(n,r),this.stats[n]=i),i}};const gI="Queued Requests",pI="Active Requests",mI="Cancelled Requests",_I="Queued Requests Ever",yI="Active Requests Ever",vI={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class AI{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};d(this,"props",void 0),d(this,"stats",void 0),d(this,"activeRequestCount",0),d(this,"requestQueue",[]),d(this,"requestMap",new Map),d(this,"deferredUpdate",null),this.props={...vI,...e},this.stats=new dI({id:this.props.id}),this.stats.get(gI),this.stats.get(pI),this.stats.get(mI),this.stats.get(_I),this.stats.get(yI)}scheduleRequest(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:n},i=new Promise(s=>(r.resolve=s,r));return this.requestQueue.push(r),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:n,resolve:r}=e;let i=!1;const s=()=>{i||(i=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const r=e[n];this._updateRequest(r)||(e.splice(n,1),this.requestMap.delete(r.handle),n--)}e.sort((n,r)=>n.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let EI="";const g_={};function TI(t){for(const e in g_)if(t.startsWith(e)){const n=g_[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(EI).concat(t)),t}function bI(t){return t&&typeof t=="object"&&t.isBuffer}function TT(t){if(bI(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function bT(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function _p(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const CI=t=>typeof t=="boolean",Uo=t=>typeof t=="function",xa=t=>t!==null&&typeof t=="object",p_=t=>xa(t)&&t.constructor==={}.constructor,SI=t=>t&&typeof t[Symbol.iterator]=="function",wI=t=>t&&typeof t[Symbol.asyncIterator]=="function",wi=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,xi=t=>typeof Blob<"u"&&t instanceof Blob,xI=t=>t&&typeof t=="object"&&t.isBuffer,PI=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||xa(t)&&Uo(t.tee)&&Uo(t.cancel)&&Uo(t.getReader),II=t=>xa(t)&&Uo(t.read)&&Uo(t.pipe)&&CI(t.readable),CT=t=>PI(t)||II(t),LI=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,MI=/^([-\w.]+\/[-\w.+]+)/;function BI(t){const e=MI.exec(t);return e?e[1]:t}function m_(t){const e=LI.exec(t);return e?e[1]:""}const ST=/\?.*/;function RI(t){const e=t.match(ST);return e&&e[0]}function yp(t){return t.replace(ST,"")}function xu(t){return wi(t)?t.url:xi(t)?t.name||"":typeof t=="string"?t:""}function vp(t){if(wi(t)){const e=t,n=e.headers.get("content-type")||"",r=yp(e.url);return BI(n)||m_(r)}return xi(t)?t.type||"":typeof t=="string"?m_(t):""}function OI(t){return wi(t)?t.headers["content-length"]||-1:xi(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function wT(t){if(wi(t))return t;const e={},n=OI(t);n>=0&&(e["content-length"]=String(n));const r=xu(t),i=vp(t);i&&(e["content-type"]=i);const s=await NI(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function FI(t){if(!t.ok){const e=await DI(t);throw new Error(e)}}async function DI(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let r=t.statusText;n.includes("application/json")&&(r+=" ".concat(await t.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function NI(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),r=UI(n);return"data:base64,".concat(r)}return null}function UI(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}async function __(t,e){if(typeof t=="string"){t=TI(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await wT(t)}function kI(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Pa(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||kI()}const gl=globalThis.window||globalThis.self||globalThis.global,so=globalThis.process||{},xT=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Pa();function GI(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}let zI=class{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=GI(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}};function VI(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function jI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Lh(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(n=Math.min(n,r/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let Vc;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Vc||(Vc={}));const HI=10;function y_(t){return typeof t!="string"?t:(t=t.toUpperCase(),Vc[t]||Vc.WHITE)}function WI(t,e,n){if(!Pa&&typeof t=="string"){if(e){const r=y_(e);t="\x1B[".concat(r,"m").concat(t,"\x1B[39m")}if(n){const r=y_(n);t="\x1B[".concat(r+HI,"m").concat(t,"\x1B[49m")}}return t}function JI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(t)))}}function jc(t,e){if(!t)throw new Error(e||"Assertion failed")}function Ri(){let t;if(Pa()&&gl.performance){var e,n;t=gl==null||(e=gl.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in so){var r;const i=so==null||(r=so.hrtime)===null||r===void 0?void 0:r.call(so);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Oi={debug:Pa()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},XI={enabled:!0,level:0};function kt(){}const v_={},A_={once:!0};let Ap=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=xT,this._startTs=Ri(),this._deltaTs=Ri(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new zI("__probe-".concat(this.id,"__"),XI),this.timeStamp("".concat(this.id," started")),JI(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ri()-this._startTs).toPrecision(10))}getDelta(){return Number((Ri()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){jc(e,n)}warn(e){return this._getLogFunction(0,e,Oi.warn,arguments,A_)}error(e){return this._getLogFunction(0,e,Oi.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Oi.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Oi.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Oi.debug||Oi.info,arguments,A_)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||kt,r&&[r],{tag:qI(n)}):kt}image(e){let{logLevel:n,priority:r,image:i,message:s="",scale:o=1}=e;return this._shouldLog(n||r)?Pa()?QI({image:i,message:s,scale:o}):YI():kt}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||kt)}group(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=E_({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||kt)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=PT(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=E_({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,jc(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Ri();const o=s.tag||s.message;if(s.once&&o)if(!v_[o])v_[o]=Ri();else return kt;return n=KI(this.id,s.message,s),r.bind(console,n,...s.args)}return kt}};Ap.VERSION=xT;function PT(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return jc(Number.isFinite(e)&&e>=0),e}function E_(t){const{logLevel:e,message:n}=t;t.logLevel=PT(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return jc(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function KI(t,e,n){if(typeof e=="string"){const r=n.time?jI(VI(n.total)):"";e=n.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),e=WI(e,n.color,n.background)}return e}function YI(t){return console.warn("removed"),kt}function QI(t){let{image:e,message:n="",scale:r=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=Lh(s,n,r);console.log(...o)},s.src=e,kt}const i=e.nodeName||"";if(i.toLowerCase()==="img")return console.log(...Lh(e,n,r)),kt;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Lh(s,n,r)),s.src=e.toDataURL(),kt}return kt}function qI(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const T_=new Ap({id:"loaders.gl"});class ZI{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class $I{constructor(){d(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.error.bind(this.console,...n)}}const IT={fetch:null,mimeType:void 0,nothrow:!1,log:new $I,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:wu,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},eL={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function LT(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const MT=()=>{const t=LT();return t.globalOptions=t.globalOptions||{...IT},t.globalOptions};function tL(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],nL(t,n),iL(e,t,r)}function nL(t,e){b_(t,null,IT,eL,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};b_(r,n.id,i,s,e)}}function b_(t,e,n,r,i){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const l=!e&&xa(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in r)T_.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(r[a],"'"))();else if(!l){const h=rL(a,i);T_.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(h))()}}}}function rL(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return"Did you mean '".concat(i.id,".").concat(s,"'?");const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||"Did you mean '".concat(i.id,".").concat(s,"'?"))}return r}function iL(t,e,n){const i={...t.options||{}};return sL(i,n),i.log===null&&(i.log=new ZI),C_(i,MT()),C_(i,e),i}function C_(t,e){for(const n in e)if(n in e){const r=e[n];p_(r)&&p_(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function sL(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Ep(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Tp(t){var e,n;le(t,"null loader"),le(Ep(t),"invalid loader");let r;return Array.isArray(t)&&(r=t[1],t=t[0],t={...t,options:{...t.options,...r}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const BT=()=>{const t=LT();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function oL(t){const e=BT();t=Array.isArray(t)?t:[t];for(const n of t){const r=Tp(n);e.find(i=>r===i)||e.unshift(r)}}function aL(){return BT()}const lL=new Ap({id:"loaders.gl"}),cL=/\.([^.]+)$/;async function uL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!RT(t))return null;let i=S_(t,e,{...n,nothrow:!0},r);if(i)return i;if(xi(t)&&(t=await t.slice(0,10).arrayBuffer(),i=S_(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(OT(t));return i}function S_(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!RT(t))return null;if(e&&!Array.isArray(e))return Tp(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...aL()),fL(i);const s=hL(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(OT(t));return s}function hL(t,e,n,r){const i=xu(t),s=vp(t),o=yp(i)||(r==null?void 0:r.url);let a=null,l="";if(n!=null&&n.mimeType&&(a=Mh(e,n==null?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),a=a||dL(e,o),l=l||(a?"matched url ".concat(o):""),a=a||Mh(e,s),l=l||(a?"matched MIME type ".concat(s):""),a=a||pL(e,t),l=l||(a?"matched initial data ".concat(FT(t)):""),a=a||Mh(e,n==null?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(s):""),l){var c;lL.log(1,"selectLoader selected ".concat((c=a)===null||c===void 0?void 0:c.name,": ").concat(l,"."))}return a}function RT(t){return!(t instanceof Response&&t.status===204)}function OT(t){const e=xu(t),n=vp(t);let r="No valid loader found (";r+=e?"".concat(bT(e),", "):"no url provided, ",r+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const i=t?FT(t):"";return r+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",r+=")",r}function fL(t){for(const e of t)Tp(e)}function dL(t,e){const n=e&&cL.exec(e),r=n&&n[1];return r?gL(t,r):null}function gL(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function Mh(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function pL(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(mL(e,n))return n}else if(ArrayBuffer.isView(e)){if(w_(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&w_(e,0,n))return n;return null}function mL(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function w_(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>_L(t,e,n,i))}function _L(t,e,n,r){if(r instanceof ArrayBuffer)return cI(r,t,r.byteLength);switch(typeof r){case"function":return r(t,n);case"string":const i=xd(t,e,r.length);return r===i;default:return!1}}function FT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?xd(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?xd(t,0,e):""}function xd(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const yL=256*1024;function*vL(t,e){const n=(e==null?void 0:e.chunkSize)||yL;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const AL=256*1024;function EL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=AL}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}()}const TL=1024*1024;async function*bL(t,e){const n=(e==null?void 0:e.chunkSize)||TL;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function x_(t,e){return wu?CL(t,e):SL(t)}async function*CL(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield TT(o)}}catch{n.releaseLock()}}async function*SL(t,e){for await(const n of t)yield TT(n)}function wL(t,e){if(typeof t=="string")return vL(t,e);if(t instanceof ArrayBuffer)return EL(t,e);if(xi(t))return bL(t,e);if(CT(t))return x_(t,e);if(wi(t))return x_(t.body,e);throw new Error("makeIterator")}const DT="Cannot convert supplied data type";function xL(t,e,n){if(e.text&&typeof t=="string")return t;if(xI(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(DT)}async function PL(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return xL(t,e);if(xi(t)&&(t=await wT(t)),wi(t)){const i=t;return await FI(i),e.binary?await i.arrayBuffer():await i.text()}if(CT(t)&&(t=wL(t,n)),SI(t)||wI(t))return fI(t);throw new Error(DT)}function NT(t,e){const n=MT(),r=t||n;return typeof r.fetch=="function"?r.fetch:xa(r.fetch)?i=>__(i,r):e!=null&&e.fetch?e==null?void 0:e.fetch:__}function IL(t,e,n){if(n)return n;const r={fetch:NT(e,t),...t};if(r.url){const i=yp(r.url);r.baseUrl=i,r.queryString=RI(r.url),r.filename=bT(i),r.baseUrl=_p(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function LL(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:null}async function bp(t,e,n,r){Dn(!r||typeof r=="object"),e&&!Array.isArray(e)&&!Ep(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=xu(t),o=LL(e,r),a=await uL(t,o,n);return a?(n=tL(n,a,o,i),r=IL({url:i,parse:bp,loaders:o},n,r||null),await ML(a,t,n,r)):null}async function ML(t,e,n,r){if(QP(t),wi(e)){const i=e,{ok:s,redirected:o,status:a,statusText:l,type:c,url:u}=i,h=Object.fromEntries(i.headers.entries());r.response={headers:h,ok:s,redirected:o,status:a,statusText:l,type:c,url:u}}if(e=await PL(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,r,t);if(iI(t,n))return await sI(t,e,n,r,bp);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,r,t);if(t.parse)return await t.parse(e,n,r,t);throw Dn(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function or(t,e,n,r){!Array.isArray(e)&&!Ep(e)&&(n=e,e=void 0);const i=NT(n);let s=t;return typeof t=="string"&&(s=await i(t)),xi(t)&&(s=await i(t)),await bp(s,e,n)}const BL="3.4.14",{_parseImageNode:RL}=globalThis,Pd=typeof Image<"u",Id=typeof ImageBitmap<"u",OL=!!RL,Ld=wu?!0:OL;function FL(t){switch(t){case"auto":return Id||Pd||Ld;case"imagebitmap":return Id;case"image":return Pd;case"data":return Ld;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function DL(){if(Id)return"imagebitmap";if(Pd)return"image";if(Ld)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function NL(t){const e=kL(t);if(!e)throw new Error("Not an image");return e}function UL(t){switch(NL(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function kL(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const zL=/^data:image\/svg\+xml/,VL=/\.svg((\?|#).*)?$/;function Cp(t){return t&&(zL.test(t)||VL.test(t))}function jL(t,e){if(Cp(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return UT(t,e)}function UT(t,e){if(Cp(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function kT(t,e,n){const r=jL(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await HL(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function HL(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>i(new Error("Could not load image ".concat(t,": ").concat(s)))}catch(s){i(s)}})}const WL={};let P_=!0;async function JL(t,e,n){let r;Cp(n)?r=await kT(t,e,n):r=UT(t,n);const i=e&&e.imagebitmap;return await XL(r,i)}async function XL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((KL(e)||!P_)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),P_=!1}return await createImageBitmap(t)}function KL(t){for(const e in t||WL)return!1;return!0}function YL(t){return!$L(t,"ftyp",4)||!(t[8]&96)?null:QL(t)}function QL(t){switch(qL(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function qL(t,e,n){return String.fromCharCode(...t.slice(e,n))}function ZL(t){return[...t].map(e=>e.charCodeAt(0))}function $L(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=ZL(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const In=!1,ko=!0;function Sp(t){const e=Ia(t);return tM(e)||iM(e)||nM(e)||rM(e)||eM(e)}function eM(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=YL(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function tM(t){const e=Ia(t);return e.byteLength>=24&&e.getUint32(0,In)===2303741511?{mimeType:"image/png",width:e.getUint32(16,In),height:e.getUint32(20,In)}:null}function nM(t){const e=Ia(t);return e.byteLength>=10&&e.getUint32(0,In)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,ko),height:e.getUint16(8,ko)}:null}function rM(t){const e=Ia(t);return e.byteLength>=14&&e.getUint16(0,In)===16973&&e.getUint32(2,ko)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,ko),height:e.getUint32(22,ko)}:null}function iM(t){const e=Ia(t);if(!(e.byteLength>=3&&e.getUint16(0,In)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=sM();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,In);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,In),width:e.getUint16(s+7,In)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,In)}return null}function sM(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Ia(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function oM(t,e){const{mimeType:n}=Sp(t)||{},r=globalThis._parseImageNode;return le(r),await r(t,n)}async function aM(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=lM(i);let a;switch(o){case"imagebitmap":a=await JL(t,e,s);break;case"image":a=await kT(t,e,s);break;case"data":a=await oM(t);break;default:le(!1)}return i==="data"&&(a=UL(a)),a}function lM(t){switch(t){case"auto":case"data":return DL();default:return FL(t),t}}const cM=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],uM=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],hM={image:{type:"auto",decode:!0}},GT={id:"image",module:"images",name:"Images",version:BL,mimeTypes:uM,extensions:cM,parse:aM,tests:[t=>!!Sp(new DataView(t))],options:hM},Bh={};function fM(t){if(Bh[t]===void 0){const e=wu?gM(t):dM(t);Bh[t]=e}return Bh[t]}function dM(t){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:n,_imageFormatsNode:r=e}=globalThis;return!!n&&r.includes(t)}function gM(t){switch(t){case"image/avif":case"image/webp":return pM(t);default:return!0}}function pM(t){try{return document.createElement("canvas").toDataURL(t).indexOf("data:".concat(t))===0}catch{return!1}}function zT(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function fr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||zT()}const ic={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},pl=ic.window||ic.self||ic.global,oo=ic.process||{},VT=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";fr();const Rh=globalThis;function jT(t){if(!t&&!fr())return"Node";if(zT(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const r=n.indexOf("MSIE ")!==-1,i=n.indexOf("Trident/")!==-1;return r||i?"IE":Rh.chrome?"Chrome":Rh.safari?"Safari":Rh.mozInnerScreenX?"Firefox":"Unknown"}function mM(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class _M{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";d(this,"storage",void 0),d(this,"id",void 0),d(this,"config",void 0),this.storage=mM(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function yM(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function vM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Oh(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(n=Math.min(n,r/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let Hc;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Hc||(Hc={}));function I_(t){return typeof t=="string"?Hc[t.toUpperCase()]||Hc.WHITE:t}function AM(t,e,n){return!fr&&typeof t=="string"&&(e&&(e=I_(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=I_(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function EM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n);for(const i of r)typeof t[i]=="function"&&(e.find(s=>i===s)||(t[i]=t[i].bind(t)))}function Wc(t,e){if(!t)throw new Error(e||"Assertion failed")}function Fi(){let t;if(fr&&"performance"in pl){var e,n;t=pl==null||(e=pl.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in oo){var r;const i=oo==null||(r=oo.hrtime)===null||r===void 0?void 0:r.call(oo);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Di={debug:fr&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},TM={enabled:!0,level:0};function Gt(){}const L_={},M_={once:!0};class wp{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};d(this,"id",void 0),d(this,"VERSION",VT),d(this,"_startTs",Fi()),d(this,"_deltaTs",Fi()),d(this,"_storage",void 0),d(this,"userData",{}),d(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new _M("__probe-".concat(this.id,"__"),TM),this.timeStamp("".concat(this.id," started")),EM(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Fi()-this._startTs).toPrecision(10))}getDelta(){return Number((Fi()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Wc(e,n)}warn(e){return this._getLogFunction(0,e,Di.warn,arguments,M_)}error(e){return this._getLogFunction(0,e,Di.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Di.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Di.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return this._getLogFunction(e,n,Di.debug||Di.info,arguments,M_)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Gt,r&&[r],{tag:wM(n)}):Gt}image(e){let{logLevel:n,priority:r,image:i,message:s="",scale:o=1}=e;return this._shouldLog(n||r)?fr?SM({image:i,message:s,scale:o}):CM():Gt}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Gt)}group(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=B_({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Gt)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=HT(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=B_({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,Wc(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Fi();const o=s.tag||s.message;if(s.once)if(!L_[o])L_[o]=Fi();else return Gt;return n=bM(this.id,s.message,s),r.bind(console,n,...s.args)}return Gt}}d(wp,"VERSION",VT);function HT(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Wc(Number.isFinite(e)&&e>=0),e}function B_(t){const{logLevel:e,message:n}=t;t.logLevel=HT(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return Wc(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function bM(t,e,n){if(typeof e=="string"){const r=n.time?vM(yM(n.total)):"";e=n.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),e=AM(e,n.color,n.background)}return e}function CM(t){return console.warn("removed"),Gt}function SM(t){let{image:e,message:n="",scale:r=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=Oh(s,n,r);console.log(...o)},s.src=e,Gt}const i=e.nodeName||"";if(i.toLowerCase()==="img")return console.log(...Oh(e,n,r)),Gt;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Oh(s,n,r)),s.src=e.toDataURL(),Gt}return Gt}function wM(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const X=new wp({id:"deck"});let Md={};function xM(t){Md=t}function Ye(t,e,n,r){X.level>0&&Md[t]&&Md[t].call(null,e,n,r)}function PM(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const IM={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:PM,parseTextSync:JSON.parse};function LM(){const t="8.9.32",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(X.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:X,_registerLoggers:xM},oL([IM,[GT,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const MM=LM(),K={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(K,"IDENTITY",{get:()=>(X.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Mn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ar={common:0,meters:1,pixels:2},R_={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},V=new wp({id:"luma.gl"});function rt(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const BM="Invalid WebGLRenderingContext",RM="Requires WebGL2";function Pu(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function Q(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function OM(t){return Q(t)?t:null}function Iu(t){return rt(Pu(t),BM),t}function Ze(t){return rt(Q(t),RM),t}const So={};function FM(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function DM(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function NM(t,e){So[t]=!0,e!==void 0&&FM(e)}function UM(t){const e=t.getError;t.getError=function(){let r;do r=e.apply(t),r!==0&&(So[r]=!0);while(r!==0);for(r in So)if(So[r])return delete So[r],parseInt(r,10);return 0}}const La=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const i=new t.VertexAttrib(n);this.attribs[r]=i}this.maxAttrib=0};La.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};La.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Pi=function(e){const n=this;this.gl=e,UM(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(s){return s===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(s,o){switch(s){case 34962:n.currentArrayBuffer=o;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=o;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(s,o){const l=n.currentVertexArrayObject.attribs[s];switch(o){case 34975:return l.buffer;case 34338:return l.enabled;case 34339:return l.size;case 34340:return l.stride;case 34341:return l.type;case 34922:return l.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(s,o,a,l,c,u){const h=n.currentVertexArrayObject;h.maxAttrib=Math.max(h.maxAttrib,s);const f=h.attribs[s];return f.buffer=n.currentArrayBuffer,f.size=o,f.type=a,f.normalized=l,f.stride=c,f.offset=u,f.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{DM("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Pi.prototype.VERTEX_ARRAY_BINDING_OES=34229;Pi.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new La(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Pi.prototype.createVertexArrayOES=function(){const e=new La(this);return this.vertexArrayObjects.push(e),e};Pi.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Pi.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof La&&e.hasBeenBound&&e.ext===this)};Pi.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){NM(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(i===s)return;(!i||s.elementArrayBuffer!==i.elementArrayBuffer)&&r.bindBuffer.call(n,34963,s.elementArrayBuffer);let o=this.currentArrayBuffer;const a=Math.max(i?i.maxAttrib:0,s.maxAttrib);for(let l=0;l<=a;l++){const c=s.attribs[l],u=i?i.attribs[l]:null;if((!i||c.enabled!==u.enabled)&&(c.enabled?r.enableVertexAttribArray.call(n,l):r.disableVertexAttribArray.call(n,l)),c.enabled){let h=!1;(!i||c.buffer!==u.buffer)&&(o!==c.buffer&&(r.bindBuffer.call(n,34962,c.buffer),o=c.buffer),h=!0),(h||c.cached!==u.cached)&&r.vertexAttribPointer.call(n,l,c.size,c.type,c.normalized,c.stride,c.offset)}}this.currentArrayBuffer!==o&&r.bindBuffer.call(n,34962,this.currentArrayBuffer)};function kM(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=e.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};const n=t.getExtension;t.getExtension=function(i){const s=n.call(this,i);return s||(i!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Pi(this)),this.__OESVertexArrayObject))}}const O_="OES_element_index",F_="WEBGL_draw_buffers",GM="EXT_disjoint_timer_query",zM="EXT_disjoint_timer_query_webgl2",VM="EXT_texture_filter_anisotropic",D_="WEBGL_debug_renderer_info",jM=35723,HM=4352,WM=36795,JM=34047,XM=37445,KM=37446,ce=t=>Q(t)?void 0:0,YM={3074:t=>Q(t)?void 0:36064,[jM]:t=>Q(t)?void 0:HM,35977:ce,32937:ce,[WM]:(t,e)=>{const n=Q(t)?t.getExtension(zM):t.getExtension(GM);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[XM]:(t,e)=>{const n=t.getExtension(D_);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[KM]:(t,e)=>{const n=t.getExtension(D_);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[JM]:(t,e)=>{const n=t.luma.extensions[VM];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:ce,35071:ce,37447:ce,36063:(t,e)=>{if(!Q(t)){const n=t.getExtension(F_);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:ce,35374:ce,35377:ce,34852:t=>{if(!Q(t)){const e=t.getExtension(F_);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(O_)?2147483647:65535,33001:t=>t.getExtension(O_)?16777216:65535,33e3:t=>16777216,37157:ce,35373:ce,35657:ce,36183:ce,37137:ce,34045:ce,35978:ce,35979:ce,35968:ce,35376:ce,35375:ce,35659:ce,37154:ce,35371:ce,35658:ce,35076:ce,35077:ce,35380:ce};function QM(t,e,n){const r=YM[n],i=typeof r=="function"?r(t,e,n):r;return i!==void 0?i:e(n)}const qM="OES_vertex_array_object",WT="ANGLE_instanced_arrays",ZM="WEBGL_draw_buffers",$M="EXT_disjoint_timer_query",eB="EXT_texture_filter_anisotropic",tB="VertexArray requires WebGL2 or OES_vertex_array_object extension";function nB(t,e){return{webgl2:Q(t),ext:t.getExtension(e)}}const JT={[qM]:{meta:{suffix:"OES"},createVertexArray:()=>{rt(!1,tB)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[WT]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){rt(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[ZM]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{rt(!1)}},[$M]:{meta:{suffix:"EXT"},createQuery:()=>{rt(!1)},deleteQuery:()=>{rt(!1)},beginQuery:()=>{rt(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},Fh={readBuffer:(t,e,n)=>{Q(t)&&e(n)},getVertexAttrib:(t,e,n,r)=>{const{webgl2:i,ext:s}=nB(t,WT);let o;switch(r){case 35069:o=i?void 0:!1;break;case 35070:o=!i&&!s?0:void 0;break}return o!==void 0?o:e(n,r)},getProgramParameter:(t,e,n,r)=>{if(!Q(t))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,r)},getInternalformatParameter:(t,e,n,r,i)=>{if(!Q(t))switch(i){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,r,i)},getTexParameter(t,e,n,r){switch(r){case 34046:const{extensions:i}=t.luma,s=i[eB];r=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,r)},getParameter:QM,hint(t,e,n,r){return e(n,r)}};function rB(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(kM(t),iB(t),oB(t,JT),sB(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=rB;function iB(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function sB(t,e){let{target:n,target2:r}=e;Object.keys(Fh).forEach(i=>{if(typeof Fh[i]=="function"){const s=t[i]?t[i].bind(t):()=>{},o=Fh[i].bind(null,t,s);n[i]=o,r[i]=o}})}function oB(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&aB(t,{extension:n,target:t.luma,target2:t})}function aB(t,e){let{extension:n,target:r,target2:i}=e;const s=JT[n];rt(s);const{meta:o={}}=s,{suffix:a=""}=o,l=t.getExtension(n);for(const c of Object.keys(s)){const u="".concat(c).concat(a);let h=null;c==="meta"||typeof t[c]=="function"||(l&&typeof l[u]=="function"?h=function(){return l[u](...arguments)}:typeof s[c]=="function"&&(h=s[c].bind(r))),h&&(r[c]=h,i[c]=h)}}const xp={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},vr=(t,e,n)=>e?t.enable(n):t.disable(n),N_=(t,e,n)=>t.hint(n,e),vt=(t,e,n)=>t.pixelStorei(n,e),lB=(t,e)=>{const n=Q(t)?36009:36160;return t.bindFramebuffer(n,e)},cB=(t,e)=>t.bindFramebuffer(36008,e);function ao(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const uB={3042:vr,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:vr,2885:(t,e)=>t.cullFace(e),2929:vr,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:vr,35723:N_,36006:lB,2886:(t,e)=>t.frontFace(e),33170:N_,2849:(t,e)=>t.lineWidth(e),32823:vr,32824:"polygonOffset",10752:"polygonOffset",35977:vr,32938:"sampleCoverage",32939:"sampleCoverage",3089:vr,3088:(t,e)=>t.scissor(...e),2960:vr,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:vt,3317:vt,37440:vt,37441:vt,37443:vt,3330:vt,3332:vt,3331:vt,36010:cB,3314:vt,32878:vt,3316:vt,3315:vt,32877:vt,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=ao(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=ao(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=ao(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=ao(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=ao(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function Te(t,e,n){return e[t]!==void 0?e[t]:n[t]}const hB={blendEquation:(t,e,n)=>t.blendEquationSeparate(Te(32777,e,n),Te(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Te(32969,e,n),Te(32968,e,n),Te(32971,e,n),Te(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Te(32824,e,n),Te(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Te(32938,e,n),Te(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Te(2962,e,n),Te(2967,e,n),Te(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Te(34816,e,n),Te(36003,e,n),Te(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Te(2964,e,n),Te(2965,e,n),Te(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Te(34817,e,n),Te(34818,e,n),Te(34819,e,n))},U_={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},bn=(t,e)=>t.isEnabled(e),k_={3042:bn,2884:bn,2929:bn,3024:bn,32823:bn,32926:bn,32928:bn,3089:bn,2960:bn,35977:bn};function XT(t){for(const e in t)return!1;return!0}function fB(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}function G_(t,e){const n=t[e].bind(t);t[e]=function(){const i=arguments.length<=0?void 0:arguments[0];return i in t.state.cache?t.state.enable?t.state.cache[i]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function dB(t,e,n){const r=t[e].bind(t);t[e]=function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];const{valueChanged:l,oldValue:c}=n(t.state._updateCache,...o);return l&&r(...o),c},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function gB(t){const e=t.useProgram.bind(t);t.useProgram=function(r){t.state.program!==r&&(e(r),t.state.program=r)}}class pB{constructor(e){let{copyState:n=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?_B(e):Object.assign({},xp),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){rt(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];lr(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in e){rt(s!==void 0);const o=e[s],a=this.cache[s];fB(o,a)||(n=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function KT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:r}=e;if(rt(r!==void 0),!t.state){const{polyfillContext:i}=globalThis;i&&i(t),t.state=new pB(t,{copyState:r}),gB(t);for(const s in U_){const o=U_[s];dB(t,s,o)}G_(t,"getParameter"),G_(t,"isEnabled")}return t.state.enable=n,t}function mB(t){t.state||KT(t,{copyState:!1}),t.state.push()}function z_(t){rt(t.state),t.state.pop()}function lr(t,e){if(rt(Pu(t),"setParameters requires a WebGL context"),XT(e))return;const n={};for(const i in e){const s=Number(i),o=uB[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=hB[i];s(t,e,r)}}function _B(t,e){if(e=e||xp,typeof e=="number"){const i=e,s=k_[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=k_[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function yB(t){lr(t,xp)}function fn(t,e,n){if(XT(e))return n(t);const{nocatch:r=!0}=e;mB(t),lr(t,e);let i;if(r)i=n(t),z_(t);else try{i=n(t)}finally{z_(t)}return i}function xs(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,r="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return r?t.drawingBufferWidth/r:1}return 1}function Dh(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=xs(t),i=t.drawingBufferWidth,s=t.drawingBufferHeight;return AB(e,r,i,s,n)}function vB(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function AB(t,e,n,r,i){const s=V_(t[0],e,n);let o=j_(t[1],e,r,i),a=V_(t[0]+1,e,n);const l=a===n-1?a:a-1;a=j_(t[1]+1,e,r,i);let c;return i?(a=a===0?a:a+1,c=o,o=a):c=a===r-1?a:a-1,{x:s,y:o,width:Math.max(l-s+1,1),height:Math.max(c-o+1,1)}}function V_(t,e,n){return Math.min(Math.round(t*e),n-1)}function j_(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Pp=fr(),EB=Pp&&typeof document<"u",YT={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function QT(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};rt(Pp,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},YT,t);const{width:e,height:n}=t;function r(a){if(t.throwOnError)throw new Error(a);return console.error(a),null}t.onError=r;let i;const{canvas:s}=t,o=SB({canvas:s,width:e,height:n,onError:r});return i=CB(o,t),i?(i=Ip(i,t),wB(i),i):null}function Ip(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||xB(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},YT,e);const{manageState:n,debug:r}=e;return n&&KT(t,{copyState:!1,log:function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return V.log(1,...s)()}}),Pp&&r&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),V.level=Math.max(V.level,1)):V.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function TB(t){const e=t.getParameter(7936),n=t.getParameter(7937),r=t.getExtension("WEBGL_debug_renderer_info"),i=r&&t.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),s=r&&t.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||e,renderer:s||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function bB(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const r=vB(e.useDevicePixels);PB(t,r,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function CB(t,e){const{onError:n}=e;let r=null;const i=l=>r=l.statusMessage||r;t.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:s=!0,webgl2:o=!0}=e;let a=null;return o&&(a=a||t.getContext("webgl2",e),a=a||t.getContext("experimental-webgl2",e)),s&&(a=a||t.getContext("webgl",e),a=a||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",i,!1),a?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),a):n("Failed to create ".concat(o&&!s?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function SB(t){let{canvas:e,width:n=800,height:r=600,onError:i}=t,s;return typeof e=="string"?(EB&&document.readyState==="complete"||i("createGLContext called on canvas '".concat(e,"' before page was loaded")),s=document.getElementById(e)):e?s=e:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",s.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function wB(t){const e=Q(t)?"WebGL2":"WebGL1",n=TB(t),r=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",i=t.debug?" debug":"";V.info(1,"".concat(e).concat(i," context ").concat(r))()}function xB(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function PB(t,e,n){let r="width"in n?n.width:t.canvas.clientWidth,i="height"in n?n.height:t.canvas.clientHeight;(!r||!i)&&(V.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=t.canvas.width||1,i=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),l=Math.floor(i*o);t.canvas.width=a,t.canvas.height=l,(t.drawingBufferWidth!==a||t.drawingBufferHeight!==l)&&(V.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/r,t.drawingBufferHeight/i),t.canvas.width=Math.floor(r*o),t.canvas.height=Math.floor(i*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:r,clientHeight:i,devicePixelRatio:e})}}function H_(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let W_=class{constructor(e,n){d(this,"name",void 0),d(this,"type",void 0),d(this,"sampleSize",1),d(this,"time",void 0),d(this,"count",void 0),d(this,"samples",void 0),d(this,"lastTiming",void 0),d(this,"lastSampleTime",void 0),d(this,"lastSampleCount",void 0),d(this,"_count",0),d(this,"_time",0),d(this,"_samples",0),d(this,"_startTime",0),d(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=H_(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(H_()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},Lp=class{constructor(e){d(this,"id",void 0),d(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:r}=e;return this.stats[n]||(e instanceof W_?this.stats[n]=e:this.stats[n]=new W_(n,r)),this.stats[n]}};const Go="8.5.21",IB="set luma.log.level=1 (or higher) to trace rendering";class LB{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Lp({id:e})),this.stats.get(e)}}const ci=new LB;if(globalThis.luma&&globalThis.luma.VERSION!==Go)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Go));globalThis.luma||(fr()&&V.log(1,"luma.gl ".concat(Go," - ").concat(IB))(),globalThis.luma=globalThis.luma||{VERSION:Go,version:Go,log:V,stats:ci,globals:{modules:{},nodeIO:{}}});function MB(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function BB(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function N(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function Nh(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const r=t[e];return N(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function Vr(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const Uh={};function cr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Uh[t]=Uh[t]||1;const e=Uh[t]++;return"".concat(t,"-").concat(e)}function J_(t){return N(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Ps(t){let e=!0;for(const n in t){e=!1;break}return e}function qT(t,e,n,r){const i="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(t);r.forEach(o=>{s.methodName||(s[o]=()=>{throw V.removed("Calling removed method ".concat(e,".").concat(o,": "),i)(),new Error(o)})})}const Ni="Resource subclass must define virtual methods";let dr=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Iu(e);const{id:r,userData:i={}}=n;this.gl=e,this.gl2=e,this.id=r||cr(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Nh(this.gl,e),N(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const s=Q(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension)))){const a=i.webgl1,l="webgl2"in i?i.webgl2:i.webgl1;return s?l:a}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:r}=e,i=this.constructor.PARAMETERS||{},s=Q(this.gl),o={},a=n||Object.keys(i);for(const l of a){const c=i[l];if(c&&(!("webgl2"in c)||s)&&(!("extension"in c)||this.gl.getExtension(c.extension))){const h=r?Vr(this.gl,l):l;o[h]=this.getParameter(l,e),r&&c.type==="GLenum"&&(o[h]=Vr(this.gl,o[h]))}}return o}setParameter(e,n){e=Nh(this.gl,e),N(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const s=Q(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension))))throw new Error("Parameter not available on this platform");i.type==="GLenum"&&(n=Nh(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,r){return qT(this,e,n,r)}initialize(e){}_createHandle(){throw new Error(Ni)}_deleteHandle(){throw new Error(Ni)}_bindHandle(e){throw new Error(Ni)}_getOptsFromHandle(){throw new Error(Ni)}_getParameter(e,n){throw new Error(Ni)}_setParameter(e,n){throw new Error(Ni)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=ci.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];ci.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const i=ci.get("Memory Usage".concat(r));i.get("GPU Memory").addCount(e),i.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=ci.get("Memory Usage".concat(n));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const RB="Failed to deduce GL constant from typed array";function Bd(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(RB)}}function ca(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function OB(t){let{data:e,width:n,height:r,bytesPerPixel:i=4,temp:s}=t;const o=n*i;s=s||new Uint8Array(o);for(let a=0;a<r/2;++a){const l=a*o,c=(r-a-1)*o;s.set(e.subarray(l,l+o)),e.copyWithin(l,c,c+o),e.set(s,c)}}function FB(t){let{data:e,width:n,height:r}=t;const i=Math.round(n/2),s=Math.round(r/2),o=new Uint8Array(i*s*4);for(let a=0;a<s;a++)for(let l=0;l<i;l++)for(let c=0;c<4;c++)o[(a*i+l)*4+c]=e[(a*2*n+l*2)*4+c];return{data:o,width:i,height:s}}function Rd(t,e,n){const{removedProps:r={},deprecatedProps:i={},replacedProps:s={}}=n;for(const a in r)if(a in e){const c=r[a]?"".concat(t,".").concat(r[a]):"N/A";V.removed("".concat(t,".").concat(a),c)()}for(const a in i)if(a in e){const l=i[a];V.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))()}let o=null;for(const a in s)if(a in e){const l=s[a];V.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]}return o||e}const DB={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},NB={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ft{static getBytesPerElement(e){return ca(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return N(e.size),ca(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new ft(DB,...n)}constructor(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(i=>this._assign(i)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ft.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ft.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Rd("Accessor",e,NB),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const X_=10,ZT={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},UB={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:ZT},kB={removedProps:ZT};class ie extends dr{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ft.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ft.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Rd("Buffer",e,UB),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=Rd("Buffer",e,kB),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new ft(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:r=0,srcOffset:i=0}=e,s=e.byteLength||e.length;N(n);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),i!==0||s!==void 0?(Ze(this.gl),this.gl.bufferSubData(this.target,r,n,i,s)):this.gl.bufferSubData(o,r,n),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:r=0,writeOffset:i=0,size:s}=e;const{gl:o}=this;return Ze(o),o.bindBuffer(36662,n.handle),o.bindBuffer(36663,this.handle),o.copyBufferSubData(36662,36663,r,i,s),o.bindBuffer(36662,null),o.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:r=0,length:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ze(this.gl);const s=ca(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(n),a=r;let l,c;e?(c=e.length,l=c-a):(l=Math.min(o,i||o),c=a+l);const u=Math.min(o,l);return i=i||u,N(i<=u),e=e||new s(c),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,r,i),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:r=0,size:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?i!==void 0?this.gl.bindBufferRange(e,n,this.handle,r,i):(N(r===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(X_,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;N(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.usage),this.gl.bufferSubData(i,n,e),this.gl.bindBuffer(i,null),this.debugData=e.slice(0,X_),this.bytesUsed=r,this._trackAllocatedMemory(r);const s=Bd(e);return N(s),this.setAccessor(new ft(this.accessor,{type:s})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;N(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,n),this.gl.bindBuffer(i,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=ca(this.accessor.type||5126,{clamped:!1}),r=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new ft(this.accessor,{type:Bd(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return V.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return V.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return V.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return V.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new ft(this.accessor,e),this}}const Mp={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},$T={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},eb={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function GB(t,e){const n=Mp[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const r=Q(t)&&n.gl2||n.gl1;return typeof r=="string"?t.getExtension(r):r}function zB(t,e){const n=Mp[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const VB=[9729,9728],K_=globalThis.WebGLBuffer||function(){};class Ai extends dr{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:i}=n;let s=!0;return r&&(s=s&&GB(e,r),s=s&&(!i||zB(e,r))),s}constructor(e,n){const{id:r=cr("texture"),handle:i,target:s}=n;super(e,{id:r,handle:i}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(_=>this.initialize(Object.assign({},e,{pixels:_,data:_}))),this;const r=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(r&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:i=null,format:s=6408,border:o=0,recreate:a=!1,parameters:l={},pixelStore:c={},textureUnit:u=void 0}=e;n||(n=i);let{width:h,height:f,dataFormat:g,type:p,compressed:v=!1,mipmaps:T=!0}=e;const{depth:m=0}=e;return{width:h,height:f,compressed:v,dataFormat:g,type:p}=this._deduceParameters({format:s,type:p,dataFormat:g,compressed:v,data:n,width:h,height:f}),this.width=h,this.height=f,this.depth=m,this.format=s,this.type=p,this.dataFormat=g,this.border=o,this.textureUnit=u,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),T&&this._isNPOT()&&(V.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),T=!1,this._updateForNPOT(l)),this.mipmaps=T,this.setImageData({data:n,width:h,height:f,depth:m,format:s,type:p,dataFormat:g,border:o,mipmaps:T,parameters:c,compressed:v}),T&&this.generateMipmap(),this.setParameters(l),a&&(this.data=n),r&&(this._video={video:n,parameters:l,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:r,mipmaps:i=!1}=e;return r!==this.width||n!==this.height?this.initialize({width:r,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(V.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),fn(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:r=null,level:i=0,format:s=this.format,border:o=this.border,offset:a=0,parameters:l={}}=e;let{data:c=null,type:u=this.type,width:h=this.width,height:f=this.height,dataFormat:g=this.dataFormat,compressed:p=!1}=e;c||(c=r),{type:u,dataFormat:g,compressed:p,width:h,height:f}=this._deduceParameters({format:s,type:u,dataFormat:g,compressed:p,data:c,width:h,height:f});const{gl:v}=this;v.bindTexture(this.target,this.handle);let T=null;({data:c,dataType:T}=this._getDataType({data:c,compressed:p}));let m,_=0;if(fn(this.gl,l,()=>{switch(T){case"null":v.texImage2D(n,i,s,h,f,o,g,u,c);break;case"typed-array":v.texImage2D(n,i,s,h,f,o,g,u,c,a);break;case"buffer":m=Ze(v),m.bindBuffer(35052,c.handle||c),m.texImage2D(n,i,s,h,f,o,g,u,a),m.bindBuffer(35052,null);break;case"browser-object":Q(v)?v.texImage2D(n,i,s,h,f,o,g,u,c):v.texImage2D(n,i,s,g,u,c);break;case"compressed":for(const[y,b]of c.entries())v.compressedTexImage2D(n,y,b.format,b.width,b.height,o,b.data),_+=b.levelSize;break;default:N(!1,"Unknown image data type")}}),T==="compressed")this._trackAllocatedMemory(_,"Texture");else if(c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{const y=$T[this.dataFormat]||4,b=eb[this.type]||1;this._trackAllocatedMemory(this.width*this.height*y*b,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:r=null,data:i=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:c=0,format:u=this.format,type:h=this.type,dataFormat:f=this.dataFormat,compressed:g=!1,offset:p=0,border:v=this.border,parameters:T={}}=e;if({type:h,dataFormat:f,compressed:g,width:a,height:l}=this._deduceParameters({format:u,type:h,dataFormat:f,compressed:g,data:i,width:a,height:l}),N(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const m=i;i=m.data,a=m.shape[0],l=m.shape[1]}i instanceof ie&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),fn(this.gl,T,()=>{if(g)this.gl.compressedTexSubImage2D(n,c,s,o,a,l,u,i);else if(i===null)this.gl.texSubImage2D(n,c,s,o,a,l,f,h,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(n,c,s,o,a,l,f,h,i,p);else if(i instanceof K_){const m=Ze(this.gl);m.bindBuffer(35052,i),m.texSubImage2D(n,c,s,o,a,l,f,h,p),m.bindBuffer(35052,null)}else Q(this.gl)?Ze(this.gl).texSubImage2D(n,c,s,o,a,l,f,h,i):this.gl.texSubImage2D(n,c,s,o,f,h,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return V.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:r=!1}=e;return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof ie?{data:n.handle,dataType:"buffer"}:n instanceof K_?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:r}=e;let{width:i,height:s,dataFormat:o,type:a,compressed:l}=e;const c=Mp[n];return o=o||c&&c.dataFormat,a=a||c&&c.types[0],l=l||c&&c.compressed,{width:i,height:s}=this._deduceImageSize(r,i,s),{dataFormat:o,type:a,compressed:l,width:i,height:s,format:n,data:r}}_deduceImageSize(e,n,r){let i;return typeof ImageData<"u"&&e instanceof ImageData?i={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?i={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?i={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?i={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?i={width:e.videoWidth,height:e.videoHeight}:e?i={width:n,height:r}:i={width:n>=0?n:1,height:r>=0?r:1},N(i,"Could not deduced texture size"),N(n===void 0||i.width===n,"Deduced texture width does not match supplied width"),N(r===void 0||i.height===r,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:N(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Q(this.gl)||!this.width||!this.height?!1:!J_(this.width)||!J_(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:VB.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let jB="";function HB(t,e){return N(typeof t=="string"),t=jB+t,new Promise((n,r)=>{try{const i=new Image;i.onload=()=>n(i),i.onerror=()=>r(new Error("Could not load image ".concat(t,"."))),i.crossOrigin=e&&e.crossOrigin||"anonymous",i.src=t}catch(i){r(i)}})}class st extends Ai{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return Ai.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Iu(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:HB(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const Od=[34069,34070,34071,34072,34073,34074];class tb extends Ai{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Iu(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:n,data:r,x:i=0,y:s=0,mipmapLevel:o=0}=e;return this._subImage({target:n,data:r,x:i,y:s,mipmapLevel:o})}async setCubeMapImageData(e){let{width:n,height:r,pixels:i,data:s,border:o=0,format:a=6408,type:l=5121}=e;const{gl:c}=this,u=i||s,h=await Promise.all(Od.map(f=>{const g=u[f];return Promise.all(Array.isArray(g)?g:[g])}));this.bind(),Od.forEach((f,g)=>{h[g].length>1&&this.opts.mipmaps!==!1&&V.warn("".concat(this.id," has mipmap and multiple LODs."))(),h[g].forEach((p,v)=>{n&&r?c.texImage2D(f,v,a,n,r,o,a,l,p):c.texImage2D(f,v,a,a,l,p)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:r,height:i,pixels:s,data:o,border:a=0,format:l=6408,type:c=5121}=e,{gl:u}=this,h=s||o;return this.bind(),h instanceof Promise?h.then(f=>this.setImageDataForFace(Object.assign({},e,{face:n,data:f,pixels:f}))):this.width||this.height?u.texImage2D(n,0,l,r,i,a,l,c,h):u.texImage2D(n,0,l,l,c,h),this}}tb.FACES=Od;class WB extends Ai{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Q(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ze(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:r=6408,width:i,height:s,depth:o=1,border:a=0,format:l,type:c=5121,offset:u=0,data:h,parameters:f={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),fn(this.gl,f,()=>{ArrayBuffer.isView(h)&&this.gl.texImage3D(this.target,n,r,i,s,o,a,l,c,h),h instanceof ie&&(this.gl.bindBuffer(35052,h.handle),this.gl.texImage3D(this.target,n,r,i,s,o,a,l,c,u))}),h&&h.byteLength)this._trackAllocatedMemory(h.byteLength,"Texture");else{const g=$T[this.dataFormat]||4,p=eb[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*g*p,"Texture")}return this.loaded=!0,this}}const $r="EXT_color_buffer_float",Y_={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:$r,bpp:2},33327:{gl2:$r,bpp:4},34842:{gl2:$r,bpp:8},33326:{gl2:$r,bpp:4},33328:{gl2:$r,bpp:8},34836:{gl2:$r,bpp:16},35898:{gl2:$r,bpp:4}};function JB(t,e,n){const r=n[e];if(!r)return!1;const i=Q(t)&&r.gl2||r.gl1;return typeof i=="string"?t.getExtension(i):i}class is extends dr{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||JB(e,n,Y_)}static getSamplesForFormat(e,n){let{format:r}=n;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:r=1,height:i=1,samples:s=0}=e;return N(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&Q(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,n,r,i):this.gl.renderbufferStorage(36161,n,r,i),this.format=n,this.width=r,this.height=i,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Y_[this.format].bpp),this}resize(e){let{width:n,height:r}=e;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const XB=256,KB=1024,YB=16384,Q_=6144,q_=6145,Z_=6146,$_=34041,nb="clear: bad arguments";function Bp(t){let{framebuffer:e=null,color:n=null,depth:r=null,stencil:i=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};e&&(s.framebuffer=e);let o=0;n&&(o|=YB,n!==!0&&(s.clearColor=n)),r&&(o|=XB,r!==!0&&(s.clearDepth=r)),i&&(o|=KB,r!==!0&&(s.clearStencil=r)),N(o!==0,nb),fn(t,s,()=>{t.clear(o)})}function QB(t){let{framebuffer:e=null,buffer:n=Q_,drawBuffer:r=0,value:i=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ze(t),fn(t,{framebuffer:e},()=>{switch(n){case Q_:switch(i.constructor){case Int32Array:t.clearBufferiv(n,r,i);break;case Uint32Array:t.clearBufferuiv(n,r,i);break;case Float32Array:default:t.clearBufferfv(n,r,i)}break;case q_:t.clearBufferfv(q_,0,[i]);break;case Z_:t.clearBufferiv(Z_,0,[i]);break;case $_:const[s,o]=i;t.clearBufferfi($_,0,s,o);break;default:N(!1,nb)}})}function qB(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return N(!1),0}}function Lu(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:r=0,sourceFormat:i=6408}=e;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e;const{framebuffer:u,deleteFramebuffer:h}=rb(t);N(u);const{gl:f,handle:g,attachments:p}=u;a=a||u.width,l=l||u.height,s===36064&&g===null&&(s=1028),N(p[s]),c=c||p[s].type,o=$B(o,c,i,a,l),c=c||Bd(o);const v=f.bindFramebuffer(36160,g);return f.readPixels(n,r,a,l,i,c,o),f.bindFramebuffer(36160,v||null),h&&u.delete(),o}function ey(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=Lu(t,{sourceAttachment:e}),{width:i,height:s}=t;for(;s>n;)({data:r,width:i,height:s}=FB({data:r,width:i,height:s}));OB({data:r,width:i,height:s});const o=document.createElement("canvas");o.width=i,o.height=s;const a=o.getContext("2d"),l=a.createImageData(i,s);return l.data.set(r),a.putImageData(l,0,0),o.toDataURL()}function ZB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:r=0,sourceY:i=0,targetMipmaplevel:s=0,targetInternalFormat:o=6408}=n;let{targetX:a,targetY:l,targetZ:c,width:u,height:h}=n;const{framebuffer:f,deleteFramebuffer:g}=rb(t);N(f);const{gl:p,handle:v}=f,T=typeof a<"u"||typeof l<"u"||typeof c<"u";a=a||0,l=l||0,c=c||0;const m=p.bindFramebuffer(36160,v);N(e);let _=null;if(e instanceof Ai&&(_=e,u=Number.isFinite(u)?u:_.width,h=Number.isFinite(h)?h:_.height,_.bind(0),e=_.target),!T)p.copyTexImage2D(e,s,o,r,i,u,h,0);else switch(e){case 3553:case 34067:p.copyTexSubImage2D(e,s,a,l,r,i,u,h);break;case 35866:case 32879:Ze(p).copyTexSubImage3D(e,s,a,l,c,r,i,u,h);break}return _&&_.unbind(),p.bindFramebuffer(36160,m||null),g&&f.delete(),_}function rb(t){return t instanceof Fe?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:lR(t),deleteFramebuffer:!0}}function $B(t,e,n,r,i){if(t)return t;e=e||5121;const s=ca(e,{clamped:!1}),o=qB(n);return new s(r*i*o)}const ae={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function eR(t){const e=new st(t,{format:6408,type:5126,dataFormat:6408}),n=new Fe(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),r=n.getStatus();return e.delete(),n.delete(),r===36053}const ib={[ae.WEBGL2]:[!1,!0],[ae.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[ae.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[ae.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[ae.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[ae.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[ae.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[ae.FLOAT_BLEND]:["EXT_float_blend"],[ae.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[ae.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[ae.TEXTURE_FLOAT]:["OES_texture_float",!0],[ae.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[ae.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[ae.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[ae.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[ae.COLOR_ATTACHMENT_RGBA32F]:[eR,"EXT_color_buffer_float"],[ae.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[ae.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[ae.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[ae.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[ae.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[ae.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},tR=2;function Rp(t,e){return Op(t,e)}function Op(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>sb(t,n))}function nR(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in ib)t.luma.caps[e]===void 0&&(t.luma.caps[e]=sb(t,e));return t.luma.caps}function sb(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=rR(t,e)),t.luma.caps[e]||V.log(tR,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function rR(t,e){const n=ib[e];N(n,e);let r;const i=Q(t)&&n[1]||n[0];if(typeof i=="function")r=i(t);else if(Array.isArray(i)){r=!0;for(const s of i)r=r&&!!t.getExtension(s)}else typeof i=="string"?r=!!t.getExtension(i):typeof i=="boolean"?r=i:N(!1);return r}const ty="Multiple render targets not supported";class Fe extends dr{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:i}=n;let s=!0;return r&&(s=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),i&&(s=s&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Fe(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Ze(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Ze(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:r=1,attachments:i=null,color:s=!0,depth:o=!0,stencil:a=!1,check:l=!0,readBuffer:c=void 0,drawBuffers:u=void 0}=e;if(N(n>=0&&r>=0,"Width and height need to be integers"),this.width=n,this.height=r,i)for(const h in i){const f=i[h];(Array.isArray(f)?f[0]:f).resize({width:n,height:r})}else i=this._createDefaultAttachments(s,o,a,n,r);this.update({clearAttachments:!0,attachments:i,readBuffer:c,drawBuffers:u}),i&&l&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:r,drawBuffers:i,clearAttachments:s=!1,resizeAttachments:o=!0}=e;this.attach(n,{clearAttachments:s,resizeAttachments:o});const{gl:a}=this,l=a.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),i&&this._setDrawBuffers(i),a.bindFramebuffer(36160,l||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:r}=e;if(this.handle===null)return N(n===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),n!==this.width&&r!==this.height&&V.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(r))();for(const i in this.attachments)this.attachments[i].resize({width:n,height:r});return this.width=n,this.height=r,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i={};n&&Object.keys(this.attachments).forEach(o=>{i[o]=null}),Object.assign(i,e);const s=this.gl.bindFramebuffer(36160,this.handle);for(const o in i){N(o!==void 0,"Misspelled framebuffer binding point?");const a=Number(o),l=i[a];let c=l;if(!c)this._unattach(a);else if(c instanceof is)this._attachRenderbuffer({attachment:a,renderbuffer:c});else if(Array.isArray(l)){const[u,h=0,f=0]=l;c=u,this._attachTexture({attachment:a,texture:u,layer:h,level:f})}else this._attachTexture({attachment:a,texture:c,layer:0,level:0});r&&c&&c.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(o=>!this.attachments[o]).forEach(o=>{delete this.attachments[o]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(sR(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:r,stencil:i,drawBuffers:s=[]}=e,o=this.gl.bindFramebuffer(36160,this.handle);return(n||r||i)&&Bp(this.gl,{color:n,depth:r,stencil:i}),s.forEach((a,l)=>{QB(this.gl,{drawBuffer:l,value:a})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(){return V.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return V.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return V.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return V.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return V.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return V.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:r=0,y:i=0,width:s,height:o}=e;const a=Ze(this.gl),l=a.bindFramebuffer(36008,this.handle);return r===0&&i===0&&s===void 0&&o===void 0?a.invalidateFramebuffer(36008,n):a.invalidateFramebuffer(36008,n,r,i,s,o),a.bindFramebuffer(36008,l),this}getAttachmentParameter(e,n,r){let i=this._getAttachmentParameterFallback(n);return i===null&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),r&&i>1e3&&(i=Vr(this.gl,i)),i}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const i={};for(const s of r){const o=n?Vr(this.gl,s):s;i[o]=this.getAttachmentParameter(e,s,n)}return i}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),r={};for(const i of n){const s=Number(i),o=e?Vr(this.gl,s):s;r[o]=this.getAttachmentParameters(s,e)}return r}show(){return typeof window<"u"&&window.open(ey(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>V.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const r=ey(this,{targetMaxHeight:100});return V.image({logLevel:e,message:n,image:r},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,r,i,s){let o=null;return e&&(o=o||{},o[36064]=new st(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:s,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(o[36064])),n&&r?(o=o||{},o[33306]=new is(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(o[33306])):n?(o=o||{},o[36096]=new is(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:s}),this.ownResources.push(o[36096])):r&&N(!1),o}_unattach(e){const n=this.attachments[e];n&&(n instanceof is?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:r}=e;const{gl:i}=this;i.framebufferRenderbuffer(36160,n,36161,r.handle),this.attachments[n]=r}_attachTexture(e){let{attachment:n=36064,texture:r,layer:i,level:s}=e;const{gl:o}=this;switch(o.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:Ze(o).framebufferTextureLayer(36160,n,r.target,s,i);break;case 34067:const l=iR(i);o.framebufferTexture2D(36160,n,l,r.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,r.handle,s);break;default:N(!1,"Illegal texture type")}o.bindTexture(r.target,null),this.attachments[n]=r}_setReadBuffer(e){const n=OM(this.gl);n?n.readBuffer(e):N(e===36064||e===1029,ty),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,r=Ze(n);if(r)r.drawBuffers(e);else{const i=n.getExtension("WEBGL_draw_buffers");i?i.drawBuffersWEBGL(e):N(e.length===1&&(e[0]===36064||e[0]===1029),ty)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=nR(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function iR(t){return t<34069?t+34069:t}function sR(t){return(Fe.STATUS||{})[t]||"Framebuffer error ".concat(t)}const oR=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Fe.ATTACHMENT_PARAMETERS=oR;function aR(t,e){N(t instanceof st||t instanceof tb||t instanceof WB);const n=t.constructor,{gl:r,width:i,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u}=t,h=Object.assign({width:i,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u},e);return new n(r,h)}function lR(t,e){const{gl:n,width:r,height:i,id:s}=t;return new Fe(n,Object.assign({},e,{id:"framebuffer-for-".concat(s),width:r,height:i,attachments:{36064:t}}))}function sc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=t.match(n);return r?r[1]:e}const cR=35632,uR=35633;function hR(t){switch(t){case cR:return"fragment";case uR:return"vertex";default:return"unknown type"}}function fR(t,e,n,r){const i=t.split(/\r?\n/),s={},o={},a=r||sc(e)||"(unnamed)",l="".concat(hR(n)," shader ").concat(a);for(let u=0;u<i.length;u++){const h=i[u];if(h.length<=1)continue;const f=h.split(":"),g=f[0],p=parseInt(f[2],10);if(isNaN(p))throw new Error("GLSL compilation error in ".concat(l,": ").concat(t));g!=="WARNING"?s[p]=h:o[p]=h}const c=dR(e);return{shaderName:l,errors:ny(s,c),warnings:ny(o,c)}}function ny(t,e){let n="";for(let r=0;r<e.length;r++){const i=e[r];if(!(!t[r+3]&&!t[r+2]&&!t[r+1])&&(n+="".concat(i,`
`),t[r+1])){const s=t[r+1],o=s.split(":",3),a=o[0],l=parseInt(o[1],10)||0,c=s.substring(o.join(":").length+1).trim();n+=ob("^^^ ".concat(a,": ").concat(c,`

`),l)}}return n}function dR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=t.split(/\r?\n/),i=String(r.length+e-1).length;return r.map((s,o)=>{const a=String(o+e),l=a.length;return ob(a,i-l)+n+s})}function ob(t,e){let n="";for(let r=0;r<e;++r)n+=" ";return"".concat(n).concat(t)}function ab(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const gR="Shader: GLSL source code must be a JavaScript string";class ua extends dr{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return N(!1),"unknown"}}constructor(e,n){Iu(e),N(typeof n.source=="string",gR);const r=sc(n.source,null)||n.id||cr("unnamed ".concat(ua.getTypeName(n.shaderType)));super(e,{id:r}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const r=sc(n,null);r&&(this.id=cr(r)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(ua.getTypeName(this.shaderType),":").concat(this.id)}getName(){return sc(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:i,errors:s,warnings:o}=fR(r,this.source,this.shaderType,this.id);throw V.error("GLSL compilation errors in ".concat(i,`
`).concat(s))(),V.warn("GLSL compilation warnings in ".concat(i,`
`).concat(o))(),new Error("GLSL compilation errors in ".concat(i))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class kh extends ua{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class Gh extends ua{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const pR={5126:de.bind(null,"uniform1fv",At,1,Ke),35664:de.bind(null,"uniform2fv",At,2,Ke),35665:de.bind(null,"uniform3fv",At,3,Ke),35666:de.bind(null,"uniform4fv",At,4,Ke),5124:de.bind(null,"uniform1iv",Ar,1,Ke),35667:de.bind(null,"uniform2iv",Ar,2,Ke),35668:de.bind(null,"uniform3iv",Ar,3,Ke),35669:de.bind(null,"uniform4iv",Ar,4,Ke),35670:de.bind(null,"uniform1iv",Ar,1,Ke),35671:de.bind(null,"uniform2iv",Ar,2,Ke),35672:de.bind(null,"uniform3iv",Ar,3,Ke),35673:de.bind(null,"uniform4iv",Ar,4,Ke),35674:de.bind(null,"uniformMatrix2fv",At,4,Vn),35675:de.bind(null,"uniformMatrix3fv",At,9,Vn),35676:de.bind(null,"uniformMatrix4fv",At,16,Vn),35678:Ve,35680:Ve,5125:de.bind(null,"uniform1uiv",ml,1,Ke),36294:de.bind(null,"uniform2uiv",ml,2,Ke),36295:de.bind(null,"uniform3uiv",ml,3,Ke),36296:de.bind(null,"uniform4uiv",ml,4,Ke),35685:de.bind(null,"uniformMatrix2x3fv",At,6,Vn),35686:de.bind(null,"uniformMatrix2x4fv",At,8,Vn),35687:de.bind(null,"uniformMatrix3x2fv",At,6,Vn),35688:de.bind(null,"uniformMatrix3x4fv",At,12,Vn),35689:de.bind(null,"uniformMatrix4x2fv",At,8,Vn),35690:de.bind(null,"uniformMatrix4x3fv",At,12,Vn),35678:Ve,35680:Ve,35679:Ve,35682:Ve,36289:Ve,36292:Ve,36293:Ve,36298:Ve,36299:Ve,36300:Ve,36303:Ve,36306:Ve,36307:Ve,36308:Ve,36311:Ve},mR={},_R={},yR={},ry=[0];function Fp(t,e,n,r){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(ry[0]=t,t=ry);const i=t.length;if(i%e&&V.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let s=r[i];s||(s=new n(i),r[i]=s);for(let o=0;o<i;o++)s[o]=t[o];return s}function At(t,e){return Fp(t,e,Float32Array,mR)}function Ar(t,e){return Fp(t,e,Int32Array,_R)}function ml(t,e){return Fp(t,e,Uint32Array,yR)}function iy(t,e,n){const r=pR[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,t,e)}function vR(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function AR(t,e,n){for(const r in t){const i=t[r];if((!n||!!n[r])&&!ER(i))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),i),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function ER(t){return Array.isArray(t)||ArrayBuffer.isView(t)?bR(t):isFinite(t)||t===!0||t===!1||t instanceof Ai||t instanceof is?!0:t instanceof Fe?!!t.texture:!1}function TR(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const r=t[e];for(let i=0,s=n.length;i<s;++i)r[i]=n[i]}else t[e]=n.slice();else t[e]=n}function bR(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ve(){let t=null;return(e,n,r)=>{const i=t!==r;return i&&(e.uniform1i(n,r),t=r),i}}function de(t,e,n,r){let i=null,s=null;return(o,a,l)=>{const c=e(l,n),u=c.length;let h=!1;if(i===null)i=new Float32Array(u),s=u,h=!0;else{N(s===u,"Uniform length cannot change.");for(let f=0;f<u;++f)if(c[f]!==i[f]){h=!0;break}}return h&&(r(o,t,a,c),i.set(c)),h}}function Ke(t,e,n,r){t[e](n,r)}function Vn(t,e,n,r){t[e](n,!1,r)}const CR=5120,SR=5121,wR=5122,xR=5123,sy=0,_l=1,PR=2,IR=3,yl=4,LR=5,MR=6,Me=5126,BR=35664,RR=35665,OR=35666,lo=5124,FR=35667,DR=35668,NR=35669,co=5125,UR=36294,kR=36295,GR=36296,zR=35670,VR=35671,jR=35672,HR=35673,WR=35674,JR=35675,XR=35676,KR=35685,YR=35686,QR=35687,qR=35688,ZR=35689,$R=35690,Fd={[Me]:[Me,1,"float"],[BR]:[Me,2,"vec2"],[RR]:[Me,3,"vec3"],[OR]:[Me,4,"vec4"],[lo]:[lo,1,"int"],[FR]:[lo,2,"ivec2"],[DR]:[lo,3,"ivec3"],[NR]:[lo,4,"ivec4"],[co]:[co,1,"uint"],[UR]:[co,2,"uvec2"],[kR]:[co,3,"uvec3"],[GR]:[co,4,"uvec4"],[zR]:[Me,1,"bool"],[VR]:[Me,2,"bvec2"],[jR]:[Me,3,"bvec3"],[HR]:[Me,4,"bvec4"],[WR]:[Me,8,"mat2"],[KR]:[Me,8,"mat2x3"],[YR]:[Me,8,"mat2x4"],[JR]:[Me,12,"mat3"],[QR]:[Me,12,"mat3x2"],[qR]:[Me,12,"mat3x4"],[XR]:[Me,16,"mat4"],[ZR]:[Me,16,"mat4x2"],[$R]:[Me,16,"mat4x3"]};function e2(t){switch(t){case sy:return sy;case _l:return _l;case IR:return _l;case PR:return _l;case yl:return yl;case LR:return yl;case MR:return yl;default:return N(!1),0}}function oy(t){const e=Fd[t];if(!e)return null;const[n,r]=e;return{type:n,components:r}}function lb(t,e){switch(t){case CR:case SR:case wR:case xR:t=Me;break}for(const n in Fd){const[r,i,s]=Fd[n];if(r===t&&i===e)return{glType:n,name:s}}return null}class t2{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,r=n.getProgramParameter(e.handle,35721);for(let i=0;i<r;i++){const{name:s,type:o,size:a}=n.getActiveAttrib(e.handle,i),l=n.getAttribLocation(e.handle,s);l>=0&&this._addAttribute(l,s,o,a)}this.attributeInfos.sort((i,s)=>i.location-s.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Q(n))return;const r=n.getProgramParameter(e.handle,35971);for(let i=0;i<r;i++){const{name:s,type:o,size:a}=n.getTransformFeedbackVarying(e.handle,i);this._addVarying(i,s,o,a)}this.varyingInfos.sort((i,s)=>i.location-s.location)}_addAttribute(e,n,r,i){const{type:s,components:o}=oy(r),a={type:s,size:i*o};this._inferProperties(e,n,a);const l={location:e,name:n,accessor:new ft(a)};this.attributeInfos.push(l),this.attributeInfosByLocation[e]=l,this.attributeInfosByName[l.name]=l}_inferProperties(e,n,r){/instance/i.test(n)&&(r.divisor=1)}_addVarying(e,n,r,i){const{type:s,components:o}=oy(r),a=new ft({type:s,size:i*o}),l={location:e,name:n,accessor:a};this.varyingInfos.push(l),this.varyingInfosByName[l.name]=l}}const ay=4,n2=35981,r2=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class cb extends dr{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",r2),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:r,fs:i,varyings:s,bufferMode:o=n2}=e;return this.hash=n||"",this.vs=typeof r=="string"?new kh(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof i=="string"?new Gh(this.gl,{id:"".concat(e.id,"-fs"),source:i}):i,N(this.vs instanceof kh),N(this.fs instanceof Gh),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(Ze(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new t2(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:r=4,vertexCount:i,offset:s=0,start:o,end:a,isIndexed:l=!1,indexType:c=5123,instanceCount:u=0,isInstanced:h=u>0,vertexArray:f=null,transformFeedback:g,framebuffer:p,parameters:v={},uniforms:T,samplers:m}=e;if((T||m)&&(V.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(T||{})),V.priority>=n){const _=p?p.id:"default",y="mode=".concat(Vr(this.gl,r)," verts=").concat(i," ")+"instances=".concat(u," indexType=").concat(Vr(this.gl,c)," ")+"isInstanced=".concat(h," isIndexed=").concat(l," ")+"Framebuffer=".concat(_);V.log(n,y)()}return N(f),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||h&&u===0?!1:(f.bindForDraw(i,u,()=>{if(p!==void 0&&(v=Object.assign({},v,{framebuffer:p})),g){const _=e2(r);g.begin(_)}this._bindTextures(),fn(this.gl,v,()=>{l&&h?this.gl2.drawElementsInstanced(r,i,c,s,u):l&&Q(this.gl)&&!isNaN(o)&&!isNaN(a)?this.gl2.drawRangeElements(r,o,a,i,c,s):l?this.gl.drawElements(r,i,c,s):h?this.gl2.drawArraysInstanced(r,s,i,u):this.gl.drawArrays(r,s,i)}),g&&g.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};V.priority>=2&&AR(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const r=e[n],i=this._uniformSetters[n];if(i){let s=r,o=!1;if(s instanceof Fe&&(s=s.texture),s instanceof Ai)if(o=this.uniforms[n]!==r,o){i.textureIndex===void 0&&(i.textureIndex=this._textureIndexCounter++);const a=s,{textureIndex:l}=i;a.bind(l),s=l,this._textureUniforms[n]=a}else s=i.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(i(s)||o)&&TR(this.uniforms,n,r)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const r=this._textureUniforms[n];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),r={};for(const i of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new kh({handle:i});break;case 35632:r.fs=new Gh({handle:i});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=cr(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),V.time(ay,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),V.timeEnd(ay,"linkProgram for ".concat(this._getName()))(),e.debug||V.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const r=this.gl.getActiveUniform(this.handle,n),{name:i}=vR(r.name);let s=e.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=iy(e,s,r),r.size>1)for(let o=0;o<r.size;o++)s=e.getUniformLocation(this.handle,"".concat(i,"[").concat(o,"]")),this._uniformSetters["".concat(i,"[").concat(o,"]")]=iy(e,s,r)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const i2=34918,s2=34919,o2=35007,a2=36795,l2=35976,c2=35887,u2=36202;class Jc extends dr{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=Q(e),i=Op(e,ae.TIMER_QUERY);let s=r||i;for(const o of n)switch(o){case"queries":s=s&&r;break;case"timers":s=s&&i;break;default:N(!1)}return s}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(o2)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?u2:c2)}beginTransformFeedbackQuery(){return this.begin(l2)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,s2);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(a2)}getResult(){return this.gl2.getQueryParameter(this.handle,i2)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((r,i)=>{const s=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):n++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return Jc.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class ub extends dr{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Q(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ze(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Ps(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const r=this._getVaryingIndex(e),{buffer:i,byteSize:s,byteOffset:o}=this._getBufferParams(n);return r<0?(this.unused[e]=i,V.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=n,this.bindOnUse||this._bindBuffer(r,i,o,s),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,r,i;return e instanceof ie?i=e:(i=e.buffer,r=e.byteSize,n=e.byteOffset),(n!==void 0||r!==void 0)&&(n=n||0,r=r||i.byteLength-n),{buffer:i,byteOffset:n,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:r,byteOffset:i}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,i,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const s=n&&n.handle;return!s||i===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,r,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let vl=null;function h2(t){return(!vl||vl.byteLength<t)&&(vl=new ArrayBuffer(t)),vl}function f2(t,e){const n=h2(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function d2(t){let{target:e,source:n,start:r=0,count:i=1}=t;const s=n.length,o=i*s;let a=0;for(let l=r;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return e}const g2="elements must be GL.ELEMENT_ARRAY_BUFFER";class bt extends dr{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Q(e)||jT()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new bt(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return bt.MAX_ATTRIBUTES=bt.MAX_ATTRIBUTES||e.getParameter(34921),bt.MAX_ATTRIBUTES}static setConstant(e,n,r){switch(r.constructor){case Float32Array:bt._setConstantFloatArray(e,n,r);break;case Int32Array:bt._setConstantIntArray(e,n,r);break;case Uint32Array:bt._setConstantUintArray(e,n,r);break;default:N(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return bt.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return N(!e||e.target===34963,g2),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,r){if(n.target===34963)return this.setElementBuffer(n,r);const{size:i,type:s,stride:o,offset:a,normalized:l,integer:c,divisor:u}=r,{gl:h,gl2:f}=this;return e=Number(e),this.bind(()=>{h.bindBuffer(34962,n.handle),c?(N(Q(h)),f.vertexAttribIPointer(e,i,s,o,a)):h.vertexAttribPointer(e,i,s,l,o,a),h.enableVertexAttribArray(e),f.vertexAttribDivisor(e,u||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!bt.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const r=this._normalizeConstantArrayValue(n),i=r.byteLength*e,s=r.length*e;let o=!this.buffer;if(this.buffer=this.buffer||new ie(this.gl,i),o=o||this.buffer.reallocate(i),o=o||!this._compareConstantArrayValues(r,this.bufferValue),o){const a=f2(n.constructor,s);d2({target:a,source:r,start:0,count:s}),this.buffer.subData(a),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==n[r])return!1;return!0}static _setConstantFloatArray(e,n,r){switch(r.length){case 1:e.vertexAttrib1fv(n,r);break;case 2:e.vertexAttrib2fv(n,r);break;case 3:e.vertexAttrib3fv(n,r);break;case 4:e.vertexAttrib4fv(n,r);break;default:N(!1)}}static _setConstantIntArray(e,n,r){switch(N(Q(e)),r.length){case 1:e.vertexAttribI1iv(n,r);break;case 2:e.vertexAttribI2iv(n,r);break;case 3:e.vertexAttribI3iv(n,r);break;case 4:e.vertexAttribI4iv(n,r);break;default:N(!1)}}static _setConstantUintArray(e,n,r){switch(N(Q(e)),r.length){case 1:e.vertexAttribI1uiv(n,r);break;case 2:e.vertexAttribI2uiv(n,r);break;case 3:e.vertexAttribI3uiv(n,r);break;case 4:e.vertexAttribI4uiv(n,r);break;default:N(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:r}=n;return N(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const p2="VertexArray: attributes must be Buffers or constants (i.e. typed array)",m2=/^(.+)__LOCATION_([0-9]+)$/,_2=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class y2{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new bt(e),qT(this,"VertexArray","v6.0",_2),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const r=e[n];this._setAttribute(n,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,r);const{location:i,accessor:s}=this._resolveLocationAndAccessor(e,n,n.accessor,r);return i>=0&&(this.values[i]=n,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,n,s)),this}setConstant(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:i,accessor:s}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},r));return i>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[i]=n,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new ie(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof ie&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof ie&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,r){let i;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),i=r()}),i}_resolveLocationAndAccessor(e,n,r,i){const s={location:-1,accessor:null},{location:o,name:a}=this._getAttributeIndex(e);if(!Number.isFinite(o)||o<0)return this.unused[e]=n,V.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),s;const l=this._getAttributeInfo(a||o);if(!l)return s;const c=this.accessors[o]||{},u=ft.resolve(l.accessor,c,r,i),{size:h,type:f}=u;return N(Number.isFinite(h)&&Number.isFinite(f)),{location:o,accessor:u}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const r=m2.exec(e),i=r?r[1]:e,s=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+s,name:i}:{location:-1}}_setAttribute(e,n){if(n instanceof ie)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof ie){const r=n[0],i=n[1];this.setBuffer(e,r,i)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const r=n;this.setConstant(e,r)}else if(n.buffer instanceof ie){const r=n;this.setBuffer(e,r.buffer,r)}else throw new Error(p2)}_setConstantAttributes(e,n){const r=Math.max(e|0,n|0);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,r);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)i=this.values[s],ArrayBuffer.isView(i)&&this._setConstantAttribute(s,i)}_setConstantAttributeZero(e,n){if(bt.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,n){bt.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const r=this.values[n],i=this.accessors[n];if(!r)return;const{divisor:s}=i,o=s>0;if(e.isInstanced=e.isInstanced||o,r instanceof ie){const a=r;if(o){const l=a.getVertexCount(i);e.instanceCount=Math.min(e.instanceCount,l)}else{const l=a.getVertexCount(i);e.vertexCount=Math.min(e.vertexCount,l)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return V.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function v2(t,e){const{maxElts:n=16,size:r=1}=e;let i="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(i+=",".concat(o%r===0?" ":"")),i+=ha(t[o],e);const s=t.length>n?"...":"]";return"".concat(i).concat(s)}function ha(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:r=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return v2(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return r?"0":"0.";if(r||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const i=t.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function ly(t){let{header:e="Uniforms",program:n,uniforms:r,undefinedOnly:i=!1}=t;N(n);const s=".*_.*",o=".*Matrix",a=n._uniformSetters,l={},c=Object.keys(a).sort();let u=0;for(const g of c)!g.match(s)&&!g.match(o)&&zh({table:l,header:e,uniforms:r,uniformName:g,undefinedOnly:i})&&u++;for(const g of c)g.match(o)&&zh({table:l,header:e,uniforms:r,uniformName:g,undefinedOnly:i})&&u++;for(const g of c)l[g]||zh({table:l,header:e,uniforms:r,uniformName:g,undefinedOnly:i})&&u++;let h=0;const f={};if(!i)for(const g in r){const p=r[g];l[g]||(h++,f[g]={Type:"NOT USED: ".concat(p),[e]:ha(p)})}return{table:l,count:u,unusedTable:f,unusedCount:h}}function zh(t){let{table:e,header:n,uniforms:r,uniformName:i,undefinedOnly:s}=t;const o=r[i],a=A2(o);return!s||!a?(e[i]={[n]:a?ha(o):"N/A","Uniform Type":a?o:"NOT PROVIDED"},!0):!1}function A2(t){return t!=null}function E2(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=cy(e,e.elements,null,n));const i=e.values;for(const s in i){const o=e._getAttributeInfo(s);if(o){let a="".concat(s,": ").concat(o.name);const l=e.accessors[o.location];l&&(a="".concat(s,": ").concat(T2(o.name,l))),r[a]=cy(e,i[s],l,n)}}return r}function cy(t,e,n,r){const{gl:i}=t;if(!e)return{[r]:"null","Format ":"N/A"};let s="NOT PROVIDED",o=1,a=0,l=0,c,u,h;if(n&&(s=n.type,o=n.size,s=String(s).replace("Array",""),c=s.indexOf("nt")!==-1),e instanceof ie){const f=e,{data:g,changed:p}=f.getDebugData();u=p?"*":"",h=g,l=f.byteLength,a=l/g.BYTES_PER_ELEMENT/o;let v;if(n){const T=n.divisor>0;v="".concat(T?"I ":"P "," ").concat(a," (x").concat(o,"=").concat(l," bytes ").concat(Vr(i,s),")")}else c=!0,v="".concat(l," bytes");return{[r]:"".concat(u).concat(ha(h,{size:o,isInteger:c})),"Format ":v}}return h=e,o=e.length,s=String(e.constructor.name).replace("Array",""),c=s.indexOf("nt")!==-1,{[r]:"".concat(ha(h,{size:o,isInteger:c})," (constant)"),"Format ":"".concat(o,"x").concat(s," (constant)")}}function T2(t,e){const{type:n,size:r}=e,i=lb(n,r);return i?"".concat(t," (").concat(i.name,")"):t}function b2(t){const e={},n="Accessors for ".concat(t.id);for(const r of t.attributeInfos)if(r){const i=uy(r);e["in ".concat(i)]={[n]:JSON.stringify(r.accessor)}}for(const r of t.varyingInfos)if(r){const i=uy(r);e["out ".concat(i)]={[n]:JSON.stringify(r.accessor)}}return e}function uy(t){const{type:e,size:n}=t.accessor,r=lb(e,n);return r?"".concat(r.name," ").concat(t.name):t.name}const hy=fr()&&typeof document<"u";let C2=0;class S2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=T=>QT(T),onAddHTML:r=null,onInitialize:i=()=>{},onRender:s=()=>{},onFinalize:o=()=>{},onError:a,gl:l=null,glOptions:c={},debug:u=!1,createFramebuffer:h=!1,autoResizeViewport:f=!0,autoResizeDrawingBuffer:g=!0,stats:p=ci.get("animation-loop-".concat(C2++))}=e;let{useDevicePixels:v=!0}=e;"useDevicePixelRatio"in e&&(V.deprecated("useDevicePixelRatio","useDevicePixels")(),v=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:r,onInitialize:i,onRender:s,onFinalize:o,onError:a,gl:l,glOptions:c,debug:u,createFramebuffer:h},this.gl=l,this.needsRedraw=null,this.timeline=null,this.stats=p,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:f,autoResizeDrawingBuffer:g,useDevicePixels:v}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return N(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Jc.isSupported(this.gl,["timers"])?new Jc(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):n}setViewParameters(){return V.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=hy?new Promise((e,n)=>{if(hy&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):BB(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):MB(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Ip(this.props.gl,e):this.onCreateContext(e),!Pu(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");yB(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let r=1;const{canvas:i}=this.gl;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&bB(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Fe(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Ma="vs",Dp="fs";function It(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Vh={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function w2(t){const e={};for(const n in t){const r=t[n],i=x2(r);e[n]=i}return e}function x2(t){let e=fy(t);return e==="object"?t?"type"in t?Object.assign({},t,Vh[t.type]):"value"in t?(e=fy(t.value),Object.assign({type:e},t,Vh[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},Vh[e])}function fy(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const P2="vs",I2="fs";class dy{constructor(e){let{name:n,vs:r,fs:i,dependencies:s=[],uniforms:o,getUniforms:a,deprecations:l=[],defines:c={},inject:u={},vertexShader:h,fragmentShader:f}=e;It(typeof n=="string"),this.name=n,this.vs=r||h,this.fs=i||f,this.getModuleUniforms=a,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(l),this.defines=c,this.injections=L2(u),o&&(this.uniforms=w2(o))}getModuleSource(e){let n;switch(e){case P2:n=this.vs||"";break;case I2:n=this.fs||"";break;default:It(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},r=this.uniforms;for(const i in r){const s=r[i];i in e&&!s.private?(s.validate&&It(s.validate(e[i],s),"".concat(this.name,": invalid ").concat(i)),n[i]=e[i]):n[i]=s.value}return n}}function L2(t){const e={vs:{},fs:{}};for(const n in t){let r=t[n];const i=n.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function M2(t){return B2(fb(t))}function B2(t){const e={},n={};return hb({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,i)=>n[i]-n[r]).map(r=>e[r])}function hb(t){let{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&hb({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function fb(t,e){return t.map(n=>(n instanceof dy||(It(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),It(n.name,"shader module has no name"),n=new dy(n),n.dependencies=fb(n.dependencies)),n))}function R2(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",r=n.indexOf("MSIE ")!==-1,i=n.indexOf("Trident/")!==-1;return r||i}const O2=7936,F2=7937,D2=7938,N2=35724,Np={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},si={};Object.keys(Np).forEach(t=>{si[t]=t});function U2(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function k2(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||O2),r=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||F2);return{gpuVendor:G2(n,r),vendor:n,renderer:r,version:t.getParameter(D2),shadingLanguageVersion:t.getParameter(N2)}}function G2(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const jh={};function gy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Np[e];if(It(r,e),!R2(n))return!0;if(e in jh)return jh[e];const i=r[0],s=n.behavior||"enable",o="#extension GL_".concat(i," : ").concat(s,`
void main(void) {}`),a=t.createShader(35633);t.shaderSource(a,o),t.compileShader(a);const l=t.getShaderParameter(a,35713);return t.deleteShader(a),jh[e]=l,l}function z2(t,e){const n=Np[e];It(n,e);const r=U2(t)&&n[1]||n[0],i=typeof r=="string"?!!t.getExtension(r):r;return It(i===!1||i===!0),i}function Al(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>z2(t,n))}function V2(t){switch(k2(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function j2(t,e,n){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Al(t,si.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Al(t,si.GLSL_DERIVATIVES)&&gy(t,si.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Al(t,si.GLSL_FRAG_DATA)&&gy(t,si.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Al(t,si.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const H2=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,W2=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,J2={[Ma]:H2,[Dp]:W2},oc="__LUMA_INJECT_DECLARATIONS__",py=/void\s+main\s*\([^)]*\)\s*\{\n?/,my=/}\n?[^{}]*$/,Hh=[];function _y(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=e===Ma;for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),Hh.length=o.length;for(let l=0,c=o.length;l<c;++l)Hh[l]=o[l].injection;const a="".concat(Hh.join(`
`),`
`);switch(s){case"vs:#decl":i&&(t=t.replace(oc,a));break;case"vs:#main-start":i&&(t=t.replace(py,l=>l+a));break;case"vs:#main-end":i&&(t=t.replace(my,l=>a+l));break;case"fs:#decl":i||(t=t.replace(oc,a));break;case"fs:#main-start":i||(t=t.replace(py,l=>l+a));break;case"fs:#main-end":i||(t=t.replace(my,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(oc,""),r&&(t=t.replace(/\}\s*$/,s=>s+J2[e])),t}function Dd(t){const e={};return It(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const r in n)e[r]=e[r]?"".concat(e[r],`
`).concat(n[r]):n[r]}),e}function Is(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const db=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],X2=[...db,[Is("attribute"),"in $1"],[Is("varying"),"out $1"]],K2=[...db,[Is("varying"),"in $1"]],gb=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],Y2=[...gb,[Is("in"),"attribute $1"],[Is("out"),"varying $1"]],Q2=[...gb,[Is("in"),"varying $1"]],Nd="gl_FragColor",Ud=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,q2=/void\s+main\s*\([^)]*\)\s*\{\n?/;function Z2(t,e,n){switch(e){case 300:return n?Xc(t,X2):$2(t);case 100:return n?Xc(t,Y2):eO(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Xc(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function $2(t){t=Xc(t,K2);const e=t.match(Ud);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(Nd,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(q2,r=>"out vec4 ".concat(n,`;
`).concat(r)).replace(new RegExp("\\b".concat(Nd,"\\b"),"g"),n)}return t}function eO(t){t=Xc(t,Q2);const e=t.match(Ud);if(e){const n=e[1];t=t.replace(Ud,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),Nd)}return t}const tO=`

`.concat(oc,`

`),pb={[Ma]:"vertex",[Dp]:"fragment"},nO=`precision highp float;

`;function rO(t,e){const{vs:n,fs:r}=e,i=M2(e.modules||[]);return{gl:t,vs:yy(t,Object.assign({},e,{source:n,type:Ma,modules:i})),fs:yy(t,Object.assign({},e,{source:r,type:Dp,modules:i})),getUniforms:iO(i)}}function yy(t,e){let{id:n,source:r,type:i,modules:s,defines:o={},hookFunctions:a=[],inject:l={},transpileToGLSL100:c=!1,prologue:u=!0,log:h}=e;It(typeof r=="string","shader source must be a string");const f=i===Ma,g=r.split(`
`);let p=100,v="",T=r;g[0].indexOf("#version ")===0?(p=300,v=g[0],T=g.slice(1).join(`
`)):v="#version ".concat(p);const m={};s.forEach(I=>{Object.assign(m,I.getDefines())}),Object.assign(m,o);let _=u?"".concat(v,`
`).concat(oO({id:n,source:r,type:i}),`
`).concat(sO({type:i}),`
`).concat(V2(t),`
`).concat(j2(t),`
`).concat(aO(m),`
`).concat(f?"":nO,`
`):"".concat(v,`
`);const y=cO(a),b={},S={},w={};for(const I in l){const L=typeof l[I]=="string"?{injection:l[I],order:0}:l[I],B=I.match(/^(v|f)s:(#)?([\w-]+)$/);if(B){const M=B[2],G=B[3];M?G==="decl"?S[I]=[L]:w[I]=[L]:b[I]=[L]}else w[I]=[L]}for(const I of s){h&&I.checkDeprecations(T,h);const L=I.getModuleSource(i,p);_+=L;const B=I.injections[i];for(const M in B){const G=M.match(/^(v|f)s:#([\w-]+)$/);if(G){const j=G[2]==="decl"?S:w;j[M]=j[M]||[],j[M].push(B[M])}else b[M]=b[M]||[],b[M].push(B[M])}}return _+=tO,_=_y(_,i,S),_+=lO(y[i],b),_+=T,_=_y(_,i,w),_=Z2(_,c?100:p,f),_}function iO(t){return function(n){const r={};for(const i of t){const s=i.getUniforms(n,r);Object.assign(r,s)}return r}}function sO(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(pb[e].toUpperCase(),`
`)}function oO(t){let{id:e,source:n,type:r}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(pb[r],`

`):""}function aO(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const r in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const i=t[r];(i||Number.isFinite(i))&&(n+="#define ".concat(r.toUpperCase()," ").concat(t[r],`
`))}return e===0&&(n+=`
`),n}function lO(t,e){let n="";for(const r in t){const i=t[r];if(n+="void ".concat(i.signature,` {
`),i.header&&(n+="  ".concat(i.header)),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)n+="  ".concat(o.injection,`
`)}i.footer&&(n+="  ".concat(i.footer)),n+=`}
`}return n}function cO(t){const e={vs:{},fs:{}};return t.forEach(n=>{let r;typeof n!="string"?(r=n,n=r.hook):r={},n=n.trim();const[i,s]=n.split(":"),o=n.replace(/\(.+/,"");e[i][o]=Object.assign(r,{signature:s})}),e}const uO="void main() {gl_FragColor = vec4(0);}",mb=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,hO=`#version 300 es
`.concat(mb);function _b(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[r,i,s]=n;if(!e.includes(r)||!i||!s)return null;const o=s.split(";")[0];return{qualifier:r,type:i,name:o}}function yb(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:r,output:i}=t;if(!n)return e===300?hO:e>300?"#version ".concat(e,`
`).concat(mb):uO;const s=gO(n,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(n,`;
out vec4 `).concat(i,`;
void main() {
  `).concat(i," = ").concat(s,`;
}`):"varying ".concat(r," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function fO(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return It(!1),null}}function dO(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return It(!1),null}}function gO(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return It(!1),null}}const pO=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,mO={name:"fp32",vs:pO,fs:null};function on(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const _O=1/Math.PI*180,yO=1/180*Math.PI,Oe={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function vO(t,{precision:e=Oe.precision}={}){return t=bO(t),"".concat(parseFloat(t.toPrecision(e)))}function Jr(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function AO(t){return TO(t)}function EO(t){return Qn(t)}function TO(t,e){return Up(t,n=>n*yO,e)}function Qn(t,e){return Up(t,n=>n*_O,e)}function qn(t,e,n){return Up(t,r=>Math.max(e,Math.min(n,r)))}function Kc(t,e,n){return Jr(t)?t.map((r,i)=>Kc(r,e[i],n)):n*e+(1-n)*t}function dn(t,e,n){const r=Oe.EPSILON;n&&(Oe.EPSILON=n);try{if(t===e)return!0;if(Jr(t)&&Jr(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!dn(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Oe.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Oe.EPSILON=r}}function bO(t){return Math.round(t/Oe.EPSILON)*Oe.EPSILON}function CO(t){return t.clone?t.clone():new Array(t.length)}function Up(t,e,n){if(Jr(t)){const r=t;n=n||CO(r);for(let i=0;i<n.length&&i<r.length;++i)n[i]=e(t[i],i,n);return n}return e(t)}function SO(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class kp extends SO(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Jr(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Oe)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+vO(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!dn(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i];this[i]=s+r*(n[i]-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Oe.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function wO(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function re(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function zo(t,e,n=""){if(Oe.debug&&!wO(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class Gp extends kp{get x(){return this[0]}set x(e){this[0]=re(e)}get y(){return this[1]}set y(e){this[1]=re(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return re(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return re(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return on(e>=0&&e<this.ELEMENTS,"index is out of range"),re(this[e])}setComponent(e,n){return on(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Vo=1e-6,mn=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function xO(){var t=new mn(2);return mn!=Float32Array&&(t[0]=0,t[1]=0),t}function vy(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function PO(t,e){return t[0]=-e[0],t[1]=-e[1],t}function vb(t,e,n,r){var i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function IO(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function LO(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function Ab(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function Eb(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){var t=xO();return function(e,n,r,i,s,o){var a,l;for(n||(n=2),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function Tb(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function bb(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function MO(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function BO(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t[3]=e[3],t}function Cb(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=n[0]*r+n[3]*i+n[6]*s,t[1]=n[1]*r+n[4]*i+n[7]*s,t[2]=n[2]*r+n[5]*i+n[8]*s,t[3]=e[3],t}class zp extends Gp{constructor(e=0,n=0){super(2),Jr(e)&&arguments.length===1?this.copy(e):(Oe.debug&&(re(e),re(n)),this[0]=e,this[1]=n)}set(e,n){return this[0]=e,this[1]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Oe.debug&&(re(e.x),re(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Eb(this,this,e),this.check()}transformAsVector(e){return Tb(this,this,e),this.check()}transformByMatrix3(e){return Ab(this,this,e),this.check()}transformByMatrix2x3(e){return LO(this,this,e),this.check()}transformByMatrix2(e){return IO(this,this,e),this.check()}}function Sb(){var t=new mn(3);return mn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function wb(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Ay(t,e,n){var r=new mn(3);return r[0]=t,r[1]=e,r[2]=n,r}function RO(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function OO(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function FO(t,e){var n=e[0],r=e[1],i=e[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Vp(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ac(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=i*l-s*a,t[1]=s*o-r*l,t[2]=r*a-i*o,t}function jp(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function xb(t,e,n){var r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function Pb(t,e,n){var r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2],u=i*c-s*l,h=s*a-r*c,f=r*l-i*a,g=i*f-s*h,p=s*u-r*f,v=r*h-i*u,T=o*2;return u*=T,h*=T,f*=T,g*=2,p*=2,v*=2,t[0]=a+u+g,t[1]=l+h+p,t[2]=c+f+v,t}function DO(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function NO(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function UO(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function kO(t,e){var n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt(n*n+r*r+i*i),c=Math.sqrt(s*s+o*o+a*a),u=l*c,h=u&&Vp(t,e)/u;return Math.acos(Math.min(Math.max(h,-1),1))}var GO=RO,zO=wb;(function(){var t=Sb();return function(e,n,r,i,s,o){var a,l;for(n||(n=3),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Wh=[0,0,0];let El;class x extends Gp{static get ZERO(){return El||(El=new x(0,0,0),Object.freeze(El)),El}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&Jr(e)?this.copy(e):(Oe.debug&&(re(e),re(n),re(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Oe.debug&&(re(e.x),re(e.y),re(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=re(e)}angle(e){return kO(this,e)}cross(e){return ac(this,this,e),this.check()}rotateX({radians:e,origin:n=Wh}){return DO(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Wh}){return NO(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Wh}){return UO(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return jp(this,this,e),this.check()}transformAsVector(e){return bb(this,this,e),this.check()}transformByMatrix3(e){return xb(this,this,e),this.check()}transformByMatrix2(e){return MO(this,this,e),this.check()}transformByQuaternion(e){return Pb(this,this,e),this.check()}}let Tl;class Hp extends Gp{static get ZERO(){return Tl||(Tl=new Hp(0,0,0,0),Object.freeze(Tl)),Tl}constructor(e=0,n=0,r=0,i=0){super(-0,-0,-0,-0),Jr(e)&&arguments.length===1?this.copy(e):(Oe.debug&&(re(e),re(n),re(r),re(i)),this[0]=e,this[1]=n,this[2]=r,this[3]=i)}set(e,n,r,i){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Oe.debug&&(re(e.x),re(e.y),re(e.z),re(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=re(e)}get w(){return this[3]}set w(e){this[3]=re(e)}transform(e){return jp(this,this,e),this.check()}transformByMatrix3(e){return Cb(this,this,e),this.check()}transformByMatrix2(e){return BO(this,this,e),this.check()}transformByQuaternion(e){return Pb(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class Ib extends kp{toString(){let e="[";if(Oe.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=re(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function VO(){var t=new mn(9);return mn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function jO(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function HO(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,f=-u*s+a*l,g=c*s-o*l,p=n*h+r*f+i*g;return p?(p=1/p,t[0]=h*p,t[1]=(-u*r+i*c)*p,t[2]=(a*r-i*o)*p,t[3]=f*p,t[4]=(u*n-i*l)*p,t[5]=(-a*n+i*s)*p,t[6]=g*p,t[7]=(-c*n+r*l)*p,t[8]=(o*n-r*s)*p,t):null}function WO(t){var e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+n*(-c*i+o*a)+r*(l*i-s*a)}function Ey(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=n[0],g=n[1],p=n[2],v=n[3],T=n[4],m=n[5],_=n[6],y=n[7],b=n[8];return t[0]=f*r+g*o+p*c,t[1]=f*i+g*a+p*u,t[2]=f*s+g*l+p*h,t[3]=v*r+T*o+m*c,t[4]=v*i+T*a+m*u,t[5]=v*s+T*l+m*h,t[6]=_*r+y*o+b*c,t[7]=_*i+y*a+b*u,t[8]=_*s+y*l+b*h,t}function JO(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=n[0],g=n[1];return t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=f*r+g*o+c,t[7]=f*i+g*a+u,t[8]=f*s+g*l+h,t}function XO(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=Math.sin(n),g=Math.cos(n);return t[0]=g*r+f*o,t[1]=g*i+f*a,t[2]=g*s+f*l,t[3]=g*o-f*r,t[4]=g*a-f*i,t[5]=g*l-f*s,t[6]=c,t[7]=u,t[8]=h,t}function Ty(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function KO(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,l=i+i,c=n*o,u=r*o,h=r*a,f=i*o,g=i*a,p=i*l,v=s*o,T=s*a,m=s*l;return t[0]=1-h-p,t[3]=u-m,t[6]=f+T,t[1]=u+m,t[4]=1-c-p,t[7]=g-v,t[2]=f-T,t[5]=g+v,t[8]=1-c-h,t}var kd;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(kd||(kd={}));const YO=Object.freeze([1,0,0,0,1,0,0,0,1]);class Se extends Ib{static get IDENTITY(){return qO()}static get ZERO(){return QO()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return kd}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(YO)}fromObject(e){return this.check()}fromQuaternion(e){return KO(this,e),this.check()}set(e,n,r,i,s,o,a,l,c){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this.check()}setRowMajor(e,n,r,i,s,o,a,l,c){return this[0]=e,this[1]=i,this[2]=a,this[3]=n,this[4]=s,this[5]=l,this[6]=r,this[7]=o,this[8]=c,this.check()}determinant(){return WO(this)}transpose(){return jO(this,this),this.check()}invert(){return HO(this,this),this.check()}multiplyLeft(e){return Ey(this,e,this),this.check()}multiplyRight(e){return Ey(this,this,e),this.check()}rotate(e){return XO(this,this,e),this.check()}scale(e){return Array.isArray(e)?Ty(this,this,e):Ty(this,this,[e,e]),this.check()}translate(e){return JO(this,this,e),this.check()}transform(e,n){let r;switch(e.length){case 2:r=Ab(n||[-0,-0],e,this);break;case 3:r=xb(n||[-0,-0,-0],e,this);break;case 4:r=Cb(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return zo(r,e.length),r}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let bl,Cl;function QO(){return bl||(bl=new Se([0,0,0,0,0,0,0,0,0]),Object.freeze(bl)),bl}function qO(){return Cl||(Cl=new Se,Object.freeze(Cl)),Cl}function ZO(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $O(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Gd(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],g=e[11],p=e[12],v=e[13],T=e[14],m=e[15],_=n*a-r*o,y=n*l-i*o,b=n*c-s*o,S=r*l-i*a,w=r*c-s*a,I=i*c-s*l,L=u*v-h*p,B=u*T-f*p,M=u*m-g*p,G=h*T-f*v,W=h*m-g*v,j=f*m-g*T,Y=_*j-y*W+b*G+S*M-w*B+I*L;return Y?(Y=1/Y,t[0]=(a*j-l*W+c*G)*Y,t[1]=(i*W-r*j-s*G)*Y,t[2]=(v*I-T*w+m*S)*Y,t[3]=(f*w-h*I-g*S)*Y,t[4]=(l*M-o*j-c*B)*Y,t[5]=(n*j-i*M+s*B)*Y,t[6]=(T*b-p*I-m*y)*Y,t[7]=(u*I-f*b+g*y)*Y,t[8]=(o*W-a*M+c*L)*Y,t[9]=(r*M-n*W-s*L)*Y,t[10]=(p*w-v*b+m*_)*Y,t[11]=(h*b-u*w-g*_)*Y,t[12]=(a*B-o*G-l*L)*Y,t[13]=(n*G-r*B+i*L)*Y,t[14]=(v*y-p*S-T*_)*Y,t[15]=(u*S-h*y+f*_)*Y,t):null}function e3(t){var e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],f=t[11],g=t[12],p=t[13],v=t[14],T=t[15],m=e*o-n*s,_=e*a-r*s,y=e*l-i*s,b=n*a-r*o,S=n*l-i*o,w=r*l-i*a,I=c*p-u*g,L=c*v-h*g,B=c*T-f*g,M=u*v-h*p,G=u*T-f*p,W=h*T-f*v;return m*W-_*G+y*M+b*B-S*L+w*I}function gi(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=e[9],g=e[10],p=e[11],v=e[12],T=e[13],m=e[14],_=e[15],y=n[0],b=n[1],S=n[2],w=n[3];return t[0]=y*r+b*a+S*h+w*v,t[1]=y*i+b*l+S*f+w*T,t[2]=y*s+b*c+S*g+w*m,t[3]=y*o+b*u+S*p+w*_,y=n[4],b=n[5],S=n[6],w=n[7],t[4]=y*r+b*a+S*h+w*v,t[5]=y*i+b*l+S*f+w*T,t[6]=y*s+b*c+S*g+w*m,t[7]=y*o+b*u+S*p+w*_,y=n[8],b=n[9],S=n[10],w=n[11],t[8]=y*r+b*a+S*h+w*v,t[9]=y*i+b*l+S*f+w*T,t[10]=y*s+b*c+S*g+w*m,t[11]=y*o+b*u+S*p+w*_,y=n[12],b=n[13],S=n[14],w=n[15],t[12]=y*r+b*a+S*h+w*v,t[13]=y*i+b*l+S*f+w*T,t[14]=y*s+b*c+S*g+w*m,t[15]=y*o+b*u+S*p+w*_,t}function Yc(t,e,n){var r=n[0],i=n[1],s=n[2],o,a,l,c,u,h,f,g,p,v,T,m;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],h=e[5],f=e[6],g=e[7],p=e[8],v=e[9],T=e[10],m=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=h,t[6]=f,t[7]=g,t[8]=p,t[9]=v,t[10]=T,t[11]=m,t[12]=o*r+u*i+p*s+e[12],t[13]=a*r+h*i+v*s+e[13],t[14]=l*r+f*i+T*s+e[14],t[15]=c*r+g*i+m*s+e[15]),t}function Wp(t,e,n){var r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function t3(t,e,n,r){var i=r[0],s=r[1],o=r[2],a=Math.hypot(i,s,o),l,c,u,h,f,g,p,v,T,m,_,y,b,S,w,I,L,B,M,G,W,j,Y,lt;return a<Vo?null:(a=1/a,i*=a,s*=a,o*=a,l=Math.sin(n),c=Math.cos(n),u=1-c,h=e[0],f=e[1],g=e[2],p=e[3],v=e[4],T=e[5],m=e[6],_=e[7],y=e[8],b=e[9],S=e[10],w=e[11],I=i*i*u+c,L=s*i*u+o*l,B=o*i*u-s*l,M=i*s*u-o*l,G=s*s*u+c,W=o*s*u+i*l,j=i*o*u+s*l,Y=s*o*u-i*l,lt=o*o*u+c,t[0]=h*I+v*L+y*B,t[1]=f*I+T*L+b*B,t[2]=g*I+m*L+S*B,t[3]=p*I+_*L+w*B,t[4]=h*M+v*G+y*W,t[5]=f*M+T*G+b*W,t[6]=g*M+m*G+S*W,t[7]=p*M+_*G+w*W,t[8]=h*j+v*Y+y*lt,t[9]=f*j+T*Y+b*lt,t[10]=g*j+m*Y+S*lt,t[11]=p*j+_*Y+w*lt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Lb(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+c*r,t[5]=o*i+u*r,t[6]=a*i+h*r,t[7]=l*i+f*r,t[8]=c*i-s*r,t[9]=u*i-o*r,t[10]=h*i-a*r,t[11]=f*i-l*r,t}function n3(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-c*r,t[1]=o*i-u*r,t[2]=a*i-h*r,t[3]=l*i-f*r,t[8]=s*r+c*i,t[9]=o*r+u*i,t[10]=a*r+h*i,t[11]=l*r+f*i,t}function Mb(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+c*r,t[1]=o*i+u*r,t[2]=a*i+h*r,t[3]=l*i+f*r,t[4]=c*i-s*r,t[5]=u*i-o*r,t[6]=h*i-a*r,t[7]=f*i-l*r,t}function r3(t,e){var n=e[0],r=e[1],i=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(l,c,u),t}function i3(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,l=i+i,c=n*o,u=r*o,h=r*a,f=i*o,g=i*a,p=i*l,v=s*o,T=s*a,m=s*l;return t[0]=1-h-p,t[1]=u+m,t[2]=f-T,t[3]=0,t[4]=u-m,t[5]=1-c-p,t[6]=g+v,t[7]=0,t[8]=f+T,t[9]=g-v,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function s3(t,e,n,r,i,s,o){var a=1/(n-e),l=1/(i-r),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function o3(t,e,n,r,i){var s=1/Math.tan(e/2),o;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var a3=o3;function l3(t,e,n,r,i,s,o){var a=1/(e-n),l=1/(r-i),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*l,t[14]=(o+s)*c,t[15]=1,t}var c3=l3;function u3(t,e,n,r){var i,s,o,a,l,c,u,h,f,g,p=e[0],v=e[1],T=e[2],m=r[0],_=r[1],y=r[2],b=n[0],S=n[1],w=n[2];return Math.abs(p-b)<Vo&&Math.abs(v-S)<Vo&&Math.abs(T-w)<Vo?ZO(t):(u=p-b,h=v-S,f=T-w,g=1/Math.hypot(u,h,f),u*=g,h*=g,f*=g,i=_*f-y*h,s=y*u-m*f,o=m*h-_*u,g=Math.hypot(i,s,o),g?(g=1/g,i*=g,s*=g,o*=g):(i=0,s=0,o=0),a=h*o-f*s,l=f*i-u*o,c=u*s-h*i,g=Math.hypot(a,l,c),g?(g=1/g,a*=g,l*=g,c*=g):(a=0,l=0,c=0),t[0]=i,t[1]=a,t[2]=u,t[3]=0,t[4]=s,t[5]=l,t[6]=h,t[7]=0,t[8]=o,t[9]=c,t[10]=f,t[11]=0,t[12]=-(i*p+s*v+o*T),t[13]=-(a*p+l*v+c*T),t[14]=-(u*p+h*v+f*T),t[15]=1,t)}function h3(){var t=new mn(4);return mn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function f3(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function Bb(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function d3(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function g3(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function p3(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=s*o,t}function m3(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function _3(t,e,n,r){var i=e[0],s=e[1],o=e[2],a=e[3];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=o+r*(n[2]-o),t[3]=a+r*(n[3]-a),t}function Ba(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}function y3(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],l=n[2],c=n[3],u=c*r+a*s-l*i,h=c*i+l*r-o*s,f=c*s+o*i-a*r,g=-o*r-a*i-l*s;return t[0]=u*c+g*-o+h*-l-f*-a,t[1]=h*c+g*-a+f*-o-u*-l,t[2]=f*c+g*-l+u*-a-h*-o,t[3]=e[3],t}(function(){var t=h3();return function(e,n,r,i,s,o){var a,l;for(n||(n=4),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var zd;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(zd||(zd={}));const v3=45*Math.PI/180,A3=1,Jh=.1,Xh=500,E3=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Z extends Ib{static get IDENTITY(){return b3()}static get ZERO(){return T3()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return zd}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,a,l,c,u,h,f,g,p,v,T){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=h,this[11]=f,this[12]=g,this[13]=p,this[14]=v,this[15]=T,this.check()}setRowMajor(e,n,r,i,s,o,a,l,c,u,h,f,g,p,v,T){return this[0]=e,this[1]=s,this[2]=c,this[3]=g,this[4]=n,this[5]=o,this[6]=u,this[7]=p,this[8]=r,this[9]=a,this[10]=h,this[11]=v,this[12]=i,this[13]=l,this[14]=f,this[15]=T,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(E3)}fromObject(e){return this.check()}fromQuaternion(e){return i3(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=Jh,far:a=Xh}=e;return a===1/0?C3(this,n,r,i,s,o):s3(this,n,r,i,s,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return u3(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=Jh,far:a=Xh}=e;return c3(this,n,r,i,s,o,a),this.check()}orthographic(e){const{fovy:n=v3,aspect:r=A3,focalDistance:i=1,near:s=Jh,far:o=Xh}=e;by(n);const a=n/2,l=i*Math.tan(a),c=l*r;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return by(n),a3(this,n,r,i,s),this.check()}determinant(){return e3(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return $O(this,this),this.check()}invert(){return Gd(this,this),this.check()}multiplyLeft(e){return gi(this,e,this),this.check()}multiplyRight(e){return gi(this,this,e),this.check()}rotateX(e){return Lb(this,this,e),this.check()}rotateY(e){return n3(this,this,e),this.check()}rotateZ(e){return Mb(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return t3(this,this,e,n),this.check()}scale(e){return Wp(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Yc(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Ba(n||[-0,-0,-0,-0],e,this),zo(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=Eb(n||[-0,-0],e,this);break;case 3:i=jp(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return zo(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=Tb(n||[-0,-0],e,this);break;case 3:r=bb(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return zo(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let Sl,wl;function T3(){return Sl||(Sl=new Z([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Sl)),Sl}function b3(){return wl||(wl=new Z,Object.freeze(wl)),wl}function by(t){if(t>Math.PI*2)throw Error("expected radians")}function C3(t,e,n,r,i,s){const o=2*s/(n-e),a=2*s/(i-r),l=(n+e)/(n-e),c=(i+r)/(i-r),u=-1,h=-1,f=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=h,t[12]=0,t[13]=0,t[14]=f,t[15]=0,t}function Cy(){var t=new mn(4);return mn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function S3(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Rb(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function Sy(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=n[0],l=n[1],c=n[2],u=n[3];return t[0]=r*u+o*a+i*c-s*l,t[1]=i*u+o*l+s*a-r*c,t[2]=s*u+o*c+r*l-i*a,t[3]=o*u-r*a-i*l-s*c,t}function w3(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=r*l+o*a,t[1]=i*l+s*a,t[2]=s*l-i*a,t[3]=o*l-r*a,t}function x3(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=r*l-s*a,t[1]=i*l+o*a,t[2]=s*l+r*a,t[3]=o*l-i*a,t}function P3(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=r*l+i*a,t[1]=i*l-r*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function I3(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function lc(t,e,n,r){var i=e[0],s=e[1],o=e[2],a=e[3],l=n[0],c=n[1],u=n[2],h=n[3],f,g,p,v,T;return g=i*l+s*c+o*u+a*h,g<0&&(g=-g,l=-l,c=-c,u=-u,h=-h),1-g>Vo?(f=Math.acos(g),p=Math.sin(f),v=Math.sin((1-r)*f)/p,T=Math.sin(r*f)/p):(v=1-r,T=r),t[0]=v*i+T*l,t[1]=v*s+T*c,t[2]=v*o+T*u,t[3]=v*a+T*h,t}function L3(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s,a=o?1/o:0;return t[0]=-n*a,t[1]=-r*a,t[2]=-i*a,t[3]=s*a,t}function M3(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Ob(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[s*3+s]-e[o*3+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[s*3+o]-e[o*3+s])*r,t[s]=(e[s*3+i]+e[i*3+s])*r,t[o]=(e[o*3+i]+e[i*3+o])*r}return t}var B3=f3,R3=Bb,O3=m3,F3=_3,D3=d3,N3=g3,Fb=p3,U3=function(){var t=Sb(),e=Ay(1,0,0),n=Ay(0,1,0);return function(r,i,s){var o=Vp(i,s);return o<-.999999?(ac(t,e,i),zO(t)<1e-6&&ac(t,n,i),FO(t,t),Rb(r,t,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(ac(t,i,s),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+o,Fb(r,r))}}();(function(){var t=Cy(),e=Cy();return function(n,r,i,s,o,a){return lc(t,r,o,a),lc(e,i,s,a),lc(n,t,e,2*a*(1-a)),n}})();(function(){var t=VO();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],Fb(e,Ob(e,t))}})();const k3=[0,0,0,1];class fa extends kp{constructor(e=0,n=0,r=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,r,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,r,i){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return Ob(this,e),this.check()}fromAxisRotation(e,n){return Rb(this,e,n),this.check()}identity(){return S3(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=re(e)}get y(){return this[1]}set y(e){this[1]=re(e)}get z(){return this[2]}set z(e){this[2]=re(e)}get w(){return this[3]}set w(e){this[3]=re(e)}len(){return D3(this)}lengthSquared(){return N3(this)}dot(e){return O3(this,e)}rotationTo(e,n){return U3(this,e,n),this.check()}add(e){return B3(this,this,e),this.check()}calculateW(){return I3(this,this),this.check()}conjugate(){return M3(this,this),this.check()}invert(){return L3(this,this),this.check()}lerp(e,n,r){return r===void 0?this.lerp(this,e,n):(F3(this,e,n,r),this.check())}multiplyRight(e){return Sy(this,this,e),this.check()}multiplyLeft(e){return Sy(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return w3(this,this,e),this.check()}rotateY(e){return x3(this,this,e),this.check()}rotateZ(e){return P3(this,this,e),this.check()}scale(e){return R3(this,this,e),this.check()}slerp(e,n,r){let i,s,o;switch(arguments.length){case 1:({start:i=k3,target:s,ratio:o}=e);break;case 2:i=this,s=e,o=n;break;default:i=e,s=n,o=r}return lc(this,i,s,o),this.check()}transformVector4(e,n=new Hp){return y3(n,e,this),zo(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const da={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},wy=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,G3={lightSources:{}};function Kh(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function z3(t){let{ambientLight:e,pointLights:n=[],directionalLights:r=[]}=t;const i={};return e?i["lighting_uAmbientLight.color"]=Kh(e):i["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((s,o)=>{i["lighting_uPointLight[".concat(o,"].color")]=Kh(s),i["lighting_uPointLight[".concat(o,"].position")]=s.position,i["lighting_uPointLight[".concat(o,"].attenuation")]=s.attenuation||[1,0,0]}),i.lighting_uPointLightCount=n.length,r.forEach((s,o)=>{i["lighting_uDirectionalLight[".concat(o,"].color")]=Kh(s),i["lighting_uDirectionalLight[".concat(o,"].direction")]=s.direction}),i.lighting_uDirectionalLightCount=r.length,i}function Db(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:G3;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:r}=t.lightSources||{};return e||n&&n.length>0||r&&r.length>0?Object.assign({},z3({ambientLight:e,pointLights:n,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return Db({lightSources:e})}return{}}const Jp={name:"lights",vs:wy,fs:wy,getUniforms:Db,defines:{MAX_LIGHTS:3}},V3=new Uint8Array([0,255,255,255]),j3={pickingSelectedColor:null,pickingHighlightColor:V3,pickingActive:!1,pickingAttribute:!1};function H3(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:j3;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const W3=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,J3=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,X3={name:"picking",vs:W3,fs:J3,getUniforms:H3},Nb=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,K3={};function Y3(t){const{ambient:e=.35,diffuse:n=.6,shininess:r=32,specularColor:i=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:r,lighting_uSpecularColor:i.map(s=>s/255)}}function Ub(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:K3;if(!("material"in t))return{};const{material:e}=t;return e?Y3(e):{lighting_uEnabled:!1}}const kb={name:"gouraud-lighting",dependencies:[Jp],vs:Nb,defines:{LIGHTING_VERTEX:1},getUniforms:Ub},Q3={name:"phong-lighting",dependencies:[Jp],fs:Nb,defines:{LIGHTING_FRAGMENT:1},getUniforms:Ub},q3=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,Z3=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,Xp={name:"pbr",vs:q3,fs:Z3,defines:{LIGHTING_FRAGMENT:1},dependencies:[Jp]},$3=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,eF={name:"transform",vs:$3,fs:null};class Ra{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Ra(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:r="",defines:i={},inject:s={},varyings:o=[],bufferMode:a=35981,transpileToGLSL100:l=!1}=e,c=this._getModuleList(e.modules),u=this._getHash(n),h=this._getHash(r),f=c.map(y=>this._getHash(y.name)).sort(),g=o.map(y=>this._getHash(y)),p=Object.keys(i).sort(),v=Object.keys(s).sort(),T=[],m=[];for(const y of p)T.push(this._getHash(y)),T.push(this._getHash(i[y]));for(const y of v)m.push(this._getHash(y)),m.push(this._getHash(s[y]));const _="".concat(u,"/").concat(h,"D").concat(T.join("/"),"M").concat(f.join("/"),"I").concat(m.join("/"),"V").concat(g.join("/"),"H").concat(this.stateHash,"B").concat(a).concat(l?"T":"");if(!this._programCache[_]){const y=rO(this.gl,{vs:n,fs:r,modules:c,inject:s,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:l});this._programCache[_]=new cb(this.gl,{hash:_,vs:y.vs,fs:y.fs,varyings:o,bufferMode:a}),this._getUniforms[_]=y.getUniforms||(b=>{}),this._useCounts[_]=0}return this._useCounts[_]++,this._programCache[_]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[i++]=a,r[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;r[l]||(n[i++]=a,r[l]=!0)}return n.length=i,n}}const tF={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function nF(t,e,n){const r={};let i=e.indices;for(const s in e.attributes){const o=e.attributes[s],a=rF(s,n);if(s==="indices")i=o;else if(o.constant)r[a]=o.value;else{const l=o.value,c={...o};delete c.value,r[a]=[new ie(t,l),c],iF(s,c)}}if(i){const s=i.value||i;N(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const o={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};r.indices=[new ie(t,{data:s,target:34963}),o]}return r}function rF(t,e){const{attributeMap:n=tF}=e||{};return n&&n[t]||t}function iF(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}N(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Ui=2,sF=1e4,oF="Model needs drawMode and vertexCount",xy=()=>{},aF={};class Mt{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=cr("model")}=n;N(Pu(e)),this.id=r,this.gl=e,this.id=n.id||cr("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||Ra.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:r,fs:i,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=e;this.programProps={program:n,vs:r,fs:i,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},N(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),oF)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:r,fs:i,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=e;this.programProps={program:n,vs:r,fs:i,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return N(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return N(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=nF(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Ps(e))return this;const n={};for(const r in e){const i=e[r];n[r]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return Bp(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:r,uniforms:i={},attributes:s={},transformFeedback:o=this.transformFeedback,parameters:a={},vertexArray:l=this.vertexArray}=e;this.setAttributes(s),this.updateModuleSettings(n),this.setUniforms(i);let c;V.priority>=Ui&&(c=this._logDrawCallStart(Ui));const u=this.vertexArray.getDrawParams(),{isIndexed:h=u.isIndexed,indexType:f=u.indexType,indexOffset:g=u.indexOffset,vertexArrayInstanced:p=u.isInstanced}=this.props;p&&!this.isInstanced&&V.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:v,instanceCount:T}=this,{onBeforeRender:m=xy,onAfterRender:_=xy}=this.props;m(),this.program.setUniforms(this.uniforms);const y=this.program.draw(Object.assign(aF,e,{logPriority:c,uniforms:null,framebuffer:r,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:l,transformFeedback:o,isIndexed:h,indexType:f,isInstanced:v,instanceCount:T,offset:h?g:0}));return _(),V.priority>=Ui&&this._logDrawCallEnd(c,l,r),y}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:r,unbindModels:i=[]}=e;let{parameters:s}=e;r&&this._setFeedbackBuffers(r),n&&(s=Object.assign({},s,{35977:n})),i.forEach(o=>o.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:s}))}finally{i.forEach(o=>o.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return V.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:r,fs:i,modules:s,inject:o,defines:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=this.programProps;n=this.programManager.get({vs:r,fs:i,modules:s,inject:o,defines:a,varyings:l,bufferMode:c,transpileToGLSL100:u}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}N(n instanceof cb,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new y2(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof ie&&n.delete()}}_setAnimationProps(e){this.animated&&N(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Ps(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new ub(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:sF;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),V.group(Ui,">>> DRAWING MODEL ".concat(this.id),{collapsed:V.level<=2})(),e}_logDrawCallEnd(e,n,r,i){if(e===void 0)return;const s=E2({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:o,unusedTable:a,unusedCount:l}=ly({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:c,count:u}=ly({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});u>0&&V.log("MISSING UNIFORMS",Object.keys(c))(),l>0&&V.log("UNUSED UNIFORMS",Object.keys(a))();const h=b2(this.vertexArray.configuration);V.table(e,s)(),V.table(e,o)(),V.table(e+1,h)(),i&&i.log({logLevel:Ui,message:"Rendered to ".concat(i.id)}),V.groupEnd(Ui)()}}class lF{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:i}=n;return{attributes:Object.assign({},r,e.attributes),transformFeedback:i}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],r=e?n[e]:null;return r?r instanceof ie?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,r=this.getBuffer(n);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&N(Q(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const i in this.feedbackMap){const s=this.feedbackMap[i];i in n&&(r[s]=i)}Object.assign(r,e.feedbackBuffers);for(const i in r){const s=r[i];if(typeof s=="string"){const o=n[s],{byteLength:a,usage:l,accessor:c}=o;r[i]=this._createNewBuffer(i,{byteLength:a,usage:l,accessor:c})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:r})}_setupTransformFeedback(e,n){let{model:r}=n;const{program:i}=r;e.transformFeedback=new ub(this.gl,{program:i,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:n,feedbackBuffers:r})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const i in this.feedbackMap){const s=this.feedbackMap[i];n[i]=e.feedbackBuffers[s],r[s]=e.sourceBuffers[i],N(r[s]instanceof ie)}return{sourceBuffers:n,feedbackBuffers:r}}_createNewBuffer(e,n){const r=new ie(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const cF="transform_uSampler_",Qc="transform_uSize_",Py="transform_position";function uF(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:r,targetTexture:i}=t,o=Object.keys(n).length,a=null;const l={};let c=e,u={};if(o>0||r){const h=c.split(`
`),f=h.slice();if(h.forEach((g,p,v)=>{if(o>0){const T=pF(g,n);if(T){const{updatedLine:m,inject:_}=T;f[p]=m,u=Dd([u,_]),Object.assign(l,T.samplerTextureMap),o--}}r&&!a&&(a=gF(g,r))}),r){N(i);const g="".concat(Qc).concat(r),p="uniform vec2 ".concat(g,`;
`),v="     vec2 ".concat(Py," = transform_getPos(").concat(g,`);
     gl_Position = vec4(`).concat(Py,`, 0, 1.);
`);u=Dd([u,{"vs:#decl":p,"vs:#main-start":v}])}c=f.join(`
`)}return{vs:c,targetTextureType:a,inject:u,samplerTextureMap:l}}function hF(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:r}=t;const i={};let s,o;n&&({width:s,height:o}=r,i["".concat(Qc).concat(n)]=[s,o]);for(const a in e)({width:s,height:o}=e[a]),i["".concat(Qc).concat(a)]=[s,o];return i}function fF(t){return _b(t,["attribute","in"])}function dF(t){const e="".concat(cF).concat(t),n="".concat(Qc).concat(t),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:r}}function gF(t,e){const n=_b(t,["varying","out"]);return n&&n.name===e?n.type:null}function pF(t,e){const n={},r=fF(t);if(!r)return null;const{type:i,name:s}=r;if(s&&e[s]){const o="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:a,sizeName:l,uniformDeclerations:c}=dF(s),u=fO(i),h="  ".concat(i," ").concat(s," = transform_getInput(").concat(a,", ").concat(l,").").concat(u,`;
`);return n[a]=s,{updatedLine:o,inject:{"vs:#decl":c,"vs:#main-start":h},samplerTextureMap:n}}return null}const mF={10241:9728,10240:9728,10242:33071,10243:33071},_F="transform_output";class yF{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:r,framebuffer:i,targetTexture:s}=this.bindings[this.currentIndex],o=Object.assign({},n,e.attributes),a=Object.assign({},e.uniforms),l=Object.assign({},e.parameters);let c=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const h in this.samplerTextureMap){const f=this.samplerTextureMap[h];a[h]=r[f]}this._setSourceTextureParameters();const u=hF({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(a,u)}return this.hasTargetTexture&&(c=!1,l.viewport=[0,0,i.width,i.height]),{attributes:o,framebuffer:i,uniforms:a,discard:c,parameters:l}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],r=Lu(n);if(!e)return r;const i=r.constructor,s=dO(this.targetTextureType),o=new i(r.length*s/4);let a=0;for(let l=0;l<r.length;l+=4)for(let c=0;c<s;c++)o[a++]=r[l+c];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:r}=e;if(r instanceof st)return r;const i=n[r];return i?(this._targetRefTexName=r,this._createNewTexture(i)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:r={},_targetTexture:i}=e,s=this._createTargetTexture({sourceTextures:r,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:r,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((r,i,s)=>{s[i]=i}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new ie(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:n,targetTexture:r})}}_updateBinding(e,n){const{sourceBuffers:r,sourceTextures:i,targetTexture:s}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,r),s){e.targetTexture=s;const{width:o,height:a}=s,{framebuffer:l}=e;l?(l.update({attachments:{36064:s},resizeAttachments:!1}),l.resize({width:o,height:a})):e.framebuffer=new Fe(this.gl,{id:"transform-framebuffer",width:o,height:a,attachments:{36064:s}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const r in n)n[r].setParameters(mF)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:r}}_createNewTexture(e){const n=aR(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:r}=this.bindings[this.currentIndex],{vs:i,uniforms:s,targetTextureType:o,inject:a,samplerTextureMap:l}=uF({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),c=Dd([e.inject||{},a]);this.targetTextureType=o,this.samplerTextureMap=l;const u=e._fs||yb({version:ab(i),input:this.targetTextureVarying,inputType:o,output:_F}),h=this.hasSourceTextures||this.targetTextureVarying?[eF].concat(e.modules||[]):e.modules;return{vs:i,fs:u,modules:h,uniforms:s,inject:c}}}class Kp{static isSupported(e){return Q(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:r}=this;e&&e.delete(),n&&n.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,r=this._updateDrawOptions(e);n&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)e=e||r.swap();N(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n){const i=r.getData(e);if(i)return i}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Mt(n,Object.assign({},e,{fs:e.fs||yb({version:ab(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)n=i.updateModelProps(n);return n}_buildResourceTransforms(e,n){vF(n)&&(this.bufferTransform=new lF(e,n)),AF(n)&&(this.textureTransform=new yF(e,n)),N(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)n=Object.assign(n,i.getDrawOptions(n));return n}}function vF(t){return!!(!Ps(t.feedbackBuffers)||!Ps(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function AF(t){return!!(!Ps(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const Iy={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class gn{static get DRAW_MODE(){return Iy}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=cr("geometry"),drawMode:r=Iy.TRIANGLES,attributes:i={},indices:s=null,vertexCount:o=null}=e;this.id=n,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(i,s),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const r in e){let i=e[r];i=ArrayBuffer.isView(i)?{value:i}:i,N(ArrayBuffer.isView(i.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!i.size&&(i.size=3),r==="indices"?(N(!this.indices),this.indices=i):this.attributes[r]=i}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i in e){const s=e[i],{value:o,size:a,constant:l}=s;!l&&o&&a>=1&&(r=Math.min(r,o.length/a))}return N(Number.isFinite(r)),r}}let EF=1,TF=1;class Gb{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=EF++,a={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=TF++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const bF=[255,255,255],CF=1;let SF=0;class zb{constructor(e={}){d(this,"id",void 0),d(this,"color",void 0),d(this,"intensity",void 0),d(this,"type","ambient");const{color:n=bF}=e,{intensity:r=CF}=e;this.id=e.id||"ambient-".concat(SF++),this.color=n,this.intensity=r}}const wF=[255,255,255],xF=1,PF=[0,0,-1];let IF=0;class Vd{constructor(e={}){d(this,"id",void 0),d(this,"color",void 0),d(this,"intensity",void 0),d(this,"type","directional"),d(this,"direction",void 0),d(this,"shadow",void 0);const{color:n=wF}=e,{intensity:r=xF}=e,{direction:i=PF}=e,{_shadow:s=!1}=e;this.id=e.id||"directional-".concat(IF++),this.color=n,this.intensity=r,this.type="directional",this.direction=new x(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class LF{constructor(e,n={id:"pass"}){d(this,"id",void 0),d(this,"gl",void 0),d(this,"props",void 0);const{id:r}=n;this.id=r,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Yp extends LF{constructor(...e){super(...e),d(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return lr(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:r,viewports:i,views:s,onViewportActive:o,clearStack:a=!0,clearCanvas:l=!0}=e;e.pass=e.pass||"unknown";const c=this.gl;l&&BF(c,n),a&&(this._lastRenderIndex=-1);const u=[];for(const h of i){const f=s&&s[h.id];o==null||o(h);const g=this._getDrawLayerParams(h,e),p=h.subViewports||[h];for(const v of p){const T=this._drawLayersInViewport(c,{target:n,moduleParameters:r,viewport:v,view:f,pass:e.pass,layers:e.layers},g);u.push(T)}}return u}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,moduleParameters:l},c=!1){const u=[],h=Vb(this._lastRenderIndex+1),f={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},g={};for(let p=0;p<n.length;p++){const v=n[p],T=this._shouldDrawLayer(v,f,s,g),m={shouldDrawLayer:T};T&&!c&&(m.layerRenderIndex=h(v,T),m.moduleParameters=this._getModuleParameters(v,a,r,l),m.layerParameters=this.getLayerParameters(v,p,e)),u[p]=m}return u}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:i,target:s,viewport:o,view:a},l){const c=MF(e,{moduleParameters:r,target:s,viewport:o});if(a&&a.props.clear){const h=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;fn(e,{scissorTest:!0,scissor:c},()=>Bp(e,h))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};lr(e,{viewport:c});for(let h=0;h<n.length;h++){const f=n[h],{shouldDrawLayer:g,layerRenderIndex:p,moduleParameters:v,layerParameters:T}=l[h];if(g&&f.props.pickable&&u.pickableCount++,f.isComposite)u.compositeCount++;else if(g){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,p),v.viewport=o;try{f._drawLayer({moduleParameters:v,uniforms:{layerIndex:p},parameters:T})}catch(m){f.raiseError(m,"drawing ".concat(f," to ").concat(i))}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in i||(i[a]=r(n)),!i[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,i){var s;const o=Object.assign(Object.create(((s=e.internalState)===null||s===void 0?void 0:s.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:xs(this.gl)});if(n)for(const l of n){var a;Object.assign(o,(a=l.getModuleParameters)===null||a===void 0?void 0:a.call(l,e))}return Object.assign(o,this.getModuleParameters(e,n),i)}}function Vb(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,a=i.id,l=i.parent&&i.parent.id;let c;if(l&&!(l in e)&&r(i.parent,!1),l in n){const u=n[l]=n[l]||Vb(e[l],e);c=u(i,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return r}function MF(t,{moduleParameters:e,target:n,viewport:r}){const i=n&&n.id!=="default-framebuffer",s=e&&e.devicePixelRatio||xs(t),o=i?n.height:t.drawingBufferHeight,a=r;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function BF(t,e){const n=e?e.width:t.drawingBufferWidth,r=e?e.height:t.drawingBufferHeight;lr(t,{viewport:[0,0,n,r]}),t.clear(16640)}class RF extends Yp{constructor(e,n){super(e,n),d(this,"shadowMap",void 0),d(this,"depthBuffer",void 0),d(this,"fbo",void 0),this.shadowMap=new st(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new is(e,{format:33189,width:1,height:1}),this.fbo=new Fe(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const n=this.fbo;fn(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],i=xs(this.gl),s=r.width*i,o=r.height*i;(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const jb="#define SMOOTH_EDGE_RADIUS 0.5",OF=`
`.concat(jb,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),FF=`
`.concat(jb,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),DF={name:"geometry",vs:OF,fs:FF},NF=Object.keys(K).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(K[t],";")).join(""),UF=Object.keys(Mn).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(Mn[t],";")).join(""),kF=Object.keys(ar).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(ar[t],";")).join(""),GF="".concat(NF,`
`).concat(UF,`
`).concat(kF,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function zF(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Oa(t){let e={},n;return r=>{for(const i in r)if(!zF(r[i],e[i])){n=t(r),e=r;break}return n}}const Ly=[0,0,0,0],VF=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Hb=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],jF=[0,0,0],Wb=[0,0,0],HF=Oa(XF);function Jb(t,e,n=Wb){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===K.LNGLAT_OFFSETS||e===K.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Mn.WEB_MERCATOR:(e===K.LNGLAT||e===K.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Mn.WEB_MERCATOR_AUTO_OFFSET:e===K.LNGLAT?r=i:e===K.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Mn.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Mn.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function WF(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=Ly,l=Ly,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:f}=Jb(t,e,n);return f&&(l=t.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=Ba([],l,o),s=r||s,o=gi([],i,s),o=gi([],o,VF)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}function JF({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=K.DEFAULT,coordinateOrigin:i=Wb,autoWrapLongitude:s=!1}){r===K.DEFAULT&&(r=t.isGeospatial?K.LNGLAT:K.CARTESIAN);const o=HF({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||Hb,o}function XF({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=WF(t,n,r),u=t.getDistanceScales(),h=[t.width*e,t.height*e],f=Ba([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,g={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:h,project_uDevicePixelRatio:e,project_uFocalDistance:f,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:jF,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:Hb,project_uCameraPosition:a};if(c){const p=t.getDistanceScales(c);switch(n){case K.METER_OFFSETS:g.project_uCommonUnitsPerWorldUnit=p.unitsPerMeter,g.project_uCommonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case K.LNGLAT:case K.LNGLAT_OFFSETS:t._pseudoMeters||(g.project_uCommonUnitsPerMeter=p.unitsPerMeter),g.project_uCommonUnitsPerWorldUnit=p.unitsPerDegree,g.project_uCommonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case K.CARTESIAN:g.project_uCommonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],g.project_uCommonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break}}return g}const KF={};function YF(t=KF){return"viewport"in t?JF(t):{}}const Qp={name:"project",dependencies:[mO,DF],vs:GF,getUniforms:YF};function QF(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ps(t,e){const n=Ba([],e,t);return Bb(n,n,1/n[3]),n}function My(t,e){const n=t%e;return n<0?e+n:n}function jd(t,e,n){return t<e?e:t>n?n:t}function qF(t){return Math.log(t)*Math.LOG2E}const qp=Math.log2||qF;function ur(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const an=Math.PI,Xb=an/4,Kt=an/180,Hd=180/an,Ls=512,qc=4003e4,xl=85.051129,ZF=1.5;function $F(t){return qp(t)}function Zc(t){const[e,n]=t;ur(Number.isFinite(e)),ur(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*Kt,i=n*Kt,s=Ls*(r+an)/(2*an),o=Ls*(an+Math.log(Math.tan(Xb+i*.5)))/(2*an);return[s,o]}function Ms(t){const[e,n]=t,r=e/Ls*(2*an)-an,i=2*(Math.atan(Math.exp(n/Ls*(2*an)-an))-Xb);return[r*Hd,i*Hd]}function eD(t){const{latitude:e}=t;ur(Number.isFinite(e));const n=Math.cos(e*Kt);return $F(qc*n)-9}function Yh(t){const e=Math.cos(t*Kt);return Ls/qc/e}function Wd(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;ur(Number.isFinite(e)&&Number.isFinite(n));const i=Ls,s=Math.cos(e*Kt),o=i/360,a=o/s,l=i/qc/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(r){const u=Kt*Math.tan(e*Kt)/s,h=o*u/2,f=i/qc*u,g=f/a*l;c.unitsPerDegree2=[0,h,f],c.unitsPerMeter2=[g,0,g]}return c}function Kb(t,e){const[n,r,i]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Wd({longitude:n,latitude:r,highPrecision:!0}),u=Zc(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const h=Ms(u),f=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[h[0],h[1],f]:h}function tD(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,a=QF();Yc(a,a,[0,0,-i]),Lb(a,a,-n*Kt),Mb(a,a,r*Kt);const l=s/e;return Wp(a,a,[l,l,l]),o&&Yc(a,a,OO([],o)),a}function nD(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=$c(ZF)}=t;r!==void 0&&(u=$c(r));const h=u*Kt,f=i*Kt,g=Yb(u);let p=g;o&&(p+=o[2]*a/Math.cos(f)/n);const v=h*(.5+(s?s[1]:0)/n),T=Math.sin(v)*p/Math.sin(jd(Math.PI/2-f-v,.01,Math.PI-.01)),m=Math.sin(f)*T+p,_=p*10,y=Math.min(m*c,_);return{fov:h,aspect:e/n,focalDistance:g,near:l,far:y}}function $c(t){return 2*Math.atan(.5/t)*Hd}function Yb(t){return .5/Math.tan(.5*t*Kt)}function Qb(t,e){const[n,r,i=0]=t;return ur(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),ps(e,[n,r,i,1])}function Zp(t,e,n=0){const[r,i,s]=t;if(ur(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return ps(e,[r,i,s,1]);const o=ps(e,[r,i,0,1]),a=ps(e,[r,i,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return vb([],o,a,u)}function rD(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=r,h=iD(t.padding),f=Zc([a,jd(u,-xl,xl)]),g=Zc([c,jd(l,-xl,xl)]),p=[Math.max(Math.abs(g[0]-f[0]),i),Math.max(Math.abs(g[1]-f[1]),i)],v=[e-h.left-h.right-Math.abs(o[0])*2,n-h.top-h.bottom-Math.abs(o[1])*2];ur(v[0]>0&&v[1]>0);const T=v[0]/p[0],m=v[1]/p[1],_=(h.right-h.left)/2/T,y=(h.top-h.bottom)/2/m,b=[(g[0]+f[0])/2+_,(g[1]+f[1])/2+y],S=Ms(b),w=Math.min(s,qp(Math.abs(Math.min(T,m))));return ur(Number.isFinite(w)),{longitude:S[0],latitude:S[1],zoom:w}}function iD(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(ur(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const By=Math.PI/180;function sD(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),a=i([n,r],s);let l,c;const u=t.fovy?.5*t.fovy*By:Math.atan(.5/t.altitude),h=(90-t.pitch)*By;return u>h-.01?(l=Ry(t,0,e),c=Ry(t,n,e)):(l=i([0,0],s),c=i([n,0],s)),[o,a,c,l]}function Ry(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=ps(r,[e,0,1,1]),s=ps(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),l=vb([],i,s,a),c=Ms(l);return c.push(n),c}const Oy=512;function oD(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=t;(i<-180||i>180)&&(i=My(i+180,360)-180),(a<-180||a>180)&&(a=My(a+180,360)-180);const l=qp(n/Oy);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=Ms([0,c])[1];if(s<u)s=u;else{const h=Ms([0,Oy-c])[1];s>h&&(s=h)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const aD=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,lD=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,cD=Oa(gD),uD=Oa(pD),hD=[0,0,0,1],fD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function dD(t,e){const[n,r,i]=t,s=Zp([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function gD({viewport:t,center:e}){return new Z(t.viewProjectionMatrix).invert().transform(e)}function pD({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>dD(o,r));for(const o of e){const a=o.clone().translate(new x(t.center).negate()),l=s.map(u=>a.transform(u)),c=new Z().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function mD(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||hD,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=cD({viewport:t.viewport,center:e.project_uCenter}),s=[],o=uD({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],c=l.clone().translate(new x(t.viewport.center).negate());e.project_uCoordinateSystem===K.LNGLAT&&e.project_uProjectionMode===Mn.WEB_MERCATOR?(o[a]=c,s[a]=i):(o[a]=l.clone().multiplyRight(fD),s[a]=c.transform(i))}for(let a=0;a<o.length;a++)r["shadow_uViewProjectionMatrices[".concat(a,"]")]=o[a],r["shadow_uProjectCenters[".concat(a,"]")]=s[a],t.shadowMaps&&t.shadowMaps.length>0?r["shadow_uShadowMap".concat(a)]=t.shadowMaps[a]:r["shadow_uShadowMap".concat(a)]=t.dummyShadowMap;return r}const Qh={name:"shadow",dependencies:[Qp],vs:aD,fs:lD,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?mD(t,e):{}},_D={color:[255,255,255],intensity:1},Fy=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],yD=[0,0,0,200/255];class $p{constructor(e={}){d(this,"id","lighting-effect"),d(this,"props",void 0),d(this,"shadowColor",yD),d(this,"shadow",void 0),d(this,"ambientLight",void 0),d(this,"directionalLights",void 0),d(this,"pointLights",void 0),d(this,"shadowPasses",[]),d(this,"shadowMaps",[]),d(this,"dummyShadowMap",null),d(this,"programManager",void 0),d(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:r,viewports:i,onViewportActive:s,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Ra.getDefaultProgramManager(e),Qh&&this.programManager.addDefaultModule(Qh)),this.dummyShadowMap||(this.dummyShadowMap=new st(e,{width:1,height:1}));for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:n,layerFilter:r,viewports:i,onViewportActive:s,views:o,moduleParameters:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Qh),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new Z().lookAt({eye:new x(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new RF(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new zb(_D),this.directionalLights.push(new Vd(Fy[0]),new Vd(Fy[1])))}}class vD{constructor(e={}){d(this,"_pool",[]),d(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=i||e&&e.constructor||Float32Array,u=n*r+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let h=1/0;l&&(h=l*r+s);const f=this._allocate(c,u,a,h);return e&&o?f.set(e):a||f.fill(0,0,4),this._release(e),f}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return r&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const Bs=new vD;function wo(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function AD(t){return[t[12],t[13],t[14]]}function ED(t){return{left:ki(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:ki(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:ki(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:ki(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:ki(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:ki(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const Dy=new x;function ki(t,e,n,r){Dy.set(t,e,n);const i=Dy.len();return{distance:r/i,normal:new x(-t/i,-e/i,-n/i)}}function TD(t){return t-Math.fround(t)}let uo;function qh(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;uo=Bs.allocate(uo,s,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<i;){for(let l=0;l<n;l++){const c=t[o++];uo[a+l]=c,uo[a+l+n]=TD(c)}a+=n*2}return uo.subarray(0,s*n*2)}function bD(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const CD=Math.PI/180,SD=wo(),Ny=[0,0,0],wD={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function xD({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const l=t/e,c=n?new Z().orthographic({fovy:r,aspect:l,focalDistance:i,near:o,far:a}):new Z().perspective({fovy:r,aspect:l,near:o,far:a});if(s){const{left:u=0,right:h=0,top:f=0,bottom:g=0}=s,p=qn((u+t-h)/2,0,t)-t/2,v=qn((f+e-g)/2,0,e)-e/2;c[8]-=p*2/t,c[9]+=v*2/e}return c}class zs{constructor(e={}){d(this,"id",void 0),d(this,"x",void 0),d(this,"y",void 0),d(this,"width",void 0),d(this,"height",void 0),d(this,"padding",void 0),d(this,"isGeospatial",void 0),d(this,"zoom",void 0),d(this,"focalDistance",void 0),d(this,"position",void 0),d(this,"modelMatrix",void 0),d(this,"distanceScales",void 0),d(this,"scale",void 0),d(this,"center",void 0),d(this,"cameraPosition",void 0),d(this,"projectionMatrix",void 0),d(this,"viewMatrix",void 0),d(this,"viewMatrixUncentered",void 0),d(this,"viewMatrixInverse",void 0),d(this,"viewProjectionMatrix",void 0),d(this,"pixelProjectionMatrix",void 0),d(this,"pixelUnprojectionMatrix",void 0),d(this,"resolution",void 0),d(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||wD,this.focalDistance=e.focalDistance||1,this.position=e.position||Ny,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Mn.WEB_MERCATOR:Mn.WEB_MERCATOR_AUTO_OFFSET:Mn.IDENTITY}equals(e){return e instanceof zs?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&dn(e.projectionMatrix,this.projectionMatrix)&&dn(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=Qb(r,this.pixelProjectionMatrix),[s,o]=i,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,l=r&&r*this.distanceScales.unitsPerMeter[2],c=Zp([i,a,o],this.pixelUnprojectionMatrix,l),[u,h,f]=this.unprojectPosition(c);return Number.isFinite(o)?[u,h,f]:Number.isFinite(r)?[u,h,r]:[u,h]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=Zc(e);return n[1]=qn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Ms(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e?Wd({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,ED(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=eD({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Wd({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=Ny;if(s&&(a=o?new Z(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,r,0]);this.center=new x(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=SD,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Z().multiplyRight(n).translate(new x(this.center).negate()),this.projectionMatrix=r||xD({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*CD,focalDistance:u,padding:c,near:a,far:l});const h=wo();gi(h,h,this.projectionMatrix),gi(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=Gd([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=AD(this.viewMatrixInverse);const f=wo(),g=wo();Wp(f,f,[this.width/2,-this.height/2,1]),Yc(f,f,[1,-1,0]),gi(g,f,this.viewProjectionMatrix),this.pixelProjectionMatrix=g,this.pixelUnprojectionMatrix=Gd(wo(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||X.warn("Pixel project matrix not invertible")()}}d(zs,"displayName","Viewport");class Rs extends zs{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:h=!1,projectionMatrix:f,repeat:g=!1,worldOffset:p=0,position:v,padding:T,legacyMeterSizes:m=!1}=e;let{width:_,height:y,altitude:b=1.5}=e;const S=Math.pow(2,i);_=_||1,y=y||1;let w,I=null;if(f)b=f[5]/2,w=$c(b);else{e.fovy?(w=e.fovy,b=Yb(w)):w=$c(b);let B;if(T){const{top:M=0,bottom:G=0}=T;B=[0,qn((M+y-G)/2,0,y)-y/2]}I=nD({width:_,height:y,scale:S,center:v&&[0,0,v[2]*Yh(n)],offset:B,pitch:s,fovy:w,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(c)&&(I.near=c),Number.isFinite(u)&&(I.far=u)}let L=tD({height:y,pitch:s,bearing:o,scale:S,altitude:b});p&&(L=new Z().translate([512*p,0,0]).multiplyLeft(L)),super({...e,width:_,height:y,viewMatrix:L,longitude:r,latitude:n,zoom:i,...I,fovy:w,focalDistance:b}),d(this,"longitude",void 0),d(this,"latitude",void 0),d(this,"pitch",void 0),d(this,"bearing",void 0),d(this,"altitude",void 0),d(this,"fovy",void 0),d(this,"orthographic",void 0),d(this,"_subViewports",void 0),d(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=b,this.fovy=w,this.orthographic=h,this._subViewports=g?[]:null,this._pseudoMeters=m,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new Rs({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*Yh(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/Yh(r);return[n,r,i]}addMetersToLngLat(e,n){return Kb(e,n)}panByPosition(e,n){const r=Zp(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=vy([],i,PO([],r)),o=vy([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=sD(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=rD({width:r,height:i,bounds:e,...n});return new Rs({width:r,height:i,longitude:s,latitude:o,zoom:a})}}d(Rs,"displayName","WebMercatorViewport");const Uy=[0,0,0];function Zh(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof Rs){const[i,s,o=0]=t,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function PD(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===K.DEFAULT&&(i=e.isGeospatial?K.LNGLAT:K.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function qb(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=Ba([],[o,a,l,1],n)),r){case K.LNGLAT:return Zh([o,a,l],e,s);case K.LNGLAT_OFFSETS:return Zh([o+i[0],a+i[1],l+(i[2]||0)],e,s);case K.METER_OFFSETS:return Zh(Kb(i,[o,a,l]),e,s);case K.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],l+i[2]]:e.projectPosition([o,a,l])}}function Zb(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=PD(e),{autoOffset:l=!0}=e,{geospatialOrigin:c=Uy,shaderCoordinateOrigin:u=Uy,offsetMode:h=!1}=l?Jb(n,r,i):{},f=qb(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});if(h){const g=n.projectPosition(c||u);GO(f,f,g)}return f}const ID=[255,255,255],LD=1,MD=[0,0,1],BD=[0,0,1];let RD=0;class ky{constructor(e={}){d(this,"id",void 0),d(this,"color",void 0),d(this,"intensity",void 0),d(this,"type","point"),d(this,"position",void 0),d(this,"attenuation",void 0),d(this,"projectedLight",void 0);const{color:n=ID}=e,{intensity:r=LD}=e,{position:i=BD}=e;this.id=e.id||"point-".concat(RD++),this.color=n,this.intensity=r,this.type="point",this.position=i,this.attenuation=OD(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:n}=this,r=e.context.viewport,{coordinateSystem:i,coordinateOrigin:s}=e.props,o=Zb(this.position,{viewport:r,coordinateSystem:i,coordinateOrigin:s,fromCoordinateSystem:r.isGeospatial?K.LNGLAT:K.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return n.color=this.color,n.intensity=this.intensity,n.position=o,n}}function OD(t){return t.attenuation?t.attenuation:"intensity"in t?[0,0,t.intensity||0]:MD}const Gy={blendFunc:[1,0,32771,0],blendEquation:32774};class $b extends Yp{constructor(...e){super(...e),d(this,"pickZ",void 0),d(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:h,effects:f,pass:g="picking",pickZ:p,moduleParameters:v}){const T=this.gl;this.pickZ=p;const m=this._resetColorEncoder(p),_=fn(T,{scissorTest:!0,scissor:[a,l,c,u],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...Gy,blend:!p},()=>super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:h,effects:f==null?void 0:f.filter(b=>b.useInPicking),pass:g,isPicking:!0,moduleParameters:v}));return this._colorEncoderState=null,{decodePickingColor:m&&DD.bind(null,m),stats:_}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,r){const i={...e.props.parameters},{pickable:s,operation:o}=e.props;return this._colorEncoderState?s&&o.includes("draw")&&(Object.assign(i,Gy),i.blend=!0,i.blendColor=FD(this._colorEncoderState,e,r)):i.blend=!1,o.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function FD(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(X.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function DD(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Hi={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},eu=Symbol.for("component"),jr=Symbol.for("propTypes"),$h=Symbol.for("deprecatedProps"),ms=Symbol.for("asyncPropDefaults"),Ei=Symbol.for("asyncPropOriginal"),Br=Symbol.for("asyncPropResolved");function em(t,e=()=>!0){return Array.isArray(t)?eC(t,e,[]):e(t)?[t]:[]}function eC(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?eC(i,e,n):e(i)&&n.push(i)}return n}function ND({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=n;o<i;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class UD{constructor(e,n,r){d(this,"id",void 0),d(this,"context",void 0),d(this,"isLoaded",void 0),d(this,"persistent",void 0),d(this,"_loadCount",0),d(this,"_subscribers",new Set),d(this,"_data",void 0),d(this,"_loader",void 0),d(this,"_error",void 0),d(this,"_content",void 0),this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=or(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class kD{constructor({gl:e,protocol:n}){d(this,"protocol",void 0),d(this,"_context",void 0),d(this,"_resources",void 0),d(this,"_consumers",void 0),d(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new UD(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{},a=o[n]||{},l=a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),r&&(o[n]=a,a.onChange=i,a.resourceId=r.id,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const GD=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,gr={name:"project32",dependencies:[Qp],vs:GD},pr={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...X3},zD=[Qp],VD=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function jD(t){const e=Ra.getDefaultProgramManager(t);for(const n of zD)e.addDefaultModule(n);for(const n of VD)e.addShaderHook(n);return e}const HD="layerManager.setLayers",WD="layerManager.activateViewport";class JD{constructor(e,{deck:n,stats:r,viewport:i,timeline:s}={}){d(this,"layers",void 0),d(this,"context",void 0),d(this,"resourceManager",void 0),d(this,"_lastRenderedLayers",[]),d(this,"_needsRedraw",!1),d(this,"_needsUpdate",!1),d(this,"_nextLayers",null),d(this,"_debug",!1),d(this,"activateViewport",o=>{Ye(WD,this,o),o&&(this.context.viewport=o)}),this.layers=[],this.resourceManager=new kD({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&jD(e),stats:r||new Lp({id:"deck.gl"}),viewport:i||new zs({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new Gb,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Ye(HD,this,n,e),this._lastRenderedLayers=e;const r=em(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,r){r.raiseError(n,"".concat(e," of ").concat(r))}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?X.warn("Multiple old layers with same id ".concat(o.id))():r[o.id]=o;const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s="Uniform transition in ".concat(o);break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&X.warn("Multiple new layers with same id ".concat(i.id))(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Hi.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Hi.MATCHED,n!==e&&(e.lifecycle=Hi.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Hi.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Hi.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Bn(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Bn(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Bn(t[s],e[s],n-1))return!1;return!0}return!1}class XD{constructor(e){d(this,"width",void 0),d(this,"height",void 0),d(this,"views",void 0),d(this,"viewState",void 0),d(this,"controllers",void 0),d(this,"timeline",void 0),d(this,"_viewports",void 0),d(this,"_viewportMap",void 0),d(this,"_isUpdating",void 0),d(this,"_needsRedraw",void 0),d(this,"_needsUpdate",void 0),d(this,"_eventManager",void 0),d(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=em(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Bn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):X.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))===null||o===void 0?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=!!s.controller;c&&!l&&(r=!0),(r||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),a&&this._viewports.unshift(a)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const KD=/([0-9]+\.?[0-9]*)(%|px)/;function Er(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=KD.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function Tr(t,e){return t.relative?Math.round(t.position*e):t.position}function ke(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Os{constructor(e){d(this,"id",void 0),d(this,"viewportInstance",void 0),d(this,"_x",void 0),d(this,"_y",void 0),d(this,"_width",void 0),d(this,"_height",void 0),d(this,"_padding",void 0),d(this,"props",void 0);const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null,viewportInstance:l}=e||{};ke(!l||l instanceof zs),this.viewportInstance=l,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Er(r),this._y=Er(i),this._width=Er(s),this._height=Er(o),this._padding=a&&{left:Er(a.left||0),right:Er(a.right||0),top:Er(a.top||0),bottom:Er(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Bn(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:Tr(this._x,e),y:Tr(this._y,n),width:Tr(this._width,e),height:Tr(this._height,n)};return this._padding&&(r.padding={left:Tr(this._padding.left,e),top:Tr(this._padding.top,n),right:Tr(this._padding.right,e),bottom:Tr(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Fa{constructor(e){d(this,"_inProgress",void 0),d(this,"_handle",void 0),d(this,"_timeline",void 0),d(this,"time",void 0),d(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(n=(r=this.settings).onStart)===null||n===void 0||n.call(r,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const zy=()=>{},Jd={BREAK:1,SNAP_TO_END:2,IGNORE:3},YD=t=>t,QD=Jd.BREAK;class qD{constructor(e){d(this,"getControllerState",void 0),d(this,"props",void 0),d(this,"propsInTransition",void 0),d(this,"transition",void 0),d(this,"onViewStateChange",void 0),d(this,"onStateChange",void 0),d(this,"_onTransitionUpdate",n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(r/a),u=i.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Fa(e.timeline),this.onViewStateChange=e.onViewStateChange||zy,this.onStateChange=e.onStateChange||zy}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===Jd.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Jd.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||YD,interpolator:s,interruption:n.transitionInterruption||QD,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class ZD{constructor(e){d(this,"_propsToCompare",void 0),d(this,"_propsToExtract",void 0),d(this,"_requiredProps",void 0);const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!dn(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];ke(Number.isFinite(r)||Array.isArray(r),"".concat(n," is required for transition"))})}}const $D=["longitude","latitude","zoom","bearing","pitch"],eN=["longitude","latitude","zoom"];class tC extends ZD{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:$D,required:eN},super(r.transitionProps),d(this,"opts",void 0),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(n),l=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=Kc(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,Kc(e.around,n.around,r)))}return i}}const br={transitionDuration:0},tN=300,Pl=t=>1-(1-t)*(1-t),Gi={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},ei={};class nN{constructor(e){d(this,"props",void 0),d(this,"state",{}),d(this,"transitionManager",void 0),d(this,"eventManager",void 0),d(this,"onViewStateChange",void 0),d(this,"onStateChange",void 0),d(this,"makeViewport",void 0),d(this,"_controllerState",void 0),d(this,"_events",{}),d(this,"_interactionState",{isDragging:!1}),d(this,"_customEvents",[]),d(this,"_eventStartBlocked",null),d(this,"_panMove",!1),d(this,"invertPan",!1),d(this,"dragMode","rotate"),d(this,"inertia",0),d(this,"scrollZoom",!0),d(this,"dragPan",!0),d(this,"dragRotate",!0),d(this,"doubleClickZoom",!0),d(this,"touchZoom",!0),d(this,"touchRotate",!1),d(this,"keyboard",!0),this.transitionManager=new qD({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?tN:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(Gi.WHEEL,u&&r),this.toggleEvents(Gi.PAN,u),this.toggleEvents(Gi.PINCH,u&&(a||l)),this.toggleEvents(Gi.TRIPLE_PAN,u&&l),this.toggleEvents(Gi.DOUBLE_TAP,u&&o),this.toggleEvents(Gi.KEYBOARD,u&&c),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,br,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,br,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Pl},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,br,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Pl},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,br,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,br,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Pl},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return ei._startPinchRotation=e.rotation,ei._lastPinchEvent=e,this.updateViewport(r,br,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:ei._startPinchRotation-r})}return this.updateViewport(n,br,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ei._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=ei;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:Pl},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ei._startPinchRotation=null,ei._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(i),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(i),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(i),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(i),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?br:e?{...n,transitionInterpolator:new tC({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class rN{constructor(e,n){d(this,"_viewportProps",void 0),d(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Vy=5,iN=1.2;class sN extends rN{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:h=20,minZoom:f=0,maxPitch:g=60,minPitch:p=0,startPanLngLat:v,startZoomLngLat:T,startRotatePos:m,startBearing:_,startPitch:y,startZoom:b,normalize:S=!0}=e;ke(Number.isFinite(s)),ke(Number.isFinite(i)),ke(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:h,minZoom:f,maxPitch:g,minPitch:p,normalize:S,position:u},{startPanLngLat:v,startZoomLngLat:T,startRotatePos:m,startBearing:_,startPitch:y,startZoom:b}),d(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=i+Math.log2(r);l=qn(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=qn(i,r,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=qn(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,oD(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),h=s/c;let f=0;o>0?Math.abs(u-l)>Vy&&(f=o/(l-u)*iN):o<0&&l>Vy&&(f=1-a/l),f=qn(f,-1,1);const{minPitch:g,maxPitch:p}=this.getViewportProps(),v=i+180*h;let T=r;return f>0?T=r+f*(p-r):f<0&&(T=r-f*(g-r)),{pitch:T,bearing:v}}}class oN extends nN{constructor(...e){super(...e),d(this,"ControllerState",sN),d(this,"transition",{transitionDuration:300,transitionInterpolator:new tC({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),d(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class nC extends Os{get ViewportType(){return Rs}get ControllerType(){return oN}}d(nC,"displayName","MapView");const aN=new $p;function lN(t,e){var n,r;const i=(n=t.order)!==null&&n!==void 0?n:1/0,s=(r=e.order)!==null&&r!==void 0?r:1/0;return i-s}class cN{constructor(){d(this,"effects",void 0),d(this,"_resolvedEffects",[]),d(this,"_defaultEffects",[]),d(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>lN(i,e)>0);r<0?n.push(e):n.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Bn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];s&&s!==i?s.setProps?(s.setProps(i.props),r.push(s)):(s.cleanup(),r.push(i)):r.push(i),delete n[i.id]}for(const i in n)n[i].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof $p)||this._resolvedEffects.push(aN),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class uN extends Yp{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const hN="deckRenderer.renderLayers";class fN{constructor(e){d(this,"gl",void 0),d(this,"layerFilter",void 0),d(this,"drawPickingColors",void 0),d(this,"drawLayersPass",void 0),d(this,"pickLayersPass",void 0),d(this,"renderCount",void 0),d(this,"_needsRedraw",void 0),d(this,"renderBuffers",void 0),d(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new uN(e),this.pickLayersPass=new $b(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||Fe.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,Ye(hN,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(this.gl,n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Fe(this.gl),new Fe(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const s of e)if(s.postRender){if(s.id===this.lastPostProcessEffect){i.target=n.target,s.postRender(this.gl,i);break}const o=s.postRender(this.gl,i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const dN={pickedColor:null,pickedObjectIndex:-1};function gN({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=i*i,h=-1,f=0;for(let g=0;g<c;g++){const p=g+a-r,v=p*p;if(v>u)f+=4*l;else for(let T=0;T<l;T++){if(t[f+3]-1>=0){const _=T+o-n,y=_*_+v;y<=u&&(u=y,h=f)}f+=4}}if(h>=0){const g=t.slice(h,h+4),p=e(g);if(p){const v=Math.floor(h/4/l),T=h/4-v*l;return{...p,pickedColor:g,pickedX:o+T,pickedY:a+v}}X.error("Picked non-existent layer. Is picking buffer corrupt?")()}return dN}function pN({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):X.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function rC({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=_N((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let a;if(o){const l=[r-o.x,i-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function mN(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(r==="hover"){const h=n.index,f=n.layerId,g=o?o.props.id:null;if(g!==f||a!==h){if(g!==f){const p=i.find(v=>v.props.id===f);p&&l.unshift(p)}n.layerId=g,n.index=a,n.info=null}}const c=rC(t),u=new Map;return u.set(null,c),l.forEach(h=>{let f={...c};h===o&&(f.color=s,f.index=a,f.picked=!0),f=iC({layer:h,info:f,mode:r});const g=f.layer;h===o&&r==="hover"&&(n.info=f),u.set(g.id,f),r==="hover"&&g.updateAutoHighlight(f)}),u}function iC({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function _N(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class yN{constructor(e){d(this,"gl",void 0),d(this,"pickingFBO",void 0),d(this,"depthFBO",void 0),d(this,"pickLayersPass",void 0),d(this,"layerFilter",void 0),d(this,"lastPickedInfo",void 0),d(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new $b(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?r.find(f=>f.id===o):null,c=a&&i.find(f=>f.id===a)||i[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var e,n;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new Fe(r),Fe.isSupported(r,{colorBufferFloat:!0}))){const i=new Fe(r);i.attach({36064:new st(r,{format:Q(r)?34836:6408,type:5126})}),this.depthFBO=i}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:h}){const f=this._getPickable(e),g=xs(this.gl);if(!f)return{result:[],emptyInfo:rC({viewports:r,x:i,y:s,pixelRatio:g})};this._resizeBuffer();const p=Dh(this.gl,[i,s],!0),v=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],T=Math.round(o*g),{width:m,height:_}=this.pickingFBO,y=this._getPickingRect({deviceX:v[0],deviceY:v[1],deviceRadius:T,deviceWidth:m,deviceHeight:_}),b={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let S;const w=[],I=new Set;for(let L=0;L<a;L++){let B;if(y){const G=this._drawAndSample({layers:f,views:n,viewports:r,onViewportActive:u,deviceRect:y,cullRect:b,effects:h,pass:"picking:".concat(l)});B=gN({...G,deviceX:v[0],deviceY:v[1],deviceRadius:T,deviceRect:y})}else B={pickedColor:null,pickedObjectIndex:-1};let M;if(B.pickedLayer&&c&&this.depthFBO){const{pickedColors:G}=this._drawAndSample({layers:[B.pickedLayer],views:n,viewports:r,onViewportActive:u,deviceRect:{x:B.pickedX,y:B.pickedY,width:1,height:1},cullRect:b,effects:h,pass:"picking:".concat(l,":z")},!0);G[3]&&(M=G[0])}B.pickedLayer&&L+1<a&&(I.add(B.pickedLayer),B.pickedLayer.disablePickingIndex(B.pickedObjectIndex)),S=mN({pickInfo:B,lastPickedInfo:this.lastPickedInfo,mode:l,layers:f,viewports:r,x:i,y:s,z:M,pixelRatio:g});for(const G of S.values())G.layer&&w.push(G);if(!B.pickedColor)break}for(const L of I)L.restorePickingColors();return{result:w,emptyInfo:S.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:h}){const f=this._getPickable(e);if(!f)return[];this._resizeBuffer();const g=xs(this.gl),p=Dh(this.gl,[i,s],!0),v=p.x,T=p.y+p.height,m=Dh(this.gl,[i+o,s+a],!0),_=m.x+m.width,y=m.y,b={x:v,y,width:_-v,height:T-y},S=this._drawAndSample({layers:f,views:n,viewports:r,onViewportActive:u,deviceRect:b,cullRect:{x:i,y:s,width:o,height:a},effects:h,pass:"picking:".concat(l)}),w=pN(S),I=new Map,L=Number.isFinite(c);for(let B=0;B<w.length&&!(L&&c&&I.size>=c);B++){const M=w[B];let G={color:M.pickedColor,layer:null,index:M.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:g};G=iC({layer:M.pickedLayer,info:G,mode:l}),I.has(G.object)||I.set(G.object,G)}return Array.from(I.values())}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,h={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c,preRenderStats:{}};for(const _ of a)_.useInPicking&&(h.preRenderStats[_.id]=_.preRender(this.gl,h));const{decodePickingColor:f}=this.pickLayersPass.render(h),{x:g,y:p,width:v,height:T}=s,m=new(c?Float32Array:Uint8Array)(v*T*4);return Lu(u,{sourceX:g,sourceY:p,sourceWidth:v,sourceHeight:T,target:m}),{pickedColors:m,decodePickingColor:f}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,n-r),l=Math.min(i,e+r+1)-o,c=Math.min(s,n+r+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const vN={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class AN{constructor(e){d(this,"el",null),d(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,vN),n.appendChild(this.el))}setTooltip(e,n,r){const i=this.el;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(n,"px, ").concat(r,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var sC={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,i){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,u=Date.now;function h(A,E,C){return setTimeout(y(A,C),E)}function f(A,E,C){return Array.isArray(A)?(g(A,C[E],C),!0):!1}function g(A,E,C){var P;if(A)if(A.forEach)A.forEach(E,C);else if(A.length!==i)for(P=0;P<A.length;)E.call(C,A[P],P,A),P++;else for(P in A)A.hasOwnProperty(P)&&E.call(C,A[P],P,A)}function p(A,E,C){var P="DEPRECATED METHOD: "+E+`
`+C+` AT 
`;return function(){var R=new Error("get-stack-trace"),k=R&&R.stack?R.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",q=e.console&&(e.console.warn||e.console.log);return q&&q.call(e.console,P,k),A.apply(this,arguments)}}var v;typeof Object.assign!="function"?v=function(E){if(E===i||E===null)throw new TypeError("Cannot convert undefined or null to object");for(var C=Object(E),P=1;P<arguments.length;P++){var R=arguments[P];if(R!==i&&R!==null)for(var k in R)R.hasOwnProperty(k)&&(C[k]=R[k])}return C}:v=Object.assign;var T=p(function(E,C,P){for(var R=Object.keys(C),k=0;k<R.length;)(!P||P&&E[R[k]]===i)&&(E[R[k]]=C[R[k]]),k++;return E},"extend","Use `assign`."),m=p(function(E,C){return T(E,C,!0)},"merge","Use `assign`.");function _(A,E,C){var P=E.prototype,R;R=A.prototype=Object.create(P),R.constructor=A,R._super=P,C&&v(R,C)}function y(A,E){return function(){return A.apply(E,arguments)}}function b(A,E){return typeof A==a?A.apply(E&&E[0]||i,E):A}function S(A,E){return A===i?E:A}function w(A,E,C){g(M(E),function(P){A.addEventListener(P,C,!1)})}function I(A,E,C){g(M(E),function(P){A.removeEventListener(P,C,!1)})}function L(A,E){for(;A;){if(A==E)return!0;A=A.parentNode}return!1}function B(A,E){return A.indexOf(E)>-1}function M(A){return A.trim().split(/\s+/g)}function G(A,E,C){if(A.indexOf&&!C)return A.indexOf(E);for(var P=0;P<A.length;){if(C&&A[P][C]==E||!C&&A[P]===E)return P;P++}return-1}function W(A){return Array.prototype.slice.call(A,0)}function j(A,E,C){for(var P=[],R=[],k=0;k<A.length;){var q=E?A[k][E]:A[k];G(R,q)<0&&P.push(A[k]),R[k]=q,k++}return C&&(E?P=P.sort(function(ze,tt){return ze[E]>tt[E]}):P=P.sort()),P}function Y(A,E){for(var C,P,R=E[0].toUpperCase()+E.slice(1),k=0;k<s.length;){if(C=s[k],P=C?C+R:E,P in A)return P;k++}return i}var lt=1;function Nn(){return lt++}function yn(A){var E=A.ownerDocument||A;return E.defaultView||E.parentWindow||e}var U=/mobile|tablet|ip(ad|hone|od)|android/i,H="ontouchstart"in e,J=Y(e,"PointerEvent")!==i,he=H&&U.test(navigator.userAgent),fe="touch",mr="pen",qt="mouse",js="kinect",Un=25,xe=1,Qr=2,Pe=4,ct=8,za=1,Hs=2,Ws=4,Js=8,Xs=16,vn=Hs|Ws,qr=Js|Xs,Om=vn|qr,Fm=["x","y"],Va=["clientX","clientY"];function Ft(A,E){var C=this;this.manager=A,this.callback=E,this.element=A.element,this.target=A.options.inputTarget,this.domHandler=function(P){b(A.options.enable,[A])&&C.handler(P)},this.init()}Ft.prototype={handler:function(){},init:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(yn(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&I(this.element,this.evEl,this.domHandler),this.evTarget&&I(this.target,this.evTarget,this.domHandler),this.evWin&&I(yn(this.element),this.evWin,this.domHandler)}};function US(A){var E,C=A.options.inputClass;return C?E=C:J?E=Hu:he?E=Wa:H?E=Wu:E=Ha,new E(A,kS)}function kS(A,E,C){var P=C.pointers.length,R=C.changedPointers.length,k=E&xe&&P-R===0,q=E&(Pe|ct)&&P-R===0;C.isFirst=!!k,C.isFinal=!!q,k&&(A.session={}),C.eventType=E,GS(A,C),A.emit("hammer.input",C),A.recognize(C),A.session.prevInput=C}function GS(A,E){var C=A.session,P=E.pointers,R=P.length;C.firstInput||(C.firstInput=Dm(E)),R>1&&!C.firstMultiple?C.firstMultiple=Dm(E):R===1&&(C.firstMultiple=!1);var k=C.firstInput,q=C.firstMultiple,De=q?q.center:k.center,ze=E.center=Nm(P);E.timeStamp=u(),E.deltaTime=E.timeStamp-k.timeStamp,E.angle=ju(De,ze),E.distance=ja(De,ze),zS(C,E),E.offsetDirection=km(E.deltaX,E.deltaY);var tt=Um(E.deltaTime,E.deltaX,E.deltaY);E.overallVelocityX=tt.x,E.overallVelocityY=tt.y,E.overallVelocity=c(tt.x)>c(tt.y)?tt.x:tt.y,E.scale=q?HS(q.pointers,P):1,E.rotation=q?jS(q.pointers,P):0,E.maxPointers=C.prevInput?E.pointers.length>C.prevInput.maxPointers?E.pointers.length:C.prevInput.maxPointers:E.pointers.length,VS(C,E);var En=A.element;L(E.srcEvent.target,En)&&(En=E.srcEvent.target),E.target=En}function zS(A,E){var C=E.center,P=A.offsetDelta||{},R=A.prevDelta||{},k=A.prevInput||{};(E.eventType===xe||k.eventType===Pe)&&(R=A.prevDelta={x:k.deltaX||0,y:k.deltaY||0},P=A.offsetDelta={x:C.x,y:C.y}),E.deltaX=R.x+(C.x-P.x),E.deltaY=R.y+(C.y-P.y)}function VS(A,E){var C=A.lastInterval||E,P=E.timeStamp-C.timeStamp,R,k,q,De;if(E.eventType!=ct&&(P>Un||C.velocity===i)){var ze=E.deltaX-C.deltaX,tt=E.deltaY-C.deltaY,En=Um(P,ze,tt);k=En.x,q=En.y,R=c(En.x)>c(En.y)?En.x:En.y,De=km(ze,tt),A.lastInterval=E}else R=C.velocity,k=C.velocityX,q=C.velocityY,De=C.direction;E.velocity=R,E.velocityX=k,E.velocityY=q,E.direction=De}function Dm(A){for(var E=[],C=0;C<A.pointers.length;)E[C]={clientX:l(A.pointers[C].clientX),clientY:l(A.pointers[C].clientY)},C++;return{timeStamp:u(),pointers:E,center:Nm(E),deltaX:A.deltaX,deltaY:A.deltaY}}function Nm(A){var E=A.length;if(E===1)return{x:l(A[0].clientX),y:l(A[0].clientY)};for(var C=0,P=0,R=0;R<E;)C+=A[R].clientX,P+=A[R].clientY,R++;return{x:l(C/E),y:l(P/E)}}function Um(A,E,C){return{x:E/A||0,y:C/A||0}}function km(A,E){return A===E?za:c(A)>=c(E)?A<0?Hs:Ws:E<0?Js:Xs}function ja(A,E,C){C||(C=Fm);var P=E[C[0]]-A[C[0]],R=E[C[1]]-A[C[1]];return Math.sqrt(P*P+R*R)}function ju(A,E,C){C||(C=Fm);var P=E[C[0]]-A[C[0]],R=E[C[1]]-A[C[1]];return Math.atan2(R,P)*180/Math.PI}function jS(A,E){return ju(E[1],E[0],Va)+ju(A[1],A[0],Va)}function HS(A,E){return ja(E[0],E[1],Va)/ja(A[0],A[1],Va)}var WS={mousedown:xe,mousemove:Qr,mouseup:Pe},JS="mousedown",XS="mousemove mouseup";function Ha(){this.evEl=JS,this.evWin=XS,this.pressed=!1,Ft.apply(this,arguments)}_(Ha,Ft,{handler:function(E){var C=WS[E.type];C&xe&&E.button===0&&(this.pressed=!0),C&Qr&&E.which!==1&&(C=Pe),this.pressed&&(C&Pe&&(this.pressed=!1),this.callback(this.manager,C,{pointers:[E],changedPointers:[E],pointerType:qt,srcEvent:E}))}});var KS={pointerdown:xe,pointermove:Qr,pointerup:Pe,pointercancel:ct,pointerout:ct},YS={2:fe,3:mr,4:qt,5:js},Gm="pointerdown",zm="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Gm="MSPointerDown",zm="MSPointerMove MSPointerUp MSPointerCancel");function Hu(){this.evEl=Gm,this.evWin=zm,Ft.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}_(Hu,Ft,{handler:function(E){var C=this.store,P=!1,R=E.type.toLowerCase().replace("ms",""),k=KS[R],q=YS[E.pointerType]||E.pointerType,De=q==fe,ze=G(C,E.pointerId,"pointerId");k&xe&&(E.button===0||De)?ze<0&&(C.push(E),ze=C.length-1):k&(Pe|ct)&&(P=!0),!(ze<0)&&(C[ze]=E,this.callback(this.manager,k,{pointers:C,changedPointers:[E],pointerType:q,srcEvent:E}),P&&C.splice(ze,1))}});var QS={touchstart:xe,touchmove:Qr,touchend:Pe,touchcancel:ct},qS="touchstart",ZS="touchstart touchmove touchend touchcancel";function Vm(){this.evTarget=qS,this.evWin=ZS,this.started=!1,Ft.apply(this,arguments)}_(Vm,Ft,{handler:function(E){var C=QS[E.type];if(C===xe&&(this.started=!0),!!this.started){var P=$S.call(this,E,C);C&(Pe|ct)&&P[0].length-P[1].length===0&&(this.started=!1),this.callback(this.manager,C,{pointers:P[0],changedPointers:P[1],pointerType:fe,srcEvent:E})}}});function $S(A,E){var C=W(A.touches),P=W(A.changedTouches);return E&(Pe|ct)&&(C=j(C.concat(P),"identifier",!0)),[C,P]}var ew={touchstart:xe,touchmove:Qr,touchend:Pe,touchcancel:ct},tw="touchstart touchmove touchend touchcancel";function Wa(){this.evTarget=tw,this.targetIds={},Ft.apply(this,arguments)}_(Wa,Ft,{handler:function(E){var C=ew[E.type],P=nw.call(this,E,C);P&&this.callback(this.manager,C,{pointers:P[0],changedPointers:P[1],pointerType:fe,srcEvent:E})}});function nw(A,E){var C=W(A.touches),P=this.targetIds;if(E&(xe|Qr)&&C.length===1)return P[C[0].identifier]=!0,[C,C];var R,k,q=W(A.changedTouches),De=[],ze=this.target;if(k=C.filter(function(tt){return L(tt.target,ze)}),E===xe)for(R=0;R<k.length;)P[k[R].identifier]=!0,R++;for(R=0;R<q.length;)P[q[R].identifier]&&De.push(q[R]),E&(Pe|ct)&&delete P[q[R].identifier],R++;if(De.length)return[j(k.concat(De),"identifier",!0),De]}var rw=2500,jm=25;function Wu(){Ft.apply(this,arguments);var A=y(this.handler,this);this.touch=new Wa(this.manager,A),this.mouse=new Ha(this.manager,A),this.primaryTouch=null,this.lastTouches=[]}_(Wu,Ft,{handler:function(E,C,P){var R=P.pointerType==fe,k=P.pointerType==qt;if(!(k&&P.sourceCapabilities&&P.sourceCapabilities.firesTouchEvents)){if(R)iw.call(this,C,P);else if(k&&sw.call(this,P))return;this.callback(E,C,P)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function iw(A,E){A&xe?(this.primaryTouch=E.changedPointers[0].identifier,Hm.call(this,E)):A&(Pe|ct)&&Hm.call(this,E)}function Hm(A){var E=A.changedPointers[0];if(E.identifier===this.primaryTouch){var C={x:E.clientX,y:E.clientY};this.lastTouches.push(C);var P=this.lastTouches,R=function(){var k=P.indexOf(C);k>-1&&P.splice(k,1)};setTimeout(R,rw)}}function sw(A){for(var E=A.srcEvent.clientX,C=A.srcEvent.clientY,P=0;P<this.lastTouches.length;P++){var R=this.lastTouches[P],k=Math.abs(E-R.x),q=Math.abs(C-R.y);if(k<=jm&&q<=jm)return!0}return!1}var Wm=Y(o.style,"touchAction"),Jm=Wm!==i,Xm="compute",Km="auto",Ju="manipulation",Zr="none",Ks="pan-x",Ys="pan-y",Ja=aw();function Xu(A,E){this.manager=A,this.set(E)}Xu.prototype={set:function(A){A==Xm&&(A=this.compute()),Jm&&this.manager.element.style&&Ja[A]&&(this.manager.element.style[Wm]=A),this.actions=A.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var A=[];return g(this.manager.recognizers,function(E){b(E.options.enable,[E])&&(A=A.concat(E.getTouchAction()))}),ow(A.join(" "))},preventDefaults:function(A){var E=A.srcEvent,C=A.offsetDirection;if(this.manager.session.prevented){E.preventDefault();return}var P=this.actions,R=B(P,Zr)&&!Ja[Zr],k=B(P,Ys)&&!Ja[Ys],q=B(P,Ks)&&!Ja[Ks];if(R){var De=A.pointers.length===1,ze=A.distance<2,tt=A.deltaTime<250;if(De&&ze&&tt)return}if(!(q&&k)&&(R||k&&C&vn||q&&C&qr))return this.preventSrc(E)},preventSrc:function(A){this.manager.session.prevented=!0,A.preventDefault()}};function ow(A){if(B(A,Zr))return Zr;var E=B(A,Ks),C=B(A,Ys);return E&&C?Zr:E||C?E?Ks:Ys:B(A,Ju)?Ju:Km}function aw(){if(!Jm)return!1;var A={},E=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(C){A[C]=E?e.CSS.supports("touch-action",C):!0}),A}var Xa=1,Dt=2,Mi=4,_r=8,kn=_r,Qs=16,An=32;function Gn(A){this.options=v({},this.defaults,A||{}),this.id=Nn(),this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=Xa,this.simultaneous={},this.requireFail=[]}Gn.prototype={defaults:{},set:function(A){return v(this.options,A),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(A){if(f(A,"recognizeWith",this))return this;var E=this.simultaneous;return A=Ka(A,this),E[A.id]||(E[A.id]=A,A.recognizeWith(this)),this},dropRecognizeWith:function(A){return f(A,"dropRecognizeWith",this)?this:(A=Ka(A,this),delete this.simultaneous[A.id],this)},requireFailure:function(A){if(f(A,"requireFailure",this))return this;var E=this.requireFail;return A=Ka(A,this),G(E,A)===-1&&(E.push(A),A.requireFailure(this)),this},dropRequireFailure:function(A){if(f(A,"dropRequireFailure",this))return this;A=Ka(A,this);var E=G(this.requireFail,A);return E>-1&&this.requireFail.splice(E,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(A){return!!this.simultaneous[A.id]},emit:function(A){var E=this,C=this.state;function P(R){E.manager.emit(R,A)}C<_r&&P(E.options.event+Ym(C)),P(E.options.event),A.additionalEvent&&P(A.additionalEvent),C>=_r&&P(E.options.event+Ym(C))},tryEmit:function(A){if(this.canEmit())return this.emit(A);this.state=An},canEmit:function(){for(var A=0;A<this.requireFail.length;){if(!(this.requireFail[A].state&(An|Xa)))return!1;A++}return!0},recognize:function(A){var E=v({},A);if(!b(this.options.enable,[this,E])){this.reset(),this.state=An;return}this.state&(kn|Qs|An)&&(this.state=Xa),this.state=this.process(E),this.state&(Dt|Mi|_r|Qs)&&this.tryEmit(E)},process:function(A){},getTouchAction:function(){},reset:function(){}};function Ym(A){return A&Qs?"cancel":A&_r?"end":A&Mi?"move":A&Dt?"start":""}function Qm(A){return A==Xs?"down":A==Js?"up":A==Hs?"left":A==Ws?"right":""}function Ka(A,E){var C=E.manager;return C?C.get(A):A}function Zt(){Gn.apply(this,arguments)}_(Zt,Gn,{defaults:{pointers:1},attrTest:function(A){var E=this.options.pointers;return E===0||A.pointers.length===E},process:function(A){var E=this.state,C=A.eventType,P=E&(Dt|Mi),R=this.attrTest(A);return P&&(C&ct||!R)?E|Qs:P||R?C&Pe?E|_r:E&Dt?E|Mi:Dt:An}});function Ya(){Zt.apply(this,arguments),this.pX=null,this.pY=null}_(Ya,Zt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Om},getTouchAction:function(){var A=this.options.direction,E=[];return A&vn&&E.push(Ys),A&qr&&E.push(Ks),E},directionTest:function(A){var E=this.options,C=!0,P=A.distance,R=A.direction,k=A.deltaX,q=A.deltaY;return R&E.direction||(E.direction&vn?(R=k===0?za:k<0?Hs:Ws,C=k!=this.pX,P=Math.abs(A.deltaX)):(R=q===0?za:q<0?Js:Xs,C=q!=this.pY,P=Math.abs(A.deltaY))),A.direction=R,C&&P>E.threshold&&R&E.direction},attrTest:function(A){return Zt.prototype.attrTest.call(this,A)&&(this.state&Dt||!(this.state&Dt)&&this.directionTest(A))},emit:function(A){this.pX=A.deltaX,this.pY=A.deltaY;var E=Qm(A.direction);E&&(A.additionalEvent=this.options.event+E),this._super.emit.call(this,A)}});function Ku(){Zt.apply(this,arguments)}_(Ku,Zt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Zr]},attrTest:function(A){return this._super.attrTest.call(this,A)&&(Math.abs(A.scale-1)>this.options.threshold||this.state&Dt)},emit:function(A){if(A.scale!==1){var E=A.scale<1?"in":"out";A.additionalEvent=this.options.event+E}this._super.emit.call(this,A)}});function Yu(){Gn.apply(this,arguments),this._timer=null,this._input=null}_(Yu,Gn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Km]},process:function(A){var E=this.options,C=A.pointers.length===E.pointers,P=A.distance<E.threshold,R=A.deltaTime>E.time;if(this._input=A,!P||!C||A.eventType&(Pe|ct)&&!R)this.reset();else if(A.eventType&xe)this.reset(),this._timer=h(function(){this.state=kn,this.tryEmit()},E.time,this);else if(A.eventType&Pe)return kn;return An},reset:function(){clearTimeout(this._timer)},emit:function(A){this.state===kn&&(A&&A.eventType&Pe?this.manager.emit(this.options.event+"up",A):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function Qu(){Zt.apply(this,arguments)}_(Qu,Zt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Zr]},attrTest:function(A){return this._super.attrTest.call(this,A)&&(Math.abs(A.rotation)>this.options.threshold||this.state&Dt)}});function qu(){Zt.apply(this,arguments)}_(qu,Zt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:vn|qr,pointers:1},getTouchAction:function(){return Ya.prototype.getTouchAction.call(this)},attrTest:function(A){var E=this.options.direction,C;return E&(vn|qr)?C=A.overallVelocity:E&vn?C=A.overallVelocityX:E&qr&&(C=A.overallVelocityY),this._super.attrTest.call(this,A)&&E&A.offsetDirection&&A.distance>this.options.threshold&&A.maxPointers==this.options.pointers&&c(C)>this.options.velocity&&A.eventType&Pe},emit:function(A){var E=Qm(A.offsetDirection);E&&this.manager.emit(this.options.event+E,A),this.manager.emit(this.options.event,A)}});function Qa(){Gn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}_(Qa,Gn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ju]},process:function(A){var E=this.options,C=A.pointers.length===E.pointers,P=A.distance<E.threshold,R=A.deltaTime<E.time;if(this.reset(),A.eventType&xe&&this.count===0)return this.failTimeout();if(P&&R&&C){if(A.eventType!=Pe)return this.failTimeout();var k=this.pTime?A.timeStamp-this.pTime<E.interval:!0,q=!this.pCenter||ja(this.pCenter,A.center)<E.posThreshold;this.pTime=A.timeStamp,this.pCenter=A.center,!q||!k?this.count=1:this.count+=1,this._input=A;var De=this.count%E.taps;if(De===0)return this.hasRequireFailures()?(this._timer=h(function(){this.state=kn,this.tryEmit()},E.interval,this),Dt):kn}return An},failTimeout:function(){return this._timer=h(function(){this.state=An},this.options.interval,this),An},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==kn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function zn(A,E){return E=E||{},E.recognizers=S(E.recognizers,zn.defaults.preset),new Zu(A,E)}zn.VERSION="2.0.7",zn.defaults={domEvents:!1,touchAction:Xm,enable:!0,inputTarget:null,inputClass:null,preset:[[Qu,{enable:!1}],[Ku,{enable:!1},["rotate"]],[qu,{direction:vn}],[Ya,{direction:vn},["swipe"]],[Qa],[Qa,{event:"doubletap",taps:2},["tap"]],[Yu]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var lw=1,qm=2;function Zu(A,E){this.options=v({},zn.defaults,E||{}),this.options.inputTarget=this.options.inputTarget||A,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=A,this.input=US(this),this.touchAction=new Xu(this,this.options.touchAction),Zm(this,!0),g(this.options.recognizers,function(C){var P=this.add(new C[0](C[1]));C[2]&&P.recognizeWith(C[2]),C[3]&&P.requireFailure(C[3])},this)}Zu.prototype={set:function(A){return v(this.options,A),A.touchAction&&this.touchAction.update(),A.inputTarget&&(this.input.destroy(),this.input.target=A.inputTarget,this.input.init()),this},stop:function(A){this.session.stopped=A?qm:lw},recognize:function(A){var E=this.session;if(!E.stopped){this.touchAction.preventDefaults(A);var C,P=this.recognizers,R=E.curRecognizer;(!R||R&&R.state&kn)&&(R=E.curRecognizer=null);for(var k=0;k<P.length;)C=P[k],E.stopped!==qm&&(!R||C==R||C.canRecognizeWith(R))?C.recognize(A):C.reset(),!R&&C.state&(Dt|Mi|_r)&&(R=E.curRecognizer=C),k++}},get:function(A){if(A instanceof Gn)return A;for(var E=this.recognizers,C=0;C<E.length;C++)if(E[C].options.event==A)return E[C];return null},add:function(A){if(f(A,"add",this))return this;var E=this.get(A.options.event);return E&&this.remove(E),this.recognizers.push(A),A.manager=this,this.touchAction.update(),A},remove:function(A){if(f(A,"remove",this))return this;if(A=this.get(A),A){var E=this.recognizers,C=G(E,A);C!==-1&&(E.splice(C,1),this.touchAction.update())}return this},on:function(A,E){if(A!==i&&E!==i){var C=this.handlers;return g(M(A),function(P){C[P]=C[P]||[],C[P].push(E)}),this}},off:function(A,E){if(A!==i){var C=this.handlers;return g(M(A),function(P){E?C[P]&&C[P].splice(G(C[P],E),1):delete C[P]}),this}},emit:function(A,E){this.options.domEvents&&cw(A,E);var C=this.handlers[A]&&this.handlers[A].slice();if(!(!C||!C.length)){E.type=A,E.preventDefault=function(){E.srcEvent.preventDefault()};for(var P=0;P<C.length;)C[P](E),P++}},destroy:function(){this.element&&Zm(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Zm(A,E){var C=A.element;if(C.style){var P;g(A.options.cssProps,function(R,k){P=Y(C.style,k),E?(A.oldCssProps[P]=C.style[P],C.style[P]=R):C.style[P]=A.oldCssProps[P]||""}),E||(A.oldCssProps={})}}function cw(A,E){var C=n.createEvent("Event");C.initEvent(A,!0,!0),C.gesture=E,E.target.dispatchEvent(C)}v(zn,{INPUT_START:xe,INPUT_MOVE:Qr,INPUT_END:Pe,INPUT_CANCEL:ct,STATE_POSSIBLE:Xa,STATE_BEGAN:Dt,STATE_CHANGED:Mi,STATE_ENDED:_r,STATE_RECOGNIZED:kn,STATE_CANCELLED:Qs,STATE_FAILED:An,DIRECTION_NONE:za,DIRECTION_LEFT:Hs,DIRECTION_RIGHT:Ws,DIRECTION_UP:Js,DIRECTION_DOWN:Xs,DIRECTION_HORIZONTAL:vn,DIRECTION_VERTICAL:qr,DIRECTION_ALL:Om,Manager:Zu,Input:Ft,TouchAction:Xu,TouchInput:Wa,MouseInput:Ha,PointerEventInput:Hu,TouchMouseInput:Wu,SingleTouchInput:Vm,Recognizer:Gn,AttrRecognizer:Zt,Tap:Qa,Pan:Ya,Swipe:qu,Pinch:Ku,Rotate:Qu,Press:Yu,on:w,off:I,each:g,merge:m,extend:T,assign:v,inherit:_,bindFn:y,prefixed:Y});var uw=typeof e<"u"?e:typeof self<"u"?self:{};uw.Hammer=zn,typeof i=="function"&&i.amd?i(function(){return zn}):t.exports?t.exports=zn:e[r]=zn})(window,document,"Hammer")})(sC);var Da=sC.exports;const EN=vg(Da),Cn=hw({__proto__:null,default:EN},[Da]),oC=1,aC=2,Xd=4,TN={mousedown:oC,mousemove:aC,mouseup:Xd};function bN(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function CN(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(bN(i,s=>s.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function SN(t){t.prototype.handler=function(n){let r=TN[n.type];r&oC&&n.button>=0&&(this.pressed=!0),r&aC&&n.which===0&&(r=Xd),this.pressed&&(r&Xd&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}CN(Da.PointerEventInput);SN(Da.MouseInput);const wN=Da.Manager;class Mu{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const xN=Cn?[[Cn.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Cn.Rotate,{enable:!1}],[Cn.Pinch,{enable:!1}],[Cn.Swipe,{enable:!1}],[Cn.Pan,{threshold:0,enable:!1}],[Cn.Press,{enable:!1}],[Cn.Tap,{event:"doubletap",taps:2,enable:!1}],[Cn.Tap,{event:"anytap",enable:!1}],[Cn.Tap,{enable:!1}]]:null,jy={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},PN={doubletap:["tap"]},IN={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},tm={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},LN={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Hy={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},MN=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",ss=typeof window<"u"?window:global;let Kd=!1;try{const t={get passive(){return Kd=!0,!0}};ss.addEventListener("test",null,t),ss.removeEventListener("test",null)}catch{Kd=!1}const BN=MN.indexOf("firefox")!==-1,{WHEEL_EVENTS:RN}=tm,Wy="wheel",Jy=4.000244140625,ON=40,FN=.25;class DN extends Mu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;ss.WheelEvent&&(BN&&i.deltaMode===ss.WheelEvent.DOM_DELTA_PIXEL&&(s/=ss.devicePixelRatio),i.deltaMode===ss.WheelEvent.DOM_DELTA_LINE&&(s*=ON)),s!==0&&s%Jy===0&&(s=Math.floor(s/Jy)),i.shiftKey&&s&&(s=s*FN),this.callback({type:Wy,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(RN),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,Kd?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Wy&&(this.options.enable=n)}}const{MOUSE_EVENTS:NN}=tm,Xy="pointermove",Ky="pointerover",Yy="pointerout",Qy="pointerenter",qy="pointerleave";class UN extends Mu{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(NN),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Xy&&(this.enableMoveEvent=n),e===Ky&&(this.enableOverEvent=n),e===Yy&&(this.enableOutEvent=n),e===Qy&&(this.enableEnterEvent=n),e===qy&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(Ky,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(Yy,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(Qy,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(qy,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(Xy,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:kN}=tm,Zy="keydown",$y="keyup";class GN extends Mu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:Zy,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:$y,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(kN),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Zy&&(this.enableDownEvent=n),e===$y&&(this.enableUpEvent=n)}}const ev="contextmenu";class zN extends Mu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:ev,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===ev&&(this.options.enable=n)}}const Yd=1,tu=2,Qd=4,VN={pointerdown:Yd,pointermove:tu,pointerup:Qd,mousedown:Yd,mousemove:tu,mouseup:Qd},jN=1,HN=2,WN=3,JN=0,XN=1,KN=2,YN=1,QN=2,qN=4;function ZN(t){const e=VN[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r,which:i}=t.srcEvent;let s=!1,o=!1,a=!1;return e===Qd||e===tu&&!Number.isFinite(n)?(s=i===jN,o=i===HN,a=i===WN):e===tu?(s=!!(n&YN),o=!!(n&qN),a=!!(n&QN)):e===Yd&&(s=r===JN,o=r===XN,a=r===KN),{leftButton:s,middleButton:o,rightButton:a}}function $N(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const ef={srcElement:"root",priority:0};class eU{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let i=n.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=ef;typeof r=="string"||r&&r.addEventListener?l={...ef,srcElement:r}:r&&(l={...ef,...r});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};i&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let h=c.length-1;for(;h>=0&&!(c[h].priority>=u.priority);)h--;c.splice(h+1,0,u)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let l=0;l<r.length;l++){const{type:c,handler:u,once:h}=r[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),h&&a.push(r[l]),i)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...ZN(e),...$N(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const tU={events:null,recognizers:null,recognizerOptions:{},Manager:wN,touchAction:"none",tabIndex:0};class nU{constructor(e=null,n){this._onBasicInput=i=>{const{srcEvent:s}=i,o=IN[s.type];o&&this.manager.emit(o,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...tU,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||xN}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(jy).forEach(i=>{const s=this.manager.get(i);s&&jy[i].forEach(o=>{s.recognizeWith(o)})});for(const i in n.recognizerOptions){const s=this.manager.get(i);if(s){const o=n.recognizerOptions[i];delete o.enable,s.set(o)}}this.wheelInput=new DN(e,this._onOtherEvent,{enable:!1}),this.moveInput=new UN(e,this._onOtherEvent,{enable:!1}),this.keyInput=new GN(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new zN(e,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==n){i.set({enable:n});const s=PN[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=r.get(o);n?(a.requireFailure(e),i.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const u in e)this._addEventHandler(u,e[u],r,i,s);return}const{manager:o,events:a}=this,l=Hy[e]||e;let c=a.get(l);c||(c=new eU(this),a.set(l,c),c.recognizerName=LN[l]||l,o&&o.on(l,c.handleEvent)),c.add(e,n,r,i,s),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:r}=this,i=Hy[e]||e,s=r.get(i);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of r.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function ti(){}const rU=({isDragging:t})=>t?"grabbing":"grab",lC={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:ti,onResize:ti,onViewStateChange:ti,onInteractionStateChange:ti,onBeforeRender:ti,onAfterRender:ti,onLoad:ti,onError:t=>X.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:rU,getTooltip:null,debug:!1,drawPickingColors:!1};class Bu{constructor(e){d(this,"props",void 0),d(this,"width",0),d(this,"height",0),d(this,"userData",{}),d(this,"canvas",null),d(this,"viewManager",null),d(this,"layerManager",null),d(this,"effectManager",null),d(this,"deckRenderer",null),d(this,"deckPicker",null),d(this,"eventManager",null),d(this,"tooltip",null),d(this,"metrics",void 0),d(this,"animationLoop",void 0),d(this,"stats",void 0),d(this,"viewState",void 0),d(this,"cursorState",void 0),d(this,"_needsRedraw",void 0),d(this,"_pickRequest",void 0),d(this,"_lastPointerDownInfo",null),d(this,"_metricsCounter",void 0),d(this,"_onPointerMove",n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const i=n.offsetCenter;if(!i)return;r.x=i.x,r.y=i.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n}),d(this,"_onEvent",n=>{const r=R_[n.type],i=n.offsetCenter;if(!r||!i||!this.layerManager)return;const s=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:s,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:a}=o,l=a&&(a[r.handler]||a.props[r.handler]),c=this.props[r.handler];let u=!1;l&&(u=l.call(a,o,n)),!u&&c&&c(o,n)}),d(this,"_onPointerDown",n=>{const r=n.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo}),this.props={...lC,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&X.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),jT()==="IE"&&X.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Lp({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Bs.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,a,l;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(s=this.deckRenderer)===null||s===void 0||s.finalize(),this.deckRenderer=null,(o=this.deckPicker)===null||o===void 0||o.finalize(),this.deckPicker=null,(a=this.eventManager)===null||a===void 0||a.destroy(),this.eventManager=null,(l=this.tooltip)===null||l===void 0||l.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var c;(c=this.canvas.parentElement)===null||c===void 0||c.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&X.removed("onLayerHover","onHover")(),"onLayerClick"in e&&X.removed("onLayerClick","onClick")(),e.initialViewState&&!Bn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return ke(this.viewManager),this.viewManager.views}getViewports(e){return ke(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,r){ke(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),ke(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=s}if(r||r===0){var i;const s=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((i=e.style)===null||i===void 0?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var e,n;const{canvas:r}=this;if(!r)return;const i=(e=r.clientWidth)!==null&&e!==void 0?e:r.width,s=(n=r.clientHeight)!==null&&n!==void 0?n:r.height;if(i!==this.width||s!==this.height){var o,a;this.width=i,this.height=s,(o=this.viewManager)===null||o===void 0||o.setProps({width:i,height:s}),(a=this.layerManager)===null||a===void 0||a.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:s})}}_createAnimationLoop(e){const{width:n,height:r,gl:i,glOptions:s,debug:o,onError:a,onBeforeRender:l,onAfterRender:c,useDevicePixels:u}=e;return new S2({width:n,height:r,useDevicePixels:u,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,gl:i,onCreateContext:h=>QT({...s,...h,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:h=>this._setGLContext(h.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:l,onAfterRender:c,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new nC({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let s=i,o=!1;for(const a of r){var n;s=a,o=((n=a.layer)===null||n===void 0?void 0:n.onHover(a,e.event))||o}if(!o&&this.props.onHover&&this.props.onHover(s,e.event),this.props.getTooltip&&this.tooltip){const a=this.props.getTooltip(s);this.tooltip.setTooltip(a,s.x,s.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Ip(e,{enable:!0,copyState:!0})),this.tooltip=new AN(this.canvas),lr(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new Gb;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new nU(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in R_)this.eventManager.on(i,this._onEvent);this.viewManager=new XD({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new JD(e,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new cN,this.deckRenderer=new fN(e),this.deckPicker=new yN(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:r}=this.layerManager.context;lr(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),X.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=ci.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}d(Bu,"defaultProps",lC);d(Bu,"VERSION",MM);class tf{constructor(e,n){d(this,"opts",void 0),d(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:r}=this.source,{size:i}=n;let s=r;if(r&&r.length!==i){s=new Float32Array(i);const o=n.elementOffset||0;for(let a=0;a<i;++a)s[a]=r[o+a]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function iU(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function cc(t){return t.stride||t.size*t.bytesPerElement}function cC(t,e){e.offset&&X.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=cc(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function sU(t,e){const n=cC(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class oU{constructor(e,n,r){d(this,"gl",void 0),d(this,"id",void 0),d(this,"size",void 0),d(this,"settings",void 0),d(this,"value",void 0),d(this,"doublePrecision",void 0),d(this,"_buffer",void 0),d(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i===5130;let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a=5126:!i&&n.isIndexed?a=e&&Rp(e,ae.ELEMENT_INDEX_UINT32)?5125:5123:a=i||5126;let l=iU(i||a||5126);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:i,type:a,size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new ie(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*cc(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Bs.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const r={},i=this.value instanceof Float64Array,s=sU(this.getAccessor(),n||{});return r[e]=new tf(this,s.high),r["".concat(e,"64Low")]=i?new tf(this,s.low):new Float32Array(this.size),r}if(n){const r=cC(this.getAccessor(),n);return{[e]:new tf(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<i;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof ie?r={buffer:e}:r=e;const i={...this.settings,...r};if(n.bufferAccessor=i,n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=s}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null;const o=r.value instanceof Float64Array;i.type=r.type||s.accessor.type,i.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(o?2:1),i.stride=cc(i)}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s,i.bytesPerElement=s.BYTES_PER_ELEMENT,i.stride=cc(i);const{buffer:o,byteOffset:a}=this;this.doublePrecision&&s instanceof Float64Array&&(s=qh(s,i));const l=s.byteLength+a+i.stride*2;o.byteLength<l&&o.reallocate(l),o.setAccessor(null),o.subData({data:s,offset:a}),i.type=r.type||o.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?qh(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),offset:r*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=Bs.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{buffer:o,byteOffset:a}=this;return o.byteLength<s.byteLength+a&&(o.reallocate(s.byteLength+a),n&&i&&o.subData({data:i instanceof Float64Array?qh(i,this):i,offset:a})),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&X.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}}const tv=[],nv=[];function Na(t,e=0,n=1/0){let r=tv;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(nv.length=t.length,r=nv):r=tv,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function uC(t){return t&&t[Symbol.asyncIterator]}function hC(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=r?r/a:n,c=i?i/a:0,u=Math.floor((t.length-c)/l);return(h,{index:f,target:g})=>{if(!s){const m=f*l+c;for(let _=0;_<n;_++)g[_]=t[m+_];return g}const p=s[f],v=s[f+1]||u;let T;if(o){T=new Array(v-p);for(let m=p;m<v;m++){const _=m*l+c;g=new Array(n);for(let y=0;y<n;y++)g[y]=t[_+y];T[m-p]=g}}else if(l===n)T=t.subarray(p*n+c,v*n+c);else{T=new t.constructor((v-p)*n);let m=0;for(let _=p;_<v;_++){const y=_*l+c;for(let b=0;b<n;b++)T[m++]=t[y+b]}}return T}}const aU=[],uc=[[0,1/0]];function lU(t,e){if(t===uc||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}function nf(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,a=e.length,l=o-r;if(a>l){n.set(e.subarray(0,l),r);return}if(n.set(e,r),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let h=0;h<i;h++)n[r+c]=u[h]||0,c++}}function cU({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!Array.isArray(s))return nf({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const l=r&&((u,h)=>r(u+a,h)),c=Math.min(i.length,s.length);for(let u=1;u<c;u++){const h=i[u]*n,f=s[u]*n;nf({source:t.subarray(o,h),target:e,start:a,end:f,size:n,getData:l}),o=h,a=f}return a<e.length&&nf({source:[],target:e,start:a,size:n,getData:l}),e}const uU={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function fC(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...uU[n],...e,...t,type:n}}function dC(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function gC(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function pC(t){t.push(t.shift())}function nm(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;return(r.noAlloc?i.length:e*s)*o}function mC({buffer:t,numInstances:e,attribute:n,fromLength:r,fromStartIndices:i,getData:s=o=>o}){const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,a=n.size*o,l=n.byteOffset,c=n.startIndices,u=i&&c,h=nm(n,e),f=n.isConstant;if(!u&&r>=h)return;const g=f?n.value:n.getBuffer().getData({srcByteOffset:l});if(n.settings.normalized&&!f){const m=s;s=(_,y)=>n.normalizeConstant(m(_,y))}const p=f?(m,_)=>s(g,_):(m,_)=>s(g.subarray(m,m+a),_),v=t.getData({length:r}),T=new Float32Array(h);cU({source:v,target:T,sourceStartIndices:i,targetStartIndices:c,size:a,getData:p}),t.byteLength<T.byteLength+l&&t.reallocate(T.byteLength+l),t.subData({data:T,offset:l})}class rm extends oU{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:uc}),d(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return fC(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=lU(this.state.updateRanges,[r,i])}else this.state.updateRanges=uc}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=aU}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==uc),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(i,this,{data:n,startRow:c,endRow:u,props:r,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const h=Number.isFinite(c)?this.getVertexOffset(c):0,f=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:h,endOffset:f})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;ke(ArrayBuffer.isView(o.value),"invalid ".concat(i.accessor));const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=hC(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const r in e)Object.assign(n,super.getShaderAttributes(r,e[r]));return n}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:h}=e,{accessor:f,transform:g}=a,p=l.binaryAccessor||(typeof f=="function"?f:s[f]);ke(typeof p=="function",'accessor "'.concat(f,'" is not a function'));let v=e.getVertexOffset(r);const{iterable:T,objectInfo:m}=Na(n,r,i);for(const _ of T){m.index++;let y=p(_,m);if(g&&(y=g.call(this,y)),h){const b=(m.index<h.length-1?h[m.index+1]:o)-h[m.index];if(y&&Array.isArray(y[0])){let S=v;for(const w of y)e._normalizeValue(w,c,S),S+=u}else y&&y.length>u?c.set(y,v):(e._normalizeValue(y,m.target,0),ND({target:c,source:m.target,start:v,count:b}));v+=b*u}else e._normalizeValue(y,c,v),v+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class hU{constructor({gl:e,attribute:n,timeline:r}){d(this,"gl",void 0),d(this,"type","interpolation"),d(this,"attributeInTransition",void 0),d(this,"settings",void 0),d(this,"attribute",void 0),d(this,"transition",void 0),d(this,"currentStartIndices",void 0),d(this,"currentLength",void 0),d(this,"transform",void 0),d(this,"buffers",void 0),this.gl=e,this.transition=new Fa(r),this.attribute=n,this.attributeInTransition=new rm(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=dU(e,n);const i={byteLength:0,usage:35050};this.buffers=[new ie(e,i),new ie(e,i)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:i,attribute:s}=this;pC(i);const o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of i)mC({buffer:a,...o});this.currentStartIndices=s.startIndices,this.currentLength=nm(s,n),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:i[0],aTo:dC(r,s)},feedbackBuffers:{vCurrent:i[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:r}=this.settings,{time:i}=this.transition;let s=i/n;r&&(s=r(s)),this.transform.run({uniforms:{time:s}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const fU=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function dU(t,e){const n=gC(e.size);return new Kp(t,{vs:fU,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class gU{constructor({gl:e,attribute:n,timeline:r}){d(this,"gl",void 0),d(this,"type","spring"),d(this,"attributeInTransition",void 0),d(this,"settings",void 0),d(this,"attribute",void 0),d(this,"transition",void 0),d(this,"currentStartIndices",void 0),d(this,"currentLength",void 0),d(this,"texture",void 0),d(this,"framebuffer",void 0),d(this,"transform",void 0),d(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Fa(r),this.attribute=n,this.attributeInTransition=new rm(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=mU(e),this.framebuffer=_U(e,this.texture),this.transform=pU(e,n,this.framebuffer);const i={byteLength:0,usage:35050};this.buffers=[new ie(e,i),new ie(e,i),new ie(e,i)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:r,buffers:i,attribute:s}=this,o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of i)mC({buffer:a,...o});this.settings=e,this.currentStartIndices=s.startIndices,this.currentLength=nm(s,n),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:dC(r,s)}})}update(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this;if(!i.update())return!1;const o=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:o.stiffness,damping:o.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),pC(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Lu(r)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function pU(t,e,n){const r=gC(e.size);return new Kp(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function mU(t){return new st(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function _U(t,e){return new Fe(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const yU={interpolation:hU,spring:gU};class vU{constructor(e,{id:n,timeline:r}){d(this,"id",void 0),d(this,"isSupported",void 0),d(this,"gl",void 0),d(this,"timeline",void 0),d(this,"transitions",void 0),d(this,"needsRedraw",void 0),d(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Kp.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){if(!this.isSupported){X.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}i&&this._removeTransition(e);const o=yU[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,gl:this.gl}):(X.error("unsupported transition type '".concat(r.type,"'"))(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const rv="attributeManager.invalidate",AU="attributeManager.updateStart",EU="attributeManager.updateEnd",TU="attribute.updateStart",bU="attribute.allocate",CU="attribute.updateEnd";class SU{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){d(this,"id",void 0),d(this,"gl",void 0),d(this,"attributes",void 0),d(this,"updateTriggers",void 0),d(this,"needsRedraw",void 0),d(this,"userData",void 0),d(this,"stats",void 0),d(this,"attributeTransitionManager",void 0),d(this,"mergeBoundsMemoized",Oa(bD)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new vU(e,{id:"".concat(n,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);Ye(rv,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Ye(rv,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let l=!1;Ye(AU,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],h=u.settings.accessor;u.startIndices=r,u.numInstances=n,s[c]&&X.removed("props.".concat(c),"data.attributes.".concat(c))(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof h=="string"?o[h]:void 0,e.startIndices)||typeof h=="string"&&!o[h]&&u.setConstantValue(s[h])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&Ye(EU,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])===null||i===void 0?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const r={};for(const i in e)n[i]||Object.assign(r,e[i].getShaderAttributes());return r}_add(e,n={}){for(const r in e){const i=e[r];this.attributes[r]=this._createAttribute(r,i,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,r){const i={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:r.instanced?1:n.divisor||0};return new rm(this.gl,i)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(Ye(TU,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&Ye(bU,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,Ye(CU,n,r))}}class wU extends Fa{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=Kc(n,r,o)}}const iv=1e-5;function sv(t,e,n,r,i){const s=e-t,a=(n-e)*i,l=-s*r;return a+l+s+e}function xU(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=sv(t[o],e[o],n[o],r,i);return s}return sv(t,e,n,r,i)}function ov(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class PU extends Fa{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=xU(s,o,n,r,i);const l=ov(a,n),c=ov(a,o);l<iv&&c<iv&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const IU={interpolation:wU,spring:PU};class LU{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(i=fC(i),!i)return;const o=IU[i.type];if(!o){X.error("unsupported transition type '".concat(i.type,"'"))();return}const a=new o(this.timeline);a.start({...i,fromValue:n,toValue:r}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function MU(t){const e=t[jr];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function BU(t,e){const n=_C({newProps:t,oldProps:e,propTypes:t[jr],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=OU(t,e);let i=!1;return r||(i=FU(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:DU(t,e),transitionsChanged:RU(t,e)}}function RU(t,e){if(!t.transitions)return!1;const n={},r=t[jr];let i=!1;for(const s in t.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&qd(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function _C({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(i," changed shallowly");for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return"".concat(i,".").concat(s," added");const o=qd(t[s],e[s],r[s]);if(o)return"".concat(i,".").concat(s," ").concat(o)}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return"".concat(i,".").concat(s," dropped");if(!Object.hasOwnProperty.call(t,s)){const o=qd(t[s],e[s],r[s]);if(o)return"".concat(i,".").concat(s," ").concat(o)}}return!1}function qd(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function OU(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function FU(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&av(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&av(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function DU(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function av(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},_C({oldProps:i,newProps:r,triggerName:n})}const NU="count(): argument not an object",UU="count(): argument not a container";function kU(t){if(!zU(t))throw new Error(NU);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(GU(t))return Object.keys(t).length;throw new Error(UU)}function GU(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function zU(t){return t!==null&&typeof t=="object"}function VU(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const jU={10241:9987,10240:9729,10242:33071,10243:33071},Zd={};function HU(t,e,n,r){if(n instanceof st)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={10241:n.data.length>1?9985:9729});const s=new st(e,{...n,parameters:{...jU,...i,...r}});return Zd[s.id]=t,s}function WU(t,e){!e||!(e instanceof st)||Zd[e.id]===t&&(e.delete(),delete Zd[e.id])}const JU={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||$d(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Bn(t,e,1)}},accessor:{validate(t,e){const n=nu(t);return n==="function"||n===nu(e.value)},equal(t,e,n){return typeof e=="function"?!0:Bn(t,e,1)}},array:{validate(t,e){return e.optional&&!t||$d(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Bn(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Bn(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:r}=n.props;return r&&t?r(t):t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.gl?null:HU(n.id,r.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{WU(n.id,t)}}};function XU(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=KU(i,s);e[i]=a,n[i]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function KU(t,e){switch(nu(e)){case"object":return ho(t,e);case"array":return ho(t,{type:"array",value:e,compare:!1});case"boolean":return ho(t,{type:"boolean",value:e});case"number":return ho(t,{type:"number",value:e});case"function":return ho(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function ho(t,e){return"type"in e?{name:t,...JU[e.type],...e}:"value"in e?{name:t,type:nu(e.value),...e}:{name:t,type:"object",value:e}}function $d(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function nu(t){return $d(t)?"array":t===null?"null":typeof t}function YU(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=eg(t.constructor,n),i=Object.create(r);i[eu]=t,i[Ei]={},i[Br]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const QU="_mergedDefaultProps";function eg(t,e){let n=QU;if(e)for(const i of e){const s=i.constructor;s&&(n+=":".concat(s.extensionName||s.name))}const r=yC(t,n);return r||(t[n]=qU(t,e||[]))}function qU(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=eg(r),s=yC(t,"defaultProps")||{},o=XU(s),a=Object.assign(Object.create(null),i,o.defaultProps),l=Object.assign(Object.create(null),i==null?void 0:i[jr],o.propTypes),c=Object.assign(Object.create(null),i==null?void 0:i[$h],o.deprecatedProps);for(const u of e){const h=eg(u.constructor);h&&(Object.assign(a,h),Object.assign(l,h[jr]),Object.assign(c,h[$h]))}return ZU(a,t),ek(a,l),$U(a,c),a[jr]=l,a[$h]=c,e.length===0&&!im(t,"_propTypes")&&(t._propTypes=l),a}function ZU(t,e){const n=nk(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function $U(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i="".concat(this.id,": ").concat(n);for(const s of e[n])im(this,s)||(this[s]=r);X.deprecated(i,e[n].join("/"))()}})}function ek(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(n[o]=a,r[o]=tk(o))}t[ms]=n,t[Ei]={},Object.defineProperties(t,r)}function tk(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||uC(e)?this[Ei][t]=e:this[Br][t]=e},get(){if(this[Br]){if(t in this[Br])return this[Br][t]||this[ms][t];if(t in this[Ei]){const e=this[eu]&&this[eu].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[ms][t]}}return this[ms][t]}}}function im(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function yC(t,e){return im(t,e)&&t[e]}function nk(t){const e=t.componentName;return e||X.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let rk=0;class sm{constructor(...e){d(this,"id",void 0),d(this,"props",void 0),d(this,"count",void 0),this.props=YU(this,e),this.id=this.props.id,this.count=rk++}clone(e){const{props:n}=this,r={};for(const i in n[ms])i in n[Br]?r[i]=n[Br][i]:i in n[Ei]&&(r[i]=n[Ei][i]);return new this.constructor({...n,...r,...e})}}d(sm,"componentName","Component");d(sm,"defaultProps",{});const ik=Object.freeze({});class sk{constructor(e){d(this,"component",void 0),d(this,"onAsyncPropUpdated",void 0),d(this,"asyncProps",void 0),d(this,"oldProps",void 0),d(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||ik}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[eu]||this.component;const n=e[Br]||{},r=e[Ei]||e,i=e[ms]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(uC(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[jr];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class ok extends sk{constructor({attributeManager:e,layer:n}){super(n),d(this,"attributeManager",void 0),d(this,"needsRedraw",void 0),d(this,"needsUpdate",void 0),d(this,"subLayers",void 0),d(this,"usesPickingColorCache",void 0),d(this,"hasPickingBuffer",void 0),d(this,"changeFlags",void 0),d(this,"viewport",void 0),d(this,"uniformTransitions",void 0),d(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const ak="layer.changeFlag",lk="layer.initialize",ck="layer.update",uk="layer.finalize",hk="layer.matched",lv=2**24-1,fk=Object.freeze([]),dk=Oa(({oldViewport:t,viewport:e})=>t.equals(e));let Sn=new Uint8ClampedArray(0);const gk={data:{type:"data",value:fk,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;if(i=i||n.getLoadOptions(),r=r||n.props.loaders,s){var a;i={...i,fetch:{...(a=i)===null||a===void 0?void 0:a.fetch,signal:s}}}let l=o.contains(t);return!l&&!i&&(o.add({resourceId:t,data:or(t,r),persistent:!1}),l=!0),l?o.subscribe({resourceId:t,onChange:c=>{var u;return(u=n.internalState)===null||u===void 0?void 0:u.reloadAsyncProp(e,c)},consumerId:n.id,requestId:e}):or(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:K.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Ot extends sm{constructor(...e){super(...e),d(this,"internalState",null),d(this,"lifecycle",Hi.NO_STATE),d(this,"context",void 0),d(this,"state",void 0),d(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){ke(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=qb(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=Qb(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return ke(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){ke(this.internalState);const r=this.internalState.viewport||this.context.viewport;return Zb(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===K.DEFAULT||e===K.LNGLAT||e===K.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){ke(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:kU(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=VU(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=n.attributes,c=a||l;c&&(o&&c.constant&&(c.constant=!1,n.invalidate(c.id)),!c.value&&!o&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i;if(n&&(e=new Error("".concat(n,": ").concat(e.message),{cause:e})),!((r=(i=this.props).onError)!==null&&r!==void 0&&r.call(i,e))){var s,o;(s=this.context)===null||s===void 0||(o=s.onError)===null||o===void 0||o.call(s,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!dk({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(Sn.length/3);if(this.internalState.usesPickingColorCache=!0,r<n){n>lv&&X.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Sn=Bs.allocate(Sn,n,{size:3,copy:!0,maxCount:Math.max(n,lv)});const i=Math.floor(Sn.length/3),s=[];for(let o=r;o<i;o++)this.encodePickingColor(o,s),Sn[o*3+0]=s[0],Sn[o*3+1]=s[1],Sn[o*3+2]=s[2]}e.value=Sn.subarray(0,n*3)}_setModelAttributes(e,n){const r=this.getAttributeManager(),i=e.userData.excludeAttributes||{},s=r.getShaderAttributes(n,i);e.setAttributes(s)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,l=this.encodePickingColor(e);for(let c=0;c<n.length;c++){const u=s.getVertexOffset(c);a[u]===l[0]&&a[u+1]===l[1]&&a[u+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.subData({data:new Uint8Array(o-s),offset:s})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Sn.buffer&&(r.value=Sn.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){ke(!this.internalState),ke(Number.isFinite(this.props.coordinateSystem)),Ye(lk,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new ok({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(X.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new LU(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ye(hk,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ye(ck,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(r.gl)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Ye(uk,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const i=this.props,s=this.context;this.props=this.internalState.propsInTransition||i;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:a}=this.props,l=a&&a(n)||[0,0];lr(s.gl,{polygonOffset:l}),fn(s.gl,r,()=>{const c={moduleParameters:e,uniforms:n,parameters:r,context:s};for(const u of this.props.extensions)u.draw.call(this,c,u);this.draw(c)})}finally{this.props=i}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=n[i];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&Ye(ak,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const r=BU(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged){var i;this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)===null||i===void 0?void 0:i[s])}return this.setChangeFlags(r)}validateProps(){MU(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.pickingHighlightColor=r(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new SU(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==l){const c={};o||(c.pickingSelectedColor=null),Array.isArray(l)&&(c.pickingHighlightColor=l),(n||a!==i.highlightedObjectIndex)&&(c.pickingSelectedColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setModuleParameters(c)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}d(Ot,"defaultProps",gk);d(Ot,"layerName","Layer");const pk="compositeLayer.renderLayers";class Ru extends Ot{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,i)}return e}getSubLayerProps(e={}){var n;const{opacity:r,pickable:i,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:h,coordinateOrigin:f,wrapLongitude:g,positionFormat:p,modelMatrix:v,extensions:T,fetch:m,operation:_,_subLayerProps:y}=this.props,b={id:"",updateTriggers:{},opacity:r,pickable:i,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:h,coordinateOrigin:f,wrapLongitude:g,positionFormat:p,modelMatrix:v,extensions:T,fetch:m,operation:_},S=y&&e.id&&y[e.id],w=S&&S.updateTriggers,I=e.id||"sublayer";if(S){const L=this.props[jr],B=e.type?e.type._propTypes:{};for(const M in S){const G=B[M]||L[M];G&&G.type==="accessor"&&(S[M]=this.getSubLayerAccessor(S[M]))}}Object.assign(b,e,S),b.id="".concat(this.props.id,"-").concat(I),b.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...w};for(const L of T){const B=L.getSubLayerProps.call(this,L);B&&Object.assign(b,B,{updateTriggers:Object.assign(b.updateTriggers,B.updateTriggers)})}return b}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const s=this.renderLayers();r=em(s,Boolean),this.internalState.subLayers=r}Ye(pk,this,i,r);for(const s of r)s.parent=this}}d(Ru,"layerName","CompositeLayer");class vC{constructor(e){d(this,"opts",void 0),d(this,"typedArrayManager",void 0),d(this,"indexStarts",[0]),d(this,"vertexStarts",[0]),d(this,"vertexCount",0),d(this,"instanceCount",0),d(this,"attributes",void 0),d(this,"_attributeDefs",void 0),d(this,"data",void 0),d(this,"getGeometry",void 0),d(this,"geometryBuffer",void 0),d(this,"buffers",void 0),d(this,"positionSize",void 0),d(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=Bs,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:r={},getGeometry:i,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=n,this.getGeometry=i,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=r,this.normalize=l,s&&(ke(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),l||(r.positions=s)),this.geometryBuffer=r.positions,Array.isArray(a))for(const c of a)this._rebuildGeometry(c);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?hC(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:r,buffers:i,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in i)o.release(r[a]),r[a]=null;else{const l=s[a];l.copy=n,r[a]=o.allocate(r[a],e,l)}}_forEachGeometry(e,n,r){const{data:i,getGeometry:s}=this,{iterable:o,objectInfo:a}=Na(i,n,r);for(const l of o){a.index++;const c=s?s(l,a):null;e(c,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:r,instanceCount:i}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},c={};if(e||(n=[0],r=[0]),this.normalize||!o)this._forEachGeometry((h,f)=>{const g=h&&this.normalizeGeometry(h);c[f]=g,r[f+1]=r[f]+(g?this.getGeometrySize(g):0)},a,l),i=r[r.length-1];else if(r=s.startIndices,i=r[s.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof ie){const h=o.accessor.stride||this.positionSize*4;i=i||o.byteLength/h}else if(o.buffer){const h=o.stride||this.positionSize*4;i=i||o.buffer.byteLength/h}else if(o.value){const h=o.value,f=o.stride/h.BYTES_PER_ELEMENT||this.positionSize;i=i||h.length/f}this._allocate(i,!!e),this.indexStarts=n,this.vertexStarts=r,this.instanceCount=i;const u={};this._forEachGeometry((h,f)=>{const g=c[f]||h;u.vertexStart=r[f],u.indexStart=n[f];const p=f<r.length-1?r[f+1]:i;u.geometrySize=p-r[f],u.geometryIndex=f,this.updateGeometryAttributes(g,u)},a,l),this.vertexCount=n[n.length-1]}}const mk=typeof window<"u"?D.useLayoutEffect:D.useEffect,_k=mk;function ru(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const yk={position:"absolute",zIndex:-1};function AC(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>AC(n,e));if(Ou(t)){if(vk(t))return e.style=yk,D.cloneElement(t,e);if(Ak(t))return D.cloneElement(t,e)}return t}function Ou(t){return t&&typeof t=="object"&&"type"in t||!1}function vk(t){var e;return(e=t.props)===null||e===void 0?void 0:e.mapStyle}function Ak(t){const e=t.type;return e&&e.deckGLViewProps}function tg(t){if(typeof t=="function")return D.createElement(Os,{},t);if(Array.isArray(t))return t.map(tg);if(Ou(t)){if(t.type===D.Fragment)return tg(t.props.children);if(ru(t.type,Os))return t}return t}function Ek({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return D.Children.forEach(tg(t),o=>{if(Ou(o)){const a=o.type;if(ru(a,Ot)){const l=Tk(a,o.props);i.push(l)}else r.push(o);if(ru(a,Os)&&a!==Os&&o.props.id){const l=new a(o.props);s[l.id]=l}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function Tk(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}function bk({children:t,deck:e,ContextProvider:n}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let a=s,l=o;Ou(o)&&ru(o.type,Os)&&(a=o.props.id||s,l=o.props.children);const c=r.getViewport(a),u=r.getViewState(a);if(c){u.padding=c.padding;const{x:h,y:f,width:g,height:p}=c;l=AC(l,{x:h,y:f,width:g,height:p,viewport:c,viewState:u}),i[a]||(i[a]={viewport:c,children:[]}),i[a].children.push(l)}}return Object.keys(i).map(o=>{const{viewport:a,children:l}=i[o],{x:c,y:u,width:h,height:f}=a,g={position:"absolute",left:c,top:u,width:h,height:f},p="view-".concat(o),v=D.createElement("div",{key:p,id:p,style:g},...l);if(n){const T={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:m=>{m.viewId=o,e._onViewStateChange(m)}};return D.createElement(n,{key:p,value:T},v)}return v})}const Ck={mixBlendMode:null};function Sk({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in Ck?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function wk(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function EC(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function xk(t,e,n){const r=new e({...n,_customRender:i=>{t.redrawReason=i;const s=r.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():EC(t)}});return r}const TC=D.forwardRef((t,e)=>{const[n,r]=D.useState(0),s=D.useRef({control:null,version:n,forceUpdate:()=>r(S=>S+1)}).current,o=D.useRef(null),a=D.useRef(null),l=D.useMemo(()=>Ek(t),[t.layers,t.views,t.children]);let c=!0;const u=S=>{var w;return c&&t.viewState?(s.viewStateUpdateRequested=S,null):(s.viewStateUpdateRequested=null,(w=t.onViewStateChange)===null||w===void 0?void 0:w.call(t,S))},h=S=>{if(c)s.interactionStateUpdateRequested=S;else{var w;s.interactionStateUpdateRequested=null,(w=t.onInteractionStateChange)===null||w===void 0||w.call(t,S)}},f=D.useMemo(()=>{const S={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:u,onInteractionStateChange:h};return delete S._customRender,s.deck&&s.deck.setProps(S),S},[t]);D.useEffect(()=>{const S=t.Deck||Bu;return s.deck=xk(s,S,{...f,parent:o.current,canvas:a.current}),()=>{var w;return(w=s.deck)===null||w===void 0?void 0:w.finalize()}},[]),_k(()=>{EC(s);const{viewStateUpdateRequested:S,interactionStateUpdateRequested:w}=s;S&&u(S),w&&h(w)}),D.useImperativeHandle(e,()=>wk(s),[]);const g=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:p,width:v,height:T,id:m,style:_}=t,{containerStyle:y,canvasStyle:b}=D.useMemo(()=>Sk({width:v,height:T,style:_}),[v,T,_]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===g||s.version!==n){s.lastRenderedViewports=g,s.version=n;const S=bk({children:l.children,deck:s.deck,ContextProvider:p}),w=D.createElement("canvas",{key:"canvas",id:m||"deckgl-overlay",ref:a,style:b});s.control=D.createElement("div",{id:"".concat(m||"deckgl","-wrapper"),ref:o,style:y},[w,S])}return c=!1,s.control});TC.defaultProps=Bu.defaultProps;const Pk=TC,Ik=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  
    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  
  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(curr, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Lk=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,iu=[0,0,0,255],Mk={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:iu},getTargetColor:{type:"accessor",value:iu},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class om extends Ot{constructor(...e){super(...e),d(this,"state",void 0)}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Ik,fs:Lk,modules:[gr,pr]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:iu},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:iu},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e;if(i.extensionsChanged||i.propsChanged&&n.numSegments!==r.numSegments){var s;const{gl:o}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:r,widthMinPixels:i,widthMaxPixels:s,greatCircle:o,wrapLongitude:a}=this.props;this.state.model.setUniforms(e).setUniforms({greatCircle:o,widthUnits:ar[n],widthScale:r,widthMinPixels:i,widthMaxPixels:s,useShortestPath:a}).draw()}_getModel(e){const{id:n,numSegments:r}=this.props;let i=[];for(let o=0;o<r;o++)i=i.concat([o,1,0,o,-1,0]);const s=new Mt(e,{...this.getShaders(),id:n,geometry:new gn({drawMode:5,attributes:{positions:new Float32Array(i)}}),isInstanced:!0});return s.setUniforms({numSegments:r}),s}}d(om,"layerName","ArcLayer");d(om,"defaultProps",Mk);const Bk=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,Rk=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Ok=1024,Fk=4,cv=()=>{},uv={10241:9987,10240:9729,10242:33071,10243:33071};function Dk(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function Nk(t,e,n,r){const i=Math.min(n/e.width,r/e.height),s=Math.floor(e.width*i),o=Math.floor(e.height*i);return i===1?{data:e,width:s,height:o}:(t.canvas.height=o,t.canvas.width=s,t.clearRect(0,0,s,o),t.drawImage(e,0,0,e.width,e.height,0,0,s,o),{data:t.canvas,width:s,height:o})}function ga(t){return t&&(t.id||t.url)}function Uk(t,e,n,r){const i=t.width,s=t.height,o=new st(t.gl,{width:e,height:n,parameters:r});return ZB(t,o,{targetY:0,width:i,height:s}),t.delete(),o}function hv(t,e,n){for(let r=0;r<e.length;r++){const{icon:i,xOffset:s}=e[r],o=ga(i);t[o]={...i,x:s,y:n}}}function kk({icons:t,buffer:e,mapping:n={},xOffset:r=0,yOffset:i=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const c=t[l],u=ga(c);if(!n[u]){const{height:h,width:f}=c;r+f+e>o&&(hv(n,a,i),r=0,i=s+i+e,s=0,a=[]),a.push({icon:c,xOffset:r}),r=r+f+e,s=Math.max(s,h)}}return a.length>0&&hv(n,a,i),{mapping:n,rowHeight:s,xOffset:r,yOffset:i,canvasWidth:o,canvasHeight:Dk(s+i+e)}}function Gk(t,e,n){if(!t||!e)return null;n=n||{};const r={},{iterable:i,objectInfo:s}=Na(t);for(const o of i){s.index++;const a=e(o,s),l=ga(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!r[l]&&(!n[l]||a.url!==n[l].url)&&(r[l]={...a,source:o,sourceIndex:s.index})}return r}class zk{constructor(e,{onUpdate:n=cv,onError:r=cv}){d(this,"gl",void 0),d(this,"onUpdate",void 0),d(this,"onError",void 0),d(this,"_loadOptions",null),d(this,"_texture",null),d(this,"_externalTexture",null),d(this,"_mapping",{}),d(this,"_textureParameters",null),d(this,"_pendingCount",0),d(this,"_autoPacking",!1),d(this,"_xOffset",0),d(this,"_yOffset",0),d(this,"_rowHeight",0),d(this,"_buffer",Fk),d(this,"_canvasWidth",Ok),d(this,"_canvasHeight",0),d(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=r}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?ga(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:r,iconMapping:i,textureParameters:s}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),i&&(this._mapping=i),r){var o;(o=this._texture)===null||o===void 0||o.delete(),this._texture=null,this._externalTexture=r}s&&(this._textureParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(Gk(e,n,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:l}=kk({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=i,this._xOffset=s,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=new st(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||uv})),this._texture.height!==this._canvasHeight&&(this._texture=Uk(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||uv)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,or(r.url,this._loadOptions).then(i=>{const s=ga(r),o=this._mapping[s],{x:a,y:l,width:c,height:u}=o,{data:h,width:f,height:g}=Nk(n,i,c,u);this._texture.setSubImageData({data:h,x:a+(c-f)/2,y:l+(u-g)/2,width:f,height:g}),o.width=f,o.height=g,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const bC=[0,0,0,255],Vk={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:bC},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class Fu extends Ot{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return super.getShaders({vs:Bk,fs:Rk,modules:[gr,pr]})}initializeState(){this.state={iconManager:new zk(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:bC},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:c,textureParameters:u}=n,{iconManager:h}=this.state,f=o||this.internalState.isAsyncPropLoading("iconAtlas");if(h.setProps({loadOptions:n.loadOptions,autoPacking:!f,iconAtlas:o,iconMapping:f?a:null,textureParameters:u}),f?r.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&h.packIcons(l,c),i.extensionsChanged){var g;const{gl:p}=this.context;(g=this.state.model)===null||g===void 0||g.delete(),this.state.model=this._getModel(p),s.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,c=l.getTexture();c&&this.state.model.setUniforms(e).setUniforms({iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeUnits:ar[s],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,billboard:o,alphaCutoff:a}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new Mt(e,{...this.getShaders(),id:this.props.id,geometry:new gn({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const r=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;r?r(e):X.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:r,anchorX:i=n/2,anchorY:s=r/2}=this.state.iconManager.getIconMapping(e);return[n/2-i,r/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:r,width:i,height:s}=this.state.iconManager.getIconMapping(e);return[n,r,i,s]}}d(Fu,"defaultProps",Vk);d(Fu,"layerName","IconLayer");const jk=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Hk=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,CC=[0,0,0,255],SC=[0,0,1],Wk={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:SC},getColor:{type:"accessor",value:CC},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Jk(t){const{header:e,attributes:n}=t;!e||!n||(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}class am extends Ot{getShaders(){return super.getShaders({vs:jk,fs:Hk,modules:[gr,kb,pr]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:SC},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:CC}})}updateState(e){const{changeFlags:n,props:r}=e;if(super.updateState(e),n.extensionsChanged){var i;const{gl:s}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}n.dataChanged&&Jk(r.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:r}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:ar[r],radiusPixels:n}).draw()}_getModel(e){const n=[];for(let r=0;r<3;r++){const i=r/3*Math.PI*2;n.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new Mt(e,{...this.getShaders(),id:this.props.id,geometry:new gn({drawMode:4,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}d(am,"layerName","PointCloudLayer");d(am,"defaultProps",Wk);const Xk=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Kk=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (!filled) {
    discard;
  } else {
    gl_FragColor = vFillColor;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,fv=[0,0,0,255],Yk={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:fv},getLineColor:{type:"accessor",value:fv},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class lm extends Ot{getShaders(){return super.getShaders({vs:Xk,fs:Kk,modules:[gr,pr]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:r}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:h,lineWidthMinPixels:f,lineWidthMaxPixels:g}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:o?1:0,filled:a,billboard:l,antialiasing:c,radiusUnits:ar[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:ar[u],lineWidthScale:h,lineWidthMinPixels:f,lineWidthMaxPixels:g}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Mt(e,{...this.getShaders(),id:this.props.id,geometry:new gn({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}d(lm,"defaultProps",Yk);d(lm,"layerName","ScatterplotLayer");const wC={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function xC(t,e,n={}){return Qk(t,n)!==e?(Zk(t,n),!0):!1}function Qk(t,e={}){return Math.sign(qk(t,e))}function qk(t,e={}){const{start:n=0,end:r=t.length}=e,i=e.size||2;let s=0;for(let o=n,a=r-i;o<r;o+=i)s+=(t[o]-t[a])*(t[o+1]+t[a+1]),a=o;return s/2}function Zk(t,e){const{start:n=0,end:r=t.length,size:i=2}=e,s=(r-n)/i,o=Math.floor(s/2);for(let a=0;a<o;++a){const l=n+a*i,c=n+(s-1-a)*i;for(let u=0;u<i;++u){const h=t[l+u];t[l+u]=t[c+u],t[c+u]=h}}}function ln(t,e){const n=e.length,r=t.length;if(r>0){let i=!0;for(let s=0;s<n;s++)if(t[r-n+s]!==e[s]){i=!1;break}if(i)return!1}for(let i=0;i<n;i++)t[r+i]=e[i];return!0}function ng(t,e){const n=e.length;for(let r=0;r<n;r++)t[r]=e[r]}function pa(t,e,n,r,i=[]){const s=r+e*n;for(let o=0;o<n;o++)i[o]=t[s+o];return i}function rg(t,e,n,r,i=[]){let s,o;if(n&8)s=(r[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(r[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(r[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(r[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)i[a]=(o&1)===a?r[o]:s*(e[a]-t[a])+t[a];return i}function hc(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function PC(t,e){const{size:n=2,broken:r=!1,gridResolution:i=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let c=[];const u=[c],h=pa(t,0,n,o);let f,g;const p=LC(h,i,s,[]),v=[];ln(c,h);for(let T=1;T<l;T++){for(f=pa(t,T,n,o,f),g=hc(f,p);g;){rg(h,f,g,p,v);const m=hc(v,p);m&&(rg(h,v,m,p,v),g=m),ln(c,v),ng(h,v),eG(p,i,g),r&&c.length>n&&(c=[],u.push(c),ln(c,h)),g=hc(f,p)}ln(c,f),ng(h,f)}return r?u:u[0]}const dv=0,$k=1;function Il(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function IC(t,e=null,n){if(!t.length)return[];const{size:r=2,gridResolution:i=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:t,types:o?new Array(t.length/r).fill($k):null,holes:e||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:h,types:f,holes:g}=l.shift();tG(h,r,g[0]||h.length,c),u=LC(c[0],i,s,u);const p=hc(c[1],u);if(p){let v=gv(h,f,r,0,g[0]||h.length,u,p);const T={pos:v[0].pos,types:v[0].types,holes:[]},m={pos:v[1].pos,types:v[1].types,holes:[]};l.push(T,m);for(let _=0;_<g.length;_++)v=gv(h,f,r,g[_],g[_+1]||h.length,u,p),v[0]&&(T.holes.push(T.pos.length),T.pos=Il(T.pos,v[0].pos),o&&(T.types=Il(T.types,v[0].types))),v[1]&&(m.holes.push(m.pos.length),m.pos=Il(m.pos,v[1].pos),o&&(m.types=Il(m.types,v[1].types)))}else{const v={positions:h};o&&(v.edgeTypes=f),g.length&&(v.holeIndices=g),a.push(v)}}return a}function gv(t,e,n,r,i,s,o){const a=(i-r)/n,l=[],c=[],u=[],h=[],f=[];let g,p,v;const T=pa(t,a-1,n,r);let m=Math.sign(o&8?T[1]-s[3]:T[0]-s[2]),_=e&&e[a-1],y=0,b=0;for(let S=0;S<a;S++)g=pa(t,S,n,r,g),p=Math.sign(o&8?g[1]-s[3]:g[0]-s[2]),v=e&&e[r/n+S],p&&m&&m!==p&&(rg(T,g,o,s,f),ln(l,f)&&u.push(_),ln(c,f)&&h.push(_)),p<=0?(ln(l,g)&&u.push(v),y-=p):u.length&&(u[u.length-1]=dv),p>=0?(ln(c,g)&&h.push(v),b+=p):h.length&&(h[h.length-1]=dv),ng(T,g),m=p,_=v;return[y?{pos:l,types:e&&u}:null,b?{pos:c,types:e&&h}:null]}function LC(t,e,n,r){const i=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return r[0]=i,r[1]=s,r[2]=i+e,r[3]=s+e,r}function eG(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function tG(t,e,n,r){let i=1/0,s=-1/0,o=1/0,a=-1/0;for(let l=0;l<n;l+=e){const c=t[l],u=t[l+1];i=c<i?c:i,s=c>s?c:s,o=u<o?u:o,a=u>a?u:a}return r[0][0]=i,r[0][1]=o,r[1][0]=s,r[1][1]=a,r}const nG=85.051129;function rG(t,e){const{size:n=2,startIndex:r=0,endIndex:i=t.length,normalize:s=!0}=e||{},o=t.slice(r,i);MC(o,n,0,i-r);const a=PC(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)BC(l,n);return a}function iG(t,e=null,n){const{size:r=2,normalize:i=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let l=0,c=0;for(let h=0;h<=e.length;h++){const f=e[h]||t.length,g=c,p=sG(t,r,l,f);for(let v=p;v<f;v++)o[c++]=t[v];for(let v=l;v<p;v++)o[c++]=t[v];MC(o,r,g,c),oG(o,r,g,c,n==null?void 0:n.maxLatitude),l=f,a[h]=c}a.pop();const u=IC(o,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(i)for(const h of u)BC(h.positions,r);return u}function sG(t,e,n,r){let i=-1,s=-1;for(let o=n+1;o<r;o+=e){const a=Math.abs(t[o]);a>i&&(i=a,s=o-1)}return s}function oG(t,e,n,r,i=nG){const s=t[n],o=t[r-e];if(Math.abs(s-o)>180){const a=pa(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,ln(t,a),a[1]=Math.sign(a[1])*i,ln(t,a),a[0]=s,ln(t,a)}}function MC(t,e,n,r){let i=t[0],s;for(let o=n;o<r;o+=e){s=t[o];const a=s-i;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=i=s}}function BC(t,e){let n;const r=t.length/e;for(let s=0;s<r&&(n=t[s*e],(n+180)%360===0);s++);const i=-Math.round(n/360)*360;if(i!==0)for(let s=0;s<r;s++)t[s*e]+=i}function aG(t,e,n,r){let i;if(Array.isArray(t[0])){const s=t.length*e;i=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)i[o*e+a]=t[o][a]||0}else i=t;return n?PC(i,{size:e,gridResolution:n}):r?rG(i,{size:e}):i}const lG=1,cG=2,rf=4;class uG extends vC{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?aG(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(pv(e)){let r=0;for(const i of e)r+=this.getGeometrySize(i);return r}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&pv(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const r=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;r.fill(0,s,s+o),i?(r[s]=rf,r[s+o-2]=rf):(r[s]+=lG,r[s+o-2]+=cG),r[s+o-1]=rf}_updatePositions(e,n){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:i,geometrySize:s}=n,o=new Array(3);for(let a=i,l=0;l<s;a++,l++)this.getPointOnPath(e,l,o),r[a*3]=o[0],r[a*3+1]=o[1],r[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,r=[]){const{positionSize:i}=this;n*i>=e.length&&(n+=1-e.length/i);const s=n*i;return r[0]=e[s],r[1]=e[s+1],r[2]=i===3&&e[s+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,r=e.length-n;return e[0]===e[r]&&e[1]===e[r+1]&&(n===2||e[2]===e[r+2])}}function pv(t){return Array.isArray(t[0])}const hG=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,fG=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,RC=[0,0,0,255],dG={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:RC},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},sf={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class cm extends Ot{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return super.getShaders({vs:hG,fs:fG,modules:[gr,pr]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:sf,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:sf,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:sf,defaultValue:RC},instancePickingColors:{size:3,type:5121,accessor:(r,{index:i,target:s})=>this.encodePickingColor(r&&r.__source?r.__source.index:i,s)}}),this.setState({pathTesselator:new uG({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||i.invalidateAll()}if(r.extensionsChanged){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),i.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,{data:i}=this.props;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:r,billboard:i,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(r),billboard:i,widthUnits:ar[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:c}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Mt(e,{...this.getShaders(),id:this.props.id,geometry:new gn({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}d(cm,"defaultProps",dG);d(cm,"layerName","PathLayer");var um={exports:{}};um.exports=Du;um.exports.default=Du;function Du(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,s=OC(t,0,i,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,c,u,h,f,g;if(r&&(s=yG(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(var p=n;p<i;p+=n)h=t[p],f=t[p+1],h<a&&(a=h),f<l&&(l=f),h>c&&(c=h),f>u&&(u=f);g=Math.max(c-a,u-l),g=g!==0?32767/g:0}return ma(s,o,n,a,l,g,0),o}function OC(t,e,n,r,i){var s,o;if(i===og(t,e,n,r)>0)for(s=e;s<n;s+=r)o=mv(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=mv(s,t[s],t[s+1],o);return o&&Nu(o,o.next)&&(ya(o),o=o.next),o}function Ti(t,e){if(!t)return t;e||(e=t);var n=t,r;do if(r=!1,!n.steiner&&(Nu(n,n.next)||ye(n.prev,n,n.next)===0)){if(ya(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function ma(t,e,n,r,i,s,o){if(t){!o&&s&&bG(t,r,i,s);for(var a=t,l,c;t.prev!==t.next;){if(l=t.prev,c=t.next,s?pG(t,r,i,s):gG(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),ya(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=mG(Ti(t),e,n),ma(t,e,n,r,i,s,2)):o===2&&_G(t,e,n,r,i,s):ma(Ti(t),e,n,r,i,s,1);break}}}}function gG(t){var e=t.prev,n=t,r=t.next;if(ye(e,n,r)>=0)return!1;for(var i=e.x,s=n.x,o=r.x,a=e.y,l=n.y,c=r.y,u=i<s?i<o?i:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,f=i>s?i>o?i:o:s>o?s:o,g=a>l?a>c?a:c:l>c?l:c,p=r.next;p!==e;){if(p.x>=u&&p.x<=f&&p.y>=h&&p.y<=g&&os(i,a,s,l,o,c,p.x,p.y)&&ye(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function pG(t,e,n,r){var i=t.prev,s=t,o=t.next;if(ye(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,c=o.x,u=i.y,h=s.y,f=o.y,g=a<l?a<c?a:c:l<c?l:c,p=u<h?u<f?u:f:h<f?h:f,v=a>l?a>c?a:c:l>c?l:c,T=u>h?u>f?u:f:h>f?h:f,m=ig(g,p,e,n,r),_=ig(v,T,e,n,r),y=t.prevZ,b=t.nextZ;y&&y.z>=m&&b&&b.z<=_;){if(y.x>=g&&y.x<=v&&y.y>=p&&y.y<=T&&y!==i&&y!==o&&os(a,u,l,h,c,f,y.x,y.y)&&ye(y.prev,y,y.next)>=0||(y=y.prevZ,b.x>=g&&b.x<=v&&b.y>=p&&b.y<=T&&b!==i&&b!==o&&os(a,u,l,h,c,f,b.x,b.y)&&ye(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;y&&y.z>=m;){if(y.x>=g&&y.x<=v&&y.y>=p&&y.y<=T&&y!==i&&y!==o&&os(a,u,l,h,c,f,y.x,y.y)&&ye(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;b&&b.z<=_;){if(b.x>=g&&b.x<=v&&b.y>=p&&b.y<=T&&b!==i&&b!==o&&os(a,u,l,h,c,f,b.x,b.y)&&ye(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function mG(t,e,n){var r=t;do{var i=r.prev,s=r.next.next;!Nu(i,s)&&FC(i,r,r.next,s)&&_a(i,s)&&_a(s,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(s.i/n|0),ya(r),ya(r.next),r=t=s),r=r.next}while(r!==t);return Ti(r)}function _G(t,e,n,r,i,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&wG(o,a)){var l=DC(o,a);o=Ti(o,o.next),l=Ti(l,l.next),ma(o,e,n,r,i,s,0),ma(l,e,n,r,i,s,0);return}a=a.next}o=o.next}while(o!==t)}function yG(t,e,n,r){var i=[],s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*r,l=s<o-1?e[s+1]*r:t.length,c=OC(t,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(SG(c));for(i.sort(vG),s=0;s<i.length;s++)n=AG(i[s],n);return n}function vG(t,e){return t.x-e.x}function AG(t,e){var n=EG(t,e);if(!n)return e;var r=DC(n,t);return Ti(r,r.next),Ti(n,n.next)}function EG(t,e){var n=e,r=t.x,i=t.y,s=-1/0,o;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var a=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===r))return o}n=n.next}while(n!==e);if(!o)return null;var l=o,c=o.x,u=o.y,h=1/0,f;n=o;do r>=n.x&&n.x>=c&&r!==n.x&&os(i<u?r:s,i,c,u,i<u?s:r,i,n.x,n.y)&&(f=Math.abs(i-n.y)/(r-n.x),_a(n,t)&&(f<h||f===h&&(n.x>o.x||n.x===o.x&&TG(o,n)))&&(o=n,h=f)),n=n.next;while(n!==l);return o}function TG(t,e){return ye(t.prev,t,e.prev)<0&&ye(e.next,t,t.next)<0}function bG(t,e,n,r){var i=t;do i.z===0&&(i.z=ig(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,CG(i)}function CG(t){var e,n,r,i,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ,!!r);e++);for(l=c;a>0||l>0&&r;)a!==0&&(l===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,c*=2}while(o>1);return t}function ig(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function SG(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function os(t,e,n,r,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(i-o)*(r-a)}function wG(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!xG(t,e)&&(_a(t,e)&&_a(e,t)&&PG(t,e)&&(ye(t.prev,t,e.prev)||ye(t,e.prev,e))||Nu(t,e)&&ye(t.prev,t,t.next)>0&&ye(e.prev,e,e.next)>0)}function ye(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Nu(t,e){return t.x===e.x&&t.y===e.y}function FC(t,e,n,r){var i=Ml(ye(t,e,n)),s=Ml(ye(t,e,r)),o=Ml(ye(n,r,t)),a=Ml(ye(n,r,e));return!!(i!==s&&o!==a||i===0&&Ll(t,n,e)||s===0&&Ll(t,r,e)||o===0&&Ll(n,t,r)||a===0&&Ll(n,e,r))}function Ll(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Ml(t){return t>0?1:t<0?-1:0}function xG(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&FC(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function _a(t,e){return ye(t.prev,t,t.next)<0?ye(t,e,t.next)>=0&&ye(t,t.prev,e)>=0:ye(t,e,t.prev)<0||ye(t,t.next,e)<0}function PG(t,e){var n=t,r=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function DC(t,e){var n=new sg(t.i,t.x,t.y),r=new sg(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function mv(t,e,n,r){var i=new sg(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ya(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function sg(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Du.deviation=function(t,e,n,r){var i=e&&e.length,s=i?e[0]*n:t.length,o=Math.abs(og(t,0,s,n));if(i)for(var a=0,l=e.length;a<l;a++){var c=e[a]*n,u=a<l-1?e[a+1]*n:t.length;o-=Math.abs(og(t,c,u,n))}var h=0;for(a=0;a<r.length;a+=3){var f=r[a]*n,g=r[a+1]*n,p=r[a+2]*n;h+=Math.abs((t[f]-t[p])*(t[g+1]-t[f+1])-(t[f]-t[g])*(t[p+1]-t[f+1]))}return o===0&&h===0?0:Math.abs((h-o)/o)};function og(t,e,n,r){for(var i=0,s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}Du.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[i][s][o]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};var IG=um.exports;const LG=vg(IG),Bl=wC.CLOCKWISE,_v=wC.COUNTER_CLOCKWISE,Rr={isClosed:!0};function MG(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function xo(t){return"positions"in t?t.positions:t}function fc(t){return"holeIndices"in t?t.holeIndices:null}function BG(t){return Array.isArray(t[0])}function RG(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function OG(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function FG(t,e,n,r){for(let i=0;i<e;i++)if(t[n+i]!==t[r-e+i])return!1;return!0}function yv(t,e,n,r,i){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let l=0;l<r;l++)t[s++]=n[a][l]||0;if(!OG(n))for(let a=0;a<r;a++)t[s++]=n[0][a]||0;return Rr.start=e,Rr.end=s,Rr.size=r,xC(t,i,Rr),s}function vv(t,e,n,r,i=0,s,o){s=s||n.length;const a=s-i;if(a<=0)return e;let l=e;for(let c=0;c<a;c++)t[l++]=n[i+c];if(!FG(n,r,i,s))for(let c=0;c<r;c++)t[l++]=n[i+c];return Rr.start=e,Rr.end=l,Rr.size=r,xC(t,o,Rr),l}function DG(t,e){MG(t);const n=[],r=[];if("positions"in t){const{positions:i,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=vv(n,o,i,e,s[a-1],s[a],a===0?Bl:_v),r.push(o);return r.pop(),{positions:n,holeIndices:r}}t=i}if(!BG(t))return vv(n,0,t,e,0,n.length,Bl),n;if(!RG(t)){let i=0;for(const[s,o]of t.entries())i=yv(n,i,o,e,s===0?Bl:_v),r.push(i);return r.pop(),{positions:n,holeIndices:r}}return yv(n,0,t,e,Bl),n}function of(t,e,n){const r=t.length/3;let i=0;for(let s=0;s<r;s++){const o=(s+1)%r;i+=t[s*3+e]*t[o*3+n],i-=t[o*3+e]*t[s*3+n]}return Math.abs(i/2)}function Av(t,e,n,r){const i=t.length/3;for(let s=0;s<i;s++){const o=s*3,a=t[o+0],l=t[o+1],c=t[o+2];t[o+e]=a,t[o+n]=l,t[o+r]=c}}function NG(t,e,n,r){let i=fc(t);i&&(i=i.map(a=>a/e));let s=xo(t);const o=r&&e===3;if(n){const a=s.length;s=s.slice();const l=[];for(let c=0;c<a;c+=e){l[0]=s[c],l[1]=s[c+1],o&&(l[2]=s[c+2]);const u=n(l);s[c]=u[0],s[c+1]=u[1],o&&(s[c+2]=u[2])}}if(o){const a=of(s,0,1),l=of(s,0,2),c=of(s,1,2);if(!a&&!l&&!c)return[];a>l&&a>c||(l>c?(n||(s=s.slice()),Av(s,0,2,1)):(n||(s=s.slice()),Av(s,2,0,1)))}return LG(s,i,e)}class UG extends vC{constructor(e){const{fp64:n,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=DG(e,this.positionSize);return this.opts.resolution?IC(xo(n),fc(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?iG(xo(n),fc(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(Ev(e)){let n=0;for(const r of e)n+=this.getGeometrySize(r);return n}return xo(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&Ev(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:r,indexStart:i}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let l=s.indices;if(!l||!e)return;let c=i;const u=NG(e,this.positionSize,this.opts.preproject,this.opts.full3d);l=a.allocate(l,i+u.length,{copy:!0});for(let h=0;h<u.length;h++)l[c++]=u[h]+r;o[n+1]=i+u.length,s.indices=l}_updatePositions(e,{vertexStart:n,geometrySize:r}){const{attributes:{positions:i},positionSize:s}=this;if(!i||!e)return;const o=xo(e);for(let a=n,l=0;l<r;a++,l++){const c=o[l*s],u=o[l*s+1],h=s>2?o[l*s+2]:0;i[a*3]=c,i[a*3+1]=u,i[a*3+2]=h}}_updateVertexValid(e,{vertexStart:n,geometrySize:r}){const{positionSize:i}=this,s=this.attributes.vertexValid,o=e&&fc(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+r),o)for(let a=0;a<o.length;a++)s[n+o[a]/i-1]=0;s[n+r-1]=0}}function Ev(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const NC=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,kG=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(NC,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),GG=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(NC,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),zG=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,su=[0,0,0,255],VG={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:su},getLineColor:{type:"accessor",value:su},material:!0},Rl={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class hm extends Ot{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?kG:GG,fs:zG,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[gr,kb,pr]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:r}=this.props;const{_full3d:i}=this.props;n.isGeospatial&&r===K.DEFAULT&&(r=K.LNGLAT);let s;r===K.LNGLAT&&(i?s=n.projectPosition.bind(n):s=n.projectFlat.bind(n)),this.setState({numInstances:0,polygonTesselator:new UG({preproject:s,fp64:this.use64bitPositions(),IndexType:!e||Op(e,ae.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const o=this.getAttributeManager(),a=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:a},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:Rl,accessor:"getPolygon",update:this.calculatePositions,noAlloc:a,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:a},elevations:{size:1,transition:Rl,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Rl,accessor:"getFillColor",defaultValue:su,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Rl,accessor:"getLineColor",defaultValue:su,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(l,{index:c,target:u})=>this.encodePickingColor(l&&l.__source?l.__source.index:c,u),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,{data:i}=this.props;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:r,wireframe:i,elevationScale:s}=this.props,{topModel:o,sideModel:a,polygonTesselator:l}=this.state,c={...e,extruded:!!n,elevationScale:s};a&&(a.setInstanceCount(l.instanceCount-1),a.setUniforms(c),i&&(a.setDrawMode(3),a.setUniforms({isWireframe:!0}).draw()),r&&(a.setDrawMode(6),a.setUniforms({isWireframe:!1}).draw())),o&&(o.setVertexCount(l.vertexCount),o.setUniforms(c).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager();if(i.extensionsChanged||n.filled!==r.filled||n.extruded!==r.extruded){var a;(a=this.state.models)===null||a===void 0||a.forEach(l=>l.delete()),this.setState(this._getModels(this.context.gl)),s.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:r,extruded:i}=this.props;let s,o;if(r){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1,s=new Mt(e,{...a,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return i&&(o=new Mt(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new gn({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),o.userData.excludeAttributes={indices:!0}),{models:[o,s].filter(Boolean),topModel:s,sideModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}d(hm,"defaultProps",VG);d(hm,"layerName","SolidPolygonLayer");function jG({data:t,getIndex:e,dataRange:n,replace:r}){const{startRow:i=0,endRow:s=1/0}=n,o=t.length;let a=o,l=o;for(let f=0;f<o;f++){const g=e(t[f]);if(a>f&&g>=i&&(a=f),g>=s){l=f;break}}let c=a;const h=l-a!==r.length?t.slice(l):void 0;for(let f=0;f<r.length;f++)t[c++]=r[f];if(h){for(let f=0;f<h.length;f++)t[c++]=h[f];t.length=c}return{startRow:a,endRow:a+r.length}}function HG(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,r=t.featureIds.value[n];return n!==-1?WG(t,r,n):null}function WG(t,e,n){const r={properties:{...t.properties[e]}};for(const i in t.numericProps)r.properties[i]=t.numericProps[i].value[n];return r}function JG(t,e){const n={points:null,lines:null,polygons:null};for(const r in n){const i=t[r].globalFeatureIds.value;n[r]=new Uint8ClampedArray(i.length*3);const s=[];for(let o=0;o<i.length;o++)e(i[o],s),n[r][o*3+0]=s[0],n[r][o*3+1]=s[1],n[r][o*3+2]=s[2]}return n}const XG=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,af=192/256,Tv=[],KG={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class fm extends Fu{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:XG}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;let{outlineColor:i}=n;i!==r.outlineColor&&(i=i.map(s=>s/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!n.sdf&&n.outlineWidth&&X.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:r,outlineWidth:i}=this.props,{outlineColor:s}=this.state,o=i?Math.max(r,af*(1-i)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:af,outlineBuffer:o,gamma:r,sdf:!!n,outlineColor:s},super.draw(e),n&&i){const{iconManager:a}=this.state;a.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:af}})}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):Tv}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):Tv}}d(fm,"defaultProps",KG);d(fm,"layerName","MultiIconLayer");const jo=1e20;class YG{constructor({fontSize:e=24,buffer:n=3,radius:r=8,cutoff:i=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=n,this.cutoff=i,this.radius=r;const l=this.size=e+n*4,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${a} ${o} ${e}px ${s}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(r),l=0,c=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),u=Math.min(this.size-this.buffer,a+Math.ceil(i)),h=c+2*this.buffer,f=u+2*this.buffer,g=Math.max(h*f,0),p=new Uint8ClampedArray(g),v={data:p,width:h,height:f,glyphWidth:c,glyphHeight:u,glyphTop:a,glyphLeft:l,glyphAdvance:n};if(c===0||u===0)return v;const{ctx:T,buffer:m,gridInner:_,gridOuter:y}=this;T.clearRect(m,m,c,u),T.fillText(e,m,m+a);const b=T.getImageData(m,m,c,u);y.fill(jo,0,g),_.fill(0,0,g);for(let S=0;S<u;S++)for(let w=0;w<c;w++){const I=b.data[4*(S*c+w)+3]/255;if(I===0)continue;const L=(S+m)*h+w+m;if(I===1)y[L]=0,_[L]=jo;else{const B=.5-I;y[L]=B>0?B*B:0,_[L]=B<0?B*B:0}}bv(y,0,0,h,f,h,this.f,this.v,this.z),bv(_,m,m,c,u,h,this.f,this.v,this.z);for(let S=0;S<g;S++){const w=Math.sqrt(y[S])-Math.sqrt(_[S]);p[S]=Math.round(255-255*(w/this.radius+this.cutoff))}return v}}function bv(t,e,n,r,i,s,o,a,l){for(let c=e;c<e+r;c++)Cv(t,n*s+c,s,i,o,a,l);for(let c=n;c<n+i;c++)Cv(t,c*s+e,1,r,o,a,l)}function Cv(t,e,n,r,i,s,o){s[0]=0,o[0]=-jo,o[1]=jo,i[0]=t[e];for(let a=1,l=0,c=0;a<r;a++){i[a]=t[e+a*n];const u=a*a;do{const h=s[l];c=(i[a]-i[h]+u-h*h)/(a-h)/2}while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=jo}for(let a=0,l=0;a<r;a++){for(;o[l+1]<a;)l++;const c=s[l],u=a-c;t[e+a*n]=i[c]+u*u}}const QG=32,qG=[];function ZG(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function $G({characterSet:t,getFontWidth:e,fontHeight:n,buffer:r,maxCanvasWidth:i,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o;const u=n+r*2;for(const h of t)if(!s[h]){const f=e(h);c+f+r*2>i&&(c=0,l++),s[h]={x:c+r,y:a+l*u+r,width:f,height:u,layoutWidth:f,layoutHeight:n},c+=f+r*2}return{mapping:s,xOffset:c,yOffset:a+l*u,canvasHeight:ZG(a+(l+1)*u)}}function UC(t,e,n,r){let i=0;for(let o=e;o<n;o++){var s;const a=t[o];i+=((s=r[a])===null||s===void 0?void 0:s.layoutWidth)||0}return i}function kC(t,e,n,r,i,s){let o=e,a=0;for(let l=e;l<n;l++){const c=UC(t,l,l+1,i);a+c>r&&(o<l&&s.push(l),o=l,a=0),a+=c}return a}function e4(t,e,n,r,i,s){let o=e,a=e,l=e,c=0;for(let u=e;u<n;u++)if((t[u]===" "||t[u+1]===" "||u+1===n)&&(l=u+1),l>a){let h=UC(t,a,l,i);c+h>r&&(o<a&&(s.push(a),o=a,c=0),h>r&&(h=kC(t,a,l,r,i,s),o=s[s.length-1])),a=l,c+=h}return c}function t4(t,e,n,r,i=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?kC(t,i,s,n,r,o):e4(t,i,s,n,r,o),o}function n4(t,e,n,r,i,s){let o=0,a=0;for(let l=e;l<n;l++){const c=t[l],u=r[c];u?(a||(a=u.layoutHeight),i[l]=o+u.layoutWidth/2,o+=u.layoutWidth):(X.warn("Missing character: ".concat(c," (").concat(c.codePointAt(0),")"))(),i[l]=o,o+=QG)}s[0]=o,s[1]=a}function r4(t,e,n,r,i){const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),c=new Array(o),u=(n==="break-word"||n==="break-all")&&isFinite(r)&&r>0,h=[0,0],f=[0,0];let g=0,p=0,v=0;for(let m=0;m<=o;m++){const _=s[m];if((_===`
`||m===o)&&(v=m),v>p){const y=u?t4(s,n,r,i,p,v):qG;for(let b=0;b<=y.length;b++){const S=b===0?p:y[b-1],w=b<y.length?y[b]:v;n4(s,S,w,i,a,f);for(let I=S;I<w;I++){var T;const L=s[I],B=((T=i[L])===null||T===void 0?void 0:T.layoutOffsetY)||0;l[I]=g+f[1]/2+B,c[I]=f[0]}g=g+f[1]*e,h[0]=Math.max(h[0],f[0])}p=v}_===`
`&&(a[p]=0,l[p]=0,c[p]=0,p++)}return h[1]=g,{x:a,y:l,rowWidth:c,size:h}}function i4({value:t,length:e,stride:n,offset:r,startIndices:i,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=r?r/o:0,c=i[e]||Math.ceil((t.length-l)/a),u=s&&new Set,h=new Array(e);let f=t;if(a>1||l>0){const g=t.constructor;f=new g(c);for(let p=0;p<c;p++)f[p]=t[p*a+l]}for(let g=0;g<e;g++){const p=i[g],v=i[g+1]||c,T=f.subarray(p,v);h[g]=String.fromCodePoint.apply(null,T),u&&T.forEach(u.add,u)}if(u)for(const g of u)s.add(String.fromCodePoint(g));return{texts:h,characterCount:c}}class GC{constructor(e=5){d(this,"limit",void 0),d(this,"_cache",{}),d(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function s4(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const _s={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:s4(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},Sv=1024,wv=.9,xv=1.2,zC=3;let ou=new GC(zC);function o4(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const r=ou.get(t);if(!r)return n;for(const i in r.mapping)n.has(i)&&n.delete(i);return n}function a4(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function Pv(t,e,n,r){t.font="".concat(r," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function l4(t){X.assert(Number.isFinite(t)&&t>=zC,"Invalid cache limit"),ou=new GC(t)}class c4{constructor(){d(this,"props",{..._s}),d(this,"_key",void 0),d(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*xv+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=o4(this._key,this.props.characterSet),r=ou.get(this._key);if(r&&n.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(n,r);this._atlas=i,ou.set(this._key,i)}_generateFontAtlas(e,n){const{fontFamily:r,fontWeight:i,fontSize:s,buffer:o,sdf:a,radius:l,cutoff:c}=this.props;let u=n&&n.data;u||(u=document.createElement("canvas"),u.width=Sv);const h=u.getContext("2d",{willReadFrequently:!0});Pv(h,r,s,i);const{mapping:f,canvasHeight:g,xOffset:p,yOffset:v}=$G({getFontWidth:T=>h.measureText(T).width,fontHeight:s*xv,buffer:o,characterSet:e,maxCanvasWidth:Sv,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(u.height!==g){const T=h.getImageData(0,0,u.width,u.height);u.height=g,h.putImageData(T,0,0)}if(Pv(h,r,s,i),a){const T=new YG({fontSize:s,buffer:o,radius:l,cutoff:c,fontFamily:r,fontWeight:"".concat(i)});for(const m of e){const{data:_,width:y,height:b,glyphTop:S}=T.draw(m);f[m].width=y,f[m].layoutOffsetY=s*wv-S;const w=h.createImageData(y,b);a4(_,w),h.putImageData(w,f[m].x,f[m].y)}}else for(const T of e)h.fillText(T,f[T].x,f[T].y+o+s*wv);return{xOffset:p,yOffset:v,mapping:f,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:r,buffer:i,sdf:s,radius:o,cutoff:a}=this.props;return s?"".concat(e," ").concat(n," ").concat(r," ").concat(i," ").concat(o," ").concat(a):"".concat(e," ").concat(n," ").concat(r," ").concat(i)}}const u4=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,h4=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,f4={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class dm extends Ot{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return super.getShaders({vs:u4,fs:h4,modules:[gr,pr]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var r;const{gl:i}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:r,sizeUnits:i,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:!!a,padding:l,sizeUnits:ar[i],sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new Mt(e,{...this.getShaders(),id:this.props.id,geometry:new gn({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}d(dm,"defaultProps",f4);d(dm,"layerName","TextBackgroundLayer");const Iv={start:1,middle:0,end:-1},Lv={top:1,center:0,bottom:-1},lf=[0,0,0,255],d4=1,g4={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:lf},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:_s.characterSet},fontFamily:_s.fontFamily,fontWeight:_s.fontWeight,lineHeight:d4,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:lf},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:lf},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class gm extends Ru{constructor(...e){super(...e),d(this,"state",void 0),d(this,"getBoundingRect",(n,r)=>{let{size:[i,s]}=this.transformParagraph(n,r);const{fontSize:o}=this.state.fontAtlasManager.props;i/=o,s/=o;const{getTextAnchor:a,getAlignmentBaseline:l}=this.props,c=Iv[typeof a=="function"?a(n,r):a],u=Lv[typeof l=="function"?l(n,r):l];return[(c-1)*i/2,(u-1)*s/2,i,s]}),d(this,"getIconOffsets",(n,r)=>{const{getTextAnchor:i,getAlignmentBaseline:s}=this.props,{x:o,y:a,rowWidth:l,size:[c,u]}=this.transformParagraph(n,r),h=Iv[typeof i=="function"?i(n,r):i],f=Lv[typeof s=="function"?s(n,r):s],g=o.length,p=new Array(g*2);let v=0;for(let T=0;T<g;T++){const m=(1-h)*(c-l[T])/2;p[v++]=(h-1)*c/2+m+o[T],p[v++]=(f-1)*u/2+a[T]}return p})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new c4},this.props.maxWidth>0&&X.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==r.lineHeight||n.wordBreak!==r.wordBreak||n.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:r};if(!i.mapping)return i.setProps(o),!0;for(const a in o)if(o[a]!==i.props[a])return i.setProps(o),!0;return!1}_updateText(){var e;const{data:n,characterSet:r}=this.props,i=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:s}=this.props,o=n.startIndices,a;const l=r==="auto"&&new Set;if(i&&o){const{texts:c,characterCount:u}=i4({...ArrayBuffer.isView(i)?{value:i}:i,length:n.length,startIndices:o,characterSet:l});a=u,s=(h,{index:f})=>c[f]}else{const{iterable:c,objectInfo:u}=Na(n);o=[0],a=0;for(const h of c){u.index++;const f=Array.from(s(h,u)||"");l&&f.forEach(l.add,l),a+=f.length,o.push(a)}}this.setState({getText:s,startIndices:o,numInstances:a,characterSet:l||r})}transformParagraph(e,n){const{fontAtlasManager:r}=this.state,i=r.mapping,s=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:l}=this.props,c=s(e,n)||"";return r4(c,a,o,l*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:n,getText:r,fontAtlasManager:{scale:i,texture:s,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:c,getPosition:u,getColor:h,getSize:f,getAngle:g,getPixelOffset:p,getBackgroundColor:v,getBorderColor:T,getBorderWidth:m,backgroundPadding:_,background:y,billboard:b,fontSettings:S,outlineWidth:w,outlineColor:I,sizeScale:L,sizeUnits:B,sizeMinPixels:M,sizeMaxPixels:G,transitions:W,updateTriggers:j}=this.props,Y=this.getSubLayerClass("characters",fm),lt=this.getSubLayerClass("background",dm);return[y&&new lt({getFillColor:v,getLineColor:T,getLineWidth:m,padding:_,getPosition:u,getSize:f,getAngle:g,getPixelOffset:p,billboard:b,sizeScale:L,sizeUnits:B,sizeMinPixels:M,sizeMaxPixels:G,transitions:W&&{getPosition:W.getPosition,getAngle:W.getAngle,getSize:W.getSize,getFillColor:W.getBackgroundColor,getLineColor:W.getBorderColor,getLineWidth:W.getBorderWidth,getPixelOffset:W.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:j.getPosition,getAngle:j.getAngle,getSize:j.getSize,getFillColor:j.getBackgroundColor,getLineColor:j.getBorderColor,getLineWidth:j.getBorderWidth,getPixelOffset:j.getPixelOffset,getBoundingRect:{getText:j.getText,getTextAnchor:j.getTextAnchor,getAlignmentBaseline:j.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:c,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Y({sdf:S.sdf,smoothing:Number.isFinite(S.smoothing)?S.smoothing:_s.smoothing,outlineWidth:w/(S.radius||_s.radius),outlineColor:I,iconAtlas:s,iconMapping:o,getPosition:u,getColor:h,getSize:f,getAngle:g,getPixelOffset:p,billboard:b,sizeScale:L*i,sizeUnits:B,sizeMinPixels:M*i,sizeMaxPixels:G*i,transitions:W&&{getPosition:W.getPosition,getAngle:W.getAngle,getColor:W.getColor,getSize:W.getSize,getPixelOffset:W.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:j.getText,getPosition:j.getPosition,getAngle:j.getAngle,getColor:j.getColor,getSize:j.getSize,getPixelOffset:j.getPixelOffset,getIconOffsets:{getTextAnchor:j.getTextAnchor,getAlignmentBaseline:j.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:c,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){l4(e)}}d(gm,"defaultProps",g4);d(gm,"layerName","TextLayer");const dc={circle:{type:lm,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Fu,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:gm,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},gc={type:cm,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},ag={type:hm,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function fo({type:t,props:e}){const n={};for(const r in e)n[r]=t.defaultProps[e[r]];return n}function cf(t,e){const{transitions:n,updateTriggers:r}=t.props,i={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),i.updateTriggers[o]=r[s],n&&(i.transitions[o]=n[s])),i[o]=a}return i}function p4(t){if(Array.isArray(t))return t;switch(X.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return X.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function Mv(t,e,n={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:s=t.length}=n;for(let o=i;o<s;o++){const a=t[o],{geometry:l}=a;if(l)if(l.type==="GeometryCollection"){X.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");const{geometries:c}=l;for(let u=0;u<c.length;u++){const h=c[u];Bv(h,r,e,a,o)}}else Bv(l,r,e,a,o)}return r}function Bv(t,e,n,r,i){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=e;if(!_4(s,o)){X.warn("".concat(s," coordinates are malformed"))();return}switch(s){case"Point":a.push(n({geometry:t},r,i));break;case"MultiPoint":o.forEach(h=>{a.push(n({geometry:{type:"Point",coordinates:h}},r,i))});break;case"LineString":l.push(n({geometry:t},r,i));break;case"MultiLineString":o.forEach(h=>{l.push(n({geometry:{type:"LineString",coordinates:h}},r,i))});break;case"Polygon":c.push(n({geometry:t},r,i)),o.forEach(h=>{u.push(n({geometry:{type:"LineString",coordinates:h}},r,i))});break;case"MultiPolygon":o.forEach(h=>{c.push(n({geometry:{type:"Polygon",coordinates:h}},r,i)),h.forEach(f=>{u.push(n({geometry:{type:"LineString",coordinates:f}},r,i))})});break}}const m4={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function _4(t,e){let n=m4[t];for(X.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function VC(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Ol(t){return t.geometry.coordinates}function y4(t,e){const n=VC(),{pointFeatures:r,lineFeatures:i,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=r,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=Ol,n.lines.data=i,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=Ol,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=Ol,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=Ol,n}function v4(t,e){const n=VC(),{points:r,lines:i,polygons:s}=t,o=JG(t,e);return n.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:3,value:o.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:3,value:o.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const A4=["points","linestrings","polygons"],E4={...fo(dc.circle),...fo(dc.icon),...fo(dc.text),...fo(gc),...fo(ag),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class pm extends Ru{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:r}=this.props,i=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const r=v4(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:n}){const r=p4(e.data),i=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(n.dataChanged)){const l=this.state.features;for(const c in l)s[c]=l[c].slice(),o[c]=[];for(const c of n.dataChanged){const u=Mv(r,i,c);for(const h in l)o[h].push(jG({data:s[h],getIndex:f=>f.__source.index,dataRange:c,replace:u[h]}))}}else s=Mv(r,i);const a=y4(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r,sourceLayer:i}=n;return n.featureType=A4.find(s=>i.id.startsWith("".concat(this.id,"-").concat(s,"-"))),r>=0&&i.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[r]),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),r=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(n)===r&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:r}=this.state,i="polygons-fill",s=this.shouldRenderSubLayer(i,r.polygons.data)&&this.getSubLayerClass(i,ag.type);if(s){const o=cf(this,ag.props),a=e&&n;return a||delete o.getLineColor,o.updateTriggers.lineColors=a,new s(o,this.getSubLayerProps({id:i,updateTriggers:o.updateTriggers}),r.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:r}=this.state,i="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(i,r.polygonsOutline.data)&&this.getSubLayerClass(i,gc.type),a=this.shouldRenderSubLayer(s,r.lines.data)&&this.getSubLayerClass(s,gc.type);if(o||a){const l=cf(this,gc.props);return[o&&new o(l,this.getSubLayerProps({id:i,updateTriggers:l.updateTriggers}),r.polygonsOutline),a&&new a(l,this.getSubLayerProps({id:s,updateTriggers:l.updateTriggers}),r.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:r}=this.state;let{highlightedObjectIndex:i}=this.props;!r&&Number.isFinite(i)&&(i=n.points.data.findIndex(a=>a.__source.index===i));const s=new Set(e.split("+")),o=[];for(const a of s){const l="points-".concat(a),c=dc[a],u=c&&this.shouldRenderSubLayer(l,n.points.data)&&this.getSubLayerClass(l,c.type);if(u){const h=cf(this,c.props);let f=n.points;if(a==="text"&&r){const{instancePickingColors:g,...p}=f.data.attributes;f={...f,data:{...f.data,attributes:p}}}o.push(new u(h,this.getSubLayerProps({id:l,updateTriggers:h.updateTriggers,highlightedObjectIndex:i}),f))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),r=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&n,r,i,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(r,i)=>{const{data:s,index:o}=i,a=HG(s,o);return e(a,i)}}}d(pm,"layerName","GeoJsonLayer");d(pm,"defaultProps",E4);const St={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new x;new x;const go=new x,Rv=new x;class Ua{constructor(e=[0,0,0],n=0){d(this,"center",void 0),d(this,"radius",void 0),this.radius=-0,this.center=new x,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=go.from(n),this.center=new x().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Ua(this.center,this.radius)}union(e){const n=this.center,r=this.radius,i=e.center,s=e.radius,o=go.copy(i).subtract(n),a=o.magnitude();if(r>=a+s)return this.clone();if(s>=a+r)return e.clone();const l=(r+a+s)*.5;return Rv.copy(o).scale((-r+l)/a).add(n),this.center.copy(Rv),this.radius=l,this}expand(e){const r=go.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const n=r3(go,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const r=go.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const n=this.center,r=this.radius,s=e.normal.dot(n)+e.distance;return s<-r?St.OUTSIDE:s<r?St.INTERSECTING:St.INSIDE}}const T4=new x,b4=new x,Fl=new x,Dl=new x,Nl=new x,C4=new x,S4=new x,jn={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class ka{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){d(this,"center",void 0),d(this,"halfAxes",void 0),this.center=new x().from(e),this.halfAxes=new Se(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new x(e).len(),new x(n).len(),new x(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),i=new x(e).normalize(),s=new x(n).normalize(),o=new x(r).normalize();return new fa().fromMatrix3(new Se([...i,...s,...o]))}fromCenterHalfSizeQuaternion(e,n,r){const i=new fa(r),s=new Se().fromQuaternion(i);return s[0]=s[0]*n[0],s[1]=s[1]*n[0],s[2]=s[2]*n[0],s[3]=s[3]*n[1],s[4]=s[4]*n[1],s[5]=s[5]*n[1],s[6]=s[6]*n[2],s[7]=s[7]*n[2],s[8]=s[8]*n[2],this.center=new x().from(e),this.halfAxes=s,this}clone(){return new ka(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Ua){const n=this.halfAxes,r=n.getColumn(0,Fl),i=n.getColumn(1,Dl),s=n.getColumn(2,Nl),o=T4.copy(r).add(i).add(s);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const n=this.center,r=e.normal,i=this.halfAxes,s=r.x,o=r.y,a=r.z,l=Math.abs(s*i[jn.COLUMN0ROW0]+o*i[jn.COLUMN0ROW1]+a*i[jn.COLUMN0ROW2])+Math.abs(s*i[jn.COLUMN1ROW0]+o*i[jn.COLUMN1ROW1]+a*i[jn.COLUMN1ROW2])+Math.abs(s*i[jn.COLUMN2ROW0]+o*i[jn.COLUMN2ROW1]+a*i[jn.COLUMN2ROW2]),c=r.dot(n)+e.distance;return c<=-l?St.OUTSIDE:c>=l?St.INSIDE:St.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=b4.from(e).subtract(this.center),r=this.halfAxes,i=r.getColumn(0,Fl),s=r.getColumn(1,Dl),o=r.getColumn(2,Nl),a=i.magnitude(),l=s.magnitude(),c=o.magnitude();i.normalize(),s.normalize(),o.normalize();let u=0,h;return h=Math.abs(n.dot(i))-a,h>0&&(u+=h*h),h=Math.abs(n.dot(s))-l,h>0&&(u+=h*h),h=Math.abs(n.dot(o))-c,h>0&&(u+=h*h),u}computePlaneDistances(e,n,r=[-0,-0]){let i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,l=a.getColumn(0,Fl),c=a.getColumn(1,Dl),u=a.getColumn(2,Nl),h=C4.copy(l).add(c).add(u).add(o),f=S4.copy(h).subtract(e);let g=n.dot(f);return i=Math.min(g,i),s=Math.max(g,s),h.copy(o).add(l).add(c).subtract(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),h.copy(o).add(l).subtract(c).add(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),h.copy(o).add(l).subtract(c).subtract(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),o.copy(h).subtract(l).add(c).add(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),o.copy(h).subtract(l).add(c).subtract(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),o.copy(h).subtract(l).subtract(c).add(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),o.copy(h).subtract(l).subtract(c).subtract(u),f.copy(h).subtract(e),g=n.dot(f),i=Math.min(g,i),s=Math.max(g,s),r[0]=i,r[1]=s,r}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,Fl);n.transformAsPoint(e);const r=this.halfAxes.getColumn(1,Dl);r.transformAsPoint(e);const i=this.halfAxes.getColumn(2,Nl);return i.transformAsPoint(e),this.halfAxes=new Se([...n,...r,...i]),this}getTransform(){throw new Error("not implemented")}}const Ov=new x,Fv=new x;class sn{constructor(e=[0,0,1],n=0){d(this,"normal",void 0),d(this,"distance",void 0),this.normal=new x,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return on(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=Ov.from(e),this.normal.from(n).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,n,r,i){return this.normal.set(e,n,r),on(dn(this.normal.len(),1)),this.distance=i,this}clone(){return new sn(this.normal,this.distance)}equals(e){return dn(this.distance,e.distance)&&dn(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=Fv.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,n)}projectPointOntoPlane(e,n=[0,0,0]){e=Ov.from(e);const r=this.getPointDistance(e),i=Fv.copy(this.normal).scale(r);return e.subtract(i).to(n)}}const Dv=[new x([1,0,0]),new x([0,1,0]),new x([0,0,1])],Nv=new x,w4=new x;new sn(new x(1,0,0),0);class Ht{constructor(e=[]){d(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*Dv.length;const n=e.center,r=e.radius;let i=0;for(const s of Dv){let o=this.planes[i],a=this.planes[i+1];o||(o=this.planes[i]=new sn),a||(a=this.planes[i+1]=new sn);const l=Nv.copy(s).scale(-r).add(n);-s.dot(l),o.fromPointNormal(l,s);const c=Nv.copy(s).scale(r).add(n),u=w4.copy(s).negate();-u.dot(c),a.fromPointNormal(c,u),i+=2}return this}computeVisibility(e){let n=St.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case St.OUTSIDE:return St.OUTSIDE;case St.INTERSECTING:n=St.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(on(Number.isFinite(n),"parentPlaneMask is required."),n===Ht.MASK_OUTSIDE||n===Ht.MASK_INSIDE)return n;let r=Ht.MASK_INSIDE;const i=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&!(n&o))continue;const a=i[s],l=e.intersectPlane(a);if(l===St.OUTSIDE)return Ht.MASK_OUTSIDE;l===St.INTERSECTING&&(r|=o)}return r}}d(Ht,"MASK_OUTSIDE",4294967295);d(Ht,"MASK_INSIDE",0);d(Ht,"MASK_INDETERMINATE",2147483647);new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;const wn=new Se,x4=new Se,P4=new Se,Ul=new Se,Uv=new Se;function I4(t,e={}){const n=da.EPSILON20,r=10;let i=0,s=0;const o=x4,a=P4;o.identity(),a.copy(t);const l=n*L4(a);for(;s<r&&M4(a)>l;)B4(a,Ul),Uv.copy(Ul).transpose(),a.multiplyRight(Ul),a.multiplyLeft(Uv),o.multiplyRight(Ul),++i>2&&(++s,i=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function L4(t){let e=0;for(let n=0;n<9;++n){const r=t[n];e+=r*r}return Math.sqrt(e)}const lg=[1,0,0],cg=[2,2,1];function M4(t){let e=0;for(let n=0;n<3;++n){const r=t[wn.getElementIndex(cg[n],lg[n])];e+=2*r*r}return Math.sqrt(e)}function B4(t,e){const n=da.EPSILON15;let r=0,i=1;for(let c=0;c<3;++c){const u=Math.abs(t[wn.getElementIndex(cg[c],lg[c])]);u>r&&(i=c,r=u)}const s=lg[i],o=cg[i];let a=1,l=0;if(Math.abs(t[wn.getElementIndex(o,s)])>n){const c=t[wn.getElementIndex(o,o)],u=t[wn.getElementIndex(s,s)],h=t[wn.getElementIndex(o,s)],f=(c-u)/2/h;let g;f<0?g=-1/(-f+Math.sqrt(1+f*f)):g=1/(f+Math.sqrt(1+f*f)),a=1/Math.sqrt(1+g*g),l=g*a}return Se.IDENTITY.to(e),e[wn.getElementIndex(s,s)]=e[wn.getElementIndex(o,o)]=a,e[wn.getElementIndex(o,s)]=l,e[wn.getElementIndex(s,o)]=-l,e}const Cr=new x,R4=new x,O4=new x,F4=new x,D4=new x,N4=new Se,U4={diagonal:new Se,unitary:new Se};function k4(t,e=new ka){if(!t||t.length===0)return e.halfAxes=new Se([0,0,0,0,0,0,0,0,0]),e.center=new x,e;const n=t.length,r=new x(0,0,0);for(const B of t)r.add(B);const i=1/n;r.multiplyByScalar(i);let s=0,o=0,a=0,l=0,c=0,u=0;for(const B of t){const M=Cr.copy(B).subtract(r);s+=M.x*M.x,o+=M.x*M.y,a+=M.x*M.z,l+=M.y*M.y,c+=M.y*M.z,u+=M.z*M.z}s*=i,o*=i,a*=i,l*=i,c*=i,u*=i;const h=N4;h[0]=s,h[1]=o,h[2]=a,h[3]=o,h[4]=l,h[5]=c,h[6]=a,h[7]=c,h[8]=u;const{unitary:f}=I4(h,U4),g=e.halfAxes.copy(f);let p=g.getColumn(0,O4),v=g.getColumn(1,F4),T=g.getColumn(2,D4),m=-Number.MAX_VALUE,_=-Number.MAX_VALUE,y=-Number.MAX_VALUE,b=Number.MAX_VALUE,S=Number.MAX_VALUE,w=Number.MAX_VALUE;for(const B of t)Cr.copy(B),m=Math.max(Cr.dot(p),m),_=Math.max(Cr.dot(v),_),y=Math.max(Cr.dot(T),y),b=Math.min(Cr.dot(p),b),S=Math.min(Cr.dot(v),S),w=Math.min(Cr.dot(T),w);p=p.multiplyByScalar(.5*(b+m)),v=v.multiplyByScalar(.5*(S+_)),T=T.multiplyByScalar(.5*(w+y)),e.center.copy(p).add(v).add(T);const I=R4.set(m-b,_-S,y-w).multiplyByScalar(.5),L=new Se([I[0],0,0,0,I[1],0,0,0,I[2]]);return e.halfAxes.multiplyRight(L),e}const uf=Math.PI/180,kl=new Float32Array(16),kv=new Float32Array(12);function Gv(t,e,n){const r=e[0]*uf,i=e[1]*uf,s=e[2]*uf,o=Math.sin(s),a=Math.sin(r),l=Math.sin(i),c=Math.cos(s),u=Math.cos(r),h=Math.cos(i),f=n[0],g=n[1],p=n[2];t[0]=f*h*u,t[1]=f*l*u,t[2]=f*-a,t[3]=g*(-l*c+h*a*o),t[4]=g*(h*c+l*a*o),t[5]=g*u*o,t[6]=p*(l*o+h*a*c),t[7]=p*(-h*o+l*a*c),t[8]=p*u*c}function zv(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const jC={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:r,getOrientation:i,getScale:s,getTranslation:o,getTransformMatrix:a}=this.props,l=Array.isArray(a),c=l&&a.length===16,u=Array.isArray(s),h=Array.isArray(i),f=Array.isArray(o),g=c||!l&&!!a(r[0]);g?t.constant=c:t.constant=h&&u&&f;const p=t.value;if(t.constant){let v;g?(kl.set(a),v=zv(kl)):(v=kv,Gv(v,i,s),v.set(o,9)),t.value=new Float32Array(v)}else{let v=e*t.size;const{iterable:T,objectInfo:m}=Na(r,e,n);for(const _ of T){m.index++;let y;if(g)kl.set(c?a:a(_,m)),y=zv(kl);else{y=kv;const b=h?i:i(_,m),S=u?s:s(_,m);Gv(y,b,S),y.set(f?o:o(_,m),9)}p[v++]=y[0],p[v++]=y[1],p[v++]=y[2],p[v++]=y[3],p[v++]=y[4],p[v++]=y[5],p[v++]=y[6],p[v++]=y[7],p[v++]=y[8],p[v++]=y[9],p[v++]=y[10],p[v++]=y[11]}}}};function HC(t,e){return e===K.CARTESIAN||e===K.METER_OFFSETS||e===K.DEFAULT&&!t.isGeospatial}const G4=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,z4=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function WC(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],l=a&&a.length;for(let c=0;c<l;c+=3){const u=a[c],h=a[c+1],f=a[c+2];e=u<e?u:e,n=h<n?h:n,r=f<r?f:r,i=u>i?u:i,s=h>s?h:s,o=f>o?f:o}return[[e,n,r],[i,s,o]]}function V4(t,e){if(!t)throw new Error(e||"loader assertion failed.")}class as{constructor(e,n){d(this,"fields",void 0),d(this,"metadata",void 0),V4(Array.isArray(e)),j4(e),this.fields=e,this.metadata=n||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let n=0;n<this.fields.length;++n)if(!this.fields[n].compareTo(e.fields[n]))return!1;return!0}select(){const e=Object.create(null);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(const o of r)e[o]=!0;const s=this.fields.filter(o=>e[o.name]);return new as(s,this.metadata)}selectAt(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];const i=n.map(s=>this.fields[s]).filter(Boolean);return new as(i,this.metadata)}assign(e){let n,r=this.metadata;if(e instanceof as){const o=e;n=o.fields,r=Vv(Vv(new Map,this.metadata),o.metadata)}else n=e;const i=Object.create(null);for(const o of this.fields)i[o.name]=o;for(const o of n)i[o.name]=o;const s=Object.values(i);return new as(s,r)}}function j4(t){const e={};for(const n of t)e[n.name]&&console.warn("Schema: duplicated field name",n.name,n),e[n.name]=!0}function Vv(t,e){return new Map([...t||new Map,...e||new Map])}class au{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;d(this,"name",void 0),d(this,"type",void 0),d(this,"nullable",void 0),d(this,"metadata",void 0),this.name=e,this.type=n,this.nullable=r,this.metadata=i}get typeId(){return this.type&&this.type.typeId}clone(){return new au(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let be=function(t){return t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth",t}({}),JC,XC,KC;class mm{static isNull(e){return e&&e.typeId===be.Null}static isInt(e){return e&&e.typeId===be.Int}static isFloat(e){return e&&e.typeId===be.Float}static isBinary(e){return e&&e.typeId===be.Binary}static isUtf8(e){return e&&e.typeId===be.Utf8}static isBool(e){return e&&e.typeId===be.Bool}static isDecimal(e){return e&&e.typeId===be.Decimal}static isDate(e){return e&&e.typeId===be.Date}static isTime(e){return e&&e.typeId===be.Time}static isTimestamp(e){return e&&e.typeId===be.Timestamp}static isInterval(e){return e&&e.typeId===be.Interval}static isList(e){return e&&e.typeId===be.List}static isStruct(e){return e&&e.typeId===be.Struct}static isUnion(e){return e&&e.typeId===be.Union}static isFixedSizeBinary(e){return e&&e.typeId===be.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===be.FixedSizeList}static isMap(e){return e&&e.typeId===be.Map}static isDictionary(e){return e&&e.typeId===be.Dictionary}get typeId(){return be.NONE}compareTo(e){return this===e}}JC=Symbol.toStringTag;class Vs extends mm{constructor(e,n){super(),d(this,"isSigned",void 0),d(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=n}get typeId(){return be.Int}get[JC](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class H4 extends Vs{constructor(){super(!0,8)}}class W4 extends Vs{constructor(){super(!0,16)}}class J4 extends Vs{constructor(){super(!0,32)}}class X4 extends Vs{constructor(){super(!1,8)}}class K4 extends Vs{constructor(){super(!1,16)}}class Y4 extends Vs{constructor(){super(!1,32)}}const YC={HALF:16,SINGLE:32,DOUBLE:64};XC=Symbol.toStringTag;class QC extends mm{constructor(e){super(),d(this,"precision",void 0),this.precision=e}get typeId(){return be.Float}get[XC](){return"Float"}toString(){return"Float".concat(this.precision)}}class Q4 extends QC{constructor(){super(YC.SINGLE)}}class q4 extends QC{constructor(){super(YC.DOUBLE)}}KC=Symbol.toStringTag;class Z4 extends mm{constructor(e,n){super(),d(this,"listSize",void 0),d(this,"children",void 0),this.listSize=e,this.children=[n]}get typeId(){return be.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[KC](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function $4(t){switch(t.constructor){case Int8Array:return new H4;case Uint8Array:return new X4;case Int16Array:return new W4;case Uint16Array:return new K4;case Int32Array:return new J4;case Uint32Array:return new Y4;case Float32Array:return new Q4;case Float64Array:return new q4;default:throw new Error("array type not supported")}}function ez(t,e,n){const r=$4(e.value),i=n||tz(e);return new au(t,new Z4(e.size,new au("value",r)),!1,i)}function tz(t){const e=new Map;return"byteOffset"in t&&e.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&e.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&e.set("normalized",t.normalized.toString()),e}function jv(t,e){(t.COLOR_0||t.colors)&&e||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),X.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function Hv(t,e){if(t.attributes)return jv(t.attributes,e),t instanceof gn?t:new gn(t);if(t.positions||t.POSITION)return jv(t,e),new gn({attributes:t});throw Error("Invalid mesh")}const nz=[0,0,0,255],rz={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:nz},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class _m extends Ot{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){const e=!Q(this.context.gl),n={};return Rp(this.context.gl,ae.GLSL_DERIVATIVES)&&(n.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:G4,fs:z4,modules:[gr,Q3,pr],transpileToGLSL100:e,defines:n})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let n=this.state.positionBounds;if(n)return n;const{mesh:r}=this.props;if(!r)return null;if(n=(e=r.header)===null||e===void 0?void 0:e.boundingBox,!n){const{attributes:i}=Hv(r,this.props._useMeshColors);i.POSITION=i.POSITION||i.positions,n=WC(i)}return this.state.positionBounds=n,n}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:jC}),this.setState({emptyTexture:new st(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e;if(n.mesh!==r.mesh||i.extensionsChanged){var s;if(this.state.positionBounds=null,(s=this.state.model)===null||s===void 0||s.delete(),n.mesh){this.state.model=this.getModel(n.mesh);const o=n.mesh.attributes||n.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==r.texture&&this.setTexture(n.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){if(!this.state.model)return;const{viewport:n}=this.context,{sizeScale:r,coordinateSystem:i,_instanced:s}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:r,composeModelMatrix:!s||HC(n,i),flatShading:!this.state.hasNormals}).draw()}getModel(e){const n=new Mt(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:Hv(e,this.props._useMeshColors),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:i}=this.state;return n.setUniforms({sampler:r||i,hasTexture:!!r}),n}setTexture(e){const{emptyTexture:n,model:r}=this.state;r&&r.setUniforms({sampler:e||n,hasTexture:!!e})}}d(_m,"defaultProps",rz);d(_m,"layerName","SimpleMeshLayer");class ys{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n}=e;this.id=n||cr(this.constructor.name),this.display=!0,this.position=new x,this.rotation=new x,this.scale=new x(1,1,1),this.matrix=new Z,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(e){return N(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return N(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return N(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:n,rotation:r,scale:i,update:s=!0}=e;return n&&this.setPosition(n),r&&this.setRotation(r),i&&this.setScale(i),s&&this.updateMatrix(),this}updateMatrix(){const e=this.position,n=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(n),this.matrix.scale(r),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:n,rotation:r,scale:i}=e;return n&&this.setPosition(n),r&&this.setRotation(r),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,n){N(e),n=n||this.matrix;const r=new Z(e).multiplyRight(n),i=r.invert(),s=i.transpose();return{viewMatrix:e,modelMatrix:n,objectMatrix:n,worldMatrix:r,worldInverseMatrix:i,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Ho extends ys{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:n=[]}=e;V.assert(n.every(r=>r instanceof ys),"every child must an instance of ScenegraphNode"),super(e),this.children=n}add(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(const i of n)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(e){const n=this.children,r=n.indexOf(e);return r>-1&&n.splice(r,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((n,r)=>{let{worldMatrix:i}=r;const s=n.getBounds();if(!s)return;const[o,a]=s,l=new x(o).add(a).divide([2,2,2]);i.transformAsPoint(l,l);const c=new x(a).subtract(o).divide([2,2,2]);i.transformAsVector(c,c);for(let u=0;u<8;u++){const h=new x(u&1?-1:1,u&2?-1:1,u&4?-1:1).multiply(c).add(l);for(let f=0;f<3;f++)e[0][f]=Math.min(e[0][f],h[f]),e[1][f]=Math.max(e[1][f],h[f])}}),Number.isFinite(e[0][0])?e:null}traverse(e){let{worldMatrix:n=new Z}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new Z(n).multiplyRight(this.matrix);for(const i of this.children)i instanceof Ho?i.traverse(e,{worldMatrix:r}):e(i,{worldMatrix:r})}}const iz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},sz={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Wv(t){if(!t._animation){const e=sz[t.componentType],n=iz[t.type],r=n*t.count,{buffer:i,byteOffset:s}=t.bufferView.data,o=new e(i,s+(t.byteOffset||0),r);if(n===1)t._animation=Array.from(o);else{const a=[];for(let l=0;l<o.length;l+=n)a.push(Array.from(o.slice(l,l+n)));t._animation=a}}return t._animation}const oz=new Z;function az(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const n=oz.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}const hf=new fa;function lz(t,e,n,r,i){if(e==="rotation"){hf.slerp({start:n,target:r,ratio:i});for(let s=0;s<hf.length;s++)t[e][s]=hf[s]}else for(let s=0;s<n.length;s++)t[e][s]=i*r[s]+(1-i)*n[s]}function cz(t,e,n){let{p0:r,outTangent0:i,inTangent1:s,p1:o,tDiff:a,ratio:l}=n;for(let c=0;c<t[e].length;c++){const u=i[c]*a,h=s[c]*a;t[e][c]=(2*Math.pow(l,3)-3*Math.pow(l,2)+1)*r[c]+(Math.pow(l,3)-2*Math.pow(l,2)+l)*u+(-2*Math.pow(l,3)+3*Math.pow(l,2))*o[c]+(Math.pow(l,3)-Math.pow(l,2))*h}}function uz(t,e,n){for(let r=0;r<n.length;r++)t[e][r]=n[r]}function hz(t,e,n,r){let{input:i,interpolation:s,output:o}=e;const a=i[i.length-1],l=t%a,c=i.findIndex(g=>g>=l),u=Math.max(0,c-1);if(!Array.isArray(n[r]))switch(r){case"translation":n[r]=[0,0,0];break;case"rotation":n[r]=[0,0,0,1];break;case"scale":n[r]=[1,1,1];break;default:V.warn("Bad animation path ".concat(r))()}N(n[r].length===o[u].length);const h=i[u],f=i[c];switch(s){case"STEP":uz(n,r,o[u]);break;case"LINEAR":if(f>h){const g=(l-h)/(f-h);lz(n,r,o[u],o[c],g)}break;case"CUBICSPLINE":if(f>h){const g=(l-h)/(f-h),p=f-h,v=o[3*u+1],T=o[3*u+2],m=o[3*c+0],_=o[3*c+1];cz(n,r,{p0:v,outTangent0:T,inTangent1:m,p1:_,tDiff:p,ratio:g})}break;default:V.warn("Interpolation ".concat(s," not supported"))();break}}class fz{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const r=(e/1e3-this.startTime)*this.speed;this.channels.forEach(i=>{let{sampler:s,target:o,path:a}=i;hz(r,s,o,a),az(o,o._node)})}}class dz{constructor(e){this.animations=e.animations.map((n,r)=>{const i=n.name||"Animation-".concat(r),s=n.samplers.map(a=>{let{input:l,interpolation:c="LINEAR",output:u}=a;return{input:Wv(e.accessors[l]),interpolation:c,output:Wv(e.accessors[u])}}),o=n.channels.map(a=>{let{sampler:l,target:c}=a;return{sampler:s[l],target:e.nodes[c.node],path:c.path}});return new fz({name:i,channels:o})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(n=>n.animate(e))}getAnimations(){return this.animations}}class gz extends ys{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(n),this.onBeforeRender=null,this.AfterRender=null,e instanceof Mt?(this.model=e,this._setModelNodeProps(n)):this.model=new Mt(e,n),this.bounds=null,this.managedResources=n.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class qC{constructor(e,n){let{attributes:r,material:i,pbrDebug:s,imageBasedLightingEnvironment:o,lights:a,useTangents:l}=n;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},Rp(e,ae.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],o&&(this.uniforms.u_DiffuseEnvSampler=o.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=o.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=o.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),s&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(r.NORMAL,"HAS_NORMALS"),this.defineIfPresent(r.TANGENT&&l,"HAS_TANGENTS"),this.defineIfPresent(r.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(o,"USE_IBL"),this.defineIfPresent(a,"USE_LIGHTS"),this.defineIfPresent(s,"PBR_DEBUG"),i&&this.parseMaterial(i)}defineIfPresent(e,n){e&&(this.defines[n]=1)}parseTexture(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const i=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},s=e.texture.source.image;let o,a={};s.compressed?(o=s,a={[this.gl.TEXTURE_MIN_FILTER]:s.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):o={data:s};const l=new st(this.gl,{id:e.name||e.id,parameters:{...i,...a},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...o});this.uniforms[n]=l,this.defineIfPresent(r,r),this.generatedTextures.push(l)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:n=1,roughnessFactor:r=1}=e;this.uniforms.u_MetallicRoughnessValues=[n,r]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:n=1}=e.normalTexture;this.uniforms.u_NormalScale=n}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:n=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=n}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:n=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=n}else e.alphaMode==="BLEND"&&(V.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const pz=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,mz=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function Jv(t,e){return Q(t)?`#version 300 es
`.concat(e):e}function _z(t,e){const{id:n,drawMode:r,vertexCount:i,attributes:s,modelOptions:o}=e,a=new qC(t,e);V.info(4,"createGLTFModel defines: ",a.defines)();const l=[];l.push(...a.generatedTextures),l.push(...Object.values(s).map(u=>u.buffer));const c=new gz(t,{id:n,drawMode:r,vertexCount:i,modules:[Xp],parameters:a.parameters,vs:Jv(t,pz),fs:Jv(t,mz),managedResources:l,...o,defines:{...a.defines,...o.defines}});return c.setProps({attributes:s}),c.setUniforms(a.uniforms),c}const yz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vz={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class Az{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},vz,n)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new dz(this.gltf):null}createScene(e){const r=(e.nodes||[]).map(s=>this.createNode(s));return new Ho({id:e.name||e.id,children:r})}createNode(e){if(!e._node){const r=(e.children||[]).map(s=>this.createNode(s));e.mesh&&r.push(this.createMesh(e.mesh));const i=new Ho({id:e.name||e.id,children:r});if(e.matrix)i.setMatrix(e.matrix);else{if(i.matrix.identity(),e.translation&&i.matrix.translate(e.translation),e.rotation){const s=new Z().fromQuaternion(e.rotation);i.matrix.multiplyRight(s)}e.scale&&i.matrix.scale(e.scale)}e._node=i}return e._node}createMesh(e){if(!e._mesh){const r=(e.primitives||[]).map((s,o)=>this.createPrimitive(s,o,e)),i=new Ho({id:e.name||e.id,children:r});e._mesh=i}return e._mesh}getVertexCount(e){V.warn("getVertexCount() not found")()}createPrimitive(e,n,r){const i=_z(this.gl,Object.assign({id:e.name||"".concat(r.name||r.id,"-primitive-").concat(n),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return i.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],i}createAttributes(e,n){const r={};return Object.keys(e).forEach(i=>{r[i]=this.createAccessor(e[i],this.createBuffer(e[i],this.gl.ARRAY_BUFFER))}),n&&(r.indices=this.createAccessor(n,this.createBuffer(n,this.gl.ELEMENT_ARRAY_BUFFER))),V.info(4,"glTF Attributes",{attributes:e,indices:n,generated:r})(),r}createBuffer(e,n){e.bufferView||(e.bufferView={});const{bufferView:r}=e;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[n]||(r.lumaBuffers[n]=new ie(this.gl,{id:"from-".concat(r.id),data:r.data||e.value,target:n})),r.lumaBuffers[n]}createAccessor(e,n){return new ft({buffer:n,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:yz[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function Ez(t,e,n){const r=new Az(t,n),i=r.instantiate(e),s=r.createAnimator();return{scenes:i,animator:s}}const Tz="3.4.14",bz="3.4.14",ZC="3.4.14",Cz="https://unpkg.com/@loaders.gl/textures@".concat(ZC,"/dist/libs/basis_encoder.wasm"),Sz="https://unpkg.com/@loaders.gl/textures@".concat(ZC,"/dist/libs/basis_encoder.js");let ff;async function Xv(t){const e=t.modules||{};return e.basis?e.basis:(ff=ff||wz(t),await ff)}async function wz(t){let e=null,n=null;return[e,n]=await Promise.all([await di("basis_transcoder.js","textures",t),await di("basis_transcoder.wasm","textures",t)]),e=e||globalThis.BASIS,await xz(e,n)}function xz(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(i=>{const{BasisFile:s,initializeBasis:o}=i;o(),r({BasisFile:s})})})}let df;async function Kv(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(df=df||Pz(t),await df)}async function Pz(t){let e=null,n=null;return[e,n]=await Promise.all([await di(Sz,"textures",t),await di(Cz,"textures",t)]),e=e||globalThis.BASIS,await Iz(e,n)}function Iz(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(i=>{const{BasisFile:s,KTX2File:o,initializeBasis:a,BasisEncoder:l}=i;a(),r({BasisFile:s,KTX2File:o,BasisEncoder:l})})})}const zi={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},Lz=["","WEBKIT_","MOZ_"],Yv={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Gl=null;function Mz(t){if(!Gl){t=t||Bz()||void 0,Gl=new Set;for(const e of Lz)for(const n in Yv)if(t&&t.getExtension("".concat(e).concat(n))){const r=Yv[n];Gl.add(r)}}return Gl}function Bz(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var Qv,qv,Zv,$v,eA,tA,nA,rA;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(Qv||(Qv={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(qv||(qv={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(Zv||(Zv={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}($v||($v={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(eA||(eA={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(tA||(tA={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(nA||(nA={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(rA||(rA={}));const Et=[171,75,84,88,32,50,48,187,13,10,26,10];function Rz(t){const e=new Uint8Array(t);return!(e.byteLength<Et.length||e[0]!==Et[0]||e[1]!==Et[1]||e[2]!==Et[2]||e[3]!==Et[3]||e[4]!==Et[4]||e[5]!==Et[5]||e[6]!==Et[6]||e[7]!==Et[7]||e[8]!==Et[8]||e[9]!==Et[9]||e[10]!==Et[10]||e[11]!==Et[11])}const Oz={etc1:{basisFormat:0,compressed:!0,format:zi.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:zi.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:zi.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:zi.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:zi.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:zi.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Fz(t,e){if(e.basis.containerFormat==="auto"){if(Rz(t)){const r=await Kv(e);return iA(r.KTX2File,t,e)}const{BasisFile:n}=await Xv(e);return gf(n,t,e)}switch(e.basis.module){case"encoder":const n=await Kv(e);switch(e.basis.containerFormat){case"ktx2":return iA(n.KTX2File,t,e);case"basis":default:return gf(n.BasisFile,t,e)}case"transcoder":default:const{BasisFile:r}=await Xv(e);return gf(r,t,e)}}function gf(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const i=r.getNumImages(),s=[];for(let o=0;o<i;o++){const a=r.getNumLevels(o),l=[];for(let c=0;c<a;c++)l.push(Dz(r,o,c,n));s.push(l)}return s}finally{r.close(),r.delete()}}function Dz(t,e,n,r){const i=t.getImageWidth(e,n),s=t.getImageHeight(e,n),o=t.getHasAlpha(),{compressed:a,format:l,basisFormat:c}=$C(r,o),u=t.getImageTranscodedSizeInBytes(e,n,c),h=new Uint8Array(u);if(!t.transcodeImage(h,e,n,c,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:s,data:h,compressed:a,format:l,hasAlpha:o}}function iA(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=r.getLevels(),s=[];for(let o=0;o<i;o++){s.push(Nz(r,o,n));break}return[s]}finally{r.close(),r.delete()}}function Nz(t,e,n){const{alphaFlag:r,height:i,width:s}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:l}=$C(n,r),c=t.getImageTranscodedSizeInBytes(e,0,0,l),u=new Uint8Array(c);if(!t.transcodeImage(u,e,0,0,l,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:i,data:u,compressed:o,levelSize:c,hasAlpha:r,format:a}}function $C(t,e){let n=t&&t.basis&&t.basis.format;return n==="auto"&&(n=eS()),typeof n=="object"&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),Oz[n]}function eS(){const t=Mz();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const Uz={name:"Basis",id:er?"basis":"basis-nodejs",module:"textures",version:bz,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},kz={...Uz,parse:Fz};function xt(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function tS(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return r.substr(0,r.lastIndexOf("/")+1)+t}function Gz(t,e,n){const r=t.bufferViews[n];xt(r);const i=r.buffer,s=e[i];xt(s);const o=(r.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,o,r.byteLength)}const sA=["SCALAR","VEC2","VEC3","VEC4"],zz=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Vz=new Map(zz),jz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Hz={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Wz={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function nS(t){return sA[t-1]||sA[0]}function rS(t){const e=Vz.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function ym(t,e){const n=Wz[t.componentType],r=jz[t.type],i=Hz[t.componentType],s=t.count*r,o=t.count*r*i;return xt(o>=0&&o<=e.byteLength),{ArrayType:n,length:s,byteLength:o}}function iS(t){let{images:e,bufferViews:n}=t;e=e||[],n=n||[];const r=e.map(o=>o.bufferView);n=n.filter(o=>!r.includes(o));const i=n.reduce((o,a)=>o+a.byteLength,0),s=e.reduce((o,a)=>{const{width:l,height:c}=a.image;return o+l*c},0);return i+Math.ceil(4*s*1.33)}const Jz={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class yt{constructor(e){d(this,"gltf",void 0),d(this,"sourceBuffers",void 0),d(this,"byteLength",void 0),this.gltf=e||{json:{...Jz},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const n=this.getUsedExtensions().find(i=>i===e),r=this.json.extensions||{};return n?r[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,n){return(e.extensions||{})[n]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,n){if(typeof n=="object")return n;const r=this.json[e]&&this.json[e][n];if(!r)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(n,"]"));return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);const n=e.buffer,r=this.gltf.buffers[n];xt(r);const i=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),i=this.getBuffer(n.buffer).data,{ArrayType:s,length:o}=ym(e,n),a=n.byteOffset+e.byteOffset;return new s(i,a,o)}getTypedArrayForImageData(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),i=this.getBuffer(n.buffer).data,s=n.byteOffset||0;return new Uint8Array(i,s,n.byteLength)}addApplicationData(e,n){return this.json[e]=n,this}addExtraData(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}addObjectExtension(e,n,r){return e.extensions=e.extensions||{},e.extensions[n]=r,this.registerUsedExtension(n),this}setObjectExtension(e,n,r){const i=e.extensions||{};i[n]=r}removeObjectExtension(e,n){const r=e.extensions||{},i=r[n];return delete r[n],i}addExtension(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return xt(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}addRequiredExtension(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return xt(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:n}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(e){const{meshIndex:n,matrix:r}=e;this.json.nodes=this.json.nodes||[];const i={mesh:n};return r&&(i.matrix=r),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:n,indices:r,material:i,mode:s=4}=e,a={primitives:[{attributes:this._addAttributes(n),mode:s}]};if(r){const l=this._addIndices(r);a.primitives[0].indices=l}return Number.isFinite(i)&&(a.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,n){const r=Sp(e),i=n||(r==null?void 0:r.mimeType),o={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e){const n=e.byteLength;xt(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:0,byteOffset:this.byteLength,byteLength:n};return this.byteLength+=wa(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,n){const r={bufferView:e,type:nS(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const r=this.addBufferView(e);let i={min:n.min,max:n.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,n.size));const s={size:n.size,componentType:rS(e),count:Math.round(e.length/n.size),min:i.min,max:i.max};return this.addAccessor(r,Object.assign(s,n))}addTexture(e){const{imageIndex:n}=e,r={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,n;this.gltf.buffers=[];const r=this.byteLength,i=new ArrayBuffer(r),s=new Uint8Array(i);let o=0;for(const a of this.sourceBuffers||[])o=hI(a,s,o);(e=this.json)!==null&&e!==void 0&&(n=e.buffers)!==null&&n!==void 0&&n[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=i,this.sourceBuffers=[i]}_removeStringFromArray(e,n){let r=!0;for(;r;){const i=e.indexOf(n);i>-1?e.splice(i,1):r=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={};for(const r in e){const i=e[r],s=this._getGltfAttributeName(r),o=this.addBinaryBuffer(i.value,i);n[s]=o}return n}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,n){const r={min:null,max:null};if(e.length<n)return r;r.min=[],r.max=[];const i=e.subarray(0,n);for(const s of i)r.min.push(s),r.max.push(s);for(let s=n;s<e.length;s+=n)for(let o=0;o<n;o++)r.min[0+o]=Math.min(r.min[0+o],e[s+o]),r.max[0+o]=Math.max(r.max[0+o],e[s+o]);return r}}const Xz="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Kz="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Yz=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Qz=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),qz={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Zz={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function $z(t,e,n,r,i){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const o=await e6();r6(o,o.exports[Zz[i]],t,e,n,r,o.exports[qz[s||"NONE"]])}let pf;async function e6(){return pf||(pf=t6()),pf}async function t6(){let t=Xz;WebAssembly.validate(Yz)&&(t=Kz,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(n6(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function n6(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;++r){const i=t.charCodeAt(r);e[r]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let n=0;for(let r=0;r<t.length;++r)e[n++]=e[r]<60?Qz[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,n)}function r6(t,e,n,r,i,s,o){const a=t.exports.sbrk,l=r+3&-4,c=a(l*i),u=a(s.length),h=new Uint8Array(t.exports.memory.buffer);h.set(s,u);const f=e(c,r,i,u,s.length);if(f===0&&o&&o(c,l,i),n.set(h.subarray(c,c+r*i)),a(c-a(0)),f!==0)throw new Error("Malformed buffer data: ".concat(f))}const vm="EXT_meshopt_compression",i6=vm;async function s6(t,e){var n;const r=new yt(t);if(!(e!=null&&(n=e.gltf)!==null&&n!==void 0&&n.decompressMeshes))return;const i=[];for(const s of t.json.bufferViews||[])i.push(o6(r,s));await Promise.all(i),r.removeExtension(vm)}async function o6(t,e){const n=t.getObjectExtension(e,vm);if(n){const{byteOffset:r=0,byteLength:i=0,byteStride:s,count:o,mode:a,filter:l="NONE",buffer:c}=n,u=t.gltf.buffers[c],h=new Uint8Array(u.arrayBuffer,u.byteOffset+r,i),f=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await $z(f,o,s,h,a,l),f}return null}const a6=Object.freeze(Object.defineProperty({__proto__:null,decode:s6,name:i6},Symbol.toStringTag,{value:"Module"})),Wi="EXT_texture_webp",l6=Wi;function c6(t,e){const n=new yt(t);if(!fM("image/webp")){if(n.getRequiredExtensions().includes(Wi))throw new Error("gltf: Required extension ".concat(Wi," not supported by browser"));return}const{json:r}=n;for(const i of r.textures||[]){const s=n.getObjectExtension(i,Wi);s&&(i.source=s.source),n.removeObjectExtension(i,Wi)}n.removeExtension(Wi)}const u6=Object.freeze(Object.defineProperty({__proto__:null,name:l6,preprocess:c6},Symbol.toStringTag,{value:"Module"})),pc="KHR_texture_basisu",h6=pc;function f6(t,e){const n=new yt(t),{json:r}=n;for(const i of r.textures||[]){const s=n.getObjectExtension(i,pc);s&&(i.source=s.source),n.removeObjectExtension(i,pc)}n.removeExtension(pc)}const d6=Object.freeze(Object.defineProperty({__proto__:null,name:h6,preprocess:f6},Symbol.toStringTag,{value:"Module"})),g6="3.4.14",p6={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},m6={name:"Draco",id:er?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:g6,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:p6};function _6(t,e,n){const r=sS(e.metadata),i=[],s=y6(e.attributes);for(const o in t){const a=t[o],l=oA(o,a,s[o]);i.push(l)}if(n){const o=oA("indices",n);i.push(o)}return new as(i,r)}function y6(t){const e={};for(const n in t){const r=t[n];e[r.name||"undefined"]=r}return e}function oA(t,e,n){const r=n?sS(n.metadata):void 0;return ez(t,e,r)}function sS(t){const e=new Map;for(const n in t)e.set("".concat(n,".string"),JSON.stringify(t[n]));return e}const aA={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},v6={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},A6=4;class E6{constructor(e){d(this,"draco",void 0),d(this,"decoder",void 0),d(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);const i=this.decoder.GetEncodedGeometryType(r),s=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(i){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(r,s);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(r,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!s.ptr){const f="DRACO decompression failed: ".concat(o.error_msg());throw new Error(f)}const a=this._getDracoLoaderData(s,i,n),l=this._getMeshData(s,a,n),c=WC(l.attributes),u=_6(l.attributes,a,l.indices);return{loader:"draco",loaderData:a,header:{vertexCount:s.num_points(),boundingBox:c},...l,schema:u}}finally{this.draco.destroy(r),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,n,r){const i=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,r);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:s}}_getDracoAttributes(e,n){const r={};for(let i=0;i<e.num_attributes();i++){const s=this.decoder.GetAttribute(e,i),o=this._getAttributeMetadata(e,i);r[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:i,metadata:o};const a=this._getQuantizationTransform(s,n);a&&(r[s.unique_id()].quantization_transform=a);const l=this._getOctahedronTransform(s,n);l&&(r[s.unique_id()].octahedron_transform=l)}return r}_getMeshData(e,n,r){const i=this._getMeshAttributes(n,e,r);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,n,r){const i={};for(const s of Object.values(e.attributes)){const o=this._deduceAttributeName(s,r);s.name=o;const{value:a,size:l}=this._getAttributeValues(n,s);i[o]={value:a,size:l,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return i}_getTriangleListIndices(e){const r=e.num_faces()*3,i=r*A6,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,r).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),C6(n)}finally{this.draco.destroy(n)}}_getAttributeValues(e,n){const r=v6[n.data_type],i=n.num_components,o=e.num_points()*i,a=o*r.BYTES_PER_ELEMENT,l=T6(this.draco,r);let c;const u=this.draco._malloc(a);try{const h=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,h,l,a,u),c=new r(this.draco.HEAPF32.buffer,u,o).slice()}finally{this.draco._free(u)}return{value:c,size:i}}_deduceAttributeName(e,n){const r=e.unique_id;for(const[o,a]of Object.entries(n.extraAttributes||{}))if(a===r)return o;const i=e.attribute_type;for(const o in aA)if(this.draco[o]===i)return aA[o];const s=n.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:"CUSTOM_ATTRIBUTE_".concat(r)}_getTopLevelMetadata(e){const n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}_getAttributeMetadata(e,n){const r=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const n={},r=this.metadataQuerier.NumEntries(e);for(let i=0;i<r;i++){const s=this.metadataQuerier.GetEntryName(e,i);n[s]=this._getDracoMetadataField(e,s)}return n}_getDracoMetadataField(e,n){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,r);const i=b6(r);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:i}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:n=[],octahedronAttributes:r=[]}=e,i=[...n,...r];for(const s of i)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(e,n){const{quantizedAttributes:r=[]}=n,i=e.attribute_type();if(r.map(o=>this.decoder[o]).includes(i)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,n){const{octahedronAttributes:r=[]}=n,i=e.attribute_type();if(r.map(o=>this.decoder[o]).includes(i)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function T6(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function b6(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}function C6(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}const S6="1.5.5",Am="https://www.gstatic.com/draco/versioned/decoders/".concat(S6),w6="".concat(Am,"/draco_decoder.js"),x6="".concat(Am,"/draco_wasm_wrapper.js"),P6="".concat(Am,"/draco_decoder.wasm");let po;async function I6(t){const e=t.modules||{};return e.draco3d?po=po||e.draco3d.createDecoderModule({}).then(n=>({draco:n})):po=po||L6(t),await po}async function L6(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await di(w6,"draco",t);break;case"wasm":default:[e,n]=await Promise.all([await di(x6,"draco",t),await di(P6,"draco",t)])}return e=e||globalThis.DracoDecoderModule,await M6(e,n)}function M6(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t({...n,onModuleLoaded:i=>r({draco:i})})})}const oS={...m6,parse:B6};async function B6(t,e){const{draco:n}=await I6(e),r=new E6(n);try{return r.parseSync(t,e==null?void 0:e.draco)}finally{r.destroy()}}function R6(t){const e={};for(const n in t){const r=t[n];if(n!=="indices"){const i=aS(r);e[n]=i}}return e}function aS(t){const{buffer:e,size:n,count:r}=O6(t);return{value:e,size:n,byteOffset:0,count:r,type:nS(n),componentType:rS(e)}}function O6(t){let e=t,n=1,r=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=F6(e,Float32Array)),r=e.length/n),{buffer:e,size:n,count:r}}function F6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return t?Array.isArray(t)?new e(t):n&&!(t instanceof e)?new e(t):t:null}const bi="KHR_draco_mesh_compression",D6=bi;function N6(t,e,n){const r=new yt(t);for(const i of lS(r))r.getObjectExtension(i,bi)}async function U6(t,e,n){var r;if(!(e!=null&&(r=e.gltf)!==null&&r!==void 0&&r.decompressMeshes))return;const i=new yt(t),s=[];for(const o of lS(i))i.getObjectExtension(o,bi)&&s.push(G6(i,o,e,n));await Promise.all(s),i.removeExtension(bi)}function k6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new yt(t);for(const r of n.json.meshes||[])z6(r,e),n.addRequiredExtension(bi)}async function G6(t,e,n,r){const i=t.getObjectExtension(e,bi);if(!i)return;const s=t.getTypedArrayForBufferView(i.bufferView),o=mp(s.buffer,s.byteOffset),{parse:a}=r,l={...n};delete l["3d-tiles"];const c=await a(o,oS,l,r),u=R6(c.attributes);for(const[h,f]of Object.entries(u))if(h in e.attributes){const g=e.attributes[h],p=t.getAccessor(g);p!=null&&p.min&&p!==null&&p!==void 0&&p.max&&(f.min=p.min,f.max=p.max)}e.attributes=u,c.indices&&(e.indices=aS(c.indices)),V6(e)}function z6(t,e){var n;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=i.DracoWriter.encodeSync({attributes:t}),a=s==null||(n=s.parseSync)===null||n===void 0?void 0:n.call(s,{attributes:t}),l=i._addFauxAttributes(a.attributes),c=i.addBufferView(o);return{primitives:[{attributes:l,mode:r,extensions:{[bi]:{bufferView:c,attributes:l}}}]}}function V6(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*lS(t){for(const e of t.json.meshes||[])for(const n of e.primitives)yield n}const j6=Object.freeze(Object.defineProperty({__proto__:null,decode:U6,encode:k6,name:D6,preprocess:N6},Symbol.toStringTag,{value:"Module"})),H6={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},W6={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Em="KHR_texture_transform",J6=Em,zl=new x,X6=new Se,K6=new Se;async function Y6(t,e){if(!new yt(t).getExtension(Em))return;const i=t.json.materials||[];for(let s=0;s<i.length;s++)Q6(s,t)}function Q6(t,e){var n,r,i;const s=[],o=(n=e.json.materials)===null||n===void 0?void 0:n[t],a=o==null||(r=o.pbrMetallicRoughness)===null||r===void 0?void 0:r.baseColorTexture;a&&mo(e,t,a,s);const l=o==null?void 0:o.emissiveTexture;l&&mo(e,t,l,s);const c=o==null?void 0:o.normalTexture;c&&mo(e,t,c,s);const u=o==null?void 0:o.occlusionTexture;u&&mo(e,t,u,s);const h=o==null||(i=o.pbrMetallicRoughness)===null||i===void 0?void 0:i.metallicRoughnessTexture;h&&mo(e,t,h,s)}function mo(t,e,n,r){const i=q6(n,r);if(!i)return;const s=t.json.meshes||[];for(const o of s)for(const a of o.primitives){const l=a.material;Number.isFinite(l)&&e===l&&Z6(t,a,i)}}function q6(t,e){var n;const r=(n=t.extensions)===null||n===void 0?void 0:n[Em],{texCoord:i=0}=t,{texCoord:s=i}=r;if(!(e.findIndex(a=>{let[l,c]=a;return l===i&&c===s})!==-1)){const a=tV(r);return i!==s&&(t.texCoord=s),e.push([i,s]),{originalTexCoord:i,texCoord:s,matrix:a}}return null}function Z6(t,e,n){const{originalTexCoord:r,texCoord:i,matrix:s}=n,o=e.attributes["TEXCOORD_".concat(r)];if(Number.isFinite(o)){var a;const c=(a=t.json.accessors)===null||a===void 0?void 0:a[o];if(c&&c.bufferView){var l;const u=(l=t.json.bufferViews)===null||l===void 0?void 0:l[c.bufferView];if(u){const{arrayBuffer:h,byteOffset:f}=t.buffers[u.buffer],g=(f||0)+(c.byteOffset||0)+(u.byteOffset||0),{ArrayType:p,length:v}=ym(c,u),T=W6[c.componentType],m=H6[c.type],_=u.byteStride||T*m,y=new Float32Array(v);for(let b=0;b<c.count;b++){const S=new p(h,g+b*_,2);zl.set(S[0],S[1],1),zl.transformByMatrix3(s),y.set([zl[0],zl[1]],b*m)}r===i?$6(c,u,t.buffers,y):eV(i,c,e,t,y)}}}}function $6(t,e,n,r){t.componentType=5126,n.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=n.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function eV(t,e,n,r,i){r.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const s=r.json.bufferViews;if(!s)return;s.push({buffer:r.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const o=r.json.accessors;o&&(o.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),n.attributes["TEXCOORD_".concat(t)]=o.length-1)}function tV(t){const{offset:e=[0,0],rotation:n=0,scale:r=[1,1]}=t,i=new Se().set(1,0,0,0,1,0,e[0],e[1],1),s=X6.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),o=K6.set(r[0],0,0,0,r[1],0,0,0,1);return i.multiplyRight(s).multiplyRight(o)}const nV=Object.freeze(Object.defineProperty({__proto__:null,decode:Y6,name:J6},Symbol.toStringTag,{value:"Module"})),ui="KHR_lights_punctual",rV=ui;async function iV(t){const e=new yt(t),{json:n}=e,r=e.getExtension(ui);r&&(e.json.lights=r.lights,e.removeExtension(ui));for(const i of n.nodes||[]){const s=e.getObjectExtension(i,ui);s&&(i.light=s.light),e.removeObjectExtension(i,ui)}}async function sV(t){const e=new yt(t),{json:n}=e;if(n.lights){const r=e.addExtension(ui);xt(!r.lights),r.lights=n.lights,delete n.lights}if(e.json.lights){for(const r of e.json.lights){const i=r.node;e.addObjectExtension(i,ui,r)}delete e.json.lights}}const oV=Object.freeze(Object.defineProperty({__proto__:null,decode:iV,encode:sV,name:rV},Symbol.toStringTag,{value:"Module"})),va="KHR_materials_unlit",aV=va;async function lV(t){const e=new yt(t),{json:n}=e;for(const r of n.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,va);e.removeExtension(va)}function cV(t){const e=new yt(t),{json:n}=e;if(e.materials)for(const r of n.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,va,{}),e.addExtension(va))}const uV=Object.freeze(Object.defineProperty({__proto__:null,decode:lV,encode:cV,name:aV},Symbol.toStringTag,{value:"Module"})),Po="KHR_techniques_webgl",hV=Po;async function fV(t){const e=new yt(t),{json:n}=e,r=e.getExtension(Po);if(r){const i=gV(r,e);for(const s of n.materials||[]){const o=e.getObjectExtension(s,Po);o&&(s.technique=Object.assign({},o,i[o.technique]),s.technique.values=pV(s.technique,e)),e.removeObjectExtension(s,Po)}e.removeExtension(Po)}}async function dV(t,e){}function gV(t,e){const{programs:n=[],shaders:r=[],techniques:i=[]}=t,s=new TextDecoder;return r.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=s.decode(e.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(o=>{o.fragmentShader=r[o.fragmentShader],o.vertexShader=r[o.vertexShader]}),i.forEach(o=>{o.program=n[o.program]}),i}function pV(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(r=>{t.uniforms[r].value&&!(r in n)&&(n[r]=t.uniforms[r].value)}),Object.keys(n).forEach(r=>{typeof n[r]=="object"&&n[r].index!==void 0&&(n[r].texture=e.getTexture(n[r].index))}),n}const mV=Object.freeze(Object.defineProperty({__proto__:null,decode:fV,encode:dV,name:hV},Symbol.toStringTag,{value:"Module"})),cS="EXT_feature_metadata",_V=cS;async function yV(t){const e=new yt(t);vV(e)}function vV(t){var e;const n=t.getExtension(cS),r=n==null||(e=n.schema)===null||e===void 0?void 0:e.classes,i=n==null?void 0:n.featureTables;if((n==null?void 0:n.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),r&&i)for(const o in r){const a=r[o],l=TV(i,o);l&&AV(t,l,a)}}function AV(t,e,n){for(const i in n.properties){var r;const s=n.properties[i],o=e==null||(r=e.properties)===null||r===void 0?void 0:r[i],a=e.count;if(o){const l=EV(t,s,a,o);o.data=l}}}function EV(t,e,n,r){const i=r.bufferView;let s=t.getTypedArrayForBufferView(i);switch(e.type){case"STRING":{const o=r.stringOffsetBufferView,a=t.getTypedArrayForBufferView(o);s=bV(s,a,n);break}}return s}function TV(t,e){for(const n in t){const r=t[n];if(r.class===e)return r}return null}function bV(t,e,n){const r=[],i=new TextDecoder("utf8");let s=0;const o=4;for(let a=0;a<n;a++){const l=e[(a+1)*o]-e[a*o],c=t.subarray(s,l+s),u=i.decode(c);r.push(u),s+=l}return r}const CV=Object.freeze(Object.defineProperty({__proto__:null,decode:yV,name:_V},Symbol.toStringTag,{value:"Module"})),uS=[a6,u6,d6,j6,oV,uV,mV,nV,CV];function SV(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=uS.filter(s=>hS(s.name,e));for(const s of r){var i;(i=s.preprocess)===null||i===void 0||i.call(s,t,e,n)}}async function wV(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=uS.filter(s=>hS(s.name,e));for(const s of r){var i;await((i=s.decode)===null||i===void 0?void 0:i.call(s,t,e,n))}}function hS(t,e){var n;const r=(e==null||(n=e.gltf)===null||n===void 0?void 0:n.excludeExtensions)||{};return!(t in r&&!r[t])}const mf="KHR_binary_glTF";function xV(t){const e=new yt(t),{json:n}=e;for(const r of n.images||[]){const i=e.getObjectExtension(r,mf);i&&Object.assign(r,i),e.removeObjectExtension(r,mf)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(mf)}const lA={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},PV={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class IV{constructor(){d(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),d(this,"json",void 0)}normalize(e,n){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(r.asset.version));return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),xV(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const n in lA)this._convertTopLevelObjectToArray(e,n)}_convertTopLevelObjectToArray(e,n){const r=e[n];if(!(!r||Array.isArray(r))){e[n]=[];for(const i in r){const s=r[i];s.id=s.id||i;const o=e[n].length;e[n].push(s),this.idToIndexMap[n][i]=o}}}_convertObjectIdsToArrayIndices(e){for(const n in lA)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const n of e.textures)this._convertTextureIds(n);for(const n of e.meshes)this._convertMeshIds(n);for(const n of e.nodes)this._convertNodeIds(n);for(const n of e.scenes)this._convertSceneIds(n)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const n of e.primitives){const{attributes:r,indices:i,material:s}=n;for(const o in r)r[o]=this._convertIdToIndex(r[o],"accessor");i&&(n.indices=this._convertIdToIndex(i,"accessor")),s&&(n.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(n=>this._convertIdToIndex(n,"node"))),e.meshes&&(e.meshes=e.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(e,n){e[n]||(console.warn("gltf v1: json doesn't contain attribute ".concat(n)),e[n]=[]);for(const r of e[n])for(const i in r){const s=r[i],o=this._convertIdToIndex(s,i);r[i]=o}}_convertIdToIndex(e,n){const r=PV[n];if(r in this.idToIndexMap){const i=this.idToIndexMap[r][e];if(!Number.isFinite(i))throw new Error("gltf v1: failed to resolve ".concat(n," with id ").concat(e));return i}return e}_updateObjects(e){for(const n of this.json.buffers)delete n.type}_updateMaterial(e){for(const s of e.materials){var n,r,i;s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((n=s.values)===null||n===void 0?void 0:n.tex)||((r=s.values)===null||r===void 0?void 0:r.texture2d_0)||((i=s.values)===null||i===void 0?void 0:i.diffuseTex),a=e.textures.findIndex(l=>l.id===o);a!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:a})}}}function LV(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new IV().normalize(t,e)}const MV={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},BV={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ut={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},RV={magFilter:Ut.TEXTURE_MAG_FILTER,minFilter:Ut.TEXTURE_MIN_FILTER,wrapS:Ut.TEXTURE_WRAP_S,wrapT:Ut.TEXTURE_WRAP_T},OV={[Ut.TEXTURE_MAG_FILTER]:Ut.LINEAR,[Ut.TEXTURE_MIN_FILTER]:Ut.NEAREST_MIPMAP_LINEAR,[Ut.TEXTURE_WRAP_S]:Ut.REPEAT,[Ut.TEXTURE_WRAP_T]:Ut.REPEAT};function FV(t){return BV[t]}function DV(t){return MV[t]}class NV{constructor(){d(this,"baseUri",""),d(this,"json",{}),d(this,"buffers",[]),d(this,"images",[])}postProcess(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:r,buffers:i=[],images:s=[],baseUri:o=""}=e;return xt(r),this.baseUri=o,this.json=r,this.buffers=i,this.images=s,this._resolveTree(this.json,n),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map((n,r)=>this._resolveBufferView(n,r))),e.images&&(e.images=e.images.map((n,r)=>this._resolveImage(n,r))),e.samplers&&(e.samplers=e.samplers.map((n,r)=>this._resolveSampler(n,r))),e.textures&&(e.textures=e.textures.map((n,r)=>this._resolveTexture(n,r))),e.accessors&&(e.accessors=e.accessors.map((n,r)=>this._resolveAccessor(n,r))),e.materials&&(e.materials=e.materials.map((n,r)=>this._resolveMaterial(n,r))),e.meshes&&(e.meshes=e.meshes.map((n,r)=>this._resolveMesh(n,r))),e.nodes&&(e.nodes=e.nodes.map((n,r)=>this._resolveNode(n,r))),e.skins&&(e.skins=e.skins.map((n,r)=>this._resolveSkin(n,r))),e.scenes&&(e.scenes=e.scenes.map((n,r)=>this._resolveScene(n,r))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,n){if(typeof n=="object")return n;const r=this.json[e]&&this.json[e][n];return r||console.warn("glTF file error: Could not find ".concat(e,"[").concat(n,"]")),r}_resolveScene(e,n){return e.id=e.id||"scene-".concat(n),e.nodes=(e.nodes||[]).map(r=>this.getNode(r)),e}_resolveNode(e,n){return e.id=e.id||"node-".concat(n),e.children&&(e.children=e.children.map(r=>this.getNode(r))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((r,i)=>{const s=this.getMesh(i);return r.id=s.id,r.primitives=r.primitives.concat(s.primitives),r},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,n){return e.id=e.id||"skin-".concat(n),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,n){return e.id=e.id||"mesh-".concat(n),e.primitives&&(e.primitives=e.primitives.map(r=>{r={...r};const i=r.attributes;r.attributes={};for(const s in i)r.attributes[s]=this.getAccessor(i[s]);return r.indices!==void 0&&(r.indices=this.getAccessor(r.indices)),r.material!==void 0&&(r.material=this.getMaterial(r.material)),r})),e}_resolveMaterial(e,n){if(e.id=e.id||"material-".concat(n),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const r=e.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,n){if(e.id=e.id||"accessor-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=FV(e.componentType),e.components=DV(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const r=e.bufferView.buffer,{ArrayType:i,byteLength:s}=ym(e,e.bufferView),o=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+r.byteOffset;let a=r.arrayBuffer.slice(o,o+s);e.bufferView.byteStride&&(a=this._getValueFromInterleavedBuffer(r,o,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new i(a)}return e}_getValueFromInterleavedBuffer(e,n,r,i,s){const o=new Uint8Array(s*i);for(let a=0;a<s;a++){const l=n+a*r;o.set(new Uint8Array(e.arrayBuffer.slice(l,l+i)),a*i)}return o.buffer}_resolveTexture(e,n){return e.id=e.id||"texture-".concat(n),e.sampler="sampler"in e?this.getSampler(e.sampler):OV,e.source=this.getImage(e.source),e}_resolveSampler(e,n){e.id=e.id||"sampler-".concat(n),e.parameters={};for(const r in e){const i=this._enumSamplerParameter(r);i!==void 0&&(e.parameters[i]=e[r])}return e}_enumSamplerParameter(e){return RV[e]}_resolveImage(e,n){e.id=e.id||"image-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const r=this.images[n];return r&&(e.image=r),e}_resolveBufferView(e,n){const r=e.buffer,i={id:"bufferView-".concat(n),...e,buffer:this.buffers[r]},s=this.buffers[r].arrayBuffer;let o=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(o+=e.byteOffset),i.data=new Uint8Array(s,o,e.byteLength),i}_resolveCamera(e,n){return e.id=e.id||"camera-".concat(n),e.perspective,e.orthographic,e}}function UV(t,e){return new NV().postProcess(t,e)}const cA=1735152710,Tm=12,lu=8,kV=1313821514,GV=5130562,zV=0,VV=1,jV=0,Fs=!0;function HV(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}function WV(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new DataView(t),{magic:i=cA}=n,s=r.getUint32(e,!1);return s===i||s===cA}function JV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e),i=HV(r,n+0),s=r.getUint32(n+4,Fs),o=r.getUint32(n+8,Fs);switch(Object.assign(t,{header:{byteOffset:n,byteLength:o,hasBinChunk:!1},type:i,version:s,json:{},binChunks:[]}),n+=Tm,t.version){case 1:return XV(t,r,n);case 2:return KV(t,r,n,{});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}function XV(t,e,n){le(t.header.byteLength>Tm+lu);const r=e.getUint32(n+0,Fs),i=e.getUint32(n+4,Fs);return n+=lu,le(i===jV),ug(t,e,n,r),n+=r,n+=hg(t,e,n,t.header.byteLength),n}function KV(t,e,n,r){return le(t.header.byteLength>Tm+lu),YV(t,e,n,r),n+t.header.byteLength}function YV(t,e,n,r){for(;n+8<=t.header.byteLength;){const i=e.getUint32(n+0,Fs),s=e.getUint32(n+4,Fs);switch(n+=lu,s){case kV:ug(t,e,n,i);break;case GV:hg(t,e,n,i);break;case zV:r.strict||ug(t,e,n,i);break;case VV:r.strict||hg(t,e,n,i);break}n+=wa(i,4)}return n}function ug(t,e,n,r){const i=new Uint8Array(e.buffer,n,r),o=new TextDecoder("utf8").decode(i);return t.json=JSON.parse(o),wa(r,4)}function hg(t,e,n,r){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:r,arrayBuffer:e.buffer}),wa(r,4)}async function QV(t,e){var n,r,i,s;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;qV(t,e,o,a),LV(t,{normalize:a==null||(n=a.gltf)===null||n===void 0?void 0:n.normalize}),SV(t,a,l);const c=[];if(a!=null&&(r=a.gltf)!==null&&r!==void 0&&r.loadBuffers&&t.json.buffers&&await ZV(t,a,l),a!=null&&(i=a.gltf)!==null&&i!==void 0&&i.loadImages){const h=$V(t,a,l);c.push(h)}const u=wV(t,a,l);return c.push(u),await Promise.all(c),a!=null&&(s=a.gltf)!==null&&s!==void 0&&s.postProcess?UV(t,a):t}function qV(t,e,n,r){if(r.uri&&(t.baseUri=r.uri),e instanceof ArrayBuffer&&!WV(e,n,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=lI(e);else if(e instanceof ArrayBuffer){const o={};n=JV(o,e,n,r.glb),xt(o.type==="glTF","Invalid GLB magic string ".concat(o.type)),t._glb=o,t.json=o.json}else xt(!1,"GLTF: must be ArrayBuffer or string");const i=t.json.buffers||[];if(t.buffers=new Array(i.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:o}=t._glb;t.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const s=t.json.images||[];t.images=new Array(s.length).fill({})}async function ZV(t,e,n){const r=t.json.buffers||[];for(let o=0;o<r.length;++o){const a=r[o];if(a.uri){var i,s;const{fetch:l}=n;xt(l);const c=tS(a.uri,e),u=await(n==null||(i=n.fetch)===null||i===void 0?void 0:i.call(n,c)),h=await(u==null||(s=u.arrayBuffer)===null||s===void 0?void 0:s.call(u));t.buffers[o]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete a.uri}else t.buffers[o]===null&&(t.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function $V(t,e,n){const r=e9(t),i=t.json.images||[],s=[];for(const o of r)s.push(t9(t,i[o],o,e,n));return await Promise.all(s)}function e9(t){const e=new Set,n=t.json.textures||[];for(const r of n)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function t9(t,e,n,r,i){const{fetch:s,parse:o}=i;let a;if(e.uri&&!e.hasOwnProperty("bufferView")){const c=tS(e.uri,r);a=await(await s(c)).arrayBuffer(),e.bufferView={data:a}}if(Number.isFinite(e.bufferView)){const c=Gz(t.json,t.buffers,e.bufferView);a=mp(c.buffer,c.byteOffset,c.byteLength)}xt(a,"glTF image has no data");let l=await o(a,[GT,kz],{mimeType:e.mimeType,basis:r.basis||{format:eS()}},i);l&&l[0]&&(l={compressed:!0,mipmaps:!1,width:l[0].width,height:l[0].height,data:l[0]}),t.images=t.images||[],t.images[n]=l}const Aa={name:"glTF",id:"gltf",module:"gltf",version:Tz,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:n9,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function n9(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;e={...Aa.options,...e},e.gltf={...Aa.options.gltf,...e.gltf};const{byteOffset:r=0}=e;return await QV({},t,r,e,n)}async function r9(t){const e=[];return t.scenes.forEach(n=>{n.traverse(r=>{Object.values(r.model.getUniforms()).forEach(i=>{i.loaded===!1&&e.push(i)})})}),await i9(()=>e.some(n=>!n.loaded))}async function i9(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const s9=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,o9=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,fS=[255,255,255,255],a9={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:fS},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Aa]};class bm extends Ot{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){const e=[gr,pr];return this.props._lighting==="pbr"&&e.push(Xp),super.getShaders({vs:s9,fs:o9,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:fS,transition:!0},instanceModelMatrix:jC})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;n.scenegraph!==r.scenegraph?this._updateScenegraph():n._animations!==r._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,n._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}_updateScenegraph(){const e=this.props,{gl:n}=this.context;let r=null;if(e.scenegraph instanceof ys)r={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const a=e.scenegraph,l=Ez(n,a,this._getModelOptions());r={gltf:a,...l},r9(l).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(X.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),r=e.scenegraph);const i={layer:this,gl:n},s=e.getScene(r,i),o=e.getAnimator(r,i);s instanceof ys?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,o,e._animations),this.setState({scenegraph:s,animator:o})):s!==null&&X.warn("invalid scenegraph:",s)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const n=this.getAttributeManager().getAttributes();e.traverse(r=>{this._setModelAttributes(r.model,n)})}}_applyAnimationsProp(e,n,r){if(!e||!n||!r)return;const i=n.getAnimations();Object.keys(r).sort().forEach(s=>{const o=r[s];if(s==="*")i.forEach(a=>{Object.assign(a,o)});else if(Number.isFinite(Number(s))){const a=Number(s);a>=0&&a<i.length?Object.assign(i[a],o):X.warn("animation ".concat(s," not found"))()}else{const a=i.find(({name:l})=>l===s);a?Object.assign(a,o):X.warn("animation ".concat(s," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof ys&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let n=null;return e&&(typeof e=="function"?n=e({gl:this.context.gl,layer:this}):n=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:n,modelOptions:{isInstanced:!0,transpileToGLSL100:!Q(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(n=>{this._setModelAttributes(n.model,e)})}draw({moduleParameters:e=null,parameters:n={},context:r}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(r.timeline.getTime()),this.setNeedsRedraw());const{viewport:i}=this.context,{sizeScale:s,sizeMinPixels:o,sizeMaxPixels:a,opacity:l,coordinateSystem:c}=this.props,u=this.getNumInstances();this.state.scenegraph.traverse((h,{worldMatrix:f})=>{h.model.setInstanceCount(u),h.updateModuleSettings(e),h.draw({parameters:n,uniforms:{sizeScale:s,opacity:l,sizeMinPixels:o,sizeMaxPixels:a,composeModelMatrix:HC(i,c),sceneModelMatrix:f,u_Camera:h.model.getUniforms().project_uCameraPosition}})})}}d(bm,"defaultProps",a9);d(bm,"layerName","ScenegraphLayer");const l9=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,c9=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function u9(t){t.COLOR_0||t.colors||(t.colors={constant:!0,value:new Float32Array([1,1,1])})}const h9={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class Cm extends _m{getShaders(){const e=super.getShaders();return e.modules.push(Xp),{...e,vs:l9,fs:c9}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const n=this.getAttributeManager();e&&n.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;n.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(n.pbrMaterial)}draw(e){const{featureIds:n}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!n}),super.draw(e))}getModel(e){const{id:n,pbrMaterial:r}=this.props,i=this.parseMaterial(r,e);this.setState({materialParser:i});const s=this.getShaders();return u9(e.attributes),new Mt(this.context.gl,{...this.getShaders(),id:n,geometry:e,defines:{...s.defines,...i==null?void 0:i.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:i==null?void 0:i.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:n}=this.state;if(n){const{mesh:r}=this.props,i=this.parseMaterial(e,r);this.setState({materialParser:i}),n.setUniforms(i.uniforms)}}parseMaterial(e,n){var r;const i=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(r=this.state.materialParser)===null||r===void 0||r.delete(),new qC(this.context.gl,{attributes:{NORMAL:n.attributes.normals,TEXCOORD_0:n.attributes.texCoords},material:{unlit:i,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const n=this.props.featureIds,r=new Uint8ClampedArray(n.length*e.size),i=[];for(let s=0;s<n.length;s++)this.encodePickingColor(n[s],i),r[s*3]=i[0],r[s*3+1]=i[1],r[s*3+2]=i[2];e.value=r}finalizeState(e){var n;super.finalizeState(e),(n=this.state.materialParser)===null||n===void 0||n.delete(),this.setState({materialParser:null})}}d(Cm,"layerName","MeshLayer");d(Cm,"defaultProps",h9);const f9=6378137,d9=6378137,g9=6356752314245179e-9;function Uu(t){return t}new x;function p9(t,e=[],n=Uu){return"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):"x"in t?(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function m9(t,e=[]){return p9(t,e,Oe._cartographicRadians?Uu:AO)}function _9(t,e,n=Uu){return"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):"x"in e?(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function y9(t,e){return _9(t,e,Oe._cartographicRadians?Uu:EO)}const Vi=new x,v9=new x,A9=new x;function E9(t,e,n=[]){const{oneOverRadii:r,oneOverRadiiSquared:i,centerToleranceSquared:s}=e;Vi.from(t);const o=Vi.x,a=Vi.y,l=Vi.z,c=r.x,u=r.y,h=r.z,f=o*o*c*c,g=a*a*u*u,p=l*l*h*h,v=f+g+p,T=Math.sqrt(1/v);if(!Number.isFinite(T))return;const m=v9;if(m.copy(t).scale(T),v<s)return m.to(n);const _=i.x,y=i.y,b=i.z,S=A9;S.set(m.x*_*2,m.y*y*2,m.z*b*2);let w=(1-T)*Vi.len()/(.5*S.len()),I=0,L,B,M,G;do{w-=I,L=1/(1+w*_),B=1/(1+w*y),M=1/(1+w*b);const W=L*L,j=B*B,Y=M*M,lt=W*L,Nn=j*B,yn=Y*M;G=f*W+g*j+p*Y-1;const H=-2*(f*lt*_+g*Nn*y+p*yn*b);I=G/H}while(Math.abs(G)>da.EPSILON12);return Vi.scale([L,B,M]).to(n)}const uA=1e-14,T9=new x,hA={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},_f={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},_o={east:new x,north:new x,up:new x,west:new x,south:new x,down:new x},b9=new x,C9=new x,S9=new x;function fA(t,e,n,r,i,s){const o=hA[e]&&hA[e][n];on(o&&(!r||r===o));let a,l,c;const u=T9.copy(i);if(dn(u.x,0,uA)&&dn(u.y,0,uA)){const f=Math.sign(u.z);a=b9.fromArray(_f[e]),e!=="east"&&e!=="west"&&a.scale(f),l=C9.fromArray(_f[n]),n!=="east"&&n!=="west"&&l.scale(f),c=S9.fromArray(_f[r]),r!=="east"&&r!=="west"&&c.scale(f)}else{const{up:f,east:g,north:p}=_o;g.set(-u.y,u.x,0).normalize(),t.geodeticSurfaceNormal(u,f),p.copy(f).cross(g);const{down:v,west:T,south:m}=_o;v.copy(f).scale(-1),T.copy(g).scale(-1),m.copy(p).scale(-1),a=_o[e],l=_o[n],c=_o[r]}return s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=0,s[4]=l.x,s[5]=l.y,s[6]=l.z,s[7]=0,s[8]=c.x,s[9]=c.y,s[10]=c.z,s[11]=0,s[12]=u.x,s[13]=u.y,s[14]=u.z,s[15]=1,s}const Vl=new x,dA=new x,w9=new x,en=new x,x9=new x,jl=new x;class ve{constructor(e=0,n=0,r=0){d(this,"radii",void 0),d(this,"radiiSquared",void 0),d(this,"radiiToTheFourth",void 0),d(this,"oneOverRadii",void 0),d(this,"oneOverRadiiSquared",void 0),d(this,"minimumRadius",void 0),d(this,"maximumRadius",void 0),d(this,"centerToleranceSquared",da.EPSILON1),d(this,"squaredXOverSquaredZ",void 0),on(e>=0),on(n>=0),on(r>=0),this.radii=new x(e,n,r),this.radiiSquared=new x(e*e,n*n,r*r),this.radiiToTheFourth=new x(e*e*e*e,n*n*n*n,r*r*r*r),this.oneOverRadii=new x(e===0?0:1/e,n===0?0:1/n,r===0?0:1/r),this.oneOverRadiiSquared=new x(e===0?0:1/(e*e),n===0?0:1/(n*n),r===0?0:1/(r*r)),this.minimumRadius=Math.min(e,n,r),this.maximumRadius=Math.max(e,n,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,n=[0,0,0]){const r=dA,i=w9,[,,s]=e;this.geodeticSurfaceNormalCartographic(e,r),i.copy(this.radiiSquared).scale(r);const o=Math.sqrt(r.dot(i));return i.scale(1/o),r.scale(s),i.add(r),i.to(n)}cartesianToCartographic(e,n=[0,0,0]){jl.from(e);const r=this.scaleToGeodeticSurface(jl,en);if(!r)return;const i=this.geodeticSurfaceNormal(r,dA),s=x9;s.copy(jl).subtract(r);const o=Math.atan2(i.y,i.x),a=Math.asin(i.z),l=Math.sign(Vp(s,jl))*wb(s);return y9([o,a,l],n)}eastNorthUpToFixedFrame(e,n=new Z){return fA(this,"east","north","up",e,n)}localFrameToFixedFrame(e,n,r,i,s=new Z){return fA(this,e,n,r,i,s)}geocentricSurfaceNormal(e,n=[0,0,0]){return Vl.from(e).normalize().to(n)}geodeticSurfaceNormalCartographic(e,n=[0,0,0]){const r=m9(e),i=r[0],s=r[1],o=Math.cos(s);return Vl.set(o*Math.cos(i),o*Math.sin(i),Math.sin(s)).normalize(),Vl.to(n)}geodeticSurfaceNormal(e,n=[0,0,0]){return Vl.from(e).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(e,n){return E9(e,this,n)}scaleToGeocentricSurface(e,n=[0,0,0]){en.from(e);const r=en.x,i=en.y,s=en.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(r*r*o.x+i*i*o.y+s*s*o.z);return en.multiplyScalar(a).to(n)}transformPositionToScaledSpace(e,n=[0,0,0]){return en.from(e).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(e,n=[0,0,0]){return en.from(e).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(e,n=0,r=[0,0,0]){on(dn(this.radii.x,this.radii.y,da.EPSILON15)),on(this.radii.z>0),en.from(e);const i=en.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-n))return en.set(0,0,i).to(r)}}d(ve,"WGS84",new ve(f9,d9,g9));function gA(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class pA{constructor(e,n){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=gA(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(gA()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class P9{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof pA?i=e:i=new pA(n,r),this.stats[n]=i),i}}class I9{constructor(e,n,r){d(this,"item",void 0),d(this,"previous",void 0),d(this,"next",void 0),this.item=e,this.previous=n,this.next=r}}class L9{constructor(){d(this,"head",null),d(this,"tail",null),d(this,"_length",0)}get length(){return this._length}add(e){const n=new I9(e,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,n){e!==n&&(this.remove(n),this._insert(e,n))}_insert(e,n){const r=e.next;e.next=n,this.tail===e?this.tail=n:r.previous=n,n.next=r,n.previous=e,++this._length}}class M9{constructor(){d(this,"_list",void 0),d(this,"_sentinel",void 0),d(this,"_trimTiles",void 0),this._list=new L9,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const n=e._cacheNode;n&&this._list.splice(this._sentinel,n)}add(e,n,r){n._cacheNode||(n._cacheNode=this._list.add(n),r&&r(e,n))}unloadTile(e,n,r){const i=n._cacheNode;i&&(this._list.remove(i),n._cacheNode=null,r&&r(e,n))}unloadTiles(e,n){const r=this._trimTiles;this._trimTiles=!1;const i=this._list,s=e.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=i.head;for(;a!==o&&(e.gpuMemoryUsageInBytes>s||r);){const l=a.item;a=a.next,this.unloadTile(e,l,n)}}trim(){this._trimTiles=!0}}function B9(t,e){le(t),le(e);const{rtcCenter:n,gltfUpAxis:r}=e,{computedTransform:i,boundingVolume:{center:s}}=t;let o=new Z(i);switch(n&&o.translate(n),r){case"Z":break;case"Y":const h=new Z().rotateX(Math.PI/2);o=o.multiplyRight(h);break;case"X":const f=new Z().rotateY(-Math.PI/2);o=o.multiplyRight(f);break}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new x(s);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const l=ve.WGS84.cartesianToCartographic(a,new x),u=ve.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=u.multiplyRight(o),e.cartographicOrigin=l,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const mA=new x,yf=new x,fg=new Ht([new sn,new sn,new sn,new sn,new sn,new sn]);function R9(t,e){const{cameraDirection:n,cameraUp:r,height:i}=t,{metersPerUnit:s}=t.distanceScales,o=mc(t,t.center),a=ve.WGS84.eastNorthUpToFixedFrame(o),l=t.unprojectPosition(t.cameraPosition),c=ve.WGS84.cartographicToCartesian(l,new x),u=new x(a.transformAsVector(new x(n).scale(s))).normalize(),h=new x(a.transformAsVector(new x(r).scale(s))).normalize();F9(t);const f=t.constructor,{longitude:g,latitude:p,width:v,bearing:T,zoom:m}=t,_=new f({longitude:g,latitude:p,height:i,width:v,bearing:T,zoom:m,pitch:0});return{camera:{position:c,direction:u,up:h},viewport:t,topDownViewport:_,height:i,cullingVolume:fg,frameNumber:e,sseDenominator:1.15}}function O9(t,e,n){if(n===0||t.length<=n)return[t,[]];const r=[],{longitude:i,latitude:s}=e.viewport;for(const[c,u]of t.entries()){const[h,f]=u.header.mbs,g=Math.abs(i-h),p=Math.abs(s-f),v=Math.sqrt(p*p+g*g);r.push([c,v])}const o=r.sort((c,u)=>c[1]-u[1]),a=[];for(let c=0;c<n;c++)a.push(t[o[c][0]]);const l=[];for(let c=n;c<o.length;c++)l.push(t[o[c][0]]);return[a,l]}function F9(t){const e=t.getFrustumPlanes(),n=_A(e.near,t.cameraPosition),r=mc(t,n),i=mc(t,t.cameraPosition,yf);let s=0;fg.planes[s++].fromPointNormal(r,mA.copy(r).subtract(i));for(const o in e){if(o==="near")continue;const a=e[o],l=_A(a,n,yf),c=mc(t,l,yf);fg.planes[s++].fromPointNormal(c,mA.copy(r).subtract(c))}}function _A(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new x;const r=t.normal.dot(e);return n.copy(t.normal).scale(t.distance-r).add(e),n}function mc(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new x;const r=t.unprojectPosition(e);return ve.WGS84.cartographicToCartesian(r,n)}const D9=6378137,N9=6378137,dg=6356752314245179e-9,yA=new x;function U9(t,e){if(t instanceof ka){const{halfAxes:n}=t,r=G9(n);return Math.log2(dg/(r+e[2]))}else if(t instanceof Ua){const{radius:n}=t;return Math.log2(dg/(n+e[2]))}else if(t.width&&t.height){const{width:n,height:r}=t,i=Math.log2(D9/n),s=Math.log2(N9/r);return(i+s)/2}return 1}function dS(t,e,n){const r=ve.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],new x),i=Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)+Math.pow(r[2]-n[2],2));return Math.log2(dg/(i+e[2]))}function k9(t,e,n){const[r,i,s,o]=t;return dS({xmin:r,xmax:s,ymin:i,ymax:o,zmin:0,zmax:0},e,n)}function G9(t){t.getColumn(0,yA);const e=t.getColumn(1),n=t.getColumn(2);return yA.add(e).add(n).len()}const Tt={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},tr={ADD:1,REPLACE:2},vs={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Nt={I3S:"I3S",TILES3D:"TILES3D"},ku={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},z9={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function gS(t){return t!=null}const Qe=new x,_c=new x,V9=new x,j9=new x;function vf(t,e,n){if(le(t,"3D Tile: boundingVolume must be defined"),t.box)return W9(t.box,e,n);if(t.region){const[r,i,s,o,a,l]=t.region,c=ve.WGS84.cartographicToCartesian([Qn(r),Qn(o),a],V9),u=ve.WGS84.cartographicToCartesian([Qn(s),Qn(i),l],j9),h=new x().addVectors(c,u).multiplyScalar(.5),f=new x().subVectors(c,u).len()/2;return vA([h[0],h[1],h[2],f],new Z)}if(t.sphere)return vA(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function H9(t,e){if(t.box)return J9(e);if(t.region){const[n,r,i,s,o,a]=t.region;return[[Qn(n),Qn(r),o],[Qn(i),Qn(s),a]]}if(t.sphere)return X9(e);throw new Error("Unkown boundingVolume type")}function W9(t,e,n){const r=new x(t[0],t[1],t[2]);e.transform(r,r);let i=[];if(t.length===10){const c=t.slice(3,6),u=new fa;u.fromArray(t,6);const h=new x([1,0,0]),f=new x([0,1,0]),g=new x([0,0,1]);h.transformByQuaternion(u),h.scale(c[0]),f.transformByQuaternion(u),f.scale(c[1]),g.transformByQuaternion(u),g.scale(c[2]),i=[...h.toArray(),...f.toArray(),...g.toArray()]}else i=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const s=e.transformAsVector(i.slice(0,3)),o=e.transformAsVector(i.slice(3,6)),a=e.transformAsVector(i.slice(6,9)),l=new Se([s[0],s[1],s[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return gS(n)?(n.center=r,n.halfAxes=l,n):new ka(r,l)}function vA(t,e,n){const r=new x(t[0],t[1],t[2]);e.transform(r,r);const i=e.getScale(_c),s=Math.max(Math.max(i[0],i[1]),i[2]),o=t[3]*s;return gS(n)?(n.center=r,n.radius=o,n):new Ua(r,o)}function J9(t){const e=pS(),{halfAxes:n}=t,r=new x(n.getColumn(0)),i=new x(n.getColumn(1)),s=new x(n.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let l=0;l<2;l++)Qe.copy(t.center),Qe.add(r),Qe.add(i),Qe.add(s),mS(e,Qe),s.negate();i.negate()}r.negate()}return e}function X9(t){const e=pS(),{center:n,radius:r}=t,i=ve.WGS84.scaleToGeodeticSurface(n,Qe);let s;i?s=ve.WGS84.geodeticSurfaceNormal(i):s=new x(0,0,1);let o=new x(s[2],-s[1],0);o.len()>0?o.normalize():o=new x(0,1,0);const a=o.clone().cross(s);for(const l of[o,a,s]){_c.copy(l).scale(r);for(let c=0;c<2;c++)Qe.copy(n),Qe.add(_c),mS(e,Qe),_c.negate()}return e}function pS(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function mS(t,e){ve.WGS84.cartesianToCartographic(e,Qe),t[0][0]=Math.min(t[0][0],Qe[0]),t[0][1]=Math.min(t[0][1],Qe[1]),t[0][2]=Math.min(t[0][2],Qe[2]),t[1][0]=Math.max(t[1][0],Qe[0]),t[1][1]=Math.max(t[1][1],Qe[1]),t[1][2]=Math.max(t[1][2],Qe[2])}new x;new x;new Z;new x;new x;new x;function K9(t,e){const n=t*e;return 1-Math.exp(-(n*n))}function Y9(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const n=t.dynamicScreenSpaceErrorComputedDensity,r=t.dynamicScreenSpaceErrorFactor;return K9(e,n)*r}return 0}function Q9(t,e,n){const r=t.tileset,i=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,s=n?i:t.lodMetricValue;if(s===0)return 0;const o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:l}=e,{viewDistanceScale:c}=r.options;let u=s*a*(c||1)/(o*l);return u-=Y9(r,o),u}const Af=new x,AA=new x,Sr=new x,EA=new x,q9=new x,Ef=new Z,TA=new Z;function Z9(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const n=2*_S(t,e);return n<2?"OUT":!t.header.children||n<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function _S(t,e){const{topDownViewport:n}=e,r=t.header.mbs[1],i=t.header.mbs[0],s=t.header.mbs[2],o=t.header.mbs[3],a=[...t.boundingVolume.center],l=n.unprojectPosition(n.cameraPosition);ve.WGS84.cartographicToCartesian(l,Af),AA.copy(Af).subtract(a).normalize(),ve.WGS84.eastNorthUpToFixedFrame(a,Ef),TA.copy(Ef).invert(),Sr.copy(Af).transform(TA);const c=Math.sqrt(Sr[0]*Sr[0]+Sr[1]*Sr[1]),u=c*c/Sr[2];EA.copy([Sr[0],Sr[1],u]);const f=EA.transform(Ef).subtract(a).normalize(),p=AA.cross(f).normalize().scale(o).add(a),v=ve.WGS84.cartesianToCartographic(p),T=n.project([i,r,s]),m=n.project(v);return q9.copy(T).subtract(m).magnitude()}function $9(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class bA{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;d(this,"_map",new Map),d(this,"_array",void 0),d(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return le(e<this._array.length),this._array[e]}set(e,n){le(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=n,this._map.set(n,e)}delete(e){const n=this._map.get(e);n>=0&&(this._array.splice(n,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const n=this.length++;this._array[n]=e,this._map.set(e,n)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){le(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){le(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const ej={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Gu{traversalFinished(e){return!0}constructor(e){d(this,"options",void 0),d(this,"root",null),d(this,"selectedTiles",{}),d(this,"requestedTiles",{}),d(this,"emptyTiles",{}),d(this,"lastUpdate",new Date().getTime()),d(this,"updateDebounceTime",1e3),d(this,"_traversalStack",new bA),d(this,"_emptyTraversalStack",new bA),d(this,"_frameNumber",null),this.options={...ej,...e}}traverse(e,n,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,n),this._frameNumber=n.frameNumber,this.executeTraversal(e,n)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,n){const r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){const s=r.pop();let o=!1;this.canTraverse(s,n)&&(this.updateChildTiles(s,n),o=this.updateAndPushChildren(s,n,r,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const a=s.parent,l=!!(!a||a._shouldRefine),c=!o;s.hasRenderContent?s.refine===tr.ADD?(this.loadTile(s,n),this.selectTile(s,n)):s.refine===tr.REPLACE&&(this.loadTile(s,n),c&&this.selectTile(s,n)):(this.emptyTiles[s.id]=s,this.loadTile(s,n),c&&this.selectTile(s,n)),this.touchTile(s,n),s._shouldRefine=o&&l}const i=new Date().getTime();(this.traversalFinished(n)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(n))}updateChildTiles(e,n){const r=e.children;for(const i of r)this.updateTile(i,n)}updateAndPushChildren(e,n,r,i){const{loadSiblings:s,skipLevelOfDetail:o}=this.options,a=e.children;a.sort(this.compareDistanceToCamera.bind(this));const l=e.refine===tr.REPLACE&&e.hasRenderContent&&!o;let c=!1,u=!0;for(const h of a)if(h._selectionDepth=i,h.isVisibleAndInRequestVolume?(r.find(h)&&r.delete(h),r.push(h),c=!0):(l||s)&&(this.loadTile(h,n),this.touchTile(h,n)),l){let f;if(h._inRequestVolume?h.hasRenderContent?f=h.contentAvailable:f=this.executeEmptyTraversal(h,n):f=!1,u=u&&f,!u)return!1}return c||(u=!1),u}updateTile(e,n){this.updateTileVisibility(e,n)}selectTile(e,n){this.shouldSelectTile(e)&&(e._selectedFrame=n.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,n){this.shouldLoadTile(e)&&(e._requestedFrame=n.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,n){e.tileset._cache.touch(e),e._touchedFrame=n.frameNumber}canTraverse(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!i&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,n,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=e._screenSpaceError;return r&&(i=e.getScreenSpaceError(n,!0)),i>this.options.maximumScreenSpaceError}updateTileVisibility(e,n){const r=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===n.viewport.id&&r.push(i);else r.push(n.viewport.id);e.updateVisibility(n,r)}compareDistanceToCamera(e,n){return e._distanceToCamera-n._distanceToCamera}anyChildrenVisible(e,n){let r=!1;for(const i of e.children)i.updateVisibility(n),r=r||i.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,n){let r=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0&&r;){const s=i.pop();if(this.updateTile(s,n),s.isVisibleAndInRequestVolume||this.loadTile(s,n),this.touchTile(s,n),!s.hasRenderContent&&this.canTraverse(s,n,!1,!0)){const a=s.children;for(const l of a)i.find(l)&&i.delete(l),i.push(l)}else!s.contentAvailable&&!s.hasEmptyContent&&(r=!1)}return r}}const CA=new x;function tj(t){return t!=null}class gg{constructor(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";d(this,"tileset",void 0),d(this,"header",void 0),d(this,"id",void 0),d(this,"url",void 0),d(this,"parent",void 0),d(this,"refine",void 0),d(this,"type",void 0),d(this,"contentUrl",void 0),d(this,"lodMetricType","geometricError"),d(this,"lodMetricValue",0),d(this,"boundingVolume",null),d(this,"content",null),d(this,"contentState",Tt.UNLOADED),d(this,"gpuMemoryUsageInBytes",0),d(this,"children",[]),d(this,"depth",0),d(this,"viewportIds",[]),d(this,"transform",new Z),d(this,"extensions",null),d(this,"implicitTiling",null),d(this,"userData",{}),d(this,"computedTransform",void 0),d(this,"hasEmptyContent",!1),d(this,"hasTilesetContent",!1),d(this,"traverser",new Gu({})),d(this,"_cacheNode",null),d(this,"_frameNumber",null),d(this,"_expireDate",null),d(this,"_expiredContent",null),d(this,"_boundingBox",void 0),d(this,"_distanceToCamera",0),d(this,"_screenSpaceError",0),d(this,"_visibilityPlaneMask",void 0),d(this,"_visible",void 0),d(this,"_contentBoundingVolume",void 0),d(this,"_viewerRequestVolume",void 0),d(this,"_initialTransform",new Z),d(this,"_priority",0),d(this,"_selectedFrame",0),d(this,"_requestedFrame",0),d(this,"_selectionDepth",0),d(this,"_touchedFrame",0),d(this,"_centerZDepth",0),d(this,"_shouldRefine",!1),d(this,"_stackLength",0),d(this,"_visitedFrame",0),d(this,"_inRequestVolume",!1),d(this,"_lodJudge",null),this.header=n,this.tileset=e,this.id=i||n.id,this.url=n.url,this.parent=r,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Tt.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Tt.UNLOADED}get contentExpired(){return this.contentState===Tt.EXPIRED}get contentFailed(){return this.contentState===Tt.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=H9(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,n){switch(this.tileset.type){case Nt.I3S:return _S(this,e);case Nt.TILES3D:return Q9(this,e,n);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:n}=e.options,r=this.refine===tr.ADD||n;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Tt.UNLOADED)return-1;const i=this.parent,o=i&&(!r||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,a=e.root?e.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Tt.LOADING;const n=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!n)return this.contentState=Tt.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,s={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await or(r,i,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Tt.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=Tt.FAILED,r}finally{n.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Tt.UNLOADED,!0}updateVisibility(e,n){if(this._frameNumber===e.frameNumber)return;const r=this.parent,i=r?r._visibilityPlaneMask:Ht.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==Ht.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=n}visibility(e,n){const{cullingVolume:r}=e,{boundingVolume:i}=this;return r.computeVisibilityWithPlaneMask(i,n)}contentVisibility(){return!0}distanceToTile(e){const n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:n}=e;const r=this.boundingVolume;return CA.subVectors(r.center,n.position),n.direction.dot(CA)}insideViewerRequestVolume(e){const n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(tj(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Tt.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Z(e.transform):new Z;const n=this.parent,r=this.tileset,i=n&&n.computedTransform?n.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new Z(i).multiplyRight(this.transform);const s=n&&n._initialTransform?n._initialTransform.clone():new Z;this._initialTransform=new Z(s).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Tt.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Ht.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||tr.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=vf(e.boundingVolume,this.computedTransform,this.boundingVolume);const n=e.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=vf(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=vf(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const n=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Z).clone().multiplyRight(this.transform);n.equals(this.computedTransform)||(this.computedTransform=n,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return $9(this.tileset.tileset)}}}class nj extends Gu{compareDistanceToCamera(e,n){return n._distanceToCamera===0&&e._distanceToCamera===0?n._centerZDepth-e._centerZDepth:n._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,n){if(super.updateTileVisibility(e,n),!e.isVisibleAndInRequestVolume)return;const r=e.children.length>0;if(e.hasTilesetContent&&r){const o=e.children[0];this.updateTileVisibility(o,n),e._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(e,n)){e._visible=!1;return}const i=e.refine===tr.REPLACE,s=e._optimChildrenWithinParent===z9.USE_OPTIMIZATION;if(i&&s&&r&&!this.anyChildrenVisible(e,n)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,n){const{parent:r}=e;return!r||r.hasTilesetContent||r.refine!==tr.ADD?!1:!this.shouldRefine(e,n,!0)}}class rj{constructor(){d(this,"frameNumberMap",new Map)}register(e,n){const r=this.frameNumberMap.get(e)||new Map,i=r.get(n)||0;r.set(n,i+1),this.frameNumberMap.set(e,r)}deregister(e,n){const r=this.frameNumberMap.get(e);if(!r)return;const i=r.get(n)||1;r.set(n,i-1)}isZero(e,n){var r;return(((r=this.frameNumberMap.get(e))===null||r===void 0?void 0:r.get(n))||0)===0}}const Tf={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class ij{constructor(){d(this,"_statusMap",void 0),d(this,"pendingTilesRegister",new rj),this._statusMap={}}add(e,n,r,i){if(!this._statusMap[n]){const{frameNumber:s,viewport:{id:o}}=i;this._statusMap[n]={request:e,callback:r,key:n,frameState:i,status:Tf.REQUESTED},this.pendingTilesRegister.register(o,s),e().then(a=>{this._statusMap[n].status=Tf.COMPLETED;const{frameNumber:l,viewport:{id:c}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(c,l),this._statusMap[n].callback(a,i)}).catch(a=>{this._statusMap[n].status=Tf.ERROR;const{frameNumber:l,viewport:{id:c}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(c,l),r(a)})}}update(e,n){if(this._statusMap[e]){const{frameNumber:r,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,r);const{frameNumber:s,viewport:{id:o}}=n;this.pendingTilesRegister.register(o,s),this._statusMap[e].frameState=n}}find(e){return this._statusMap[e]}hasPendingTiles(e,n){return!this.pendingTilesRegister.isZero(e,n)}}class sj extends Gu{constructor(e){super(e),d(this,"_tileManager",void 0),this._tileManager=new ij}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,n){return e._lodJudge=Z9(e,n),e._lodJudge==="DIG"}updateChildTiles(e,n){const r=e.header.children||[],i=e.children,s=e.tileset;for(const o of r){const a="".concat(o.id,"-").concat(n.viewport.id),l=i&&i.find(c=>c.id===a);if(l)l&&this.updateTile(l,n);else{let c=()=>this._loadTile(o.id,s);this._tileManager.find(a)?this._tileManager.update(a,n):(s.tileset.nodePages&&(c=()=>s.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(c,a,h=>this._onTileLoad(h,e,a),n))}}return!1}async _loadTile(e,n){const{loader:r}=n,i=n.getTileUrl("".concat(n.url,"/nodes/").concat(e)),s={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await or(i,r,s)}_onTileLoad(e,n,r){const i=new gg(n.tileset,e,n,r);n.children.push(i);const s=this._tileManager.find(i.id).frameState;this.updateTile(i,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,s)}}const oj={description:"",ellipsoid:ve.WGS84,modelMatrix:new Z,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Hl="Tiles In Tileset(s)",bf="Tiles In Memory",SA="Tiles In View",wA="Tiles To Render",xA="Tiles Loaded",Cf="Tiles Loading",PA="Tiles Unloaded",IA="Failed Tile Loads",LA="Points/Vertices",Sf="Tile Memory Use";class aj{constructor(e,n){d(this,"options",void 0),d(this,"loadOptions",void 0),d(this,"type",void 0),d(this,"tileset",void 0),d(this,"loader",void 0),d(this,"url",void 0),d(this,"basePath",void 0),d(this,"modelMatrix",void 0),d(this,"ellipsoid",void 0),d(this,"lodMetricType",void 0),d(this,"lodMetricValue",void 0),d(this,"refine",void 0),d(this,"root",null),d(this,"roots",{}),d(this,"asset",{}),d(this,"description",""),d(this,"properties",void 0),d(this,"extras",null),d(this,"attributions",{}),d(this,"credits",{}),d(this,"stats",void 0),d(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),d(this,"cartographicCenter",null),d(this,"cartesianCenter",null),d(this,"zoom",1),d(this,"boundingVolume",null),d(this,"dynamicScreenSpaceErrorComputedDensity",0),d(this,"maximumMemoryUsage",32),d(this,"gpuMemoryUsageInBytes",0),d(this,"_frameNumber",0),d(this,"_queryParams",{}),d(this,"_extensionsUsed",[]),d(this,"_tiles",{}),d(this,"_pendingCount",0),d(this,"selectedTiles",[]),d(this,"traverseCounter",0),d(this,"geometricError",0),d(this,"lastUpdatedVieports",null),d(this,"_requestedTiles",[]),d(this,"_emptyTiles",[]),d(this,"frameStateData",{}),d(this,"_traverser",void 0),d(this,"_cache",new M9),d(this,"_requestScheduler",void 0),d(this,"updatePromise",null),d(this,"tilesetInitializationPromise",void 0),this.options={...oj,...n},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||_p(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new AI({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new P9({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(n=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),n(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const n=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;const r=[];for(const i of n){const s=i.id;this._needTraverse(s)?r.push(s):this.traverseCounter--}for(const i of n){const s=i.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!r.includes(s))continue;const o=R9(i,this._frameNumber);this._traverser.traverse(this.roots[s],o,this.options)}}_needTraverse(e){let n=e;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[e]),n===e}_onTraversalEnd(e){const n=e.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[n],i=Object.values(this._traverser.selectedTiles),[s,o]=O9(i,e,this.options.maximumTilesSelected);r.selectedTiles=s;for(const a of o)a.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const n=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,n){if(e.length!==n.length)return!0;const r=new Set(e.map(o=>o.id)),i=new Set(n.map(o=>o.id));let s=e.filter(o=>!i.has(o.id)).length>0;return s=s||n.filter(o=>!r.has(o.id)).length>0,s}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,n)=>e._unloadTile(n))}_updateStats(){let e=0,n=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(e++,r.content.pointCount?n+=r.content.pointCount:n+=r.content.vertexCount);this.stats.get(SA).count=this.selectedTiles.length,this.stats.get(wA).count=e,this.stats.get(LA).count=n}async _initializeTileSet(e){this.type===Nt.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Nt.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Nt.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const n=this.tileset.fullExtent;if(n){const{xmin:i,xmax:s,ymin:o,ymax:a,zmin:l,zmax:c}=n;this.cartographicCenter=new x(i+(s-i)/2,o+(a-o)/2,l+(c-l)/2),this.cartesianCenter=ve.WGS84.cartographicToCartesian(this.cartographicCenter,new x),this.zoom=dS(n,this.cartographicCenter,this.cartesianCenter);return}const r=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(r){const[i,s,o,a]=r;this.cartographicCenter=new x(i+(o-i)/2,s+(a-s)/2,0),this.cartesianCenter=ve.WGS84.cartographicToCartesian(this.cartographicCenter,new x),this.zoom=k9(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new x,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:n}=e.boundingVolume;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new x,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?this.cartographicCenter=ve.WGS84.cartesianToCartographic(n,new x):this.cartographicCenter=new x(0,0,-ve.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=U9(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(Hl),this.stats.get(Cf),this.stats.get(bf),this.stats.get(SA),this.stats.get(wA),this.stats.get(xA),this.stats.get(PA),this.stats.get(IA),this.stats.get(LA),this.stats.get(Sf,"memory")}_initializeTileHeaders(e,n){const r=new gg(this,e.root,n);if(n&&(n.children.push(r),r.depth=n.depth+1),this.type===Nt.TILES3D){const s=[];for(s.push(r);s.length>0;){const o=s.pop();this.stats.get(Hl).incrementCount();const a=o.header.children||[];for(const l of a){var i;const c=new gg(this,l,o);if((i=c.contentUrl)!==null&&i!==void 0&&i.includes("?session=")){const h=new URL(c.contentUrl).searchParams.get("session");h&&(this._queryParams.session=h)}o.children.push(c),c.depth=o.depth+1,s.push(c)}}}return r}_initializeTraverser(){let e;switch(this.type){case Nt.TILES3D:e=nj;break;case Nt.I3S:e=sj;break;default:e=Gu}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let n;try{this._onStartTileLoading(),n=await e.loadContent()}catch(r){this._onTileLoadError(e,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,n)}}_onTileLoadError(e,n){this.stats.get(IA).incrementCount();const r=n.message||n.toString(),i=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(r)),this.options.onTileError(e,r,i)}_onTileLoad(e,n){if(n){if(this.type===Nt.I3S){var r,i;const s=((r=this.tileset)===null||r===void 0||(i=r.nodePagesTile)===null||i===void 0?void 0:i.nodesInNodePages)||0;this.stats.get(Hl).reset(),this.stats.get(Hl).addCount(s)}e&&e.content&&B9(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===Nt.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Nt.TILES3D){var n;const{extensionsRemoved:r=[]}=((n=e.content)===null||n===void 0?void 0:n.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Cf).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Cf).decrementCount()}_addTileToCache(e){this._cache.add(this,e,n=>n._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(xA).incrementCount(),this.stats.get(bf).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(Sf).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(bf).decrementCount(),this.stats.get(PA).incrementCount(),this.stats.get(Sf).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const n=e.pop();for(const r of n.children)e.push(r);this._destroyTile(n)}this.root=null}_destroySubtree(e){const n=e,r=[];for(r.push(n);r.length>0;){e=r.pop();for(const i of e.children)r.push(i);e!==n&&this._destroyTile(e)}n.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const n=new URLSearchParams(e.queryString),r=Object.fromEntries(n.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const yS="3.4.14",yo={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function vS(t,e,n){le(t instanceof ArrayBuffer);const r=new TextDecoder("utf8"),i=new Uint8Array(t,e,n);return r.decode(i)}function lj(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=new DataView(t);return"".concat(String.fromCharCode(n.getUint8(e+0))).concat(String.fromCharCode(n.getUint8(e+1))).concat(String.fromCharCode(n.getUint8(e+2))).concat(String.fromCharCode(n.getUint8(e+3)))}const cj={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Ie={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},ee={...cj,...Ie},wf={[Ie.DOUBLE]:Float64Array,[Ie.FLOAT]:Float32Array,[Ie.UNSIGNED_SHORT]:Uint16Array,[Ie.UNSIGNED_INT]:Uint32Array,[Ie.UNSIGNED_BYTE]:Uint8Array,[Ie.BYTE]:Int8Array,[Ie.SHORT]:Int16Array,[Ie.INT]:Int32Array},uj={DOUBLE:Ie.DOUBLE,FLOAT:Ie.FLOAT,UNSIGNED_SHORT:Ie.UNSIGNED_SHORT,UNSIGNED_INT:Ie.UNSIGNED_INT,UNSIGNED_BYTE:Ie.UNSIGNED_BYTE,BYTE:Ie.BYTE,SHORT:Ie.SHORT,INT:Ie.INT},xf="Failed to convert GL type";class Rn{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const n in wf)if(wf[n]===e)return n;throw new Error(xf)}static fromName(e){const n=uj[e];if(!n)throw new Error(xf);return n}static getArrayType(e){switch(e){case Ie.UNSIGNED_SHORT_5_6_5:case Ie.UNSIGNED_SHORT_4_4_4_4:case Ie.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const n=wf[e];if(!n)throw new Error(xf);return n}}static getByteSize(e){return Rn.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Rn.getArrayType(e)}static createTypedArray(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;i===void 0&&(i=(n.byteLength-r)/Rn.getByteSize(e));const s=Rn.getArrayType(e);return new s(n,r,i)}}function hj(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(e))}function fj(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=t>>11&31,r=t>>5&63,i=t&31;return e[0]=n<<3,e[1]=r<<2,e[2]=i<<3,e}new zp;new x;new zp;new zp;function MA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return qn(t,0,e)/e*2-1}function BA(t){return t<0?-1:1}function dj(t,e,n,r){if(hj(r),t<0||t>n||e<0||e>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(r.x=MA(t,n),r.y=MA(e,n),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const i=r.x;r.x=(1-Math.abs(r.y))*BA(i),r.y=(1-Math.abs(i))*BA(r.y)}return r.normalize()}function gj(t,e,n){return dj(t,e,255,n)}class Sm{constructor(e,n){d(this,"json",void 0),d(this,"buffer",void 0),d(this,"featuresLength",0),d(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=n}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ee.UNSIGNED_INT,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,n,r,1,i.byteOffset):i}getPropertyArray(e,n,r){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(n=Rn.fromName(i.componentType)),this._getTypedArrayFromBinary(e,n,r,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,n,i)}getProperty(e,n,r,i,s){const o=this.json[e];if(!o)return o;const a=this.getPropertyArray(e,n,r);if(r===1)return a[i];for(let l=0;l<r;++l)s[l]=a[r*i+l];return s}_getTypedArrayFromBinary(e,n,r,i,s){const o=this._cachedTypedArrays;let a=o[e];return a||(a=Rn.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+s,i*r),o[e]=a),a}_getTypedArrayFromArray(e,n,r){const i=this._cachedTypedArrays;let s=i[e];return s||(s=Rn.createTypedArray(n,r),i[e]=s),s}}const pj={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},mj={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},_j={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}};function yj(t,e,n,r){const{componentType:i}=t;le(t.componentType);const s=typeof i=="string"?Rn.fromName(i):i,o=pj[t.type],a=mj[t.type],l=_j[t.type];return n+=t.byteOffset,{values:Rn.createTypedArray(s,e,n,o*r),type:s,size:o,unpacker:a,packer:l}}const Ln=t=>t!==void 0;function vj(t,e,n){if(!e)return null;let r=t.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,r=i),r?Aj(r,n):null}function Aj(t,e){let n,r,i;const s=t.instancesLength,o=t.classes;let a=t.classIds,l=t.parentCounts,c=t.parentIds,u=s;Ln(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,i=getBinaryAccessor(a),a=i.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,s));let h;if(Ln(l))for(Ln(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,i=getBinaryAccessor(l),l=i.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,s)),h=new Uint16Array(s),u=0,n=0;n<s;++n)h[n]=u,u+=l[n];Ln(c)&&Ln(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),c=i.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,u));const f=o.length;for(n=0;n<f;++n){const T=o[n].length,m=o[n].instances,_=getBinaryProperties(T,m,e);o[n].instances=combine(_,m)}const g=new Array(f).fill(0),p=new Uint16Array(s);for(n=0;n<s;++n)r=a[n],p[n]=g[r],++g[r];const v={classes:o,classIds:a,classIndexes:p,parentCounts:l,parentIndexes:h,parentIds:c};return bj(v),v}function vo(t,e,n){if(!t)return;const r=t.parentCounts;return t.parentIds?n(t,e):r>0?Ej(t,e,n):Tj(t,e,n)}function Ej(t,e,n){const r=t.classIds,i=t.parentCounts,s=t.parentIds,o=t.parentIndexes,a=r.length,l=scratchVisited;l.length=Math.max(l.length,a);const c=++marker,u=scratchStack;for(u.length=0,u.push(e);u.length>0;){if(e=u.pop(),l[e]===c)continue;l[e]=c;const h=n(t,e);if(Ln(h))return h;const f=i[e],g=o[e];for(let p=0;p<f;++p){const v=s[g+p];v!==e&&u.push(v)}}return null}function Tj(t,e,n){let r=!0;for(;r;){const i=n(t,e);if(Ln(i))return i;const s=t.parentIds[e];r=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}function bj(t){const n=t.classIds.length;for(let r=0;r<n;++r)AS(t,r,stack)}function AS(t,e,n){const r=t.parentCounts,i=t.parentIds,s=t.parentIndexes,a=t.classIds.length;if(!Ln(i))return;assert(e<a,"Parent index ".concat(e," exceeds the total number of instances: ").concat(a)),assert(n.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),n.push(e);const l=Ln(r)?r[e]:1,c=Ln(r)?s[e]:e;for(let u=0;u<l;++u){const h=i[c+u];h!==e&&AS(t,h,n)}n.pop(e)}function ut(t){return t!=null}const Wl=(t,e)=>t,Cj={HIERARCHY:!0,extensions:!0,extras:!0};class ES{constructor(e,n,r){var i;let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};d(this,"json",void 0),d(this,"binary",void 0),d(this,"featureCount",void 0),d(this,"_extensions",void 0),d(this,"_properties",void 0),d(this,"_binaryProperties",void 0),d(this,"_hierarchy",void 0),le(r>=0),this.json=e||{},this.binary=n,this.featureCount=r,this._extensions=((i=this.json)===null||i===void 0?void 0:i.extensions)||{},this._properties={};for(const o in this.json)Cj[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=vj(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,n){if(this._checkBatchId(e),le(typeof n=="string",n),this._hierarchy){const r=vo(this._hierarchy,e,(i,s)=>{const o=i.classIds[s];return i.classes[o].name===n});return ut(r)}return!1}isExactClass(e,n){return le(typeof n=="string",n),this.getExactClassName(e)===n}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const n=this._hierarchy.classIds[e];return this._hierarchy.classes[n].name}}hasProperty(e,n){return this._checkBatchId(e),le(typeof n=="string",n),ut(this._properties[n])||this._hasPropertyInHierarchy(e,n)}getPropertyNames(e,n){this._checkBatchId(e),n=ut(n)?n:[],n.length=0;const r=Object.keys(this._properties);return n.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,n),n}getProperty(e,n){if(this._checkBatchId(e),le(typeof n=="string",n),this._binaryProperties){const i=this._binaryProperties[n];if(ut(i))return this._getBinaryProperty(i,e)}const r=this._properties[n];if(ut(r))return Wl(r[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,n);if(ut(i))return i}}setProperty(e,n,r){const i=this.featureCount;if(this._checkBatchId(e),le(typeof n=="string",n),this._binaryProperties){const o=this._binaryProperties[n];if(o){this._setBinaryProperty(o,e,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,n,r))return;let s=this._properties[n];ut(s)||(this._properties[n]=new Array(i),s=this._properties[n]),s[e]=Wl(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,n){return e.unpack(e.typedArray,n)}_setBinaryProperty(e,n,r){e.pack(r,e.typedArray,n)}_initializeBinaryProperties(){let e=null;for(const n in this._properties){const r=this._properties[n],i=this._initializeBinaryProperty(n,r);i&&(e=e||{},e[n]=i)}return e}_initializeBinaryProperty(e,n){if("byteOffset"in n){const r=n;le(this.binary,"Property ".concat(e," requires a batch table binary.")),le(r.type,"Property ".concat(e," requires a type."));const i=yj(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,n){if(!this._hierarchy)return!1;const r=vo(this._hierarchy,e,(i,s)=>{const o=i.classIds[s],a=i.classes[o].instances;return ut(a[n])});return ut(r)}_getPropertyNamesInHierarchy(e,n){vo(this._hierarchy,e,(r,i)=>{const s=r.classIds[i],o=r.classes[s].instances;for(const a in o)o.hasOwnProperty(a)&&n.indexOf(a)===-1&&n.push(a)})}_getHierarchyProperty(e,n){return vo(this._hierarchy,e,(r,i)=>{const s=r.classIds[i],o=r.classes[s],a=r.classIndexes[i],l=o.instances[n];return ut(l)?ut(l.typedArray)?this._getBinaryProperty(l,a):Wl(l[a]):null})}_setHierarchyProperty(e,n,r,i){const s=vo(this._hierarchy,n,(o,a)=>{const l=o.classIds[a],c=o.classes[l],u=o.classIndexes[a],h=c.instances[r];return ut(h)?(le(a===n,'Inherited property "'.concat(r,'" is read-only.')),ut(h.typedArray)?this._setBinaryProperty(h,u,i):h[u]=Wl(i),!0):!1});return ut(s)}}const Pf=4;function zu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e);if(t.magic=r.getUint32(n,!0),n+=Pf,t.version=r.getUint32(n,!0),n+=Pf,t.byteLength=r.getUint32(n,!0),n+=Pf,t.version!==1)throw new Error("3D Tile Version ".concat(t.version," not supported"));return n}const ji=4,RA="b3dm tile in legacy format.";function wm(t,e,n){const r=new DataView(e);let i;t.header=t.header||{};let s=r.getUint32(n,!0);n+=ji;let o=r.getUint32(n,!0);n+=ji;let a=r.getUint32(n,!0);n+=ji;let l=r.getUint32(n,!0);return n+=ji,a>=570425344?(n-=ji*2,i=s,a=o,l=0,s=0,o=0,console.warn(RA)):l>=570425344&&(n-=ji,i=a,a=s,l=o,s=0,o=0,console.warn(RA)),t.header.featureTableJsonByteLength=s,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=l,t.header.batchLength=i,n}function xm(t,e,n,r){return n=Sj(t,e,n),n=wj(t,e,n),n}function Sj(t,e,n,r){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:s,batchLength:o}=t.header;if(t.featureTableJson={BATCH_LENGTH:o||0},i>0){const a=vS(e,n,i);t.featureTableJson=JSON.parse(a)}return n+=i,t.featureTableBinary=new Uint8Array(e,n,s),n+=s,n}function wj(t,e,n,r){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:s}=t.header;if(i>0){const o=vS(e,n,i);t.batchTableJson=JSON.parse(o),n+=i,s>0&&(t.batchTableBinary=new Uint8Array(e,n,s),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=s)}return n}function TS(t,e,n){if(!e&&(!t||!t.batchIds||!n))return null;const{batchIds:r,isRGB565:i,pointCount:s}=t;if(r&&n){const o=new Uint8ClampedArray(s*3);for(let a=0;a<s;a++){const l=r[a],u=n.getProperty(l,"dimensions").map(h=>h*255);o[a*3]=u[0],o[a*3+1]=u[1],o[a*3+2]=u[2]}return{type:ee.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(i){const o=new Uint8ClampedArray(s*3);for(let a=0;a<s;a++){const l=fj(e[a]);o[a*3]=l[0],o[a*3+1]=l[1],o[a*3+2]=l[2]}return{type:ee.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return e&&e.length===s*3?{type:ee.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:ee.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const OA=new x;function xj(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array(t.pointsLength*3);for(let r=0;r<t.pointsLength;r++)gj(e[r*2],e[r*2+1],OA),OA.toArray(n,r*3);return{type:ee.FLOAT,size:2,value:n}}return{type:ee.FLOAT,size:2,value:e}}function Pj(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,Ij(t,e)):{type:ee.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Ij(t,e){const n=new x,r=new Float32Array(t.pointCount*3);for(let i=0;i<t.pointCount;i++)n.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(r,i*3);return r}async function Lj(t,e,n,r,i){n=zu(t,e,n),n=wm(t,e,n),n=xm(t,e,n),Mj(t);const{featureTable:s,batchTable:o}=Bj(t);return await Nj(t,s,o,r,i),Rj(t,s,r),Oj(t,s,o),Fj(t,s),n}function Mj(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function Bj(t){const e=new Sm(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",ee.FLOAT,3);const r=Dj(t,e);return{featureTable:e,batchTable:r}}function Rj(t,e,n){if(!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",ee.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const r=e.getPropertyArray("POSITION_QUANTIZED",ee.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65536-1,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ee.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ee.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=Pj(t,r,n)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Oj(t,e,n){if(!t.attributes.colors){let r=null;e.hasProperty("RGBA")?(r=e.getPropertyArray("RGBA",ee.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?r=e.getPropertyArray("RGB",ee.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(r=e.getPropertyArray("RGB565",ee.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=TS(t,r,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",ee.UNSIGNED_BYTE,4))}function Fj(t,e){if(!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",ee.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",ee.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=xj(t,n)}}function Dj(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",ee.UNSIGNED_SHORT,1),t.batchIds)){const r=e.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:s}=t;n=new ES(i,s,r)}return n}async function Nj(t,e,n,r,i){let s,o,a;const l=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];l&&(a=l.properties);const c=e.getExtension("3DTILES_draco_point_compression");if(c){o=c.properties;const h=c.byteOffset,f=c.byteLength;if(!o||!Number.isFinite(h)||!f)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=t.featureTableBinary.slice(h,h+f),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;const u={buffer:s,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await Uj(t,u,r,i)}async function Uj(t,e,n,r){const{parse:i}=r,s={...n,draco:{...n.draco,extraAttributes:e.batchTableProperties||{}}};delete s["3d-tiles"];const o=await i(e.buffer,oS,s),a=o.attributes.POSITION&&o.attributes.POSITION.value,l=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,c=o.attributes.NORMAL&&o.attributes.NORMAL.value,u=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,h=a&&o.attributes.POSITION.value.quantization,f=c&&o.attributes.NORMAL.value.quantization;if(h){const p=o.POSITION.data.quantization,v=p.range;t.quantizedVolumeScale=new x(v,v,v),t.quantizedVolumeOffset=new x(p.minValues),t.quantizedRange=(1<<p.quantizationBits)-1,t.isQuantizedDraco=!0}f&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const g={};if(e.batchTableProperties)for(const p of Object.keys(e.batchTableProperties))o.attributes[p]&&o.attributes[p].value&&(g[p.toLowerCase()]=o.attributes[p].value);t.attributes={positions:a,colors:TS(t,l,void 0),normals:c,batchIds:u,...g}}const pg={URI:0,EMBEDDED:1};function bS(t,e,n,r){t.rotateYtoZ=!0;const i=t.byteOffset+t.byteLength-n;if(i===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=mp(e,n,i),t.gltfByteOffset=0,t.gltfByteLength=i,n%4===0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}async function CS(t,e,n,r){const i=n["3d-tiles"]||{};if(kj(t,e),i.loadGLTF){const{parse:s,fetch:o}=r;t.gltfUrl&&(t.gltfArrayBuffer=await o(t.gltfUrl,n),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await s(t.gltfArrayBuffer,Aa,n,r),t.gpuMemoryUsageInBytes=iS(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}function kj(t,e,n){switch(e){case pg.URI:const r=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),s=new TextDecoder().decode(r);t.gltfUrl=s.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case pg.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function Gj(t,e,n,r,i){var s;n=zj(t,e,n,r),await CS(t,pg.EMBEDDED,r,i);const o=t==null||(s=t.gltf)===null||s===void 0?void 0:s.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),n}function zj(t,e,n,r,i){n=zu(t,e,n),n=wm(t,e,n),n=xm(t,e,n),n=bS(t,e,n,r);const s=new Sm(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=s.getGlobalProperty("RTC_CENTER",ee.FLOAT,3),n}async function Vj(t,e,n,r,i){return n=jj(t,e,n,r),await CS(t,t.gltfFormat,r,i),n}function jj(t,e,n,r,i){if(n=zu(t,e,n),t.version!==1)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));n=wm(t,e,n);const s=new DataView(e);if(t.gltfFormat=s.getUint32(n,!0),n+=4,n=xm(t,e,n),n=bS(t,e,n,r),t.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new Sm(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",ee.FLOAT,3);const l=new ES(t.batchTableJson,t.batchTableBinary,a);return Hj(t,o,l,a),n}function Hj(t,e,n,r){const s={instances:new Array(r),batchTable:t._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,o=new x;new x,new x,new x;const a=new Se,l=new fa,c=new x,u={},h=new Z,f=[],g=[],p=new x,v=new x;for(let T=0;T<r;T++){let m;if(e.hasProperty("POSITION"))m=e.getProperty("POSITION",ee.FLOAT,3,T,o);else if(e.hasProperty("POSITION_QUANTIZED")){m=e.getProperty("POSITION_QUANTIZED",ee.UNSIGNED_SHORT,3,T,o);const I=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ee.FLOAT,3,p);if(!I)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const L=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ee.FLOAT,3,v);if(!L)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const B=65535;for(let M=0;M<3;M++)m[M]=m[M]/B*L[M]+I[M]}if(!m)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(m),u.translation=o,t.normalUp=e.getProperty("NORMAL_UP",ee.FLOAT,3,T,f),t.normalRight=e.getProperty("NORMAL_RIGHT",ee.FLOAT,3,T,g),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",ee.UNSIGNED_SHORT,2,f),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",ee.UNSIGNED_SHORT,2,g),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(ve.WGS84.eastNorthUpToFixedFrame(o,h),h.getRotationMatrix3(a)):a.identity()}l.fromMatrix3(a),u.rotation=l,c.set(1,1,1);const _=e.getProperty("SCALE",ee.FLOAT,1,T);Number.isFinite(_)&&c.multiplyByScalar(_);const y=e.getProperty("SCALE_NON_UNIFORM",ee.FLOAT,3,T,f);y&&c.scale(y),u.scale=c;let b=e.getProperty("BATCH_ID",ee.UNSIGNED_SHORT,1,T);b===void 0&&(b=T);const S=new Z().fromQuaternion(u.rotation);h.identity(),h.translate(u.translation),h.multiplyRight(S),h.scale(u.scale);const w=h.clone();s[T]={modelMatrix:w,batchId:b}}t.instances=s}async function Wj(t,e,n,r,i,s){n=zu(t,e,n);const o=new DataView(e);for(t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-n>12;){const a={};t.tiles.push(a),n=await s(e,n,r,i,a)}return n}async function Jj(t,e,n,r){t.rotateYtoZ=!0,t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y";const{parse:i}=r;t.gltf=await i(e,Aa,n,r),t.gpuMemoryUsageInBytes=iS(t.gltf)}async function SS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(i.byteOffset=e,i.type=lj(t,e),i.type){case yo.COMPOSITE:return await Wj(i,t,e,n,r,SS);case yo.BATCHED_3D_MODEL:return await Gj(i,t,e,n,r);case yo.GLTF:return await Jj(i,t,n,r);case yo.INSTANCED_3D_MODEL:return await Vj(i,t,e,n,r);case yo.POINT_CLOUD:return await Lj(i,t,e,n,r);default:throw new Error("3DTileLoader: unknown type ".concat(i.type))}}const Xj=1952609651,Kj=1;async function Yj(t,e,n){if(new Uint32Array(t.slice(0,4))[0]!==Xj)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==Kj)throw new Error("Wrong subtree file verson, must be 1");const s=FA(t.slice(8,16)),o=new Uint8Array(t,24,s),l=new TextDecoder("utf8").decode(o),c=JSON.parse(l),u=FA(t.slice(16,24));let h=new ArrayBuffer(0);return u&&(h=t.slice(24+s)),"bufferView"in c.tileAvailability&&(c.tileAvailability.explicitBitstream=await If(c,"tileAvailability",h,n)),"bufferView"in c.contentAvailability&&(c.contentAvailability.explicitBitstream=await If(c,"contentAvailability",h,n)),"bufferView"in c.childSubtreeAvailability&&(c.childSubtreeAvailability.explicitBitstream=await If(c,"childSubtreeAvailability",h,n)),c}function Qj(t,e){if(e.startsWith("http")){const s=new URL(t,e);return decodeURI(s.toString())}const r="http://".concat(e),i=new URL(t,r);return"/".concat(i.host).concat(i.pathname)}async function If(t,e,n,r){const i=t[e].bufferView,s=t.bufferViews[i],o=t.buffers[s.buffer];if(!(r!=null&&r.url)||!r.fetch)throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(o.uri){const a=Qj(o.uri,r==null?void 0:r.url),c=await(await r.fetch(a)).arrayBuffer();return new Uint8Array(c,s.byteOffset,s.byteLength)}return new Uint8Array(n,s.byteOffset,s.byteLength)}function FA(t){const e=new DataView(t),n=e.getUint32(0,!0),r=e.getUint32(4,!0);return n+2**32*r}const wS={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:yS,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Yj,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Wt=null;try{Wt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function oe(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}oe.prototype.__isLong__;Object.defineProperty(oe.prototype,"__isLong__",{value:!0});function et(t){return(t&&t.__isLong__)===!0}function DA(t){var e=Math.clz32(t&-t);return t?31-e:e}oe.isLong=et;var NA={},UA={};function Ii(t,e){var n,r,i;return e?(t>>>=0,(i=0<=t&&t<256)&&(r=UA[t],r)?r:(n=ne(t,0,!0),i&&(UA[t]=n),n)):(t|=0,(i=-128<=t&&t<128)&&(r=NA[t],r)?r:(n=ne(t,t<0?-1:0,!1),i&&(NA[t]=n),n))}oe.fromInt=Ii;function Jt(t,e){if(isNaN(t))return e?Zn:cn;if(e){if(t<0)return Zn;if(t>=xS)return LS}else{if(t<=-GA)return gt;if(t+1>=GA)return IS}return t<0?Jt(-t,e).neg():ne(t%Ds|0,t/Ds|0,e)}oe.fromNumber=Jt;function ne(t,e,n){return new oe(t,e,n)}oe.fromBits=ne;var cu=Math.pow;function Pm(t,e,n){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(n=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?Zn:cn;if(n=n||10,n<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return Pm(t.substring(1),e,n).neg();for(var i=Jt(cu(n,8)),s=cn,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var c=Jt(cu(n,a));s=s.mul(c).add(Jt(l))}else s=s.mul(i),s=s.add(Jt(l))}return s.unsigned=e,s}oe.fromString=Pm;function _n(t,e){return typeof t=="number"?Jt(t,e):typeof t=="string"?Pm(t,e):ne(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}oe.fromValue=_n;var kA=65536,qj=1<<24,Ds=kA*kA,xS=Ds*Ds,GA=xS/2,zA=Ii(qj),cn=Ii(0);oe.ZERO=cn;var Zn=Ii(0,!0);oe.UZERO=Zn;var ls=Ii(1);oe.ONE=ls;var PS=Ii(1,!0);oe.UONE=PS;var mg=Ii(-1);oe.NEG_ONE=mg;var IS=ne(-1,2147483647,!1);oe.MAX_VALUE=IS;var LS=ne(-1,-1,!0);oe.MAX_UNSIGNED_VALUE=LS;var gt=ne(0,-2147483648,!1);oe.MIN_VALUE=gt;var F=oe.prototype;F.toInt=function(){return this.unsigned?this.low>>>0:this.low};F.toNumber=function(){return this.unsigned?(this.high>>>0)*Ds+(this.low>>>0):this.high*Ds+(this.low>>>0)};F.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(gt)){var n=Jt(e),r=this.div(n),i=r.mul(n).sub(this);return r.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=Jt(cu(e,6),this.unsigned),o=this,a="";;){var l=o.div(s),c=o.sub(l.mul(s)).toInt()>>>0,u=c.toString(e);if(o=l,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};F.getHighBits=function(){return this.high};F.getHighBitsUnsigned=function(){return this.high>>>0};F.getLowBits=function(){return this.low};F.getLowBitsUnsigned=function(){return this.low>>>0};F.getNumBitsAbs=function(){if(this.isNegative())return this.eq(gt)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};F.isZero=function(){return this.high===0&&this.low===0};F.eqz=F.isZero;F.isNegative=function(){return!this.unsigned&&this.high<0};F.isPositive=function(){return this.unsigned||this.high>=0};F.isOdd=function(){return(this.low&1)===1};F.isEven=function(){return(this.low&1)===0};F.equals=function(e){return et(e)||(e=_n(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};F.eq=F.equals;F.notEquals=function(e){return!this.eq(e)};F.neq=F.notEquals;F.ne=F.notEquals;F.lessThan=function(e){return this.comp(e)<0};F.lt=F.lessThan;F.lessThanOrEqual=function(e){return this.comp(e)<=0};F.lte=F.lessThanOrEqual;F.le=F.lessThanOrEqual;F.greaterThan=function(e){return this.comp(e)>0};F.gt=F.greaterThan;F.greaterThanOrEqual=function(e){return this.comp(e)>=0};F.gte=F.greaterThanOrEqual;F.ge=F.greaterThanOrEqual;F.compare=function(e){if(et(e)||(e=_n(e)),this.eq(e))return 0;var n=this.isNegative(),r=e.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};F.comp=F.compare;F.negate=function(){return!this.unsigned&&this.eq(gt)?gt:this.not().add(ls)};F.neg=F.negate;F.add=function(e){et(e)||(e=_n(e));var n=this.high>>>16,r=this.high&65535,i=this.low>>>16,s=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,u=0,h=0,f=0,g=0;return g+=s+c,f+=g>>>16,g&=65535,f+=i+l,h+=f>>>16,f&=65535,h+=r+a,u+=h>>>16,h&=65535,u+=n+o,u&=65535,ne(f<<16|g,u<<16|h,this.unsigned)};F.subtract=function(e){return et(e)||(e=_n(e)),this.add(e.neg())};F.sub=F.subtract;F.multiply=function(e){if(this.isZero())return this;if(et(e)||(e=_n(e)),Wt){var n=Wt.mul(this.low,this.high,e.low,e.high);return ne(n,Wt.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Zn:cn;if(this.eq(gt))return e.isOdd()?gt:cn;if(e.eq(gt))return this.isOdd()?gt:cn;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(zA)&&e.lt(zA))return Jt(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,i=this.high&65535,s=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,u=e.low&65535,h=0,f=0,g=0,p=0;return p+=o*u,g+=p>>>16,p&=65535,g+=s*u,f+=g>>>16,g&=65535,g+=o*c,f+=g>>>16,g&=65535,f+=i*u,h+=f>>>16,f&=65535,f+=s*c,h+=f>>>16,f&=65535,f+=o*l,h+=f>>>16,f&=65535,h+=r*u+i*c+s*l+o*a,h&=65535,ne(g<<16|p,h<<16|f,this.unsigned)};F.mul=F.multiply;F.divide=function(e){if(et(e)||(e=_n(e)),e.isZero())throw Error("division by zero");if(Wt){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?Wt.div_u:Wt.div_s)(this.low,this.high,e.low,e.high);return ne(n,Wt.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Zn:cn;var r,i,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Zn;if(e.gt(this.shru(1)))return PS;s=Zn}else{if(this.eq(gt)){if(e.eq(ls)||e.eq(mg))return gt;if(e.eq(gt))return ls;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(cn)?e.isNegative()?ls:mg:(i=this.sub(e.mul(r)),s=r.add(i.div(e)),s)}else if(e.eq(gt))return this.unsigned?Zn:cn;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=cn}for(i=this;i.gte(e);){r=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),l=a<=48?1:cu(2,a-48),c=Jt(r),u=c.mul(e);u.isNegative()||u.gt(i);)r-=l,c=Jt(r,this.unsigned),u=c.mul(e);c.isZero()&&(c=ls),s=s.add(c),i=i.sub(u)}return s};F.div=F.divide;F.modulo=function(e){if(et(e)||(e=_n(e)),Wt){var n=(this.unsigned?Wt.rem_u:Wt.rem_s)(this.low,this.high,e.low,e.high);return ne(n,Wt.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};F.mod=F.modulo;F.rem=F.modulo;F.not=function(){return ne(~this.low,~this.high,this.unsigned)};F.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};F.clz=F.countLeadingZeros;F.countTrailingZeros=function(){return this.low?DA(this.low):DA(this.high)+32};F.ctz=F.countTrailingZeros;F.and=function(e){return et(e)||(e=_n(e)),ne(this.low&e.low,this.high&e.high,this.unsigned)};F.or=function(e){return et(e)||(e=_n(e)),ne(this.low|e.low,this.high|e.high,this.unsigned)};F.xor=function(e){return et(e)||(e=_n(e)),ne(this.low^e.low,this.high^e.high,this.unsigned)};F.shiftLeft=function(e){return et(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ne(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ne(0,this.low<<e-32,this.unsigned)};F.shl=F.shiftLeft;F.shiftRight=function(e){return et(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ne(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ne(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};F.shr=F.shiftRight;F.shiftRightUnsigned=function(e){return et(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ne(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?ne(this.high,0,this.unsigned):ne(this.high>>>e-32,0,this.unsigned)};F.shru=F.shiftRightUnsigned;F.shr_u=F.shiftRightUnsigned;F.rotateLeft=function(e){var n;return et(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?ne(this.high,this.low,this.unsigned):e<32?(n=32-e,ne(this.low<<e|this.high>>>n,this.high<<e|this.low>>>n,this.unsigned)):(e-=32,n=32-e,ne(this.high<<e|this.low>>>n,this.low<<e|this.high>>>n,this.unsigned))};F.rotl=F.rotateLeft;F.rotateRight=function(e){var n;return et(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?ne(this.high,this.low,this.unsigned):e<32?(n=32-e,ne(this.high<<n|this.low>>>e,this.low<<n|this.high>>>e,this.unsigned)):(e-=32,n=32-e,ne(this.low<<n|this.high>>>e,this.high<<n|this.low>>>e,this.unsigned))};F.rotr=F.rotateRight;F.toSigned=function(){return this.unsigned?ne(this.low,this.high,!1):this};F.toUnsigned=function(){return this.unsigned?this:ne(this.low,this.high,!0)};F.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};F.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};F.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};oe.fromBytes=function(e,n,r){return r?oe.fromBytesLE(e,n):oe.fromBytesBE(e,n)};oe.fromBytesLE=function(e,n){return new oe(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};oe.fromBytesBE=function(e,n){return new oe(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const Zj=16;function MS(t){t==="X"&&(t="");const e=t.padEnd(Zj,"0");return oe.fromString(e,!0,16)}function $j(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const n=e%4;e=(e-n)/4;const r=e;e*=4;const s=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-r-s.length).join("0")+s}function eH(t,e){const n=tH(t).shiftRightUnsigned(2);return t.add(oe.fromNumber(2*e+1-4).multiply(n))}function tH(t){return t.and(t.not().add(1))}const nH=3,rH=30,iH=2*rH+1,VA=180/Math.PI;function sH(t){if(t.length===0)throw new Error("Invalid Hilbert quad key ".concat(t));const e=t.split("/"),n=parseInt(e[0],10),r=e[1],i=r.length;let s=0;const o=[0,0];for(let a=i-1;a>=0;a--){s=i-a;const l=r[a];let c=0,u=0;l==="1"?u=1:l==="2"?(c=1,u=1):l==="3"&&(c=1);const h=Math.pow(2,s-1);aH(h,o,c,u),o[0]+=h*c,o[1]+=h*u}if(n%2===1){const a=o[0];o[0]=o[1],o[1]=a}return{face:n,ij:o,level:s}}function oH(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<nH+iH;)e="0"+e;const n=e.lastIndexOf("1"),r=e.substring(0,3),i=e.substring(3,n),s=i.length/2,o=oe.fromString(r,!0,2).toString(10);let a="";if(s!==0)for(a=oe.fromString(i,!0,2).toString(4);a.length<s;)a="0"+a;return"".concat(o,"/").concat(a)}function BS(t,e,n){const r=1<<e;return[(t[0]+n[0])/r,(t[1]+n[1])/r]}function jA(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function RS(t){return[jA(t[0]),jA(t[1])]}function OS(t,e){let[n,r]=e;switch(t){case 0:return[1,n,r];case 1:return[-n,1,r];case 2:return[-n,-r,1];case 3:return[-1,-r,-n];case 4:return[r,-1,-n];case 5:return[r,n,-1];default:throw new Error("Invalid face")}}function FS(t){let[e,n,r]=t;const i=Math.atan2(r,Math.sqrt(e*e+n*n));return[Math.atan2(n,e)*VA,i*VA]}function aH(t,e,n,r){if(r===0){n===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function lH(t){const e=BS(t.ij,t.level,[.5,.5]),n=RS(e),r=OS(t.face,n);return FS(r)}const cH=100;function HA(t){const{face:e,ij:n,level:r}=t,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(cH*Math.pow(2,-r))),o=new Float64Array(4*s*2+2);let a=0,l=0;for(let c=0;c<4;c++){const u=i[c].slice(0),h=i[c+1],f=(h[0]-u[0])/s,g=(h[1]-u[1])/s;for(let p=0;p<s;p++){u[0]+=f,u[1]+=g;const v=BS(n,r,u),T=RS(v),m=OS(e,T),_=FS(m);Math.abs(_[1])>89.999&&(_[0]=l);const y=_[0]-l;_[0]+=y>180?-360:y<-180?360:0,o[a++]=_[0],o[a++]=_[1],l=_[0]}}return o[a++]=o[0],o[a++]=o[1],o}function Im(t){const e=uH(t);return sH(e)}function uH(t){if(t.indexOf("/")>0)return t;const e=MS(t);return oH(e)}function hH(t){const e=Im(t);return lH(e)}function fH(t){let e;if(t.face===2||t.face===5){let n=null,r=0;for(let i=0;i<4;i++){const s="".concat(t.face,"/").concat(i),o=Im(s),a=HA(o);(typeof n>"u"||n===null)&&(n=new Float64Array(4*a.length)),n.set(a,r),r+=a.length}e=WA(n)}else{const n=HA(t);e=WA(n)}return e}function WA(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],n=[];for(let r=0;r<t.length;r+=2)e.push(t[r]),n.push(t[r+1]);return e.sort((r,i)=>r-i),n.sort((r,i)=>r-i),{west:e[0],east:e[e.length-1],north:n[n.length-1],south:n[0]}}function dH(t,e){const n=(e==null?void 0:e.minimumHeight)||0,r=(e==null?void 0:e.maximumHeight)||0,i=Im(t),s=fH(i),o=s.west,a=s.south,l=s.east,c=s.north,u=[];return u.push(new x(o,c,n)),u.push(new x(l,c,n)),u.push(new x(l,a,n)),u.push(new x(o,a,n)),u.push(new x(o,c,r)),u.push(new x(l,c,r)),u.push(new x(l,a,r)),u.push(new x(o,a,r)),u}function DS(t){const e=t.token,n={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},r=dH(e,n),i=hH(e),s=i[0],o=i[1],a=ve.WGS84.cartographicToCartesian([s,o,n.maximumHeight]),l=new x(a[0],a[1],a[2]);r.push(l);const c=k4(r);return[...c.center,...c.halfAxes]}const gH=4,pH=8,mH={QUADTREE:gH,OCTREE:pH};function _H(t,e,n){if(t!=null&&t.box){const r=MS(t.s2VolumeInfo.token),i=eH(r,e),s=$j(i),o={...t.s2VolumeInfo};switch(o.token=s,n){case"OCTREE":const c=t.s2VolumeInfo,u=c.maximumHeight-c.minimumHeight,h=u/2,f=c.minimumHeight+u/2;c.minimumHeight=f-h,c.maximumHeight=f+h;break}return{box:DS(o),s2VolumeInfo:o}}}async function NS(t){const{options:e,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,globalData:i={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:s}=t;let{subtree:o,level:a=0}=t;const{subdivisionScheme:l,subtreeLevels:c,maximumLevel:u,contentUrlTemplate:h,subtreesUriTemplate:f,basePath:g}=e,p={children:[],lodMetricValue:0,contentUrl:""},v=mH[l],T=r&1,m=r>>1&1,_=r>>2&1,y=(v**a-1)/(v-1);let b=ni(n.mortonIndex,r),S=y+b,w=ni(n.x,T),I=ni(n.y,m),L=ni(n.z,_),B=!1;a+1>c&&(B=Lf(o.childSubtreeAvailability,b));const M=ni(i.x,w),G=ni(i.y,I),W=ni(i.z,L),j=a+i.level;if(B){const U="".concat(g,"/").concat(f),H=_g(U,j,M,G,W);o=await or(H,wS),i.mortonIndex=b,i.x=w,i.y=I,i.z=L,i.level=a,b=0,S=0,w=0,I=0,L=0,a=0}if(!Lf(o.tileAvailability,S)||a>u)return p;Lf(o.contentAvailability,S)&&(p.contentUrl=_g(h,j,M,G,W));const Nn=a+1,yn={mortonIndex:b,x:w,y:I,z:L};for(let U=0;U<v;U++){const H=_H(s,U,l),J=await NS({subtree:o,options:e,parentData:yn,childIndex:U,level:Nn,globalData:i,s2VolumeBox:H});if(J.contentUrl||J.children.length){const he=j+1,mr=yH(J,he,{childTileX:w,childTileY:I,childTileZ:L},e,s);p.children.push(mr)}}return p}function Lf(t,e){return"constant"in t?!!t.constant:t.explicitBitstream?EH(e,t.explicitBitstream):!1}function yH(t,e,n,r,i){const{basePath:s,refine:o,getRefine:a,lodMetricType:l,getTileType:c,rootLodMetricValue:u,rootBoundingVolume:h}=r,f=t.contentUrl&&t.contentUrl.replace("".concat(s,"/"),""),g=u/2**e,p=i!=null&&i.box?{box:i.box}:h,v=vH(e,p,n);return{children:t.children,contentUrl:t.contentUrl,content:{uri:f},id:t.contentUrl,refine:a(o),type:c(t),lodMetricType:l,lodMetricValue:g,geometricError:g,transform:t.transform,boundingVolume:v}}function vH(t,e,n){if(e.region){const{childTileX:r,childTileY:i,childTileZ:s}=n,[o,a,l,c,u,h]=e.region,f=2**t,g=(l-o)/f,p=(c-a)/f,v=(h-u)/f,[T,m]=[o+g*r,o+g*(r+1)],[_,y]=[a+p*i,a+p*(i+1)],[b,S]=[u+v*s,u+v*(s+1)];return{region:[T,_,m,y,b,S]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}function ni(t,e){return parseInt(t.toString(2)+e.toString(2),2)}function _g(t,e,n,r,i){const s=AH({level:e,x:n,y:r,z:i});return t.replace(/{level}|{x}|{y}|{z}/gi,o=>s[o])}function AH(t){const e={};for(const n in t)e["{".concat(n,"}")]=t[n];return e}function EH(t,e){const n=Math.floor(t/8),r=t%8;return(e[n]>>r&1)===1}function Lm(t){if(!t.contentUrl)return vs.EMPTY;const n=t.contentUrl.split("?")[0].split(".").pop();switch(n){case"pnts":return vs.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return vs.SCENEGRAPH;default:return n}}function Mm(t){switch(t){case"REPLACE":case"replace":return tr.REPLACE;case"ADD":case"add":return tr.ADD;default:return t}}function yg(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const r=new URL(t,"".concat(e,"/"));return decodeURI(r.toString())}else if(t.startsWith("/"))return t;return"".concat(e,"/").concat(t)}function JA(t,e){if(!t)return null;if(t.content){const n=t.content.uri||t.content.url;t.contentUrl=yg(n,e.basePath)}return t.id=t.contentUrl,t.lodMetricType=ku.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=Lm(t),t.refine=Mm(t.refine),t}async function TH(t,e){const n=t.basePath;let r;const i=KA(t==null?void 0:t.root);i&&t.root?r=await XA(t.root,t,i,e):r=JA(t.root,t);const s=[];for(s.push(r);s.length>0;){const a=(s.pop()||{}).children||[];for(let l of a){const c=KA(l);c?l=await XA(l,t,c,e):JA(l,{basePath:n}),s.push(l)}}return r}async function XA(t,e,n,r){var i,s;const o=e.basePath,{subdivisionScheme:a,maximumLevel:l,subtreeLevels:c,subtrees:{uri:u}}=n,h=_g(u,0,0,0,0),f=yg(h,o),g=await or(f,wS,r),p=yg(t.content.uri,o),v=e==null||(i=e.root)===null||i===void 0?void 0:i.refine,T=t.geometricError,m=(s=t.boundingVolume.extensions)===null||s===void 0?void 0:s["3DTILES_bounding_volume_S2"];if(m){const S={box:DS(m),s2VolumeInfo:m};t.boundingVolume=S}const _=t.boundingVolume,y={contentUrlTemplate:p,subtreesUriTemplate:u,subdivisionScheme:a,subtreeLevels:c,maximumLevel:l,refine:v,basePath:o,lodMetricType:ku.GEOMETRIC_ERROR,rootLodMetricValue:T,rootBoundingVolume:_,getTileType:Lm,getRefine:Mm};return await bH(t,g,y)}async function bH(t,e,n){if(!t)return null;t.lodMetricType=ku.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform;const{children:r,contentUrl:i}=await NS({subtree:e,options:n,s2VolumeBox:t});return i&&(t.contentUrl=i,t.content={uri:i.replace("".concat(n.basePath,"/"),"")}),t.refine=Mm(t.refine),t.type=Lm(t),t.children=r,t.id=t.contentUrl,t}function KA(t){var e;return(t==null||(e=t.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(t==null?void 0:t.implicitTiling)}const Bm={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:yS,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:xH,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function CH(t){return _p(t.url)}async function SH(t,e,n){const r={content:{featureIds:null}};return await SS(t,0,e,n,r.content),r.content}async function wH(t,e,n){var r;const i=JSON.parse(new TextDecoder().decode(t));return i.loader=e.loader||Bm,i.url=n.url,i.queryString=n.queryString,i.basePath=CH(i),i.root=await TH(i,e),i.type=Nt.TILES3D,i.lodMetricType=ku.GEOMETRIC_ERROR,i.lodMetricValue=((r=i.root)===null||r===void 0?void 0:r.lodMetricValue)||0,i}async function xH(t,e,n){const r=e["3d-tiles"]||{};let i;return r.isTileset==="auto"?i=n.url&&n.url.indexOf(".json")!==-1:i=r.isTileset,i?t=await wH(t,e,n):t=await SH(t,e,n),t}const YA=[0],PH={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Bm,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,n)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class Rm extends Ru{constructor(...e){super(...e),d(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&X.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){const{tileset3d:e}=this.state;return e!==null&&e.isLoaded()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:n,changeFlags:r}){if(e.data&&e.data!==n.data&&this._loadTileset(e.data),r.viewportChanged){const{activeViewports:i}=this.state;Object.keys(i).length&&(this._updateTileset(i),this.state.lastUpdatedViewports=i,this.state.activeViewports={})}if(r.propsChanged){const{layerMap:i}=this.state;for(const s in i)i[s].needsUpdate=!0}}activateViewport(e){const{activeViewports:n,lastUpdatedViewports:r}=this.state;this.internalState.viewport=e,n[e.id]=e;const i=r==null?void 0:r[e.id];(!i||!e.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:n}){const r=n&&n.props.tile;return e.picked&&(e.object=r),e.sourceTile=r,e}filterSubLayer({layer:e,viewport:n}){const{tile:r}=e.props,{id:i}=n;return r.selected&&r.viewportIds.includes(i)}_updateAutoHighlight(e){const n=e.sourceTile,r=this.state.layerMap[n==null?void 0:n.id];r&&r.layer&&r.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:n={}}=this.props;let r=this.props.loader||this.props.loaders;Array.isArray(r)&&(r=r[0]);const i={loadOptions:{...n}};let s=e;if(r.preload){const l=await r.preload(e,n);l.url&&(s=l.url),l.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:l.headers}),Object.assign(i,l)}const o=await or(s,r,i.loadOptions),a=new aj(o,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:a,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(a)}_onTileLoad(e){const{lastUpdatedViewports:n}=this.state;this.props.onTileLoad(e),this._updateTileset(n),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:n}=this.state,{timeline:r}=this.context,i=Object.keys(e).length;!r||!i||!n||n.selectTiles(Object.values(e)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(e,n){if(!e.content)return null;switch(e.type){case vs.POINTCLOUD:return this._makePointCloudLayer(e,n);case vs.SCENEGRAPH:return this._make3DModelLayer(e);case vs.MESH:return this._makeSimpleMeshLayer(e,n);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,n){const{attributes:r,pointCount:i,constantRGBA:s,cartographicOrigin:o,modelMatrix:a}=e.content,{positions:l,normals:c,colors:u}=r;if(!l)return null;const h=n&&n.props.data||{header:{vertexCount:i},attributes:{POSITION:l,NORMAL:c,COLOR_0:u}},{pointSize:f,getPointColor:g}=this.props,p=this.getSubLayerClass("pointcloud",am);return new p({pointSize:f},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:h,coordinateSystem:K.METER_OFFSETS,coordinateOrigin:o,modelMatrix:a,getColor:s||g,_offset:0})}_make3DModelLayer(e){const{gltf:n,instances:r,cartographicOrigin:i,modelMatrix:s}=e.content,o=this.getSubLayerClass("scenegraph",bm);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:r||YA,scenegraph:n,coordinateSystem:K.METER_OFFSETS,coordinateOrigin:i,modelMatrix:s,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,n){const r=e.content,{attributes:i,indices:s,modelMatrix:o,cartographicOrigin:a,coordinateSystem:l=K.METER_OFFSETS,material:c,featureIds:u}=r,{_getMeshColor:h}=this.props,f=n&&n.props.mesh||new gn({drawMode:4,attributes:IH(i),indices:s}),g=this.getSubLayerClass("mesh",Cm);return new g(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:f,data:YA,getColor:h(e),pbrMaterial:c,modelMatrix:o,coordinateOrigin:a,coordinateSystem:l,featureIds:u,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:n}=this.state;return e?e.tiles.map(r=>{const i=n[r.id]=n[r.id]||{tile:r};let{layer:s}=i;return r.selected&&(s?i.needsUpdate&&(s=this._getSubLayer(r,s),i.needsUpdate=!1):s=this._getSubLayer(r)),i.layer=s,s}).filter(Boolean):null}}d(Rm,"defaultProps",PH);d(Rm,"layerName","Tile3DLayer");function IH(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}const LH="modulepreload",MH=function(t){return"/mapengine-survey/step3/deckgl-arclayer/"+t},QA={},BH=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=MH(s),s in QA)return;QA[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=i.length-1;u>=0;u--){const h=i[u];if(h.href===s&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":LH,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,h)=>{c.addEventListener("load",u),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},RH=D.createContext(null);function OH(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===i&&r===s}function Xn(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Xn(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const i of n)if(!e.hasOwnProperty(i)||!Xn(t[i],e[i]))return!1;return!0}return!1}function FH(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function qA(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();Xn(n,r)||e.setProjection(n)}function ZA(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function $A(t,e){const n=e.viewState||e;let r=!1;if("longitude"in n&&"latitude"in n){const i=t.center;t.center=new i.constructor(n.longitude,n.latitude),r=r||i!==t.center}if("zoom"in n){const i=t.zoom;t.zoom=n.zoom,r=r||i!==t.zoom}if("bearing"in n){const i=t.bearing;t.bearing=n.bearing,r=r||i!==t.bearing}if("pitch"in n){const i=t.pitch;t.pitch=n.pitch,r=r||i!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),r}const DH=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function eE(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const s=e[r.ref];if(s){i=i||Object.assign({},r),delete i.ref;for(const o of DH)o in s&&(i[o]=s[o])}return i||r});return{...t,layers:n}}const tE={version:8,sources:{},layers:[]},nE={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Mf={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},rE={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},NH=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],UH=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Ns{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const s=this.props[rE[i.type]];s?s(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const s=this.props[nE[i.type]];s&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),s(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const s=this.props[Mf[i.type]];s&&s(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const i=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||i||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=Ns.savedMaps.pop();if(!r)return null;const i=r.map,s=i.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);i._container=n;const o=i._resizeObserver;o&&(o.disconnect(),o.observe(n)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:a}=e;return a&&(a.bounds?i.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):r._updateViewState(a,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=tE}=n,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||kH()||null,container:e,style:eE(r)},s=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,n.gl)}const o=new this._MapClass(i);s.padding&&o.setPadding(s.padding),n.cursor&&(o.getCanvas().style.cursor=n.cursor),this._createShadowTransform(o);const a=o._render;o._render=u=>{this._inRender=!0,a.call(o,u),this._inRender=!1};const l=o._renderTaskQueue.run;o._renderTaskQueue.run=u=>{l.call(o._renderTaskQueue,u),this._onBeforeRepaint()},o.on("render",()=>this._onAfterRepaint());const c=o.fire;o.fire=this._fireEvent.bind(this,c),o.on("resize",()=>{this._renderTransform.resize(o.transform.width,o.transform.height)}),o.on("styledata",()=>{this._updateStyleComponents(this.props,{}),qA(o.transform,this._renderTransform)}),o.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in nE)o.on(u,this._onPointerEvent);for(const u in Mf)o.on(u,this._onCameraEvent);for(const u in rE)o.on(u,this._onEvent);this._map=o}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),Ns.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=FH(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,i=this._renderTransform,{zoom:s,pitch:o,bearing:a}=i,l=r.isMoving();l&&(i.cameraElevationReference="sea");const c=$A(i,{...ZA(r.transform),...e});if(l&&(i.cameraElevationReference="ground"),c&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=s!==i.zoom),u.rotate||(u.rotate=a!==i.bearing),u.pitch||(u.pitch=o!==i.pitch)}return l||$A(r.transform,e),c}_updateSettings(e,n){const r=this._map;let i=!1;for(const s of NH)if(s in e&&!Xn(e[s],n[s])){i=!0;const o=r[`set${s[0].toUpperCase()}${s.slice(1)}`];o==null||o.call(r,e[s])}return i}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:r=tE,styleDiffing:i=!0}=e,s={diff:i};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(eE(r),s),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let i=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!Xn(e.light,n.light)&&(i=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!Xn(e.fog,n.fog)&&(i=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!Xn(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(i=!0,r.setTerrain(e.terrain))),i}_updateHandlers(e,n){var r,i;const s=this._map;let o=!1;for(const a of UH){const l=(r=e[a])!==null&&r!==void 0?r:!0,c=(i=n[a])!==null&&i!==void 0?i:!0;Xn(l,c)||(o=!0,l?s[a].enable(l):s[a].disable())}return o}_queryRenderedFeatures(e){const n=this._map,r=n.transform,{interactiveLayerIds:i=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=r}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),l=a.length>0;!l&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,l&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,r){const i=this._map,s=i.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in Mf&&(typeof n=="object"&&(n.viewState=ZA(s)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,n,r),i.transform=s,i):(e.call(i,n,r),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{qA(this._renderTransform,n),e.transform=n}}}Ns.savedMaps=[];function kH(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const GH=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function zH(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const i=e.transform;e.transform=t.transform;const s=e.project(r);return e.transform=i,s},unproject:r=>{const i=e.transform;e.transform=t.transform;const s=e.unproject(r);return e.transform=i,s},queryTerrainElevation:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryTerrainElevation(r,i);return e.transform=s,o},queryRenderedFeatures:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryRenderedFeatures(r,i);return e.transform=s,o}};for(const r of VH(e))!(r in n)&&!GH.includes(r)&&(n[r]=e[r].bind(e));return n}function VH(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const jH=typeof document<"u"?D.useLayoutEffect:D.useEffect,HH=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function WH(t,e){for(const r of HH)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!1)}const Vu=D.createContext(null);function JH(t,e,n){const r=D.useContext(RH),[i,s]=D.useState(null),o=D.useRef(),{current:a}=D.useRef({mapLib:null,map:null});D.useEffect(()=>{const u=t.mapLib;let h=!0,f;return Promise.resolve(u||n).then(g=>{if(!h)return;if(!g)throw new Error("Invalid mapLib");const p="Map"in g?g:g.default;if(!p.Map)throw new Error("Invalid mapLib");if(WH(p,t),!p.supported||p.supported(t))t.reuseMaps&&(f=Ns.reuse(t,o.current)),f||(f=new Ns(p.Map,t,o.current)),a.map=zH(f),a.mapLib=p,s(f),r==null||r.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(g=>{const{onError:p}=t;p?p({type:"error",target:null,originalEvent:null,error:g}):console.error(g)}),()=>{h=!1,f&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?f.recycle():f.destroy())}},[]),jH(()=>{i&&i.setProps(t)}),D.useImperativeHandle(e,()=>a.map,[i]);const l=D.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),c={height:"100%"};return D.createElement("div",{id:t.id,ref:o,style:l},i&&D.createElement(Vu.Provider,{value:a},D.createElement("div",{"mapboxgl-children":"",style:c},t.children)))}const XH=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Li(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!XH.test(r)?n[r]=`${i}px`:n[r]=i}}function KH(t,e){const{map:n,mapLib:r}=D.useContext(Vu),i=D.useRef({props:t});i.current.props=t;const s=D.useMemo(()=>{let v=!1;D.Children.forEach(t.children,_=>{_&&(v=!0)});const T={...t,element:v?document.createElement("div"):null},m=new r.Marker(T);return m.setLngLat([t.longitude,t.latitude]),m.getElement().addEventListener("click",_=>{var y,b;(b=(y=i.current.props).onClick)===null||b===void 0||b.call(y,{type:"click",target:m,originalEvent:_})}),m.on("dragstart",_=>{var y,b;const S=_;S.lngLat=s.getLngLat(),(b=(y=i.current.props).onDragStart)===null||b===void 0||b.call(y,S)}),m.on("drag",_=>{var y,b;const S=_;S.lngLat=s.getLngLat(),(b=(y=i.current.props).onDrag)===null||b===void 0||b.call(y,S)}),m.on("dragend",_=>{var y,b;const S=_;S.lngLat=s.getLngLat(),(b=(y=i.current.props).onDragEnd)===null||b===void 0||b.call(y,S)}),m},[]);D.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:o,latitude:a,offset:l,style:c,draggable:u=!1,popup:h=null,rotation:f=0,rotationAlignment:g="auto",pitchAlignment:p="auto"}=t;return D.useEffect(()=>{Li(s.getElement(),c)},[c]),D.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==o||s.getLngLat().lat!==a)&&s.setLngLat([o,a]),l&&!OH(s.getOffset(),l)&&s.setOffset(l),s.isDraggable()!==u&&s.setDraggable(u),s.getRotation()!==f&&s.setRotation(f),s.getRotationAlignment()!==g&&s.setRotationAlignment(g),s.getPitchAlignment()!==p&&s.setPitchAlignment(p),s.getPopup()!==h&&s.setPopup(h),gp.createPortal(t.children,s.getElement())}D.memo(D.forwardRef(KH));function iE(t){return new Set(t?t.trim().split(/\s+/):[])}function YH(t,e){const{map:n,mapLib:r}=D.useContext(Vu),i=D.useMemo(()=>document.createElement("div"),[]),s=D.useRef({props:t});s.current.props=t;const o=D.useMemo(()=>{const a={...t},l=new r.Popup(a);return l.setLngLat([t.longitude,t.latitude]),l.once("open",c=>{var u,h;(h=(u=s.current.props).onOpen)===null||h===void 0||h.call(u,c)}),l},[]);if(D.useEffect(()=>{const a=l=>{var c,u;(u=(c=s.current.props).onClose)===null||u===void 0||u.call(c,l)};return o.on("close",a),o.setDOMContent(i).addTo(n.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),D.useEffect(()=>{Li(o.getElement(),t.style)},[t.style]),D.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!Xn(o.options.offset,t.offset)&&o.setOffset(t.offset),(o.options.anchor!==t.anchor||o.options.maxWidth!==t.maxWidth)&&(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const a=iE(o.options.className),l=iE(t.className);for(const c of a)l.has(c)||o.removeClassName(c);for(const c of l)a.has(c)||o.addClassName(c);o.options.className=t.className}return gp.createPortal(t.children,i)}D.memo(D.forwardRef(YH));function Ga(t,e,n,r){const i=D.useContext(Vu),s=D.useMemo(()=>t(i),[]);return D.useEffect(()=>{const o=r||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,l=typeof n=="function"?n:typeof e=="function"?e:null,{map:c}=i;return c.hasControl(s)||(c.addControl(s,o==null?void 0:o.position),a&&a(i)),()=>{l&&l(i),c.hasControl(s)&&c.removeControl(s)}},[]),s}function QH(t){const e=Ga(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return D.useEffect(()=>{Li(e._container,t.style)},[t.style]),null}D.memo(QH);function qH(t){const e=Ga(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return D.useEffect(()=>{Li(e._controlContainer,t.style)},[t.style]),null}D.memo(qH);function ZH(t,e){const n=D.useRef({props:t}),r=Ga(({mapLib:i})=>{const s=new i.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var l,c;(c=(l=n.current.props).onGeolocate)===null||c===void 0||c.call(l,a)}),s.on("error",a=>{var l,c;(c=(l=n.current.props).onError)===null||c===void 0||c.call(l,a)}),s.on("outofmaxbounds",a=>{var l,c;(c=(l=n.current.props).onOutOfMaxBounds)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationstart",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationStart)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationend",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationEnd)===null||c===void 0||c.call(l,a)}),s},{position:t.position});return n.current.props=t,D.useImperativeHandle(e,()=>r,[]),D.useEffect(()=>{Li(r._container,t.style)},[t.style]),null}D.memo(D.forwardRef(ZH));function $H(t){const e=Ga(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return D.useEffect(()=>{Li(e._container,t.style)},[t.style]),null}D.memo($H);function e8(t){const e=Ga(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=D.useRef(t),r=n.current;n.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),D.useEffect(()=>{Li(e._container,i)},[i]),null}D.memo(e8);const t8=BH(()=>import("./maplibre-gl-fc9e41e6.js").then(t=>t.m),[]),n8=(()=>D.forwardRef(function(e,n){return JH(e,n,t8)}))();const r8=new $p({ambientLight:new zb({color:[255,182,193],intensity:.6}),pointLight1:new ky({color:[255,255,255],intensity:.8,position:[-.144528,49.739968,8e4]}),pointLight2:new ky({color:[255,255,255],intensity:.8,position:[-3.807751,54.104682,8e3]}),directionalLight:new Vd({color:[255,255,255],intensity:.8,direction:[-3,-9,-1]})}),i8={ambient:.8,diffuse:.6,shininess:300,specularColor:[255,255,255]},s8=-80,o8={longitude:139.69175,latitude:35.6895,zoom:11,maxZoom:15,pitch:80,bearing:0};function a8({object:t}){return t&&"bound"in t?t&&`${t.from.name} → ${t.to.name} ${t.bound}人`:null}const l8="./tokyo23ku.geojson",Ao=[["./output_1.json","千代田区"],["./output_2.json","中央区"],["./output_3.json","港区"],["./output_4.json","新宿区"],["./output_5.json","文京区"],["./output_6.json","台東区"],["./output_7.json","墨田区"],["./output_8.json","江東区"],["./output_9.json","品川区"],["./output_10.json","目黒区"],["./output_11.json","大田区"],["./output_12.json","世田谷区"],["./output_13.json","渋谷区"],["./output_14.json","中野区"],["./output_15.json","杉並区"],["./output_16.json","豊島区"],["./output_17.json","北区"],["./output_18.json","荒川区"],["./output_19.json","板橋区"],["./output_20.json","練馬区"],["./output_21.json","足立区"],["./output_22.json","葛飾区"],["./output_23.json","江戸川区"]],c8=["https://assets.cms.plateau.reearth.io/assets/22/a919cc-1c92-4165-8adc-fcc534251b63/13100_tokyo23-ku_2022_3dtiles_1_1_op_bldg_13101_chiyoda-ku_lod2_no_texture/tileset.json","https://assets.cms.plateau.reearth.io/assets/3f/3dfe7e-e4a9-42b7-8b08-6fe528ed1245/13100_tokyo23-ku_2022_3dtiles_1_1_op_bldg_13102_chuo-ku_lod2_no_texture/tileset.json","https://assets.cms.plateau.reearth.io/assets/6f/a16e61-ab05-4121-ad75-ca78d9180e06/13100_tokyo23-ku_2022_3dtiles_1_1_op_bldg_13103_minato-ku_lod2_no_texture/tileset.json","https://assets.cms.plateau.reearth.io/assets/4a/878097-66f2-4a39-b9fc-85ffee93dbdc/13100_tokyo23-ku_2022_3dtiles_1_1_op_bldg_13104_shinjuku-ku_lod2_no_texture/tileset.json"],sE=20,u8=5e4;function h8(){const[t,e]=D.useState(Ao[3][0]),[n,r]=D.useState(3),[i,s]=D.useState(null);D.useEffect(()=>{if(i!=null&&i.properties){const f=i.properties.N03_004,g=Ao.findIndex(p=>p[1]===f);g>=0&&(r(g),e(Ao[g][0]))}},[i]);const o=f=>{const g=f.target.value;r(g),e(Ao[g][0])},[a,l]=D.useState(1);function c(f,g){return g.map((v,T)=>new Rm({id:`${f}-${T}`,data:v,loader:Bm,opacity:a,MATERIAL:i8,onTileLoad:m=>{m.content.cartographicOrigin=new x(m.content.cartographicOrigin.x,m.content.cartographicOrigin.y,m.content.cartographicOrigin.z+s8)}}))}const h=[[...c("tileset",c8)],new pm({id:"geojson",data:l8,filled:!0,getFillColor:[0,0,0,0],stroked:!0,getLineColor:[70,130,180,255],lineWidthMinPixels:2,onHover:({object:f})=>s(f),pickable:!0}),new om({id:"ArcLayer",data:t,getSourceColor:()=>[Math.random()*255,Math.random()*255,Math.random()*255],getSourcePosition:f=>f.from.coordinates,getTargetColor:()=>[Math.random()*255,Math.random()*255,Math.random()*255],getTargetPosition:f=>f.to.coordinates,getWidth:f=>Math.min(sE,Math.max(0,f.bound/u8*sE)),getHeight:.3,pickable:!0})];return Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs("div",{className:"absolute left-5 top-5 z-10 bg-neutral-900/80 text-white p-3 flex flex-col gap-2",children:[Ne.jsx("h1",{className:"font-bold text-lg",children:"deck.gl - ArcLayer"}),Ne.jsxs("div",{className:"text-xs",children:[Ne.jsx("a",{href:"https://www.mlit.go.jp/sogoseisaku/transport/sosei_transport_tk_000035.html",children:"第12回大都市交通センサス調査結果 鉄道調査 （国土交通省）"}),Ne.jsx("br",{}),"行政区画間移動人員 鉄道定期券(居住地→勤務通学地区)"]}),Ne.jsxs("div",{className:"flex flex-col gap-1.5",children:[Ne.jsxs("div",{className:"flex gap-3",children:[Ne.jsx("select",{onChange:o,className:"bg-gray-800 text-white",value:n,children:Ao.map((f,g)=>Ne.jsx("option",{value:g,children:f[1]},g))}),"発"]}),Ne.jsxs("div",{className:"flex gap-3",children:[Ne.jsx("input",{type:"range",min:"0",max:"1.0",step:"0.1",value:a,onChange:f=>l(f.target.valueAsNumber)}),Ne.jsx("label",{className:"block text-xs",children:"建物透過度"})]})]})]}),Ne.jsx(Pk,{layers:h,initialViewState:o8,controller:!0,getTooltip:a8,effects:[r8],children:Ne.jsx(n8,{style:{width:"100vw",height:"100vh"},mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json"})})]})}Bf.createRoot(document.getElementById("root")).render(Ne.jsx(xw.StrictMode,{children:Ne.jsx(h8,{})}));export{f8 as c,vg as g};
